<html>
<head>
<title>Building a React live streaming app with 100ms - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用100ms - LogRocket博客构建React直播应用程序</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/build-react-live-streaming-app-100ms/#0001-01-01">https://blog.logrocket.com/build-react-live-streaming-app-100ms/#0001-01-01</a></blockquote><div><article class="article-post">
<p>直播是与从一个人到数百万观众实时互动的好方法。与任何人都可以随时共享屏幕或发言的视频会议不同，在直播中，观众的权限有限。从头开始实现直播将非常耗时，但我们可以使用一些服务来添加这一功能，只需几个步骤，其中之一就是<a href="https://www.100ms.live/">100毫秒</a>。</p>
<p>在本教程中，我们将通过构建一个具有互动功能的直播流应用程序来了解100毫秒，广播公司和观众可以使用聊天进行交流。</p>
<p>要学习本教程，您应该熟悉React和React钩子。您还应该在系统中安装Node.js。</p>
<p>本教程的完整代码可在GitHub上获得。我们开始吧！</p>

<h2 id="introduction-100ms">100ms简介</h2>
<p>100ms是一个云平台，允许开发者将视频和音频会议添加到web、Android和iOS应用程序中。它提供了REST APIs、SDK和一个仪表板，使捕获、分发、记录和呈现实时交互式音频和视频变得简单。</p>
<p>使用100ms构建一个实时应用程序非常简单，只需要两个主要步骤。第一个是在仪表盘中创建和配置一个<a href="https://www.100ms.live/docs/javascript/v2/foundation/templates-and-roles">模板</a>，为应用程序及其用户设置角色和设置。</p>
<p>模板配置会有所不同，这取决于您正在构建的应用程序类型——视频会议、虚拟活动或直播。例如，在直播应用程序中，流媒体或广播公司可以共享视频、音频或他们的屏幕，而观众不能做上述任何事情。我们将在模板中设置所有这些。</p>
<p>我们可以从<a href="https://www.100ms.live/examples/virtual-events-starter-kit">可用的初学者工具包</a>中选择已经为不同类型的实时应用程序提供了适当配置的模板，然后对它们进行微调，而不是创建自定义模板。设置好模板后，我们将在客户端使用SDK及其直观的方法、挂钩和选择器来集成和处理100ms。</p>
<p>在开始之前，您应该熟悉下面的100ms概念:</p>
<ul>
<li>房间:当我们加入音频或视频通话时，参与者被称为在一个房间中</li>
<li>对等方:音频或视频呼叫中的参与者。您是本地对等方，而其他人是远程对等方</li>
<li>音轨:有两种类型的音轨，音频和视频</li>
</ul>
<h2 id="setting-up-100ms">设置100毫秒</h2>
<p>要设置直播模板，请导航至<a href="https://dashboard.100ms.live/register?pathname=/">100毫秒</a>，并在浏览器中设置用户帐户。登录后，点击仪表板上的<strong>创建您的第一个应用</strong>，会出现一个模式，我们可以在其中创建一个自定义模板或选择一个已经创建的模板:</p>
<p><img data-attachment-id="136316" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/100-ms-app-templates/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100-ms-app-templates.png" data-orig-size="730,435" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="100-ms-app-templates" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100-ms-app-templates-300x179.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100-ms-app-templates.png" decoding="async" class="aligncenter wp-image-136316 size-full jetpack-lazy-image" src="../Images/2e1c62f5e861b3293691b3def7a1812a.png" alt="100ms App Templates" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/100-ms-app-templates.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/100-ms-app-templates-300x179.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/100-ms-app-templates.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/100-ms-app-templates.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="136316" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/100-ms-app-templates/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100-ms-app-templates.png" data-orig-size="730,435" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="100-ms-app-templates" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100-ms-app-templates-300x179.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100-ms-app-templates.png" decoding="async" loading="lazy" class="aligncenter wp-image-136316 size-full" src="../Images/2e1c62f5e861b3293691b3def7a1812a.png" alt="100ms App Templates" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/100-ms-app-templates.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/100-ms-app-templates-300x179.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/100-ms-app-templates.png"/></noscript>
<p>我们将使用直播应用初学者工具包，而不是创建新模板。将鼠标悬停在<strong> Live Streaming Starter Kit </strong>模板上，然后单击出现的<strong>立即部署</strong>按钮。您将看到以下内容:</p>
<p><img data-attachment-id="136318" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/deploy-live-streaming-starter-kit/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/deploy-live-streaming-starter-kit.png" data-orig-size="730,408" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="deploy-live-streaming-starter-kit" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/deploy-live-streaming-starter-kit-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/deploy-live-streaming-starter-kit.png" decoding="async" class="aligncenter wp-image-136318 size-full jetpack-lazy-image" src="../Images/3209f55f507845469f153ebaf3d0c3c4.png" alt="Deploy Live Streaming Starter Kit" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/deploy-live-streaming-starter-kit.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/deploy-live-streaming-starter-kit-300x168.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/deploy-live-streaming-starter-kit.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/deploy-live-streaming-starter-kit.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="136318" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/deploy-live-streaming-starter-kit/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/deploy-live-streaming-starter-kit.png" data-orig-size="730,408" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="deploy-live-streaming-starter-kit" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/deploy-live-streaming-starter-kit-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/deploy-live-streaming-starter-kit.png" decoding="async" loading="lazy" class="aligncenter wp-image-136318 size-full" src="../Images/3209f55f507845469f153ebaf3d0c3c4.png" alt="Deploy Live Streaming Starter Kit" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/deploy-live-streaming-starter-kit.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/deploy-live-streaming-starter-kit-300x168.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/deploy-live-streaming-starter-kit.png"/></noscript>
<p>在<strong>选择您的账户类型</strong>区，选择<strong>个人</strong>，然后点击<strong>下一步</strong>，您会看到以下内容:</p>
<p><img data-attachment-id="136320" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/choose-personal-account-type/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/choose-personal-account-type.png" data-orig-size="730,457" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="choose-personal-account-type" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/choose-personal-account-type-300x188.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/choose-personal-account-type.png" decoding="async" class="aligncenter wp-image-136320 size-full jetpack-lazy-image" src="../Images/2b09da1acf88a78696941c91da8f656c.png" alt="Choose Personal Account Type" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/choose-personal-account-type.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/choose-personal-account-type-300x188.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/choose-personal-account-type.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/choose-personal-account-type.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="136320" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/choose-personal-account-type/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/choose-personal-account-type.png" data-orig-size="730,457" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="choose-personal-account-type" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/choose-personal-account-type-300x188.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/choose-personal-account-type.png" decoding="async" loading="lazy" class="aligncenter wp-image-136320 size-full" src="../Images/2b09da1acf88a78696941c91da8f656c.png" alt="Choose Personal Account Type" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/choose-personal-account-type.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/choose-personal-account-type-300x188.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/choose-personal-account-type.png"/></noscript>
<p>我们需要输入一个唯一的子域。为此，我将输入<code>livestreamnow</code>，但是您可以使用任何其他名称。之后，点击<strong>继续。</strong>现在，我们已经创建了一个实时流媒体初学者工具包，当我们导航到我们的控制面板时，您将会看到它:</p>
<p><img data-attachment-id="136323" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/live-stream-starter-kit-created/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/live-stream-starter-kit-created.png" data-orig-size="730,417" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="live-stream-starter-kit-created" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/live-stream-starter-kit-created-300x171.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/live-stream-starter-kit-created.png" decoding="async" class="aligncenter wp-image-136323 size-full jetpack-lazy-image" src="../Images/0226c5674bf1c4ebdfa5aeef0cbaf0a4.png" alt="Live Stream Starter Kit Created" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/live-stream-starter-kit-created.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/live-stream-starter-kit-created-300x171.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/live-stream-starter-kit-created.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/live-stream-starter-kit-created.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="136323" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/live-stream-starter-kit-created/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/live-stream-starter-kit-created.png" data-orig-size="730,417" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="live-stream-starter-kit-created" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/live-stream-starter-kit-created-300x171.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/live-stream-starter-kit-created.png" decoding="async" loading="lazy" class="aligncenter wp-image-136323 size-full" src="../Images/0226c5674bf1c4ebdfa5aeef0cbaf0a4.png" alt="Live Stream Starter Kit Created" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/live-stream-starter-kit-created.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/live-stream-starter-kit-created-300x171.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/live-stream-starter-kit-created.png"/></noscript>
<p>要查看启动器模板的配置，将鼠标悬停在模板上并点击出现的<strong>设置图标</strong>。您将看到以下屏幕:</p>
<p><img data-attachment-id="136325" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/configure-starter-template/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-starter-template.png" data-orig-size="731,511" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Configure Starter Template" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-starter-template-300x210.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-starter-template.png" decoding="async" class="aligncenter wp-image-136325 size-full jetpack-lazy-image" src="../Images/700dcc68773f249e0ca1aa8e05383eae.png" alt="" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-starter-template.png 731w, https://blog.logrocket.com/wp-content/uploads/2022/10/configure-starter-template-300x210.png 300w" data-lazy-sizes="(max-width: 731px) 100vw, 731px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-starter-template.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-starter-template.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="136325" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/configure-starter-template/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-starter-template.png" data-orig-size="731,511" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Configure Starter Template" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-starter-template-300x210.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-starter-template.png" decoding="async" loading="lazy" class="aligncenter wp-image-136325 size-full" src="../Images/700dcc68773f249e0ca1aa8e05383eae.png" alt="" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-starter-template.png 731w, https://blog.logrocket.com/wp-content/uploads/2022/10/configure-starter-template-300x210.png 300w" sizes="(max-width: 731px) 100vw, 731px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-starter-template.png"/></noscript>
<p>请注意，已经创建了两个适合直播应用程序的角色，<code>broadcaster</code>和<code>hls-viewer</code>。</p>
<p>角色代表发布他们的音频或视频的流媒体工具。他们打开了所有权限，允许他们执行所有可用的操作，如共享音频和视频、静音和取消静音房间中的任何参与者、停止和开始直播流等。我们可以编辑该角色或任何其他角色允许的操作，只需切换我们想要禁用或启用的操作旁边的开关。</p>
<p><code>hls-viewer</code>角色代表加入直播流并可以使用消息进行交互的观众成员。他们的权限都没有打开，对于直播流中的观众来说通常是这样。</p>
<p>我们可以通过点击屏幕右侧的<strong>添加角色</strong>来创建其他角色，然后编辑权限以满足我们的需求。然而，由于我们的用例所需的角色已经为我们创建好了，所以我们不会这样做。</p>
<h2 id="building-livestreaming-app-100ms">构建100毫秒的直播应用程序</h2>
<p>100ms包括对用于直播流的<a href="https://www.100ms.live/blog/hls-101-beginners-guide"> HLS </a>的支持，这使得能够扩展到数百万观众，这主要是由于其受到操作系统和cdn的支持。然而，与其他协议相比，通过HLS的实时流传输速度较慢，并且延迟较高。</p>
<p>在本节中，我们将使用100ms SDK来构建直播应用程序。在继续之前，您应该熟悉以下内容:</p>
<ul>
<li><code>hmsStore</code>:包含房间在任何给定时间的完整状态，包括例如参与者详细信息、消息和跟踪状态</li>
<li><code>hmsActions</code>:用于执行加入、静音、发送消息等操作</li>
</ul>
<h2 id="setting-up-react">设置React</h2>
<p>我已经创建了一个初学者模板，我们将在本教程中使用，所以我们可以专注于使用100ms。使用以下命令克隆GitHub repo:</p>
<pre class="language-bash hljs">$ git clone -b starter https://github.com/Tammibriggs/LiveStreaming-100ms.git

$ cd LiveStreaming-100ms

$ npm install
</pre>
<p>现在，当我们使用<code>npm start</code>命令启动应用程序时，我们将看到以下页面:</p>
<p><img data-attachment-id="136327" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/start-100ms-example-app-homepage/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/start-100ms-example-app-homepage.png" data-orig-size="730,498" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="start-100ms-example-app-homepage" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/start-100ms-example-app-homepage-300x205.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/start-100ms-example-app-homepage.png" decoding="async" class="aligncenter wp-image-136327 size-full jetpack-lazy-image" src="../Images/354140080ad956c00792db24dd090b40.png" alt="Start 100ms Example App Homepage" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/start-100ms-example-app-homepage.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/start-100ms-example-app-homepage-300x205.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/start-100ms-example-app-homepage.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/start-100ms-example-app-homepage.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="136327" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/start-100ms-example-app-homepage/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/start-100ms-example-app-homepage.png" data-orig-size="730,498" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="start-100ms-example-app-homepage" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/start-100ms-example-app-homepage-300x205.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/start-100ms-example-app-homepage.png" decoding="async" loading="lazy" class="aligncenter wp-image-136327 size-full" src="../Images/354140080ad956c00792db24dd090b40.png" alt="Start 100ms Example App Homepage" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/start-100ms-example-app-homepage.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/start-100ms-example-app-homepage-300x205.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/start-100ms-example-app-homepage.png"/></noscript>
<p>在上面的页面中，我们可以输入姓名，并选择加入房间时要使用的角色。</p>
<p>在教程的这一点上，当我们点击<strong>加入</strong>按钮时，我们不会被带到不同的页面；我们以后再研究这个。相反，点击<strong>加入</strong>按钮后，页面看起来会如下图所示:</p>
<p><img data-attachment-id="136329" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/join-live-stream-app-example-100ms/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/join-live-stream-app-example-100ms.png" data-orig-size="701,478" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="join-live-stream-app-example-100ms" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/join-live-stream-app-example-100ms-300x205.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/join-live-stream-app-example-100ms.png" decoding="async" class="aligncenter wp-image-136329 size-full jetpack-lazy-image" src="../Images/0dfeafa3a712eebf9b235d939a956e5c.png" alt="Join Live Stream App Example 100ms" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/join-live-stream-app-example-100ms.png 701w, https://blog.logrocket.com/wp-content/uploads/2022/10/join-live-stream-app-example-100ms-300x205.png 300w" data-lazy-sizes="(max-width: 701px) 100vw, 701px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/join-live-stream-app-example-100ms.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/join-live-stream-app-example-100ms.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="136329" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/join-live-stream-app-example-100ms/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/join-live-stream-app-example-100ms.png" data-orig-size="701,478" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="join-live-stream-app-example-100ms" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/join-live-stream-app-example-100ms-300x205.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/join-live-stream-app-example-100ms.png" decoding="async" loading="lazy" class="aligncenter wp-image-136329 size-full" src="../Images/0dfeafa3a712eebf9b235d939a956e5c.png" alt="Join Live Stream App Example 100ms" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/join-live-stream-app-example-100ms.png 701w, https://blog.logrocket.com/wp-content/uploads/2022/10/join-live-stream-app-example-100ms-300x205.png 300w" sizes="(max-width: 701px) 100vw, 701px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/join-live-stream-app-example-100ms.png"/></noscript>
<h2 id="integrate-100ms-into-app">将100ms集成到我们的应用中</h2>
<p>为了将100ms集成到我们的React应用程序中，首先，我们将安装构建应用程序所需的SDK。我们将安装一个额外的依赖项，<a href="https://github.com/video-dev/hls.js/"> HLS.js </a>，来帮助我们为不支持HLS的浏览器显示HLS流:</p>
<pre class="language-bash hljs">$ npm i @100mslive/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="97e5f2f6f4e3bae4f3fcd7fbf6e3f2e4e3">[email protected]</a> hls.js
</pre>
<p>接下来，为了初始化SDK，我们需要用<code>&lt;HMSRoomProvider /&gt;</code>组件包装整个应用程序。在starter应用程序中，转到<code>src</code>目录中的<code>index.js</code>文件，将其修改为如下代码:</p>
<pre class="language-javascript hljs">// src/index.js
import React from 'react';
import ReactDOM from 'react-dom/client';
import './index.css';
import App from './App';
import { HMSRoomProvider } from '@100mslive/react-sdk';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  &lt;React.StrictMode&gt;
    &lt;HMSRoomProvider&gt;
      &lt;App /&gt;
    &lt;/HMSRoomProvider&gt;
  &lt;/React.StrictMode&gt;
);
</pre>
<p>现在，让我们继续检索构建我们的应用程序所需的凭证，<code>room_id</code>和<code>token_endpoint</code>。要获得<code>room_id</code>，请导航至您的100毫秒仪表盘。在侧边栏中，点击<strong>房间</strong>，你将进入以下页面:</p>
<p><img data-attachment-id="136332" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/fetch-100ms-room-credentials/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/fetch-100ms-room-credentials.png" data-orig-size="730,209" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="fetch-100ms-room-credentials" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/fetch-100ms-room-credentials-300x86.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/fetch-100ms-room-credentials.png" decoding="async" class="aligncenter wp-image-136332 size-full jetpack-lazy-image" src="../Images/1458d1ad6f195299f1dac2cc45a17462.png" alt="Fetch 100ms Room Credentials" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/fetch-100ms-room-credentials.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/fetch-100ms-room-credentials-300x86.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/fetch-100ms-room-credentials.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/fetch-100ms-room-credentials.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="136332" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/fetch-100ms-room-credentials/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/fetch-100ms-room-credentials.png" data-orig-size="730,209" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="fetch-100ms-room-credentials" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/fetch-100ms-room-credentials-300x86.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/fetch-100ms-room-credentials.png" decoding="async" loading="lazy" class="aligncenter wp-image-136332 size-full" src="../Images/1458d1ad6f195299f1dac2cc45a17462.png" alt="Fetch 100ms Room Credentials" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/fetch-100ms-room-credentials.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/fetch-100ms-room-credentials-300x86.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/fetch-100ms-room-credentials.png"/></noscript>
<p>上面的两个房间已经为我们创建，这是在部署live streaming starter kit时完成的。要验证房间是否具有我们的应用程序所需的<code>broadcaster</code>和<code>hls-viewer</code>角色，请单击<code>Room Id</code>表格标题下的任意id进行检查:</p>
<p><img data-attachment-id="136334" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/100ms-room-id-verification/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-room-id-verification.png" data-orig-size="730,249" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="100ms-room-id-verification" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-room-id-verification-300x102.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-room-id-verification.png" decoding="async" class="aligncenter wp-image-136334 size-full jetpack-lazy-image" src="../Images/d98e534715186089518f2a20de11d1c6.png" alt="100ms Room ID Verification" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-room-id-verification.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-room-id-verification-300x102.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-room-id-verification.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-room-id-verification.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="136334" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/100ms-room-id-verification/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-room-id-verification.png" data-orig-size="730,249" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="100ms-room-id-verification" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-room-id-verification-300x102.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-room-id-verification.png" decoding="async" loading="lazy" class="aligncenter wp-image-136334 size-full" src="../Images/d98e534715186089518f2a20de11d1c6.png" alt="100ms Room ID Verification" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-room-id-verification.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-room-id-verification-300x102.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-room-id-verification.png"/></noscript>
<p>现在，复制其中一个id，并将其粘贴到starter应用程序的<code>.env</code>文件的适当变量中。</p>
<p>要获得侧边栏上的<code>token_endpoint</code>，首先点击<strong>开发者</strong>。在下一页，复制<code>token_endpoint</code>并将其粘贴到<code>.env</code>文件的适当变量中:</p>
<p><img data-attachment-id="136337" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/100ms-token-endpoint-credentials/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-token-endpoint-credentials.png" data-orig-size="730,278" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="100ms-token-endpoint-credentials" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-token-endpoint-credentials-300x114.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-token-endpoint-credentials.png" decoding="async" class="aligncenter wp-image-136337 size-full jetpack-lazy-image" src="../Images/1427f0bd1666de0c98ca64895a09bcee.png" alt="100ms Token Endpoint Credentials" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-token-endpoint-credentials.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-token-endpoint-credentials-300x114.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-token-endpoint-credentials.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-token-endpoint-credentials.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="136337" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/100ms-token-endpoint-credentials/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-token-endpoint-credentials.png" data-orig-size="730,278" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="100ms-token-endpoint-credentials" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-token-endpoint-credentials-300x114.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-token-endpoint-credentials.png" decoding="async" loading="lazy" class="aligncenter wp-image-136337 size-full" src="../Images/1427f0bd1666de0c98ca64895a09bcee.png" alt="100ms Token Endpoint Credentials" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-token-endpoint-credentials.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-token-endpoint-credentials-300x114.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-token-endpoint-credentials.png"/></noscript>
<h2 id="joining-room">加入房间</h2>
<p>现在，我们将在下面的页面上工作:</p>
<p><img data-attachment-id="136339" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/joining-chat-room-100ms/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/joining-chat-room-100ms.png" data-orig-size="730,498" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="joining-chat-room-100ms" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/joining-chat-room-100ms-300x205.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/joining-chat-room-100ms.png" decoding="async" class="aligncenter wp-image-136339 size-full jetpack-lazy-image" src="../Images/fef2fc154e24d581d5dd0e99dbe5985b.png" alt="Joining Chat Room 100ms" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/joining-chat-room-100ms.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/joining-chat-room-100ms-300x205.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/joining-chat-room-100ms.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/joining-chat-room-100ms.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="136339" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/joining-chat-room-100ms/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/joining-chat-room-100ms.png" data-orig-size="730,498" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="joining-chat-room-100ms" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/joining-chat-room-100ms-300x205.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/joining-chat-room-100ms.png" decoding="async" loading="lazy" class="aligncenter wp-image-136339 size-full" src="../Images/fef2fc154e24d581d5dd0e99dbe5985b.png" alt="Joining Chat Room 100ms" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/joining-chat-room-100ms.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/joining-chat-room-100ms-300x205.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/joining-chat-room-100ms.png"/></noscript>
<p>在我们可以通过HLS开始流式传输之前，我们首先需要在<code>hmsActions</code>上使用<code>join</code>方法加入一个房间，这需要我们传递一个<code>config</code>对象。<code>config</code>对象必须有以下字段:</p>
<ul>
<li><code>userName</code>:连接到房间的每个人都可以看到的用户名</li>
<li><code>authToken</code>:我们将用来验证用户身份的客户端令牌</li>
</ul>
<p>如果我们正在<a href="https://blog.logrocket.com/remotion-a-framework-for-making-videos-in-react/">建立视频会议、虚拟会议或任何其他视频通话应用</a>，我们可以通过加入房间来发布我们的视频，房间中的其他同事或参与者可以看到我们的视频。然而，由于我们将通过HLS进行直播，因此流程有所不同。</p>
<p>转到<code>src/JoinRoom.js</code>并添加以下导入:</p>
<pre class="language-javascript hljs">// src/JoinRoom.js
import { useHMSActions } from "@100mslive/react-sdk";
</pre>
<p>接下来，在<code>selectedRole</code>状态后添加以下代码行:</p>
<pre class="language-javascript hljs">// src/JoinRoom.js
const hmsActions = useHMSActions()
</pre>
<p>接下来，让我们创建生成<code>authToken</code>的函数并加入房间。在<code>hmsActions</code>变量后添加以下代码行:</p>
<pre class="language-javascript hljs">// src/JoinRoom.js
const handleSubmit = async (e) =&gt; {
  e.preventDefault()
  const response = await fetch(`${ENDPOINT}api/token`, {
    method: "POST",
    body: JSON.stringify({
      user_id: `${Date.now()}`,
      role: selectedRole, //broadcaster, hls-viewer
      type: "app",
      room_id: ROOM_ID,
    }),
  })
  const { token } = await response.json()
  // Joining the room
  hmsActions.join({
    userName: username,
    authToken: token,
  })
}
</pre>
<p>在上面的代码中，我们使用我们在<code>.env</code>文件中提供的端点发送一个生成认证令牌的请求。该请求将选定的角色和房间ID作为参数。生成令牌后，我们使用它和输入字段中输入的用户名，通过<code>join</code>方法加入房间。</p>
<p>要在提交表单时调用此函数，请修改开始的表单标记<code>&lt;form&gt;</code>,如下所示:</p>
<pre class="language-javascript hljs">// src/JoinRoom.js
&lt;form className="join" onSubmit={handleSubmit}&gt;
</pre>
<p>现在，当我们在浏览器中导航到<code><a href="http://localhost:3000/" rel="nofollow">http://localhost:3000/</a></code>，输入用户名，并点击<strong>加入</strong>按钮，我们将加入房间。但是，用户界面不会有任何变化。要解决这个问题，我们需要一种方法来知道房间的连接状态，并在连接后隐藏表单。我们可以使用<code>selectIsConnectedToRoom</code>选择器和<code>useHMSStore</code>挂钩来完成。</p>
<p>转到<code>src/App.js</code>并添加以下导入:</p>
<pre class="language-javascript hljs">// src/App.js
import { useHMSStore, selectIsConnectedToRoom } from '@100mslive/react-sdk';
</pre>
<p>接下来，在<code>App</code>组件中添加以下代码行:</p>
<pre class="language-javascript hljs">// src/App.js  
const isConnected = useHMSStore(selectIsConnectedToRoom)
</pre>
<p>接下来，修改<code>App</code>组件中的return语句，如下所示:</p>
<pre class="language-javascript hljs">// src/App.js
return (
  &lt;div className="App wrapper"&gt; 
    {isConnected
      ? &lt;Room /&gt;
      : &lt;JoinRoom /&gt;
    }
  &lt;/div&gt;
);
</pre>
<p>有了这个，加入房间后，我们会看到下面的页面:</p>
<p><img data-attachment-id="136341" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/100ms-page-join/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-page-join.png" data-orig-size="730,498" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="100ms-page-join" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-page-join-300x205.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-page-join.png" decoding="async" class="aligncenter wp-image-136341 size-full jetpack-lazy-image" src="../Images/d804c1d4de92717279675af7c6762aa9.png" alt="100ms Page Join" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-page-join.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-page-join-300x205.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-page-join.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-page-join.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="136341" data-permalink="https://blog.logrocket.com/build-react-live-streaming-app-100ms/attachment/100ms-page-join/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-page-join.png" data-orig-size="730,498" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="100ms-page-join" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-page-join-300x205.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-page-join.png" decoding="async" loading="lazy" class="aligncenter wp-image-136341 size-full" src="../Images/d804c1d4de92717279675af7c6762aa9.png" alt="100ms Page Join" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-page-join.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-page-join-300x205.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/100ms-page-join.png"/></noscript>
<h2 id="displaying-video-tiles">显示视频图片</h2>
<p>加入房间后，我们的视频和音频将被发布，这意味着房间中的其他同事也可以查看。然而，由于我们是通过HLS直播的，其他观众应该看不到这个。对于加入房间的每个广播公司，我们只希望向其他广播公司显示他们发布的视频的视频块。</p>
<p>为此，我们将使用<code>useVideo</code>钩子，它接收一个视频轨道ID并返回一个<code>videoRef</code>以传递给一个视频元素。为了获得视频轨道ID，我们首先需要获得房间中对等方的列表。我们可以使用<code>useHMSStore</code>钩和<code>selectPeers</code>选择器来完成。</p>
<p>修改<code>src</code>目录中的<code>Stream.js</code>文件，如下所示:</p>
<pre class="language-javascript hljs">// src/Stream.js
import VideoTile from "./VideoTile";
import HlsView from "./HlsView";
import { selectLocalPeer, selectPeers, useHMSStore } from "@100mslive/react-sdk";

function Stream() {
  const peers = useHMSStore(selectPeers)
  const localPeer = useHMSStore(selectLocalPeer)

  return (
    &lt;div className="stream"&gt;
      {localPeer.roleName === 'broadcaster' &amp;&amp;
        peers.filter((peer) =&gt; peer.roleName === 'broadcaster')
        .map((peer) =&gt; (
          &lt;VideoTile key={peer.id} peer={peer} peers={peers} /&gt;
        )) 
      }
    &lt;/div&gt;
  )
}

export default Stream
</pre>
<p>在上面的代码中，我们获得了房间中的对等体列表以及本地对等体，即<code>you</code>。只有当<code>localPeer</code>的<code>roleName</code>字段等于<code>broadcaster</code>时，我们才会有条件地呈现<code>VideoTile</code>组件。</p>
<p>这样做将使视频块仅对广播公司可见，因为我们还没有开始流式播放。之后，使用<code>filter</code>方法，我们可以创建一个新的数组，只包含作为广播者的对等体，然后映射它并将每个对等体传递给<code>VideoTile</code>组件。</p>
<p>现在，转到<code>src/VideoTile.js</code>文件。让我们使用<code>useVideo</code>开始显示房间内广播公司发布的视频。修改<code>VideoTile.js</code>文件，看起来像下面的代码:</p>
<pre class="language-javascript hljs">// src/VideoTile.js
import { useVideo } from "@100mslive/react-sdk";

function VideoTile({ peer, peers }) {
  const { videoRef } = useVideo({
    trackId: peer.videoTrack
  })

  const numberOfBroadCasters = () =&gt; {
    const broadcasters = peers.filter((peer) =&gt; {
      return peer.roleName === 'broadcaster'
    })
    return broadcasters.length
  }

  return (
    &lt;video
      ref={videoRef}
      className={numberOfBroadCasters() &gt;= 2 ? 'video' : ''}
      autoPlay
      muted
      playsInline
    /&gt;
  )
}

export default VideoTile
</pre>
<p>这样，当我们作为广播者加入房间时，我们应该可以看到我们发布的视频和房间中其他广播者的视频。</p>
<h2 id="live-stream-hls-display-stream-viewers">通过HLS直播并向观众显示</h2>
<p>要通过HLS 启动<a href="https://www.100ms.live/docs/javascript/v2/features/hls">流，我们只需要调用<code>hmsActions</code>中的<code>startHLSStreaming</code>。要停止流，我们可以调用<code>stopHLSStreaming</code>方法，要获得HLS状态，我们可以使用<code>selectHLSState</code>选择器。就这么简单。</a></p>
<p>转到<code>src/Controls.js</code>并添加以下导入:</p>
<pre class="language-javascript hljs">// src/Controls.js
import { selectHLSState, useHMSActions, useHMSStore } from '@100mslive/react-sdk'
</pre>
<p>接下来，在<code>Controls</code>组件中添加以下代码行:</p>
<pre class="language-javascript hljs">// src/Controls.js
const hmsActions = useHMSActions()
const hlsState = useHMSStore(selectHLSState)
</pre>
<p>接下来，在<code>hlsState</code>变量后添加以下函数，用于启动和停止直播流:</p>
<pre class="language-javascript hljs">// src/Controls.js
const startHLSStreaming = async () =&gt; {
  try {
    await hmsActions.startHLSStreaming()
  } catch (err) {
      alert(`failed to start hls ${err}`)
  }
}

const stopHLSStreaming = async () =&gt; { 
  try {
    await hmsActions.stopHLSStreaming()
  } catch (err) {
      alert(`failed to stop hls ${err}`)
  }
}
</pre>
<p>要调用上述函数，请用以下代码替换return语句中<code>{/* HLS stream button */}</code>注释下的按钮组件:</p>
<pre class="language-javascript hljs">// src/Controls.js
{hlsState.running
  ? &lt;Button 
      variant="contained" 
      disableElevation
      className='leave'
      onClick={stopHLSStreaming}
    &gt;
      &lt;StopCircleOutlined /&gt; Stop Streaming
    &lt;/Button&gt;
  : &lt;Button 
      variant="contained"
      disableElevation
      onClick={startHLSStreaming}
    &gt;
      &lt;PodcastsOutlined /&gt; Go Live 
    &lt;/Button&gt;
}
</pre>
<p>现在，为了向查看者显示HLS流，我们将使用之前安装的HLS.js。更多的用户界面定制，你可以查看<a href="https://videojs.com/"> V </a> <a href="https://videojs.com/"> ideo </a> <a href="https://videojs.com/">。</a> <a href="https://videojs.com/"> js </a>，内部使用HLS.js。</p>
<p>当使用HLS.js显示流时，我们需要将流URL传递给它的<code>loadSource</code>方法，并使用<code>attachMedia</code>方法将一个视频元素传递给它。我们可以从<code>hls</code>状态获得流URL，我们可以使用<code>selectHLSState</code>选择器来检索它。</p><div class="code-block code-block-54">
<hr/>
<h3>更多来自LogRocket的精彩文章:</h3>

<hr/></div>
<p>转到<code>src/Stream.js</code>，在<code>div</code>的结束标签<code>&lt;/&gt;</code>前添加以下代码，将<code>stream</code>作为<code>className</code>:</p>
<pre class="language-javascript hljs">// src/Stream.js
{localPeer.roleName === 'hls-viewer' &amp;&amp;
  &lt;HlsView/&gt;
}
</pre>
<p>接下来，转到<code>src/HlsView</code>并修改文件，看起来像下面的代码:</p>
<pre class="language-javascript hljs">// src/HlsView
import { selectHLSState, useHMSStore } from '@100mslive/react-sdk'
import Hls from 'hls.js'
import { useEffect, useRef } from 'react'

function HlsView() {
    const videoRef = useRef(null)
    const hlsState = useHMSStore(selectHLSState)
    const hlsUrl = hlsState.variants[0]?.url
    useEffect(() =&gt; {
        if (videoRef.current &amp;&amp; hlsUrl) {
            const browserHasNativeHLSSupport = videoRef.current.canPlayType(
                'application/vnd.apple.mpegurl'
            );
            if (Hls.isSupported()) {
                let hls = new Hls()
                hls.loadSource(hlsUrl)
                hls.attachMedia(videoRef.current)
            }
            else if (browserHasNativeHLSSupport) {
                videoRef.current.src = hlsUrl
            }
        }
    }, [hlsUrl])
    return &lt;video ref={videoRef} autoPlay controls&gt;&lt;/video&gt;;
}

export default HlsView
</pre>
<p>这样，观众现在就可以看到来自广播公司的视频流了。</p>
<h2 id="adding-room-control-functionalities">添加房间控制功能</h2>
<p>让我们添加静音和取消静音音频和视频以及离开房间的功能。转到<code>src/Controls.js</code>并添加以下导入:</p>
<pre class="language-javascript hljs">// src/Controls.js
import { selectIsLocalAudioEnabled, selectIsLocalVideoEnabled, selectLocalPeer } from '@100mslive/react-sdk'
</pre>
<p>接下来，在<code>hlsState</code>变量后添加以下代码行:</p>
<pre class="language-javascript hljs">// src/Controls.js
const audioEnabled = useHMSStore(selectIsLocalAudioEnabled)
const videoEnabled = useHMSStore(selectIsLocalVideoEnabled)
const localPeer = useHMSStore(selectLocalPeer)
</pre>
<p>我们使用<code>selectIsLocalAudioEnabled</code>和<code>selectIsLocalVideoEnabled</code>选择器来获取音频和视频各自的布尔状态，并确定它们当前是静音还是未静音。然后我们将切换当前状态，并在UI中显示适当的图标。我们也可以使用<code>selectLocalPeer</code>选择器得到<code>localPeer</code>。</p>
<p>要静音和取消静音音频和视频，我们可以使用<code>hmsActions</code>中的<code>setLocalVideoEnabled</code>和<code>setLocalAudioEnabled</code>，它们接收一个布尔值作为参数。在<code>Controls</code>组件中，在<code>stopHLSStreaming</code>功能后增加以下功能:</p>
<pre class="language-javascript hljs">// src/Controls.js
const toggleAudio = async () =&gt; {
  await hmsActions.setLocalAudioEnabled(!audioEnabled);
}

const toggleVideo = async () =&gt; {
  await hmsActions.setLocalVideoEnabled(!videoEnabled);
}
</pre>
<p>现在，要调用上面的函数，请在return语句中找到以下代码行:</p>
<pre class="language-javascript hljs">&lt;IconButton&gt;
  &lt;MicOffOutlined /&gt;
&lt;/IconButton&gt;
&lt;IconButton&gt;
  &lt;VideocamOffOutlined /&gt;
&lt;/IconButton&gt;
</pre>
<p>将上面的代码修改为以下代码:</p>
<pre class="language-javascript hljs">// src/Controls.js
&lt;IconButton onClick={toggleAudio}&gt;
  {audioEnabled
    ? &lt;MicNoneOutlined /&gt;
    : &lt;MicOffOutlined /&gt;
  }
&lt;/IconButton&gt;
&lt;IconButton onClick={toggleVideo}&gt;
  {videoEnabled
    ? &lt;VideocamOutlined /&gt;
    : &lt;VideocamOffOutlined /&gt;
  }
&lt;/IconButton&gt;
</pre>
<p>要离开房间，我们需要调用<code>hmsActions</code>中的<code>leave()</code>方法。在<code>toggleVideo</code>函数之后，我们需要添加以下几行代码:</p>
<pre class="language-javascript hljs">// src/Controls.js
const leaveRoom = async () =&gt; {
  if(localPeer.roleName === 'broadcaster'){
    hmsActions.leave()
    await hmsActions.stopHLSStreaming()
  }else{
    hmsActions.leave()
  }
}
</pre>
<p>在上面的代码中，如果<code>localPeer</code>的<code>roleName</code>字段等于<code>broadcaster</code>，随着离开房间，我们也结束了HLS流，以防它正在进行。</p>
<p>为了调用上面的<code>return</code>语句中的函数，我们将看到下面几行代码:</p>
<pre class="language-javascript hljs">&lt;Button 
  variant="contained" 
  disableElevation
  className='leave'
&gt;
  &lt;LogoutOutlined /&gt; Leave Room
&lt;/Button&gt; 
</pre>
<p>将其修改为以下内容:</p>
<pre class="language-javascript hljs">// src/Controls.js
&amp;lt;Button 
  variant="contained" 
  disableElevation
  className='leave'
  onClick={leaveRoom}
&gt;
  &lt;LogoutOutlined /&gt; Leave Room
&lt;/Button&gt;
</pre>
<p>这样，静音、取消静音和离开功能应该可以正常工作。</p>
<p>但是，您会注意到，即使当我们作为观众加入房间时，所有旨在仅供广播公司查看或使用的UI组件都将是可见的，这是不应该的。观众应该只能看到<code>leave</code>按钮。</p>
<p>要解决这个问题，请修改<code>Controls</code>组件的<code>return</code>语句，如下所示:</p>
<pre class="language-javascript hljs">// src/Controls.js
return (
  &lt;div className='controls'&gt;
    {localPeer.roleName === 'broadcaster'
      ? &lt;&gt;
          &lt;IconButton onClick={toggleAudio}&gt;
            {audioEnabled
              ? &lt;MicNoneOutlined /&gt;
              : &lt;MicOffOutlined /&gt;
            }
          &lt;/IconButton&gt;
          &lt;IconButton onClick={toggleVideo}&gt;
            {videoEnabled
              ? &lt;VideocamOutlined /&gt;
              : &lt;VideocamOffOutlined /&gt;
            }
          &lt;/IconButton&gt;
          &lt;Button 
            variant="contained" 
            disableElevation
            className='leave'
            onClick={leaveRoom}
          &gt;
            &lt;LogoutOutlined /&gt; Leave Room
          &lt;/Button&gt;
          {hlsState.running
            ? &lt;Button 
                variant="contained" 
                disableElevation
                className='leave'
                onClick={stopHLSStreaming}
              &gt;
                &lt;StopCircleOutlined /&gt; Stop Streaming
              &lt;/Button&gt;
            : &lt;Button 
                variant="contained"
                disableElevation
                onClick={startHLSStreaming}
              &gt;
                &lt;PodcastsOutlined /&gt; Go Live 
              &lt;/Button&gt;
          }
        &lt;/&gt;
      : &lt;Button 
          variant="contained" 
          disableElevation
          className='leave'
          onClick={leaveRoom}
        &gt;
          &lt;LogoutOutlined /&gt; Leave Room
        &lt;/Button&gt;
    }
  &lt;/div&gt;
)
</pre>
<h2 id="add-chat-functionality-display-participants">添加聊天功能并显示所有参与者</h2>
<p>有三种不同的方法可以发送聊天消息，它们有不同的使用案例。</p>
<ul>
<li><code>sendBroadcastMessage('message')</code>:房间里的每个人都会收到的信息</li>
<li><code>sendGroupMessage('message', ['role1'])</code>:对于将由作为传入角色的一部分的每个对等方接收的消息</li>
<li><code>sendDirectMessage('message', peer.id)</code>:仅由ID被传递的对等方接收的消息</li>
</ul>
<p>在我们的应用程序中，我们将只使用<code>sendBroadcastMessage()</code>，但如果你愿意，你可以为其余部分添加功能。</p>
<p>转到<code>src/ChatNdParticipants.js</code>并添加以下代码行:</p>
<pre class="language-javascript hljs">// src/ChatNdParticipants.js
import { selectHMSMessages, useHMSActions, useHMSStore } from "@100mslive/react-sdk"
</pre>
<p>接下来，在<code>message</code>状态后添加以下代码行:</p>
<pre class="language-javascript hljs">// src/ChatNdParticipants.js
const messages = useHMSStore(selectHMSMessages)
const hmsActions = useHMSActions()

const handleSubmit = (e) =&gt; {
  e.preventDefault();
  hmsActions.sendBroadcastMessage(message)
  setMessage('')
}
</pre>
<p>我们已经创建了一个<code>handleSubmit</code>，它将发送消息。我们还使用<code>selectHMSMessages</code>选择器检索所有发送的消息。</p>
<p>当提交<code>send-message</code>表单时，我们需要调用<code>handleSubmit</code>并循环检索到的消息并显示它们。要调用<code>handleSubmit</code>，将名为<code>send-message</code>的表单的开始标记<code>&lt;form&gt;</code>修改为下面的代码:</p>
<pre class="language-javascript hljs">// src/ChatNdParticipants.js
&lt;form name='send-messge' onSubmit={handleSubmit}&gt;
</pre>
<p>接下来，用以下内容替换<code>{/* Messages */}</code>注释下的<code>Message</code>组件:</p>
<pre class="language-javascript hljs">// src/ChatNdParticipants.js
{messages.map((msg) =&gt; (
  &lt;Message key={msg.id} message={msg} /&gt;
))}
</pre>
<p>接下来，修改<code>src</code>目录中的<code>Message.js</code>文件，如下所示:</p>
<pre class="language-javascript hljs">// src/ChatNdParticipants.js
import { selectLocalPeer, useHMSStore } from '@100mslive/react-sdk'

function Message({message}) {
  const localPeer = useHMSStore(selectLocalPeer)

  return (
    &lt;div 
      className={`message ${message.senderUserId === localPeer.customerUserId &amp;&amp; 'myMessage'}`}
    &gt;
      &lt;span&gt;{message.senderName}&lt;/span&gt;
      &lt;p&gt;{message.message}&lt;/p&gt;
    &lt;/div&gt;
  )
}

export default Message
</pre>
<p>现在，聊天功能应该可以工作了。为了显示参与者，我们将使用<code>selectPeers</code>选择器获取房间中的所有同伴，遍历他们，并显示他们的姓名和角色。</p>
<p>在<code>ChatNdParticipants.js</code>中，添加以下导入:</p>
<pre class="language-javascript hljs">// src/ChatNdParticipants.js
import { selectPeers } from "@100mslive/react-sdk"
</pre>
<p>接下来，在<code>hmsActions</code>变量后添加以下代码行:</p>
<pre class="language-javascript hljs">// src/ChatNdParticipants.js
const peers = useHMSStore(selectPeers)
</pre>
<p>现在，在<code>{/* Participants */}</code>注释后添加以下代码行:</p>
<pre class="language-javascript hljs">// src/ChatNdParticipants.js
{peers.map((peer) =&gt; (
  &lt;div className='rightBox__participant'&gt;
    {peer.name}
    &lt;p&gt;{peer.roleName}&lt;/p&gt;
  &lt;/div&gt;
))}
</pre>
<p>这样，我们就完成了直播应用的构建。</p>
<h2 id="conclusion">结论</h2>
<p>在本教程中，我们学习了如何使用100ms构建直播应用程序。除了本教程中涵盖的功能，我们还可以添加许多其他功能，如YouTube、Twitch、脸书等使用<a href="https://www.100ms.live/docs/javascript/v2/features/rtmp-recording"> RTMP流媒体</a>的流媒体，显示房间内发生的活动的<a href="https://www.100ms.live/docs/javascript/v2/features/notifications">通知</a>，等等。</p>
<p>我希望你喜欢这个教程，如果你有任何问题，一定要留下评论。编码快乐！</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720"><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener"> LogRocket </a>:全面了解您的生产React应用</h2><p>调试React应用程序可能很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪Redux状态、自动显示JavaScript错误以及跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" vwo-el-id="19356441070">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<p vwo-el-id="28675660440" class="">LogRocket 结合了会话回放、产品分析和错误跟踪，使软件团队能够创建理想的web和移动产品体验。这对你来说意味着什么？</p>
<p>LogRocket不是猜测错误发生的原因，也不是要求用户提供截图和日志转储，而是让您回放问题，就像它们发生在您自己的浏览器中一样，以快速了解哪里出错了。</p>
<p>不再有嘈杂的警报。智能错误跟踪允许您对问题进行分类，然后从中学习。获得有影响的用户问题的通知，而不是误报。警报越少，有用的信号越多。</p>
<p vwo-el-id="28675660750">LogRocket Redux中间件包为您的用户会话增加了一层额外的可见性。LogRocket记录Redux存储中的所有操作和状态。</p>
<p vwo-el-id="28675661060">现代化您调试React应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">开始免费监控</a>。</p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>