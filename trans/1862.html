<html>
<head>
<title>How to use TypeScript with React 18 alpha - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在 React 18 alpha - LogRocket 博客中使用 TypeScript</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/how-to-use-typescript-with-react-18-alpha/#0001-01-01">https://blog.logrocket.com/how-to-use-typescript-with-react-18-alpha/#0001-01-01</a></blockquote><div><div class="mainheading">

<div class="row post-top-meta hidden-md-down">

<div class="col-md-10 col-xs-12">
  <a class="text-capitalize link-dark" href="https://blog.logrocket.com/author/johnreilly/">
John Reilly <span class="btn follow">Follow</span></a>
<span class="author-description d-block">MacGyver turned Dev 🌻❤️ TypeScript / ts-loader / fork-ts-checker-webpack-plugin / DefinitelyTyped: The Movie</span>
</div>
</div>
<h1 class="posttitle">如何在 React 18 alpha 中使用 TypeScript</h1>
<h2 class="post-subtitle"/>
<p><span class="post-date"><time class="post-date">2021 年 6 月 9 日</time> </span> <span class="dot"/> <span class="readingtime"> 2 分钟阅读</span> <span class="wordcount"> 654 </span> <span class="logrocket_editor"/></p>
</div>
<article class="article-post">
<p><a href="https://reactjs.org/blog/2021/06/08/the-plan-for-react-18.html"> React 18 alpha 已经发布</a>，非常激动人心！但是我们能把它和 TypeScript 一起使用吗？</p>
<p>答案是“是的”，但是我们需要做一些事情来实现它。这篇文章将告诉你该怎么做。</p>
<h2>使用 TypeScript 创建 React 应用程序</h2>
<p>让我们用<a href="https://blog.logrocket.com/getting-started-with-create-react-app-d93147444a27/"> Create React App </a>为自己创建一个普通的 React 类型脚本应用程序:</p>
<pre class="language-shell hljs">yarn create react-app my-app --template typescript</pre>
<p>现在我们把 React 的版本升级到<code>@next</code>:</p>
<pre class="language-shell hljs">yarn add <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c6b4a3a7a5b286a8a3beb2">[email protected]</a> <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9eecfbfffdeab3faf1f3def0fbe6ea">[email protected]</a></pre>
<p>这将在<code>package.json</code>中为您留下使用 React 18 的条目。它可能看起来像这样:</p>
<pre class="language-json hljs">    "react": "^18.0.0-alpha-e6be2d531",
    "react-dom": "^18.0.0-alpha-e6be2d531",</pre>
<p>如果我们运行<code>yarn start</code>，我们会发现自己在运行一个 React 18 应用。激动人心！</p>
<h2>使用新的 API</h2>
<p>所以让我们尝试使用<code><a href="https://github.com/reactwg/react-18/discussions/5">ReactDOM.createRoot</a></code> API。正是这个 API 选择我们的应用程序使用 React 18 的新功能。我们将打开<code>index.tsx</code>并进行如下更改:</p>
<pre class="language-diff hljs"><span class="hljs-deletion">-ReactDOM.render(
-  &lt;React.StrictMode&gt;
-    &lt;App /&gt;
-  &lt;/React.StrictMode&gt;,
-  document.getElementById('root')
-);</span>
<span class="hljs-addition">+const root = ReactDOM.createRoot(document.getElementById('root'));
+
+root.render(
+  &lt;React.StrictMode&gt;
+    &lt;App /&gt;
+  &lt;/React.StrictMode&gt;
+);</span></pre>
<p>如果我们单独运行 JavaScript，这是可行的。但是，因为我们也使用了 TypeScript，所以我们现在面临一个错误:</p>
<blockquote><p><code>Property 'createRoot' does not exist on type 'typeof import("/code/my-app/node_modules/@types/react-dom/index")'. TS2339</code></p></blockquote>
<p><img data-attachment-id="54030" data-permalink="https://blog.logrocket.com/how-to-use-typescript-with-react-18-alpha/createroot-property-error/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/createroot-property-error.png" data-orig-size="730,205" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="createRoot property error" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/createroot-property-error-300x84.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/createroot-property-error.png" decoding="async" class="aligncenter size-full wp-image-54030 jetpack-lazy-image" src="../Images/e15664b8889757d6fa12252f1413fefa.png" alt="TypeScript Throws an Error for the createRoot Property" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/createroot-property-error.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/createroot-property-error-300x84.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/06/createroot-property-error.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/createroot-property-error.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="54030" data-permalink="https://blog.logrocket.com/how-to-use-typescript-with-react-18-alpha/createroot-property-error/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/createroot-property-error.png" data-orig-size="730,205" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="createRoot property error" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/createroot-property-error-300x84.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/createroot-property-error.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-54030" src="../Images/e15664b8889757d6fa12252f1413fefa.png" alt="TypeScript Throws an Error for the createRoot Property" srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/createroot-property-error.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/createroot-property-error-300x84.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/createroot-property-error.png"/></noscript>
<p>这是 TypeScript 编译器抱怨它对<code>ReactDOM.createRoot</code>一无所知。这是因为我们的应用程序中当前的类型定义没有定义 API。</p>
<p>让我们升级我们的类型定义:</p>
<pre class="language-shell hljs">yarn add @types/react @types/react-dom</pre>
<p>我们可能有理由希望现在一切都正常运转——唉，事实并非如此。出现了同样的错误。TypeScript 不高兴了。</p>
<h2>告诉 TypeScript 新的 API</h2>
<p>如果我们看一下增加了对 API 支持的<a href="https://github.com/DefinitelyTyped/DefinitelyTyped/pull/53685"> PR，我们会找到一些提示。如果你看一下<code><a href="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/a07e9cfb005682fb6be0a2e85113eac131c3006f/types/react/next.d.ts">next.d.ts</a></code>的，你会发现这个信息，由</a><a href="https://twitter.com/sebsilbermann">塞巴斯蒂安·西尔伯曼</a>提供:</p>
<pre class="language-typescript hljs">/**
 * These are types for things that are present in the upcoming React 18 release.
 *
 * Once React 18 is released they can just be moved to the main index file.
 *
 * To load the types declared here in an actual project, there are three ways. The easiest one,
 * if your `tsconfig.json` already has a `"types"` array in the `"compilerOptions"` section,
 * is to add `"react/next"` to the `"types"` array.
 *
 * Alternatively, a specific import syntax can to be used from a typescript file.
 * This module does not exist in reality, which is why the {} is important:
 *
 * ```ts
 * import {} from 'react/next'
 * ```
 *
 * It is also possible to include it through a triple-slash reference:
 *
 * ```ts
 * /// &lt;reference types="react/next" /&gt;
 * ```
 *
 * Either the import or the reference only needs to appear once, anywhere in the project.
 */</pre>
<p>让我们试试单子上的第一项。我们将编辑我们的<code>tsconfig.json</code>，并向<code>"compilerOptions"</code>部分添加一个新条目:</p>
<pre class="language-json hljs">    "types": ["react/next", "react-dom/next"]</pre>
<p>如果我们用<code>yarn start</code>重新开始构建，我们现在会看到一个不同的错误:</p>
<blockquote><p><code>Argument of type 'HTMLElement | null' is not assignable to parameter of type 'Element | Document | DocumentFragment | Comment'.<br/> Type 'null' is not assignable to type 'Element | Document | DocumentFragment | Comment'. TS2345</code></p></blockquote>
<p><img data-attachment-id="54031" data-permalink="https://blog.logrocket.com/how-to-use-typescript-with-react-18-alpha/htmlelement-null-error/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/htmlelement-null-error.png" data-orig-size="730,205" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="HTMLElement | null error" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/htmlelement-null-error-300x84.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/htmlelement-null-error.png" decoding="async" class="aligncenter size-full wp-image-54031 jetpack-lazy-image" src="../Images/904073ef0061a2c286f15221fc7473b2.png" alt="TypeScript Throws an Error for the HTMLElement | null Type" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/htmlelement-null-error.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/htmlelement-null-error-300x84.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/06/htmlelement-null-error.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/htmlelement-null-error.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="54031" data-permalink="https://blog.logrocket.com/how-to-use-typescript-with-react-18-alpha/htmlelement-null-error/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/htmlelement-null-error.png" data-orig-size="730,205" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="HTMLElement | null error" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/htmlelement-null-error-300x84.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/htmlelement-null-error.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-54031" src="../Images/904073ef0061a2c286f15221fc7473b2.png" alt="TypeScript Throws an Error for the HTMLElement | null Type" srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/htmlelement-null-error.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/htmlelement-null-error-300x84.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/htmlelement-null-error.png"/></noscript>
<p>现在，这实际上与我们新的 React 类型定义的问题无关。他们很好。这是一个打字稿，上面写着，“不能保证<code>document.getElementById('root')</code>返回不是<code>null</code>的东西。既然我们处于<code>strictNullChecks</code>模式，你需要确保<code>root</code>不为空。”</p>
<p>我们将通过在调用<code>ReactDOM.createRoot</code>之前测试我们是否有一个元素在起作用来处理这个问题:</p>
<pre class="language-diff hljs"><span class="hljs-deletion">-const root = ReactDOM.createRoot(document.getElementById('root'));</span>
<span class="hljs-addition">+const rootElement = document.getElementById('root');
+if (!rootElement) throw new Error('Failed to find the root element');
+const root = ReactDOM.createRoot(rootElement);</span></pre>
<p>经过这些更改，我们有了一个使用 TypeScript React 18 应用程序。尽情享受吧！</p><div class="code-block code-block-21">
<div class="blog-plug inline-plug typescript-plug"><h2><a class="signup" href="https://lp.logrocket.com/blg/typescript-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>:全面了解您的网络和移动应用</h2>
<a href="https://lp.logrocket.com/blg/typescript-signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p>LogRocket 是一个前端应用程序监控解决方案，可以让您回放问题，就像问题发生在您自己的浏览器中一样。LogRocket 不需要猜测错误发生的原因，也不需要向用户询问截图和日志转储，而是让您重放会话以快速了解哪里出错了。它可以与任何应用程序完美配合，不管是什么框架，并且有插件可以记录来自 Redux、Vuex 和@ngrx/store 的额外上下文。</p>
<p>除了记录 Redux 操作和状态，LogRocket 还记录控制台日志、JavaScript 错误、堆栈跟踪、带有头+正文的网络请求/响应、浏览器元数据和自定义日志。它还使用 DOM 来记录页面上的 HTML 和 CSS，甚至为最复杂的单页面和移动应用程序重新创建像素级完美视频。</p>
<a class="signup" href="https://lp.logrocket.com/blg/typescript-signup" target="_blank" rel="noopener noreferrer">Try it for free</a><p>.</p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>