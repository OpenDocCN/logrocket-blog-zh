<html>
<head>
<title>Getting started with startTransition in React 18 - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>React 18 - LogRocket 博客中的 startTransition 入门</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/getting-started-react-18-starttransition/#0001-01-01">https://blog.logrocket.com/getting-started-react-18-starttransition/#0001-01-01</a></blockquote><div><article class="article-post">
<p>React 18 的实验性并发模式的一部分是一个名为<code>startTransition</code>的新功能，它可以防止一个昂贵的 UI 渲染立即执行。</p>
<p>要理解我们为什么需要这个特性，请记住，强制立即完成昂贵的 UI 渲染会阻止较轻和较紧急的 UI 渲染及时进行。这可能会让需要从紧急 UI 呈现中获得即时响应的用户感到沮丧。</p>
<p>紧急 UI 呈现的一个例子是在搜索栏中键入内容。当您键入时，您希望看到您的键入内容，并立即开始搜索。如果应用程序死机，搜索停止，你会感到沮丧。其他昂贵的 UI 渲染会使整个应用陷入困境，包括你的轻量级 UI 渲染应该很快(比如在你输入时看到搜索结果)。</p>
<p>在开发你的 React 应用时，你可以通过<a href="https://blog.logrocket.com/how-and-when-to-debounce-or-throttle-in-react/" target="_blank" rel="noopener">去抖或者节流</a>来避免这个问题。不幸的是，使用去抖动或节流仍然会导致应用程序无响应。</p>
<p><code>startTransition</code>允许您将应用程序中的某些更新标记为非紧急更新，以便在优先处理更紧急的更新时暂停更新。这让你的应用程序感觉更快，并可以减少在你的应用程序中渲染不是严格必要的项目的负担。因此，无论你在渲染什么，你的应用程序仍然在响应用户的输入。</p>
<p>在本文中，我们将学习如何在 React 应用中使用<code>startTransition</code>来延迟非紧急的 UI 更新，以避免阻塞紧急的 UI 更新。有了这个功能，你可以立刻将反应缓慢的应用程序转换成反应灵敏的应用程序。</p>
<p>在我们开始之前，请注意 React 18 在撰写本文时仍处于 alpha 版本，因此<code>startTransition</code>还不是稳定版本的一部分。</p>
<h2>React 18 入门</h2>
<p>开始本教程之前，请确保您具备以下条件:</p>
<ul>
<li>React 的工作知识</li>
<li>安装在计算机上的 Node.js</li>
</ul>
<p>让我们首先用 create-react-app 创建一个 React 项目:</p>
<pre class="language-shell hljs">$ npx create-react-app starttransition_demo
</pre>
<p>上面的命令使用 React 的最新稳定版本(版本 17)创建了一个 React 项目。我们需要使用 React 18。进入项目目录并删除<code>node_modules</code>目录:</p>
<pre class="language-shell hljs">$ cd starttransition_demo/

$ rm -rf node_modules
</pre>
<p>在 Windows 上，您必须使用不同的命令来删除目录。删除目录后，编辑<code>package.json</code>。找到这些线:</p>
<pre class="language-json hljs">    "react": "^17.0.2",

    "react-dom": "^17.0.2",
</pre>
<p>然后，将 React 的版本从 17 更改为 alpha:</p>
<pre class="language-json hljs">    "react": "alpha",

    "react-dom": "alpha",
</pre>
<p>最后，用<code>yarn</code>安装库:</p>
<pre class="language-shell hljs">$ yarn install
</pre>
<p>为了确保您已经安装了 React 18，您可以从<code>node_modules</code>目录中检查它，如下所示:</p>
<pre class="language-shell hljs">$ grep version node_modules/react/package.json

  "version": "18.0.0-alpha-6ecad79cc-20211006",
</pre>
<p>在 Windows 上，您可以直接打开文件。</p>
<p>运行服务器以确保您可以运行 React 18 应用程序:</p>
<pre class="language-shell hljs">yarn start
</pre>
<p>在浏览器中打开<a href="http://localhost:3000"> http://localhost:3000 </a>。您应该看到带有旋转 React 徽标的 React 项目的熟悉的默认页面。</p>
<h2>启用并发模式</h2>
<p>默认情况下，我们的 React 项目不支持并发模式。我们需要通过以不同的方式呈现根 React 节点来启用它。</p>
<p>打开<code>src/index.js</code>。您可以看到，我们使用来自<code>ReactDOM</code>的<code>render</code>静态方法来呈现根节点:</p>
<pre class="language-javascript hljs">ReactDOM.render(

  &amp;lt;React.StrictMode&gt;

    &amp;lt;App /&gt;

  &amp;lt;/React.StrictMode&gt;,

  document.getElementById('root')

);
</pre>
<p>要启用并发模式，我们需要首先创建根节点，然后从该实例使用<code>render</code>方法。将上面的行改为下面的行:</p>
<pre class="language-javascript hljs">const container = document.getElementById('root')

const root = ReactDOM.createRoot(container);

root.render(

  &amp;lt;React.StrictMode&gt;

    &amp;lt;App /&gt;

  &amp;lt;/React.StrictMode&gt;

);
</pre>
<p>注意来自<code>ReactDOM</code>的<code>createRoot</code>方法。这将创建一个根节点。</p>
<h2>设置测试环境</h2>
<p>首先，让我们创建一个 React 应用程序，它有一个轻型 UI 渲染和一个昂贵的 UI 渲染。打开<code>src/App.js</code>。您可以看到<code>App</code>函数定义显示了一个 React 标志、一个<code>p</code>标签和一个链接。</p>
<p>用下面的代码替换<code>App</code>函数:</p>
<pre class="language-javascript hljs">function App() {

  const [search_text, setSearchText] = useState("");

  const [search_result, setSearchResult] = useState();

  const handleChange = e =&gt; {

    setSearchText(e.target.value);

  };

  useEffect(() =&gt; {

    if (search_text==="") {

        setSearchResult(null);

    } else {

        const rows = Array.from(Array(5000), (_, index) =&gt; {


              return (


                      &amp;lt;div key={index}&gt;


                    &amp;lt;img src={logo} className="App-logo" alt="logo" /&gt;


                    &amp;lt;div&gt;{index + 1}. {search_text}&amp;lt;/div&gt;


                      &amp;lt;/div&gt;


                );

        });

        const list = &amp;lt;div&gt;{rows}&amp;lt;/div&gt;;

        setSearchResult(list);

    }

  }, [search_text]);

  return (

    &amp;lt;div className="App"&gt;

        &amp;lt;header className="App-header"&gt;

            &amp;lt;div className="SearchEngine"&gt;

                &amp;lt;div className="SearchInput"&gt;

                    &amp;lt;input type="text" value={search_text} onChange={handleChange} /&gt;

                &amp;lt;/div&gt;

                &amp;lt;div className="SearchResult"&gt;

                    {search_result}

                &amp;lt;/div&gt;

            &amp;lt;/div&gt;

        &amp;lt;/header&gt;

    &amp;lt;/div&gt;

  );

}
</pre>
<p>你需要导入<code>useEffect</code>和<code>useState</code>。将这一行放在文件的顶部:</p>
<pre class="language-javascript hljs">import {useState, useEffect } from 'react';
</pre>
<p>这里，我们创建了由两部分组成的应用程序 UI:搜索输入和搜索结果。</p>
<p>因为输入有回调，所以当您在输入上键入文本时，文本作为参数传递给<code>setSearchText</code>，以便使用<code>useState</code>钩子更新<code>search_text</code>的值。然后，搜索结果显示出来。对于这个演示，结果是 5，000 行，每行包含一个旋转的 React 徽标和相同的搜索查询文本。</p>
<p>我们的轻量级即时 UI 呈现是带有文本的搜索输入。当您在搜索输入中键入文本时，文本应该会立即出现。然而，显示 5000 个 React 徽标和搜索文本是一种昂贵的 UI 渲染。</p>
<p>我们来看一个例子；尝试在我们新的 React 应用程序中快速输入“我非常喜欢 React”。当你输入“我”时，应用程序会立即在搜索输入中显示文本“我”。然后它呈现 5000 行。这需要很长时间，这就暴露了我们的渲染问题。React 应用程序无法立即呈现全文。昂贵的 UI 渲染也使得轻量级 UI 渲染变得很慢。</p>
<p>可以在<a href="http://localhost:3000"> http://localhost:3000 </a>的 app 上自己尝试一下。您将看到一个搜索输入。我也给<a href="https://codepen.io/arjunaskykok/pen/XWarryy" target="_blank" rel="noopener">设置了一个演示应用</a>。</p>
<p><img data-attachment-id="73858" data-permalink="https://blog.logrocket.com/getting-started-react-18-starttransition/react-sample-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/React-sample-app.png" data-orig-size="449,892" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React-sample-app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/React-sample-app-151x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/React-sample-app.png" decoding="async" class="size-full wp-image-73858 aligncenter jetpack-lazy-image" src="../Images/b070e62f0a5d653a1d4192193a911fc9.png" alt="Screenshot of sample React app with searchbar that reads &quot;I love React very much&quot;" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/React-sample-app.png 449w, https://blog.logrocket.com/wp-content/uploads/2021/10/React-sample-app-151x300.png 151w" data-lazy-sizes="(max-width: 449px) 100vw, 449px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/React-sample-app.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/React-sample-app.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="73858" data-permalink="https://blog.logrocket.com/getting-started-react-18-starttransition/react-sample-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/React-sample-app.png" data-orig-size="449,892" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React-sample-app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/React-sample-app-151x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/React-sample-app.png" decoding="async" loading="lazy" class="size-full wp-image-73858 aligncenter" src="../Images/b070e62f0a5d653a1d4192193a911fc9.png" alt="Screenshot of sample React app with searchbar that reads &quot;I love React very much&quot;" srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/React-sample-app.png 449w, https://blog.logrocket.com/wp-content/uploads/2021/10/React-sample-app-151x300.png 151w" sizes="(max-width: 449px) 100vw, 449px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/React-sample-app.png"/></noscript>
<p>我们想要的是昂贵的 UI 渲染在加载时不要把轻量级的 UI 渲染拖到烂泥里。应该把它们分开，这就是<code>startTransition</code>的用武之地。</p>
<h2>使用<code>startTransition</code></h2>
<p>让我们看看导入<code>startTransition</code>时会发生什么。您的顶行导入应该是这样的:</p>
<pre class="language-javascript hljs">import {useState, useEffect, startTransition} from 'react';
</pre>
<p>然后，在这个函数中包装昂贵的 UI 渲染。将<code>setSearchResult(list)</code>改为下面的代码:</p>
<pre class="language-javascript hljs">      startTransition(() =&gt; {

          setSearchResult(list);

      });
</pre>
<p>现在，您可以再次测试该应用程序。当您在搜索输入中键入内容时，文本会立即呈现。在你停下来之后(或者过了几秒钟)，React 应用程序会呈现搜索结果。</p>
<p>如果您希望在等待昂贵的 UI 渲染完成时在搜索结果上显示一些内容，该怎么办？你可能想要显示一个进度条来给用户即时的反馈，这样他们就知道应用程序正在处理他们的请求。</p>
<p>为此，我们可以使用来自<code>useTransition</code>钩子的<code>isPending</code>变量。</p>
<p>首先，将文件顶部的导入行改为下面的代码:</p>
<pre class="language-javascript hljs">import {useState, useEffect, useTransition} from 'react';
</pre>
<p>将<code>isPending</code>和<code>startTransition</code>从<code>useTransition</code>挂钩中拔出。将下面的代码放在<code>App</code>函数内的第一行:</p>
<pre class="language-javascript hljs">  const [isPending, startTransition] = useTransition();
</pre>
<p>接下来，将<code>&amp;lt;div className="SearchResult"&gt;</code>的内容改为下面的代码:</p>
<pre class="language-javascript hljs">            {isPending &amp;&amp; &amp;lt;div&gt;&amp;lt;br /&gt;&amp;lt;span&gt;Loading...&amp;lt;/span&gt;&amp;lt;/div&gt;}

            {!isPending &amp;&amp; search_result}
</pre>
<p>现在，当您在搜索输入上快速键入文本时，会首先显示加载指示器。</p>
<p><img data-attachment-id="73863" data-permalink="https://blog.logrocket.com/getting-started-react-18-starttransition/sample-react-app-loading/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/Sample-React-app-loading.png" data-orig-size="557,603" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Sample-React-app-loading" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/Sample-React-app-loading-277x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/Sample-React-app-loading.png" decoding="async" class="size-full wp-image-73863 aligncenter jetpack-lazy-image" src="../Images/97d09576112bb5272909a301809f24eb.png" alt="Screenshot of search bar in React app with Loading indicator" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/Sample-React-app-loading.png 557w, https://blog.logrocket.com/wp-content/uploads/2021/10/Sample-React-app-loading-277x300.png 277w" data-lazy-sizes="(max-width: 557px) 100vw, 557px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/Sample-React-app-loading.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/Sample-React-app-loading.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="73863" data-permalink="https://blog.logrocket.com/getting-started-react-18-starttransition/sample-react-app-loading/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/Sample-React-app-loading.png" data-orig-size="557,603" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Sample-React-app-loading" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/Sample-React-app-loading-277x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/Sample-React-app-loading.png" decoding="async" loading="lazy" class="size-full wp-image-73863 aligncenter" src="../Images/97d09576112bb5272909a301809f24eb.png" alt="Screenshot of search bar in React app with Loading indicator" srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/Sample-React-app-loading.png 557w, https://blog.logrocket.com/wp-content/uploads/2021/10/Sample-React-app-loading-277x300.png 277w" sizes="(max-width: 557px) 100vw, 557px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/Sample-React-app-loading.png"/></noscript>
<h2>结论</h2>
<p>有了<code>startTransition</code>，你可以通过分离即时 UI 渲染和非紧急 UI 渲染，让 React app 变得平滑而有反应。通过将所有非紧急的 UI 呈现放在<code>startTransition</code>方法中，您的应用程序使用起来会更令人满意。</p>
<p>我们还介绍了如何使用<code>isPending</code>变量来指示转换的状态，以防您想要向用户提供反馈。</p>
<p>你可以在这里获得<a href="https://github.com/arjunaskykok/starttransition_demo" target="_blank" rel="noopener"> <code>startTransition</code>演示应用</a>的完整代码。你也可以尽情体验应用程序的<a href="https://codepen.io/arjunaskykok/pen/xxrvNMN" target="_blank" rel="noopener">演示。希望这些知识在您构建下一个 React 应用程序时会对您有用。确保应用程序将是流畅的！</a></p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用 LogRocket 消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款 React analytics 解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket 告诉您 React 应用程序中实际影响用户的最具影响力的 bug 和 UX 问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS 异常、前端性能指标和用户交互。然后，LogRocket 使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的 React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试 LogRocket】。</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>