<html>
<head>
<title>A guide to using Convex for state management - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用Convex进行状态管理的指南</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/using-convex-for-state-management/#0001-01-01">https://blog.logrocket.com/using-convex-for-state-management/#0001-01-01</a></blockquote><div><article class="article-post">
<p>像React这样的现代前端框架让开发人员的状态管理变得更加容易，但是使用Convex这样的解决方案进行状态管理会让这变得更加容易。在React中，组件的状态决定了UI的外观，尽管管理应用程序的状态已经变得相对简单，但全局状态的概念仍然是开发人员的一个难题。</p>
<p>在本教程中，我们将使用Convex构建一个用于全局状态管理的全栈Next.js应用程序。我们还将实现凸函数来查询和更新数据。到本教程结束时，我们将已经将最终的应用程序部署到Vercel上——请使用这个<a href="https://github.com/Anshuman71/convex-with-nextjs" target="_blank" rel="noopener"> GitHub库</a>随意跟随本演练。</p>

<h2>什么是凸？</h2>
<p>例如，考虑跟踪金融交易的应用程序，这些应用程序使用所有客户端都可以实时更改和观察的全局状态。这种应用程序很难开发，因为开发人员需要在应用程序之间同步状态，并关注ACID属性。</p>
<p><a href="https://www.convex.dev/" target="_blank" rel="noopener"> Convex </a>旨在通过提供包括数据存储、检索和突变在内的全栈解决方案来解决这一问题，所有这些都内置于用于全局状态管理的SDK中。它的无服务器方法非常高效，是一个高度可扩展的平台。Convex是一个开发者至上的平台，其反应式架构与React很好地结合在一起，SDK另外还支持像<a href="https://docs.convex.dev/using/optimistic-updates" target="_blank" rel="noopener">乐观更新</a>和订阅这样的功能。</p>
<h3 id="prerequisites">先决条件</h3>
<p>您需要Node.js、npm或yarn，以及安装在计算机上的代码编辑器，如VS Code。您还需要一个GitHub帐户来使用Convex。</p>
<h2 id="set-up-a-nextjs-project">建立一个Next.js项目</h2>
<p>该应用程序将允许用户查看现有帖子的列表，并提交新的博客帖子。一篇博客文章将包含标题、正文和作者姓名。</p>
<p>首先，运行以下命令来设置一个新的Next.js项目:</p>
<pre class="language-bash hljs">npx <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="83e0f1e6e2f7e6aeede6fbf7aee2f3f3c3efe2f7e6f0f7">[email protected]</a> convex-example --typescript
</pre>
<p>在代码编辑器中打开项目并更新<code>pages/index.tsx</code>文件以显示一个表单，从而创建一篇博客文章:</p>
<pre class="language-typescript hljs">// pages/index.tsx
import type { NextPage } from 'next'
import Head from 'next/head'
import styles from '../styles/Home.module.css'
import { useCallback, useState } from 'react'

const Home: NextPage = () =&gt; {
  const [author, setAuthor] = useState('')
  const [title, setTitle] = useState('')
  const [body, setBody] = useState('')

  const createPost = async () =&gt; {
    // TODO: create a new post inside database
    console.log({ author, title, body  })
    // reset the inputs after submission
    setAuthor('')
    setBody('')
    setTitle('')
  }

  return (
      &lt;div className={styles.container}&gt;
        &lt;Head&gt;
          &lt;title&gt;Next.js with Convex&lt;/title&gt;
          &lt;meta name="description" content="Generated by create next app" /&gt;
          &lt;link rel="icon" href="/favicon.ico" /&gt;
        &lt;/Head&gt;

        &lt;main className={styles.main}&gt;
          &lt;h1 className={styles.title}&gt;
            Welcome to &lt;a href="https://nextjs.org"&gt;Next.js&lt;/a&gt; with{' '}
            &lt;a href="https://convex.dev"&gt;Convex&lt;/a&gt;
          &lt;/h1&gt;
          &lt;input
              type={'text'}
              value={title}
              placeholder={'Title'}
              className={styles.inputStyles}
              onChange={(event) =&gt; setTitle(event.target.value)}
          /&gt;      
          &lt;input
              type={'text'}
              value={author}
              placeholder={'Author'}
              className={styles.inputStyles}
              onChange={(event) =&gt; setAuthor(event.target.value)}
          /&gt;
          &lt;textarea
              value={body}
              rows={5}
              placeholder={'Post body '}
              className={styles.inputStyles}
              onChange={(event) =&gt; setBody(event.target.value)}
          /&gt;
          &lt;button className={styles.button} onClick={createPost}&gt;
            Create post
          &lt;/button&gt;
        &lt;/main&gt;
      &lt;/div&gt;
  )
}

export default Home
</pre>
<p>将<code>styles/Home.module.css</code>更新如下:</p>
<pre class="language-css hljs">/* styles/Home.module.css */
.container {
  padding: 0 2rem;
  display: flex;
  flex-direction: column;
}

.main {
  padding: 4rem 0;
  flex: 10;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.button {
  font-size: 1rem;
  font-weight: 800;
  cursor: pointer;
  margin: 0.5rem;
  padding: 0.5rem;
  text-decoration: none;
  border: 1px solid #eaeaea;
  border-radius: 10px;
  transition: color 0.15s ease, border-color 0.15s ease;
  width: 200px;
}

.button:hover,
.button:focus,
.button:active {
  color: #0070f3;
  border-color: #0070f3;
}

.inputStyles {
  width: 300px;
  margin: 10px auto;
}
</pre>
<p>运行<code>npm run dev</code>启动应用程序，然后在网络浏览器中打开<code><a href="http://localhost:3000/" rel="nofollow">http://localhost:3000/</a></code>。</p>
<p><img data-attachment-id="133398" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/convex-blog-post-form/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-blog-post-form.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="convex-blog-post-form" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-blog-post-form-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-blog-post-form.png" decoding="async" class="aligncenter wp-image-133398 size-full jetpack-lazy-image" src="../Images/8babcebefb78401b974eea6e8b33d688.png" alt="Convex Blog Post Form" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-blog-post-form.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/convex-blog-post-form-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-blog-post-form.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-blog-post-form.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="133398" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/convex-blog-post-form/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-blog-post-form.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="convex-blog-post-form" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-blog-post-form-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-blog-post-form.png" decoding="async" loading="lazy" class="aligncenter wp-image-133398 size-full" src="../Images/8babcebefb78401b974eea6e8b33d688.png" alt="Convex Blog Post Form" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-blog-post-form.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/convex-blog-post-form-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-blog-post-form.png"/></noscript>
<p>创建新帖子的表单已经准备好了。现在，您必须实现使用Convex保存和读取数据的逻辑。</p>
<h2 id="set-up-convex">设置凸面</h2>
<p>Convex提供了一个可以在项目中使用的JavaScript SDK。</p>
<ol>
<li>运行<code>npm i convex</code>安装凸包</li>
<li>在项目内部，运行<code>npx convex login</code>，这将在浏览器中打开一个页面，使用您的GitHub帐户登录Convex</li>
<li>登录后，运行<code>npx convex init</code>用<code>convex.json</code>和<code>.env.local</code>初始化Convex项目进行配置。该命令还将创建一个<code>convex/</code>目录，以便将函数写入其中</li>
</ol>
<p>(注意:该命令将提示您输入项目名称)</p>
<p>最后，更新<code>pages/_app.tsx</code>以将<code>ConvexProvider</code>添加到完整的应用程序中。<code>ConvexProvider</code>将允许你在应用程序中使用Convex提供的React钩子。</p>
<pre class="language-typescript hljs">// pages/_app.tsx
import '../styles/globals.css'
import type { AppProps } from 'next/app'

import { ConvexProvider, ConvexReactClient } from 'convex/react'
import convexConfig from '../convex.json'
const convex = new ConvexReactClient(convexConfig.origin)

function MyApp({ Component, pageProps }: AppProps) {
  return (
      &lt;ConvexProvider client={convex}&gt;
        &lt;Component {...pageProps} /&gt;
      &lt;/ConvexProvider&gt;
  )
}

export default MyApp
</pre>
<h2 id="add-state-management-using-convex">使用Convex添加状态管理</h2>
<p>随着Convex在项目中的设置，是时候创建一个数据模型，并将前端与数据库连接起来。</p>
<h3 id="define-the-schema">定义模式</h3>
<p>在<code>convex/</code>文件夹中，创建一个新文件<code>schema.ts</code>，为博客文章定义模式。<code>defineTable</code>功能将在凸面内部创建一个<code>posts</code>表格。</p>
<pre class="language-typescript hljs">// convex/schema.ts
import { defineSchema, defineTable, s } from 'convex/schema'

export default defineSchema({
  posts: defineTable({
    title: s.string(),
    author: s.string(),
    body: s.string(),
  }),
})
</pre>
<p>现在，运行<code>npx convex codegen</code>为<code>posts</code>模式生成类型定义，以改进代码完成。这将允许你引用文章为<code>Document&lt;'posts'&gt;</code>。</p>
<h3 id="implement-convex-functions">实现凸函数</h3>
<p>凸函数允许前端以两种方式与数据库通信:查询和变异。</p>
<p>这些函数是从<code>convex</code>目录中的文件导出的，它们被部署为无服务器函数来执行数据库交互。</p>
<p>前端需要读取可用的帖子。为此，创建一个新文件；<code>convex/getPosts.ts</code>。该文件导出一个查询函数，从数据库中返回所有可用的<code>posts</code>。</p>
<pre class="language-typescript hljs">// convex/getPosts.ts
import { query } from './_generated/server'
import { Document } from './_generated/dataModel'

export default query(async ({ db }): Promise&lt;Document&lt;'posts'&gt;[]&gt; =&gt; {
  return await db.table('posts').collect()
})
</pre>
<p>在<code>convex/</code>文件夹中，创建一个名为<code>addPost.ts</code>的新文件。这个文件导出了一个变异函数，允许用户向数据库中添加新的帖子。该函数接受一个<code>post</code>对象作为参数。</p>
<pre class="language-typescript hljs">// convex/addPost.ts
import { mutation } from './_generated/server'

export default mutation(
  async (
    { db },
    post: { author: string; body: string; title: string }
  ) =&gt; {
    await db.insert('posts', post)
  }
)
</pre>
<p>运行<code>npx convex push</code>生成类型定义并将函数部署到Convex。</p>
<h3 id="connect-the-component-with-convex-functions">用凸函数连接组件</h3>
<p>Convex提供了<code>useQuery</code>和<code>useMutation</code>钩子来使用上面实现的函数与数据库交互。</p>
<p>将<code>useMutation</code>钩子添加到<code>Home</code>组件中，并更新<code>createPost</code>函数，用post数据调用<code>addPost</code>变异函数。</p>
<pre class="language-typescript hljs">// pages/index.tsx
import type { NextPage } from 'next'
import Head from 'next/head'
import styles from '../styles/Home.module.css'
import { useCallback, useState } from 'react'
import {useMutation} from "../convex/_generated/react";

const Home: NextPage = () =&gt; {
  const addPost = useMutation('addPost')

  const [author, setAuthor] = useState('')
  const [title, setTitle] = useState('')
  const [body, setBody] = useState('')

  const createPost = async () =&gt; {
    await addPost({ body, author, title});
    // reset the inputs after submission
    setAuthor('')
    setBody('')
    setTitle('')
  }

  return (
      // return the component
  )
}

export default Home
</pre>
<p>添加<code>useQuery</code>钩子从数据库中获取并显示文章列表。在加载数据时,<code>useQuery</code>钩子将返回<code>undefined</code>,然后返回一个帖子列表。</p>
<pre class="language-typescript hljs">// pages/index.tsx
import type { NextPage } from 'next'
import Head from 'next/head'
import styles from '../styles/Home.module.css'
import { useCallback, useState } from 'react'
import {useMutation, useQuery} from "../convex/_generated/react";

const Home: NextPage = () =&gt; {
  const posts = useQuery('getPosts')
  const addPost = useMutation('addPost')

  const [author, setAuthor] = useState('')
  const [title, setTitle] = useState('')
  const [body, setBody] = useState('')

  const createPost = async () =&gt; {
    await addPost({ body, author, title});
    // reset the inputs after submission
    setAuthor('')
    setBody('')
    setTitle('')
  }

  return (
      &lt;div className={styles.container}&gt;
        &lt;Head&gt;
          &lt;title&gt;Next.js with Convex&lt;/title&gt;
          &lt;meta name="description" content="Generated by create next app" /&gt;
          &lt;link rel="icon" href="/favicon.ico" /&gt;
        &lt;/Head&gt;

        &lt;main className={styles.main}&gt;
          &lt;h1 className={styles.title}&gt;
            Welcome to &lt;a href="https://nextjs.org"&gt;Next.js&lt;/a&gt; with{' '}
            &lt;a href="https://convex.dev"&gt;Convex&lt;/a&gt;
          &lt;/h1&gt;
          {posts ? (
              &lt;&gt;
                &lt;p className={styles.description}&gt;
                  {'Total posts:'} {posts.length}
                &lt;/p&gt;

                &lt;ul&gt;
                  {posts.map((post) =&gt; (
                      &lt;li key={post._id.toString()}&gt;{post.title}&lt;/li&gt;
                  ))}
                &lt;/ul&gt;
              &lt;/&gt;
          ) : (
              'Loading posts...'
          )}
          &lt;input
              type={'text'}
              value={title}
              placeholder={'Title'}
              className={styles.inputStyles}
              onChange={(event) =&gt; setTitle(event.target.value)}
          /&gt;      
          &lt;input
              type={'text'}
              value={author}
              placeholder={'Author'}
              className={styles.inputStyles}
              onChange={(event) =&gt; setAuthor(event.target.value)}
          /&gt;
          &lt;textarea
              value={body}
              rows={5}
              placeholder={'Post body '}
              className={styles.inputStyles}
              onChange={(event) =&gt; setBody(event.target.value)}
          /&gt;
          &lt;button className={styles.button} onClick={createPost}&gt;
            Create post
          &lt;/button&gt;
        &lt;/main&gt;
      &lt;/div&gt;
  )
}

export default Home
</pre>
<p>你的申请已经准备好了！打开<code><a href="http://localhost:3000" rel="nofollow">http://localhost:3000</a></code>查看它的运行情况:</p>
<p><img data-attachment-id="133396" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/convex-nextjs-create-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-nextjs-create-app.gif" data-orig-size="730,410" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="convex-nextjs-create-app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-nextjs-create-app-300x168.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-nextjs-create-app.gif" decoding="async" class="aligncenter wp-image-133396 size-full jetpack-lazy-image" src="../Images/04a2fc6e597f53cd5a190f995fe919f2.png" alt="Convex Next.js Create App" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-nextjs-create-app.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-nextjs-create-app.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="133396" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/convex-nextjs-create-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-nextjs-create-app.gif" data-orig-size="730,410" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="convex-nextjs-create-app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-nextjs-create-app-300x168.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-nextjs-create-app.gif" decoding="async" loading="lazy" class="aligncenter wp-image-133396 size-full" src="../Images/04a2fc6e597f53cd5a190f995fe919f2.png" alt="Convex Next.js Create App" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-nextjs-create-app.gif"/></noscript>
<p>您会注意到，每当您创建新帖子时，帖子列表都会自动更新。</p>
<p>由于凸全局状态的端到端反应性，这种行为是可能的；<em>每当数据发生变化时，使用查询的每个</em>组件都会得到更新。</p>
<h3 id="managing-convex">管理凸面</h3>
<p>运行<code>npx convex dashboard</code>登录<a href="https://dashboard.convex.dev/" target="_blank" rel="noopener">凸面仪表盘</a>管理您的应用数据，查看日志，并查看功能执行和读/写的指标。</p>
<p><img data-attachment-id="133400" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/convex-dashboard/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard.png" data-orig-size="730,382" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="convex-dashboard" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard-300x157.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard.png" decoding="async" class="aligncenter wp-image-133400 size-full jetpack-lazy-image" src="../Images/e5e030c47770344fdb4d15b2a3a6c326.png" alt="Convex Dashboard" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard-300x157.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="133400" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/convex-dashboard/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard.png" data-orig-size="730,382" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="convex-dashboard" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard-300x157.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard.png" decoding="async" loading="lazy" class="aligncenter wp-image-133400 size-full" src="../Images/e5e030c47770344fdb4d15b2a3a6c326.png" alt="Convex Dashboard" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard-300x157.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard.png"/></noscript>
<h2 id="secure-the-application">保护应用程序</h2>
<p>保持应用程序数据的安全至关重要，而Convex简化了使用身份提供者保护您的数据。Convex自带对Auth0的一流支持，您可以立即设置它。</p>
<h3 id="create-an-auth0-application">创建Auth0应用程序</h3>
<p>登录到您的Auth0仪表板并创建一个新的单页Web应用程序。如果您还没有帐户，您可以在Auth0上注册一个免费帐户。</p>
<p><img data-attachment-id="133402" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/create-auth0-application/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/create-auth0-application.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="create-auth0-application" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/create-auth0-application-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/create-auth0-application.png" decoding="async" class="aligncenter wp-image-133402 size-full jetpack-lazy-image" src="../Images/c439aabb886f8ca1b25e5baa70e38c7c.png" alt="Create Auth0 Application" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/create-auth0-application.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/create-auth0-application-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/create-auth0-application.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/create-auth0-application.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="133402" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/create-auth0-application/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/create-auth0-application.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="create-auth0-application" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/create-auth0-application-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/create-auth0-application.png" decoding="async" loading="lazy" class="aligncenter wp-image-133402 size-full" src="../Images/c439aabb886f8ca1b25e5baa70e38c7c.png" alt="Create Auth0 Application" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/create-auth0-application.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/create-auth0-application-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/create-auth0-application.png"/></noscript>
<p>从这个新应用程序的设置页面复制域和客户端ID，并保存它们以备后用。</p>
<p><img data-attachment-id="133405" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/copy-client-id-domain/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-client-id-domain.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="copy-client-id-domain" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-client-id-domain-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-client-id-domain.png" decoding="async" class="aligncenter wp-image-133405 size-full jetpack-lazy-image" src="../Images/a59640bfe5a88f890c3423d92f7d8a14.png" alt="Copy Client ID Domain" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-client-id-domain.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/copy-client-id-domain-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-client-id-domain.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-client-id-domain.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="133405" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/copy-client-id-domain/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-client-id-domain.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="copy-client-id-domain" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-client-id-domain-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-client-id-domain.png" decoding="async" loading="lazy" class="aligncenter wp-image-133405 size-full" src="../Images/a59640bfe5a88f890c3423d92f7d8a14.png" alt="Copy Client ID Domain" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-client-id-domain.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/copy-client-id-domain-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-client-id-domain.png"/></noscript>
<p>在应用程序设置页面中，将<code><a href="http://localhost:3000" rel="nofollow">http://localhost:3000</a></code>添加到“允许的回拨URL”字段，如下所示。这将使<code><a href="http://localhost:3000" rel="nofollow">http://localhost:3000</a></code>能够在开发期间使用Auth0进行登录。</p>
<p><img data-attachment-id="133407" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/add-local-host-id/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/add-local-host-id.png" data-orig-size="730,381" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="add-local-host-id" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/add-local-host-id-300x157.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/add-local-host-id.png" decoding="async" class="aligncenter wp-image-133407 size-full jetpack-lazy-image" src="../Images/7c5cd6a206e727c879e004a1215ae263.png" alt="Add Local Host ID" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/add-local-host-id.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/add-local-host-id-300x157.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/add-local-host-id.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/add-local-host-id.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="133407" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/add-local-host-id/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/add-local-host-id.png" data-orig-size="730,381" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="add-local-host-id" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/add-local-host-id-300x157.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/add-local-host-id.png" decoding="async" loading="lazy" class="aligncenter wp-image-133407 size-full" src="../Images/7c5cd6a206e727c879e004a1215ae263.png" alt="Add Local Host ID" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/add-local-host-id.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/add-local-host-id-300x157.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/add-local-host-id.png"/></noscript>
<h3 id="set-up-auth0">设置Auth0</h3>
<p>首先运行<code>npm i @auth0/auth0-react</code>在项目中安装Auth0。</p>
<p>然后，运行<code>npx convex auth add</code>将Auth0作为身份提供者添加到Convex。该命令将提示您输入之前复制的域和客户端ID。</p>
<p>在项目的根目录下创建一个名为<code>components/</code>的新文件夹，并为登录组件添加一个名为<code>Login.tsx</code>的新文件，该组件有一个提示用户登录的按钮。</p>
<pre class="language-typescript hljs">// components/Login.tsx
import { useAuth0 } from '@auth0/auth0-react'

export function Login() {
  const { isLoading, loginWithRedirect } = useAuth0()
  if (isLoading) {
    return &lt;button className="btn btn-primary"&gt;Loading...&lt;/button&gt;
  }
  return (
    &lt;main className="py-4"&gt;
      &lt;h1 className="text-center"&gt;Convex Chat&lt;/h1&gt;
      &lt;div className="text-center"&gt;
        &lt;span&gt;
          &lt;button className="btn btn-primary" onClick={loginWithRedirect}&gt;
            Log in
          &lt;/button&gt;
        &lt;/span&gt;
      &lt;/div&gt;
    &lt;/main&gt;
  )
}
</pre>
<p>更新<code>pages/_app.tsx</code>，用<code>ConvexProviderWithAuth0</code>替换<code>ConvexProvider</code>。</p>
<pre class="language-typescript hljs">import '../styles/globals.css'
import { ConvexProviderWithAuth0 } from 'convex/react-auth0'
import { ConvexReactClient } from 'convex/react'
import convexConfig from '../convex.json'
import { AppProps } from 'next/app'
import { Login } from '../components/Login'

const convex = new ConvexReactClient(convexConfig.origin)
const authInfo = convexConfig.authInfo[0]

function MyApp({ Component, pageProps }: AppProps) {
    return (
        &lt;ConvexProviderWithAuth0
            client={convex}
            authInfo={authInfo}
            loggedOut={&lt;Login /&gt;}
        &gt;
            &lt;Component {...pageProps} /&gt;
        &lt;/ConvexProviderWithAuth0&gt;
    )
}

export default MyApp
</pre>
<p>现在，当您打开应用程序<code><a href="http://localhost:3000" rel="nofollow">http://localhost:3000</a></code>时，您将看到一个登录按钮，而不是post表单。</p>
<p><img data-attachment-id="133409" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/login-with-auth0/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/login-with-auth0.png" data-orig-size="730,604" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="login-with-auth0" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/login-with-auth0-300x248.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/login-with-auth0.png" decoding="async" class="aligncenter wp-image-133409 size-full jetpack-lazy-image" src="../Images/5ba7be2f3337eef793292391666df4a2.png" alt="Login With Auth0" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/login-with-auth0.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/login-with-auth0-300x248.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/login-with-auth0.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/login-with-auth0.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="133409" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/login-with-auth0/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/login-with-auth0.png" data-orig-size="730,604" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="login-with-auth0" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/login-with-auth0-300x248.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/login-with-auth0.png" decoding="async" loading="lazy" class="aligncenter wp-image-133409 size-full" src="../Images/5ba7be2f3337eef793292391666df4a2.png" alt="Login With Auth0" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/login-with-auth0.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/login-with-auth0-300x248.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/login-with-auth0.png"/></noscript>
<h3 id="integrate-auth0-with-convex">将Auth0与凸面整合</h3>
<p>既然已经配置了Auth0，就可以保护变异函数了。<code>mutation</code>函数提供认证信息作为<code>auth</code>对象。<code>addPost</code>变异现在将拒绝任何未经认证的请求。</p>
<pre class="language-typescript hljs">// convex/addPost.ts
import { mutation } from './_generated/server'

export default mutation(
    async (
        { db, auth },
        post: { author: string; body: string; title: string }
    ) =&gt; {
      const identity = await auth.getUserIdentity()
      if (!identity) {
        throw new Error('Called addPosts without authentication present!')
      }
      await db.insert('posts', post)
    }
)
</pre>
<p>您还可以更新前端的代码，将登录用户名用作作者字段:</p>
<pre class="language-typescript hljs">// pages/index.tsx
import type { NextPage } from 'next'
import Head from 'next/head'
import styles from '../styles/Home.module.css'
import { useCallback, useState } from 'react'
import {useMutation, useQuery} from "../convex/_generated/react";
import {useAuth0} from "@auth0/auth0-react";

const Home: NextPage = () =&gt; {
  const {user} = useAuth0()
  const posts = useQuery('getPosts')
  const addPost = useMutation('addPost')

  const [title, setTitle] = useState('')
  const [body, setBody] = useState('')

  const createPost = async () =&gt; {
    if(user?.name) {
      await addPost({ body, author: user.name, title});
    }
    // reset the inputs after submission
    setBody('')
    setTitle('')
  }

  return (
      &lt;div className={styles.container}&gt;
        &lt;Head&gt;
          &lt;title&gt;Next.js with Convex&lt;/title&gt;
          &lt;meta name="description" content="Generated by create next app" /&gt;
          &lt;link rel="icon" href="/favicon.ico" /&gt;
        &lt;/Head&gt;

        &lt;main className={styles.main}&gt;
          &lt;h1 className={styles.title}&gt;
            Welcome to &lt;a href="https://nextjs.org"&gt;Next.js&lt;/a&gt; with{' '}
            &lt;a href="https://convex.dev"&gt;Convex&lt;/a&gt;
          &lt;/h1&gt;
          {posts ? (
              &lt;&gt;
                &lt;p className={styles.description}&gt;
                  {'Total posts:'} {posts.length}
                &lt;/p&gt;

                &lt;ul&gt;
                  {posts.map((post) =&gt; (
                      &lt;li key={post._id.toString()}&gt;{post.title}&lt;/li&gt;
                  ))}
                &lt;/ul&gt;
              &lt;/&gt;
          ) : (
              'Loading posts...'
          )}
          &lt;input
              type={'text'}
              value={title}
              placeholder={'Title'}
              className={styles.inputStyles}
              onChange={(event) =&gt; setTitle(event.target.value)}
          /&gt;
          &lt;textarea
              value={body}
              rows={5}
              placeholder={'Post body '}
              className={styles.inputStyles}
              onChange={(event) =&gt; setBody(event.target.value)}
          /&gt;
          &lt;button className={styles.button} onClick={createPost}&gt;
            Create post
          &lt;/button&gt;
        &lt;/main&gt;
      &lt;/div&gt;
  )
}

export default Home
</pre>
<h2 id="deploy-to-vercel">部署到Vercel</h2>
<p>要部署应用程序，将您的代码(包括<code>convex.json</code>)推送到GitHub上的一个存储库中，并将其链接到您的<a href="https://vercel.com/new" target="_blank" rel="noopener"> Vercel帐户</a>:</p>
<p><img data-attachment-id="133411" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/deploy-to-vercel/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/deploy-to-vercel.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="deploy-to-vercel" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/deploy-to-vercel-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/deploy-to-vercel.png" decoding="async" class="aligncenter wp-image-133411 size-full jetpack-lazy-image" src="../Images/91b6a4bf2f2422fec04d90d7db6ba712.png" alt="Deploy To Vercel" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/deploy-to-vercel.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/deploy-to-vercel-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/deploy-to-vercel.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/deploy-to-vercel.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="133411" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/deploy-to-vercel/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/deploy-to-vercel.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="deploy-to-vercel" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/deploy-to-vercel-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/deploy-to-vercel.png" decoding="async" loading="lazy" class="aligncenter wp-image-133411 size-full" src="../Images/91b6a4bf2f2422fec04d90d7db6ba712.png" alt="Deploy To Vercel" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/deploy-to-vercel.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/deploy-to-vercel-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/deploy-to-vercel.png"/></noscript>
<p>用<code>npx convex push &amp;&amp; next build</code>替换build命令，在部署时将最新的函数推送到Convex，并从<code>.env.local</code>中添加<code>CONVEX_ADMIN_KEY</code>环境变量:</p>
<p><img data-attachment-id="133413" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/update-deploy-settings/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/update-deploy-settings.png" data-orig-size="730,631" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="update-deploy-settings" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/update-deploy-settings-300x259.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/update-deploy-settings.png" decoding="async" class="aligncenter wp-image-133413 size-full jetpack-lazy-image" src="../Images/1d551a2d324405d6e52b11b5e56b2d66.png" alt="Update Deploy Settings" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/update-deploy-settings.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/update-deploy-settings-300x259.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/update-deploy-settings.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/update-deploy-settings.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="133413" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/update-deploy-settings/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/update-deploy-settings.png" data-orig-size="730,631" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="update-deploy-settings" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/update-deploy-settings-300x259.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/update-deploy-settings.png" decoding="async" loading="lazy" class="aligncenter wp-image-133413 size-full" src="../Images/1d551a2d324405d6e52b11b5e56b2d66.png" alt="Update Deploy Settings" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/update-deploy-settings.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/update-deploy-settings-300x259.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/update-deploy-settings.png"/></noscript>
<p>部署应用程序后，复制部署URL ( <code>.vercel.app</code>):</p>
<p><img data-attachment-id="133415" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/copy-vercel-deployment-url/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-vercel-deployment-url.png" data-orig-size="730,527" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="copy-vercel-deployment-url" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-vercel-deployment-url-300x217.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-vercel-deployment-url.png" decoding="async" class="aligncenter wp-image-133415 size-full jetpack-lazy-image" src="../Images/54982c1a8ae89b522435d5cfd4d9448b.png" alt="Copy Vercel Deployment" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-vercel-deployment-url.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/copy-vercel-deployment-url-300x217.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-vercel-deployment-url.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-vercel-deployment-url.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="133415" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/copy-vercel-deployment-url/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-vercel-deployment-url.png" data-orig-size="730,527" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="copy-vercel-deployment-url" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-vercel-deployment-url-300x217.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-vercel-deployment-url.png" decoding="async" loading="lazy" class="aligncenter wp-image-133415 size-full" src="../Images/54982c1a8ae89b522435d5cfd4d9448b.png" alt="Copy Vercel Deployment" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-vercel-deployment-url.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/copy-vercel-deployment-url-300x217.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/copy-vercel-deployment-url.png"/></noscript>
<p>将该URL添加到Auth0应用程序设置中的<code><a href="http://localhost:3000" rel="nofollow">http://localhost:3000</a></code>旁边的允许回调URL列表中。</p>
<p><img data-attachment-id="133417" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/convex-dashboard-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard-1.png" data-orig-size="730,382" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="convex-dashboard" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard-1-300x157.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard-1.png" decoding="async" class="aligncenter wp-image-133417 size-full jetpack-lazy-image" src="../Images/6b81f7fe3bc468031251a5e96dc6c90c.png" alt="Convex Dashboard" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard-1-300x157.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="133417" data-permalink="https://blog.logrocket.com/using-convex-for-state-management/attachment/convex-dashboard-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard-1.png" data-orig-size="730,382" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="convex-dashboard" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard-1-300x157.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard-1.png" decoding="async" loading="lazy" class="aligncenter wp-image-133417 size-full" src="../Images/6b81f7fe3bc468031251a5e96dc6c90c.png" alt="Convex Dashboard" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard-1-300x157.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/convex-dashboard-1.png"/></noscript>
<h2 id="conclusion">结论</h2>
<p>您的应用程序现在部署在Vercel上。在本教程中，我们学习了全局状态管理，以及如何使用Convex部署带有状态管理的Next.js应用程序。</p>
<p>我们还学习了如何使用Auth0保护应用程序，并将其部署到Vercel。您可以扩展上面的应用程序，使用像<a href="https://docs.convex.dev/using/optimistic-updates" target="_blank" rel="noopener">乐观更新</a>和<a href="https://docs.convex.dev/using/indexes" target="_blank" rel="noopener">索引</a>这样的高级特性来使它更快。</p>
<p>你可以今天免费试用Convex，并在他们的文档中阅读更多关于使用它的信息。</p><div class="code-block code-block-30">
<div class="blog-plug inline-plug next-plug"><h2><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank"> LogRocket </a>:全面了解生产Next.js应用</h2><p>调试下一个应用程序可能会很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪状态、自动显示JavaScript错误、跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-lazy-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/></noscript></a><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><p>LogRocket 就像是网络和移动应用的DVR，记录下你的Next.js应用上发生的一切。您可以汇总并报告问题发生时应用程序的状态，而不是猜测问题发生的原因。LogRocket还可以监控应用程序的性能，报告客户端CPU负载、客户端内存使用等指标。</p><p>LogRocket Redux中间件包为您的用户会话增加了一层额外的可见性。LogRocket记录Redux存储中的所有操作和状态。</p><p>让您调试Next.js应用的方式现代化— <a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>