<html>
<head>
<title>Exploring the iOS Live Activities API </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>探索iOS实时活动API</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/exploring-ios-live-activities-api/#0001-01-01">https://blog.logrocket.com/exploring-ios-live-activities-api/#0001-01-01</a></blockquote><div><article class="article-post">
<p>在iOS 16.1中，苹果引入了新的实时活动功能，互动通知在锁定屏幕上提供实时更新。对于iPhone 14 Pro和Pro Max，该功能还扩展到了动态岛(Dynamic Island)，这是一个位于屏幕顶部的药丸形状的切口，可以显示提醒和通知，并根据内容动态改变形状和大小。</p>
<p>想象一下，在不连续打开应用程序的情况下，在你的锁定屏幕上跟踪你的食物交付进度，你的锻炼，甚至你股票的当前位置。多酷多方便啊！</p>
<p>在本文中，我们将探索实时活动的优势以及用于显示和处理实时活动的ActivityKit框架。在本文的演示部分，我们将展示如何向一个简单的股票跟踪应用程序添加实时活动，以在锁定屏幕和动态岛中显示实时信息。</p>
<p>好了，让我们来看看如何在你的应用程序中加入现场活动！</p>
<p><em>向前跳转:</em></p>

<h2 id="advantages-of-live-activities">现场活动的优势</h2>
<p>主屏窗口部件的最大问题之一是它们不显示实际的实时更新。最接近的是有一分钟延迟的更新，这有时可以被系统包含。</p>
<p>但是，通过实时活动，您可以在锁定屏幕上显示实时更新。这对于需要显示时间关键信息的应用程序很有帮助，如加密应用程序中的正在进行的交易，食品交付应用程序中的进度跟踪，或真人游戏的比分。</p>
<p>使用iPhone 14 Pro和Pro Max，您可以使用实时活动在主屏幕的动态岛部分显示实时更新。点击动态岛中的实时活动将启动您的应用程序，同时按住动态岛将显示一个包含更多描述性内容的扩展视图。</p>

<p>当WidgetKit框架首次引入时，它提供了两种类型的配置:<code>StaticConfiguration</code>和<code>IntentConfiguration</code>。</p>
<p>对于实时活动，WidgetKit现在提供了第三种类型的配置，<code>ActivityConfiguration</code>:</p>
<pre class="language-swift hljs">struct ActivityConfiguration&lt;Attributes&gt;: WidgetConfiguration where Attributes: ActivityAttributes
</pre>
<p>作为一个例子，下面是如何创建一个<code>ActivityConfiguration</code>，为它提供上下文，并将其传递给一个活动的视图:</p>
<pre class="language-swift hljs">struct TradinzaLiveActivity: Widget {
  var body: some WidgetConfiguration {
    ActivityConfiguration(for: StockTradingAttributes.self) { context in
      CurrentTradeView(context: context)
        .padding()
    }
  }
}
</pre>
<p>接下来，让我们探索ActivityKit，看看如何维护一个实时活动的生命周期。</p>
<h2 id="activitykit">活动工具包</h2>
<p>Apple已经提供了ActivityKit框架，使开发人员能够创建实时活动。这个框架只适用于iOS 16.1+的iPhones，允许你在锁屏或动态岛中将应用程序的实时更新作为实时活动进行分享。</p>
<p>为了创建实时活动的UI和表示层，您将分别使用SwiftUI和WidgetKit。ActivityKit将用于开始、更新和结束活动。</p>
<h2 id="demo-live-activities-sample-project">演示:现场活动示例项目</h2>
<p>在本文中，我们将使用一个示例应用程序Tradinza，它支持在一个名为Bow的虚拟股票交易所买卖股票。Tradinza有许多上市股票可以在当天买卖:</p>
<p><img data-attachment-id="141753" data-permalink="https://blog.logrocket.com/exploring-ios-live-activities-api/attachment/live-activities-sample-ios-app-tradinza/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activities-sample-ios-app-tradinza.png" data-orig-size="720,405" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Live activities sample iOS sample app Tradinza" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activities-sample-ios-app-tradinza-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activities-sample-ios-app-tradinza.png" decoding="async" class="aligncenter wp-image-141753 size-full jetpack-lazy-image" src="../Images/94cede631aa40e2d0cf717d2d492df5e.png" alt="Live Activities Sample iOS Sample App Tradinza" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activities-sample-ios-app-tradinza.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/11/live-activities-sample-ios-app-tradinza-300x169.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activities-sample-ios-app-tradinza.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activities-sample-ios-app-tradinza.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="141753" data-permalink="https://blog.logrocket.com/exploring-ios-live-activities-api/attachment/live-activities-sample-ios-app-tradinza/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activities-sample-ios-app-tradinza.png" data-orig-size="720,405" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Live activities sample iOS sample app Tradinza" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activities-sample-ios-app-tradinza-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activities-sample-ios-app-tradinza.png" decoding="async" loading="lazy" class="aligncenter wp-image-141753 size-full" src="../Images/94cede631aa40e2d0cf717d2d492df5e.png" alt="Live Activities Sample iOS Sample App Tradinza" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activities-sample-ios-app-tradinza.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/11/live-activities-sample-ios-app-tradinza-300x169.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activities-sample-ios-app-tradinza.png"/></noscript>
<p>为了跟踪交易中当前的实时头寸，我们将演示如何将实时活动<em> <em/> </em>添加到锁屏和动态岛中。</p>
<p>Tradinza应用程序包含一个用于定义股票的<code>Stock</code>结构，并有一些样本股票:</p>
<pre class="language-swift hljs">struct Stock: Identifiable, Codable, Equatable, Hashable {
  var id = UUID()
  var name: String
  var price: Double
  var date = Date()
}

extension Stock {
  var maximumPrice: Double {
    price * 1.2
  }

  var minimumPrice: Double {
    price * 0.8
  }
}

extension Stock {
  static let stocks = [
    Stock(name: "Banana", price: 138.20),
    Stock(name: "TapeBook", price: 135.68),
    Stock(name: "Ramalon", price: 113.00),
    Stock(name: "Boogle", price: 95.65),
    Stock(name: "MacroHard", price: 232.90),
    Stock(name: "BetFlex", price: 235.44),
    Stock(name: "Soutily", price: 86.30)
  ]
}
</pre>
<h3 id="creating-the-attributes">创建<code>Attributes</code></h3>
<p>作为ActivityKit框架的一部分，Apple提供了一个<code>Activity</code>对象来管理开始、更新和结束实时活动的功能。<code>Activity</code>对象负责帮助实时活动的生命周期:</p>
<pre class="language-swift hljs">class Activity&lt;Attributes&gt; where Attributes: ActivityAttributes
</pre>
<p>使用<code>ActivityAttributes</code>协议描述实时活动的内容。该协议有一个必需的关联类型<code>ContentState</code>，必须在符合该协议的同时实现。<code>ContentState</code>类型描述了实时活动的动态内容。</p>
<p>这些属性有两个特性。一个属性保持静态，在整个实时活动中不会改变。另一个属性是动态的，可以在整个实时活动中不断变化。</p>
<p>在Tradinza应用程序中，当前交易具有静态属性，例如股票及其数量(为了示例的简单性，我们将保持数量不变)。它还具有动态内容，例如当前价格、交易状态(即<code>ongoing</code>或<code>ended</code>)以及交易的最终利润或损失:</p>
<pre class="language-swift hljs">struct StockTradingAttributes: ActivityAttributes {
  enum TradeState: Codable {
    case ongoing
    case ended
  }

  public struct ContentState: Codable, Hashable {
    var position: Double
    var currentPrice: Double
    var tradeState: TradeState
  }

  var stock: Stock
  var quantity: Int
}
</pre>
<h3 id="starting-an-activity">开始一个<code>Activity</code></h3>
<p>要启动一个活动，首先要通过提供初始状态和属性来请求它。您可以提供从远程推送通知或直接从应用程序启动的令牌:</p>
<pre class="language-swift hljs">static func request(
    attributes: Attributes,
    contentState: Activity&lt;Attributes&gt;.ContentState,
    pushType: PushType? = nil
) throws -&gt; Activity&lt;Attributes&gt;
</pre>
<p>对于股票交易应用程序，我们将提供诸如购买股票的<code>Stock</code>结构和<code>quantity</code>等属性。股票的<code>currentPrice</code>和用户的<code>position</code>都是动态的，在整个实时活动中可能会发生变化；</p>
<pre class="language-swift hljs">Button("Buy") {
  let currentPrice: Double = .random(in: stock.minimumPrice..&lt;stock.maximumPrice)
  let position = (currentPrice - stock.price) * Double(quantity)

  let state = StockTradingAttributes.ContentState(position: position, currentPrice: currentPrice)
  let attributes = StockTradingAttributes(stock: stock, quantity: quantity)

  do {
    activity = try Activity.request(attributes: attributes, contentState: state)
  } catch (let error) {
    print("Error requesting stock trade Live Activity: \(error.localizedDescription).")
  }
}
</pre>
<p>这是<code>Widget</code>代码查找<code>ActivityConfiguration</code>的方式:</p>
<pre class="language-swift hljs">struct TradinzaLiveActivity: Widget {
  var body: some WidgetConfiguration {
    ActivityConfiguration(for: StockTradingAttributes.self) { context in
      CurrentTradeView(context: context)
        .padding()
    } dynamicIsland: { context in
      ///
    }
  }
}
</pre>
<p>当您启动一个<code>Activity</code>时，它使用您在<code>ActivityConfiguration</code>中提供的<code>View</code>。在Tradinza应用程序的例子中，您将实时活动视图放在<code>CurrentTradeView</code>中:</p>
<pre class="language-swift hljs">struct CurrentTradeView: View {
  var context: ActivityViewContext

  var body: some View {
    HStack {
      VStack(alignment: .leading, spacing: 8) {
        Text(context.attributes.stock.name).bold()
          .font(.title2)

        Text("Qty: ") + Text(context.attributes.quantity, format: .number).monospacedDigit()

        Text("Price: ") + Text(context.attributes.stock.price, format: .number).monospacedDigit()
      }

      Spacer()

      VStack(alignment: .trailing, spacing: 8) {
        Text("P&amp;L: ").bold()
          .font(.title2) +
        CurrentTradePAndLView(context: context, font: .title2).body

        Text("SELL")

        Text("LTP: ") + Text(String(format: "%.2f", context.state.currentPrice)).monospacedDigit()
      }
    }
    .foregroundColor(.gray)
    .activityBackgroundTint(Color.white)
    .activitySystemActionForegroundColor(Color.black)
  }
}
</pre>
<p>开始活动并在设备上运行后，您就创建了您的第一个实时活动！<br/> <img data-attachment-id="141764" data-permalink="https://blog.logrocket.com/exploring-ios-live-activities-api/attachment/live-activity-runing-on-ios-device/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activity-runing-on-ios-device.png" data-orig-size="720,405" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Live activity running on iOS device" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activity-runing-on-ios-device-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activity-runing-on-ios-device.png" decoding="async" class="aligncenter wp-image-141764 size-full jetpack-lazy-image" src="../Images/e02ade6dfc2c0063f6e5145812b900fa.png" alt="Live Activity Running on iOS Device" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activity-runing-on-ios-device.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/11/live-activity-runing-on-ios-device-300x169.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activity-runing-on-ios-device.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activity-runing-on-ios-device.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="141764" data-permalink="https://blog.logrocket.com/exploring-ios-live-activities-api/attachment/live-activity-runing-on-ios-device/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activity-runing-on-ios-device.png" data-orig-size="720,405" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Live activity running on iOS device" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activity-runing-on-ios-device-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activity-runing-on-ios-device.png" decoding="async" loading="lazy" class="aligncenter wp-image-141764 size-full" src="../Images/e02ade6dfc2c0063f6e5145812b900fa.png" alt="Live Activity Running on iOS Device" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activity-runing-on-ios-device.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/11/live-activity-runing-on-ios-device-300x169.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/live-activity-runing-on-ios-device.png"/></noscript>
<h3 id="updating-an-activity">更新一个<code>Activity</code></h3>
<p>您可以使用更新方法更新<code>Activity</code>:</p>
<pre class="language-swift hljs">func update(using contentState: Activity&lt;Attributes&gt;.ContentState) async
</pre>
<p>您还可以通过关于实时活动的更新内容的通知来提醒用户。</p>
<pre class="language-swift hljs">func update(
    using contentState: Activity&lt;Attributes&gt;.ContentState,
    alertConfiguration: AlertConfiguration? = nil
) async
</pre>
<p>股票应用程序每秒都会更新来自证券交易所的新数据。要用最新的价格和位置更新实时活动，请使用<code>Activity.update(using:)</code>方法:</p>
<pre class="language-swift hljs">let currentPrice: Double = .random(in: stock.minimumPrice..&lt;stock.maximumPrice)
let position = (currentPrice - stock.price) * Double(quantity)

let priceStatus = StockTradingAttributes.ContentState(position: position, currentPrice: currentPrice)

Task {
  do {
    try await activity.update(using: priceStatus)
  } catch(let error) {
    print("Error updating Live Activity: \(error.localizedDescription)")
  }
}
</pre>
<h3 id="ending-an-activity">结束一个<code>Activity</code></h3>
<p>要结束实时活动，请使用以下方法:</p>
<pre class="language-swift hljs">func end(
    using contentState: Activity&lt;Attributes&gt;.ContentState? = nil,
    dismissalPolicy: ActivityUIDismissalPolicy = .default
) async
</pre>
<p>在示例Tradinza应用程序中，当实时活动结束时，它将显示最终交易价格和用户的<code>position</code>(即盈利或亏损):</p>
<pre class="language-swift hljs">func endTrade(for stock: Stock) async {
  let contentState = StockTradingAttributes.ContentState(position: position, currentPrice: currentPrice, tradeState: .ended)

  await activity?.end(using: contentState, dismissalPolicy: .default)
}
</pre>
<p><code>ContentState</code>显示最终位置和当前价格，因为实时活动保持可见，直到用户手动删除它。如果您想让系统自动删除实时活动，请将<code>.immediate</code>传递给<code>dismissalPolicy</code>参数。</p>
<p>根据状态，您还可以为结束状态创建自定义视图。</p>
<h2 id="implementing-live-activities-in-the-dynamic-island">在动态岛中实施现场活动</h2>
<p>要将实时活动添加到动态岛，您需要做的就是将参数<code>dynamicIsland</code>添加到<code>ActivityConfiguration</code>中，并提供相关的视图。</p>
<p>有四个视图选项(所有示例图像均来自<a href="https://developer.apple.com/design/human-interface-guidelines/components/system-experiences/live-activities/"> Apple Developer Live活动文档</a>):</p>
<ol>
<li><strong>展开视图</strong>:按住动态岛时，显示详细视图；将您的观点放在这里；它可以是前导、中心、尾随或底部<br/> <img data-attachment-id="141677" data-permalink="https://blog.logrocket.com/exploring-ios-live-activities-api/attachment/expanded-view/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/expanded-view.png" data-orig-size="720,408" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Expanded view" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/expanded-view-300x170.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/expanded-view.png" decoding="async" class="aligncenter wp-image-141677 size-full jetpack-lazy-image" src="../Images/eae60d0166977d3fae3477caef2b33b3.png" alt="Expanded View iOS Dynamic Island" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/expanded-view.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/11/expanded-view-300x170.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/expanded-view.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/expanded-view.png"/> <noscript> <img data-lazy-fallback="1" data-attachment-id="141677" data-permalink="https://blog.logrocket.com/exploring-ios-live-activities-api/attachment/expanded-view/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/expanded-view.png" data-orig-size="720,408" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Expanded view" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/expanded-view-300x170.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/expanded-view.png" decoding="async" loading="lazy" class="aligncenter wp-image-141677 size-full" src="../Images/eae60d0166977d3fae3477caef2b33b3.png" alt="Expanded View iOS Dynamic Island" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/expanded-view.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/11/expanded-view-300x170.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/expanded-view.png"/> </noscript></li>
<li><strong>紧凑前导视图</strong>:动态岛内容显示在药丸形状的左侧</li>
<li><strong>紧凑拖尾视图</strong>:动态岛内容显示在药丸形状右侧<br/> <img data-attachment-id="141680" data-permalink="https://blog.logrocket.com/exploring-ios-live-activities-api/attachment/compact-trailing-view/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/compact-trailing-view.png" data-orig-size="720,289" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Compact trailing view" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/compact-trailing-view-300x120.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/compact-trailing-view.png" decoding="async" class="aligncenter wp-image-141680 size-full jetpack-lazy-image" src="../Images/2ffbd7e4712319cace0f78cba9e57a55.png" alt="Compact Trailing View iOS Dynamic Island" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/compact-trailing-view.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/11/compact-trailing-view-300x120.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/compact-trailing-view.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/compact-trailing-view.png"/> <noscript> <img data-lazy-fallback="1" data-attachment-id="141680" data-permalink="https://blog.logrocket.com/exploring-ios-live-activities-api/attachment/compact-trailing-view/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/compact-trailing-view.png" data-orig-size="720,289" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Compact trailing view" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/compact-trailing-view-300x120.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/compact-trailing-view.png" decoding="async" loading="lazy" class="aligncenter wp-image-141680 size-full" src="../Images/2ffbd7e4712319cace0f78cba9e57a55.png" alt="Compact Trailing View iOS Dynamic Island" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/compact-trailing-view.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/11/compact-trailing-view-300x120.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/compact-trailing-view.png"/> </noscript></li>
<li><strong>最小视图</strong>:当另一个app的内容正在动态岛<br/> <img data-attachment-id="141682" data-permalink="https://blog.logrocket.com/exploring-ios-live-activities-api/attachment/minimal-view/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/minimal-view.png" data-orig-size="720,277" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Minimal view" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/minimal-view-300x115.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/minimal-view.png" decoding="async" class="aligncenter wp-image-141682 size-full jetpack-lazy-image" src="../Images/cc05c3ba4422e8cb5fc3b250494ebaa1.png" alt="Minimal View iOS Dynamic Island" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/minimal-view.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/11/minimal-view-300x115.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/minimal-view.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/minimal-view.png"/> <noscript> <img data-lazy-fallback="1" data-attachment-id="141682" data-permalink="https://blog.logrocket.com/exploring-ios-live-activities-api/attachment/minimal-view/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/minimal-view.png" data-orig-size="720,277" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Minimal view" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/minimal-view-300x115.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/minimal-view.png" decoding="async" loading="lazy" class="aligncenter wp-image-141682 size-full" src="../Images/cc05c3ba4422e8cb5fc3b250494ebaa1.png" alt="Minimal View iOS Dynamic Island" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/minimal-view.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/11/minimal-view-300x115.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/minimal-view.png"/> </noscript>中显示时，显示该视图</li>
</ol>
<p>要为Tradinza应用程序使用动态岛，您需要为扩展视图显示相同的实时活动视图。对于紧凑的前导部分，您需要提供当前交易股票的符号。对于紧凑的尾部，您需要提供当前位置(即，利润或损失)。对于最小视图，您只需提供当前的位置编号。</p>
<p>以下是代码供您参考:</p>
<pre class="language-swift hljs">struct TradinzaLiveActivity: Widget {
  var body: some WidgetConfiguration {
    ActivityConfiguration(for: StockTradingAttributes.self) { context in
      CurrentTradeView(context: context)
        .padding()
    } dynamicIsland: { context in
      DynamicIsland {
        DynamicIslandExpandedRegion(.bottom) {
          CurrentTradeView(context: context)
        }
      } compactLeading: {
        Text(context.attributes.stock.symbol).bold()
          .foregroundColor(.white)
      } compactTrailing: {
        CurrentTradePAndLView(context: context, font: .body)
      } minimal: {
        CurrentTradePAndLView(context: context, font: .body)
      }
    }
  }
}
</pre>
<p>在iPhone 14 Pro或14 Pro Max上运行动态岛，我们会在屏幕顶部看到以下视图:</p>
<p><img data-attachment-id="141768" data-permalink="https://blog.logrocket.com/exploring-ios-live-activities-api/attachment/dynamic-island-iphone-14-pro/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-island-iphone-14-pro.png" data-orig-size="720,405" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Dynamic Island iPhone 14 Pro" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-island-iphone-14-pro-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-island-iphone-14-pro.png" decoding="async" class="aligncenter wp-image-141768 size-full jetpack-lazy-image" src="../Images/da051f404c303e7223322c6cf4a00bfb.png" alt="Dynamic Island iPhone 14 Pro" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-island-iphone-14-pro.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-island-iphone-14-pro-300x169.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-island-iphone-14-pro.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-island-iphone-14-pro.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="141768" data-permalink="https://blog.logrocket.com/exploring-ios-live-activities-api/attachment/dynamic-island-iphone-14-pro/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-island-iphone-14-pro.png" data-orig-size="720,405" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Dynamic Island iPhone 14 Pro" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-island-iphone-14-pro-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-island-iphone-14-pro.png" decoding="async" loading="lazy" class="aligncenter wp-image-141768 size-full" src="../Images/da051f404c303e7223322c6cf4a00bfb.png" alt="Dynamic Island iPhone 14 Pro" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-island-iphone-14-pro.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-island-iphone-14-pro-300x169.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-island-iphone-14-pro.png"/></noscript>
<p>当您按住动态岛时，会打开一个详细视图，您可以在其中显示有关当前活动的更多详细信息:</p>
<p><img data-attachment-id="141771" data-permalink="https://blog.logrocket.com/exploring-ios-live-activities-api/attachment/detailed-view-holding-dynamic-island-iphone-14-pro/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/detailed-view-holding-dynamic-island-iphone-14-pro.png" data-orig-size="720,405" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Detailed view holding Dynamic Island iPhone 14 Pro" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/detailed-view-holding-dynamic-island-iphone-14-pro-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/detailed-view-holding-dynamic-island-iphone-14-pro.png" decoding="async" class="aligncenter wp-image-141771 size-full jetpack-lazy-image" src="../Images/f69d9ec831ab6dda3ec24962bf9e027b.png" alt="Detailed View Holding Dynamic Island iPhone 14 Pro" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/detailed-view-holding-dynamic-island-iphone-14-pro.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/11/detailed-view-holding-dynamic-island-iphone-14-pro-300x169.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/detailed-view-holding-dynamic-island-iphone-14-pro.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/detailed-view-holding-dynamic-island-iphone-14-pro.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="141771" data-permalink="https://blog.logrocket.com/exploring-ios-live-activities-api/attachment/detailed-view-holding-dynamic-island-iphone-14-pro/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/detailed-view-holding-dynamic-island-iphone-14-pro.png" data-orig-size="720,405" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Detailed view holding Dynamic Island iPhone 14 Pro" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/detailed-view-holding-dynamic-island-iphone-14-pro-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/detailed-view-holding-dynamic-island-iphone-14-pro.png" decoding="async" loading="lazy" class="aligncenter wp-image-141771 size-full" src="../Images/f69d9ec831ab6dda3ec24962bf9e027b.png" alt="Detailed View Holding Dynamic Island iPhone 14 Pro" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/detailed-view-holding-dynamic-island-iphone-14-pro.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/11/detailed-view-holding-dynamic-island-iphone-14-pro-300x169.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/detailed-view-holding-dynamic-island-iphone-14-pro.png"/></noscript>
<h2 id="production-readiness">生产准备就绪</h2>
<p>截至本文撰写之时，iOS 16.1正式版已经面向开发者和用户发布。然而，值得注意的是，iOS开发人员仍在探索ActivityKit框架，并通过动态岛文档进行工作。目前，还没有一个大型社区可以回答与Live Activities API相关的所有问题和疑问。因此，根据您的开发历程，您将Live Activities应用程序发布到App Store可能会面临一些延迟或困难。</p>
<h2 id="availability">有效性</h2>
<p>虽然实时活动和动态岛是可以在应用中实现的令人兴奋的功能，但遗憾的是，它们仅适用于iOS 16.1+。</p>
<p>截至本文撰写之时，iOS 16.1正式版已经发布给开发者，您可以将您的带有直播活动的应用提交到App Store。</p>
<h2 id="conclusion">结论</h2>
<p>Live Activities是一个很好的解决方案，可以在不解锁iPhone的情况下将实时更新整合到您的iOS应用程序中。如果你的应用程序需要用户即时更新，比如送餐或拼车更新，那么你应该在你的应用程序中利用这个功能。</p>
<p>你可以在<a href="https://github.com/rudrankriyam/Tradinza"> GitHub </a>上找到这篇博文中展示的最终示例项目。</p>
<p><strong> <em>注意，</em> </strong> <em>截至本文写作和iOS 16.1发布时，你只能在锁屏上与Apple apps进行直播活动的互动，就像Apple Music app一样。苹果没有第三方API来实现现场活动的交互性。您可以在直播活动中添加深层链接URL来打开您的应用程序，但用户无法在锁屏屏幕上与直播活动进行互动</em></p>
<p>我希望这篇文章能够帮助你开始在你的iOS应用程序中添加实时活动！</p><div class="code-block code-block-4">
<div class="blog-plug base-cta"><h2>使用<a class="signup" href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>消除传统错误报告的干扰</h2>
<a href="https://lp.logrocket.com/blg/signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p><a href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一个数字体验分析解决方案，它可以保护您免受数百个假阳性错误警报的影响，只针对几个真正重要的项目。LogRocket会告诉您应用程序中实际影响用户的最具影响力的bug和UX问题。</p>
<p>然后，使用具有深层技术遥测的会话重放来确切地查看用户看到了什么以及是什么导致了问题，就像你在他们身后看一样。</p>
<p>LogRocket自动聚合客户端错误、JS异常、前端性能指标和用户交互。然后LogRocket使用机器学习来告诉你哪些问题正在影响大多数用户，并提供你需要修复它的上下文。</p>
<p>关注重要的bug—<a class="signup" href="https://lp.logrocket.com/blg/signup-issue-free" target="_blank" rel="noopener noreferrer">今天就试试LogRocket】。</a></p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>