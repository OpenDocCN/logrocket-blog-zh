<html>
<head>
<title>Boost your productivity with TypeScript project references - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用 TypeScript 项目参考提高您的工作效率</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/boost-your-productivity-with-typescript-project-references/#0001-01-01">https://blog.logrocket.com/boost-your-productivity-with-typescript-project-references/#0001-01-01</a></blockquote><div><article class="article-post">
<p>如果您在 monorepo 中有一个不使用<a href="https://www.typescriptlang.org/docs/handbook/project-references.html" target="_blank" rel="noopener"> TypeScript 项目引用</a>的 TypeScript 代码库，那么您就错过了一个技巧。</p>
<p>TypeScript 项目引用从 TypeScript 3.0 开始就存在了，它允许您在当前包所依赖的<code>tsconfig.json</code>中指定依赖包。当您构建一个包含依赖项的包时，依赖项首先被构建。</p>
<p>下面的<code>tsconfig.json</code>指定这个包引用了一个<code>common</code>包，并且<code>common</code>包是在当前包之前构建的:</p>
<pre>{
  "extends": "../tsconfig-base.json",
  "compilerOptions": {
    "outDir": "../lib/animals",
    "rootDir": ".",
  },
  "references": [
    { "path": "../core" }
  ]
}</pre>
<p>项目引用是通过具有<code>path</code>属性的对象的<code>references</code>数组来指定的。<code>path</code>属性是包含<code>tsconfig.json</code>文件的不同位置的相对路径。</p>
<p>如果项目没有使用项目引用，那么所有的包都必须单独构建，如果有多个依赖包，这将是一个巨大的负担。</p>
<h2>增量构建</h2>
<p>当传输包含项目引用的包时，<code>-b</code>或<code>--build</code>开关被添加到<a href="https://www.typescriptlang.org/docs/handbook/compiler-options.html" target="_blank" rel="noopener"> tsc </a>编译器中:</p>
<pre> &gt; tsc -b                           # Use the tsconfig.json in the current directory
 &gt; tsc -b src                       # Use src/tsconfig.json
 &gt; tsc -b foo/prd.tsconfig.json bar # Use foo/prd.tsconfig.json and bar/tsconfig.json</pre>
<p>一个成功的构建将输出一个<code>tsconfig.tsbuildinfo</code>，在后续的构建中使用，以确保只构建新代码或更改过的代码，从而缩短构建时间。<code>tsconfig.tsbuildinfo</code>文件包含构建整个项目所需的所有文件的签名和时间戳。在后续的生成中，TypeScript 将使用该信息来检测最经济的类型检查方式，并向项目发出更改。</p>
<h2>观察 monorepo 中所有包的变化</h2>
<p>真正推动我的 TypeScript 开发的是让<code>tsc</code>观察 monorepo 的每个包中的变化的能力。</p>
<p>我有一个这样的脚本，它在我开发的整个过程中都在运行:</p>
<pre>"watch": "tsc -b ./tsconfig.packages.json --watch"</pre>
<p>当<code>watch</code>脚本运行时，整个 monorepo 中的任何 TypeScript 更改都将导致新的高效构建:</p>
<p><img data-attachment-id="41295" data-permalink="https://blog.logrocket.com/boost-your-productivity-with-typescript-project-references/watch/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/watch.png" data-orig-size="1122,180" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="watch" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/watch-300x48.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/watch-1024x164.png" decoding="async" class="aligncenter size-full wp-image-41295 jetpack-lazy-image" src="../Images/d89105c49d970d7b16bc7d99758d467b.png" alt="tsc watching for changes" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/watch.png 1122w, https://blog.logrocket.com/wp-content/uploads/2021/04/watch-300x48.png 300w, https://blog.logrocket.com/wp-content/uploads/2021/04/watch-1024x164.png 1024w, https://blog.logrocket.com/wp-content/uploads/2021/04/watch-768x123.png 768w" data-lazy-sizes="(max-width: 1122px) 100vw, 1122px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/04/watch.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/watch.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="41295" data-permalink="https://blog.logrocket.com/boost-your-productivity-with-typescript-project-references/watch/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/watch.png" data-orig-size="1122,180" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="watch" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/watch-300x48.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/watch-1024x164.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-41295" src="../Images/d89105c49d970d7b16bc7d99758d467b.png" alt="tsc watching for changes" srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/watch.png 1122w, https://blog.logrocket.com/wp-content/uploads/2021/04/watch-300x48.png 300w, https://blog.logrocket.com/wp-content/uploads/2021/04/watch-1024x164.png 1024w, https://blog.logrocket.com/wp-content/uploads/2021/04/watch-768x123.png 768w" sizes="(max-width: 1122px) 100vw, 1122px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/watch.png"/></noscript>
<h2>Monorepo 项目结构</h2>
<p>在大多数 monorepos 中，单独的包节点位于一个名为<code>packages</code>的文件夹中。下面是 monorepo 的一个例子，其中各种<code>tsconfig.json</code>文件以外科手术般的精度有策略地放置:</p>
<pre>tsconfig.base.json         # base tsconfig.json that all packages will extend
tsconfig.packages.json     # tsconfig.json that is used to watch eveything
all packages
/package.json
/packages
  /common                  # Common utitliies used by all package
    /src
      .index.ts            # entry point for package
    /tsconfig.json         # Config file for 'common' project
    /package.json
  /web                     # Depends on 'common'
    /src
      .index.ts            # entry point for package
    /tsconfig.json         # Config file for 'web' project
  /api                     # Depends on 'common'
    /src
      .index.ts            # entry point for package
    /tsconfig.json         # Config file for 'api' project
    /package.json</pre>
<p>在根文件夹中是一个由 monorepo 中的所有包扩展的<code>tsconfig.base.json</code>文件:</p>
<pre>{
  "compilerOptions": {
    "baseUrl": ".",
    "composite": true,
    "declaration": true,
    "declarationMap": true,
    "paths": {
      "common": ["packages/common/src"],
      "web": ["packages/web/src"],
      "api": ["packages/api/src"]
    }
  }
}</pre>
<p>这里实际上发生了很多事情:</p>
<ul>
<li><code>"composite": true</code>指示<code>tsc</code>存在项目引用</li>
<li><code>"declarationMap": true</code>为<code>.d.ts</code>申报文件添加源地图。它在 VS 代码中的意思是<code>Go to Definition</code>,将会转到实际的文件，而不是<code>.d.ts</code>文件</li>
<li><code>paths</code>字段包含一个对象，每个对象键(本例中为 common、web 或 API)指向一个包的位置。有了这个设置，我们可以导入包，而不需要讨厌的相对或绝对路径。<br/>例如<code>import { a } from 'web';</code></li>
</ul>
<p>在这个例子中，每个包使用<code>tsconfig</code>的<code>extends</code>选项扩展<code>tsconfig.base.json</code>:</p>
<pre>{
  "extends": "../tsconfig-base.json",
  "compilerOptions": {
    "rootDir": ".",
  },
  "references": [
    { "path": "../core" }
  ]
}</pre>
<h2>观察和构建</h2>
<p>项目结构根处的<code>tsconfig.packages.json</code>引用了我们想要观察或构建的所有包:</p>
<pre>{
  "files": [],
  "references": [
  {
    "path": "./packages/common"
  },
  {
    "path": "./packages/web"
  },
  {
    "path": "./packages/api"
  }
 ]
}</pre>
<p>有了这个结构，我们现在可以一次性构建所有的包:</p>
<pre>tsc -b ./tsconfig.packages.json</pre>
<p>或者观看:</p>
<pre>tsc -b ./tsconfig.packages.json</pre>
<h2>有用的开关</h2>
<p>使用项目引用时，以下开关很方便:</p>
<pre>--verbose: Prints out verbose logging to explain what is going on (may be combined with any other flag)
--dry: Shows what would be done but does not actually build anything
--clean: Deletes the outputs of the specified projects (may be combined with --dry)
--force: Acts as if all projects are out of date
--watch: Watch mode (may not be combined with any flag except --verbose)</pre>
<h2>网络包</h2>
<p>像 webpack 和 Rollup 这样的 Bundlers 在相当长的一段时间内没有提供对项目引用的支持，而 Rollup 只提供部分支持。这无助于采用。</p>
<h2>ts web 包加载程序</h2>
<p>配置 webpack 加载器<code>ts-loader</code>时，需要将<code>projectReferences</code>选项设置为 true:</p>
<pre>{
  test: /\.tsx?$/,
  use: {
    loader: 'ts-loader',
    options: {
      projectReferences: true,
    },
  },
},</pre>
<h2>收场白</h2>
<p>这些天来，我在 monorepo 的大部分主要开发工作中，包括客户项目和我自己的个人开发。如果我使用 TypeScript 作为我的主要语言，那么我将启用项目引用，就像我在这里概述的那样。我发现它们极大地提高了生产率，但并不是每个人都在使用。</p><div class="code-block code-block-21">
<div class="blog-plug inline-plug typescript-plug"><h2><a class="signup" href="https://lp.logrocket.com/blg/typescript-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>:全面了解您的网络和移动应用</h2>
<a href="https://lp.logrocket.com/blg/typescript-signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p>LogRocket 是一个前端应用程序监控解决方案，可以让您回放问题，就像问题发生在您自己的浏览器中一样。LogRocket 不需要猜测错误发生的原因，也不需要向用户询问截图和日志转储，而是让您重放会话以快速了解哪里出错了。它可以与任何应用程序完美配合，不管是什么框架，并且有插件可以记录来自 Redux、Vuex 和@ngrx/store 的额外上下文。</p>
<p>除了记录 Redux 操作和状态，LogRocket 还记录控制台日志、JavaScript 错误、堆栈跟踪、带有头+正文的网络请求/响应、浏览器元数据和自定义日志。它还使用 DOM 来记录页面上的 HTML 和 CSS，甚至为最复杂的单页面和移动应用程序重新创建像素级完美视频。</p>
<a class="signup" href="https://lp.logrocket.com/blg/typescript-signup" target="_blank" rel="noopener noreferrer">Try it for free</a><p>.</p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>