<html>
<head>
<title>Event bubbling and capturing in React </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>React中的事件冒泡和捕获</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/event-bubbling-capturing-react/#0001-01-01">https://blog.logrocket.com/event-bubbling-capturing-react/#0001-01-01</a></blockquote><div><article class="article-post">
<p>事件是程序中常用来触发功能的可检测的动作或事件。这些动作包括用户点击按钮和网页加载。</p>
<p>本文将介绍事件捕获和冒泡如何在<a href="https://blog.logrocket.com/tag/react/"> React </a>中工作。在我们讨论什么是事件捕获和冒泡之前，我们将了解事件委托及其工作原理。我们还将看看React中的<code><a href="https://reactjs.org/docs/events.html">SyntheticEvent</a></code>,它是如何工作的，以及它与React中的事件捕获和冒泡的联系。</p>
<p><em>向前跳转:</em></p>

<h2 id="understanding-event-delegation-react">了解React中的事件委托</h2>
<p>事件委托是一种处理事件的技术，涉及到向父元素添加单个事件监听器，而不是向单个子元素添加<a href="https://blog.logrocket.com/deep-dive-into-event-bubbling-and-capturing/">事件监听器</a>。当子元素上发生事件时，父元素上的事件侦听器会得到通知，并且父元素可以处理该事件。当您有许多子元素并且希望避免向它们添加事件侦听器时，这很有用。</p>
<p>想象一个场景，其中您有以下代码:</p>
<pre class="language-javascript hljs">function App() {
  const parentFunction = () =&gt; {
    console.log('Hello from the parent');
  };
  const firstChildFunction = () =&gt; {
    console.log('Hello from the first child');
  };
  const secondChildFunction = () =&gt; {
    console.log('Hello from the second child');
  };
  const thirdChildFunction = () =&gt; {
    console.log('Hello from the third child');
  };
  return ( 
    &lt;div className="App"&gt;
      &lt;div className="parent-div" onClick={parentFunction}&gt;
        &lt;button className="first-child-button" onClick={firstChildFunction}&gt;
          First child button
        &lt;/button&gt;
        &lt;button className="second-child-button" onClick={secondChildFunction}&gt;
          Second child button
        &lt;/button&gt;
        &lt;button className="third-child-button" onClick={thirdChildFunction}&gt;
          Third child button
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}
export default App;
</pre>
<p>在上面的代码中，我们有一个带有一个<code><a href="https://blog.logrocket.com/react-onclick-event-handlers-guide/">onClick</a></code>处理程序的父节点<code>div</code>。父母<code>div</code>有三个孩子<code>buttons</code>，他们都有<code>onClick</code>的训导员。<code>onClick</code>处理所有将文本打印到控制台的<code>PointTo</code>功能。</p>
<p>当我们单击任何按钮并检查控制台时，我们会获得该按钮(第二个按钮)的日志。然而，我们还得到另一个日志，显示父节点<code>div</code>被点击，如下图所示:</p>
<p><img data-attachment-id="159011" data-permalink="https://blog.logrocket.com/event-bubbling-capturing-react/attachment/react-child-component/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-child-component.png" data-orig-size="730,169" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React child component" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-child-component-300x69.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-child-component.png" decoding="async" class="aligncenter size-full wp-image-159011 jetpack-lazy-image" src="../Images/c87f377193e98b05fddaca187cba258b.png" alt="React Child Component" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/02/react-child-component.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/02/react-child-component-300x69.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/02/react-child-component.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/react-child-component.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="159011" data-permalink="https://blog.logrocket.com/event-bubbling-capturing-react/attachment/react-child-component/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-child-component.png" data-orig-size="730,169" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React child component" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-child-component-300x69.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-child-component.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-159011" src="../Images/c87f377193e98b05fddaca187cba258b.png" alt="React Child Component" srcset="https://blog.logrocket.com/wp-content/uploads/2023/02/react-child-component.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/02/react-child-component-300x69.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/react-child-component.png"/></noscript>
<p>我们知道事件委托发生了，因为父元素也处理子元素的事件。现在，让我们看看React处理事件的顺序。</p>
<h2 id="intro-event-propagation">事件传播简介</h2>
<p>事件传播是网页上发生事件时调用事件处理程序的顺序。为了理解事件传播是如何工作的，了解DOM 中的<a href="https://blog.logrocket.com/react-reference-guide-refs-dom/">事件流的三个阶段是有帮助的:捕获阶段、目标阶段和冒泡阶段。</a></p>
<p>在捕获阶段，事件从文档顶部向下传播到发生事件的元素。捕获不如冒泡常用。简单地说，这就是所谓的从文档顶部向下移动到发生事件的元素的事件。</p>
<p>在目标阶段，事件处理程序在发生事件的元素上执行，并且可以通过<code>event.target</code>进行评估。</p>
<p>在冒泡阶段，事件从发生事件的元素沿DOM树向上移动到其父元素，依此类推，直到到达文档的顶部。这是DOM中大多数事件的默认行为。这与捕获阶段相反。</p>
<p>下图描述了事件传播的三个阶段及其工作原理:</p>
<p><img data-attachment-id="159014" data-permalink="https://blog.logrocket.com/event-bubbling-capturing-react/attachment/event-capturing-react/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/event-capturing-react.png" data-orig-size="730,548" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React event propagation diagram" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/event-capturing-react-300x225.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/event-capturing-react.png" decoding="async" class="aligncenter size-full wp-image-159014 jetpack-lazy-image" src="../Images/b19095020def3fd34201d1b7daf49ffa.png" alt="React Event Propagation Diagram" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/02/event-capturing-react.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/02/event-capturing-react-300x225.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/02/event-capturing-react.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/event-capturing-react.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="159014" data-permalink="https://blog.logrocket.com/event-bubbling-capturing-react/attachment/event-capturing-react/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/event-capturing-react.png" data-orig-size="730,548" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React event propagation diagram" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/event-capturing-react-300x225.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/event-capturing-react.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-159014" src="../Images/b19095020def3fd34201d1b7daf49ffa.png" alt="React Event Propagation Diagram" srcset="https://blog.logrocket.com/wp-content/uploads/2023/02/event-capturing-react.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/02/event-capturing-react-300x225.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/event-capturing-react.png"/></noscript>
<blockquote><p>注意:事件传播的第四个阶段称为none阶段，在这个阶段不执行任何事件。</p></blockquote>
<h2 id="synthetic-event">什么是<code>SyntheticEvent</code>？</h2>
<p>React依赖于一个<a href="https://blog.logrocket.com/virtual-dom-react/">虚拟DOM </a>，并使用这个概念来处理DOM操作。<code><a href="https://blog.logrocket.com/getting-started-react-synthetic-event/">SyntheticEvent</a></code>包装器包装了React用来抽象浏览器可以处理的事件之间的差异的原生DOM事件。这允许你<a href="https://blog.logrocket.com/creating-hover-events-synthetic-event-react-hover/">编写跨所有浏览器一致工作的事件处理程序</a>。</p>
<p>例如，考虑以下将点击<code>EventListener</code>附加到<code>button</code>的代码:</p>
<pre class="language-javascript hljs">document.getElementById('myButton').addEventListener('click', () =&gt; {
  console.log('Button was clicked');
});
</pre>
<p>在上面的代码中，<code>click</code>事件是一个本地DOM事件。在React中，您应该这样写事件:</p>
<pre class="language-javascript hljs">&lt;button onClick={() =&gt; console.log('Button was clicked')}&gt;Click me&lt;/button&gt;
</pre>
<p>本例中的<code>onClick</code>事件是一个合成事件。当按钮被点击时，React将调用您提供的事件处理函数。在内部，React会将合成事件转换为原生DOM事件，并将其传递给事件侦听器。</p>
<p>React创建了<code>SyntheticEvents</code>,允许你以自己熟悉的方式编写事件处理程序，而不用担心浏览器可以处理的各种事件之间的差异。<code>SyntheticEvents</code>还包括<code>stopPropagation</code>、<code>preventDefault</code>等方法，这些方法有助于React的事件系统。</p>
<h2 id="using-event-stop-propagation-react">在React中使用<code>event.stopPropagation()</code></h2>
<p>我们已经了解了事件传播、其阶段以及它们是如何工作的。但是，也有不希望某个事件冒泡的时候。这就是<code>event.stopPropagation()</code>方法的用武之地。</p>
<p>在React中，<code>event.stopPropagation()</code>方法防止父组件处理子组件处理的事件。您可以在事件对象上调用<code>event.stopPropagation()</code>来阻止事件在树中进一步传播。这在父组件的事件处理程序与子组件的事件处理程序冲突的情况下很有用。</p>
<p>让我们来看一个用例的例子，在这个用例中，您想要使用<code>event.stopPropagation()</code>来避免父组件和子组件之间的冲突。在下面的代码中，我们有一个<code>header</code>组件，它有一个用于注销的<code>button</code>:</p>
<pre class="language-javascript hljs">import './App.css';
function App() {
  const handleHeaderClick = () =&gt; {
    console.log('Header was clicked');
  };
  const handleButtonClick = () =&gt; {
    console.log('The logout button was clicked');
  };
  return (
    &lt;&gt;
      &lt;div className="styleHeader" onClick={handleHeaderClick}&gt;
        &lt;div&gt;Header&lt;/div&gt;
        &lt;button type="button" onClick={handleButtonClick}&gt;
          Log Out
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/&gt;
  );
}
export default App;
</pre>
<p>上面的代码块将显示如下图所示的<code>header</code>组件:</p>
<p><img data-attachment-id="159016" data-permalink="https://blog.logrocket.com/event-bubbling-capturing-react/attachment/react-header-log/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-header-log.png" data-orig-size="730,67" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Example of React header logged" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-header-log-300x28.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-header-log.png" decoding="async" class="aligncenter size-full wp-image-159016 jetpack-lazy-image" src="../Images/716e0ff2ffe7722689f90340be6cf68a.png" alt="Example of React Header Logged" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/02/react-header-log.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/02/react-header-log-300x28.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/02/react-header-log.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/react-header-log.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="159016" data-permalink="https://blog.logrocket.com/event-bubbling-capturing-react/attachment/react-header-log/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-header-log.png" data-orig-size="730,67" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Example of React header logged" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-header-log-300x28.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-header-log.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-159016" src="../Images/716e0ff2ffe7722689f90340be6cf68a.png" alt="Example of React Header Logged" srcset="https://blog.logrocket.com/wp-content/uploads/2023/02/react-header-log.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/02/react-header-log-300x28.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/react-header-log.png"/></noscript>
<p>在这种情况下，我们不希望事件由父组件处理。此时，如果您单击<strong>注销按钮</strong>，父节点仍会处理该事件，如下所示:</p>
<p><img data-attachment-id="159019" data-permalink="https://blog.logrocket.com/event-bubbling-capturing-react/attachment/log-out-react/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-react.png" data-orig-size="730,134" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React event clicked" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-react-300x55.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-react.png" decoding="async" class="aligncenter size-full wp-image-159019 jetpack-lazy-image" src="../Images/6a9b296f2bcb928b45cd5a5331de4e00.png" alt="React Event Clicked" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-react.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-react-300x55.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-react.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-react.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="159019" data-permalink="https://blog.logrocket.com/event-bubbling-capturing-react/attachment/log-out-react/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-react.png" data-orig-size="730,134" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React event clicked" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-react-300x55.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-react.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-159019" src="../Images/6a9b296f2bcb928b45cd5a5331de4e00.png" alt="React Event Clicked" srcset="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-react.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-react-300x55.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-react.png"/></noscript>
<p>我们可以通过将<code>event.stopPropagation()</code>传递给子组件(按钮)来阻止父组件处理事件，如下所示:</p>
<pre class="language-javascript hljs">import './App.css';
function App() {
  const handleHeaderClick = () =&gt; {
    console.log('Header was clicked');
  };
  const handleButtonClick = (event) =&gt; {
    event.stopPropagation();
    console.log('The logout button was clicked');
  };


// The code down here remains the same 
}
export default App;
</pre>
<p>我们首先将<code>event</code>对象作为参数传递给<code>handleButtonClick</code>函数，然后使用<code>event.stopPropagation()</code>阻止事件冒泡到父组件中。现在，如果我们点击<strong>按钮</strong>，不会出现冒泡，我们只会得到按钮组件的日志。它应该是这样的:</p>
<p><img data-attachment-id="159021" data-permalink="https://blog.logrocket.com/event-bubbling-capturing-react/attachment/log-out-two-react/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-two-react.png" data-orig-size="730,136" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React event capture example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-two-react-300x56.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-two-react.png" decoding="async" class="aligncenter size-full wp-image-159021 jetpack-lazy-image" src="../Images/85e040a1dcb60db564758e2bc3ef49e9.png" alt="React Event Capture Example" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-two-react.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-two-react-300x56.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-two-react.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-two-react.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="159021" data-permalink="https://blog.logrocket.com/event-bubbling-capturing-react/attachment/log-out-two-react/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-two-react.png" data-orig-size="730,136" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React event capture example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-two-react-300x56.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-two-react.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-159021" src="../Images/85e040a1dcb60db564758e2bc3ef49e9.png" alt="React Event Capture Example" srcset="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-two-react.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-two-react-300x56.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/log-out-two-react.png"/></noscript>
<h2 id="event-delegation-react-v16-v17">React v16与React v17中的事件委托</h2>
<p>在React v16和更早的版本中，事件委托是通过在每个事件的文档节点附加事件处理程序来处理的。这意味着React将计算出在一个事件中调用了哪个组件，并将该事件冒泡到React附加了事件处理程序的文档节点。</p>
<p>由于嵌套的<a href="https://blog.logrocket.com/comparing-react-tree-components/">反应树</a>，这种方法存在<a href="https://github.com/facebook/react/pull/8117">问题</a>。如果您的应用程序中有嵌套的React树，那么<code>event.stopPropagation()</code>方法将不会像预期的那样工作。让我们看下面的例子:</p>
<pre class="language-html hljs">// Nested React trees in the index.html
&lt;div id="parent"&gt;
   &lt;div id="root"&gt;&lt;/div&gt;
&lt;/div&gt;
</pre>
<p>将以下代码粘贴到<code>App.js</code>文件中:</p>
<pre class="language-javascript hljs">import "./styles.css";
import React from "react";

export default function App() {
  const handleButtonClick = () =&gt; {
    console.log("The button was clicked");
  };
  return (
    &lt;div className="App"&gt;
      &lt;button onClick={handleButtonClick}&gt;Click me&lt;/button&gt;
    &lt;/div&gt;
  );
}
</pre>
<p>在上面的代码块中，我们有一个带有<code>onClick</code>处理程序的<code>button</code>,它指向一个函数，该函数在被点击时将一些文本记录到控制台。</p>
<p>在<code>index.js</code>文件中，粘贴以下代码:</p>
<pre class="language-javascript hljs">import React from "react";
import ReactDOM from "react-dom";
import App from "./App";

const parent = document.getElementById("parent");
parent.addEventListener("click", (e) =&gt; {
  console.log("The parent was clicked");
  e.stopPropagation();
});

ReactDOM.render(&lt;App /&gt;, document.getElementById("root"));
</pre>
<p>在上面的代码块中，我们从DOM中获得了<code>parent</code>元素，并为其附加了一个<code>EventListener</code>。<code>EventListener</code>监听到一个<code>click</code>事件，并向控制台记录了一个不同的文本。然后，我们在下面的代码中调用了<code>event.stopPropagation()</code>方法。</p>
<p>当我们点击按钮时，我们期望得到两个不同的文本字符串。但是，相反，我们得到了一个，它甚至不是我们期望的那个，如下图所示:</p>
<p><img data-attachment-id="159023" data-permalink="https://blog.logrocket.com/event-bubbling-capturing-react/attachment/react-bubbling-tree/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-bubbling-tree.png" data-orig-size="730,511" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Example of React bubbling tree" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-bubbling-tree-300x210.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-bubbling-tree.png" decoding="async" class="aligncenter size-full wp-image-159023 jetpack-lazy-image" src="../Images/2d3e93e95da589f45ff24511f6f1fa6d.png" alt="Example of React Bubbling Tree" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/02/react-bubbling-tree.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/02/react-bubbling-tree-300x210.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/02/react-bubbling-tree.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/react-bubbling-tree.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="159023" data-permalink="https://blog.logrocket.com/event-bubbling-capturing-react/attachment/react-bubbling-tree/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-bubbling-tree.png" data-orig-size="730,511" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Example of React bubbling tree" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-bubbling-tree-300x210.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-bubbling-tree.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-159023" src="../Images/2d3e93e95da589f45ff24511f6f1fa6d.png" alt="Example of React Bubbling Tree" srcset="https://blog.logrocket.com/wp-content/uploads/2023/02/react-bubbling-tree.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/02/react-bubbling-tree-300x210.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/react-bubbling-tree.png"/></noscript>
<p>发生这种情况是因为当你有嵌套的React树时，React仍然会将事件冒泡到外层树，即使在调用了<code>event.stopPropagation()</code>之后。</p>
<h3 id="changes-dom-tree">对DOM树的更改</h3>
<p>在React v17和更高版本中，React的开发人员改变了将事件附加到DOM树的方式。事件处理程序现在附加到呈现React树的根DOM容器，而不再附加到文档节点。以下是这些变化的形象化描述:</p>
<p><img data-attachment-id="159025" data-permalink="https://blog.logrocket.com/event-bubbling-capturing-react/attachment/react-tree-changes/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-tree-changes.png" data-orig-size="730,565" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A diagram showing how React v17 attaches events to the roots rather than to the document" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-tree-changes-300x232.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-tree-changes.png" decoding="async" class="aligncenter size-full wp-image-159025 jetpack-lazy-image" src="../Images/a62994921b12fe7d2d82241e180e9762.png" alt="A Diagram Showing How React v17 Attaches Events to the Roots Rather Than to the Document" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/02/react-tree-changes.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/02/react-tree-changes-300x232.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/02/react-tree-changes.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/react-tree-changes.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="159025" data-permalink="https://blog.logrocket.com/event-bubbling-capturing-react/attachment/react-tree-changes/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-tree-changes.png" data-orig-size="730,565" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A diagram showing how React v17 attaches events to the roots rather than to the document" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-tree-changes-300x232.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-tree-changes.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-159025" src="../Images/a62994921b12fe7d2d82241e180e9762.png" alt="A Diagram Showing How React v17 Attaches Events to the Roots Rather Than to the Document" srcset="https://blog.logrocket.com/wp-content/uploads/2023/02/react-tree-changes.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/02/react-tree-changes-300x232.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/react-tree-changes.png"/></noscript><br/>
If we change the <code>index.js</code> file to reflect React v17 changes, we get the appropriate logs in the console, as shown below:
<pre class="language-javascript hljs">// index.js
import { createRoot } from "react-dom/client";
import App from "./App";

const parent = document.getElementById("parent");
parent.addEventListener("click", (e) =&gt; {
  console.log("The parent was clicked");
  e.stopPropagation();
});

const rootElement = document.getElementById("root");
const root = createRoot(rootElement);
root.render(&lt;App /&gt;);
</pre>
<p>现在，当我们点击<strong>按钮</strong>时，我们得到日志，如下图所示:</p>
<p><img data-attachment-id="159027" data-permalink="https://blog.logrocket.com/event-bubbling-capturing-react/attachment/react-event-capture-bubble-final/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-event-capture-bubble-final.png" data-orig-size="730,499" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React event capturing and bubbling" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-event-capture-bubble-final-300x205.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-event-capture-bubble-final.png" decoding="async" class="aligncenter size-full wp-image-159027 jetpack-lazy-image" src="../Images/dde1316aa8476993913c437b96cdea61.png" alt="React Event Capturing and Bubbling" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/02/react-event-capture-bubble-final.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/02/react-event-capture-bubble-final-300x205.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/02/react-event-capture-bubble-final.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/react-event-capture-bubble-final.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="159027" data-permalink="https://blog.logrocket.com/event-bubbling-capturing-react/attachment/react-event-capture-bubble-final/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-event-capture-bubble-final.png" data-orig-size="730,499" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React event capturing and bubbling" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-event-capture-bubble-final-300x205.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-event-capture-bubble-final.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-159027" src="../Images/dde1316aa8476993913c437b96cdea61.png" alt="React Event Capturing and Bubbling" srcset="https://blog.logrocket.com/wp-content/uploads/2023/02/react-event-capture-bubble-final.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/02/react-event-capture-bubble-final-300x205.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/react-event-capture-bubble-final.png"/></noscript>
<h2>结论</h2>
<p>本文研究了在React中如何处理事件。我们在React中看到了事件委托、传播、冒泡、捕获和<code>SyntheticEvents</code>。此外，我们研究了<code>event.stopPropagation()</code>方法，以及如何使用它来停止事件传播。我们还研究了React以前版本中事件的处理方式，以及React当前版本中事件的处理方式。</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720"><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener"> LogRocket </a>:全面了解您的生产React应用</h2><p>调试React应用程序可能很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪Redux状态、自动显示JavaScript错误以及跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" vwo-el-id="19356441070">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<p vwo-el-id="28675660440" class="">LogRocket 结合了会话回放、产品分析和错误跟踪，使软件团队能够创建理想的web和移动产品体验。这对你来说意味着什么？</p>
<p>LogRocket不是猜测错误发生的原因，也不是要求用户提供截图和日志转储，而是让您回放问题，就像它们发生在您自己的浏览器中一样，以快速了解哪里出错了。</p>
<p>不再有嘈杂的警报。智能错误跟踪允许您对问题进行分类，然后从中学习。获得有影响的用户问题的通知，而不是误报。警报越少，有用的信号越多。</p>
<p vwo-el-id="28675660750">LogRocket Redux中间件包为您的用户会话增加了一层额外的可见性。LogRocket记录Redux存储中的所有操作和状态。</p>
<p vwo-el-id="28675661060">现代化您调试React应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">开始免费监控</a>。</p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>