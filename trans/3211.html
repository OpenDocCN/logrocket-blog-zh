<html>
<head>
<title>How to market make and transact with Hashflow - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何利用Hashflow - LogRocket博客进行营销和交易</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/how-to-market-make-transact-hashflow/#0001-01-01">https://blog.logrocket.com/how-to-market-make-transact-hashflow/#0001-01-01</a></blockquote><div><article class="article-post">
<p>近年来，DeFi交易者的数量有所增加，这也导致了更多分散式交易所(dex)进入市场。</p>
<p><a href="https://blog.logrocket.com/tag/web3/"> Web3 </a>正在加大对各大行业的影响，贸易行业也不例外。我们已经看到了集中交易的缺陷，如缺乏透明度、不安全性、金融排他性和隐私性，这就提供了对dex的需求。</p>
<p>DEX是一种不需要像经纪人或第三方这样的中介来交换加密货币的方式。它们遵循一种不同于集中式交易所的方法，依靠智能合约来处理点对点交易。</p>
<p>这种商业模式注重用户的隐私，即使交易细节存储在区块链上，交易也是匿名进行的。</p>
<p>市场上有很多DEX平台，比如比特币基地和币安，但是在本文中，我们将重点讨论Hashflow。</p>
<p>我们将看看交易者如何通过Hashflow令牌与pinpoints连接，它的工作方式如何不同于其他方式，如何做市，以及如何交易。</p>

<h2 id="whatishashflowandwhatisitsgoal">什么是Hashflow，它的目标是什么？</h2>
<p>首先，Hashflow以其无桥跨链交换而闻名，这意味着它具有高度的互操作性，具有零滑移，并且没有MEV。</p>
<p>这是可能的，因为Hashflow确保做市商签署报价，因此在交易期间保持不变。</p>
<p>流动性提供者和交易者与Hashflow上的专业做市商联系在一起，其核心功能为其做市商提供了更好的灵活性——无滑点、抗MEV、更好的报价和更便宜的交易费用都是它的优势。</p>
<p>上面提到的所有这些都是可能的，因为Hashflow使用的架构是基于池的架构。</p>
<h2 id="howhashflowworks">Hashflow如何工作</h2>
<p>从交易开始，用户必须将他的钱包连接到Hashflow，输入他们想要交易的号码，然后报价就会显示给他们。</p>
<p>如果用户接受，订单被提交，交易被验证并添加到Hashflow网络(或区块链)中。另一方面，做市商市场负责发布用户已经接受的报价。</p>
<p>然后，做市商在交易上签字，交易被无滑动地执行(不管用户提交的是什么订单)。与其他dex不同，它们通常有AMMs(自动做市商)使用<a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3674178" target="_blank" rel="noopener">惰性流动性条款</a>处理做市和资产定价，Hashflow传统上就像订单簿机制一样。</p>
<p>定价是在链外完成的，但交易是在链上进行的。</p>
<p>Hashflow于2021年成立，并已显著增长，由于其优化的汽油费和零滑动，提供了最好的价格。截至本文发表时，Hashflow目前支持无桥跨链互换，这使您可以在EVM兼容的链上启动互换，预计未来将包括Solana integration、智能订单路由、gasless trading、限价单和Hashverse。</p>
<p>总之，Hashflow是一个DeFi协议，作为以太坊区块链上运行的分散式交换。</p>
<h2 id="hashflowtokens">现金流代币</h2>
<p>Hashflow提供了其名为HFT (Hashflow token)的令牌，这是2021年12月22日部署的以太坊链上的ERC-20。有10亿单位的HFT供应，Hashflow以这样的方式分配这种加密货币:19%给核心团队；25%给早期投资者；56%贡献给生态系统。再给早期用户6.75%作为奖励。</p>
<p><img data-attachment-id="126279" data-permalink="https://blog.logrocket.com/how-to-market-make-transact-hashflow/attachment/hashflow-allocation/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/07/hashflow-allocation.png" data-orig-size="730,386" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="hashflow-allocation" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/07/hashflow-allocation-300x159.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/07/hashflow-allocation.png" decoding="async" class="aligncenter wp-image-126279 size-full jetpack-lazy-image" src="../Images/facf1ce0f17f38fc9501a190cd715691.png" alt="Hashflow Allocation" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/07/hashflow-allocation.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/07/hashflow-allocation-300x159.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/07/hashflow-allocation.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/07/hashflow-allocation.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="126279" data-permalink="https://blog.logrocket.com/how-to-market-make-transact-hashflow/attachment/hashflow-allocation/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/07/hashflow-allocation.png" data-orig-size="730,386" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="hashflow-allocation" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/07/hashflow-allocation-300x159.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/07/hashflow-allocation.png" decoding="async" loading="lazy" class="aligncenter wp-image-126279 size-full" src="../Images/facf1ce0f17f38fc9501a190cd715691.png" alt="Hashflow Allocation" srcset="https://blog.logrocket.com/wp-content/uploads/2022/07/hashflow-allocation.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/07/hashflow-allocation-300x159.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/07/hashflow-allocation.png"/></noscript>
<p>Hashflow NFT，也称为Hashbots，将在未来发布的Hashverse中使用。NFT持有者将获得与NFT价值相符的HFT，因为每个NFT都有一个HFT价值。Hashflow声明，四年后，5%的HFT将发放给社区。</p>
<h2 id="howtomarketmake">如何进行市场营销</h2>
<p>市场标记在Hashflow和整个市场中非常重要。他们是流动性提供者，通过买卖资产使市场运转。这并不是说他们马上就可以随时买卖，而是随时待命，随时准备买卖。</p>
<p>在大多数分散式交易所中，做市商是自动的，智能合约被部署来在AMMs(自动做市商)中寻找市场对，但它们容易受到攻击，并且还有点滞后，因为价格报价是在链上处理的。</p><div class="code-block code-block-54">
<hr/>
<h3>更多来自LogRocket的精彩文章:</h3>

<hr/></div>
<p>在Hashflow中，做市商是公司、机构或个人，他们被赋予特权，利用他们的专业知识做出这些市场决策，这是在链外完成的，这反过来减少了汽油费和滑点，如前所述。</p>
<p>为了在Hashflow上进行市场营销，我们将遵循以下步骤。作为做市商与Hashflow集成非常简单。</p>
<h2 id="connecttowebsocket">连接到WebSocket</h2>
<p>您将需要从Hashflow API连接到WebSocket，就像您在下面第10行看到的那样，并且您可能需要通过Telegram或Discord联系团队以添加到“allowlist”生成器。</p>
<pre class="language-javascript hljs">const PING_PONG_INTERVAL_MS = 30000;
const PING_PONG_GRACE_PERIOD_MS = 1000;

function getWebsocketConnection(
  marketMakerName,
  onMessageCallBack,
  onCloseCallback,
  onHeartbeatCallback,
) {
  const ws = new WebSocket(`${process.env.HASHFLOW_WS_API}/maker/v1`, {
    headers: { marketmaker: marketMakerName, }
  });
  const heartbeat = () =&gt; {
    if (ws.pingTimeout) {
      clearTimeout(ws.pingTimeout);
    }
    ws.pingTimeout = setTimeout(() =&gt; {
      ws.terminate();
    }, PING_PONG_INTERVAL_MS + PING_PONG_GRACE_PERIOD_MS);

    onHeartbeatCallback();
  }
  ws.on('open', heartbeat);
  ws.on('ping', heartbeat);
  ws.on('message', message =&gt; onMessageCallBack(message));

  ws.on('close', () =&gt; {
    if (ws.pingTimeout) {
      clearTimeout(ws.pingTimeout);
    }
    setTimeout(() =&gt; {
      ws.removeAllListeners();
      onCloseCallback();
    }, 5000);
  });

  ws.on('error', err =&gt; {});

  ws.on('unexpected-response', (_, res) =&gt; {
    let message = '';
    res.on('data', (chunk) =&gt; {
      message += chunk;
    });
    res.on('end', () =&gt; {
      if (res.statusCode === 401) {
        logger.error(`WS access not authorized. ${message}`);
      } else {
        logger.error(`Unexpexted response from server: [${res.statusCode}] ${message}.`);
      }
      ws.close()
    });
  });
  return ws;
}
</pre>
<p>Hashflow连接到您，如下所示:</p>
<pre class="language-javascript hljs">// TODO: Replace this with your market maker name (once added to the backend)
const MARKET_MAKER_NAME = 'TestMM';
// TODO: Set true if you want to MM on 1inch, etc – and have signed legal agreements
const SUPPORT_AGGREGATORS = false;
const levelsInterval = SUPPORT_AGGREGATORS 
  ? setInterval(() =&gt; publishPriceLevels(mainSocket), 1000)
  : undefined;
const onMessageCallback = message =&gt; processMessage(mainSocket, message);
const onHeartbeatCallback = () =&gt; {
  for (const networkId of Object.keys(SUPPORTED_PAIRS)) {
    sendMessage(mainSocket, 'subscribeToTrades', { networkId, pool: POOL });
  }
};
const onCloseCallback = () =&gt; {
  if (SUPPORT_AGGREGATORS) {
    clearInterval(levelsInterval);
  }
  mainSocket = connectToHashflow();
};

const connectToHashflow = () =&gt; {
  return getWebsocketConnection(
    MARKET_MAKER_NAME,
    onMessageCallback,
    onCloseCallback,
    onHeartbeatCallback,
  );
}
let mainSocket = connectToHashflow();
</pre>
<p>与团队联系后,“TestMM”将被替换为您的。你也应该参考这个示例<a href="https://github.com/hashflownetwork/sample-market-maker" target="_blank" rel="noopener"> codebase </a>来看看如何从Hashflow连接到WebSocket。</p>
<h2 id="createapool">创建一个池</h2>
<p>连接到web服务器后，您需要连接到您的钱包，以创建一个将提供报价的池。</p>
<p>为此，请使用此<a href="https://app.hashflow.com/pools" target="_blank" rel="noopener">链接</a>并填写您的池名称、签名者地址，最后确定您希望您的池是公共的还是私有的。完成该过程后，您应该会看到如下页面:</p>
<p><img data-attachment-id="126281" data-permalink="https://blog.logrocket.com/how-to-market-make-transact-hashflow/attachment/mib-pool/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/07/mib-pool.png" data-orig-size="730,698" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="mib-pool" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/07/mib-pool-300x287.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/07/mib-pool.png" decoding="async" class="aligncenter wp-image-126281 size-full jetpack-lazy-image" src="../Images/cf00666601afd6f2c9ffa1ac9862798e.png" alt="MIB Pool" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/07/mib-pool.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/07/mib-pool-300x287.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/07/mib-pool.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/07/mib-pool.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="126281" data-permalink="https://blog.logrocket.com/how-to-market-make-transact-hashflow/attachment/mib-pool/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/07/mib-pool.png" data-orig-size="730,698" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="mib-pool" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/07/mib-pool-300x287.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/07/mib-pool.png" decoding="async" loading="lazy" class="aligncenter wp-image-126281 size-full" src="../Images/cf00666601afd6f2c9ffa1ac9862798e.png" alt="MIB Pool" srcset="https://blog.logrocket.com/wp-content/uploads/2022/07/mib-pool.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/07/mib-pool-300x287.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/07/mib-pool.png"/></noscript>
<h2 id="receiverfqandrespondwithquote">接受RFQ并引用他的话</h2>
<p>现在到了有趣的部分；当用户希望与我们的服务器进行交易时，Hashflow会收到来自用户的报价请求，然后服务器会将数据提供给指定的做市商:</p>
<pre class="language-javascript hljs">{
  "messageType": "rfq",
  "message": {
    // This is a unique RFQ ID -- you need to use this when sending back a quote.
    "rfqId": string,

    // This will be something like: hashflow, 1inch. This is useful
    // since 1inch charge fees for their trades
    "source": string,

    // 1 for ETH L1
    "networkId": number,

    // Base token (the token the trader sells).
    "baseToken": string,  // contract address
    "baseTokenName": string,  // token name (e.g. USDC, ETH, ...)
    "baseTokenNumDecimals": number,  // token decimals (e.g. DAI: 18, USDC: 6)

    // Quote token (the token the trader buys).
    "quoteToken": string,  // contract address
    "quoteTokenName": string,  // token name (e.g. USDC, ETH, ...)
    "quoteTokenNumDecimals": number,  // token decimals (e.g. DAI: 18, USDC: 6)


    // Exactly one of the following fields will be present in the RFQ.
    // If baseTokenAmount is present, quoteTokenAmount needs to be filled by the quote.
    // If quoteTokenAmount is present, baseTokenAmount needs to be filled by the quore.
    // Amounts are in decimals, e.g. "1000000" for 1 USDT.
    "baseTokenAmount": ?string,
    "quoteTokenAmount": ?string,

    // The trader wallet address that will swap with the contract. This can be a proxy
    // contract (e.g. 1inch)
    "trader": string,

    // The wallet address of the actual trader (e.g. end user wallet for 1inch).
    // This is helpful in order to understand user behavior.
    // If effectiveTrader is not present, you can assume that trader == effectiveTrader.
    "effectiveTrader": ?string,
  }
}
</pre>
<p>根据您在代码库中实现的逻辑，报价也以这种格式返回给用户:</p>
<pre class="language-javascript hljs">{
  "messageType": "quote",
  "message": {
    "rfqId": string,  // This should be the same rfqId that was sent by the server
    "pool": string,  // This should be the contract address of the pool.

    // This is optional. If using an EOA (externally owned account), this should 
    // contain the wallet address of the EOA. 
    // The EOA needs to have allowance set to the Pool.
    "eoa": ?string,

    // Same as RFQ
    "baseToken": string,
    "quoteToken": string,

    // Amounts are in decimals.
    "baseTokenAmount": string,
    "quoteTokenAmount": string,

    // Set this to "0" for private pool / EOA trading.
    "fees": string,

    // The unix timestamp when the quote expires, in seconds.
    "quoteExpiry": number,
  }
}
</pre>
<h2 id="supportsigningquotes">支持签名报价</h2>
<p>只有当用户没有提供特定的做市商时，才会发生这种情况，在这种情况下，Hashflow将请求所有做市商报价，并选择最佳的做市商。</p>
<p>当挑选出最佳报价时，我们将一个<code>signQuote</code>消息类型发送回做市商，让他们签名(从他们那里获得签名)。请求也是这种格式:</p>
<pre class="language-javascript hljs">  "messageType": "signQuote",
  "message": {
    // The RFQ ID that generated the quote.
    "rfqId": string,
    "networkId": number,  // The chain ID (e.g. 1 for Ethereum mainnet)
    "quoteData": {
      "txid": string,  // Unique identifier of the quote -- different from the RFQ ID.

      "pool": string,
      "eoa": string,

      "baseToken": string,
      "quoteToken": string,

      "baseTokenAmount": string,
      "quoteTokenAmount": string,

      "fees": string,

      "quoteExpiry": number,

      // The account that will be executing the swap. For 1inch, this is the 1inch proxy.
      "trader": string,
      // Trader actually executing the swap, if different from 'trader'.
      "effectiveTrader": ?string,

      // The following parameter is internal to hashflow contracts.
      // It is leveraged to mitigate quote replay.
      "nonce": number
    }
  }
}
</pre>
<h2 id="getthefirstsignedrfq">得到第一个签名的RFQ</h2>
<p>您可以使用以下主体参数作为示例，通过向Hashflow的staging API发出请求来测试您的web服务器，以查看您是否从中获得了签名的RFQ:</p>
<pre class="language-javascript hljs">POST https://api-staging.hashflow.com/taker/v1/quote/signedRfq


{
    "networkId": 42,  // 42 is Kovan, 1 is Mainnet
    "source": "hashflow", 
    "baseToken": "0x07de306ff27a2b630b1141956844eb1552b956b5",  // USDT (Kovan)
    "quoteToken": "0xa0a5ad2296b38bd3e3eb59aaeaf1589e8d9a29a9",  // WBTC (Kovan)
    "trader": "0x2150DD462B496bd5e4A37b5411c13319427BE83E",
    "baseTokenAmount": "1000000",
    "marketMaker": "TestMM"  // don't forget to change this
}
</pre>
<p>一旦你得到回应，那么你的做市商就准备好了。您还应该参考<a href="https://docs.hashflow.com/hashflow/market-making/getting-started" target="_blank" rel="noopener">文档</a>以了解更多边缘案例。</p>
<h2 id="conclusion">结论</h2>
<p>在这篇文章中，我们着重于揭示Hashflow、其用户和做市商之间的联系以及Hashflow的关键方面——即，它提供无桥跨链互换和链外市场决策；即报价是在没有自动报价机的情况下完成的。</p>
<p>正如以太坊的Vitalik所推测的那样，Hashflow让多链世界离我们更近了。我们希望得到更多的Hashflow对其他链的支持，因为它目前正被大量采用。要查看其指标，请前往这个<a href="https://hashflow2.metabaseapp.com/public/dashboard/f4b12fd4-d28c-4f08-95b9-78b00b83cf17" target="_blank" rel="noopener">仪表板</a>。</p><div class="code-block code-block-26">
<div class="blog-plug inline-plug blockchain-plug"><h2>加入像Bitso和Coinsquare这样的组织，他们使用LogRocket主动监控他们的Web3应用</h2><p>影响用户在您的应用中激活和交易的能力的客户端问题会极大地影响您的底线。如果您对监控UX问题、自动显示JavaScript错误、跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a target="_blank" href="https://lp.logrocket.com/blg/web3-signup">try LogRocket</a><p>.</p><a class="signup" href="https://lp.logrocket.com/blg/web3-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/dacb06c713aec161ffeaffae5bd048cd.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/dacb06c713aec161ffeaffae5bd048cd.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png"/></noscript></a><a href="https://lp.logrocket.com/blg/web3-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用的DVR，记录你的网络应用或网站上发生的一切。您可以汇总和报告关键的前端性能指标，重放用户会话和应用程序状态，记录网络请求，并自动显示所有错误，而不是猜测问题发生的原因。</p><p>现代化您调试web和移动应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/web3-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>