<html>
<head>
<title>Simplify GraphQL requests with React Query, GraphQL Code Generator, and TypeScript - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用 React Query、GraphQL 代码生成器和 TypeScript - LogRocket 博客简化 GraphQL 请求</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/making-graphql-requests-easy-with-react-typescript-and-react-query/#0001-01-01">https://blog.logrocket.com/making-graphql-requests-easy-with-react-typescript-and-react-query/#0001-01-01</a></blockquote><div><article class="article-post">
<p>使用 GraphQL API 有明显的优势。有了 GraphQL，我们可以请求我们需要的精确数据，而不会出现数据提取不足或提取过多的情况。我们还可以在一个请求中获得多个资源。与此同时，请求本身可以作为一种文档形式，便于理解正在使用什么数据、在哪里使用以及为什么使用。</p>
<p>但是 GraphQL 最令人兴奋的特性是 API 完全由其模式描述，包括每个可能的查询或变异的所有数据类型。</p>
<p>为什么这很重要？</p>
<p>因为，基于该模式，我们可以在前端为整个 API 自动创建 TypeScript 类型。更重要的是，我们可以很容易地为像 React Query 这样的数据读取库自动生成完全类型化的自定义 React 挂钩。</p>
<p>让我告诉你怎么做。</p>
<h2>使用 GraphQL 设置项目</h2>
<h3>React 应用</h3>
<p>首先，让我们用带有 TypeScript 模板的 Create React App 创建 React 项目。</p>
<pre>yarn create react-app graphql --template typescript
</pre>
<h3>部署 GraphQL API</h3>
<p>接下来，我们需要一个 API。FakeQL 提供了一种创建和部署模拟 GraphQL API 的好方法。因为我们将使用默认定义，我们可以简单地通过点击<strong>扩展 JSON </strong>然后<strong>部署</strong>来设置一切。该工具生成一个惟一的 URL，我们可以在那里访问我们的新 API。</p>
<h3>创建数据提取库</h3>
<p>现在我们有了 React 应用程序和 API，是时候建立我们的数据获取库了，<a href="https://react-query.tanstack.com/" target="_blank" rel="noopener"> React Query </a>。</p>
<p>让我们安装它:</p>
<pre>yarn add react-query
</pre>
<p>现在，设置 React 查询客户机。</p>
<pre>import { QueryClient, QueryClientProvider } from 'react-query'

import Posts from 'components/Posts'

const queryClient = new QueryClient()

const App = () =&gt; {
    return (
        &lt;QueryClientProvider client={queryClient}&gt;
            &lt;Posts /&gt;
        &lt;/QueryClientProvider&gt;
    )
}

export default App
</pre>
<h3>构建组件</h3>
<p>因为我们的 API 提供了一个帖子列表，所以我们将使用一个<code>Posts</code>组件来显示它们。目前，我们让它空着。</p>
<pre>// components/Posts.tsx

const Posts = () =&gt; {
    return (
        &lt;&gt;&lt;/&gt;
    )
}

export default Posts
</pre>
<p>接下来，我们需要一个查询来获取文章列表。让我们在一个<code>.graphql</code>文件中定义它，并将它与我们的组件放在一起:</p>
<pre># components/Posts/posts.graphql

query Posts {
    posts {
        id
        title
    }
}
</pre>
<p>最后，让我们也添加一个删除帖子的变体:</p>
<pre># components/Posts/deletePost.graphql

mutation DeletePost($id: ID!) {
    deletePost(id: $id)
}
</pre>
<h2>使用 TypeScript 和 GraphQL 代码生成器自动生成类型化的 React 查询挂钩</h2>
<p>现在，我们已经准备好根据之前在<code>.graphql</code>文件中定义的请求，自动生成我们的定制和完全类型化的 React 查询钩子。我们将使用<a href="https://graphql-code-generator.com/" target="_blank" rel="noopener"> GraphQL 代码生成器</a>。</p>
<p>我们从安装开始:</p>
<pre>yarn add graphql</pre>
<pre>yarn add -D @graphql-codegen/cli
</pre>
<p>接下来，我们需要初始化向导并完成以下步骤:</p>
<pre>yarn graphql-codegen init
</pre>
<p>首先，我们选择要构建的应用程序类型:</p>
<p><img data-attachment-id="43072" data-permalink="https://blog.logrocket.com/making-graphql-requests-easy-with-react-typescript-and-react-query/choosing-type/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-type.png" data-orig-size="730,136" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Choosing type" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-type-300x56.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-type.png" decoding="async" class="aligncenter size-full wp-image-43072 jetpack-lazy-image" src="../Images/4adbdb3a5c7185df4fb0d6699a1580d0.png" alt="Choosing Type" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-type.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-type-300x56.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-type.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-type.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="43072" data-permalink="https://blog.logrocket.com/making-graphql-requests-easy-with-react-typescript-and-react-query/choosing-type/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-type.png" data-orig-size="730,136" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Choosing type" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-type-300x56.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-type.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-43072" src="../Images/4adbdb3a5c7185df4fb0d6699a1580d0.png" alt="Choosing Type" srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-type.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-type-300x56.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-type.png"/></noscript>
<p>然后，我们通过粘贴 FakeQL url 来定义我们的模式。</p>
<p><img data-attachment-id="43073" data-permalink="https://blog.logrocket.com/making-graphql-requests-easy-with-react-typescript-and-react-query/pasting-fakeql-url/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/pasting-fakeql-url.png" data-orig-size="730,79" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Pasting FakeQL URL" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/pasting-fakeql-url-300x32.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/pasting-fakeql-url.png" decoding="async" class="aligncenter size-full wp-image-43073 jetpack-lazy-image" src="../Images/681226876867da5db6417ea37198ccb6.png" alt="Pasting FakeQL URL" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/pasting-fakeql-url.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/pasting-fakeql-url-300x32.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/04/pasting-fakeql-url.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/pasting-fakeql-url.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="43073" data-permalink="https://blog.logrocket.com/making-graphql-requests-easy-with-react-typescript-and-react-query/pasting-fakeql-url/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/pasting-fakeql-url.png" data-orig-size="730,79" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Pasting FakeQL URL" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/pasting-fakeql-url-300x32.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/pasting-fakeql-url.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-43073" src="../Images/681226876867da5db6417ea37198ccb6.png" alt="Pasting FakeQL URL" srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/pasting-fakeql-url.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/pasting-fakeql-url-300x32.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/pasting-fakeql-url.png"/></noscript>
<p>我们定义我们的操作和片段在哪里:</p>
<p><img data-attachment-id="43074" data-permalink="https://blog.logrocket.com/making-graphql-requests-easy-with-react-typescript-and-react-query/defining-operations-fragments/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/defining-operations-fragments.png" data-orig-size="730,98" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Defining operations fragments" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/defining-operations-fragments-300x40.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/defining-operations-fragments.png" decoding="async" class="aligncenter size-full wp-image-43074 jetpack-lazy-image" src="../Images/9dde7981d58956bf1efd8f4f8c2380e8.png" alt="Defining Operations Fragments" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/defining-operations-fragments.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/defining-operations-fragments-300x40.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/04/defining-operations-fragments.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/defining-operations-fragments.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="43074" data-permalink="https://blog.logrocket.com/making-graphql-requests-easy-with-react-typescript-and-react-query/defining-operations-fragments/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/defining-operations-fragments.png" data-orig-size="730,98" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Defining operations fragments" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/defining-operations-fragments-300x40.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/defining-operations-fragments.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-43074" src="../Images/9dde7981d58956bf1efd8f4f8c2380e8.png" alt="Defining Operations Fragments" srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/defining-operations-fragments.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/defining-operations-fragments-300x40.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/defining-operations-fragments.png"/></noscript>
<p>我们选择我们的插件:</p>
<p><img data-attachment-id="43075" data-permalink="https://blog.logrocket.com/making-graphql-requests-easy-with-react-typescript-and-react-query/choosing-plugins/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-plugins.png" data-orig-size="730,198" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Choosing plugins" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-plugins-300x81.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-plugins.png" decoding="async" class="aligncenter size-full wp-image-43075 jetpack-lazy-image" src="../Images/79588b3380cdb464871abd4e8bd16959.png" alt="Choosing Plugins" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-plugins.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-plugins-300x81.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-plugins.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-plugins.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="43075" data-permalink="https://blog.logrocket.com/making-graphql-requests-easy-with-react-typescript-and-react-query/choosing-plugins/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-plugins.png" data-orig-size="730,198" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Choosing plugins" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-plugins-300x81.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-plugins.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-43075" src="../Images/79588b3380cdb464871abd4e8bd16959.png" alt="Choosing Plugins" srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-plugins.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-plugins-300x81.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-plugins.png"/></noscript>
<p>我们选择在哪里写入输出:</p>
<p><img data-attachment-id="43076" data-permalink="https://blog.logrocket.com/making-graphql-requests-easy-with-react-typescript-and-react-query/choosing-where-to-write-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-where-to-write-output.png" data-orig-size="730,122" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Choosing where to write output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-where-to-write-output-300x50.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-where-to-write-output.png" decoding="async" class="aligncenter size-full wp-image-43076 jetpack-lazy-image" src="../Images/091170eae7e246770975251cf28ef6ea.png" alt="Choosing Where to Write Output" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-where-to-write-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-where-to-write-output-300x50.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-where-to-write-output.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-where-to-write-output.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="43076" data-permalink="https://blog.logrocket.com/making-graphql-requests-easy-with-react-typescript-and-react-query/choosing-where-to-write-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-where-to-write-output.png" data-orig-size="730,122" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Choosing where to write output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-where-to-write-output-300x50.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-where-to-write-output.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-43076" src="../Images/091170eae7e246770975251cf28ef6ea.png" alt="Choosing Where to Write Output" srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-where-to-write-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-where-to-write-output-300x50.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/choosing-where-to-write-output.png"/></noscript>
<p>让我们也生成一个自省文件:</p>
<p><img data-attachment-id="43077" data-permalink="https://blog.logrocket.com/making-graphql-requests-easy-with-react-typescript-and-react-query/generating-introspection-file/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/generating-introspection-file.png" data-orig-size="730,127" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Generating introspection file" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/generating-introspection-file-300x52.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/generating-introspection-file.png" decoding="async" class="aligncenter size-full wp-image-43077 jetpack-lazy-image" src="../Images/3c19d837fbb48a61f6539f6162616fa0.png" alt="Generating Introspection File" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/generating-introspection-file.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/generating-introspection-file-300x52.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/04/generating-introspection-file.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/generating-introspection-file.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="43077" data-permalink="https://blog.logrocket.com/making-graphql-requests-easy-with-react-typescript-and-react-query/generating-introspection-file/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/generating-introspection-file.png" data-orig-size="730,127" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Generating introspection file" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/generating-introspection-file-300x52.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/generating-introspection-file.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-43077" src="../Images/3c19d837fbb48a61f6539f6162616fa0.png" alt="Generating Introspection File" srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/generating-introspection-file.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/generating-introspection-file-300x52.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/generating-introspection-file.png"/></noscript>
<p>我们需要将配置文件命名为:</p>
<p><img data-attachment-id="43078" data-permalink="https://blog.logrocket.com/making-graphql-requests-easy-with-react-typescript-and-react-query/naming-config-file/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-config-file.png" data-orig-size="730,153" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Naming config file" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-config-file-300x63.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-config-file.png" decoding="async" class="aligncenter size-full wp-image-43078 jetpack-lazy-image" src="../Images/86fba2046caf86bbfa2a836023908739.png" alt="Naming Config File" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-config-file.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/naming-config-file-300x63.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-config-file.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-config-file.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="43078" data-permalink="https://blog.logrocket.com/making-graphql-requests-easy-with-react-typescript-and-react-query/naming-config-file/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-config-file.png" data-orig-size="730,153" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Naming config file" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-config-file-300x63.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-config-file.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-43078" src="../Images/86fba2046caf86bbfa2a836023908739.png" alt="Naming Config File" srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-config-file.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/naming-config-file-300x63.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-config-file.png"/></noscript>
<p>最后，让我们将我们的脚本命名为<code>graphql:codegen</code>:</p>
<p><img data-attachment-id="43079" data-permalink="https://blog.logrocket.com/making-graphql-requests-easy-with-react-typescript-and-react-query/naming-script/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-script.png" data-orig-size="730,156" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Naming script" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-script-300x64.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-script.png" decoding="async" class="aligncenter size-full wp-image-43079 jetpack-lazy-image" src="../Images/30ec71c4c253b995f7a32b736a3f00cd.png" alt="Naming Script" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-script.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/naming-script-300x64.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-script.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-script.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="43079" data-permalink="https://blog.logrocket.com/making-graphql-requests-easy-with-react-typescript-and-react-query/naming-script/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-script.png" data-orig-size="730,156" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Naming script" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-script-300x64.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-script.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-43079" src="../Images/30ec71c4c253b995f7a32b736a3f00cd.png" alt="Naming Script" srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-script.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/naming-script-300x64.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/naming-script.png"/></noscript>
<p>到目前为止，一切顺利！</p>
<p>为了生成定制的 React 查询挂钩，我们需要安装适当的插件:</p>
<pre>yarn add -D @graphql-codegen/typescript-react-query
</pre>
<p>并添加对 codegen.yml 配置文件的快速编辑，以使其正常工作:</p>
<pre>overwrite: true
schema: 'https://fakeql.com/graphql/2aaf00462236e8280f4c3beb197aae54'
documents: 'src/**/*.graphql'
generates:
    src/generated/index.ts:
        plugins:
            - typescript
            - typescript-operations
            - typescript-react-query
        config:
            fetcher:
                endpoint: 'https://fakeql.com/graphql/2aaf00462236e8280f4c3beb197aae54'
</pre>
<p>最后，我们需要运行我们的脚本。</p>
<pre>yarn graphql:codegen
</pre>
<p>我们现在完成了！我们的全类型定制 React 查询钩子已经自动生成，并直接添加到我们项目的<code>generated</code>文件夹中。</p>
<p>让我们看看他们的行动吧！</p>
<h2>发出 API 请求</h2>
<p>在我们的<code>Posts</code>组件中，我们现在准备显示帖子列表:</p>
<pre>import { usePostsQuery } from 'generated'

const Posts = () =&gt; {
    const { data } = usePostsQuery()
     return (
            &lt;&gt;
                {isLoading &amp;&amp; &lt;p&gt;Loading ...&lt;/p&gt;}
                {data &amp;&amp;
                    data.posts?.map(post =&gt; (
                        &lt;div key={post?.id}&gt;
                            &lt;p&gt;{post?.title}&lt;/p&gt;
                            &lt;hr /&gt;
                        &lt;/div&gt;
                    ))}
            &lt;/&gt;
        )
}

export default Posts
</pre>
<p>让我们也加入我们之前定义的<code>DeletePost</code>突变。</p>
<pre>import { useQueryClient } from 'react-query'
import { usePostsQuery, useDeletePostMutation } from 'generated'

const Posts = () =&gt; {
    const queryClient = useQueryClient()
    const { data, isLoading } = usePostsQuery()
    const { mutate } = useDeletePostMutation({
        onSuccess: () =&gt; queryClient.invalidateQueries('Posts'),
    })

    return (
        &lt;&gt;
            {isLoading &amp;&amp; &lt;p&gt;Loading ...&lt;/p&gt;}
            {data &amp;&amp;
                data.posts?.map(post =&gt; (
                    &lt;div key={post?.id}&gt;
                        &lt;p&gt;{post?.title}&lt;/p&gt;
                        &lt;button onClick={() =&gt; post &amp;&amp; mutate({ id: post.id })}&gt;
                            Delete
                        &lt;/button&gt;
                        &lt;hr /&gt;
                    &lt;/div&gt;
                ))}
        &lt;/&gt;
    )
}

export default Posts
</pre>
<p>就这样，我们现在有了一个工作示例！</p>
<h2>结论</h2>
<p>上述方法允许我们在前端充分利用 GraphQL，为 API 自动创建 TypeScript 类型，并为每个请求生成定制的 React 查询挂钩。</p>
<p>通过使用它，我们还大大减少了需要编写的数据提取样板代码的数量。有了这个工具，为了为请求创建额外的 React 查询定制钩子，我们需要做的就是创建一个<code>.graphql</code>文件并运行<code>graphql:codegen</code>脚本。很酷，对吧？</p>
<p>好奇自己玩代码？在我的 GitHub <a href="https://github.com/IvaKop/React-Query-Typescript-GraphQL-Code-Generator-Example" target="_blank" rel="noopener"> repo </a>中找到完整的工作示例。</p>
<p>编码快乐！✨</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用 LogRocket 消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款 React analytics 解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket 告诉您 React 应用程序中实际影响用户的最具影响力的 bug 和 UX 问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS 异常、前端性能指标和用户交互。然后，LogRocket 使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的 React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试 LogRocket】。</a></p><div class="code-block code-block-21">
<div class="blog-plug inline-plug typescript-plug"><h2><a class="signup" href="https://lp.logrocket.com/blg/typescript-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>:全面了解您的网络和移动应用</h2>
<a href="https://lp.logrocket.com/blg/typescript-signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p>LogRocket 是一个前端应用程序监控解决方案，可以让您回放问题，就像问题发生在您自己的浏览器中一样。LogRocket 不需要猜测错误发生的原因，也不需要向用户询问截图和日志转储，而是让您重放会话以快速了解哪里出错了。它可以与任何应用程序完美配合，不管是什么框架，并且有插件可以记录来自 Redux、Vuex 和@ngrx/store 的额外上下文。</p>
<p>除了记录 Redux 操作和状态，LogRocket 还记录控制台日志、JavaScript 错误、堆栈跟踪、带有头+正文的网络请求/响应、浏览器元数据和自定义日志。它还使用 DOM 来记录页面上的 HTML 和 CSS，甚至为最复杂的单页面和移动应用程序重新创建像素级完美视频。</p>
<a class="signup" href="https://lp.logrocket.com/blg/typescript-signup" target="_blank" rel="noopener noreferrer">Try it for free</a><p>.</p></div>
</div>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>