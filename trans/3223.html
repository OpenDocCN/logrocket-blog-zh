<html>
<head>
<title>How to build a credit card scanner with React Native - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何用React Native - LogRocket Blog构建一个信用卡扫描器</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/build-credit-card-scanner-react-native/#0001-01-01">https://blog.logrocket.com/build-credit-card-scanner-react-native/#0001-01-01</a></blockquote><div><article class="article-post">
<p>在移动应用程序中，用户经常通过输入他们的信用卡信息进行购物。我们可能都有过在智能手机上手动输入这16位数字的令人沮丧的经历。</p>
<p>许多应用程序正在增加自动化来简化这一过程。因此，要输入支付细节，用户可以拍摄他们的信用卡照片，或者从他们设备的照片库中上传照片。很酷，对吧？</p>
<p>在本文中，我们将学习如何使用<a href="https://developers.google.com/ml-kit/vision/text-recognition">文本识别API </a>在React本机应用程序中实现类似的功能，这是一个基于ML工具包的API，可以识别任何基于拉丁语的字符集。我们将使用设备上的文本识别API，并涵盖以下内容:</p>

<p>您可以在这个<a href="https://github.com/hrupesh/RNCardScanner"> GitHub资源库</a>中找到本教程的完整代码。我们最终的用户界面看起来会像下面的gif:</p>
<p><img data-attachment-id="126671" data-permalink="https://blog.logrocket.com/build-credit-card-scanner-react-native/attachment/final-credit-card-scan-ui/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/final-credit-card-scan-ui.gif" data-orig-size="400,848" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="final-credit-card-scan-ui" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/final-credit-card-scan-ui-142x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/final-credit-card-scan-ui.gif" decoding="async" class="aligncenter wp-image-126671 size-full jetpack-lazy-image" src="../Images/3686d2ee97ac21f4729fd799b59566d2.png" alt="Final Credit Card Scan UI" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/final-credit-card-scan-ui.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/final-credit-card-scan-ui.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="126671" data-permalink="https://blog.logrocket.com/build-credit-card-scanner-react-native/attachment/final-credit-card-scan-ui/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/final-credit-card-scan-ui.gif" data-orig-size="400,848" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="final-credit-card-scan-ui" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/final-credit-card-scan-ui-142x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/final-credit-card-scan-ui.gif" decoding="async" loading="lazy" class="aligncenter wp-image-126671 size-full" src="../Images/3686d2ee97ac21f4729fd799b59566d2.png" alt="Final Credit Card Scan UI" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/final-credit-card-scan-ui.gif"/></noscript>
<p> </p>
<p><img data-attachment-id="126675" data-permalink="https://blog.logrocket.com/build-credit-card-scanner-react-native/attachment/credit-card-scan-ui-upload/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/credit-card-scan-ui-upload.gif" data-orig-size="600,1197" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="credit-card-scan-ui-upload" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/credit-card-scan-ui-upload-150x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/credit-card-scan-ui-upload-513x1024.gif" decoding="async" class="aligncenter wp-image-126675 size-full jetpack-lazy-image" src="../Images/71cd64938acc4678ab3504e42697ed4b.png" alt="Credit Card Scan UI Upload" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/credit-card-scan-ui-upload.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/credit-card-scan-ui-upload.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="126675" data-permalink="https://blog.logrocket.com/build-credit-card-scanner-react-native/attachment/credit-card-scan-ui-upload/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/credit-card-scan-ui-upload.gif" data-orig-size="600,1197" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="credit-card-scan-ui-upload" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/credit-card-scan-ui-upload-150x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/credit-card-scan-ui-upload-513x1024.gif" decoding="async" loading="lazy" class="aligncenter wp-image-126675 size-full" src="../Images/71cd64938acc4678ab3504e42697ed4b.png" alt="Credit Card Scan UI Upload" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/credit-card-scan-ui-upload.gif"/></noscript>
<p> </p>
<h2 id="new-react-native-project">创建新的React本机项目</h2>
<p>首先，我们将创建一个新的React本地项目。如果您想在现有项目中添加信用卡扫描功能，可以跳过这一部分。</p>
<p>在您的首选文件夹目录中，在您的终端中运行以下命令来创建一个新的React本地项目:</p>
<pre class="language-bash hljs">npx react-native init &lt;project-name&gt; --template react-native-template-typescript
</pre>
<p>在您首选的IDE中打开项目，并用下面的代码替换<code>App.tsx</code>文件中的代码:</p>
<pre class="language-typescript hljs">import React from 'react';
import {SafeAreaView, Text} from 'react-native';

const App: React.FC = () =&gt; {
  return (
    &lt;SafeAreaView&gt;
      &lt;Text&gt;Credit Card Scanner&lt;/Text&gt;
    &lt;/SafeAreaView&gt;
  );
};

export default App;
</pre>
<p>现在，让我们运行应用程序。对于iOS，我们需要在构建项目之前安装pods:</p>
<pre class="language-typescript hljs">cd ios &amp;&amp; pod install &amp;&amp; cd ..</pre>
<p>然后，我们可以构建iOS项目:</p>
<pre class="language-typescript hljs">yarn ios</pre>
<p>对于Android，我们可以直接构建项目:</p>
<pre class="language-typescript hljs">yarn android</pre>
<p>上面的步骤将启动<a href="https://developers.facebook.com/blog/post/2021/11/01/eli5-metro-javascript-bundler-react-native/">地铁服务器</a>以及iOS和Android模拟器，然后在上面运行应用程序。目前，上面的代码在<code>App.tsx</code>中，我们只会看到一个空白的屏幕，上面显示着文本<code>Credit Card Scanner</code>。</p>
<h2 id="react-native-cardscan">什么是react-native-cardscan？</h2>
<p>react-native-cardscan 是围绕<a href="https://docs.getbouncer.com/"> CardScan </a>的包装器库，这是一个用于扫描借记卡和信用卡的极简库。react-native-cardscan为react本机应用程序中的信用卡扫描提供了简单的即插即用用法。但是，在撰写本文时，react-native-cardscan已不再被维护，并且已被弃用。Stripe正在将react-native-cardscan集成到自己的移动应用支付解决方案中<a href="https://blog.logrocket.com/exploring-the-new-stripe-react-native-sdk/">。您可以在GitHub </a>上查看<a href="https://github.com/stripe/stripe-android/tree/master/stripecardscan">新的资源库，然而，在撰写本文时，它仍在开发中。</a></p>
<p>由于这个库已经过时，我们将使用<a href="https://www.npmjs.com/package/react-native-text-recognition">react-native-text-recognition</a>创建我们自己的定制信用卡扫描逻辑。</p>
<h2 id="integrating-react-native-text-recognition">集成反应式原生文本识别</h2>
<p><a href="https://www.npmjs.com/package/react-native-text-recognition">react-native-text-recognition</a>是一个围绕iOS上的Vision框架和Android上的Firebase ML构建的包装器库。如果您在生产应用程序中实现卡片扫描，我建议您为文本识别创建自己的本机模块。然而，为了本教程的简单，我将使用这个库。</p>
<p>让我们编写扫描信用卡的代码。在我们集成文本识别之前，让我们添加我们需要的其他助手库，<a href="https://github.com/mrousavy/react-native-vision-camera">react-native-vision-camera</a>和<a href="https://www.npmjs.com/package/react-native-image-crop-picker">react-native-image-crop-picker</a>。我们将使用这些库分别从我们设备的摄像头捕捉照片和从手机图库中选取图像:</p>
<pre class="language-bash hljs">yarn add react-native-image-crop-picker react-native-vision-camera
// Install pods for iOS
cd ios &amp;&amp; pod install &amp;&amp; cd ..
</pre>
<p>如果您使用的是React Native v 0.69或更高版本，react-native-vision-camera将不会构建，因为在较新的架构中进行了更改。请按照此<a href="https://github.com/mrousavy/react-native-vision-camera/pull/1109"> PR </a>中的变化进行解析。</p>
<p>既然已经安装了我们的助手依赖项，让我们安装react-native-text-recognition:</p>
<pre class="language-bash hljs">yarn add react-native-text-recognition
pod install
</pre>
<p>设置好依赖关系后，让我们开始编写代码。将以下代码添加到<code>App.tsx</code>以实现图像拾取功能:</p>
<pre class="language-xml hljs">....
&lt;key&gt;NSPhotoLibraryUsageDescription&lt;/key&gt;
&lt;string&gt;Allow Access to Photo Library&lt;/string&gt;
....</pre>
<p>我们还需要在iOS上访问用户照片库的权限。为此，将下面的代码添加到您的iOS项目的<code>info.plist</code>文件中:</p>
<pre class="language-typescript hljs">import React from 'react';
import {SafeAreaView, Text, StatusBar, Pressable} from 'react-native';
import ImagePicker, {ImageOrVideo} from 'react-native-image-crop-picker';

const App: React.FC = () =&gt; {

  const pickAndRecognize: () =&gt; void = useCallback(async () =&gt; {
    ImagePicker.openPicker({
      cropping: false,
    })
      .then(async (res: ImageOrVideo) =&gt; {
        console.log('res:', res);
      })
      .catch(err =&gt; {
        console.log('err:', err);
      });
  }, []);

  return (
    &lt;SafeAreaView style={styles.container}&gt;
      &lt;StatusBar barStyle={'dark-content'} /&gt;
      &lt;Text style={styles.title}&gt;Credit Card Scanner&lt;/Text&gt;
      &lt;Pressable style={styles.galleryBtn} onPress={pickAndRecognize}&gt;
        &lt;Text style={styles.btnText}&gt;Pick from Gallery&lt;/Text&gt;
      &lt;/Pressable&gt;
    &lt;/SafeAreaView&gt;
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    alignItems: 'center',
    backgroundColor: '#fff',
  },
  title: {
    fontSize: 20,
    fontWeight: '700',
    color: '#111',
    letterSpacing: 0.6,
    marginTop: 18,
  },
  galleryBtn: {
    paddingVertical: 14,
    paddingHorizontal: 24,
    backgroundColor: '#000',
    borderRadius: 40,
    marginTop: 18,
  },
  btnText: {
    fontSize: 16,
    color: '#fff',
    fontWeight: '400',
    letterSpacing: 0.4,
  },
});

export default App;
</pre>
<p>在上面的代码中，我们向视图添加了一些文本和样式，但主要部分是我们声明了<code>pickAndRecognize</code>函数的地方。请记住，我们在这个函数中没有做任何与识别相关的事情；我们将其命名为这个，因为稍后我们将在这个函数中添加<code>Text Recognition</code>逻辑。</p>
<p>目前，上面代码的输出如下所示:</p>
<p><img data-attachment-id="126722" data-permalink="https://blog.logrocket.com/build-credit-card-scanner-react-native/attachment/implement-image-picking-functionality/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/implement-image-picking-functionality.gif" data-orig-size="738,1472" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="implement-image-picking-functionality" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/implement-image-picking-functionality-150x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/implement-image-picking-functionality-513x1024.gif" decoding="async" class="aligncenter wp-image-126722 size-full jetpack-lazy-image" src="../Images/2b51e5a81d8eefb0bae55bd6d4a0968e.png" alt="Implement Image Picking Functionality" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/implement-image-picking-functionality.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/implement-image-picking-functionality.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="126722" data-permalink="https://blog.logrocket.com/build-credit-card-scanner-react-native/attachment/implement-image-picking-functionality/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/implement-image-picking-functionality.gif" data-orig-size="738,1472" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="implement-image-picking-functionality" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/implement-image-picking-functionality-150x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/implement-image-picking-functionality-513x1024.gif" decoding="async" loading="lazy" class="aligncenter wp-image-126722 size-full" src="../Images/2b51e5a81d8eefb0bae55bd6d4a0968e.png" alt="Implement Image Picking Functionality" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/implement-image-picking-functionality.gif"/></noscript>
<p>现在，我们能够从用户的照片库中挑选图像。让我们添加从相机捕捉图像并在UI上查看相机预览的功能。</p>
<p>将以下代码添加到您的<code>App.tsx</code> return语句中:</p>
<pre class="language-typescript hljs">// Export the asset from a file like this or directly use it.
import {Capture} from './assets/icons'; 
....
&lt;SafeAreaView style={styles.container}&gt;
      ....
      {device &amp;&amp; hasPermissions ? (
        &lt;View&gt;
          &lt;Camera
            photo
            enableHighQualityPhotos
            ref={camera}
            style={styles.camera}
            isActive={true}
            device={device}
          /&gt;
          &lt;Pressable
            style={styles.captureBtnContainer}
            // We will define this method later
            onPress={captureAndRecognize}&gt;
            &lt;Image source={Capture} /&gt;
          &lt;/Pressable&gt;
        &lt;/View&gt;
      ) : (
        &lt;Text&gt;No Camera Found&lt;/Text&gt;
      )}
&lt;/SafeAreaView&gt;
</pre>
<p>添加相关样式:</p>
<pre class="language-css hljs">const styles = StyleSheet.create({
....
  camera: {
    marginVertical: 24,
    height: 240,
    width: 360,
    borderRadius: 20,
    borderWidth: 2,
    borderColor: '#000',
  },
  captureBtnContainer: {
    position: 'absolute',
    bottom: 28,
    right: 10,
  },
....
});
</pre>
<p>我们还需要创建一些状态变量和引用:</p>
<pre class="language-typescript hljs">const App: React.FC = () =&gt; {
  const camera = useRef&lt;Camera&gt;(null);
  const devices = useCameraDevices();
  let device: any = devices.back;
  const [hasPermissions, setHasPermissions] = useState&lt;boolean&gt;(false);
  ....
}
</pre>
<p>我们在相机视图上显示一个<code>Image</code>来选择图片。你可以继续<a href="https://icons8.com/icons/set/capture">下载资产</a>。</p>
<p>在我们预览摄像头之前，我们需要添加访问设备摄像头的权限。为此，将以下字符串添加到您的iOS项目的<code>info.plist</code>文件中:</p>
<pre class="language-xml hljs">....
&lt;key&gt;NSCameraUsageDescription&lt;/key&gt;
&lt;string&gt;Allow Access to Camera&lt;/string&gt;
....
</pre>
<p>对于Android，将下面的代码添加到您的<code>AndroidManifest.xml</code>文件中:</p>
<pre class="language-xml hljs">....
    &lt;uses-permission android:name="android.permission.CAMERA"/&gt;
....
</pre>
<p>当我们的应用程序加载后，我们需要向用户请求权限。让我们编写代码来实现这一点。将以下代码添加到您的<code>App.tsx</code>文件中:</p>
<pre class="language-typescript hljs">....
  useEffect(() =&gt; {
    (async () =&gt; {
      const cameraPermission: CameraPermissionRequestResult =
        await Camera.requestCameraPermission();
      const microPhonePermission: CameraPermissionRequestResult =
        await Camera.requestMicrophonePermission();
      if (cameraPermission === 'denied' || microPhonePermission === 'denied') {
        Alert.alert(
          'Allow Permissions',
          'Please allow camera and microphone permission to access camera features',
          [
            {
              text: 'Go to Settings',
              onPress: () =&gt; Linking.openSettings(),
            },
            {
              text: 'Cancel',
            },
          ],
        );
        setHasPermissions(false);
      } else {
        setHasPermissions(true);
      }
    })();
  }, []);
....
</pre>
<p>现在，我们的应用程序用户界面中有了一个可用的摄像头视图:</p>
<p><img data-attachment-id="126736" data-permalink="https://blog.logrocket.com/build-credit-card-scanner-react-native/attachment/working-camera-view-app-ui/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/working-camera-view-app-ui.gif" data-orig-size="400,848" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="working-camera-view-app-ui" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/working-camera-view-app-ui-142x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/working-camera-view-app-ui.gif" decoding="async" class="aligncenter wp-image-126736 size-full jetpack-lazy-image" src="../Images/5638a25a72bdc1d59d504c79a8579bd9.png" alt="Working Camera View App UI" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/working-camera-view-app-ui.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/working-camera-view-app-ui.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="126736" data-permalink="https://blog.logrocket.com/build-credit-card-scanner-react-native/attachment/working-camera-view-app-ui/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/working-camera-view-app-ui.gif" data-orig-size="400,848" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="working-camera-view-app-ui" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/working-camera-view-app-ui-142x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/working-camera-view-app-ui.gif" decoding="async" loading="lazy" class="aligncenter wp-image-126736 size-full" src="../Images/5638a25a72bdc1d59d504c79a8579bd9.png" alt="Working Camera View App UI" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/working-camera-view-app-ui.gif"/></noscript>
<p>现在我们的相机视图已经工作了，让我们添加代码来从相机中捕捉图像。</p>
<p>还记得我们想要从捕获按钮触发的<code>captureAndRecognize</code>方法吗？现在来定义一下。在<code>App.tsx</code>中添加下面的方法声明:</p>
<pre class="language-typescript hljs">....
  const captureAndRecognize = useCallback(async () =&gt; {
    try {
      const image = await camera.current?.takePhoto({
        qualityPrioritization: 'quality',
        enableAutoStabilization: true,
        flash: 'on',
        skipMetadata: true,
      });
      console.log('image:', image);
    } catch (err) {
      console.log('err:', err);
    }
  }, []);
....
</pre>
<p>类似于<code>pickAndRecognize</code>方法，我们还没有在这个方法中添加信用卡识别逻辑。我们将在下一步中这样做。</p>
<h2 id="writing-card-number-recognition-logic">书写卡号识别逻辑</h2>
<p>我们现在能够从设备的照片库和相机中获取图像。现在，我们需要编写逻辑，它将执行以下操作:</p>
<ul>
<li>将一个图像作为输入，并返回该图像中识别的所有文本的字符串数组</li>
<li>遍历数组中返回的字符串，检查每一项是否是潜在的信用卡号</li>
<li>如果我们找到一个信用卡号码，我们将返回该字符串和显示</li>
<li>如果我们没有找到任何匹配的字符串，那么我们显示一个错误，显示<code>No Valid Credit Card Found</code></li>
</ul>
<p>步骤非常简单。我们来写方法:</p>
<pre class="language-typescript hljs">const findCardNumberInArray: (arr: string[]) =&gt; string = arr =&gt; {
  let creditCardNumber = '';
  arr.forEach(e =&gt; {
    let numericValues = e.replace(/\D/g, '');
    const creditCardRegex =
      /^(?:4\[0-9]{12}(?:[0-9]{3})?|[25\][1-7]\[0-9]{14}|6(?:011|5[0-9\][0-9])\[0-9]{12}|3[47\][0-9]{13}|3(?:0\[0-5]|[68\][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/;
    if (creditCardRegex.test(numericValues)) {
      creditCardNumber = numericValues;
      return;
    }
  });
  return creditCardNumber;
};

const validateCard: (result: string[]) =&gt; void = result =&gt; {
    const cardNumber = findCardNumberInArray(result);
    if (cardNumber?.length) {
      setProcessedText(cardNumber);
      setCardIsFound(true);
    } else {
      setProcessedText('No valid Credit Card found, please try again!!');
      setCardIsFound(false);
    }
};
</pre>
<p>在上面的代码中，我们写了两个方法，<code>validateCard</code>和<code>findCardNumberInArray</code>。<code>validateCard</code>方法接受一个<code>string[]</code>参数或一个字符串数组。然后，它将该数组传递给<code>findCardNumberInArray</code>方法。如果在数组中找到信用卡号码字符串，此方法将返回它。否则，它返回一个空字符串。</p>
<p>然后，我们检查在<code>cardNumber</code>变量中是否有一个字符串。如果是，我们设置一些状态变量，否则，我们设置状态变量来显示一个错误。</p>
<p>让我们看看<code>findCardNumberInArray</code>方法是如何工作的。这个方法也接受一个<code>string[]</code>的参数。然后，它遍历数组中的<code>each</code>元素，并从字符串中去除所有非数值。最后，它用一个<code>regex</code>检查字符串，这个字符串检查一个字符串是否是一个有效的信用卡号。</p>
<p>如果字符串匹配<code>regex</code>，那么我们从方法中返回该字符串作为信用卡号。如果没有匹配<code>regex</code>的字符串，那么我们返回一个空字符串。</p>
<p>您还会注意到，我们还没有在代码中声明这些新的状态变量。让我们现在做那件事。将以下代码添加到您的<code>App.tsx</code>文件中:</p>
<pre class="language-typescript hljs">....
  const [processedText, setProcessedText] = React.useState&lt;string&gt;(
    'Scan a Card to see\nCard Number here',
  );
  const [isProcessingText, setIsProcessingText] = useState&lt;boolean&gt;(false);
  const [cardIsFound, setCardIsFound] = useState&lt;boolean&gt;(false);
....
</pre>
<p>现在，我们只需要在代码中插入<code>validateCard</code>方法。用下面各自的代码编辑您的<code>pickAndRecognize</code>和<code>captureAndRecognize</code>方法:</p>
<pre class="language-typescript hljs">....
  const pickAndRecognize: () =&gt; void = useCallback(async () =&gt; {
    ....
      .then(async (res: ImageOrVideo) =&gt; {
        setIsProcessingText(true);
        const result: string[] = await TextRecognition.recognize(res?.path);
        setIsProcessingText(false);
        validateCard(result);
      })
      .catch(err =&gt; {
        console.log('err:', err);
        setIsProcessingText(false);
      });
  }, []);

  const captureAndRecognize = useCallback(async () =&gt; {
    ....
      setIsProcessingText(true);
      const result: string[] = await TextRecognition.recognize(
        image?.path as string,
      );
      setIsProcessingText(false);
      validateCard(result);
    } catch (err) {
      console.log('err:', err);
      setIsProcessingText(false);
    }
  }, []);
....
</pre>
<p>就这样，我们结束了！我们只需要在我们的UI中显示输出。为此，将下面的代码添加到您的<code>App.tsx</code> return语句中:</p>
<pre class="language-typescript hljs">....
      {isProcessingText ? (
        &lt;ActivityIndicator
          size={'large'}
          style={styles.activityIndicator}
          color={'blue'}
        /&gt;
      ) : cardIsFound ? (
        &lt;Text style={styles.creditCardNo}&gt;
          {getFormattedCreditCardNumber(processedText)}
        &lt;/Text&gt;
      ) : (
        &lt;Text style={styles.errorText}&gt;{processedText}&lt;/Text&gt;
      )}
....
</pre>
<p>如果正在进行文本处理，上面的代码会显示一个<code>ActivityIndicator</code>或loader。如果我们找到了一张信用卡，它会以文本形式显示出来。您还会注意到我们使用了一个<code>getFormattedCreditCardNumber</code>方法来呈现文本。接下来我们再写。如果所有条件都是<code>false</code>，那么这意味着我们有一个错误，所以我们用错误样式显示文本。</p>
<p>现在我们来声明<code>getFormattedCreditCardNumber</code>方法。将以下代码添加到您的<code>App.tsx</code>文件中:</p>
<pre class="language-typescript hljs">....

const getFormattedCreditCardNumber: (cardNo: string) =&gt; string = cardNo =&gt; {
  let formattedCardNo = '';
  for (let i = 0; i &lt; cardNo?.length; i++) {
    if (i % 4 === 0 &amp;&amp; i !== 0) {
      formattedCardNo += ` • ${cardNo?.[i]}`;
      continue;
    }
    formattedCardNo += cardNo?.[i];
  }
  return formattedCardNo;
};
....
</pre>
<p>上面的方法有一个参数<code>cardNo</code>，它是一个<code>string</code>。然后，它遍历<code>cardNo</code>，并在每四个字母后插入一个<code>•</code>字符。这只是一个格式化信用卡号码字符串的实用函数。</p>
<p>我们的最终输出用户界面将如下所示:</p>
<p><img data-attachment-id="126755" data-permalink="https://blog.logrocket.com/build-credit-card-scanner-react-native/attachment/final-ui-output-credit-card-scanner/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/final-ui-output-credit-card-scanner.gif" data-orig-size="400,848" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="final-ui-output-credit-card-scanner" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/final-ui-output-credit-card-scanner-142x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/final-ui-output-credit-card-scanner.gif" decoding="async" class="aligncenter wp-image-126755 size-full jetpack-lazy-image" src="../Images/0442bf1f7159c5addb355e1c645cb9e7.png" alt="Final UI Output Credit Card Scanner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/final-ui-output-credit-card-scanner.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/final-ui-output-credit-card-scanner.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="126755" data-permalink="https://blog.logrocket.com/build-credit-card-scanner-react-native/attachment/final-ui-output-credit-card-scanner/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/final-ui-output-credit-card-scanner.gif" data-orig-size="400,848" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="final-ui-output-credit-card-scanner" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/final-ui-output-credit-card-scanner-142x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/final-ui-output-credit-card-scanner.gif" decoding="async" loading="lazy" class="aligncenter wp-image-126755 size-full" src="../Images/0442bf1f7159c5addb355e1c645cb9e7.png" alt="Final UI Output Credit Card Scanner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/final-ui-output-credit-card-scanner.gif"/></noscript>
<h2 id="conclusion">结论</h2>
<p>在本文中，我们学习了如何通过添加信用卡扫描功能来改进我们的移动应用程序。使用<a href="https://www.npmjs.com/package/react-native-text-recognition">react-native-text-recognition</a>库，我们设置我们的应用程序从我们设备的摄像头捕捉照片，并从phone gallery中选取图像，识别16位信用卡号码。</p>
<p>文本识别不仅仅局限于信用卡扫描。您可以使用它来解决许多其他的业务问题，比如为特定的任务(如收据、名片等等)自动输入数据！感谢您的阅读。我希望你喜欢这篇文章，如果你有任何问题，一定要留下评论。</p><div class="code-block code-block-18">
<div class="blog-plug inline-plug react-native-plug"><h2><a href="https://lp.logrocket.com/blg/react-native-signup"> LogRocket </a>:即时重现React原生应用中的问题。</h2><a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/110055665562c1e02069b3698e6cc671.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/110055665562c1e02069b3698e6cc671.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/></noscript></a><p><a href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一款React原生监控解决方案，可帮助您即时重现问题、确定bug的优先级并了解React原生应用的性能。</p><p>LogRocket还可以向你展示用户是如何与你的应用程序互动的，从而帮助你提高转化率和产品使用率。LogRocket的产品分析功能揭示了用户不完成特定流程或不采用新功能的原因。</p><p>开始主动监控您的React原生应用— <a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer">免费试用LogRocket】。</a></p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>