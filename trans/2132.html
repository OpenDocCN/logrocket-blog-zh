<html>
<head>
<title>Implementing SVG in Flutter with flutter_svg - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用 flutter_svg - LogRocket 博客在 Flutter 中实现 SVG</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/implement-svg-flutter-apps/#0001-01-01">https://blog.logrocket.com/implement-svg-flutter-apps/#0001-01-01</a></blockquote><div><article class="article-post">
<p><a href="https://developer.mozilla.org/en-US/docs/Web/SVG" target="_blank" rel="noopener">可缩放矢量图形(SVG) </a>是应用中最广泛使用的文件图像格式之一。因为它比位图文件有几个优点，特别是在缩放时保持图像质量，如果不首先考虑使用 SVG，很难开始构建一个<a href="https://blog.logrocket.com/tag/flutter/" target="_blank" rel="noopener"> Flutter 应用程序</a>。</p>
<p>在本文中，您将了解如何以及何时在 Flutter 应用程序中使用 SVG 文件。</p>
<h2>SVG 在颤振中的应用</h2>
<p><a href="https://skia.org/" target="_blank" rel="noopener"> Skia </a>是 2D 图形库，也是 Flutter 的核心组件，只能将图像序列化为 SVG 文件。因此，用 Skia 对 SVG 图像进行<a href="https://github.com/flutter/flutter/issues/1831?spm=a2c65.11461447.0.0.2c7e5eaceB070w" target="_blank" rel="noopener">解码或渲染是不可能的。幸运的是，社区提供了一个奇妙的</a><a href="https://pub.dev/packages/flutter_svg" target="_blank" rel="noopener"> Dart 原生包，名为 flutter_svg </a>，可以快速渲染和解码 svg。</p>
<h2>什么是 flutter_svg？</h2>
<p>flutter_svg 包实现了一个图片缓存，存储了一个<code>ui:Picture</code>类。这是 Skia 图形引擎的<code>SkPicture</code>包装器，它以二进制模式记录特定的 SVG 渲染命令。</p>
<p><code>ui.Picture</code>类不消耗太多内存，并且被缓存以避免重复解析 XML 文件。我们来看看<code>SvgPicture.asset</code>构造函数:</p>
<pre class="language-dart hljs">SvgPicture.asset(
  String assetName, {
  Key? key,
  this.matchTextDirection = false,
  AssetBundle? bundle,
  String? package,
  this.width,
  this.height,
  this.fit = BoxFit.contain,
  this.alignment = Alignment.center,
  this.allowDrawingOutsideViewBox = false,
  this.placeholderBuilder,
  Color? color,
  BlendMode colorBlendMode = BlendMode.srcIn,
  this.semanticsLabel,
  this.excludeFromSemantics = false,
  this.clipBehavior = Clip.hardEdge,
  this.cacheColorFilter = false,
})  : pictureProvider = ExactAssetPicture(
        allowDrawingOutsideViewBox == true
            ? svgStringDecoderOutsideViewBox
            : svgStringDecoder,
        assetName,
        bundle: bundle,
        package: package,
        colorFilter: svg.cacheColorFilterOverride ?? cacheColorFilter
            ? _getColorFilter(color, colorBlendMode)
            : null,
      ),
      colorFilter = _getColorFilter(color, colorBlendMode),
      super(key: key);
</pre>
<p>通过查看实现，您会注意到来自<code>pictureProvider</code>的流通知更新了<code>SvgPicture</code>的图片。</p>
<pre class="language-dart hljs"> void _resolveImage() {
final PictureStream newStream = widget.pictureProvider
.resolve(createLocalPictureConfiguration(context));
assert(newStream != null); // ignore: unnecessary_null_comparison
_updateSourceStream(newStream);
}
</pre>
<p>在这个代码块中，来自<code>pictureProvider</code>的流由图片缓存的完成器用<code>ui.Picture</code>填充。</p>
<pre class="language-dart hljs">PictureStream resolve(PictureConfiguration picture,
    {PictureErrorListener? onError}) {
  // ignore: unnecessary_null_comparison
  assert(picture != null);
  final PictureStream stream = PictureStream();
  T? obtainedKey;
  obtainKey(picture).then&lt;void&gt;(
    (T key) {
      obtainedKey = key;
      stream.setCompleter(
        cache.putIfAbsent(
          key!,
          () =&gt; load(key, onError: onError),
        ),
      );
    },
  ).catchError((Object exception, StackTrace stack) async {
    if (onError != null) {
      onError(exception, stack);
      return;
    }
    FlutterError.reportError(FlutterErrorDetails(
        exception: exception,
        stack: stack,
        library: 'SVG',
        context: ErrorDescription('while resolving a picture'),
        silent: true, // could be a network error or whatnot
        informationCollector: () sync* {
          yield DiagnosticsProperty&lt;PictureProvider&gt;(
              'Picture provider', this);
          yield DiagnosticsProperty&lt;T&gt;('Picture key', obtainedKey,
              defaultValue: null);
        }));
  });
  return stream;
}
</pre>
<h2>添加 flutter_svg 插件</h2>
<p>要将这个包添加到您的 Flutter 依赖项中，您可以运行:</p>
<pre class="language-dart hljs">flutter pub add flutter_svg
</pre>
<p>或者，您可以将 flutter_svg 添加到您的<code>pubspec.yaml</code>文件中:</p>
<pre class="language-dart hljs">dependencies:
  flutter_svg: ^0.22.0
</pre>
<p>确保在终端或使用编辑器运行<code>flutter pub get</code>。安装完成后，在您想要使用该软件包的 Dart 代码中导入该软件包:</p>
<pre class="language-dart hljs">import 'package:flutter_svg/flutter_svg.dart';
</pre>
<h2>在你的 flutter 应用中使用 flutter_svg</h2>
<p>有几种方法可以使用这个包，但是我们将讨论最常见的用例。</p>
<p>一种选择是从内部 SVG 文件加载 SVG，该文件通常存储在<code>asset</code>文件夹中:</p>
<pre class="language-dart hljs">// example
final String assetName = 'assets/image.svg';
final Widget svg = SvgPicture.asset(
assetName,
);</pre>
<p>您也可以从 URL 加载 SVG 文件，如下所示:</p>
<pre class="language-dart hljs">// example
final Widget networkSvg = SvgPicture.network(
  'https://site-that-takes-a-while.com/image.svg',
);</pre>
<p>最后，您可以从 SVG 代码加载 SVG:</p>
<pre class="language-dart hljs">// example
SvgPicture.string(
  '''&lt;svg viewBox="..."&gt;...&lt;/svg&gt;'''
);</pre>
<h2>在 Flutter 中扩展 SVG 功能</h2>
<p>载入 SVG 文件后，第一步是更改图像的颜色或色调:</p>
<pre class="language-dart hljs">// example
final String assetName = 'assets/up_arrow.svg';
final Widget svgIcon = SvgPicture.asset(
  assetName,
  color: Colors.red,
);
</pre>
<p>使用语义标签有助于描述图像的目的并增强可访问性。要实现这一点，您可以添加<code>semanticsLabel</code>参数。语义标签不会显示在 UI 中。</p>
<pre class="language-dart hljs">// example
final String assetName = 'assets/up_arrow.svg';
final Widget svgIcon = SvgPicture.asset(
  assetName,
  color: Colors.red,
  semanticsLabel: 'A red up arrow'
);
</pre>
<p>如果在<code>SvgPicture</code>上没有<code>height</code>或<code>width</code>赋值，那么 flutter_svg 包将呈现一个空框<code>LimitedBox</code>，作为默认占位符。但是，如果在<code>SvgPicture</code>上指定了<code>height</code>或<code>width</code>，则会渲染一个<code>SizedBox</code>以确保更好的布局体验。</p>
<p>不过，占位符可以被替换，这对于改善用户体验很有好处，特别是当通过网络请求加载资产时，可能会有延迟。</p>
<pre class="language-dart hljs">// example
final Widget networkSvg = SvgPicture.network(
  'https://site-that-takes-a-while.com/image.svg',
  semanticsLabel: 'A shark?!',
  placeholderBuilder: (BuildContext context) =&gt; Container(
      padding: const EdgeInsets.all(30.0),
      child: const CircularProgressIndicator()),
);
</pre>
<p>在这个例子中，我选择了<code>CircularProgressIndicator</code>在图像加载时显示进度指示器。你可以添加任何你想要的其他部件。例如，您可以使用一个定制的加载小部件来替换<code>CircularProgressIndicator</code>。</p>
<h2>检查 SVG 与 flutter_svg 的兼容性</h2>
<p>要知道 flutter_svg 库并不支持所有的 svg 特性。然而，这个包确实提供了一个助手方法来确保你不会因为缺少支持的特性而渲染一个损坏的图像。</p>
<pre class="language-dart hljs">// example 
final SvgParser parser = SvgParser();
try {
  parser.parse(svgString, warningsAsErrors: true);
  print('SVG is supported');
} catch (e) {
  print('SVG contains unsupported features');
}
</pre>
<p>请注意，该库目前只检测不支持的元素，如<code>&lt;style&gt;</code>标签，但不识别不支持的属性。</p>
<h2>推荐的 Adobe Illustrator SVG 配置</h2>
<p>要在 Adobe Illustrator 中充分利用 flutter_svg，您需要遵循以下具体建议:</p>
<ol>
<li>   <ol>
<li>   <ul>
<li>样式:选择表示属性而不是内联 CSS，因为 CSS 不被完全支持</li>
<li>图像:选择嵌入而不是链接到另一个文件，以获得不依赖于其他文件的单个 SVG</li>
<li>对象 id:选择图层名称以便为 SVG 标签的每个图层添加一个名称，或者使用最少的图层名称——这是您的选择！</li>
</ul>
</li>
</ol>
</li>
</ol>
<h2><img data-attachment-id="65730" data-permalink="https://blog.logrocket.com/implement-svg-flutter-apps/svg-flutter-image-options/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/09/SVG-Flutter-image-options.png" data-orig-size="401,341" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="SVG-Flutter-image-options" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/09/SVG-Flutter-image-options-300x255.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/09/SVG-Flutter-image-options.png" decoding="async" class="aligncenter size-full wp-image-65730 jetpack-lazy-image" src="../Images/225410b079a016ad38b4f3401ed21fea.png" alt="SVG flutter image options" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/09/SVG-Flutter-image-options.png 401w, https://blog.logrocket.com/wp-content/uploads/2021/09/SVG-Flutter-image-options-300x255.png 300w" data-lazy-sizes="(max-width: 401px) 100vw, 401px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/09/SVG-Flutter-image-options.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/09/SVG-Flutter-image-options.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="65730" data-permalink="https://blog.logrocket.com/implement-svg-flutter-apps/svg-flutter-image-options/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/09/SVG-Flutter-image-options.png" data-orig-size="401,341" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="SVG-Flutter-image-options" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/09/SVG-Flutter-image-options-300x255.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/09/SVG-Flutter-image-options.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-65730" src="../Images/225410b079a016ad38b4f3401ed21fea.png" alt="SVG flutter image options" srcset="https://blog.logrocket.com/wp-content/uploads/2021/09/SVG-Flutter-image-options.png 401w, https://blog.logrocket.com/wp-content/uploads/2021/09/SVG-Flutter-image-options-300x255.png 300w" sizes="(max-width: 401px) 100vw, 401px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/09/SVG-Flutter-image-options.png"/>T3】</noscript></h2>
<h2>在另一个画布中渲染 SVG 文件</h2>
<p>有时，您可能希望将 SVG 渲染到另一个画布中。<code>SVGPicture</code>帮助您轻松实现这一目标:</p>
<pre class="language-dart hljs">// example
final String rawSvg = '''&lt;svg viewBox="..."&gt;...&lt;/svg&gt;''';
final DrawableRoot svgRoot = await svg.fromSvgString(rawSvg, rawSvg);
final Picture picture = svgRoot.toPicture();
svgRoot.scaleCanvasToViewBox(canvas);
svgRoot.clipCanvasToViewBox(canvas);
svgRoot.draw(canvas, size);
</pre>
<h2>结论</h2>
<p>使用 SVG 文件可以极大地增加你的 Flutter 应用程序，但是 SVG 并不总是解决所有图像问题的正确答案。观察您的用例并持续测量您的应用程序和 SVG 性能至关重要，因为您可能需要用另一种标准图像格式来替换 SVG，如 PNG 或 JPEG。</p>
<p>虽然 Flutter 本身并不支持 svg，但 Dart 原生的 flutter_svg 包对 SVG 文件有着出色的性能和快速的支持。该软件包使用起来也相对简单。</p>
<p>请记住，包版本仍然低于 1.0.0，这可能会破坏 API 中的更改。然而，作者已经尽可能地保持了 API 的稳定性。当使用 flutter_svg 时，确保您总是在<a href="https://pub.dev/" target="_blank" rel="noopener"> pub.dev </a>上检查软件包的最新版本，以保持最新。感谢阅读！</p>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>