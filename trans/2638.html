<html>
<head>
<title>React 18, React Redux 8, and TypeScript: What you need to know - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>React 18，React Redux 8，和 TypeScript:你需要知道的</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/react-18-redux-8-typescript/#0001-01-01">https://blog.logrocket.com/react-18-redux-8-typescript/#0001-01-01</a></blockquote><div><article class="article-post">
<p>React 18 目前正在开发中，React Redux 8(React 状态管理库)正在同时构建，以整合 React 18 将提供的所有新功能，包括服务器端渲染(SSR)、过渡和自动批量渲染。</p>
<p>React Redux 8 中的另一个重大变化是将其整个代码库转换为 TypeScript，这使得用户更容易编写类型安全的代码并生成无错误的应用程序。</p>
<p>在本文中，我们将探讨这一变化如何影响开发者，由于 React Redux 8 目前处于测试阶段，我们将测试它与 React 18 的测试版的兼容性。</p>
<h2>将现有应用程序升级到 React Redux 8</h2>
<p>这里的目标是看看升级应用程序中的 React Redux 版本会对它产生什么影响——我们希望在升级后发现应用程序中的重大更改和意外行为。</p>
<p>让我们克隆并升级这个由 Jack Herrington 开发的<a href="https://github.com/jherr/no-bs-ts/tree/master/series-1/episode-27">简单待办应用程序</a>,对其进行手工检查，并强调必须做出的 React Redux 8 特有的更改。</p>
<p>您可以随意使用 React Redux 官方教程中的<a href="https://react-redux.js.org/tutorials/quick-start">示例应用程序，或者 React Redux 文档中链接的任何示例代码沙箱。或者，如果您想要更新现有的</a><a href="https://blog.logrocket.com/comprehensive-guide-to-using-redux-in-react-native/"> React Redux 应用程序</a>，您可以使用它来代替。</p>
<p>待办应用是用 React 17 和 Redux 8 构建的，所以我们会更新到这两个包的最新版本。要将 React Redux 8 添加到现有 React 应用程序，请使用 npm 运行以下命令:</p>
<pre class="language-javascript hljs">npm i <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e49681858790c9968180919ca48a819c90">[email protected]</a>
</pre>
<p>要将应用程序的 React 版本升级到 React 18，请运行以下命令:</p>
<pre class="language-javascript hljs">npm install <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d5a7b0b4b6a195a7b6">[email protected]</a> <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3a485f5b594e175e55577a4859">[email protected]</a>
</pre>
<p>React 18 提供了一个新的根 API<code>createRoot</code>，可以更高效地运行更新。旧的那个<code>ReactDOM.render</code>，现在已经弃用了。</p>
<p>要使用它，导航到应用程序的<code>src</code>文件夹中的<code>index.tsx</code>文件，并执行以下代码块:</p>
<pre class="language-javascript hljs">ReactDOM.render(
  &lt;React.StrictMode&gt;
    &lt;App /&gt;
  &lt;/React.StrictMode&gt;,
  document.getElementById('root')
);
</pre>
<p>然后将其替换为以下内容:</p>
<pre class="language-javascript hljs">const root = ReactDOM.createRoot(
  document.getElementById("root") as HTMLDivElement
);
root.render(&lt;App /&gt;);
</pre>
<p>接下来，导航到您的<code>tsconfig.json</code>文件并添加以下行:</p>
<pre class="language-javascript hljs">{
  "compilerOptions": {
    ...,
    "types": ["react/next", "react-dom/next"]
  },
  ...
}
</pre>
<p>现在，您的应用运行新的根 API<code>createRoot</code>，使 React 18 中的改进可用于您的应用。请注意，React 18 同时提供了遗留根 API 和新的根 API，因此如果您希望获得新的根 API 带来的性能改进，您可以选择只使用新的根 API。</p>
<p>但是，如果您坚持使用旧的 API，您将会收到推荐新 API 的反对消息。要将 React Redux 升级到版本 8，请运行以下命令:</p>
<pre class="language-bash hljs">npm i <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ddafb8bcbea9f0afb8b9a8a59db3b8a5a9">[email protected]</a></pre>
<h3>检查重大变更</h3>
<p>现在，该应用程序可以与 React Redux 8 一起工作。要运行应用程序并观察重大更改和意外行为，请运行以下命令:</p>
<pre class="language-bash hljs">npm start
</pre>
<p>接下来，在浏览器中导航至<code>http//localhost:3000</code>。经过检查，我们看到待办事项列表应用程序功能正常。填充文本框并点击<strong>添加待办事项</strong>按钮更新 UI，点击项目旁边的<strong>移除</strong>按钮删除它。</p>
<p><img data-attachment-id="90810" data-permalink="https://blog.logrocket.com/react-18-redux-8-typescript/example-to-do-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/02/example-to-do-app.png" data-orig-size="730,373" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="example to-do app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/02/example-to-do-app-300x153.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/02/example-to-do-app.png" decoding="async" class="aligncenter size-full wp-image-90810 jetpack-lazy-image" src="../Images/1a16dcf061d63a462338d588b936641c.png" alt="Example Of A React 18 To-Do App With Redux 8" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/02/example-to-do-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/02/example-to-do-app-300x153.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/02/example-to-do-app.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/02/example-to-do-app.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="90810" data-permalink="https://blog.logrocket.com/react-18-redux-8-typescript/example-to-do-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/02/example-to-do-app.png" data-orig-size="730,373" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="example to-do app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/02/example-to-do-app-300x153.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/02/example-to-do-app.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-90810" src="../Images/1a16dcf061d63a462338d588b936641c.png" alt="Example Of A React 18 To-Do App With Redux 8" srcset="https://blog.logrocket.com/wp-content/uploads/2022/02/example-to-do-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/02/example-to-do-app-300x153.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/02/example-to-do-app.png"/></noscript>
<p>在这里，没有突破性的更改或意外的行为，因为所有的更改都是在幕后进行的，公共 API 保持不变(<code>connect</code>和<code>useSelector</code>)。</p>
<p>没有添加新功能，没有更改 TypeScript 类型，也不需要更改语法。这个版本与前一个版本具有完全相同的功能；正如我们所看到的，将应用程序升级到 React Redux 8 所需的唯一步骤是修改软件包版本。</p>
<p>在确认了新的 React Redux 版本不需要语法更改或复杂的步骤之后，让我们放大一下 Redux 团队内部所做的更改，以及目前处于测试阶段的 React 18 的进展。</p>
<h2>React Redux 8 的显著变化</h2>
<h3>已将基本代码转换为类型脚本</h3>
<p>React Redux 以前的版本(版本 7 及以下)是用普通 JavaScript 编写的。要在这些版本中使用 TypeScript，类型必须从不同的、由社区维护的包<code>@types/react-redux</code>中导入。</p>
<p>但是在版本 8 中，所有的类型都被导入到主包中，不再需要<code>@types/react-redux</code>包。事实上，如果你升级到 React Redux 8，而你的 app 使用了<code>@types/react-redux</code>包，你必须移除那个包。</p>
<h3>与 React 18 的兼容性</h3>
<p>在版本 8 中，React Redux 的两个公共 API(<code>connect</code>和<code>useSelector</code>)被重写以支持 React 18。</p>
<p>React 18 附带的<a href="https://blog.logrocket.com/exploring-react-18-three-new-apis/">新 API 之一是<code>useSyncExternalStore</code>。这使开发人员能够访问新功能，如支持并发渲染和自动渲染批处理。</a></p>
<p>React Redux 的<code>connect</code>和<code>useSelector</code>也被重新编写，以便在内部调用这个新的 API。</p>
<h3>现代化的构建输出</h3>
<p>现代 JavaScript 代码生成的文件非常小，运行速度非常快。然而，由于像 Internet Explorer 11 这样的传统浏览器只支持 ES5 而不支持更高版本，React Redux 的以前版本编译为 ES5 以在 Internet Explorer 11 上运行。</p>
<p>现在，Internet Explorer 11 不再真正起作用，React Redux 编译到 ES2017，利用现代浏览器中的一些内置支持，并创建大小更小的捆绑包。如果您仍然需要对遗留浏览器的支持，您将需要编译自己的依赖项。</p>
<h3>移除了未使用的传统 API</h3>
<p>随着<a href="https://blog.logrocket.com/use-hooks-and-context-not-react-and-redux/">钩子的出现，React Redux 的</a> <code>connectAdvanced</code> API 变得几乎无关紧要，只是给包增加了不必要的复杂性。在版本 8 中它已经被删除了。</p>
<p>另一个几乎不再使用的遗留代码是<code>connect</code>的<code><a href="https://react-redux.js.org/api/connect#pure-boolean">pure</a></code> <a href="https://react-redux.js.org/api/connect#pure-boolean">选项</a>。随着 React 的发展，<code>pure</code>标志，就像<code>connectAdvanced</code> API 一样，已经变得几乎无关紧要了。在版本 8 中它也被删除了。</p>
<h2>React Redux 8 和 React 18 的新特性</h2>
<h3>自动渲染批处理</h3>
<p>批处理是指多个状态更新同时触发，并且它们的响应呈现同时发生。对于 React 的早期版本，只有当触发器是正常函数时，才会发生这种情况。</p>
<p>如果多个状态更新是由承诺或回调触发的，它们的响应不会同时呈现。在 React 18 中，所有渲染都是批处理的，这意味着它们将同时发生，不管它们的触发器是什么。下面是一个常规函数的例子:</p>
<pre class="language-javascript hljs">function App() {
  const [stateOne, setstateOne] = useState(false);
  const [stateTwo, setstateTwo] = useState(false);

  function handleClick() {
    setstateOne(val =&gt; !val); // set the first state
    setstateTwo(val =&gt; !val); // set the second state
    // In React 18, both states will be changed from false to true at 
    //the same time
  }

  return (
    &lt;div&gt;
      &lt;button onClick={handleClick}&gt;Click Me&lt;/button&gt;
    &lt;/div&gt;
  );
}
</pre>
<p>这里有一个承诺的例子:</p>
<pre class="language-javascript hljs">    fetchData()
      .then(()=&gt; {
          setstateOne(val =&gt; !val); // set the first state
          setstateTwo(val =&gt; !val); // set the second state
          // In React 18, both states will be changed from false to 
          //true at the same time
    })
</pre>
<h3>服务器端渲染</h3>
<p>有了<code>Suspense</code>，React 18 通过使异步提供应用程序的各个部分成为可能，对 SSR 进行了重大的性能改进。服务器端呈现允许您从提供的 React 组件生成 HTML 文本，然后加载 JavaScript 代码并与 HTML 合并(称为水合)。</p>
<p>现在，有了<code>Suspense</code>，你可以将你的应用分成小的、独立的单元，这些单元可以在没有应用的其余部分的情况下独立呈现，允许内容比以前更快地提供给你的用户。</p>
<p>假设您有两个组件:一个文本组件和一个图像组件。如果你像这样把它们叠在一起:</p>
<pre class="language-javascript hljs"> &lt;Text /&gt;
 &lt;Image /&amp;gt;
</pre>
<p>然后，服务器试图立刻呈现它们，减慢了整个页面的速度。如果文本对你的读者来说更重要，你可以通过将<code>Image</code>组件放在<code>Suspense</code>标签中，使其优先于图像:</p>
<pre class="language-javascript hljs">    &lt;Text /&gt;
    &lt;Suspense fallback={&lt;Spinner /&gt;}&gt;
         &lt;Image /&gt;   
    &lt;/Suspense&gt;
</pre>
<p>这一次，服务器首先为您的文本组件提供服务，当您的图像等待加载时，会显示一个微调器。</p>
<h3>过渡</h3>
<p>React 应用程序是交互式的，但如果你希望你的应用程序在用户与它交互时不断更新自己，这种不断更新会大大降低你的应用程序的速度，并提供糟糕的用户体验。</p>
<p>这就是<code>startTransition</code> API 的用武之地。有了它，你可以定义哪个更新是紧急的，哪个不是(次要的)。这样，您可以将紧急更新置于次要更新之上，次要更新可以移到后台，或者在不再需要时完全跳过。</p>
<h2>结论</h2>
<p>如果您升级现有的<a href="https://blog.logrocket.com/why-use-redux-reasons-with-clear-examples-d21bffd5835/"> React Redux 应用程序</a>,它们应该可以正常工作。然而，如果你遇到任何突破性的变化或意想不到的行为，Redux 团队目前正在<a href="https://github.com/reduxjs/react-redux/discussions/1843">这里</a>接受反馈，以在最终版本发布前解决任何问题。</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720"><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener"> LogRocket </a>:全面了解您的生产 React 应用</h2><p>调试 React 应用程序可能很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪 Redux 状态、自动显示 JavaScript 错误以及跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" vwo-el-id="19356441070">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<p vwo-el-id="28675660440" class="">LogRocket 结合了会话回放、产品分析和错误跟踪，使软件团队能够创建理想的 web 和移动产品体验。这对你来说意味着什么？</p>
<p>LogRocket 不是猜测错误发生的原因，也不是要求用户提供截图和日志转储，而是让您回放问题，就像它们发生在您自己的浏览器中一样，以快速了解哪里出错了。</p>
<p>不再有嘈杂的警报。智能错误跟踪允许您对问题进行分类，然后从中学习。获得有影响的用户问题的通知，而不是误报。警报越少，有用的信号越多。</p>
<p vwo-el-id="28675660750">LogRocket Redux 中间件包为您的用户会话增加了一层额外的可见性。LogRocket 记录 Redux 存储中的所有操作和状态。</p>
<p vwo-el-id="28675661060">现代化您调试 React 应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">开始免费监控</a>。</p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>