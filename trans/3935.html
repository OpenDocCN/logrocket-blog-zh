<html>
<head>
<title>How to create a video and audio recorder in React </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在React中创建视频和音频记录器</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/how-to-create-video-audio-recorder-react/#0001-01-01">https://blog.logrocket.com/how-to-create-video-audio-recorder-react/#0001-01-01</a></blockquote><div><article class="article-post">
<p>在当今世界，远程和混合工作越来越受欢迎，组织需要在日常运营中采用异步通信形式。这些包括记录或做会议笔记，使用更多的文本交流形式等。有许多应用程序具有这些功能，使得异步通信更容易采用。</p>
<p>在本文中，您将了解如何使用<a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder"> MediaRecorder API </a>为React应用程序添加视频和音频录制功能。</p>
<p>向前跳:</p>

<h2 id="prerequisites">先决条件</h2>
<ul>
<li>安装在计算机上的Node.js</li>
<li>JavaScript和React的工作知识</li>
</ul>
<h2 id="scaffolding-new-react-app">搭建新的React应用</h2>
<p>首先，我们将使用<a href="https://blog.logrocket.com/getting-started-with-vite/"> Vite </a>搭建一个新的React应用程序，这是一个超快速的JavaScript构建工具:</p>
<pre class="language-bash hljs">npm create <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9aecf3eeffdaf6fbeeffe9ee">[email protected]</a>
</pre>
<p>要回答命令后的提示，请执行以下操作:</p>
<ul>
<li>键入项目名称(<code>react-recorder</code>)</li>
<li>选择<code>React</code>作为框架</li>
<li>选择<code>Javascript</code>变量</li>
</ul>
<p>接下来，让我们导航到新创建的项目目录，安装所需的依赖项，并使用以下命令运行开发服务器:</p>
<pre class="language-bash hljs">cd react-recorder &amp;&amp; npm i &amp;&amp; npm run dev
</pre>
<p>一旦完成，服务器将在<code><a href="http://localhost:5173/" rel="nofollow">http://localhost:5173/</a></code>启动。让我们在网络浏览器上打开URL。我们应该看到以下内容:</p>
<p><img data-attachment-id="159120" data-permalink="https://blog.logrocket.com/how-to-create-video-audio-recorder-react/attachment/open-vite-web-browser/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/open-vite-web-browser.png" data-orig-size="730,456" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Opening Vite on our web browser" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/open-vite-web-browser-300x187.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/open-vite-web-browser.png" decoding="async" class="aligncenter size-full wp-image-159120 jetpack-lazy-image" src="../Images/26c526d3d0d7b8e7cf0b650a8567531e.png" alt="Opening Vite On Our Web Broswer" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/02/open-vite-web-browser.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/02/open-vite-web-browser-300x187.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/02/open-vite-web-browser.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/open-vite-web-browser.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="159120" data-permalink="https://blog.logrocket.com/how-to-create-video-audio-recorder-react/attachment/open-vite-web-browser/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/open-vite-web-browser.png" data-orig-size="730,456" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Opening Vite on our web browser" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/open-vite-web-browser-300x187.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/open-vite-web-browser.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-159120" src="../Images/26c526d3d0d7b8e7cf0b650a8567531e.png" alt="Opening Vite On Our Web Broswer" srcset="https://blog.logrocket.com/wp-content/uploads/2023/02/open-vite-web-browser.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/02/open-vite-web-browser-300x187.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/open-vite-web-browser.png"/></noscript>

<p>要在浏览器上录制音频或视频，需要<code>MediaStream</code>。<code>MediaStream</code>是表示媒体内容的界面，由音频和视频轨道组成。</p>
<p>要获得一个<code>MediaStream</code>对象，可以使用<code>MediaStream()</code>构造函数或者调用以下函数:<code><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia">MediaDevices.getUserMedia()</a></code>、<code><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getDisplayMedia">MediaDevices.getDisplayMedia()</a></code>或者<code><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/captureStream">HTMLCanvasElement.captureStream()</a></code>。</p>
<p>出于本教程的考虑，我们将关注于<code>MediaDevices.getuserMedia</code>函数来创建一个视频和音频记录器。</p>
<h2 id="creating-demo-app-interface">创建演示应用程序界面</h2>
<p>在本节中，我们将创建演示应用程序的界面。</p>
<h3 id="audio-recorder-component">录音机组件</h3>
<p>首先，在<code>src</code>目录中创建一个名为<code>AudioRecorder.jsx</code>的文件，并将以下代码块的内容粘贴到其中:</p>
<pre class="language-javascript hljs">import { useState, useRef } from "react";
const AudioRecorder = () =&gt; {
    const [permission, setPermission] = useState(false);
    const [stream, setStream] = useState(null);

    const getMicrophonePermission = async () =&gt; {
        if ("MediaRecorder" in window) {
            try {
                const streamData = await navigator.mediaDevices.getUserMedia({
                    audio: true,
                    video: false,
                });
                setPermission(true);
                setStream(streamData);
            } catch (err) {
                alert(err.message);
            }
        } else {
            alert("The MediaRecorder API is not supported in your browser.");
        }
    };
    return (
        &lt;div&gt;
            &lt;h2&gt;Audio Recorder&lt;/h2&gt;
            &lt;main&gt;
                &lt;div className="audio-controls"&gt;
                    {!permission ? (
                        &lt;button onClick={getMicrophonePermission} type="button"&gt;
                            Get Microphone
                        &lt;/button&gt;
                    ): null}
                    {permission ? (
                        &lt;button type="button"&gt;
                            Record
                        &lt;/button&gt;
                    ): null}
                &lt;/div&gt;
            &lt;/main&gt;
        &lt;/div&gt;
    );
};
export default AudioRecorder;
</pre>
<p>上面的代码块执行以下操作:</p>
<ul>
<li>声明录音机组件的用户界面</li>
<li>使用<code>getMicrophonePermission</code>功能从浏览器接收麦克风许可</li>
<li>将从<code>navigator.mediaDevices<em>.</em>getUserMedia</code>函数接收的<code>MediaStream</code>设置为<code>stream</code>状态变量(我们很快就会用到它)</li>
</ul>
<h3 id="video-recorder-component">录像机组件</h3>
<p>接下来，让我们为录像机组件创建接口。</p>
<p>仍然在<code>src</code>目录中，创建另一个名为<code>VideoRecorder.jsx</code>的文件，并粘贴以下代码块的内容:</p>
<pre class="language-javascript hljs">import { useState, useRef } from "react";
const VideoRecorder = () =&gt; {
    const [permission, setPermission] = useState(false);
    const [stream, setStream] = useState(null);

    const getCameraPermission = async () =&gt; {
        if ("MediaRecorder" in window) {
            try {
                const streamData = await navigator.mediaDevices.getUserMedia({
                    audio: true,
                    video: true,
                });
                setPermission(true);
                setStream(streamData);
            } catch (err) {
                alert(err.message);
            }
        } else {
            alert("The MediaRecorder API is not supported in your browser.");
        }
    };

    return (
        &lt;div&gt;
            &lt;h2&gt;Video Recorder&lt;/h2&gt;
            &lt;main&gt;
                &lt;div className="video-controls"&gt;
                    {!permission ? (
                        &lt;button onClick={getCameraPermission} type="button"&gt;
                            Get Camera
                        &lt;/button&gt;
                    ):null}
                    {permission ? (
                        &lt;button type="button"&gt;
                            Record
                        &lt;/button&gt;
                    ):null}
                &lt;/div&gt;
            &lt;/main&gt;
        &lt;/div&gt;
    );
};
export default VideoRecorder;
</pre>
<p>与录音机组件类似，上面的代码块实现了以下功能:</p>
<ul>
<li>声明录像机组件的用户界面</li>
<li>使用<code>getCameraPermission</code>功能从浏览器接收麦克风许可</li>
<li>将从<code>getUserMedia</code>方法接收的<code>MediaStream</code>设置为<code>stream</code>状态变量</li>
</ul>
<h3 id="styling-application">设计我们的应用程序</h3>
<p>我们不需要编写太多的代码来设计应用程序的样式，因为大部分的样式都是在应用程序搭建过程中完成的。</p>
<p>在位于<code>src</code>目录的<code>index.css</code>文件中，在底部添加以下样式:</p>
<pre class="language-css hljs">...
.button-flex {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
}
.audio-controls,
.video-controls {
    margin-bottom: 20px;
}
.audio-player,
.video-player {
    display: flex;
    flex-direction: column;
    align-items: center;
}
.audio-player,
.video-player,
.recorded-player {
    display: flex;
    flex-direction: column;
    align-items: center;
}
.live-player {
    height: 200px;
    width: 400px;
    border: 1px solid #646cff;
    margin-bottom: 30px;
}
.recorded-player video {
    height: 400px;
    width: 800px;
}
</pre>
<p>然后，将<code>body</code>元素样式对象上的<code>place-items</code>的值从<code>center</code>更改为<code>start</code>:</p>
<pre class="language-css hljs">...
body {
  margin: 0;
  display: flex;
  place-items: start;
  min-width: 320px;
  min-height: 100vh;
}
...
</pre>
<h3 id="rendering-components">渲染组件</h3>
<p>要显示新创建的组件，导航到<code>App.jsx</code>并用以下代码块替换其内容:</p>
<pre class="language-css hljs">import "./App.css";
import { useState, useRef } from "react";
import VideoRecorder from "../src/VideoRecorder";
import AudioRecorder from "../src/AudioRecorder";

const App = () =&gt; {
    let [recordOption, setRecordOption] = useState("video");
    const toggleRecordOption = (type) =&gt; {
        return () =&gt; {
            setRecordOption(type);
        };
    };
    return (
        &lt;div&gt;
            &lt;h1&gt;React Media Recorder&lt;/h1&gt;
            &lt;div className="button-flex"&gt;
                &lt;button onClick={toggleRecordOption("video")}&gt;
                  Record Video
                &lt;/button&gt;
                &lt;button onClick={toggleRecordOption("audio")}&gt;
                  Record Audio
                &lt;/button&gt;
            &lt;/div&gt;
            &lt;div&gt;
                {recordOption === "video" ? &lt;VideoRecorder /&gt; : &lt;AudioRecorder /&gt;}
            &lt;/div&gt;
        &lt;/div&gt;
    );
};
export default App;
</pre>
<p>上面的代码块根据所选的选项呈现了<code>VideoRecorder</code>或<code>AudioRecorder</code>组件。</p>
<p>回到浏览器，您应该会得到以下结果:</p>
<p><img data-attachment-id="159122" data-permalink="https://blog.logrocket.com/how-to-create-video-audio-recorder-react/attachment/react-audio-video-recorder/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-audio-video-recorder.gif" data-orig-size="730,386" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React audio and video recorder demo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-audio-video-recorder-300x159.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-audio-video-recorder.gif" decoding="async" class="aligncenter size-full wp-image-159122 jetpack-lazy-image" src="../Images/92adbcf809a8dca9969333f5162b7b05.png" alt="React Audio And Video Recorder Demo" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/02/react-audio-video-recorder.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/react-audio-video-recorder.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="159122" data-permalink="https://blog.logrocket.com/how-to-create-video-audio-recorder-react/attachment/react-audio-video-recorder/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-audio-video-recorder.gif" data-orig-size="730,386" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React audio and video recorder demo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-audio-video-recorder-300x159.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/react-audio-video-recorder.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-159122" src="../Images/92adbcf809a8dca9969333f5162b7b05.png" alt="React Audio And Video Recorder Demo" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/react-audio-video-recorder.gif"/></noscript>
<p>现在已经完成了，让我们把重点放在增强组件的功能上。</p>
<h2 id="component-enhancement-audio-recorder">组件增强:录音机</h2>
<p>为了使录音机完整，它需要满足以下要求:</p>
<ul>
<li>停止/开始录音</li>
<li>播放和音频下载</li>
</ul>
<h3 id="stop-start-audio-recording">停止/开始录音</h3>
<p>让我们从声明变量和状态值开始。</p>
<p>首先，就在组件的函数范围之外(因为我们不需要它在组件状态更新时重新呈现)，让我们声明变量<code>mimeType</code>:</p>
<pre class="language-javascript hljs">...
const mimeType = "audio/webm";
...
</pre>
<p>该变量设置所需的文件类型。点击了解更多关于<a href="https://developer.mozilla.org/en-US/docs/Glossary/MIME_type"> MIME类型的信息。</a></p>
<p>接下来，让我们在<code>AudioRecorder</code>组件范围内声明以下状态变量:</p>
<pre class="language-javascript hljs">const [permission, setPermission] = useState(false);
const mediaRecorder = useRef(null);
const [recordingStatus, setRecordingStatus] = useState("inactive");
const [stream, setStream] = useState(null);
const [audioChunks, setAudioChunks] = useState([]);
const [audio, setAudio] = useState(null);
</pre>
<ul>
<li><code>permission</code>使用一个布尔值来表示是否已经给予用户权限</li>
<li><code>mediaRecorder</code>保存着来自创建一个新的<a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder"> <code>MediaRecorder</code> </a>对象的数据，给出一个<code>MediaStream</code>来记录</li>
<li><code>recordingStatus</code>设置记录仪的当前记录状态。三个可能的值是<code>recording</code>、<code>inactive</code>和<code>paused</code></li>
<li><code>stream</code>包含从<code>getUserMedia</code>方法接收的<code>MediaStream</code></li>
<li><code>audioChunks</code>包含录音的编码片段(组块)</li>
<li><code>audio</code>包含已完成录音的blob URL</li>
</ul>
<p>既然已经解决了这个问题，让我们来定义允许我们开始和停止记录的函数。</p>
<p>先说<code>startRecording</code>函数。就在<code>getMicrophonePermission</code>函数之后，添加以下代码:</p>
<pre class="language-javascript hljs">...
const startRecording = async () =&gt; {
  setRecordingStatus("recording");
  //create new Media recorder instance using the stream
  const media = new MediaRecorder(stream, { type: mimeType });
  //set the MediaRecorder instance to the mediaRecorder ref
  mediaRecorder.current = media;
  //invokes the start method to start the recording process
  mediaRecorder.current.start();
  let localAudioChunks = [];
  mediaRecorder.current.ondataavailable = (event) =&gt; {
     if (typeof event.data === "undefined") return;
     if (event.data.size === 0) return;
     localAudioChunks.push(event.data);
  };
  setAudioChunks(localAudioChunks);
};
...
</pre>
<p>接下来，在<code>startRecording</code>函数下面创建一个<code>stopRecording</code>函数:</p>
<pre class="language-javascript hljs">const stopRecording = () =&gt; {
  setRecordingStatus("inactive");
  //stops the recording instance
  mediaRecorder.current.stop();
  mediaRecorder.current.onstop = () =&gt; {
    //creates a blob file from the audiochunks data
     const audioBlob = new Blob(audioChunks, { type: mimeType });
    //creates a playable URL from the blob file.
     const audioUrl = URL.createObjectURL(audioBlob);
     setAudio(audioUrl);
     setAudioChunks([]);
  };
};
</pre>
<p>接下来，让我们用<code>"audio-controls"</code>的<code>className</code>修改<code>&lt;div&gt;</code>，以根据<code>recordingStatus</code>的状态有条件地呈现开始和停止记录按钮:</p>
<pre class="language-javascript hljs">&lt;div className="audio-controls"&gt;
    {!permission ? (
    &lt;button onClick={getMicrophonePermission} type="button"&gt;
        Get Microphone
    &lt;/button&gt;
    ) : null}
    {permission &amp;&amp; recordingStatus === "inactive" ? (
    &lt;button onClick={startRecording} type="button"&gt;
        Start Recording
    &lt;/button&gt;
    ) : null}
    {recordingStatus === "recording" ? (
    &lt;button onClick={stopRecording} type="button"&gt;
        Stop Recording
    &lt;/button&gt;
    ) : null}
&lt;/div&gt;
</pre>
<h3 id="playback-audio-download">播放和音频下载</h3>
<p>为了回放录制的音频文件，我们将使用HTML <code>audio</code>标签。</p>
<p>在<code>"audio-controls"</code>的<code>&lt;div&gt;</code>与<code>className</code>下面，我们添加以下代码:</p>
<pre class="language-javascript hljs">...
{audio ? (
  &lt;div className="audio-container"&gt;
     &lt;audio src={audio} controls&gt;&lt;/audio&gt;
     &lt;a download href={audio}&gt;
        Download Recording
     &lt;/a&gt;
   &lt;/div&gt;
) : null}
...
</pre>
<p>将blob从记录链接到锚元素并添加<code>download</code>属性使其成为“可下载的”</p>
<p>现在，录音机应该是这样的:</p>
<p><img data-attachment-id="159124" data-permalink="https://blog.logrocket.com/how-to-create-video-audio-recorder-react/attachment/downloadable-recording-react-media-recorder/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/downloadable-recording-react-media-recorder.gif" data-orig-size="730,385" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Downloadable recordings from the React Media Recorder" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/downloadable-recording-react-media-recorder-300x158.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/downloadable-recording-react-media-recorder.gif" decoding="async" class="aligncenter size-full wp-image-159124 jetpack-lazy-image" src="../Images/efd4de76ed2ceff9e3d4895a47d01d00.png" alt="Downloadable Recordings From The React Media Recorder" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/02/downloadable-recording-react-media-recorder.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/downloadable-recording-react-media-recorder.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="159124" data-permalink="https://blog.logrocket.com/how-to-create-video-audio-recorder-react/attachment/downloadable-recording-react-media-recorder/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/downloadable-recording-react-media-recorder.gif" data-orig-size="730,385" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Downloadable recordings from the React Media Recorder" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/downloadable-recording-react-media-recorder-300x158.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/downloadable-recording-react-media-recorder.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-159124" src="../Images/efd4de76ed2ceff9e3d4895a47d01d00.png" alt="Downloadable Recordings From The React Media Recorder" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/downloadable-recording-react-media-recorder.gif"/></noscript>
<h2 id="component-enhancement-video-recorder">组件增强:录像机</h2>
<p>为了使录像机完整，它需要满足以下要求:</p>
<ul>
<li>实时视频输入</li>
<li>停止/开始视频录制</li>
<li>播放和视频下载</li>
</ul>
<h3 id="real-time-video-feed">实时视频输入</h3>
<p>我们需要查看相机活动时的视野，以了解记录中捕捉到的区域。</p>
<p>首先，让我们将所需的文件<code>mimeType</code>设置在<code>VideoRecorder</code>组件的功能范围之外:</p>
<pre class="language-javascript hljs">...
const mimeType = "video/webm";
...
</pre>
<p>接下来，让我们定义所需的状态变量。我们将返回到之前创建的<code>VideoRecorder.jsx</code>文件:</p>
<pre class="language-javascript hljs">const [permission, setPermission] = useState(false);
const mediaRecorder = useRef(null);
const liveVideoFeed = useRef(null);
const [recordingStatus, setRecordingStatus] = useState("inactive");
const [stream, setStream] = useState(null);
const [videoChunks, setVideoChunks] = useState([]);
const [recordedVideo, setRecordedVideo] = useState(null);
</pre>
<ul>
<li><code>permission</code>使用一个布尔值来表示是否已经给予用户权限</li>
<li><code>liveVideoFeed</code>包含用户摄像机的实时视频流</li>
<li><code>recordingStatus</code>设置记录仪的当前记录状态。三个可能的值是<code>recording</code>、<code>inactive</code>和<code>paused</code></li>
<li><code>stream</code>包含从<code>getUserMedia</code>方法接收的<code>MediaStream</code></li>
<li><code>videoChunks</code>包含视频记录的编码片段(组块)</li>
<li><code>recordedVideo</code>包含已完成视频录制的blob URL</li>
</ul>
<p>让我们也将<code>getCameraPermission</code>函数修改如下:</p>
<pre class="language-javascript hljs">...
const getCameraPermission = async () =&gt; {
    setRecordedVideo(null);
    if ("MediaRecorder" in window) {
        try {
            const videoConstraints = {
                audio: false,
                video: true,
            };
            const audioConstraints = { audio: true };
            // create audio and video streams separately
            const audioStream = await navigator.mediaDevices.getUserMedia(
                audioConstraints
            );
            const videoStream = await navigator.mediaDevices.getUserMedia(
                videoConstraints
            );
            setPermission(true);
            //combine both audio and video streams
            const combinedStream = new MediaStream([
                ...videoStream.getVideoTracks(),
                ...audioStream.getAudioTracks(),
            ]);
            setStream(combinedStream);
            //set videostream to live feed player
            liveVideoFeed.current.srcObject = videoStream;
        } catch (err) {
            alert(err.message);
        }
    } else {
        alert("The MediaRecorder API is not supported in your browser.");
    }
};
...
</pre>
<p>为了防止麦克风在录音过程中产生回声，我们将分别为音频和视频创建两个独立的媒体流，然后将这两个媒体流合并为一个。最后，设置<code>liveVideoFeed</code>只包含视频流。</p>
<h3 id="stop-start-video-recording">停止和开始录像</h3>
<p>类似于我们之前创建的录音机，我们将从在<code>getCameraPermission</code>函数下面创建<code>startRecording</code>函数开始:</p>
<pre class="language-javascript hljs">...
const startRecording = async () =&gt; {
    setRecordingStatus("recording");
    const media = new MediaRecorder(stream, { mimeType });
    mediaRecorder.current = media;
    mediaRecorder.current.start();
    let localVideoChunks = [];
    mediaRecorder.current.ondataavailable = (event) =&gt; {
        if (typeof event.data === "undefined") return;
        if (event.data.size === 0) return;
        localVideoChunks.push(event.data);
    };
    setVideoChunks(localVideoChunks);
};
...
</pre>
<p>接下来，我们将在<code>startRecording</code>函数下面创建函数<code>stopRecording</code>来停止视频记录:</p>
<pre class="language-javascript hljs">...
const stopRecording = () =&gt; {
    setPermission(false);
    setRecordingStatus("inactive");
    mediaRecorder.current.stop();
    mediaRecorder.current.onstop = () =&gt; {
        const videoBlob = new Blob(videoChunks, { type: mimeType });
        const videoUrl = URL.createObjectURL(videoBlob);
        setRecordedVideo(videoUrl);
        setVideoChunks([]);
    };
};
...
</pre>
<h3 id="playback-video-download">播放和视频下载</h3>
<p>为了启用回放和视频下载，以及查看我们到目前为止所做的所有更改，让我们更新组件文件的HTML部分:</p>
<pre class="language-javascript hljs">...
&lt;div&gt;
    &lt;h2&gt;Audio Recorder&lt;/h2&gt;
    &lt;main&gt;
        &lt;div className="audio-controls"&gt;
            {!permission ? (
            &lt;button onClick={getMicrophonePermission} type="button"&gt;
                Get Microphone
            &lt;/button&gt;
            ) : null}
            {permission &amp;&amp; recordingStatus === "inactive" ? (
            &lt;button onClick={startRecording} type="button"&gt;
                Start Recording
            &lt;/button&gt;
            ) : null}
            {recordingStatus === "recording" ? (
            &lt;button onClick={stopRecording} type="button"&gt;
                Stop Recording
            &lt;/button&gt;
            ) : null}
        &lt;/div&gt;
        {audio ? (
        &lt;div className="audio-player"&gt;
            &lt;audio src={audio} controls&gt;&lt;/audio&gt;
            &lt;a download href={audio}&gt;
                Download Recording
            &lt;/a&gt;
        &lt;/div&gt;
        ) : null}
    &lt;/main&gt;
&lt;/div&gt;
...
</pre>
<p>现在，录像机应该是这样的:</p>
<p><img data-attachment-id="159126" data-permalink="https://blog.logrocket.com/how-to-create-video-audio-recorder-react/attachment/playback-react-media-recorder/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/playback-react-media-recorder.gif" data-orig-size="730,385" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React media recorder with playback feature" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/playback-react-media-recorder-300x158.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/playback-react-media-recorder.gif" decoding="async" class="aligncenter size-full wp-image-159126 jetpack-lazy-image" src="../Images/06363bc3e3f0f920b3554c65411e26d9.png" alt="React Media Recorder With Playback Feature" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/02/playback-react-media-recorder.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/playback-react-media-recorder.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="159126" data-permalink="https://blog.logrocket.com/how-to-create-video-audio-recorder-react/attachment/playback-react-media-recorder/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/playback-react-media-recorder.gif" data-orig-size="730,385" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React media recorder with playback feature" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/playback-react-media-recorder-300x158.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/playback-react-media-recorder.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-159126" src="../Images/06363bc3e3f0f920b3554c65411e26d9.png" alt="React Media Recorder With Playback Feature" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/playback-react-media-recorder.gif"/></noscript>
<h2 id="alternatives-creating-your-own-audio-video-recorder">创建自己的视频和音频记录器的替代方法</h2>
<p>与其编写所有这些代码来在应用程序中实现音频和视频录制，不如考虑使用一个针对您要实现的目标而优化的外部库。</p>
<p>一个流行的例子是<a href="https://www.npmjs.com/package/recordrtc"> RecordRTC </a>，这是一个灵活的JavaScript库，提供了广泛的定制选项。其他例子还有<a href="https://www.npmjs.com/package/react-media-recorder">反应媒体录像机</a>、<a href="https://www.npmjs.com/package/react-video-recorder">反应录像机</a>等。</p>
<p><em> N <strong>。</strong>B</em>T4。请记得在使用这些软件包之前做好调查。</p>
<h2 id="conclusion">结论</h2>
<p>在本教程中，我们学习了如何使用原生HTML MediaRecorder API和MediaStream API在React中构建自定义的音频和视频记录器。</p>
<p>这个项目的所有源代码都可以在这个<a href="https://github.com/codiini/react-audio-video-recorder"> GitHub库</a>中找到。您可以随意派生存储库并使用代码。我很想看看你能做些什么🙂</p>
<p>干杯！</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用LogRocket消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款React analytics解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket告诉您React应用程序中实际影响用户的最具影响力的bug和UX问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS异常、前端性能指标和用户交互。然后，LogRocket使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试LogRocket】。</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>