<html>
<head>
<title>fastlane: Build, test, and ship React Native apps - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>fastlane:构建、测试和发布React本地应用</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/fastlane-build-test-ship-react-native-apps/#0001-01-01">https://blog.logrocket.com/fastlane-build-test-ship-react-native-apps/#0001-01-01</a></blockquote><div><article class="article-post">
<p>React Native是用于创建移动应用程序的最流行的基于JavaScript的框架之一。它通过支持创建运行在iOS和Android上的跨平台应用程序，减少了整体应用程序开发所需的整体复杂性和时间。</p>
<p>但是，为了构建React原生应用程序并进行分发，开发人员必须首先签署证书，编译并更新版本，然后将构建提交到适用于iOS的适当平台应用程序商店和适用于Android的Google Play。</p>
<p>在本文中，我们将展示如何利用<a href="https://github.com/features/actions" target="_blank" rel="noopener"> GitHub动作</a>和<a href="https://fastlane.tools" target="_blank" rel="noopener"> fastlane </a>来自动化这些繁琐的任务。</p>
<p>这篇文章将帮助你自动构建、测试和分发用React Native构建的iOS和Android应用。</p>
<h2>内容</h2>

<h2 id="what-is-fastlane">什么是快车道？</h2>
<p>fastlane是一个帮助iOS和Android开发者自动化耗时操作的解决方案。该平台有助于通过持续部署交付高质量的应用，而不会影响开发人员日常工作的速度或敏捷性。</p>
<p>fastlane除了Ruby命令行实用程序之外，还提供了本机Gradle (Android)和Xcode (iOS)插件。它管理诸如注册应用商店和Google Play、向商店发布应用、部署测试软件、<a href="https://rnfirebase.io/crashlytics/usage" target="_blank" rel="noopener"> Firebase Crashlytics </a>等任务。您已经拥有的任何<a href="https://docs.fastlane.tools" target="_blank" rel="noopener"> CI系统</a>也将与fastlane一起运行。</p>
<h2 id="setting-up-fastlane">设置快速通道</h2>
<p>在我们开始之前，有一些系统要求必须在本地安装。</p>
<p>fastlane官方支持在macOS上运行；fastlane只部分支持Linux和Windows，因为Xcode之类的工具只能在macOS上运行。</p>
<p>浪子可以与macOS的Homebrew一起安装:</p>
<pre class="language-javascript hljs">brew install fastlane
</pre>
<p>或者，使用RubyGems for macOS、Linux和Windows:</p>
<pre class="language-javascript hljs">sudo gem install fastlane  # Make sure ruby is already installed
</pre>
<p>有两种方法可以将fastlane添加到React本机项目中:</p>
<ol>
<li>在Android和iOS各自的文件夹中分别使用<code>fastlane init</code>命令；fastlane将自动检测平台，请求任何必要的信息，并配置平台</li>
<li>在React本地项目的根目录下创建一个<code>fastlane</code>文件夹，并向其中添加一个<code>Fastfile</code>文件。然后，手动为iOS和Android进行配置</li>
</ol>
<p>在本文中，我们将使用第二种方法。</p>
<h2 id="configuring-fastlane-for-android">为Android配置fastlane</h2>
<p>让我们从为Android配置fastlane开始。</p>
<p>如前所述，我们将在项目的根目录下创建一个<code>fastlane</code>文件夹，并将一个<code>Fastfile</code>文件添加到该文件夹中。我们将在iOS和Android上使用同样的<code>Fastfile</code>文件。</p>
<p>在做其他事情之前，让我们检查并清理一下Git分支。我们将为Android发行设置两条通道，一条用于beta测试，一条用于最终版本。</p>
<p>首先，我们将定义一个Android平台，如下所示:</p>
<pre class="language-javascript hljs">platform :android do 
    desc "Release for the Android beta"
    lane :beta do 
        increment_version_code('app_project_dir': './andriod/app')
        gradle(task: 'clean', project_dir: './andriod')
        gradle(task: 'bundle', bundle_type: 'Release', project_dir: './andriod')
        supply(track: 'beta', abb: './andriod/app/build/outputs/apk/app-beta-release.apk')
    end
    desc "Release for the Android production"
    lane : release do
        increment_version_code(app_project_dir: './android/app')
        increment_version_name(app_project_dir: './android/app', bump_type: 'patch')
        gradle(task: 'clean', project_dir: './android/')
        gradle(task: 'bundle', bundle_type: 'Release', project_dir: './andriod', properties: {
            "android.injected.signing.store.file" =&gt; ENV['ANDROID_KEYSTORE_FILE'],
            "android.injected.signing.store.password" =&gt; ENV['ANDROID_KEYSTORE_PASSWORD'],
            "android.injected.signing.key.alias" =&gt; ENV['ANDROID_KEYSTORE_ALIAS'],
            "android.injected.signing.key.password" =&gt; ENV['ANDROID_KEYSTORE_PASSWORD']
        })
        supply(track: 'production', aab: './android/app/build/outputs/bundle/release/app_release.aab', release_status: 'draft')
    end
end
</pre>
<p>接下来，我们将为测试版创建一个分销渠道，并添加一组要执行的操作。</p>
<p>下一步我们将利用Gradle来清理建筑。接下来，我们将执行Gradle包来构建APK或AAB。</p>
<p>最后一步，我们将使用<a href="https://docs.fastlane.tools/actions/supply/#supply" target="_blank" rel="noopener"> CI实用程序供应</a>向Google Play提交元数据、屏幕截图、二进制文件和应用捆绑包。</p>
<p>Android应用程序发布渠道将会以与测试渠道相同的方式创建；此时，我们将添加Keystore和Google凭证进行发布。</p>
<p><strong> <em>注意，</em> </strong> <em> fastlane的补给工具只有在你至少成功发布一次你的Android应用到Google Play的情况下才有效。</em></p>
<h2 id="configuring-fastlane-for-ios">为iOS配置快速通道</h2>
<p>现在，让我们为iOS配置fastlane。在我们开始之前，Xcode和macOS是使用fastlane发布iOS应用程序的先决条件。</p>
<p>我们将为iOS分发设置两条通道，一条用于TestFlight，一条用于App Store发布。</p>
<pre class="language-javascript hljs">platform :ios do 
    private_lane :update_version do
        app_store_version = get_app_store_version_number(bundle_id: 'rnFastlane')
        plist_version = get_version_number_from_plist(xcodeproj: './ios/rnFastlane.xcodeproj')
        if Gem::Version.new(plist_version.to_f) == Gem::Version.new(app_store_version.to_f)
            increment_version_number_in_plist(xcodeproj: './ios/rnFastlane.xcodeproj', bump_type: 'minor')
        else
            increment_version_number_in_plist(xcodeproj: './ios/rnFastlane.xcodeproj', bump_type: 'patch')
        end
    end
    private_lane :testflight_build do 
        increment_build_number_in_plist(xcodeproj: './ios/rnFastlane.xcodeproj', target: 'rnFastlane')
        gym(scheme: 'rnFastlane', workspace: './ios/rnFastlane.xcworkspace')
    end
    private_lane :distribution_build do
        increment_build_number_in_plist(xcodeproj: './ios/rnFastlane.xcodeproj', target: 'rnFastlane')
        create_keychain(
            name: ENV['KEYCHAIN_NAME'],
            password: ENV['KEYCHAIN_PASSWORD'],
            default_keychain: true,
            unlock: true,
            timeout: 3600,
            add_to_search_list: true)

        match(
            type: 'app-store',
            keychain_name: ENV["KEYCHAIN_NAME"],
            keychain_password: ENV["KEYCHAIN_PASSWORD"],
            readonly: true,
            shallow_clone: true,
            verbose: false)    
        gym(
            scheme: 'rnFastlane', 
            workspace: './ios/rnFastlane.xcworkspace',
            export_method: 'ad-hoc',
            output_directory: "./build", 
            configuration: 'Release',
            output_name: "rnFastlane.ipa"
            clean: true
            export_options: {
                method: 'app-store',
                provisioningProfiles: {
                    'rnFastlane' =&gt; ENV["sigh_#{options[:app_identifier]}_app-store_profile-name"],
                }
            })
    end
    desc "Release for the iOS beta"
    lane :beta do
        testflight_build
        upload_to_testflight(username: ENV['APP_STORE_EMAIL'] app_identifier: 'rnFastlane')
        commit_version_bump(message: 'bump build')
        push_to_git_remote
    end
    desc "Release for the iOS production"
    lane :release do
        distribution_build
        deliver
        commit_version_bump(message: 'bump build')
        push_to_git_remote
    end
end
</pre>
<h3 id="increment-the-version-number">增加版本号</h3>
<p>下一步是为更新版本添加一个专用通道。</p>
<p>我们将使用<br/> <code>get_app_store_version_number</code>和<code>get_version_number_from_plist</code>插件方法从App Store和plist文件中获取版本。这使得能够使用<code>increment_version_number_in_plist</code>方法增加次要和补丁凸点类型的版本号。</p>
<h3 id="set-up-certificate-and-provisioning-profiles">设置证书和预置描述文件</h3>
<p>现在，我们将使用<code>match</code>来设置证书和配置文件。<a href="https://docs.fastlane.tools/actions/match/" target="_blank" rel="noopener"> <code>match</code>包含在iOS应用的快车道</a>中，用于代码签名。有了<code>match</code>，整个开发团队可以使用单一的代码签名身份。</p>
<p>在添加<code>match</code>之前，我们需要创建一个私有的GitHub存储库来存储证书。然后，我们可以用下面的命令安装<code>match</code>:</p>
<pre class="language-javascript hljs">fastlane match init 
</pre>
<p><img data-attachment-id="128543" data-permalink="https://blog.logrocket.com/fastlane-build-test-ship-react-native-apps/attachment/private-repo/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/private-repo.png" data-orig-size="730,143" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Private repo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/private-repo-300x59.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/private-repo.png" decoding="async" class="aligncenter size-full wp-image-128543 jetpack-lazy-image" src="../Images/ec39a380b9e33445259c90632377e906.png" alt="Private Repo" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/private-repo.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/private-repo-300x59.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/private-repo.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/private-repo.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="128543" data-permalink="https://blog.logrocket.com/fastlane-build-test-ship-react-native-apps/attachment/private-repo/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/private-repo.png" data-orig-size="730,143" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Private repo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/private-repo-300x59.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/private-repo.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-128543" src="../Images/ec39a380b9e33445259c90632377e906.png" alt="Private Repo" srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/private-repo.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/private-repo-300x59.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/private-repo.png"/></noscript>
<p>接下来，我们需要添加一个私有repo来存储证书，如上所示。在<code>fastlane</code>文件夹下生成一个<code>Matchfile</code>。一旦<code>match</code>设置完成，我们就可以为开发和应用商店创建证书和配置文件。</p>
<pre class="language-javascript hljs">fastlane match appstore 
# for the appstore</pre>
<pre class="language-javascript hljs">fastlane match development
# for the development 
</pre>
<p>当执行上述命令时，它会将证书添加到私有repo中。</p>
<h3 id="build-the-ios-app">构建iOS应用程序</h3>
<p>另一个快速通道功能<code><a href="https://docs.fastlane.tools/actions/gym/" target="_blank" rel="noopener">gym</a></code>将用于构建iOS IPA应用。<code>gym</code>还将有助于自动化测试版软件的部署和分发。</p>
<h3 id="upload-the-build">上传版本</h3>
<p>现在是时候上传我们的构建了。我们将使用<code>upload_to_testflight</code>函数上传试飞，使用<code>deliver</code>函数提交<a href="https://docs.fastlane.tools/actions/deliver/#deliver" target="_blank" rel="noopener">应用商店</a>。<code>deliver</code>服务是快车道的一部分；它用于将元数据和IPA上传到App Store。</p>
<h2 id="automating-workflows-with-github-actions">使用GitHub动作自动化工作流程</h2>
<p>GitHub Actions是一个新的GitHub特性，它使得在云中创建和运行工作流变得容易。我们将设置GitHub操作来自动化Android和iOS发行版的构建和发布工作流。</p>
<p>首先，我们将为iOS和Android添加两个独立的工作流。在项目的根级别，我们将创建一个<code>.github</code>文件夹；在这个文件夹下，我们将创建另一个名为<code>workflows</code>的文件夹。然后，我们将把iOS版的<code>ios_release.yml</code>和Android版的<code>android_release.yml</code>添加到<code>.github &gt; workflows</code>文件夹中。</p>
<pre class="language-javascript hljs">mkdir .github &amp;&amp; cd .github &amp;&amp; mkdir workflows &amp;&amp; cd workflows &amp;&amp; touch andriod_release.yml &amp;&amp; touch ios_release.yml
</pre>
<h3 id="defining-github-actions-workflows">定义GitHub操作工作流</h3>
<p>我们将定义GitHub动作工作流，如下所示:</p>
<pre class="language-javascript hljs">on:
  push:
    tags:
      - 'android*'
</pre>
<p>当我们添加一个包含关键字<code>android</code>的标签时，Android版本的构建就开始了，如上所述。这里有一个例子:</p>
<pre class="language-javascript hljs">git tag -a 'versions' -m "andriod release"
</pre>
<p>为Android发布工作流定义了两个作业，一个用于beta版，一个用于Google Play版。</p>
<p>接下来，我们将定义最新版本的Ubuntu虚拟机来运行GitHub Actions工作流。</p>
<pre class="language-javascript hljs">name: Build and deploy Android release
on:
  push:
    tags:
      - 'android*'
jobs:
  testFlight-build:
    name: android-beta-build
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [12.x]
    steps:
      - uses: actions/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9ceff9e8e9ecb1f2f3f8f9dceaad">[email protected]</a>
        with:
          node-version: ${{ matrix.node-version }}
      - name: Checkout to git repository
        uses: actions/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="67040f02040c081213271155">[email protected]</a>
      - name: Install dependencies
        run: |
          yarn install
      - name: Install Fastlane
        uses: actions/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e39086979693ce9196819aa395d2">[email protected]</a>
        with:
          ruby-version: 2.6
      - name: Install npm dependencies
        run: |
          yarn install
      - name: Install Fastlane
        run: |
          bundle install
          bundle update fastlane
      - name: Build and upload to TestFlight
        run: |
          bundle exec fastlane android beta
          env: 
             ANDROID_KEYSTORE_FILE: ${{ secrets.ANDROID_KEYSTORE_FILE }}
             ANDROID_KEYSTORE_PASSWORD: ${{ secrets.ANDROID_KEYSTORE_PASSWORD }}
             ANDROID_KEYSTORE_ALIAS: ${{ secrets.ANDROID_KEYSTORE_ALIAS }}
             ANDROID_KEYSTORE_PASSWORD: ${{ secrets.ANDROID_KEYSTORE_PASSWORD }}
  release-build:
    name: Android-release-build
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [12.x]
    steps:
      - uses: actions/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e89b8d9c9d98c586878c8da89ed9">[email protected]</a>
        with:
          node-version: ${{ matrix.node-version }}
      - name: Checkout to git repository
        uses: actions/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="bad9d2dfd9d1d5cfcefacc88">[email protected]</a>
      - name: Install dependencies
        run: |
          yarn install
      - name: Install Fastlane
        uses: actions/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e29187969792cf9097809ba294d3">[email protected]</a>
        with:
          ruby-version: 2.6
      - name: Install npm dependencies
        run: |
          yarn install
      - name: Install Fastlane
        run: |
          bundle install
          bundle update fastlane
      - name: release-build
        run: |
          bundle exec fastlane android release
          env: 
             ANDROID_KEYSTORE_FILE: ${{ secrets.ANDROID_KEYSTORE_FILE }}
             ANDROID_KEYSTORE_PASSWORD: ${{ secrets.ANDROID_KEYSTORE_PASSWORD }}
             ANDROID_KEYSTORE_ALIAS: ${{ secrets.ANDROID_KEYSTORE_ALIAS }}
             ANDROID_KEYSTORE_PASSWORD: ${{ secrets.ANDROID_KEYSTORE_PASSWORD }}
</pre>
<p>在上面的代码中，我们定义了一系列的步骤，这些步骤是由GitHub marketplace提供的或者由社区支持的预定义操作。</p>
<p>我们将在接下来的一系列事件中添加安装npm依赖项、添加所需的Node.js版本以及安装fastlane的步骤，如上面的代码所示。</p>
<p>最后，我们为测试和发布工作运行快速通道构建。我们还使用<a href="https://docs.github.com/en/rest/actions/secrets" target="_blank" rel="noopener"> GitHub Actions Secrets </a>来定义构建工作流期间所需的环境变量。</p>
<h3 id="creating-and-storing-secrets-for-github-actions">为Github操作创建和存储秘密</h3>
<p>加密的秘密允许我们存储敏感信息。我们可以将环境变量、密钥和密码作为加密的秘密添加到GitHub repo中。存储库的秘密将可以被存储库上的任何工作流访问。</p>
<p>要添加密码，请进入回购的<strong>设置</strong>菜单。在<strong>秘密</strong> &gt; <strong>动作</strong>部分(左导航)下，点击<strong>新储存库秘密</strong>按钮(右上方)添加新秘密。</p>
<p>在整个过程中，需要为Android和iOS应用程序添加密码，以便在上传之前正确签署应用程序。</p>
<p><img data-attachment-id="128546" data-permalink="https://blog.logrocket.com/fastlane-build-test-ship-react-native-apps/attachment/actions-secrets/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/actions-secrets.png" data-orig-size="730,422" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Actions secrets" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/actions-secrets-300x173.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/actions-secrets.png" decoding="async" class="aligncenter size-full wp-image-128546 jetpack-lazy-image" src="../Images/5f4eb8c392632adc92aeca67fad651f9.png" alt="Actions Secrets" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/actions-secrets.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/actions-secrets-300x173.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/actions-secrets.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/actions-secrets.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="128546" data-permalink="https://blog.logrocket.com/fastlane-build-test-ship-react-native-apps/attachment/actions-secrets/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/actions-secrets.png" data-orig-size="730,422" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Actions secrets" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/actions-secrets-300x173.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/actions-secrets.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-128546" src="../Images/5f4eb8c392632adc92aeca67fad651f9.png" alt="Actions Secrets" srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/actions-secrets.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/actions-secrets-300x173.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/actions-secrets.png"/></noscript>
<h3 id="defining-ios-workflows">定义iOS工作流</h3>
<p>如前所述，我们通过在<code>.github &gt; workflows</code>文件夹下创建一个不同的<code>ios release.yml</code>文件来区分iOS和Android版本。当我们添加一个包含<code>ios</code>关键词的标签时，iOS版本的构建就开始了。</p>
<p>这里有一个例子:</p>
<pre class="language-javascript hljs">git tag -a 'versions' -m "ios release"
</pre>
<p>对于iOS版本，我们将指定两个任务:一个用于TestFlight版本，一个用于App Store版本。</p>
<p>接下来，我们将定义最新版本的<code>macos-latest</code>虚拟机来运行iOS发行版的GitHub操作工作流。</p>
<pre class="language-javascript hljs">name: Build and deploy iOS release
on:
  push:
    tags:
      - 'ios*'
jobs:
  testFlight-build:
    name: iOS-testFlight-build
    runs-on: macos-latest
    strategy:
      matrix:
        node-version: [12.x]
    steps:
      - uses: actions/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b8cbddcccdc895d6d7dcddf8ce89">[email protected]</a>
        with:
          node-version: ${{ matrix.node-version }}
      - name: Checkout to git repository
        uses: actions/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e88b808d8b83879d9ca89eda">[email protected]</a>
      - name: Install dependencies
        run: |
          yarn install
      - name: Install Fastlane
        uses: actions/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0271677677722f7077607b427433">[email protected]</a>
        with:
          ruby-version: 2.6
      - name: Install npm dependencies
        run: |
          yarn install
      - name: Install Fastlane
        run: |
          bundle install
          bundle update fastlane
      - name: Build and upload to TestFlight
        run: |
          bundle exec fastlane ios beta
          env: 
             APPLE_ID: ${{ secrets.APPLE_ID }}
             APP_STORE_EMAIL: ${{ secrets.APP_STORE_EMAIL }}
             APPLE_TEAM_ID: ${{ secrets.APPLE_TEAM_ID }}
             IOS_DISTRIBUTION_CERTS_GITHUB_URL: ${{ secrets.IOS_DISTRIBUTION_CERTS_GITHUB_URL }}
             MATCH_PASSWORD: ${{ secrets.MATCH_PASSWORD }}
  release-build:
    name: iOS-testFlight-build
    runs-on: macos-latest
    strategy:
      matrix:
        node-version: [12.x]
    steps:
      - uses: actions/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="592a3c2d2c297437363d3c192f68">[email protected]</a>
        with:
          node-version: ${{ matrix.node-version }}
      - name: Checkout to git repository
        uses: actions/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9cfff4f9fff7f3e9e8dceaae">[email protected]</a>
      - name: Install dependencies
        run: |
          yarn install
      - name: Install Fastlane
        uses: actions/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="afdccadbdadf82dddacdd6efd99e">[email protected]</a>
        with:
          ruby-version: 2.6
      - name: Install npm dependencies
        run: |
          yarn install
      - name: Install Fastlane
        run: |
          bundle install
          bundle update fastlane
      - name: Build and upload to TestFlight
        run: |
          bundle exec fastlane ios beta
          env: 
             APPLE_ID: ${{ secrets.APPLE_ID }}
             APP_STORE_EMAIL: ${{ secrets.APP_STORE_EMAIL }}
             APPLE_TEAM_ID: ${{ secrets.APPLE_TEAM_ID }}
             IOS_DISTRIBUTION_CERTS_GITHUB_URL: ${{ secrets.IOS_DISTRIBUTION_CERTS_GITHUB_URL }}
             MATCH_PASSWORD: ${{ secrets.MATCH_PASSWORD }}
</pre>
<p>现在，我们定义一系列步骤来安装npm依赖项，添加所需的Node.js版本，并在接下来的一系列事件中安装fastlane，如上面的代码所示。</p>
<p>最后，我们为试飞版本运行快速通道构建。我们使用GitHub Actions Secrets来定义构建工作流程中所需的环境变量。</p>
<h2 id="conclusion">结论</h2>
<p>在本文中，我们演示了如何在React本地项目中设置fastlane。结合使用fastlane和GitHub操作简化了iOS和Android应用程序的构建和发布，并改进了构建、测试和发布版本的部署管道。</p>
<p>参考官方文档了解更多关于<a href="https://docs.fastlane.tools/" target="_blank" rel="noopener">快车道</a>和<a href="https://docs.github.com/en/actions" target="_blank" rel="noopener"> GitHub动作</a>的信息。</p><div class="code-block code-block-18">
<div class="blog-plug inline-plug react-native-plug"><h2><a href="https://lp.logrocket.com/blg/react-native-signup"> LogRocket </a>:即时重现React原生应用中的问题。</h2><a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/110055665562c1e02069b3698e6cc671.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/110055665562c1e02069b3698e6cc671.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/></noscript></a><p><a href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一款React原生监控解决方案，可帮助您即时重现问题、确定bug的优先级并了解React原生应用的性能。</p><p>LogRocket还可以向你展示用户是如何与你的应用程序互动的，从而帮助你提高转化率和产品使用率。LogRocket的产品分析功能揭示了用户不完成特定流程或不采用新功能的原因。</p><p>开始主动监控您的React原生应用— <a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer">免费试用LogRocket】。</a></p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>