<html>
<head>
<title>Getting started with WebAssembly in Flutter Web - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在Flutter Web - LogRocket博客中开始使用WebAssembly</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/getting-started-webassembly-flutter-web/#0001-01-01">https://blog.logrocket.com/getting-started-webassembly-flutter-web/#0001-01-01</a></blockquote><div><article class="article-post">
<p>Flutter是用Skia构建的，Skia是一个用C++编写的2D图形库。Flutter的Skia引擎使其能够创建跨各种平台(包括web)的可移植的高性能应用程序。</p>
<p>大多数web浏览器都理解JavaScript语言；但是，Skia C++ API可以通过WebAssembly在web浏览器上运行。WebAssembly通过将本机代码编译成浏览器能够理解的语言，允许它在浏览器中运行。</p>
<p>在本教程中，我们将介绍WebAssembly并了解它的好处。我们还将了解Flutter代码如何与WebAssembly绑定交互。</p>

<h2 id="what-webassembly">什么是WebAssembly？</h2>
<p>WebAssembly (Wasm)是一种运行性能接近本机的低级语言。它是一个虚拟堆栈机器，具有紧凑的二进制格式，是高级语言的编译目标。</p>
<p>WebAssembly使工程师能够用C、C++、Rust和其他运行在浏览器中的高级语言编写代码。Wasm将高级语言编写的代码编译成WebAssembly模块。然后它们被加载到一个web应用程序中，用JavaScript调用。</p>
<p>浏览器可以快速将WebAssembly模块转换成任何机器的指令。</p>
<p><img data-attachment-id="131317" data-permalink="https://blog.logrocket.com/getting-started-webassembly-flutter-web/attachment/webassembly-compiling-chart/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/webassembly-compiling-chart.png" data-orig-size="670,320" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="webassembly-compiling-chart" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/webassembly-compiling-chart-300x143.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/webassembly-compiling-chart.png" decoding="async" class="aligncenter size-full wp-image-131317 jetpack-lazy-image" src="../Images/c0cfc44fd4d1f81b113196ae4ab11e14.png" alt="Webassembly Compiling Chart" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/webassembly-compiling-chart.png 670w, https://blog.logrocket.com/wp-content/uploads/2022/09/webassembly-compiling-chart-300x143.png 300w" data-lazy-sizes="(max-width: 670px) 100vw, 670px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/webassembly-compiling-chart.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/webassembly-compiling-chart.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="131317" data-permalink="https://blog.logrocket.com/getting-started-webassembly-flutter-web/attachment/webassembly-compiling-chart/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/webassembly-compiling-chart.png" data-orig-size="670,320" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="webassembly-compiling-chart" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/webassembly-compiling-chart-300x143.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/webassembly-compiling-chart.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-131317" src="../Images/c0cfc44fd4d1f81b113196ae4ab11e14.png" alt="Webassembly Compiling Chart" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/webassembly-compiling-chart.png 670w, https://blog.logrocket.com/wp-content/uploads/2022/09/webassembly-compiling-chart-300x143.png 300w" sizes="(max-width: 670px) 100vw, 670px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/webassembly-compiling-chart.png"/></noscript>
<h2 id="why-use-webassembly">为什么要使用WebAssembly？</h2>
<p>JavaScript一直是浏览器理解的主要语言。然而，当运行像3D游戏这样的资源密集型应用程序时，JavaScript往往会很慢。对于这样的应用，需要接近本地的体验。这就是Wasm的用武之地。</p>
<p>WebAssembly与JavaScript协同工作，为我们的应用程序提供了近乎原生的速度。由于模块尺寸小，Wasm加载和执行速度更快，能够在网络上运行高性能的应用程序。</p>
<p>Wasm使我们能够构建快速、高性能、可移植和内存安全的应用程序。这是一个开放的标准，旨在运行于其他平台，而不仅仅是网络。许多流行语言至少对WebAssembly有一些支持。</p>
<h2 id="dart-webassembly-interoperability">Dart和WebAssembly互操作性</h2>
<p>Dart web平台使Dart代码能够在JavaScript支持的平台上编译和运行。我们还可以在Dart代码中调用现有的JavaScript代码，这是由<a href="https://pub.dev/packages/js" target="_blank" rel="noopener"> <code>js</code> </a>包提供的JavaScript绑定实现的。</p>
<p>从Dart代码调用JavaScript代码和从JavaScript代码调用Dart代码的能力被称为“Dart-JavaScript互操作性”</p>
<p><img data-attachment-id="131319" data-permalink="https://blog.logrocket.com/getting-started-webassembly-flutter-web/attachment/dart-js-interoperability/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-js-interoperability.png" data-orig-size="730,340" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="dart-js-interoperability" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-js-interoperability-300x140.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-js-interoperability.png" decoding="async" class="aligncenter size-full wp-image-131319 jetpack-lazy-image" src="../Images/d3f4a1c2a4480485fb08238e408e3619.png" alt="Dart Js Interoperability" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-js-interoperability.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/dart-js-interoperability-300x140.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-js-interoperability.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-js-interoperability.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="131319" data-permalink="https://blog.logrocket.com/getting-started-webassembly-flutter-web/attachment/dart-js-interoperability/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-js-interoperability.png" data-orig-size="730,340" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="dart-js-interoperability" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-js-interoperability-300x140.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-js-interoperability.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-131319" src="../Images/d3f4a1c2a4480485fb08238e408e3619.png" alt="Dart Js Interoperability" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-js-interoperability.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/dart-js-interoperability-300x140.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-js-interoperability.png"/></noscript>
<p><code>js</code>包提供了注释和函数，让我们指定Dart代码如何与JavaScript代码连接。JavaScript API具有<code>WebAssembly</code>对象，这是所有WebAssembly相关函数的名称空间，允许加载WebAssembly模块、创建新的内存和表实例，以及处理WebAssembly错误。</p>
<p>WebAssembly有两种文件格式:</p>
<ul>
<li><code>.wasm</code>:包含二进制汇编代码，是可执行文件</li>
<li><code>.wat</code>:包含一个人可读的文本格式的<code>.wasm</code>文件，编译成<code>.wasm</code>。它仅用于编辑或调试</li>
</ul>
<p>编写WebAssembly代码可能会很痛苦。大多数语言支持从我们的源代码生成Wasm模块，然后我们可以使用提供的绑定来加载和调用这些模块。</p>
<p>我们可以使用<code>js</code>绑定，通过Dart-web代码中的JavaScript WebAssembly对象来使用WebAssembly。</p>
<p><img data-attachment-id="131324" data-permalink="https://blog.logrocket.com/getting-started-webassembly-flutter-web/attachment/dart-web-code-chart/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-web-code-chart.png" data-orig-size="730,122" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="dart-web-code-chart" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-web-code-chart-300x50.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-web-code-chart.png" decoding="async" class="aligncenter size-full wp-image-131324 jetpack-lazy-image" src="../Images/37a5038fc7175984faf33e834a939f7a.png" alt="Dart Web Code Chart" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-web-code-chart.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/dart-web-code-chart-300x50.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-web-code-chart.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-web-code-chart.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="131324" data-permalink="https://blog.logrocket.com/getting-started-webassembly-flutter-web/attachment/dart-web-code-chart/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-web-code-chart.png" data-orig-size="730,122" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="dart-web-code-chart" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-web-code-chart-300x50.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-web-code-chart.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-131324" src="../Images/37a5038fc7175984faf33e834a939f7a.png" alt="Dart Web Code Chart" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-web-code-chart.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/dart-web-code-chart-300x50.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/dart-web-code-chart.png"/></noscript>
<p>为了在我们的Dart代码中使用<code>js</code>绑定，用<code>@JS</code>注释该方法，并向其添加<code>external</code>关键字:</p>
<pre class="language-dart hljs">@JS('WebAssembly.instantiate')
external Object instantiate(Object bytesOrBuffer, Object import);
</pre>
<h2 id="using-webassembly-flutter-web-apps">在Flutter web应用程序中使用WebAssembly</h2>
<p>我们可以使用各种语言来创建Wasm模块，并将其加载到我们的Flutter应用程序中。在本文中，我们将使用<a href="https://blog.logrocket.com/the-introductory-guide-to-assemblyscript/" target="_blank" rel="noopener"> AssemblyScript，一种用于WebAssembly </a>的类类型脚本语言，来生成Wasm模块。</p>
<h3 id="generating-webassembly-modules-assemblyscript">使用AssemblyScript生成WebAssembly模块</h3>
<p>要开始，我们需要安装Node.js。您可以从<a href="https://nodejs.org/en/" target="_blank" rel="noopener"> Node的官方网站</a>下载Node。</p>
<p>接下来，使用下面的命令安装npm包运行程序<code>npx</code>:</p>
<pre class="language-shell hljs">npm i -g npx
</pre>
<p>创建一个新目录和一个<code>package.json</code>文件。然后使用以下命令安装<code>assemblyscript</code>和<code>assemblyscript/loader</code>:</p>
<pre class="language-shell hljs">mkdir wasm &amp;&amp; cd wasm
npm init
npm i --save-dev assemblyscript
npm i --save @assemblyscript/loader
</pre>
<p>接下来，运行下面的命令来搭建一个新项目:</p>
<pre class="language-shell hljs">npx asinit .
</pre>
<p>该命令将生成<code>assembly</code>和<code>build</code>文件夹。我们将在<code>index.ts</code>文件中编写我们的AssemblyScript模块，并将生成的Wasm代码放在<code>build</code>文件夹中。</p>
<p><img data-attachment-id="131327" data-permalink="https://blog.logrocket.com/getting-started-webassembly-flutter-web/attachment/folders/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/folders.png" data-orig-size="730,102" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="folders" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/folders-300x42.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/folders.png" decoding="async" class="aligncenter size-full wp-image-131327 jetpack-lazy-image" src="../Images/5a9230f1e2b3e35510d44b7e1d21abd0.png" alt="Folders Screenshot" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/folders.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/folders-300x42.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/folders.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/folders.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="131327" data-permalink="https://blog.logrocket.com/getting-started-webassembly-flutter-web/attachment/folders/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/folders.png" data-orig-size="730,102" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="folders" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/folders-300x42.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/folders.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-131327" src="../Images/5a9230f1e2b3e35510d44b7e1d21abd0.png" alt="Folders Screenshot" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/folders.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/folders-300x42.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/folders.png"/></noscript>
<p>接下来，将下面的方法添加到<code>index.ts</code>文件中。<code>plusOne</code>函数将计数器加1，而<code>minusOne</code>函数将计数器减1。</p>
<pre class="language-typescript hljs">// The entry file of your WebAssembly module.
export function plusOne(n: i32): i32 {
  return n+1;
}
export function minusOne(n:i32):i32{
  return n - 1;
}
</pre>
<p>在根目录下运行<code>npm run asbuild</code>生成WebAssembly模块。该命令在<code>build</code>文件夹中生成<code>.wasm</code>和<code>.wat</code>文件。我们将在我们的Flutter应用程序中使用<code>release.wasm</code>文件。</p>
<p><img data-attachment-id="131329" data-permalink="https://blog.logrocket.com/getting-started-webassembly-flutter-web/attachment/generated-wasm-files/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/generated-wasm-files.png" data-orig-size="730,275" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="generated-wasm-files" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/generated-wasm-files-300x113.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/generated-wasm-files.png" decoding="async" class="aligncenter size-full wp-image-131329 jetpack-lazy-image" src="../Images/4c9ddf2160a71c1408e768e930ddc95c.png" alt="Generated Wasm Files" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/generated-wasm-files.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/generated-wasm-files-300x113.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/generated-wasm-files.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/generated-wasm-files.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="131329" data-permalink="https://blog.logrocket.com/getting-started-webassembly-flutter-web/attachment/generated-wasm-files/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/generated-wasm-files.png" data-orig-size="730,275" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="generated-wasm-files" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/generated-wasm-files-300x113.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/generated-wasm-files.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-131329" src="../Images/4c9ddf2160a71c1408e768e930ddc95c.png" alt="Generated Wasm Files" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/generated-wasm-files.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/generated-wasm-files-300x113.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/generated-wasm-files.png"/></noscript>
<h3 id="using-webassembly-modules-flutter-app">在Flutter应用程序中使用WebAssembly模块</h3>
<p>为了使用生成的Wasm模块，我们将把<code>release.wasm</code>文件作为资产添加到我们的Flutter应用程序中。我们还将使用<a href="https://pub.dev/packages/wasm_interop" target="_blank" rel="noopener"> wasm_interop </a>包，它为我们处理JavaScript WebAssembly绑定，并使我们能够通过调用公开的方法与WebAssembly进行交互。</p>
<p>首先，使用<code>flutter create .</code>命令在<code>wasm</code>文件夹中创建一个新的Flutter应用程序。然后，创建一个新的<code>assets/wasm</code>文件夹，并添加生成的<code>release.wasm</code>文件。更新<code>pubspec.yaml</code>文件以包含资产文件夹和<code>wasm_interop</code>包:</p>
<pre class="language-yaml hljs">dependencies:
  wasm_interop: ^2.0.1
flutter:
  assets:
    - assets/wasm/
</pre>
<p>运行<code>flutter pub get</code>来添加依赖项。</p>
<p>更新<code>main.dart</code>文件中的<code>MyHomePage</code>小部件，如下所示:</p>
<pre class="language-dart hljs">class MyHomePage extends StatefulWidget {
  const MyHomePage({Key? key, required this.title}) : super(key: key);
  final String title;
  @override
  State&lt;MyHomePage&gt; createState() =&gt; _MyHomePageState();
}
class _MyHomePageState extends State&lt;MyHomePage&gt; {
  int _counter = 0;
  void _incrementCounter() {
  }
  void _decrementCounter() {
  }
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text(widget.title),
      ),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: &lt;Widget&gt;[
            const Text(
              'You current count is:',
            ),
            Text(
              '$_counter',
              style: Theme.of(context).textTheme.headline4,
            ),
            const SizedBox(
              height: 100,
            ),
            Wrap(
              spacing: 100,
              children: [
                ElevatedButton(
                    onPressed: _incrementCounter,
                    child: const Text('Increment')),
                ElevatedButton(
                    onPressed: _decrementCounter,
                    child: const Text('Decrement'))
              ],
            )
          ],
        ),
      ),
    );
  }
}
</pre>
<p>在根目录下运行<code>flutter run -d chrome</code>在Chrome上服务app。我们的应用程序有<strong>递增</strong>和<strong>递减</strong>按钮，它们将与我们的Wasm函数挂钩。</p>
<p><img data-attachment-id="131332" data-permalink="https://blog.logrocket.com/getting-started-webassembly-flutter-web/attachment/initial-app-state/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/initial-app-state.png" data-orig-size="730,456" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="initial-app-state" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/initial-app-state-300x187.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/initial-app-state.png" decoding="async" class="aligncenter size-full wp-image-131332 jetpack-lazy-image" src="../Images/44ede627387f0015bac1a5ebcbd9af5a.png" alt="Initial App State Ui" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/initial-app-state.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/initial-app-state-300x187.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/initial-app-state.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/initial-app-state.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="131332" data-permalink="https://blog.logrocket.com/getting-started-webassembly-flutter-web/attachment/initial-app-state/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/initial-app-state.png" data-orig-size="730,456" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="initial-app-state" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/initial-app-state-300x187.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/initial-app-state.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-131332" src="../Images/44ede627387f0015bac1a5ebcbd9af5a.png" alt="Initial App State Ui" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/initial-app-state.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/initial-app-state-300x187.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/initial-app-state.png"/></noscript>
<p>创建一个新的<code>wasm_loader.dart</code>文件并添加<code>WasmLoader</code>类。<code>WasmLoader</code>类包含了我们的Dart到Wasm的互操作性逻辑。</p>
<pre class="language-dart hljs">import 'package:flutter/services.dart' show rootBundle;
import 'package:wasm_interop/wasm_interop.dart';

class WasmLoader {
  WasmLoader({required this.path});
  late Instance? _wasmInstance;
  final String path;
  Future&lt;bool&gt; initialized() async {
    try {
      final bytes = await rootBundle.load(path);
      _wasmInstance = await Instance.fromBufferAsync(bytes.buffer);
      return isLoaded;
    } catch (exc) {
      // ignore: avoid_print
      print('Error on wasm init ${exc.toString()}');
    }
    return false;
  }
  bool get isLoaded =&gt; _wasmInstance != null;
  Object callfunction(String name, int input) {
    final func = _wasmInstance?.functions[name];
    return func?.call(input);
  }
}
</pre>
<p>上面的代码片段执行以下操作:</p>
<ul>
<li>在类构造函数中需要Wasm模块路径</li>
<li>在<code>initialized</code>方法中加载Wasm模块文件</li>
<li>使用异步<code>Instance.fromBufferAsync</code>方法编译和实例化Wasm代码。这个方法利用了<code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly/instantiate" target="_blank" rel="noopener">WebAssembly.instantiate()</a></code> JavaScript API</li>
<li>如果Wasm代码成功初始化，则返回<code>initialized</code>方法中的<code>isLoaded</code>状态</li>
<li>添加一个需要函数名和参数的<code>callfunction</code>方法，然后调用该函数</li>
</ul>
<p>最后，更新<code>main.dart</code>文件中的<code>MyHomePage</code>小部件，以使用<code>WasmLoader</code>:</p>
<pre class="language-dart hljs">  late WasmLoader loader;
  int _counter = 0;

  @override
  void initState() {
    super.initState();
    _init();
  }

  Future&lt;void&gt; _init() async {
    loader = WasmLoader(path: 'assets/wasm/release.wasm');
    final isLoaded = await loader.initialized();
    if (isLoaded) {
      setState(() {});
    }
  }

  void _incrementCounter() {
    _counter = loader.callfunction('plusOne', _counter) as int;
    setState(() {});
  }

  void _decrementCounter() {
    _counter = loader.callfunction('minusOne', _counter) as int;
    setState(() {});
  }
</pre>
<p>上面的代码片段执行以下操作:</p>
<ul>
<li>用我们的<code>.wasm</code>文件的路径创建一个<code>WasmLoader</code>的实例</li>
<li>初始化<code>WasmLoader</code>并在初始化后更新应用程序的状态</li>
<li>用调用Wasm模块中的<code>plusOne</code>和<code>minusOne</code>函数的结果更新<code>_counter</code>属性</li>
</ul>
<p>重新运行应用程序，点击<strong>增量</strong>和<strong>德</strong>T4】增量按钮——计数器相应更新。你成功地在你的Flutter应用中使用了WebAssembly代码！</p>
<h2 id="conclusion">结论</h2>
<p>在本教程中，我们讨论了WebAssembly，并研究了它在提高应用程序性能方面的一些好处。我们还研究了Flutter如何与JavaScript绑定交互。最后，我们使用AssemblyScript来生成WebAssembly模块，并将其连接到我们的Flutter web应用程序中。</p>
<p>这样，您现在可以在您的Flutter Web应用程序中使用WebAssembly并增强它们的性能。本文中的所有代码都可以在<a href="https://github.com/Ivy-Walobwa/flutter-web-wasm" target="_blank" rel="noopener"> GitHub </a>上获得。</p>
<p>我希望你喜欢这个教程！</p><div class="code-block code-block-4">
<div class="blog-plug base-cta"><h2>使用<a class="signup" href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>消除传统错误报告的干扰</h2>
<a href="https://lp.logrocket.com/blg/signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p><a href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一个数字体验分析解决方案，它可以保护您免受数百个假阳性错误警报的影响，只针对几个真正重要的项目。LogRocket会告诉您应用程序中实际影响用户的最具影响力的bug和UX问题。</p>
<p>然后，使用具有深层技术遥测的会话重放来确切地查看用户看到了什么以及是什么导致了问题，就像你在他们身后看一样。</p>
<p>LogRocket自动聚合客户端错误、JS异常、前端性能指标和用户交互。然后LogRocket使用机器学习来告诉你哪些问题正在影响大多数用户，并提供你需要修复它的上下文。</p>
<p>关注重要的bug—<a class="signup" href="https://lp.logrocket.com/blg/signup-issue-free" target="_blank" rel="noopener noreferrer">今天就试试LogRocket】。</a></p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>