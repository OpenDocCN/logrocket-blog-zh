<html>
<head>
<title>Getting started with NestJS, Vite, and esbuild - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>NestJS、Vite和esbuild - LogRocket博客入门</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/getting-started-with-nestjs-vite-esbuild/#0001-01-01">https://blog.logrocket.com/getting-started-with-nestjs-vite-esbuild/#0001-01-01</a></blockquote><div><article class="article-post">
 <h2>介绍</h2>
<p>在本文中，我们将了解NestJS、Vite和esbuild他们如何一起工作；以及如何配置一个NestJS应用程序，以便将其他两个工具作为依赖项来使用。在这个过程中，我们将学习如何在现实生活场景中使用它们，它们的主要特性和用例。</p>
<p><em>向前跳转:</em></p>

<h2 id="what-is-nestjs">什么是NestJS？</h2>
<p><a href="https://docs.nestjs.com/" target="_blank" rel="noopener"> NestJS </a>是一个Node.js框架，用于构建高效且可伸缩的企业服务器端/后端应用。根据文档，它支持JavaScript和TypeScript的所有最新ECMAScript版本。</p>
<p>NestJS结合了众所周知的OOP、函数式编程和函数式反应式编程的编程概念和哲学，以解决后端应用程序设计中的架构挑战，这些应用程序是可伸缩的、可维护的、易于测试的，并且不是紧密耦合在一起的。</p>
<p>尽管NestJS是<a href="https://docs.nestjs.com/first-steps#platform" target="_blank" rel="noopener">平台独立的</a>，并且如果为它编写了绑定，可以使用任何Node.js库，但NestJS默认使用Express作为依赖项，并且也可以配置为使用Fastify。通过公开的API和其他第三方模块轻松配置框架，使得开发人员可以非常容易地根据具体情况定制框架。</p>
<h2 id="what-is-vite">Vite是什么？</h2>
<p>Vite是一个构建工具，具有T2的许多特性，主要是近乎即时的开发服务器启动时间。它利用浏览器中引入的本地es模块和用编译成本地代码的语言编写的工具，来解决使用<a href="https://blog.logrocket.com/webpack-or-esbuild-why-not-both/" target="_blank" rel="noopener">以前的构建工具</a> (webpack、Parcel等)的问题。)与性能有关。</p>
<p>Vite首先将应用程序中的模块分为两类，依赖关系和源代码，因为依赖关系在开发过程中很少改变。Vite使用<a href="https://esbuild.github.io/" target="_blank" rel="noopener"> esbuild </a>预先捆绑了这些依赖项。对于可能需要转换的源代码(CSS、JSX等)。)，Vite通过本地ESM将它们提供给浏览器。</p>
<p>当浏览器请求源代码时，Vite根据需要转换并加载它们，浏览器可以使用基于路由的<a href="https://blog.logrocket.com/dynamic-imports-code-splitting-next-js/" target="_blank" rel="noopener">代码分割和条件动态导入</a>来捆绑所需的代码，这使得这个过程非常快。</p>
<h2 id="what-is-esbuild">什么是esbuild？</h2>
<p>esbuild是一个用Go编写的速度极快的JavaScript bundler，它利用Go的并行性和将源代码转换成机器码的能力。除其他外，其特点包括:</p>
<ul>
<li>巨大的插件支持</li>
<li>迷你机</li>
<li>类型脚本和JSX支持</li>
<li>ES2015和CommonJS模块都支持</li>
<li>摇树能力</li>
</ul>
<h2 id="installing-configuring-nestjs-app">安装和配置NestJS应用程序</h2>
<p>既然我们已经在较高的层次上了解了NestJS、Vite和esbuild，那么让我们继续通过配置NestJS应用程序来了解它们是如何协同工作的，以便将Vite和esbuild用作依赖项。在这个过程中，我们将学习如何在现实生活场景中使用它们，它们的主要特性和主要用例。</p>
<p>要开始使用NestJS，请先安装CLI，它会引导启动代码。对于那些不熟悉NestJS的人来说，这是一个特别好的选择。</p>
<p>另一个选择是<a href="https://github.com/nestjs/typescript-starter" target="_blank" rel="noopener">从GitHub克隆启动器repo </a>。注意，要安装starter项目的JavaScript风格，我们可以<a href="https://github.com/nestjs/javascript-starter" target="_blank" rel="noopener">克隆这个repo </a>，但是您需要Babel来编译普通的JavaScript。</p>
<p>出于我们的目的，我们将继续安装CLI。运行以下命令:</p>
<pre class="language-bash hljs">npm i -g @nestjs/cli
</pre>
<p>安装完CLI后，我们可以继续创建一个新的Nest项目:</p>
<pre class="language-bash hljs">nest new nest_vite_esbuild_demo
</pre>
<p>运行该命令的输出如下所示:</p>
<pre class="language-bash hljs">nest new nest_vite_esbuild_demo                                                                                 took 24s
⚡  We will scaffold your app in a few seconds..

CREATE nest_vite_esbuild_demo/.eslintrc.js (665 bytes)
CREATE nest_vite_esbuild_demo/.prettierrc (51 bytes)
CREATE nest_vite_esbuild_demo/README.md (3340 bytes)
CREATE nest_vite_esbuild_demo/nest-cli.json (118 bytes)
CREATE nest_vite_esbuild_demo/package.json (2007 bytes)
CREATE nest_vite_esbuild_demo/tsconfig.build.json (97 bytes)
CREATE nest_vite_esbuild_demo/tsconfig.json (546 bytes)
CREATE nest_vite_esbuild_demo/src/app.controller.spec.ts (617 bytes)
CREATE nest_vite_esbuild_demo/src/app.controller.ts (274 bytes)
CREATE nest_vite_esbuild_demo/src/app.module.ts (249 bytes)
CREATE nest_vite_esbuild_demo/src/app.service.ts (142 bytes)
CREATE nest_vite_esbuild_demo/src/main.ts (208 bytes)
CREATE nest_vite_esbuild_demo/test/app.e2e-spec.ts (630 bytes)
CREATE nest_vite_esbuild_demo/test/jest-e2e.json (183 bytes)

? Which package manager would you ❤️  to use? (Use arrow keys)
❯ npm 
  yarn 
  pnpm 
</pre>
<p>确保你的机器上安装了最新的Node.js版本(除了v13，它<a href="https://github.com/nestjs/nest/issues/4870" target="_blank" rel="noopener">不支持</a>)。</p>
<p>从上面我们可以看到，项目目录中已经填充了Nest的核心文件、依赖项和基本模块。遵循这些步骤并选择您所选择的包管理器。在这篇文章中，我们使用了npm。安装结束时的文件夹结构如下所示。</p>
<figure id="attachment_130663" aria-describedby="caption-attachment-130663" class="wp-caption aligncenter"><img data-attachment-id="130663" data-permalink="https://blog.logrocket.com/getting-started-with-nestjs-vite-esbuild/attachment/folder-structure-scaffolding-nestjs-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/folder-structure-scaffolding-nestjs-app.png" data-orig-size="730,861" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="folder-structure-scaffolding-nestjs-app" data-image-description="" data-image-caption="&lt;p&gt;The folder structure for scaffolding our NestJS app&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/folder-structure-scaffolding-nestjs-app-254x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/folder-structure-scaffolding-nestjs-app.png" decoding="async" class="size-full wp-image-130663 jetpack-lazy-image" src="../Images/2674c698af6e5305b5bafe6542c5dc5d.png" alt="The folder structure for scaffolding our NestJS app" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/folder-structure-scaffolding-nestjs-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/folder-structure-scaffolding-nestjs-app-254x300.png 254w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/folder-structure-scaffolding-nestjs-app.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/folder-structure-scaffolding-nestjs-app.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="130663" data-permalink="https://blog.logrocket.com/getting-started-with-nestjs-vite-esbuild/attachment/folder-structure-scaffolding-nestjs-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/folder-structure-scaffolding-nestjs-app.png" data-orig-size="730,861" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="folder-structure-scaffolding-nestjs-app" data-image-description="" data-image-caption="&lt;p&gt;The folder structure for scaffolding our NestJS app&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/folder-structure-scaffolding-nestjs-app-254x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/folder-structure-scaffolding-nestjs-app.png" decoding="async" loading="lazy" class="size-full wp-image-130663" src="../Images/2674c698af6e5305b5bafe6542c5dc5d.png" alt="The folder structure for scaffolding our NestJS app" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/folder-structure-scaffolding-nestjs-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/folder-structure-scaffolding-nestjs-app-254x300.png 254w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/folder-structure-scaffolding-nestjs-app.png"/></noscript><figcaption id="caption-attachment-130663" class="wp-caption-text">The folder structure for scaffolding our NestJS app</figcaption></figure>
<p>接下来，我们可以通过运行以下命令导航到该文件夹。</p>
<pre class="language-bash hljs">cd nest_vite_esbuild_demo
</pre>
<p>然后，继续开始这个项目:</p>
<pre class="language-bash hljs">npm run start
</pre>
<p>运行该命令的输出如下所示。</p>
<pre class="language-bash hljs">npm run start                  

&gt; <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e08e859394bf96899485bf85938295898c84bf84858d8fa0d0ced0ced1">[email protected]</a> start
&gt; nest start

[Nest] 33031  - 08/08/2022, 3:22:16 AM     LOG [NestFactory] Starting Nest application...
[Nest] 33031  - 08/08/2022, 3:22:16 AM     LOG [InstanceLoader] AppModule dependencies initialized +48ms
[Nest] 33031  - 08/08/2022, 3:22:16 AM     LOG [RoutesResolver] AppController {/}: +8ms
[Nest] 33031  - 08/08/2022, 3:22:16 AM     LOG [RouterExplorer] Mapped {/, GET} route +3ms
[Nest] 33031  - 08/08/2022, 3:22:16 AM     LOG [NestApplication] Nest application successfully started +8ms
</pre>
<p>作为上述方法的替代方法，我们也可以在开发模式下启动我们的应用程序，通过运行下面的命令来观察文件更改、重新编译构建，并重新加载dev服务器:</p>
<pre class="language-bash hljs">npm run start:dev
</pre>
<p>然后，在浏览器中导航至<a href="http://localhost:3000/" target="_blank" rel="noopener"> <code>http://localhost:3000/</code> </a>。此外，我们还可以手动安装NestJS的核心依赖项。在这个设置中，我们可以按照自己的意愿设置项目结构，只需运行下面的命令。</p>
<pre class="language-bash hljs">npm i --save @nestjs/core @nestjs/common reflect-metadata
</pre>
<h2 id="exploring-nestjs-boilerplate">探索NestJS样板文件</h2>
<p>当我们导航到项目文件夹中的<code>src</code>目录时，我们可以看到为我们创建的默认文件。我们有:</p>
<ol>
<li><code>app.controller.ts</code>文件，它用一条路径表示我们的处理程序</li>
<li><code>app.service.ts</code>文件，它处理与方法或实用函数相关的任何事情，以保持控制器的苗条</li>
<li><code>app.module</code>文件，它处理应用程序的基本模块(一种构造应用程序组件的方式)</li>
<li><code>app.controller.spec.ts</code>文件，处理测试我们的控制器逻辑</li>
<li><code>main.ts</code>文件，它是我们应用程序的入口点，使用核心<code>NestFactory</code>函数创建一个嵌套应用程序实例</li>
</ol>
<figure id="attachment_130665" aria-describedby="caption-attachment-130665" class="wp-caption aligncenter"><img data-attachment-id="130665" data-permalink="https://blog.logrocket.com/getting-started-with-nestjs-vite-esbuild/attachment/src-directory-default-files/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/src-directory-default-files.png" data-orig-size="730,438" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="src-directory-default-files" data-image-description="" data-image-caption="&lt;p&gt;The default files in our &lt;code&gt;src&lt;/code&gt; directory&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/src-directory-default-files-300x180.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/src-directory-default-files.png" decoding="async" class="size-full wp-image-130665 jetpack-lazy-image" src="../Images/ea446834c9cd1a2eef5aba20bb5207ab.png" alt="The default files in our src directory" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/src-directory-default-files.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/src-directory-default-files-300x180.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/src-directory-default-files.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/src-directory-default-files.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="130665" data-permalink="https://blog.logrocket.com/getting-started-with-nestjs-vite-esbuild/attachment/src-directory-default-files/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/src-directory-default-files.png" data-orig-size="730,438" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="src-directory-default-files" data-image-description="" data-image-caption="&lt;p&gt;The default files in our &lt;code&gt;src&lt;/code&gt; directory&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/src-directory-default-files-300x180.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/src-directory-default-files.png" decoding="async" loading="lazy" class="size-full wp-image-130665" src="../Images/ea446834c9cd1a2eef5aba20bb5207ab.png" alt="The default files in our src directory" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/src-directory-default-files.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/src-directory-default-files-300x180.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/src-directory-default-files.png"/></noscript><figcaption id="caption-attachment-130665" class="wp-caption-text">The default files in our <code>src</code> directory</figcaption></figure>
<p>NestJS鼓励开发人员尽可能保持他们的应用程序架构模块化，源目录中的每个目录代表一个模块。每个嵌套应用程序必须至少有一个模块，一个根模块，这是构建应用程序图的起点。</p>
<p>例如，我们可以运行以下命令来创建一个新模块:</p>
<pre class="language-bash hljs">nest g module product_demo
</pre>
<figure id="attachment_130667" aria-describedby="caption-attachment-130667" class="wp-caption aligncenter"><img data-attachment-id="130667" data-permalink="https://blog.logrocket.com/getting-started-with-nestjs-vite-esbuild/attachment/new-product-demo-module/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/new-product-demo-module.png" data-orig-size="730,551" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="new-product-demo-module" data-image-description="" data-image-caption="&lt;p&gt;Our new product demo module in the &lt;code&gt;src&lt;/code&gt; directory&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/new-product-demo-module-300x226.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/new-product-demo-module.png" decoding="async" class="size-full wp-image-130667 jetpack-lazy-image" src="../Images/ce4049a25e84debe198731f6ce50f0d2.png" alt="Our new product demo module in the src directory" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/new-product-demo-module.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/new-product-demo-module-300x226.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/new-product-demo-module.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/new-product-demo-module.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="130667" data-permalink="https://blog.logrocket.com/getting-started-with-nestjs-vite-esbuild/attachment/new-product-demo-module/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/new-product-demo-module.png" data-orig-size="730,551" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="new-product-demo-module" data-image-description="" data-image-caption="&lt;p&gt;Our new product demo module in the &lt;code&gt;src&lt;/code&gt; directory&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/new-product-demo-module-300x226.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/new-product-demo-module.png" decoding="async" loading="lazy" class="size-full wp-image-130667" src="../Images/ce4049a25e84debe198731f6ce50f0d2.png" alt="Our new product demo module in the src directory" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/new-product-demo-module.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/new-product-demo-module-300x226.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/new-product-demo-module.png"/></noscript><figcaption id="caption-attachment-130667" class="wp-caption-text">Our new product demo module in the <code>src</code> directory</figcaption></figure>
<p>从上面可以看出，我们已经创建了一个<code>product_demo</code>模块。然后，我们可以继续创建其他需要的文件——<code>controller</code>和<code>services</code>——并将<code>product_demo</code>模块导入到应用基础模块中。</p>
<p>关于NestJS基础和特性的更多信息，我们可以参考文档，包括<a href="https://docs.nestjs.com/fundamentals/testing" target="_blank" rel="noopener">测试</a>、<a href="https://docs.nestjs.com/providers" target="_blank" rel="noopener">提供者</a>、<a href="https://docs.nestjs.com/fundamentals/lifecycle-events" target="_blank" rel="noopener">生命周期事件</a>、<a href="https://docs.nestjs.com/custom-decorators" target="_blank" rel="noopener">装饰者</a>、<a href="https://docs.nestjs.com/middleware" target="_blank" rel="noopener">中间件</a>、<a href="https://docs.nestjs.com/modules" target="_blank" rel="noopener">模块</a>等。，以掌握框架。接下来，让我们继续在我们的NestJS应用程序上设置Vite和esbuild。</p>
<h2 id="installing-vite-esbuild-nestjs">用NestJS安装Vite和esbuild</h2>
<p>Vite是基于插件的，还带有一个优化良好的快速构建过程，这可以极大地提高您的整体开发效率和体验。它还支持现成的TypeScript。</p>
<p>现在，让我们将Vite集成到我们的NestJS后端应用程序中。我们将通过插件安装Vite，它运行一个带有热模块替换的节点开发服务器。</p>
<p>作为开发依赖项运行下面的命令。</p>
<pre class="language-bash hljs">npm install vite vite-plugin-node -D
</pre>
<p>接下来，在我们的项目目录的根目录中，我们可以创建<code>vite.config.ts</code>文件，它配置我们的项目来使用插件。让我们看看下面这个文件的内容。</p>
<pre class="language-typescript hljs">import { defineConfig } from 'vite';
import { VitePluginNode } from 'vite-plugin-node';
export default defineConfig({
  // ...vite configures
  server: {
    // vite server configs, for details see \[vite doc\](https://vitejs.dev/config/#server-host)
    port: 3000
  },
  plugins: [
    ...VitePluginNode({
      // Nodejs native Request adapter
      // currently this plugin support 'express', 'nest', 'koa' and 'fastify' out of box,
      // you can also pass a function if you are using other frameworks, see Custom Adapter section
      adapter: 'nest',
      // tell the plugin where is your project entry
      appPath: './src/main.ts',
      // Optional, default: 'viteNodeApp'
      // the name of named export of you app from the appPath file
      exportName: 'viteNodeApp',
      // Optional, default: 'esbuild'
      // The TypeScript compiler you want to use
      // by default this plugin is using vite default ts compiler which is esbuild
      // 'swc' compiler is supported to use as well for frameworks
      // like Nestjs (esbuild dont support 'emitDecoratorMetadata' yet)
      // you need to INSTALL `@swc/core` as dev dependency if you want to use swc
      tsCompiler: 'esbuild',
    })
  ],
  optimizeDeps: {
    // Vite does not work well with optionnal dependencies,
    // mark them as ignored for now
    exclude: [
        '@nestjs/microservices',
        '@nestjs/websockets',
        'cache-manager',
        'class-transformer',
        'class-validator',
        'fastify-swagger',
      ],
  },
});
</pre>
<p>接下来，我们需要更新我们的应用服务器文件(<code>main.ts</code>)的入口点，以导出名为<code>viteNodeApp</code>(在上面的Vite config <code>exportName</code>字段中)或我们在上面的Vite config文件中配置的任何其他名称的应用。见下文。</p>
<pre class="language-typescript hljs">import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
if (import.meta.env.PROD) {
  async function bootstrap() {
    const app = await NestFactory.create(AppModule);
    await app.listen(3000);
  }
  bootstrap();
}

export const viteNodeApp = NestFactory.create(AppModule);
</pre>
<p>接下来，在我们的<code>package.json</code>文件中，我们可以继续添加一个npm脚本，用常规的<code>npm run dev</code>命令运行开发服务器:</p>
<pre class="language-json hljs">"scripts": {
  "dev": "vite"
}
</pre>
<p>正如我们前面提到的，Vite附带了一个开发服务器，它通过本地ESM提供我们的源文件。当我们在整个设置完成后使用<code>npm run dev</code>命令在Vite dev服务器上运行我们的应用程序时，我们会看到下面的输出。</p>
<figure id="attachment_130669" aria-describedby="caption-attachment-130669" class="wp-caption aligncenter"><img data-attachment-id="130669" data-permalink="https://blog.logrocket.com/getting-started-with-nestjs-vite-esbuild/attachment/output-after-running-npm-run-dev/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-dev.png" data-orig-size="730,355" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="output-after-running-npm-run-dev" data-image-description="" data-image-caption="&lt;p&gt;The output after running the &lt;code&gt;npm run dev&lt;/code&gt; command&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-dev-300x146.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-dev.png" decoding="async" class="size-full wp-image-130669 jetpack-lazy-image" src="../Images/b8813dec63d1c65c851d28ec9bb8e0c0.png" alt="The output after running the npm run dev command" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-dev.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-dev-300x146.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-dev.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-dev.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="130669" data-permalink="https://blog.logrocket.com/getting-started-with-nestjs-vite-esbuild/attachment/output-after-running-npm-run-dev/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-dev.png" data-orig-size="730,355" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="output-after-running-npm-run-dev" data-image-description="" data-image-caption="&lt;p&gt;The output after running the &lt;code&gt;npm run dev&lt;/code&gt; command&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-dev-300x146.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-dev.png" decoding="async" loading="lazy" class="size-full wp-image-130669" src="../Images/b8813dec63d1c65c851d28ec9bb8e0c0.png" alt="The output after running the npm run dev command" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-dev.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-dev-300x146.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-dev.png"/></noscript><figcaption id="caption-attachment-130669" class="wp-caption-text">The output after running the <code>npm run dev</code> command</figcaption></figure>
<p>为了确保一切仍按预期运行，用<code>npm run test</code>命令运行测试套件，我们可以看到下面的输出。</p>
<figure id="attachment_130673" aria-describedby="caption-attachment-130673" class="wp-caption aligncenter"><img data-attachment-id="130673" data-permalink="https://blog.logrocket.com/getting-started-with-nestjs-vite-esbuild/attachment/output-after-running-npm-run-test/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-test.png" data-orig-size="730,316" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="output-after-running-npm-run-test" data-image-description="" data-image-caption="&lt;p&gt;The output after running the &lt;code&gt;npm run test&lt;/code&gt; command&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-test-300x130.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-test.png" decoding="async" class="size-full wp-image-130673 jetpack-lazy-image" src="../Images/42b3d2f5ababf8bc8e1b488e5af6bd28.png" alt="The output after running the npm run test command" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-test.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-test-300x130.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-test.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-test.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="130673" data-permalink="https://blog.logrocket.com/getting-started-with-nestjs-vite-esbuild/attachment/output-after-running-npm-run-test/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-test.png" data-orig-size="730,316" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="output-after-running-npm-run-test" data-image-description="" data-image-caption="&lt;p&gt;The output after running the &lt;code&gt;npm run test&lt;/code&gt; command&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-test-300x130.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-test.png" decoding="async" loading="lazy" class="size-full wp-image-130673" src="../Images/42b3d2f5ababf8bc8e1b488e5af6bd28.png" alt="The output after running the npm run test command" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-test.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-test-300x130.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-test.png"/></noscript><figcaption id="caption-attachment-130673" class="wp-caption-text">The output after running the <code>npm run test</code> command</figcaption></figure>
<p>该插件还使用Vite的服务器端渲染模式来构建我们的应用程序。为了利用这个特性，我们可以继续向我们的<code>package.json</code>文件添加一个构建脚本(使用Vite而不是Nest来构建我们的应用程序):</p>
<pre class="language-json hljs">"scripts": {
  "build": "vite build"
},
</pre>
<p><code>vite build</code>命令将我们的代码与<a href="https://rollupjs.org/" target="_blank" rel="noopener"> Rollup </a>捆绑在一起，并为我们的生产环境提供高度优化的资产。当我们在整个设置完成后通过运行<code>npm run build</code>命令用Vite构建我们的应用程序时，我们可以看到下面的输出。</p>
<figure id="attachment_130675" aria-describedby="caption-attachment-130675" class="wp-caption aligncenter"><img data-attachment-id="130675" data-permalink="https://blog.logrocket.com/getting-started-with-nestjs-vite-esbuild/attachment/output-after-running-npm-run-build/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-build.png" data-orig-size="730,159" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="output-after-running-npm-run-build" data-image-description="" data-image-caption="&lt;p&gt;The output after running the &lt;code&gt;npm run build&lt;/code&gt; command&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-build-300x65.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-build.png" decoding="async" class="size-full wp-image-130675 jetpack-lazy-image" src="../Images/aff1fc0f0cafbb1ee15f499afa1ecb98.png" alt="The output after running the npm run build command" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-build.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-build-300x65.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-build.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-build.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="130675" data-permalink="https://blog.logrocket.com/getting-started-with-nestjs-vite-esbuild/attachment/output-after-running-npm-run-build/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-build.png" data-orig-size="730,159" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="output-after-running-npm-run-build" data-image-description="" data-image-caption="&lt;p&gt;The output after running the &lt;code&gt;npm run build&lt;/code&gt; command&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-build-300x65.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-build.png" decoding="async" loading="lazy" class="size-full wp-image-130675" src="../Images/aff1fc0f0cafbb1ee15f499afa1ecb98.png" alt="The output after running the npm run build command" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-build.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-build-300x65.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/output-after-running-npm-run-build.png"/></noscript><figcaption id="caption-attachment-130675" class="wp-caption-text">The output after running the <code>npm run build</code> command</figcaption></figure>
<p>如前所述，Vite利用esbuild将TypeScript转换成JavaScript。这是一个非常快速的编译过程——它甚至可以比常规的TypeScript编译器快20倍，HMR更新可以在50毫秒内反映在浏览器中。</p>
<p>使用Vite插件(<a href="https://github.com/axe-me/vite-plugin-node" target="_blank" rel="noopener"> vite-plugin-node </a>)的一个好处是，我们可以选择使用esbuild或swc来编译我们的类型脚本文件，尽管在本文中我们只使用了esbuild。</p>
<h2>结论</h2>
<p>在这篇文章中，我们学习了如何使用NestJS、Vite和esbuild。正如我们所看到的，NestJS有一种有趣的、相当新的方法来构建Node.js应用程序，其哲学围绕着OOP、FP和FRP。从长远来看，这些改进极大地提高了开发人员的时间和生产力，因为我们不必担心如何设计我们的模块和组件。NestJS为我们解决了这个问题，并提出了每个文件夹一个模块的模式。我们还可以使用TypeScript的强大功能来编写我们的后端代码。</p>
<p>另一方面，Vite在构建工具领域处于一个全新的水平。它出现在NodeJS生态系统中流行的基于JS的捆绑器和构建工具需要在性能方面得到提升的时候。Vite使用与webpack和package完全不同的方法将我们的代码编译成本机代码。据我们所知，它使用浏览器和本机ESM进行捆绑。</p>
<p>总之，我们将这些令人敬畏的技术结合起来，构建了一个简单的样板后端，可以作为下一个NestJS项目的起点。</p><div class="code-block code-block-4">
<div class="blog-plug base-cta"><h2>使用<a class="signup" href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>消除传统错误报告的干扰</h2>
<a href="https://lp.logrocket.com/blg/signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p><a href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一个数字体验分析解决方案，它可以保护您免受数百个假阳性错误警报的影响，只针对几个真正重要的项目。LogRocket会告诉您应用程序中实际影响用户的最具影响力的bug和UX问题。</p>
<p>然后，使用具有深层技术遥测的会话重放来确切地查看用户看到了什么以及是什么导致了问题，就像你在他们身后看一样。</p>
<p>LogRocket自动聚合客户端错误、JS异常、前端性能指标和用户交互。然后LogRocket使用机器学习来告诉你哪些问题正在影响大多数用户，并提供你需要修复它的上下文。</p>
<p>关注重要的bug—<a class="signup" href="https://lp.logrocket.com/blg/signup-issue-free" target="_blank" rel="noopener noreferrer">今天就试试LogRocket】。</a></p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>