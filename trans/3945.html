<html>
<head>
<title>When and how to use CSS will-change </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>何时以及如何使用CSS将会改变</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/when-how-use-css-will-change/#0001-01-01">https://blog.logrocket.com/when-how-use-css-will-change/#0001-01-01</a></blockquote><div><article class="article-post">
<p>CSS属性是一个强大的工具，允许开发者向浏览器提示页面上可能很快会改变的元素。这使浏览器有机会提前优化这些元素的呈现，从而有可能获得更好的性能。</p>
<p>本文将讨论如何使用<code>will-change</code>属性以及何时避免使用它。我们还将分享有关其浏览器支持的信息。</p>
<p><em> <strong>注意，</strong> <code>will-change</code>应谨慎使用，因为过度使用实际上会损害性能，而不是提高性能。</em></p>
<p><em>向前跳转:</em></p>
<p>什么是<code>will-change</code>？</p>

<h2 id="what-will-change"><code>will-change</code>是一个CSS属性，它告诉浏览器元素的哪些属性(例如，内容、滚动位置、不透明度等)。)将来可能会改变。这使得浏览器可以提前优化元素的呈现，从而有可能提高性能。</h2>
<p>例如，假设您有一个包含许多相同大小和颜色的元素的页面。如果您知道这些元素中的一个将很快改变大小或颜色，您可以使用<code>will-change</code>在这种改变发生之前通知浏览器。</p>
<p>这种“抬头”将允许浏览器优化元素的呈现，当发生变化时，可能会带来更好的性能。</p>
<p>为什么要用<code>will-change</code>？</p>
<h2 id="why-use-will-change">有几个原因可能会让你想使用<code>will-change</code>。让我们来看看。</h2>
<p>优化性能</p>
<h3 id="optimizing-performance">如前所述，使用<code>will-change</code>的主要原因是为了提高性能。通过让浏览器知道哪些元素可能会很快改变，它可以提前优化这些元素的呈现，从而在改变实际发生时潜在地带来更好的性能。</h3>
<p>改进动画</p>
<h3 id="improving-animations"><code>will-change</code><a href="https://blog.logrocket.com/understanding-animation-transition-timing-functions-css/">能否提高动画的性能</a>。它允许浏览器优化元素呈现，潜在地产生更平滑和更流畅的动画。如果你知道一个元素将被动画化，你可以使用<code>will-change</code>来通知浏览器。</h3>
<p>防止重画和重排</p>
<h3 id="preventing-repaints-reflows">重绘和重排是开销很大的操作，会显著影响页面的性能。当对元素进行不影响DOM布局的更改时(例如，元素背景的更改)，会发生重绘。当对元素的改变确实影响DOM布局(例如，元素的宽度或高度的改变)时，发生重排。</h3>
<p>通过使用<code>will-change</code>，你可以帮助避免不必要的重画和重排版，进一步提高页面的性能。</p>
<p>分解<code>will-change</code>语法</p>
<h2 id="breaking-down-will-change"><code>will-change</code>语法看起来像这样:</h2>
<p><code>will-change</code>属性可以有一个或多个值:</p>
<pre class="language-css hljs">will-change: &lt;animateable-feature&gt; = auto | scroll-position | contents | &lt;custom-ident&gt;
</pre>
<p><code>auto</code>:告诉浏览器应该应用标准优化；这是默认值</p>
<ul>
<li><code>scroll-position</code>:告诉浏览器一个元素的滚动位置将在稍后被动画显示，并且应该为在该元素的滚动窗口中不可见的内容做准备</li>
<li><code>contents</code>:告诉浏览器某个元素的内容将会改变，所以浏览器不应该缓存这个元素的内容</li>
<li><code>&lt;custom-indent&gt;</code>:可以是任何自定义属性，如transform或background。它告诉浏览器属性的值将很快改变；它也可以是由逗号分隔的一个或多个属性</li>
<li><strong>注意，</strong>如果你指定一个简写属性作为<code>custom-indent</code>值(例如<code>background</code>，你是在告诉浏览器<code>background-color</code>、<code>background-image</code>、<code>background-position</code>以及其他与背景相关的属性可能会改变</li>
</ul>
<blockquote><p>向元素添加<code>will-change</code></p></blockquote>
<h2 id="adding-will-change-element">使用<code>will-change</code>属性相对简单。只需将<code>will-change</code>添加到您想要优化的元素中，并指定可能会改变的属性，如下所示:</h2>
<p>在上面的例子中，我们告诉浏览器元素的高度、宽度和颜色属性可能很快会改变。这允许浏览器优化元素的呈现，当属性发生更改时，可能会带来更好的性能。</p>
<pre class="language-css hljs">element {

will-change: height, width, color;

}
</pre>
<p>不要在动画或过渡点使用<code>will-change</code>属性；相反，在过渡或动画之前使用它。<code>will-change</code>应该告诉浏览器一个即将到来的变化，以便浏览器能够做好准备。</p>
<p>浏览器无法为当前正在发生或已经发生的更改做准备。</p>
<p>例如，不是在转换点直接将它添加到元素，就像这样:</p>
<p>当还没有发生变化时，您将把它添加到元素的初始状态:</p>
<pre class="language-css hljs">my-element:hover {
  will-change: color;
  color: red;
}
</pre>
<p>此外，最好的做法是在期望的变化发生之前和之后打开和关闭<code>will-change</code>,特别是如果这种变化不经常发生的话。从CSS样式表中很难做到这一点，但是使用JavaScript，您可以轻松地将它添加(和删除)到元素中:</p>
<pre class="language-css hljs">.element {
  will-change: color;
  transition: color 300ms ease-in-out;
}

.my-element:hover {
  color: red;
} 
</pre>
<p>既然我们已经了解了如何使用<code>will-change</code>，那就来看看什么时候使用吧。</p>
<pre class="language-css hljs">const el = document.querySelector('.parent-element')
el.addEventListener('mouseenter', addWillChange)
el.addEventListener(mouseleave, removeWillChange)

const addWillChange = () =&gt; {
  this.style.willChange = 'color'
}

const removeWillChange = () =&gt; {
  this.style.willChange = 'auto'
}
</pre>
<p>何时使用CSS <code>will-change</code></p>
<h2 id="when-use-will-change">在不同的情况下，您可能希望使用CSS <code>will-change</code>属性来<a href="https://blog.logrocket.com/best-practices-improving-css-performance/">提高页面</a>的性能。例如，如果您发现动画的某些部分运行不流畅，并且其他优化没有帮助，您可以尝试<code>will-change</code>使其更加流畅和清晰，从而提高动画性能:</h2>
<p><img data-attachment-id="159459" data-permalink="https://blog.logrocket.com/when-how-use-css-will-change/attachment/using-css-will-change-communicate-property-changes-browser/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/using-css-will-change-communicate-property-changes-browser.gif" data-orig-size="426,240" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Using CSS will-change communicate property changes browser" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/using-css-will-change-communicate-property-changes-browser-300x169.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/using-css-will-change-communicate-property-changes-browser.gif" decoding="async" class="aligncenter wp-image-159459 size-full jetpack-lazy-image" src="../Images/89ffe686cb16e174e8a74f4170dce366.png" alt="Using CSS Will-Change Communicate Property Changes Browser" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/02/using-css-will-change-communicate-property-changes-browser.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/using-css-will-change-communicate-property-changes-browser.gif"/></p>
<pre class="language-css hljs">//CSS file
#animated-element {
  will-change: transform, opacity;
}

#animated-element.animated {
  transition: transform 0.5s, opacity 0.5s;
  transform: scale(2);
  opacity: 0;
}

//JS file
const element = document.querySelector('#animated-element');

element.addEventListener('click', () =&gt; {
  element.classList.toggle('animated');
});
</pre>
<p>在上面的例子中，我们使用<code>will-change</code>让浏览器知道当元素被点击时<code>#animated-element</code>的变换和不透明属性可能会改变。这使得浏览器能够优化其元素呈现，潜在地产生更平滑和更流畅的动画。</p><noscript><img data-lazy-fallback="1" data-attachment-id="159459" data-permalink="https://blog.logrocket.com/when-how-use-css-will-change/attachment/using-css-will-change-communicate-property-changes-browser/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/using-css-will-change-communicate-property-changes-browser.gif" data-orig-size="426,240" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Using CSS will-change communicate property changes browser" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/using-css-will-change-communicate-property-changes-browser-300x169.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/using-css-will-change-communicate-property-changes-browser.gif" decoding="async" loading="lazy" class="aligncenter wp-image-159459 size-full" src="../Images/89ffe686cb16e174e8a74f4170dce366.png" alt="Using CSS Will-Change Communicate Property Changes Browser" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/using-css-will-change-communicate-property-changes-browser.gif"/></noscript>
<p>CSS <code>will-change</code>属性的另一个用例是当你知道一个元素的大小或位置将很快改变时。使用<code>will-change</code>提前通知浏览器这一变化，使浏览器能够优化元素的呈现，当变化发生时，可能会带来更好的性能:</p>
<p><img data-attachment-id="159462" data-permalink="https://blog.logrocket.com/when-how-use-css-will-change/attachment/communicate-changes-browser-width-height-transform-css-will-change/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/communicate-changes-browser-width-height-transform-css-will-change.gif" data-orig-size="426,240" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Communicate changes browser width height transform CSS will-change" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/communicate-changes-browser-width-height-transform-css-will-change-300x169.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/communicate-changes-browser-width-height-transform-css-will-change.gif" decoding="async" class="aligncenter wp-image-159462 size-full jetpack-lazy-image" src="../Images/ad72c286abc067cffed7fcda12784153.png" alt="Communicate Changes Browser Width Height Transform CSS Will-Change" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/02/communicate-changes-browser-width-height-transform-css-will-change.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/communicate-changes-browser-width-height-transform-css-will-change.gif"/></p>
<pre class="language-css hljs">//CSS file
#changing-element {
  will-change: width, height, transform;
}
#changing-element.changed {
  width: 200px;
  height: 200px;
  transform: translateX(100px);
}

//JS file
const element = document.querySelector('#changing-element');
element.addEventListener('click', () =&gt; {
  element.classList.toggle('changed');
});
</pre>
<p>这里，我们使用<code>will-change</code>让浏览器知道<code>#changing-element</code>的宽度、高度和变换属性在被点击时可能会改变。</p><noscript><img data-lazy-fallback="1" data-attachment-id="159462" data-permalink="https://blog.logrocket.com/when-how-use-css-will-change/attachment/communicate-changes-browser-width-height-transform-css-will-change/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/02/communicate-changes-browser-width-height-transform-css-will-change.gif" data-orig-size="426,240" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Communicate changes browser width height transform CSS will-change" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/02/communicate-changes-browser-width-height-transform-css-will-change-300x169.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/02/communicate-changes-browser-width-height-transform-css-will-change.gif" decoding="async" loading="lazy" class="aligncenter wp-image-159462 size-full" src="../Images/ad72c286abc067cffed7fcda12784153.png" alt="Communicate Changes Browser Width Height Transform CSS Will-Change" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/02/communicate-changes-browser-width-height-transform-css-will-change.gif"/></noscript>
<p>其他<code>will-change</code>有用的例子是当一个元素的样式，比如颜色、字体大小或文本装饰，即将改变时。</p>
<p>何时避免使用<code>will-change</code></p>
<h2 id="when-avoid-use-will-change">在某些情况下，<code>will-change</code>属性对于优化性能和改进动画效果很有用，但是在某些情况下，最好避免使用它。谨慎使用<code>will-change</code>,并且只在可能很快改变并受益于优化的元素上使用。</h2>
<p>以下是一些应该避免使用<code>will-change</code>的情况:</p>
<p><strong>在活动动画或过渡期间</strong>:当动画或过渡已经开始时，不要将<code>will-change</code>应用于元素。只有当变化即将发生或可能在不久的将来发生时，才使用<code>will-change</code>,以便给浏览器足够的时间来优化其渲染。当变化已经发生或不再迫近时使用<code>will-change</code>会使浏览器过度紧张并损害性能</p>
<ul>
<li><strong>不可预测的变化</strong>:如果一个元素的变化是不可预测的，并且可能频繁或意外地发生，那么就不值得使用<code>will-change</code>，因为它会导致不必要的性能开销</li>
</ul>
<ul>
<li><strong>小元素</strong> : <code>will-change</code>对于页面上的小元素来说可能会适得其反，因为优化小元素的渲染所带来的性能提升可能是微不足道的</li>
</ul>
<ul>
<li><strong>不可设置动画的属性</strong>:如果你在不可设置动画的属性上使用<code>will-change</code>，比如字体大小或者边框半径，它可能对性能没有影响，甚至会对性能产生负面影响</li>
</ul>
<ul>
<li><strong>传统浏览器</strong> : <code>will-change</code>是一个相对较新的CSS属性，可能在较旧的浏览器中不被支持。如果你需要支持旧的浏览器，你可能需要完全避免使用<code>will-change</code></li>
</ul>
<ul>
<li><strong>过度使用</strong>:过度使用<code>will-change</code>实际上会损害而不是提高表现。你应该避免将<code>will-change</code>应用到一个页面的多个元素上。这会导致浏览器占用机器资源，从而降低页面加载时间。相反，只将它用在可能很快改变并从优化中受益的元素上。一般来说，<code>will-change</code>最适合用作响应性能问题的解决方案，而不是预先采取措施</li>
</ul>
<ul>
<li>浏览器对CSS的支持<code>will-change</code></li>
</ul>
<h2 id="browser-support-will-change">大多数现代浏览器都支持<code>will-change</code>属性，包括微软Edge 79+、谷歌Chrome 36.0+、Mozilla Firefox 36.0+、苹果Safari 9.1+和Opera 24+。你可以在这里了解更多关于<a href="https://caniuse.com/will-change">的浏览器支持。</a></h2>
<p>结论</p>
<h2 id="“conclusion”">CSS属性是一个很有价值的工具，可以优化页面上可能很快改变的元素的性能。通过让浏览器提前了解这些变化，浏览器可以优化这些元素的呈现，从而潜在地提高性能。</h2>
<p>然而，<code>will-change</code>应该谨慎使用，因为过度使用实际上会损害性能，而不是提高性能。您应该将此属性的使用限制在有特定需要的情况下，例如当动画元素时，或者当您知道元素的属性将会改变时。然后，一旦不再需要就将其移除。</p>
<p>同样重要的是要意识到，如果不必要，浏览器可能会忽略<code>will-change</code>提示。大多数现代浏览器都支持<code>will-change</code>。</p>
<p>通过了解何时以及如何使用CSS <code>will-change</code>属性，开发人员可以利用这个强大的工具来提高他们的网站和应用程序的性能。</p>
<p>你的前端是否占用了用户的CPU？</p><div class="code-block code-block-25">
<div class="blog-plug inline-plug css-plug"><h2>随着web前端变得越来越复杂，资源贪婪的特性对浏览器的要求越来越高。如果您对监控和跟踪生产环境中所有用户的客户端CPU使用、内存使用等感兴趣，</h2><p>.</p><a target="_blank" href="https://lp.logrocket.com/blg/css-signup">try LogRocket</a><p>LogRocket 就像是网络和移动应用的DVR，记录你的网络应用或网站上发生的一切。您可以汇总和报告关键的前端性能指标，重放用户会话和应用程序状态，记录网络请求，并自动显示所有错误，而不是猜测问题发生的原因。</p><a class="signup" href="https://lp.logrocket.com/blg/css-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/dacb06c713aec161ffeaffae5bd048cd.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/dacb06c713aec161ffeaffae5bd048cd.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png"/></noscript></a><a href="https://lp.logrocket.com/blg/css-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>现代化您调试web和移动应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/css-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p><p>Modernize how you debug web and mobile apps — <a class="signup" href="https://lp.logrocket.com/blg/css-signup" target="_blank" rel="noopener noreferrer">Start monitoring for free</a>.</p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>