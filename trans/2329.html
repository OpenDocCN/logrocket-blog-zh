<html>
<head>
<title>Web automation with Selenium and Python - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用 Selenium 和 Python 实现 Web 自动化</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/web-automation-selenium-python/#0001-01-01">https://blog.logrocket.com/web-automation-selenium-python/#0001-01-01</a></blockquote><div><article class="article-post">
<p>大家好！👋我最近搬到了华盛顿州的雷德蒙，并试图参加一些能让我保持活跃和运动的运动。四处看了一下后，我意识到这里有一半的人都打羽毛球，所以对我来说报名当地的羽毛球学院是一个很容易的决定。</p>
<p>然而，在报名后，我意识到大多数球场在黄金时段(下午 4-8 点)已经被预订了。我发现球场的预约在周六上午 10 点左右开始，接下来一整周的好时段在前 15-20 分钟就被预订了。</p>
<p>我做了任何一个正常的程序员都会做的事情，开始思考如何自动化整个预订过程。这篇文章将向您介绍手动预订流程，并解释我是如何实现自动化的。</p>
<p>你可以从 GitHub 下载机器人<a href="https://github.com/yasoob/nwba-booking-bot" target="_blank" rel="noopener">的源代码。</a></p>
<h2><strong>手动预约流程</strong></h2>
<p>在尝试自动化任何事情之前，充分探索手动工作流总是很重要的。我们将自动化西北羽毛球学院预订系统。这是他们的预订页面。</p>
<p><img data-attachment-id="75346" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/badminton-scheduling/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduling.png" data-orig-size="730,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Badminton scheduling home page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduling-300x190.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduling.png" decoding="async" class="size-full wp-image-75346 aligncenter jetpack-lazy-image" src="../Images/35cbdaad5990b3ac155fb9ff08f8d576.png" alt="Badminton Scheduling Home Page" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduling.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduling-300x190.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduling.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduling.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="75346" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/badminton-scheduling/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduling.png" data-orig-size="730,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Badminton scheduling home page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduling-300x190.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduling.png" decoding="async" loading="lazy" class="size-full wp-image-75346 aligncenter" src="../Images/35cbdaad5990b3ac155fb9ff08f8d576.png" alt="Badminton Scheduling Home Page" srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduling.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduling-300x190.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduling.png"/></noscript>
<p>此页面列出了所有的法院预订规则。记住这些对我们来说很重要，因为它们将在我们如何自动化预订中发挥作用。重要的规则是:</p>
<ol>
<li>我们每天只能预订 1 个位置</li>
<li>我们只能在工作日(周一至 Fri)预订 3 个座位</li>
<li>我们可以在周六和周日每天预订一个时段</li>
</ol>
<p>在页面底部，他们还链接到带有<a href="https://northwestbadmintonacademy.sites.zenplanner.com/calendar.cfm" target="_blank" rel="noopener">完整日历</a>的预订页面。点击后，您将被重定向到此页面:</p>
<p><img data-attachment-id="75348" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/badminton-member-login-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-member-login-page.png" data-orig-size="730,324" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Badminton member login page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-member-login-page-300x133.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-member-login-page.png" decoding="async" class="size-full wp-image-75348 aligncenter jetpack-lazy-image" src="../Images/908023f46ba6059164cabef05fa5c482.png" alt="Badminton Member Login Page" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-member-login-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-member-login-page-300x133.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-member-login-page.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-member-login-page.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="75348" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/badminton-member-login-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-member-login-page.png" data-orig-size="730,324" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Badminton member login page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-member-login-page-300x133.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-member-login-page.png" decoding="async" loading="lazy" class="size-full wp-image-75348 aligncenter" src="../Images/908023f46ba6059164cabef05fa5c482.png" alt="Badminton Member Login Page" srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-member-login-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-member-login-page-300x133.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-member-login-page.png"/></noscript>
<p>有趣的是，预订并不是由 NWBA 自己主持的。他们外包给 Zen Planner。因此，本质上，我们将自动化 Zen Planner 预订。这也意味着最终的自动化应该也适用于大多数使用 Zen Planner 的地方。</p>
<p>登录后，您可以进入<a href="https://northwestbadmintonacademy.sites.zenplanner.com/calendar.cfm" target="_blank" rel="noopener">日历页面</a>:</p>
<p><img data-attachment-id="75354" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/badminton-scheduler-time-slots/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduler-time-slots.png" data-orig-size="730,439" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Badminton scheduler time slots" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduler-time-slots-300x180.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduler-time-slots.png" decoding="async" class="size-full wp-image-75354 aligncenter jetpack-lazy-image" src="../Images/ef178273e64be0d3b5518f77f6a4b9f6.png" alt="Badminton Scheduler Time Slots" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduler-time-slots.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduler-time-slots-300x180.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduler-time-slots.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduler-time-slots.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="75354" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/badminton-scheduler-time-slots/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduler-time-slots.png" data-orig-size="730,439" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Badminton scheduler time slots" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduler-time-slots-300x180.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduler-time-slots.png" decoding="async" loading="lazy" class="size-full wp-image-75354 aligncenter" src="../Images/ef178273e64be0d3b5518f77f6a4b9f6.png" alt="Badminton Scheduler Time Slots" srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduler-time-slots.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduler-time-slots-300x180.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-scheduler-time-slots.png"/></noscript>
<p>日历显示了哪些时间段是空闲的。您可以点击任何有几个开放时段的时间，它会将您带到时段预订页面:</p>
<p><img data-attachment-id="75352" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/badminton-registration-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page.png" data-orig-size="730,437" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Badminton registration page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page-300x180.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page.png" decoding="async" class="size-full wp-image-75352 aligncenter jetpack-lazy-image" src="../Images/eb93cb1946f777452c572760eee80080.png" alt="Badminton Registration Page" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page-300x180.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="75352" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/badminton-registration-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page.png" data-orig-size="730,437" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Badminton registration page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page-300x180.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page.png" decoding="async" loading="lazy" class="size-full wp-image-75352 aligncenter" src="../Images/eb93cb1946f777452c572760eee80080.png" alt="Badminton Registration Page" srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page-300x180.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page.png"/></noscript>
<p>在这里，您可以点击<strong>预订</strong>，页面会刷新并告诉您预订成功。</p>
<p><img data-attachment-id="75350" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/badminton-registration-page-success/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page-success-e1635877165997.png" data-orig-size="730,474" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Badminton registration page success" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page-success-300x195.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page-success-1024x665.png" decoding="async" class="aligncenter wp-image-75350 size-full jetpack-lazy-image" src="../Images/d42a68f7f57c58a10b3673ca1fc0e582.png" alt="Badminton Registration Page Success" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page-success-e1635877165997.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page-success-e1635877165997.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="75350" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/badminton-registration-page-success/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page-success-e1635877165997.png" data-orig-size="730,474" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Badminton registration page success" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page-success-300x195.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page-success-1024x665.png" decoding="async" loading="lazy" class="aligncenter wp-image-75350 size-full" src="../Images/d42a68f7f57c58a10b3673ca1fc0e582.png" alt="Badminton Registration Page Success" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-registration-page-success-e1635877165997.png"/></noscript>
<p>在遵守预订规则的同时，我们每周可以预订总共 5 个时段，其中 3 个在工作日，2 个在周末。</p>
<p>现在我们知道了手动预订流程，让我们来看看如何实现自动化。</p>
<h2><strong>准备好工具</strong></h2>
<p>我们将在这个项目中使用 Python 3.9。我们将依靠 Selenium 来实现自动化。让我们首先创建一个全新的文件夹，在其中创建一个虚拟环境，并安装 Selenium:</p>
<pre class="language-bash hljs">$ mkdir booking_bot
$ cd booking_bot
$ python -m venv venv
$ source venv/bin/activate
$ pip install selenium
</pre>
<p>根据你使用的操作系统，你还需要下载相应的 Chrome 网络驱动。我们将使用 ChromeDriver 和 Selenium。你可以去<a href="https://chromedriver.chromium.org/" target="_blank" rel="noopener">官方 ChromeDriver 网站</a>下载你操作系统的最新稳定版。您将得到一个 zip 文件，这个 zip 文件将包含一个名为<code>chromedriver</code>的二进制文件。将这个二进制文件放在<code>booking_bot</code>文件夹中。</p>
<p>现在我们可以开始实际的编码了。</p>
<h2><strong>编码入门</strong></h2>
<p>我通常打开 Python REPL，并在后台保持一个<code>app.py</code>文件打开。我在 REPL 中以交互方式测试新代码，然后将代码复制到<code>app.py</code>文件中。这使得迭代循环变得非常快，我不需要在每一个小的变化中不断地重新运行<code>app.py</code>代码。</p>
<p>我们将在这里做同样的事情。在<code>booking_bot</code>文件夹中创建一个<code>app.py</code>文件，然后在终端中运行 Python。</p>
<p>让我们从导入 Selenium 开始，启动一个 Chrome 实例，并在其中打开 NWBA 登录页面:</p>
<pre class="language-bash hljs">from selenium import webdriver

url = "https://northwestbadmintonacademy.sites.zenplanner.com/login.cfm"

browser = webdriver.Chrome(executable_path='./chromedriver')
browser.get(url)
</pre>
<p>根据终端中运行 Python 的文件夹以及保存<code>chromedriver</code>可执行文件的位置，可执行文件的路径可能会有所不同。相应地修改路径。</p>
<p>如果一切顺利，你现在应该有一个 Chrome 窗口打开，上面写着“Chrome 正由自动化测试软件控制。”</p>
<h2><strong>自动登录</strong></h2>
<p>Selenium 的自动化工作方式是，我们需要告诉 Selenium 我们想要与哪些 HTML 标签交互，以及我们想要用它们做什么。自动化登录包括告诉 Selenium 页面上的哪些字段是用户名和密码字段，我们希望传递给它们什么值，然后告诉 Selenium 哪个按钮是提交按钮。</p>
<p>我们可以通过多种方式帮助 Selenium 找到页面上的相关标签。我们可以使用以下任何一种方法:</p>
<ul>
<li><code>find_element_by_id</code></li>
<li><code>find_element_by_name</code></li>
<li><code>find_element_by_xpath</code></li>
<li><code>find_element_by_link_text</code></li>
<li><code>find_element_by_partial_link_text</code></li>
<li><code>find_element_by_tag_name</code></li>
<li><code>find_element_by_class_name</code></li>
<li><code>find_element_by_css_selector</code></li>
</ul>
<p>你可以在这里找到这些方法<a href="https://selenium-python.readthedocs.io/locating-elements.html" target="_blank" rel="noopener">的完整文档。</a></p>
<p>此时，我们可以在 Chrome 中打开开发者工具，检查输入字段，看看哪种方法最适合我们的需求。</p>
<p><img data-attachment-id="75361" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/badminton-inspect-input-field/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-inspect-input-field.png" data-orig-size="730,316" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Inspect input field" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-inspect-input-field-300x130.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-inspect-input-field.png" decoding="async" class="size-full wp-image-75361 aligncenter jetpack-lazy-image" src="../Images/a989305a9e9547291eb45f357a960f70.png" alt="Inspect Input Field" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-inspect-input-field.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-inspect-input-field-300x130.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-inspect-input-field.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-inspect-input-field.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="75361" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/badminton-inspect-input-field/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-inspect-input-field.png" data-orig-size="730,316" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Inspect input field" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-inspect-input-field-300x130.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-inspect-input-field.png" decoding="async" loading="lazy" class="size-full wp-image-75361 aligncenter" src="../Images/a989305a9e9547291eb45f357a960f70.png" alt="Inspect Input Field" srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-inspect-input-field.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-inspect-input-field-300x130.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-inspect-input-field.png"/></noscript>
<p>基于输入字段的 HTML 代码，我们似乎可以使用输入标签的<code>name</code>属性来惟一地标识它:</p>
<pre class="language-python hljs">user_block = browser.find_element("name", "username")
pw_block = browser.find_element_by_name("password")
</pre>
<p>我们可以使用<code>send_keys</code>方法传入这些字段的值:</p>
<pre class="language-python hljs">user_block.send_keys("your_email")
pw_block.send_keys("your_password")
</pre>
<p>现在我们需要在按钮中唯一地标识<strong>日志。我将向你展示如何使用我最喜欢的方法来做到这一点。</strong></p>
<p>我们将使用 XPath。它们从未让我失望过，而且用途广泛，可以在任何地方使用。XPath 是一种用于在 XML 文档中定位节点的语言，它在 HTML 中同样适用。您需要学习一点语法，但是大多数情况下，在 Google 上快速搜索特定用例就足够了。</p>
<p><strong>登录</strong>按钮的类型为<code>SUBMIT</code>，我们将根据该类型定位它。这方面的代码是:</p>
<pre class="language-python hljs">submit_button = browser.find_element_by_xpath("//input[@type='SUBMIT']")
</pre>
<p>与<code>find_elements_by_xpath</code>相比，我们在这里使用<code>find_element_by_xpath</code>方法。这只返回一个元素。至于 XPath，<code>//</code>告诉 Selenium 找到输入标签，不管它在文档中嵌套得有多深。<code>type</code>告诉它只查找那些类型为<code>SUBMIT</code>的输入标签。</p>
<p>点击提交按钮现在就像:</p>
<pre class="language-python hljs">submit_button.click()
</pre>
<p>如果一切顺利，这将把我们重定向到配置文件视图。</p>
<h2><strong>自动化日历交互</strong></h2>
<p>我们需要弄清楚如何从个人资料视图到日历页面。谢天谢地，侧边栏中有一个方便的<code>Calendar</code>按钮。</p>
<p><img data-attachment-id="75363" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/badminton-profile-view/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-profile-view.png" data-orig-size="730,309" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Badminton profile view" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-profile-view-300x127.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-profile-view.png" decoding="async" class="size-full wp-image-75363 aligncenter jetpack-lazy-image" src="../Images/d092a8996808103f42ccb1f282399d09.png" alt="Badminton Profile View" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-profile-view.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-profile-view-300x127.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-profile-view.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-profile-view.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="75363" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/badminton-profile-view/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-profile-view.png" data-orig-size="730,309" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Badminton profile view" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-profile-view-300x127.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-profile-view.png" decoding="async" loading="lazy" class="size-full wp-image-75363 aligncenter" src="../Images/d092a8996808103f42ccb1f282399d09.png" alt="Badminton Profile View" srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-profile-view.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-profile-view-300x127.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-profile-view.png"/></noscript>
<p>我们可以使用 XPath 以多种方式定位这个按钮。我将在这里演示其中的两个，向您展示 XPath 的强大功能。第一个是:</p>
<pre class="language-python hljs">calendar_btn = browser.find_element_by_xpath("//td[@id='idNavigation']//li[2]/a")
</pre>
<ul>
<li><code>//td[@id='idNavigation']</code>返回 id 为<code>idNavigation</code>的<code>td</code>标签</li>
<li><code>//li[2]</code>选择嵌套在<code>td</code>标签下的第二个<code>li</code>(在 XPath 中从 1 开始计数)</li>
<li><code>/a</code>选择<code>li</code>的直接<code>a</code>子节点</li>
</ul>
<p>第二种方法是:</p>
<pre class="language-python hljs">calendar_btn = browser.find_element_by_xpath("//a[text()='Calendar']")
</pre>
<p>这将选择包含文本<code>Calendar</code>的 HTML 文档中的<code>a</code>标签。</p>
<p>您可以使用您喜欢的任何一个，并添加单击按钮的后续代码:</p>
<pre class="language-python hljs">calendar_btn.click()
</pre>
<p>这将把我们带到日历页面。</p>
<p><img data-attachment-id="75366" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/badminton-calendar-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-calendar-page.png" data-orig-size="730,454" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Badminton calendar page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-calendar-page-300x187.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-calendar-page.png" decoding="async" class="size-full wp-image-75366 aligncenter jetpack-lazy-image" src="../Images/4eb813ca6833931d0337fe7e731ce189.png" alt="Badminton Calendar Page" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-calendar-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-calendar-page-300x187.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-calendar-page.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-calendar-page.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="75366" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/badminton-calendar-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-calendar-page.png" data-orig-size="730,454" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Badminton calendar page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-calendar-page-300x187.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-calendar-page.png" decoding="async" loading="lazy" class="size-full wp-image-75366 aligncenter" src="../Images/4eb813ca6833931d0337fe7e731ce189.png" alt="Badminton Calendar Page" srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-calendar-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-calendar-page-300x187.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/badminton-calendar-page.png"/></noscript>
<p>这只显示了一个日期，但是我们想要导航到我们想要的任何日期。还有两种方法可以做到这一点。我们可以单击日期旁边的箭头图标，也可以找出日期的 URL 模式，然后自己重新创建。只是为了一点挑战，我会选择后者。</p>
<p>继续，复制当前的网址，导航到不同的日期，比较两个网址，看看有什么变化。</p>
<p><img data-attachment-id="75372" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/compare-urls-badminton-scheduler/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/compare-urls-badminton-scheduler.png" data-orig-size="730,433" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Compare the URLS for the badminton calendar" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/compare-urls-badminton-scheduler-300x178.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/compare-urls-badminton-scheduler.png" decoding="async" class="size-full wp-image-75372 aligncenter jetpack-lazy-image" src="../Images/a1558da101800b0dc5e84e87614102b1.png" alt="Compare the URLs for the Badminton Calendar" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/compare-urls-badminton-scheduler.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/compare-urls-badminton-scheduler-300x178.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/11/compare-urls-badminton-scheduler.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/compare-urls-badminton-scheduler.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="75372" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/compare-urls-badminton-scheduler/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/compare-urls-badminton-scheduler.png" data-orig-size="730,433" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Compare the URLS for the badminton calendar" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/compare-urls-badminton-scheduler-300x178.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/compare-urls-badminton-scheduler.png" decoding="async" loading="lazy" class="size-full wp-image-75372 aligncenter" src="../Images/a1558da101800b0dc5e84e87614102b1.png" alt="Compare the URLs for the Badminton Calendar" srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/compare-urls-badminton-scheduler.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/compare-urls-badminton-scheduler-300x178.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/compare-urls-badminton-scheduler.png"/></noscript>
<p>最初的 URL 是:</p>
<pre class="language-python hljs">https://northwestbadmintonacademy.sites.zenplanner.com/calendar.cfm?calendarType=PERSON:6C482159-B1D5-47E0-8427-CCCF2EC1DAC9
</pre>
<p>新的 URL 是:</p>
<pre class="language-python hljs">https://northwestbadmintonacademy.sites.zenplanner.com/calendar.cfm?DATE=2021-10-25&amp;calendarType=PERSON:6C482159-B1D5-47E0-8427-CCCF2EC1DAC9&amp;VIEW=LIST&amp;PERSONID=6C482159-B1D5-47E0-8427-CCCF2EC1DAC9
</pre>
<p>看起来 URL 有两个动态部分。第一个是日期，第二个是一个<code>PERSON</code>标识符。我想知道我们是否可以从 HTML 文档中获得<code>PERSON</code>标识符。标识符也是初始 URL 的一部分，所以看起来日历按钮已经有了它。我们可以很容易地提取标识符:</p>
<pre class="language-python hljs">user_id = calendar_btn.get_attribute('href').split('=')[-1].split(':')[-1]
</pre>
<p>我们已经找到了日历按钮。我们只需要那个标签的 HREF 属性，Selenium 使得从标签中提取属性变得非常容易。</p>
<p>我们不需要整个 HREF，所以我们在<code>=</code>分了它:</p>
<pre class="language-python hljs">['https://northwestbadmintonacademy.sites.zenplanner.com/calendar.cfm?calendarType', 'PERSON:6C482159-B1D5-47E0-8427-CCCF2EC1DAC9']
</pre>
<p>然后我们取后一半，在<code>:</code>处分割，并从返回列表中取最后一个元素:</p>
<pre class="language-python hljs">['PERSON', '6C482159-B1D5-47E0-8427-CCCF2EC1DAC9']
</pre>
<p>现在，我们可以自己重新创建具体的日期 URL:</p>
<pre class="language-python hljs">query_date = "2021-10-24"
calendar_date_link = f"https://northwestbadmintonacademy.sites.zenplanner.com/calendar.cfm?DATE={query_date}&amp;calendarType=PERSON:{user_id}&amp;VIEW=LIST&amp;PERSONID={user_id}"
</pre>
<p>现在，让我们创建一个单独的方法来返回接下来的 7 个日期:</p>
<pre class="language-python hljs">import datetime

def next_7_dates():
    today = datetime.datetime.today()
    date_list = []
    for x in range(0,7):
        new_date = today + datetime.timedelta(days=x)
        date_list.append(new_date.strftime('%Y-%m-%d'))
    return date_list
</pre>
<p>我们使用<code><a href="https://docs.python.org/3/library/datetime.html" target="_blank" rel="noopener">datetime</a></code>库获取今天的日期，然后使用<code>timedelta</code>向其中添加更多的天数，最后使用<code>strftime</code>从其中提取年(<code>%Y</code>)、月(<code>%m</code>)和日(<code>%d</code>)。</p>
<p>现在让我们来看看日历本身。我们可以点击任何有几个空位的绿色日期，然后进入最终预订页面:</p>
<p><img data-attachment-id="75379" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/choose-green-date-badminton/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/choose-green-date-badminton.png" data-orig-size="730,457" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Choose green date badminton" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/choose-green-date-badminton-300x188.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/choose-green-date-badminton.png" decoding="async" class="size-full wp-image-75379 aligncenter jetpack-lazy-image" src="../Images/2ef8df32b64e3850e2369510a92c2bd1.png" alt="Choose Green Date Badminton" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/choose-green-date-badminton.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/choose-green-date-badminton-300x188.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/11/choose-green-date-badminton.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/choose-green-date-badminton.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="75379" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/choose-green-date-badminton/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/choose-green-date-badminton.png" data-orig-size="730,457" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Choose green date badminton" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/choose-green-date-badminton-300x188.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/choose-green-date-badminton.png" decoding="async" loading="lazy" class="size-full wp-image-75379 aligncenter" src="../Images/2ef8df32b64e3850e2369510a92c2bd1.png" alt="Choose Green Date Badminton" srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/choose-green-date-badminton.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/choose-green-date-badminton-300x188.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/choose-green-date-badminton.png"/></noscript>
<p>我通常更喜欢在下午 6 点玩，所以我们可以添加一些逻辑，让我们的自动化机器人查看可用时间，并计算出我们最喜欢的时间是否可用。如果不可用，它将转到下一页。这很容易编码:</p>
<pre class="language-python hljs">booking_link = browser.find_element_by_xpath("//div[text()='6:00 PM']")
full = 'sessionFull' in booking_link.get_attribute('class')
if not full:
    booking_link.click()
</pre>
<p>我们正在利用我们已经学过的积木。我们定位到将我们需要的时间作为<code>text</code>的<code>div</code>标签。然后我们通过<code>div</code>标签上的<code>sessionFull</code>类检查是否有可用的插槽。如果时间段没有满，我们点击预订链接。</p>
<h2><strong>最终预订自动化</strong></h2>
<p>单击其中一个时间段链接后，我们现在应该会被重定向到最终的预订页面。在这里，我们只需点击<code>Reserve</code>按钮，然后确认我们已预订。</p>
<p><img data-attachment-id="75381" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/automating-final-booking-python/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/automating-final-booking-python.png" data-orig-size="730,418" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Automating the final booking" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/automating-final-booking-python-300x172.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/automating-final-booking-python.png" decoding="async" class="size-full wp-image-75381 aligncenter jetpack-lazy-image" src="../Images/e91b2926d48ec55bb3cf2f7dbc905d93.png" alt="Automating the Final Booking" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/automating-final-booking-python.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/automating-final-booking-python-300x172.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/11/automating-final-booking-python.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/automating-final-booking-python.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="75381" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/automating-final-booking-python/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/automating-final-booking-python.png" data-orig-size="730,418" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Automating the final booking" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/automating-final-booking-python-300x172.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/automating-final-booking-python.png" decoding="async" loading="lazy" class="size-full wp-image-75381 aligncenter" src="../Images/e91b2926d48ec55bb3cf2f7dbc905d93.png" alt="Automating the Final Booking" srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/automating-final-booking-python.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/automating-final-booking-python-300x172.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/automating-final-booking-python.png"/></noscript>
<p>我们可以使用以下代码点击<code>Reservation</code>按钮:</p>
<pre class="language-python hljs">browser.find_element_by_xpath("//a[text()='Reserve']").click()
</pre>
<p>之后，页面应该会刷新，您应该会看到以下确认屏幕:</p>
<p><img data-attachment-id="75384" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/reservation-button-badminton-scheduler/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/reservation-button-badminton-scheduler.png" data-orig-size="730,406" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Reservation button" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/reservation-button-badminton-scheduler-300x167.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/reservation-button-badminton-scheduler.png" decoding="async" class="size-full wp-image-75384 aligncenter jetpack-lazy-image" src="../Images/ca6efbcd7e90a9faa19271ab2e00484b.png" alt="Reservation Button" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/reservation-button-badminton-scheduler.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/reservation-button-badminton-scheduler-300x167.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/11/reservation-button-badminton-scheduler.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/reservation-button-badminton-scheduler.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="75384" data-permalink="https://blog.logrocket.com/web-automation-selenium-python/reservation-button-badminton-scheduler/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/11/reservation-button-badminton-scheduler.png" data-orig-size="730,406" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Reservation button" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/11/reservation-button-badminton-scheduler-300x167.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/11/reservation-button-badminton-scheduler.png" decoding="async" loading="lazy" class="size-full wp-image-75384 aligncenter" src="../Images/ca6efbcd7e90a9faa19271ab2e00484b.png" alt="Reservation Button" srcset="https://blog.logrocket.com/wp-content/uploads/2021/11/reservation-button-badminton-scheduler.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/11/reservation-button-badminton-scheduler-300x167.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/11/reservation-button-badminton-scheduler.png"/></noscript>
<p>我们可以检查<code>Reserved</code> div 的存在，以确认我们的预订顺利通过:</p>
<pre class="language-python hljs">reserved = "Reserved" in browser.find_element_by_xpath("//div[@class='bold green']").text
</pre>
<p>现在我们有了所有需要的部分，我们只需要把它们放到我们的<code>app.py</code>文件中，并给它们一些结构。</p>
<h2><strong>最终代码</strong></h2>
<p>最终的代码看起来像这样:</p>
<pre class="language-python hljs">import datetime
from selenium import webdriver
from selenium.webdriver.support import expected_conditions
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.common.by import By

def next_7_dates():
    today = datetime.datetime.today()
    date_list = []
    for x in range(0,7):
        new_date = today + datetime.timedelta(days=x)
        date_list.append(new_date.strftime('%Y-%m-%d'))
    return date_list

def login(browser):
    print("[+] Logging in.")
    browser.find_element("name", "username").send_keys("your_email")
    browser.find_element("name", "password").send_keys("your_password")
    browser.find_element("xpath", "//input[@type='SUBMIT']").click()

def reserve_time(browser, favorite_times):
    for fav_time in favorite_times:
        booking_link = browser.find_element("xpath", f"//div[text()='{fav_time}']")
        full = 'sessionFull' in booking_link.get_attribute('class')
        if not full:
            booking_link.click()
        else:
            continue
        browser.find_element("xpath", "//a[text()='Reserve']").click()
        reserved = "Reserved" in browser.find_element("xpath", "//div[@class='bold green']").text
        if reserved:
            return True, fav_time
    return False, None

def main():
    browser = webdriver.Chrome(executable_path=r'/usr/local/bin/chromedriver')
    url = "https://northwestbadmintonacademy.sites.zenplanner.com/login.cfm"
    browser.get(url)

    login(browser)

    timeout_secs = 20
    calendar_btn = WebDriverWait(browser, timeout_secs)\
                        .until(expected_conditions.presence_of_element_located((By.XPATH, "//td[@id='idNavigation']//li[2]//a")))
    user_id = calendar_btn.get_attribute('href').split('=')[-1].split(':')[-1]
    calendar_btn.click()

    favorite_times = ["5:00 PM", "6:00 PM"]
    booked_details = []
    for count, date in enumerate(next_7_dates()):
        if len(booked_details) == 3 and count &lt;= 5:
            print(f"[+] Already booked 3 weekdays. Skipping {date}")
            continue
        print(f"[+] Trying to look for timeslots on {date}")
        calendar_date_link = (f"https://northwestbadmintonacademy.sites.zenplanner.com/calendar.cfm?"
            f"DATE={date}&amp;calendarType=PERSON:{user_id}&amp;VIEW=LIST&amp;PERSONID={user_id}")
        browser.get(calendar_date_link)
        reserved, reservation_time = reserve_time(browser, favorite_times)
        if reserved:
            booked_details.append((date, reservation_time))

    print("[+] I was able to successfully reserve the following date/times:")
    for date, reservation_time in booked_details:
        print(f"\t{date}: {reservation_time}")

if __name__ == "__main__":
    main()
</pre>
<p>代码分为四个功能，其中大部分都是不言自明的。</p>
<p>然而，这里有一些我们在上面没有讨论的东西。在运行最终的<code>app.py</code>时，我发现<code>find_element_by_*</code>方法已被弃用，我应该使用<code>find_element</code>方法。</p>
<p>此外，我在 HTML 中定位日历按钮时遇到了<code>StaleElementReferenceException</code>。<a href="https://stackoverflow.com/a/44914767" target="_blank" rel="noopener">这个 StackOverflow 的回答</a>对这个异常给出了非常好的解释，也给出了解决方案。发生的情况是，当浏览器仍在完成登录过程时，我们正在定位日历按钮，当我们试图访问日历按钮时，它就变得陈旧了。</p>
<p>为了克服这个问题，在登录过程已经开始之后，我们必须等待 calendar 元素出现在页面上。这样，Selenium 会等待进程完成，并确保日历按钮在我们尝试访问它之前不会变得陈旧。</p>
<p>这方面的代码是:</p>
<pre class="language-python hljs">from selenium.webdriver.support import expected_conditions
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.common.by import By

# ....

calendar_btn = WebDriverWait(browser, timeout_secs)\
                        .until(expected_conditions.presence_of_element_located((By.XPATH, "//td[@id='idNavigation']//li[2]//a")))
</pre>
<p>Selenium 一直等到预期的条件变为真，然后才继续执行其余的代码。</p>
<p>我们也可以通过添加一个显式的<code>time.sleep(10)</code>来解决这个问题，但是这样做的问题是元素可能会在十秒钟之前变得可用，但是在整个十秒钟过去之前我们将无法做任何事情。</p>
<p>至于代码流，我们从 main 方法开始执行。它会创建浏览器窗口并让我们登录。然后，它在接下来的七天中循环，每天它都试图预定我们最喜欢的时间。在预订了一天的一个时间段后，它会转移到第二天，并跳过当天任何其他可用的时间段。在进入第二天之前，它还验证了我们在进入下一个工作日之前没有预订超过三个工作日。最后，它打印它能够预订的插槽。</p>
<p>您可能需要更改这段代码中的两个细节。一个是用户名和密码值，另一个是<code>favorite_times</code>列表。</p>
<p>现在，只要预订开始，您就可以在周六早上运行这个脚本，您应该有希望能够抢到一些好的时间段。</p>
<h2><strong>结论</strong></h2>
<p>这是一个有趣的项目，探索了一些关于硒的知识，我希望你能从中学到一些新的东西。我喜欢给人们留下一些关于如何进一步开发辅导项目的提示。有很多方法可以改善这一点，我想到的一些方法是:</p>
<ol>
<li>让 Chrome 以无头模式运行，这样屏幕上就不会打开任何窗口</li>
<li>让它在周六自动运行，这样你甚至不用醒来(查看 crontab 或<a href="https://yasoob.me/posts/github-actions-web-scraper-schedule-tutorial/" target="_blank" rel="noopener">预定的 GitHub 动作</a></li>
<li>添加更好的错误处理，可能会产生多个 Selenium 进程，这样就可以并行检查多天</li>
</ol>
<p>可能性是无限的！我希望你喜欢这个教程。你可以从 GitHub 下载机器人<a href="https://github.com/yasoob/nwba-booking-bot" target="_blank" rel="noopener">的完整源代码。如果你喜欢这篇文章，你可以在</a><a href="https://yasoob.me" target="_blank" rel="noopener">我的博客</a>上读到类似有趣的内容。回头见！</p>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>