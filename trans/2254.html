<html>
<head>
<title>How to integrate a Braintree payment system in React - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在 React - LogRocket 博客中集成 Braintree 支付系统</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/integrate-braintree-payment-system-react/#0001-01-01">https://blog.logrocket.com/integrate-braintree-payment-system-react/#0001-01-01</a></blockquote><div><article class="article-post">
<p>通过网站支付购买服务或产品已经变得越来越普遍。因此，能够实现这一特性比以往任何时候都更加重要。令人欣慰的是，已经发布了几个支付平台来帮助开发者，所以你可以避免与支付相关的最常见问题的斗争。</p>
<p>Braintree 就是这样一个平台，它承诺让任何应用或网站都可以轻松接受支付。特别是，他们的 API、库和工具可以用来毫不费力地实现支付系统。</p>
<p>在本文中，您将了解如何通过使用官方的 Braintree JavaScript 客户端 SDK 将 Braintree 集成到 React 应用程序中。按照本教程学习如何实现以下结果:</p>
<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light">

<p>没有描述</p>
</blockquote>
<p/>
<h2>先决条件</h2>
<p>这是您将要构建的演示应用程序的所有先决条件的列表:</p>

<h2>布伦特里 JavaScript SDK</h2>
<p><a href="https://developer.paypal.com/braintree/docs/guides/client-sdk/setup/javascript/v3" target="_blank" rel="noopener">如官方文档</a>所述，Braintree JavaScript SDK 允许您轻松接受支付，同时保持 PCI(支付卡行业)合规性。换句话说，他们的 SDK 可以让您实现一个完整的支付系统，同时按照信用卡公司的要求自动确保信用卡交易和数据的安全性。</p>
<p>Braintree JavaScript client SDK 支持信用卡、PayPal、数字钱包和其他几种支付方式。您可以<a href="https://www.braintreepayments.com/it/features/payment-methods" target="_blank" rel="noopener">在此</a>找到支持的付款方式的完整列表。每种支付方式都可以轻松配置和集成。</p>
<p>要安装 Braintree JavaScript SDK，请启动以下 npm 命令:</p>
<pre class="language-bash hljs">npm install --save braintree-web
</pre>
<p>这样，<code><a href="https://www.npmjs.com/package/braintree-web" target="_blank" rel="noopener">braintree-web</a></code> npm 库将被添加到项目的依赖项中。如果你不是 npm 用户，你可以<a href="https://www.npmjs.com/package/braintree-web" target="_blank" rel="noopener">在这里</a>找到所有其他支持的安装 SDK 的方法。</p>
<p>安装好之后，你得学会如何使用它。具体来说，你需要知道的是，Braintree 有两种不同的集成:托管字段和插件。第一个提供了实现定制 UI 所需的所有工具，而第二个提供了一个带有优雅 UI 的现成的、预格式化的支付表单，它代表了推荐的方法。</p>
<p>在这两种情况下，您都需要从 Braintree 检索授权令牌。如何实现这一点将在本教程的后面讨论。Braintree 需要这些信息来授权您的前端应用程序。</p>
<p>然后，在完成输入支付所需数据的程序后，<a href="https://developer.paypal.com/braintree/docs/guides/payment-method-nonces" target="_blank" rel="noopener">将生成一个布伦特里支付方法随机数</a>。这表示引用支付信息的安全且一次性使用的随机数。这样的随机数应该被发送到您的服务器，并通过利用<a href="https://developer.paypal.com/braintree/docs/start/hello-server/node" target="_blank" rel="noopener"> Braintree 服务器 SDK </a>来执行实际支付。</p>
<p>换句话说，由 Braintree 前端 UI 生成的支付方式 nonce 允许您的服务器将敏感支付信息传递给 Braintree 服务器，并在不暴露敏感数据的情况下执行操作。</p>
<p>您可以在下面看到 Braintree 付款流程的简化图。另外，你可以从官方文档中阅读<a href="https://developer.paypal.com/braintree/docs/start/overview#how-it-works" target="_blank" rel="noopener">这篇文章，了解更多关于 Braintree 如何工作的信息</a>。</p>
<figure id="attachment_71814" aria-describedby="caption-attachment-71814" class="wp-caption aligncenter"><img data-attachment-id="71814" data-permalink="https://blog.logrocket.com/integrate-braintree-payment-system-react/braintree-payment-flow/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-payment-flow-e1634148135528.png" data-orig-size="730,478" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Braintree payment flow" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-payment-flow-300x196.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-payment-flow-e1634148135528.png" decoding="async" class="wp-image-71814 size-full jetpack-lazy-image" src="../Images/a61739d18770773a1799d9e212de32f5.png" alt="Braintree Payment Flow" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-payment-flow-e1634148135528.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-payment-flow-e1634148135528.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="71814" data-permalink="https://blog.logrocket.com/integrate-braintree-payment-system-react/braintree-payment-flow/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-payment-flow-e1634148135528.png" data-orig-size="730,478" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Braintree payment flow" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-payment-flow-300x196.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-payment-flow-e1634148135528.png" decoding="async" loading="lazy" class="wp-image-71814 size-full" src="../Images/a61739d18770773a1799d9e212de32f5.png" alt="Braintree Payment Flow" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-payment-flow-e1634148135528.png"/></noscript><figcaption id="caption-attachment-71814" class="wp-caption-text"><a href="https://developer.paypal.com/braintree/docs/start/overview#how-it-works">The Braintree payment flow</a></figcaption></figure>
<p>现在，让我们深入研究 Braintree 提供的两种前端方法。</p>
<h2>托管字段</h2>
<p>布伦特里托管字段方法允许商户处理 SAQ A(自我评估问卷 A)资格，同时控制其支付表单的样式和布局。</p>
<p>具体来说，托管字段解决方案自动呈现包含以下支付字段的 iframe:卡号、CVV、截止日期和邮政编码。这是因为为了满足 PCI 遵从的基本级别，您必须在外部支付网关的域上托管信息，并在 iframe 或重定向中向您的用户呈现这五个字段。</p>
<p>因此，这种方法允许您完全定制您的支付形式，同时确保您符合 PCI 要求。同时，托管字段涉及自定义逻辑。如果你想实现其他支付方式，比如 PayPal，这一点尤其正确。这就是为什么这种解决方案不是最广泛使用的，只有在需要完全控制逻辑和风格时才应该考虑。</p>
<p>您可以<a href="https://developer.paypal.com/braintree/docs/guides/hosted-fields/examples/javascript/v3" target="_blank" rel="noopener">在这里</a>找到一些自定义托管字段集成的例子。</p>
<h2>顺便拜访</h2>
<p>Braintree Drop-in UI 是一个完整的、现成的支付 UI，提供了一种安全接受支付的简单方法。默认情况下，该界面包括一个卡输入表单，要求输入信用卡号、持卡人姓名、到期日期、邮政编码和 CVV。</p>
<p>另外，您可以通过特殊配置启用 PayPal、Apple Pay、Google Pay 和 Venmo 按钮。点击<a href="https://developer.paypal.com/braintree/docs/guides/drop-in/overview#demo" target="_blank" rel="noopener">这个链接，看看默认的 Braintree 插件 UI 是什么样子的</a>。</p>
<p>要使用它，您需要启动以下 npm 命令，将所需的依赖项添加到您的项目中:</p>
<pre class="language-bash hljs">npm install --save braintree-web-drop-in
</pre>
<p>这样，<code>braintree-web-drop-in</code>将被安装。这个预制的支付 UI 是使用前面提到的 Braintree JS 客户端 SDK 构建的。因此，<code>braintree-web-drop-in</code>依赖于<code>braintree-web</code>。因此，通过将<code>braintree-web-drop-in</code>添加到您的依赖项中，将会自动安装<code>braintree-web</code>库。因此，当使用<code>braintree-web-drop-in</code>库时，您可以在项目的依赖项中省略<code>braintree-web</code>。</p>
<p>正如官方文档中所述，在使用 Braintree 时，Braintree Drop-in 是开始接受付款的最快和推荐的方法。这是因为默认插件 UI 使您符合 SAQ PCI 标准，本机支持 23 种语言(并允许您集成自己的语言)，支持<a href="https://developer.paypal.com/braintree/docs/guides/3d-secure/overview" target="_blank" rel="noopener"> 3D Secure 2 验证</a>，并允许用户删除已保存的支付方式。所有这些都在一个现成的解决方案中，只需要实现一堆代码。</p>
<h2>托管字段与插件</h2>
<p>在这里，您可以看到上面介绍的两种方法之间的主要区别的概述。</p>
<h3>托管字段</h3>
<ul>
<li>它符合 SAQ 的 PCI 标准</li>
<li>它允许您创建一个自定义样式和布局的付款表单</li>
<li>它允许您完全自定义您的结帐行为</li>
<li>它需要您手动集成<a href="https://developer.paypal.com/braintree/docs/guides/paypal/checkout-with-paypal/javascript/v3" target="_blank" rel="noopener"> PayPal 结帐组件</a>来接受 PayPal</li>
</ul>
<h3>顺便拜访</h3>
<ul>
<li>它符合 SAQ 的 PCI 标准</li>
<li>它允许您快速轻松地集成 Braintree</li>
<li>它支持 23 种语言</li>
<li>它原生支持 PayPal、Apple Pay、Google Pay 和 Venmo 按钮</li>
<li>您可以通过覆盖它的 CSS 规则来自定义它，但是不能完全控制它</li>
</ul>
<h2>在 React 中使用 braintree 插件</h2>
<p>您可以克隆支持本文的<a href="https://github.com/Tonel/react-braintree-drop-in-demo" target="_blank" rel="noopener"> GitHub 存储库，并通过启动以下命令来尝试演示应用程序:</a></p>
<pre class="language-bash hljs">git clone https://github.com/Tonel/react-braintree-drop-in-demo.git
cd react-braintree-drop-in-demo
npm i
npm start
</pre>
<p>否则，您可以继续遵循这个循序渐进的教程。</p>
<h3>初始化 React 项目</h3>
<p>你可以通过使用<a href="https://blog.logrocket.com/getting-started-with-create-react-app-d93147444a27/" target="_blank" rel="noopener"> Create React App </a>轻松初始化一个 React 项目。这是官方支持的创建单页面 React 应用程序的方法。特别是，您可以使用以下命令创建一个名为<code>react-braintree-drop-in-demo</code>的新项目:</p>
<pre class="language-bash hljs">npx create-react-app react-braintree-drop-in-demo</pre>
<p>现在，您将能够探索位于具有以下文件结构的<code>react-brantree-drop-in-demo</code>文件夹中的演示项目:</p>
<pre>react-braintree-drop-in-demo
├── README.md
├── node_modules
├── package.json
├── .gitignore
├── public
│   ├── favicon.ico
│   ├── index.html
│   ├── logo192.png
│   ├── logo512.png
│   ├── manifest.json
│   └── robots.txt
└── src
    ├── App.css
    ├── App.js
    ├── App.test.js
    ├── index.css
    ├── index.js
    ├── logo.svg
    ├── reportWebVitals.js
    └── setupTests.js
</pre>
<p>然后，进入<code>react-brantree-drop-in-demo</code>文件夹并启动本地服务器，通过运行以下命令检查一切是否正常:</p>
<pre class="language-bash hljs">cd react-braintree-drop-in-demo
npm start
</pre>
<p>在浏览器中打开<a href="http://localhost:3000/" rel="nofollow"> http://localhost:3000/ </a>页面，您现在应该会看到默认的 Create React App 屏幕，如下所示:</p>
<p><img data-attachment-id="71816" data-permalink="https://blog.logrocket.com/integrate-braintree-payment-system-react/create-react-app-localhost-braintree/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/create-react-app-localhost-braintree-e1634148223173.png" data-orig-size="730,541" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Create React App Localhost" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/create-react-app-localhost-braintree-300x222.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/create-react-app-localhost-braintree-e1634148223173.png" decoding="async" class="aligncenter wp-image-71816 size-full jetpack-lazy-image" src="../Images/8ad915bb910531cff70b95dcae6997d2.png" alt="Create React App Localhost" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/create-react-app-localhost-braintree-e1634148223173.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/create-react-app-localhost-braintree-e1634148223173.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="71816" data-permalink="https://blog.logrocket.com/integrate-braintree-payment-system-react/create-react-app-localhost-braintree/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/create-react-app-localhost-braintree-e1634148223173.png" data-orig-size="730,541" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Create React App Localhost" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/create-react-app-localhost-braintree-300x222.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/create-react-app-localhost-braintree-e1634148223173.png" decoding="async" loading="lazy" class="aligncenter wp-image-71816 size-full" src="../Images/8ad915bb910531cff70b95dcae6997d2.png" alt="Create React App Localhost" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/create-react-app-localhost-braintree-e1634148223173.png"/></noscript>
<h3>设置布伦特里</h3>
<p>正如官方文档中所解释的，有两种不同的方法让 Braintree 授权你的前端应用程序。</p>
<p>第一个涉及到一个<a href="https://developer.paypal.com/braintree/docs/guides/authorization/client-token" target="_blank" rel="noopener">客户端令牌</a>，它必须由您的服务器使用 Braintree server SDK 生成。这使您可以访问所有的 Braintree 客户端 API 功能。</p>
<p>第二个是<a href="https://developer.paypal.com/braintree/docs/guides/authorization/tokenization-key/javascript/v3" target="_blank" rel="noopener">令牌化密钥</a>，这是一个静态密钥，只授权有限的 Braintree 客户端 API 特性子集。为了简单起见，将使用一个令牌化密钥来授权 Braintree 插件。</p>
<p>您可以按照以下步骤在 Braintree 控制面板中检索有效的令牌化密钥:</p>
<ol>
<li>如果您已经订阅，请登录<a href="https://sandbox.braintreegateway.com/login" target="_blank" rel="noopener"> Braintree 沙盒控制面板</a>。否则，注册然后登录</li>
<li>
<p>点击右上角的齿轮图标</p>
</li>
<li>
<p>从下拉菜单中选择 API 选项</p>
</li>
</ol>
<p><img data-attachment-id="71812" data-permalink="https://blog.logrocket.com/integrate-braintree-payment-system-react/braintree-control-panel-api/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-control-panel-api.png" data-orig-size="268,307" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Braintree control panel API" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-control-panel-api-262x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-control-panel-api.png" decoding="async" class="size-full wp-image-71812 aligncenter jetpack-lazy-image" src="../Images/6585be2e83f64834cf38767f7baf18f0.png" alt="Braintree Control Panel API" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-control-panel-api.png 268w, https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-control-panel-api-262x300.png 262w" data-lazy-sizes="(max-width: 268px) 100vw, 268px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-control-panel-api.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-control-panel-api.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="71812" data-permalink="https://blog.logrocket.com/integrate-braintree-payment-system-react/braintree-control-panel-api/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-control-panel-api.png" data-orig-size="268,307" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Braintree control panel API" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-control-panel-api-262x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-control-panel-api.png" decoding="async" loading="lazy" class="size-full wp-image-71812 aligncenter" src="../Images/6585be2e83f64834cf38767f7baf18f0.png" alt="Braintree Control Panel API" srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-control-panel-api.png 268w, https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-control-panel-api-262x300.png 262w" sizes="(max-width: 268px) 100vw, 268px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/braintree-control-panel-api.png"/></noscript>
<ol>
<li>向下滚动到“令牌化密钥”部分，并检索您的密钥。如果看不到任何密钥，请单击“生成新的令牌化密钥”按钮来生成新的密钥<br/> <img data-attachment-id="71818" data-permalink="https://blog.logrocket.com/integrate-braintree-payment-system-react/generate-tokenization-key-braintree/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/generate-tokenization-key-braintree.png" data-orig-size="730,112" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Generate tokenization key Braintree" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/generate-tokenization-key-braintree-300x46.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/generate-tokenization-key-braintree.png" decoding="async" class="size-full wp-image-71818 aligncenter jetpack-lazy-image" src="../Images/9b3f589aa39f0cbbfa8870c49bae223c.png" alt="Generate Tokenization Key Braintree" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/generate-tokenization-key-braintree.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/10/generate-tokenization-key-braintree-300x46.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/generate-tokenization-key-braintree.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/generate-tokenization-key-braintree.png"/> <noscript> <img data-lazy-fallback="1" data-attachment-id="71818" data-permalink="https://blog.logrocket.com/integrate-braintree-payment-system-react/generate-tokenization-key-braintree/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/generate-tokenization-key-braintree.png" data-orig-size="730,112" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Generate tokenization key Braintree" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/generate-tokenization-key-braintree-300x46.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/generate-tokenization-key-braintree.png" decoding="async" loading="lazy" class="size-full wp-image-71818 aligncenter" src="../Images/9b3f589aa39f0cbbfa8870c49bae223c.png" alt="Generate Tokenization Key Braintree" srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/generate-tokenization-key-braintree.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/10/generate-tokenization-key-braintree-300x46.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/generate-tokenization-key-braintree.png"/> </noscript></li>
<li>
<p>将您的 Braintree 令牌化密钥存储在安全的地方</p>
</li>
</ol>
<p>您现在可以开始使用<code>braintree-drop-in</code>。让我们看看怎么做。</p>
<h2>布伦特里-投入行动</h2>
<p>首先，启动以下命令来安装<code>braintree-web-drop-in</code>库:</p>
<pre class="language-bash">npm install --save braintree-web-drop-in</pre>
<p>然后，您可以通过如下方式实现一个<code>BraintreeDropIn</code>组件来开始使用它:</p>
<pre>import React, {useEffect, useState} from 'react'
import './index.css';
import dropin from "braintree-web-drop-in"
import {Button} from "reactstrap";

export default function BraintreeDropIn(props) {
    const { show, onPaymentCompleted } = props;

    const [braintreeInstance, setBraintreeInstance] = useState(undefined)

    useEffect(() =&gt; {
        if (show) {
            const initializeBraintree = () =&gt; dropin.create({
                // insert your tokenization key or client token here
                authorization: "sandbox_s9gd7m2p_vp62s592633kc5p5", 
                container: '#braintree-drop-in-div',
            }, function (error, instance) {
                if (error)
                    console.error(error)
                else
                    setBraintreeInstance(instance);
            });

            if (braintreeInstance) {
                braintreeInstance
                    .teardown()
                    .then(() =&gt; {
                        initializeBraintree();
                    });
            } else {
                initializeBraintree();
            }
        }
    }, [show])

    return (
        &lt;div
            style={{display: `${show ? "block" : "none"}`}}
        &gt;
            &lt;div
                id={"braintree-drop-in-div"}
            /&gt;

            &lt;Button
                className={"braintreePayButton"}
                type="primary"
                disabled={!braintreeInstance}
                onClick={() =&gt; {
                    if (braintreeInstance) {
                        braintreeInstance.requestPaymentMethod(
                            (error, payload) =&gt; {
                                if (error) {
                                    console.error(error);
                                } else {
                                    const paymentMethodNonce = payload.nonce;
                                    console.log("payment method nonce", payload.nonce);

                                    // TODO: use the paymentMethodNonce to
                                    //  call you server and complete the payment here

                                    // ...

                                    alert(`Payment completed with nonce=${paymentMethodNonce}`);

                                    onPaymentCompleted();
                                }
                            });
                    }
                }}
            &gt;
                {
                    "Pay"
                }
            &lt;/Button&gt;
        &lt;/div&gt;
    )
}
</pre>
<p>如您所见，通过使用来自从<code>braintree-web-drop-in</code>导入的<code>dropin</code>变量的<code>create()</code>函数，创建了布伦特里插件。该函数需要一个包含您的令牌化密钥或有效客户端令牌的<code>authorization</code>字段，以及一个指向安装 Braintree UI 的<code>&lt;div&gt;</code>的 HTML 标识符的<code>container</code>。类似地，它接受许多其他可用于启用 3D 安全模块、PayPal 和其他选项和支付方法的字段。在这里你可以<a href="https://braintree.github.io/braintree-web-drop-in/docs/current/module-braintree-web-drop-in.html#.create" target="_blank" rel="noopener">找到<code>create()</code>函数支持的所有参数。</a></p>
<p><code>create</code>函数立即返回一个承诺，随后返回一个错误消息或一个有效的 Braintree 插件实例。这可用于检索 Braintree 完成支付服务器端所需的支付<code>nonce</code>。具体来说，它是通过点击“支付”按钮并调用<code>requestPaymentMethod()</code>函数生成的。</p>
<p>同样，<code>requestPaymentMethod()</code>函数会立即返回一个承诺，稍后会返回一个错误消息或一个包含所需支付方式<code>nonce</code>的<code>payload</code>对象。如前所述，这是 Braintree server SDK 在不暴露任何个人数据的情况下执行支付服务器端所期望和要求的。</p>
<p>然后，您需要调用您的定制 API，利用 Braintree server SDK 和 payment nonce 方法来执行支付。由于这是一个只有前端教程，这一部分被省略。</p>
<p>成功完成支付后，<code>show</code>道具会被<code>onPaymentCompleted()</code>功能设置为<code>false</code>，<code>BraintreeDropIn</code>组件消失。另外，下一次显示<code>BraintreeDropIn</code>组件时，将再次执行上述的布伦特里插件实例初始化过程。但是在这种情况下，已经有一个有效的<code>braintreeInstance</code>包含前一个用户输入的数据。因此，<code>create()</code>函数将返回相同的<code>braintreeInstance</code>。</p><div class="code-block code-block-54">
<hr/>
<h3>更多来自 LogRocket 的精彩文章:</h3>

<hr/></div>
<p>这是一个问题，因为 Braintree 可能会再次产生与之前相同的付款<code>nonce</code>。因此，这将导致 Braintree 服务器响应 409 冲突“网关被拒绝”错误。为了避免这种情况，您必须首先销毁<code>braintreeInstance</code>，然后再次初始化它。</p>
<p>这就是为什么当<code>braintreeInstance</code>不是<code>undefined</code>时，在调用<code>create()</code>函数之前先调用<code>teardown()</code>函数。可以想象，这样的问题只发生在单页应用程序中，在这种应用程序中，当更改页面时，资源不会被隐式破坏。</p>
<p>瞧啊！现在，您已经具备了开始使用 Braintree 插件 UI 所需的一切。</p>
<h3>把所有的放在一起</h3>
<p>让我们通过在 React 中模拟一个结帐页面来看看<code>BraintreeDropIn</code>组件的运行情况:</p>
<pre>import './App.css';
import 'bootstrap/dist/css/bootstrap.min.css';
import BraintreeDropIn from "./components/BraintreeDropIn";
import {Col, Container, Input, Row, Button} from "reactstrap";
import {useState} from "react";

export default function App() {
const [showBraintreeDropIn, setShowBraintreeDropIn] = useState(false);
const [numberOfProducts, setNumberOfProducts] = useState(1);
const PRICE = 50;

return (
    &lt;Container&gt;
        &lt;Col&gt;
            &lt;Row
                className={"productHeaderRow"}
            &gt;
                &lt;Col
                    xs={4}
                &gt;
                    {
                        "Product"
                    }
                &lt;/Col&gt;
                &lt;Col
                    xs={2}
                    className={"text-center"}
                &gt;
                    {
                        "Price"
                    }
                &lt;/Col&gt;
                &lt;Col
                    xs={2}
                    className={"text-center"}
                &gt;
                    {
                        "Quantity"
                    }
                &lt;/Col&gt;
                &lt;Col
                    xs={2}
                    className={"text-center"}
                &gt;
                    {
                        "Total"
                    }
                &lt;/Col&gt;
                &lt;Col
                    xs={2}
                /&gt;
            &lt;/Row&gt;
            &lt;Row
                className={"productInfoRow"}
            &gt;
                &lt;Col
                    xs={4}
                    className={"productInfoColumn"}
                &gt;
                    {
                        "Foo product"
                    }
                &lt;/Col&gt;
                &lt;Col
                    xs={2}
                    className={"productInfoColumnCenter"}
                &gt;
                    {
                        `$ ${PRICE}`
                    }
                &lt;/Col&gt;
                &lt;Col
                    xs={2}
                    className={"productInfoColumnCenter"}
                &gt;
                    &lt;Input
                        placeholder="0"
                        min={1}
                        max={100}
                        type="number"
                        step="1"
                        value={numberOfProducts}
                        onChange={((e) =&gt; {
                            setNumberOfProducts(e.target.value)
                        })}
                    /&gt;
                &lt;/Col&gt;
                &lt;Col
                    xs={2}
                    className={"productInfoColumnCenter"}
                &gt;
                    {
                        `$ ${numberOfProducts * PRICE}`
                    }
                &lt;/Col&gt;
                &lt;Col
                    xs={2}
                    className={"productInfoColumnCenter"}
                &gt;
                    &lt;Button
                        onClick={() =&gt; {setShowBraintreeDropIn(true)}}
                        disabled={showBraintreeDropIn}
                    &gt;
                        {
                            "Go to Checkout"
                        }
                    &lt;/Button&gt;
                &lt;/Col&gt;
            &lt;/Row&gt;
        &lt;/Col&gt;
        &lt;BraintreeDropIn
            show={showBraintreeDropIn}
            onPaymentCompleted={() =&gt; {
                setShowBraintreeDropIn(false);
                setNumberOfProducts(1);
            }}
        /&gt;
    &lt;/Container&gt;
);
}
</pre>
<p>这里实现的应用程序与您在本文开头看到的应用程序相同。点击“去结账”并按照说明使用<a href="https://developer.paypal.com/braintree/docs/guides/credit-cards/testing-go-live/php" target="_blank" rel="noopener">一个由布伦特里</a>接受的测试信用卡号码来测试布伦特里直接付款方式，例如:</p>
<ul>
<li>55555555554444(万事达卡)</li>
<li>41111111111111111(签证)</li>
<li>6304000000000000(大师)</li>
</ul>
<p>今天之后到 2030 年之前的任何有效截止日期都可以。</p>
<p>现在，您只需要学习如何让您的应用程序接受真实的支付。您唯一需要做的就是替换您在 Braintree 插件初始化期间放入<code>authorization</code>字段的令牌化密钥或客户端令牌。</p>
<p>不要使用来自沙盒平台的数据，而是通过在 Braintree 生产平台中检索有效数据来替换它。你现在可以收到真钱了。</p>
<h2>结论</h2>
<p>在本文中，我们了解了什么是 Braintree，以及如何使用它来接受支付前端。如图所示，Braintree 附带了一个 JavaScript 客户端 SDK，它提供了许多工具和特性来使这变得简单快捷。特别是，它提供了两种不同的可能集成:托管字段和插件。</p>
<p>第一个涉及自定义逻辑，应该只在特殊情况下使用。另一方面，第二个是一个现成的解决方案，允许您在几行代码中使用 Braintree 开始接受支付。</p>
<p>由于采用了后一种方法，实现这种日益增长的需求并不复杂。</p>
<p>感谢阅读！我希望这篇文章对你有所帮助。如果有任何问题、意见或建议，请随时联系我。</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用 LogRocket 消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款 React analytics 解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket 告诉您 React 应用程序中实际影响用户的最具影响力的 bug 和 UX 问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS 异常、前端性能指标和用户交互。然后，LogRocket 使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的 React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试 LogRocket】。</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>