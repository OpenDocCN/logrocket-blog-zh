<html>
<head>
<title>React Native geolocation: A complete tutorial - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>React Native geolocation:完整教程- LogRocket 博客</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/react-native-geolocation-complete-tutorial/#0001-01-01">https://blog.logrocket.com/react-native-geolocation-complete-tutorial/#0001-01-01</a></blockquote><div><article class="article-post">
<p><em> <strong>编者按</strong>:本文最后一次更新于 2022 年 9 月 21 日，以反映对 React Native CLI 所做的更改。</em></p>
<p>你可能想知道送餐和打车应用程序如何知道你在特定时间点的位置。答案是地理定位。</p>
<p>在本教程中，我们将学习如何在 React Native 中实现地理定位。我们将构建一个示例应用程序，它在地图上显示用户的位置和经度和纬度坐标，并使用户能够将他们的位置发送到另一个来源，如 Twitter。</p>
<p>我们将讨论以下内容:</p>

<p>你可以在<a href="https://github.com/AlexMercedCoder/react-native-geolocation"> GitHub </a>上获得该项目的完整源代码。我们开始吧！</p>
<h2 id="what-is-geolocation">什么是地理定位？</h2>
<p>地理定位是指<a href="https://blog.logrocket.com/what-you-need-know-while-using-geolocation-api/">检测连接到互联网的设备</a>的地理位置的能力。地理定位的一个简单例子是使用设备的 IP 地址来确定其所在的国家、城市或邮政编码。大多数时候，用户必须授予应用程序访问其位置数据的权限。</p>
<h2 id="geolocation-in-react-native">React Native 中的地理定位</h2>
<p>React Native 为地理定位提供了<a href="https://github.com/react-native-geolocation/react-native-geolocation"> <code>@react-native-community/geolocation</code> </a> API。然而，谷歌并不推荐使用 React Native API 进行地理定位，因为它不如推荐的<a href="https://developers.google.com/maps/documentation/geolocation/overview">谷歌位置服务 API </a>准确和缓慢。</p>
<p>谢天谢地，React Native 社区已经为 React Native 中实现地理定位开发了<a href="https://reactnative.directory/?search=geolocation">几个优秀的库</a>，包括<a href="https://www.npmjs.com/package/react-native-location"> <code>react-native-location</code> </a>和<code><a href="https://www.npmjs.com/package/react-native-geolocation-service">react-native-geolocation-service</a></code>。</p>
<p>在这个 React 本地地理定位教程中，我们将使用<code>react-native-geolocation-service</code>库，它可以作为节点包在<a href="https://www.npmjs.com/package/react-native-geolocation-service"> npm </a>上获得。</p>
<p>我们将构建一个应用程序来完成以下任务:</p>
<ul>
<li>请求允许访问您的 Android 和 iOS 设备上的位置数据</li>
<li>选择你的位置坐标</li>
<li>保存或发送您的位置坐标</li>
</ul>
<p>建议使用 Node.js ≥v10。要检查 Node.js 版本，请运行以下代码:</p>
<pre>$ node -v

// returns node version
</pre>
<p>您可以使用<code>nvm</code>来管理安装在您机器上的多个 Node.js 版本。React Native 有一个内置的命令行界面，可以用来生成一个新项目。您可以使用 Node.js 附带的 npx 来访问它，而无需全局安装任何东西。</p>
<h2 id="initialize-react-native-project">初始化 React 本机项目</h2>
<p>首先，在您的终端中运行以下命令:</p>
<pre class="language-bash hljs">$ npx react-native init ReactNativeGeolocation
</pre>
<p>npx 是一个基于节点的命令，您可以使用它在终端中运行基于节点的依赖项，而不必在您的机器上安装它们。</p>
<p>该命令的<code>init</code>部分是初始化一个新的 React 本地项目的指令，其中<code>ReactNativeLocation</code>作为项目文件的安装目录。</p>
<p><code>npx react-native</code>命令无需在您的机器上安装 React Native 即可工作。或者，您可以在您的计算机上全局安装 React Native，以便在不使用 npx 的情况下运行 React Native 命令。要全局安装 React Native，请运行以下命令:</p>
<pre class="language-bash hljs">$ npm install -g react-native-cli
</pre>
<p>然后，您可以使用以下命令检查 React Native 是否已安装:</p>
<pre>$ react-native -v
</pre>
<p>上面的命令将安装在您的机器上的 React 本地版本打印到控制台。打开你最喜欢的 IDE，进入<code>ReactNativeGeolocation</code>目录。我们运行来初始化项目的命令已经为我们设置了 React 本地应用程序。</p>
<p>我们将在<code>App.js</code>文件中编写我们所有的代码。确保您在应用程序的根目录下运行命令。</p>
<p>第一步，启动<a href="https://facebook.github.io/metro/docs/concepts/">地铁</a>。Metro 是 React Native 附带的 JavaScript bundler。Metro 接受一个条目文件和各种选项，然后返回一个包含所有代码及其依赖项的 JavaScript 文件:</p>
<pre class="language-bash hljs">$ npx react-native start
</pre>
<p>当 Metro 在您的终端中运行时，打开另一个终端并运行以下命令:</p>
<pre class="language-bash hljs">$ npx react-native run-android
</pre>
<p>要运行这个应用程序，你需要一个<a href="https://developer.android.com/studio/run/managing-avds"> Android 模拟器</a>或者一个在调试模式下连接到你电脑的移动设备。然而，如果你使用 Android Studio 的模拟器，你可能会遇到错误，原因如下:</p>
<ul>
<li>您需要定义一个指向 SDK 目录的<code>ANDROID_HOME</code> env 变量</li>
<li>您需要接受所有的<a href="https://developer.android.com/studio/intro/update"> SDK 许可证</a></li>
</ul>
<p>然后，您应该会看到以下屏幕:</p>
<p><img data-attachment-id="132225" data-permalink="https://blog.logrocket.com/react-native-new-app-screen-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-screen-1.png" data-orig-size="580,1033" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="react-native-new-app-screen" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-screen-1-168x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-screen-1-575x1024.png" decoding="async" class="aligncenter wp-image-132225 size-full jetpack-lazy-image" src="../Images/24b759eea7175e7b4f24f903bb013886.png" alt="React Native New App Screen" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-screen-1.png 580w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-screen-1-168x300.png 168w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-screen-1-575x1024.png 575w" data-lazy-sizes="(max-width: 580px) 100vw, 580px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-screen-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-screen-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="132225" data-permalink="https://blog.logrocket.com/react-native-new-app-screen-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-screen-1.png" data-orig-size="580,1033" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="react-native-new-app-screen" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-screen-1-168x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-screen-1-575x1024.png" decoding="async" loading="lazy" class="aligncenter wp-image-132225 size-full" src="../Images/24b759eea7175e7b4f24f903bb013886.png" alt="React Native New App Screen" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-screen-1.png 580w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-screen-1-168x300.png 168w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-screen-1-575x1024.png 575w" sizes="(max-width: 580px) 100vw, 580px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-screen-1.png"/></noscript>
<p>我们可以开始对我们的<code>App.js</code>文件夹中的应用程序进行更改。删除<code>App.js</code>中的所有旧代码，并替换为以下代码:</p>
<pre class="language-javascript hljs">/**
* Sample React Native App
* https://github.com/facebook/react-native
*
* @format
* @flow strict-local
*/

import React from 'react';
import {StyleSheet, View, Text} from 'react-native';

const App = () =&gt; {
 return (
   &lt;View style={styles.container}&gt;
     &lt;Text&gt;Welcome!&lt;/Text&gt;
   &lt;/View&gt;
 );
};

const styles = StyleSheet.create({
 container: {
   flex: 1,
   backgroundColor: '#fff',
   alignItems: 'center',
   justifyContent: 'center',
 },
});

export default App;
</pre>
<p>上面的代码给了我们一个新的屏幕，我们可以在这里继续编写我们的程序:</p>
<p><img data-attachment-id="132227" data-permalink="https://blog.logrocket.com/react-native-new-app-welcome-screen/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-welcome-screen.jpeg" data-orig-size="580,1154" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="react-native-new-app-welcome-screen" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-welcome-screen-151x300.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-welcome-screen-515x1024.jpeg" decoding="async" class="aligncenter wp-image-132227 size-full jetpack-lazy-image" src="../Images/f6c6e8905503f7e754fc7b93c2f7ff4e.png" alt="React Native New App Welcome Screen" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-welcome-screen.jpeg 580w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-welcome-screen-151x300.jpeg 151w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-welcome-screen-515x1024.jpeg 515w" data-lazy-sizes="(max-width: 580px) 100vw, 580px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-welcome-screen.jpeg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-welcome-screen.jpeg"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="132227" data-permalink="https://blog.logrocket.com/react-native-new-app-welcome-screen/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-welcome-screen.jpeg" data-orig-size="580,1154" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="react-native-new-app-welcome-screen" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-welcome-screen-151x300.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-welcome-screen-515x1024.jpeg" decoding="async" loading="lazy" class="aligncenter wp-image-132227 size-full" src="../Images/f6c6e8905503f7e754fc7b93c2f7ff4e.png" alt="React Native New App Welcome Screen" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-welcome-screen.jpeg 580w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-welcome-screen-151x300.jpeg 151w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-welcome-screen-515x1024.jpeg 515w" sizes="(max-width: 580px) 100vw, 580px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-new-app-welcome-screen.jpeg"/></noscript>
<h2 id="required-dependencies-geolocation-react-native">React Native 中地理定位所需的依赖项</h2>
<p>使用 Yarn 或 npm 安装<code>react-native-geolocation-service</code>库，代码如下:</p>
<pre class="language-bash hljs">$ yarn add react-native-geolocation-service
</pre>
<pre class="language-bash hljs">$ npm install react-native-geolocation-service --save
</pre>
<p>在过去，您必须链接库，但在 React Native 的最新版本中，当使用<code>npx react-native run-android</code>或 iOS 等效版本运行构建时，这是自动完成的。</p>
<p>以前，您会使用一个<code>npx react-native link</code>命令，它不再是 React 本机 CLI 的一部分。如果你使用的是 React Native ≤v0.60，那么这些<a href="https://github.com/Agontuk/react-native-geolocation-service/blob/HEAD/docs/setup.md">链接方向</a>应该可以帮助你设置好。</p>
<p>我们还希望通过向<code>android/src/main/AndroidManifest.xml</code>添加以下代码来确保我们在应用程序中启用权限:</p>
<pre>    &lt;uses-permission android:name="android.permission.INTERNET" /&gt;
    &lt;uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" /&gt;
</pre>
<p>然后，再次运行<code>npx react-native run-android</code>。</p>
<h2 id="adding-geolocation-react-native-app">将地理定位添加到 React 本机应用程序</h2>
<p>让我们向 React 本机应用程序添加两个独立的按钮，一个用于获取用户的位置，我们将把它存储在应用程序状态中，另一个用于将用户的位置发送到 Twitter。</p>
<p>我们将在欢迎文本下的<code>App.js</code>中添加两个按钮。确保从 React Native 更新导入，将<code>Button</code>作为<code>import {StyleSheet, View, Text, Button} from 'react-native';</code>包含进来:</p>
<pre class="language-javascript hljs">  return (
    &lt;View style={styles.container}&gt;
      &lt;Text&gt;Welcome!&lt;/Text&gt;
      &lt;View
        style={{marginTop: 10, padding: 10, borderRadius: 10, width: '40%'}}&gt;
        &lt;Button title="Get Location" /&gt;
      &lt;/View&gt;
      &lt;Text&gt;Latitude: &lt;/Text&gt;
      &lt;Text&gt;Longitude: &lt;/Text&gt;
      &lt;View
        style={{marginTop: 10, padding: 10, borderRadius: 10, width: '40%'}}&gt;
        &lt;Button title="Send Location" /&gt;
      &lt;/View&gt;
    &lt;/View&gt;
  );
};
</pre>
<p>现在，我们的应用程序看起来如下图所示:</p>
<p><img data-attachment-id="132229" data-permalink="https://blog.logrocket.com/react-native-lattitude-longitude-geolocation/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-lattitude-longitude-geolocation.png" data-orig-size="580,1038" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="react-native-lattitude-longitude-geolocation" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-lattitude-longitude-geolocation-168x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-lattitude-longitude-geolocation-572x1024.png" decoding="async" class="aligncenter wp-image-132229 size-full jetpack-lazy-image" src="../Images/f98bcf076fabac070bd224c4a837720d.png" alt="React Native Latitude Longitude Geolocation" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-lattitude-longitude-geolocation.png 580w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-lattitude-longitude-geolocation-168x300.png 168w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-lattitude-longitude-geolocation-572x1024.png 572w" data-lazy-sizes="(max-width: 580px) 100vw, 580px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-lattitude-longitude-geolocation.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-lattitude-longitude-geolocation.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="132229" data-permalink="https://blog.logrocket.com/react-native-lattitude-longitude-geolocation/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-lattitude-longitude-geolocation.png" data-orig-size="580,1038" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="react-native-lattitude-longitude-geolocation" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-lattitude-longitude-geolocation-168x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-lattitude-longitude-geolocation-572x1024.png" decoding="async" loading="lazy" class="aligncenter wp-image-132229 size-full" src="../Images/f98bcf076fabac070bd224c4a837720d.png" alt="React Native Latitude Longitude Geolocation" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-lattitude-longitude-geolocation.png 580w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-lattitude-longitude-geolocation-168x300.png 168w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-lattitude-longitude-geolocation-572x1024.png 572w" sizes="(max-width: 580px) 100vw, 580px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-lattitude-longitude-geolocation.png"/></noscript>
<h2 id="importingreactnativelibrary">导入<code>react-native-library</code></h2>
<p>一旦安装了<code>react-native-geolocation-service</code>库，我们就可以实现获取经纬度坐标的逻辑。使用 ES6，我们将编写一个由<code>onPress</code>按钮事件处理的异步请求，该请求由<code>GET LOCATION</code>按钮触发。</p>
<p>一旦该事件处理程序被触发，用户将被要求获得访问其位置的权限。批准请求后，该位置将返回给用户。</p>
<p>首先，我们需要如下导入<code>react-native-geolocation-service</code>:</p>
<pre class="language-javascript hljs">import Geolocation from 'react-native-geolocation-service';
</pre>
<h2 id="requesting-permission-access-location-data">请求访问位置数据的许可</h2>
<p>要使用手机的地理定位功能，我们必须要求用户提供适当的权限。在下面的代码中，我们有一个在 Android 设备上请求权限的函数。</p>
<p>确保按如下方式导入<code>PermissionsAndroid</code><code>import {StyleSheet, View, Text, Button, PermissionsAndroid} from 'react-native';</code>:</p>
<pre class="language-javascript hljs">// Function to get permission for location
const requestLocationPermission = async () =&gt; {
  try {
    const granted = await PermissionsAndroid.request(
      PermissionsAndroid.PERMISSIONS.ACCESS_FINE_LOCATION,
      {
        title: 'Geolocation Permission',
        message: 'Can we access your location?',
        buttonNeutral: 'Ask Me Later',
        buttonNegative: 'Cancel',
        buttonPositive: 'OK',
      },
    );
    console.log('granted', granted);
    if (granted === 'granted') {
      console.log('You can use Geolocation');
      return true;
    } else {
      console.log('You cannot use Geolocation');
      return false;
    }
  } catch (err) {
    return false;
  }
};
</pre>
<p>对于 iOS app 权限，可以在 iOS 权限流上阅读<a href="https://rossbulat.medium.com/react-native-managing-app-permissions-for-ios-4204e2286598">这篇文章，或者试试这个统一的</a><a href="https://www.npmjs.com/package/react-native-permissions"> iOS/Android 权限库</a>。</p>
<p>在上面的函数中，我们调用请求函数向发行者请求许可。我们指定我们正在请求<code>ACCESS_FINE_LOCATION</code>权限，这个权限必须在之前添加到 Android 清单中并重新构建。</p>
<p>然后，我们传递一个带有提示细节的对象。请求的结果存储在变量<code>granted</code>中，如果成功，它将存储字符串<code>granted</code>。如果请求成功，我们返回<code>true</code>，如果不成功，我们返回<code>false</code>。</p>
<h2 id="getting-users-location-data">获取用户的位置数据</h2>
<p>现在，从组件内部，我们将创建状态来跟踪用户的位置。首先，确保您从 React 导入了<code>useState</code>:</p>
<pre>  // state to hold location
  const [location, setLocation] = useState(false);
</pre>
<p>然后我们将编写一个函数，这样当<code>GET LOCATION</code>按钮被按下时，它将请求许可。如果许可被授予，它将获得用户的当前位置:</p>
<pre>  // function to check permissions and get Location
  const getLocation = () =&gt; {
    const result = requestLocationPermission();
    result.then(res =&gt; {
      console.log('res is:', res);
      if (res) {
        Geolocation.getCurrentPosition(
          position =&gt; {
            console.log(position);
            setLocation(position);
          },
          error =&gt; {
            // See error code charts below.
            console.log(error.code, error.message);
            setLocation(false);
          },
          {enableHighAccuracy: true, timeout: 15000, maximumAge: 10000},
        );
      }
    });
    console.log(location);
  };
</pre>
<p>我们看到自己调用了之前编写的<code>requestLocationPermission</code>函数，该函数将返回一个承诺，该承诺将解析为<code>true</code>或<code>false</code>。如果承诺解析为<code>true</code>，我们使用<code>react-native-geolocation-service</code>库获得正确的位置并将位置状态设置为结果。如果承诺为<code>false</code>，表示未给予许可，或者如果未能获得位置，则将位置状态设置为<code>false</code>。</p>
<p>然后我们在<code>GET LOCATION</code>按钮上添加<code>getLocation</code>功能作为<code>onPress</code>事件:</p>
<pre>&lt;Button title="Get Location" onPress={getLocation} /&gt;
</pre>
<p>到目前为止，您的<code>App.js</code>应该看起来像下面的代码:</p>
<pre>/**
 * Sample React Native App
 * https://github.com/facebook/react-native
 *
 * @format
 * @flow strict-local
 */
import React, {useState, useEffect} from 'react';
import {StyleSheet, View, Text, Button, PermissionsAndroid} from 'react-native';
import Geolocation from 'react-native-geolocation-service';
// Function to get permission for location
const requestLocationPermission = async () =&gt; {
  try {
    const granted = await PermissionsAndroid.request(
      PermissionsAndroid.PERMISSIONS.ACCESS_FINE_LOCATION,
      {
        title: 'Geolocation Permission',
        message: 'Can we access your location?',
        buttonNeutral: 'Ask Me Later',
        buttonNegative: 'Cancel',
        buttonPositive: 'OK',
      },
    );
    console.log('granted', granted);
    if (granted === 'granted') {
      console.log('You can use Geolocation');
      return true;
    } else {
      console.log('You cannot use Geolocation');
      return false;
    }
  } catch (err) {
    return false;
  }
};
const App = () =&gt; {
  // state to hold location
  const [location, setLocation] = useState(false);
  // function to check permissions and get Location
  const getLocation = () =&gt; {
    const result = requestLocationPermission();
    result.then(res =&gt; {
      console.log('res is:', res);
      if (res) {
        Geolocation.getCurrentPosition(
          position =&gt; {
            console.log(position);
            setLocation(position);
          },
          error =&gt; {
            // See error code charts below.
            console.log(error.code, error.message);
            setLocation(false);
          },
          {enableHighAccuracy: true, timeout: 15000, maximumAge: 10000},
        );
      }
    });
    console.log(location);
  };
  return (
    &lt;View style={styles.container}&gt;
      &lt;Text&gt;Welcome!&lt;/Text&gt;
      &lt;View
        style={{marginTop: 10, padding: 10, borderRadius: 10, width: '40%'}}&gt;
        &lt;Button title="Get Location" onPress={getLocation} /&gt;
      &lt;/View&gt;
      &lt;Text&gt;Latitude: {location ? location.coords.latitude : null}&lt;/Text&gt;
      &lt;Text&gt;Longitude: {location ? location.coords.longitude : null}&lt;/Text&gt;
      &lt;View
        style={{marginTop: 10, padding: 10, borderRadius: 10, width: '40%'}}&gt;
        &lt;Button title="Send Location" /&gt;
      &lt;/View&gt;
    &lt;/View&gt;
  );
};
const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#fff',
    alignItems: 'center',
    justifyContent: 'center',
  },
});
export default App;
</pre>
<p>当它运行时，你点击<strong> <code>GET LOCATION</code> </strong>按钮，你会看到如下的弹出窗口:</p>
<p><img data-attachment-id="132242" data-permalink="https://blog.logrocket.com/react-native-geolocation-get-location-popup/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-geolocation-get-location-popup.png" data-orig-size="580,1037" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="react-native-geolocation-get-location-popup" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-geolocation-get-location-popup-168x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-geolocation-get-location-popup-573x1024.png" decoding="async" class="aligncenter wp-image-132242 size-full jetpack-lazy-image" src="../Images/676f5397d9e2378c1c48856ea38a3c36.png" alt="React Native Geolocation Get Location Popup" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-geolocation-get-location-popup.png 580w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-geolocation-get-location-popup-168x300.png 168w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-geolocation-get-location-popup-573x1024.png 573w" data-lazy-sizes="(max-width: 580px) 100vw, 580px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-geolocation-get-location-popup.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-geolocation-get-location-popup.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="132242" data-permalink="https://blog.logrocket.com/react-native-geolocation-get-location-popup/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-geolocation-get-location-popup.png" data-orig-size="580,1037" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="react-native-geolocation-get-location-popup" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-geolocation-get-location-popup-168x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-geolocation-get-location-popup-573x1024.png" decoding="async" loading="lazy" class="aligncenter wp-image-132242 size-full" src="../Images/676f5397d9e2378c1c48856ea38a3c36.png" alt="React Native Geolocation Get Location Popup" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-geolocation-get-location-popup.png 580w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-geolocation-get-location-popup-168x300.png 168w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-geolocation-get-location-popup-573x1024.png 573w" sizes="(max-width: 580px) 100vw, 580px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-geolocation-get-location-popup.png"/></noscript>
<p><img data-attachment-id="132240" data-permalink="https://blog.logrocket.com/react-native-access-location-data-prompt/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-access-location-data-prompt.png" data-orig-size="580,1045" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="react-native-access-location-data-prompt" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-access-location-data-prompt-167x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-access-location-data-prompt-568x1024.png" decoding="async" class="aligncenter wp-image-132240 size-full jetpack-lazy-image" src="../Images/8f9c8b8be3f7fe9e8ecc4fa0d26dc27d.png" alt="React Native Access Location Data Prompt" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-access-location-data-prompt.png 580w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-access-location-data-prompt-167x300.png 167w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-access-location-data-prompt-568x1024.png 568w" data-lazy-sizes="(max-width: 580px) 100vw, 580px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-access-location-data-prompt.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-access-location-data-prompt.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="132240" data-permalink="https://blog.logrocket.com/react-native-access-location-data-prompt/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-access-location-data-prompt.png" data-orig-size="580,1045" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="react-native-access-location-data-prompt" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-access-location-data-prompt-167x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-access-location-data-prompt-568x1024.png" decoding="async" loading="lazy" class="aligncenter wp-image-132240 size-full" src="../Images/8f9c8b8be3f7fe9e8ecc4fa0d26dc27d.png" alt="React Native Access Location Data Prompt" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-access-location-data-prompt.png 580w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-access-location-data-prompt-167x300.png 167w, https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-access-location-data-prompt-568x1024.png 568w" sizes="(max-width: 580px) 100vw, 580px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/react-native-access-location-data-prompt.png"/></noscript>
<p>然后，您的位置应该会显示在屏幕上，如下所示:</p>
<p><img data-attachment-id="132238" data-permalink="https://blog.logrocket.com/geolocation-lattitude-longitude-data-screen/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/geolocation-lattitude-longitude-data-screen.png" data-orig-size="487,1050" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="geolocation-lattitude-longitude-data-screen" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/geolocation-lattitude-longitude-data-screen-139x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/geolocation-lattitude-longitude-data-screen-475x1024.png" decoding="async" class="aligncenter wp-image-132238 size-full jetpack-lazy-image" src="../Images/a73b4d3b6c1b5432ebc73d2462b5de8e.png" alt="Geolocation Latitude Longitude Data Screen" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/geolocation-lattitude-longitude-data-screen.png 487w, https://blog.logrocket.com/wp-content/uploads/2022/09/geolocation-lattitude-longitude-data-screen-139x300.png 139w, https://blog.logrocket.com/wp-content/uploads/2022/09/geolocation-lattitude-longitude-data-screen-475x1024.png 475w" data-lazy-sizes="(max-width: 487px) 100vw, 487px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/geolocation-lattitude-longitude-data-screen.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/geolocation-lattitude-longitude-data-screen.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="132238" data-permalink="https://blog.logrocket.com/geolocation-lattitude-longitude-data-screen/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/geolocation-lattitude-longitude-data-screen.png" data-orig-size="487,1050" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="geolocation-lattitude-longitude-data-screen" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/geolocation-lattitude-longitude-data-screen-139x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/geolocation-lattitude-longitude-data-screen-475x1024.png" decoding="async" loading="lazy" class="aligncenter wp-image-132238 size-full" src="../Images/a73b4d3b6c1b5432ebc73d2462b5de8e.png" alt="Geolocation Latitude Longitude Data Screen" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/geolocation-lattitude-longitude-data-screen.png 487w, https://blog.logrocket.com/wp-content/uploads/2022/09/geolocation-lattitude-longitude-data-screen-139x300.png 139w, https://blog.logrocket.com/wp-content/uploads/2022/09/geolocation-lattitude-longitude-data-screen-475x1024.png 475w" sizes="(max-width: 487px) 100vw, 487px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/geolocation-lattitude-longitude-data-screen.png"/></noscript>
<h2 id="location-object"><code>Location</code>物体</h2>
<p>您将从<code>react-native-geolocation-service</code>获得的位置对象看起来类似于下面的代码:</p>
<pre>{
  "coords": {
    "accuracy": 5,
    "altitude": 5,
    "altitudeAccuracy": 0.5,
    "heading": 0,
    "latitude": 37.4219983,
    "longitude": -122.084,
    "speed": 0
  },
  "mocked": false,
  "provider": "fused",
  "timestamp": 1662837540458
}
</pre>
<h2 id="sending-geolocation-data-react-native">在 React Native 中发送地理位置数据</h2>
<p>要将用户的地理位置数据发送到 Twitter，我们只需将<code>SEND LOCATION</code>按钮变成 Tweet 按钮。</p>
<p>在将位置发送给用户之前，我们将显示示例中返回的数据。为此，我们将 React 中的<code>useState</code>挂钩添加到我们的应用程序中，如下所示:</p>
<pre>import React, { useState } from 'react';
</pre>
<p>然后，我们在我们的<code>App</code>函数中定义一个状态:</p>
<pre>[viewLocation, isViewLocation] = useState([])
</pre>
<p>我们更新<code>if</code>语句来调用<code>isViewLocation</code>方法，并用返回的<code>Location</code>信息对象更新<code>viewLocation</code>数组:</p>
<pre>isViewLocation(location)
</pre>
<p>要查看返回的信息，请更新<code>Location</code>和<code>Longitude</code>文本标签:</p>
<pre>&lt;Text&gt;Latitude: {viewLocation.latitude} &lt;/Text&gt;
&lt;Text&gt;Longitude: {viewLocation.longitude} &lt;/Text&gt;
</pre>
<p><code>viewLocation.latitude</code>返回方法<code>isViewLocation</code>调用的对象响应中的纬度。经度也是如此。</p>
<p>此时，我们可以更新按钮，将用户的位置发送到 Twitter。下图显示了我们最后一个示例应用的视图:</p>
<p><img data-attachment-id="132233" data-permalink="https://blog.logrocket.com/send-geolocation-data-twitter-react-native/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/send-geolocation-data-twitter-react-native.png" data-orig-size="580,1032" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="send-geolocation-data-twitter-react-native" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/send-geolocation-data-twitter-react-native-169x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/send-geolocation-data-twitter-react-native-576x1024.png" decoding="async" class="aligncenter wp-image-132233 size-full jetpack-lazy-image" src="../Images/e5c974988481f80bb8f69fcf628311e0.png" alt="Send Geolocation Data Twitter React Native" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/send-geolocation-data-twitter-react-native.png 580w, https://blog.logrocket.com/wp-content/uploads/2022/09/send-geolocation-data-twitter-react-native-169x300.png 169w, https://blog.logrocket.com/wp-content/uploads/2022/09/send-geolocation-data-twitter-react-native-576x1024.png 576w" data-lazy-sizes="(max-width: 580px) 100vw, 580px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/send-geolocation-data-twitter-react-native.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/send-geolocation-data-twitter-react-native.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="132233" data-permalink="https://blog.logrocket.com/send-geolocation-data-twitter-react-native/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/send-geolocation-data-twitter-react-native.png" data-orig-size="580,1032" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="send-geolocation-data-twitter-react-native" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/send-geolocation-data-twitter-react-native-169x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/send-geolocation-data-twitter-react-native-576x1024.png" decoding="async" loading="lazy" class="aligncenter wp-image-132233 size-full" src="../Images/e5c974988481f80bb8f69fcf628311e0.png" alt="Send Geolocation Data Twitter React Native" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/send-geolocation-data-twitter-react-native.png 580w, https://blog.logrocket.com/wp-content/uploads/2022/09/send-geolocation-data-twitter-react-native-169x300.png 169w, https://blog.logrocket.com/wp-content/uploads/2022/09/send-geolocation-data-twitter-react-native-576x1024.png 576w" sizes="(max-width: 580px) 100vw, 580px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/send-geolocation-data-twitter-react-native.png"/></noscript>

<p>接下来，我们将设置<code>SEND LOCATION</code>按钮，将用户的位置添加到新的 Tweet 中:</p>
<pre>  // Function to Send Location to twitter
  const sendLocation = () =&gt; {
    try {
      if (location) {
        const tweet = `latitude is ${location.coords.latitude} and longitude is ${location.coords.longitude}`;
        const url = `https://twitter.com/intent/tweet?text=${tweet}`;
        Linking.openURL(url);
      }
    } catch (error) {
      console.log(error);
    }
  };
</pre>
<p>上面的功能:</p>
<ul>
<li>检查我们在本州是否有位置。如果我们不这样做，位置将等于<code>false</code></li>
<li>用我们的纬度和经度构造一个字符串作为我们的 Tweet</li>
<li>构造一个 URL 来创建 Tweet</li>
<li>使用<code>Linking</code>对象打开 URL。确保从 React Native 导入<code>Linking</code></li>
</ul>
<p>现在，当您点击<strong> <code>SEND LOCATION</code> </strong>按钮时，您应该会看到一个如下图所示的浏览器窗口:</p>
<p><img data-attachment-id="132231" data-permalink="https://blog.logrocket.com/send-location-button-browser-window/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/send-location-button-browser-window-.png" data-orig-size="487,1050" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="send-location-button-browser-window" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/send-location-button-browser-window--139x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/send-location-button-browser-window--475x1024.png" decoding="async" class="aligncenter wp-image-132231 size-full jetpack-lazy-image" src="../Images/ffc696be2c1fdf22b006d1f16dd0f56b.png" alt="Send Location Button Browser Window" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/send-location-button-browser-window-.png 487w, https://blog.logrocket.com/wp-content/uploads/2022/09/send-location-button-browser-window--139x300.png 139w, https://blog.logrocket.com/wp-content/uploads/2022/09/send-location-button-browser-window--475x1024.png 475w" data-lazy-sizes="(max-width: 487px) 100vw, 487px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/send-location-button-browser-window-.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/send-location-button-browser-window-.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="132231" data-permalink="https://blog.logrocket.com/send-location-button-browser-window/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/send-location-button-browser-window-.png" data-orig-size="487,1050" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="send-location-button-browser-window" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/send-location-button-browser-window--139x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/send-location-button-browser-window--475x1024.png" decoding="async" loading="lazy" class="aligncenter wp-image-132231 size-full" src="../Images/ffc696be2c1fdf22b006d1f16dd0f56b.png" alt="Send Location Button Browser Window" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/send-location-button-browser-window-.png 487w, https://blog.logrocket.com/wp-content/uploads/2022/09/send-location-button-browser-window--139x300.png 139w, https://blog.logrocket.com/wp-content/uploads/2022/09/send-location-button-browser-window--475x1024.png 475w" sizes="(max-width: 487px) 100vw, 487px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/send-location-button-browser-window-.png"/></noscript>
<p>最终的<code>App.js</code>文件应该类似于下面的代码:</p>
<pre class="language-javascript hljs">/**
 * Sample React Native App
 * https://github.com/facebook/react-native
 *
 * @format
 * @flow strict-local
 */
import React, {useState, useEffect} from 'react';
import {
  StyleSheet,
  View,
  Text,
  Button,
  PermissionsAndroid,
  Linking,
} from 'react-native';
import Geolocation from 'react-native-geolocation-service';
// Function to get permission for location
const requestLocationPermission = async () =&gt; {
  try {
    const granted = await PermissionsAndroid.request(
      PermissionsAndroid.PERMISSIONS.ACCESS_FINE_LOCATION,
      {
        title: 'Geolocation Permission',
        message: 'Can we access your location?',
        buttonNeutral: 'Ask Me Later',
        buttonNegative: 'Cancel',
        buttonPositive: 'OK',
      },
    );
    console.log('granted', granted);
    if (granted === 'granted') {
      console.log('You can use Geolocation');
      return true;
    } else {
      console.log('You cannot use Geolocation');
      return false;
    }
  } catch (err) {
    return false;
  }
};
const App = () =&gt; {
  // state to hold location
  const [location, setLocation] = useState(false);
  // function to check permissions and get Location
  const getLocation = () =&gt; {
    const result = requestLocationPermission();
    result.then(res =&gt; {
      console.log('res is:', res);
      if (res) {
        Geolocation.getCurrentPosition(
          position =&gt; {
            console.log(position);
            setLocation(position);
          },
          error =&gt; {
            // See error code charts below.
            console.log(error.code, error.message);
            setLocation(false);
          },
          {enableHighAccuracy: true, timeout: 15000, maximumAge: 10000},
        );
      }
    });
    console.log(location);
  };
  // Function to Send Location to twitter
  const sendLocation = () =&gt; {
    try {
      if (location) {
        const tweet = `latitude is ${location.coords.latitude} and longitude is ${location.coords.longitude}`;
        const url = `https://twitter.com/intent/tweet?text=${tweet}`;
        Linking.openURL(url);
      }
    } catch (error) {
      console.log(error);
    }
  };
  return (
    &lt;View style={styles.container}&gt;
      &lt;Text&gt;Welcome!&lt;/Text&gt;
      &lt;View
        style={{marginTop: 10, padding: 10, borderRadius: 10, width: '40%'}}&gt;
        &lt;Button title="Get Location" onPress={getLocation} /&gt;
      &lt;/View&gt;
      &lt;Text&gt;Latitude: {location ? location.coords.latitude : null}&lt;/Text&gt;
      &lt;Text&gt;Longitude: {location ? location.coords.longitude : null}&lt;/Text&gt;
      &lt;View
        style={{marginTop: 10, padding: 10, borderRadius: 10, width: '40%'}}&gt;
        &lt;Button title="Send Location" onPress={sendLocation} /&gt;
      &lt;/View&gt;
    &lt;/View&gt;
  );
};
const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#fff',
    alignItems: 'center',
    justifyContent: 'center',
  },
});
export default App;
</pre>
<h2 id="conclusion">结论</h2>
<p>现在你知道了如何获取用户的位置，你还可以做更多的事情。你可以<a href="https://blog.logrocket.com/geolocation-geocoding-flutter/">建立递送服务，跟踪用户，甚至建立紧急按钮警报系统</a>。可能性是无限的。在本教程中，我们只是触及了表面，探索了<code>react-native-geolocation-service</code>库来构建我们的示例应用程序。</p>
<p>地理定位是一个非常有趣的功能，有着广泛的现实使用案例。请在评论中告诉我你打算如何在 React 本地应用中使用地理定位。编码快乐！</p><div class="code-block code-block-18">
<div class="blog-plug inline-plug react-native-plug"><h2><a href="https://lp.logrocket.com/blg/react-native-signup"> LogRocket </a>:即时重现 React 原生应用中的问题。</h2><a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/110055665562c1e02069b3698e6cc671.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/110055665562c1e02069b3698e6cc671.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/></noscript></a><p><a href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一款 React 原生监控解决方案，可帮助您即时重现问题、确定 bug 的优先级并了解 React 原生应用的性能。</p><p>LogRocket 还可以向你展示用户是如何与你的应用程序互动的，从而帮助你提高转化率和产品使用率。LogRocket 的产品分析功能揭示了用户不完成特定流程或不采用新功能的原因。</p><p>开始主动监控您的 React 原生应用— <a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer">免费试用 LogRocket】。</a></p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>