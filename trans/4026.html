<html>
<head>
<title>Using Helmet in Node.js to secure your application </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在Node.js中使用头盔保护应用程序</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/using-helmet-node-js-secure-application/#0001-01-01">https://blog.logrocket.com/using-helmet-node-js-secure-application/#0001-01-01</a></blockquote><div><article class="article-post">
<p>Express.js是用于在Node.js中开发web应用程序的最流行的web框架。它提供了几个特性来使API开发更快更容易。</p>
<p>然而，Express在安全性方面有所欠缺，不能确保针对常见漏洞的足够保护级别。幸运的是，由于中间件，它可以很容易地扩展，中间件是在处理HTTP请求时执行的一组功能。</p>
<p>Helmet.js是基于中间件的技术，通过保护Node.js应用程序返回的HTTP头来提高安全性。在这里，您将了解什么是头盔，为什么需要它，以及如何将它集成到Node.js中以保护Express.js应用程序中的HTTP头。我们将涵盖:</p>

<p>让我们在Node.js中深挖头盔吧！</p>
<h2 id="what-helmet">头盔是什么？</h2>
<p><a href="https://helmetjs.github.io/"> Helmet.js是一个开源的JavaScript库</a>，它通过设置几个HTTP头来帮助你保护Node.js应用。它充当了<a href="https://blog.logrocket.com/nestjs-vs-express-js/"> Express和类似技术</a>的中间件，自动<a href="https://blog.logrocket.com/using-next-js-security-headers/">添加或删除HTTP头</a>以符合网络安全标准。</p>
<p>虽然不是银弹，头盔使攻击者更难利用已知的漏洞。它有助于保护Node.js Express应用免受常见安全威胁，如<a href="https://developer.mozilla.org/en-US/docs/Glossary/Cross-site_scripting">跨站点脚本(XSS) </a>和<a href="https://developer.mozilla.org/en-US/docs/Web/Security/Types_of_attacks#click-jacking">点击劫持攻击</a>。</p>
<p>头盔是特别有用的，因为快速应用程序不带有现成的安全HTTP头。这解释了为什么<a href="https://www.npmjs.com/package/helmet">的</a> <code><a href="https://www.npmjs.com/package/helmet">helmet</a></code> <a href="https://www.npmjs.com/package/helmet"> npm包</a>有超过200万的周下载量，而它的<a href="https://github.com/helmetjs/helmet"> GitHub repo号称超过94k星</a>！</p>
<p>现在让我们更深入地了解为什么在Node.js中采用头盔如此重要。</p>
<h2 id="why-need-helmet-node-js-app">为什么一个Node.js app里需要头盔？</h2>
<p>如果没有头盔，Express返回的默认头会暴露敏感信息，并使Node.js应用程序容易受到恶意参与者的攻击。相比之下，在Node.js中使用头盔可以保护您的应用程序免受XSS攻击、内容安全策略漏洞和其他安全问题的影响。</p>
<p>让我们通过一个例子来进一步探讨这个问题。您将设置一个Node.js Express应用程序，看看它的默认HTTP头提供了什么级别的安全性。</p>
<h3 id="setting-up-node-js-express-project">设置Node.js Express项目</h3>
<p>首先，确保您的机器上安装了Node.js和npm。如果您还没有安装，请下载Node.js 并按照安装向导进行安装。</p>
<p>现在，让我们建立一个快速项目。运行以下命令创建<code>express-demo</code>项目文件夹:</p>
<pre class="language-bash hljs">mkdir express-demo 
</pre>
<p>然后，通过运行以下命令进入终端中的<code>express-demo</code>文件夹:</p>
<pre class="language-bash hljs">cd express-demo
</pre>
<p>启动以下命令来初始化默认npm项目:</p>
<pre class="language-bash hljs">npm init -y
</pre>
<p><a href="https://docs.npmjs.com/cli/v9/commands/npm-init"/><code><a href="https://docs.npmjs.com/cli/v9/commands/npm-init">npm init</a></code><a href="https://docs.npmjs.com/cli/v9/commands/npm-init">命令</a>会为你配置一个空白的npm项目。请注意，<code>-y</code>标志将自动对npm在流程中询问的所有问题回答“是”。</p>
<p>您需要将Express添加到项目的依赖项中。使用以下组件安装快速模块:</p>
<pre class="language-bash hljs">npm install express
</pre>
<p>然后，在<code>express-demo</code>文件夹中创建一个<code>index.js</code>文件，并用以下代码行初始化它:</p>
<pre class="language-javascript hljs">// index.js

const express = require("express")

// creating an Express instance
const app = express()
const PORT = process.env.PORT || 3000

// initializing a basic API that
// returns the "Hello, World!" message
app.get("/", (req, res) =&gt; {
    res.json("Hello, World!")
})

// running the server
app.listen(PORT, () =&gt; {
    console.log(`Starting Express server on http://localhost:${PORT}`)
})
</pre>
<p>这只不过是具有单个端点的基本Express服务器设置。</p>
<p>使用以下命令启动服务器:</p>
<pre class="language-bash hljs">node index.js
</pre>
<p>Express服务器现在应该在<code><a href="http://localhost:3000" rel="nofollow">http://localhost:3000</a></code>运行。在您的终端中启动下面的命令来测试<code>/</code>端点:</p>
<pre class="language-bash hljs">curl http://localhost:3000/
</pre>
<p>这应该会打印出以下输出:</p>
<pre class="language-bash hljs">"Hello, World!"
</pre>
<p>瞧啊！你现在有一个工作的快递应用程序！</p>
<h3 id="exploring-express-security-without-helmet">探索不戴头盔的快递安全</h3>
<p>现在，让我们使用刚刚创建的演示应用程序来验证Express在安全HTTP头方面的默认行为。</p>
<p>使用<code>--include</code>标志重复上面的<code>curl</code>命令，以获得HTTP响应头:</p>
<pre class="language-bash hljs">curl http://localhost:3000/ --include
</pre>
<p>如果您的计算机上没有安装cURL，请使用T2的HTTP客户端，如Postman T3或T4失眠T5来检查响应的HTTP头。</p>
<p>在响应标头部分，您应该会看到以下内容:</p>
<pre>X-Powered-By: Express
Content-Type: application/json; charset=utf-8
Content-Length: 15
ETag: W/"f-pob1Yw/KBE+3vrbZz9GAyq5P2gE"
Date: Fri, 20 Jan 2023 16:29:40 GMT
Connection: keep-alive
Keep-Alive: timeout=5
</pre>
<p>注意<code>X-Powered-By</code>标题。与所有以<code>X-</code>开头的头一样，它是非标准头。具体来说，后端技术一般使用<code>X-Powered-By</code>来表示服务器用来生成HTTP响应的框架或库的名称和版本号。</p>
<p>正如致力于改善网络安全的非营利基金会OWASP所建议的那样，<code><a href="https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Headers_Cheat_Sheet.html#x-powered-by">X-Powered-By</a></code> <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Headers_Cheat_Sheet.html#x-powered-by">应该被省略</a>。这是因为你不应该向攻击者透露你的技术栈的细节。否则，他们可能会利用这些信息来利用该框架或库中的已知漏洞。</p>
<p>现在，让我们来看看<a href="https://securityheaders.com/"> Security Headers online项目</a>对您的Express应用程序的安全级别有什么看法。</p>
<p>因为安全头只允许您测试公共地址，所以您需要公开您的本地Express服务器。你可以将你的Express应用程序部署到一个服务器上，或者利用ngrok ，它允许你将一个本地web服务器暴露在互联网上。</p>
<p><a href="https://ngrok.com/download">下载ngrok </a>，解压，打开终端中的文件夹。然后，启动以下命令，用ngrok托管您的本地服务器:</p>
<pre class="language-bash hljs">ngrok http 3000
</pre>
<p>您应该会得到与下面类似的结果:</p>
<p><img data-attachment-id="162274" data-permalink="https://blog.logrocket.com/using-helmet-node-js-secure-application/attachment/img1-session-info-ngrok-local-server/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Session-info-ngrok-local-server.png" data-orig-size="730,236" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Session-info-ngrok-local-server" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Session-info-ngrok-local-server-300x97.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Session-info-ngrok-local-server.png" decoding="async" class="aligncenter size-full wp-image-162274 jetpack-lazy-image" src="../Images/474644706316f171c75721093247727b.png" alt="Terminal With Black Background Showing Session Info After Launching Command To Host Local Server With Ngrok" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Session-info-ngrok-local-server.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Session-info-ngrok-local-server-300x97.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Session-info-ngrok-local-server.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Session-info-ngrok-local-server.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162274" data-permalink="https://blog.logrocket.com/using-helmet-node-js-secure-application/attachment/img1-session-info-ngrok-local-server/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Session-info-ngrok-local-server.png" data-orig-size="730,236" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Session-info-ngrok-local-server" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Session-info-ngrok-local-server-300x97.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Session-info-ngrok-local-server.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162274" src="../Images/474644706316f171c75721093247727b.png" alt="Terminal With Black Background Showing Session Info After Launching Command To Host Local Server With Ngrok" srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Session-info-ngrok-local-server.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Session-info-ngrok-local-server-300x97.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Session-info-ngrok-local-server.png"/></noscript>
<p>“转发”字段包含公开访问您的本地服务器的URL。由于要测试的端点是<code>/</code>，复制URL，添加一个尾随的<code>/</code>字符，并将其粘贴到安全头输入中，如下所示:</p>
<p><img data-attachment-id="162276" data-permalink="https://blog.logrocket.com/using-helmet-node-js-secure-application/attachment/img2-security-headers-online-service/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Security-Headers-online-service.png" data-orig-size="730,153" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Security-Headers-online-service" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Security-Headers-online-service-300x63.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Security-Headers-online-service.png" decoding="async" class="aligncenter size-full wp-image-162276 jetpack-lazy-image" src="../Images/577ebbc439157982c9f0005003fec750.png" alt="Security Headers Online Service With Blue Background And Text Field With Pasted Url For Public Access To Local Server" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Security-Headers-online-service.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Security-Headers-online-service-300x63.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Security-Headers-online-service.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Security-Headers-online-service.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162276" data-permalink="https://blog.logrocket.com/using-helmet-node-js-secure-application/attachment/img2-security-headers-online-service/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Security-Headers-online-service.png" data-orig-size="730,153" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Security-Headers-online-service" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Security-Headers-online-service-300x63.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Security-Headers-online-service.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162276" src="../Images/577ebbc439157982c9f0005003fec750.png" alt="Security Headers Online Service With Blue Background And Text Field With Pasted Url For Public Access To Local Server" srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Security-Headers-online-service.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Security-Headers-online-service-300x63.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Security-Headers-online-service.png"/></noscript>
<p>单击“扫描”按钮，您应该会得到以下结果:</p>
<p><img data-attachment-id="162278" data-permalink="https://blog.logrocket.com/using-helmet-node-js-secure-application/attachment/img3-security-headers-f-report/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Security-Headers-F-report.png" data-orig-size="730,332" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Security-Headers-F-report" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Security-Headers-F-report-300x136.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Security-Headers-F-report.png" decoding="async" class="aligncenter size-full wp-image-162278 jetpack-lazy-image" src="../Images/75a26a74e4c90c75db9cfac1a36dc7f7.png" alt="Security Headers Online Service With Red Background And F Grade On Security Report Summary" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Security-Headers-F-report.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Security-Headers-F-report-300x136.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Security-Headers-F-report.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Security-Headers-F-report.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162278" data-permalink="https://blog.logrocket.com/using-helmet-node-js-secure-application/attachment/img3-security-headers-f-report/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Security-Headers-F-report.png" data-orig-size="730,332" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Security-Headers-F-report" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Security-Headers-F-report-300x136.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Security-Headers-F-report.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162278" src="../Images/75a26a74e4c90c75db9cfac1a36dc7f7.png" alt="Security Headers Online Service With Red Background And F Grade On Security Report Summary" srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Security-Headers-F-report.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Security-Headers-F-report-300x136.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Security-Headers-F-report.png"/></noscript>
<p>正如你在这里看到的，安全头项目给了演示应用一个令人担忧的“F”级。原因是用不带头盔的Express开发的API响应缺少了所有最相关的HTTP安全头。</p>
<p>这也是为什么官方Express <a href="https://blog.logrocket.com/build-shopify-app-with-node-js/">“生产最佳实践:安全性”</a>页面提到采用头盔作为生产应用的最佳实践。现在让我们学习如何在Node.js中集成头盔！</p>
<h2 id="securing-express-with-helmet">用头盔保护快递</h2>
<p>让我们扩展前面实现的Express demo项目，用头盔保护它。正如您将要了解的，这只需要几行代码。</p>
<h3 id="installing-helmet-express-project">在您的快速项目中安装头盔</h3>
<p>首先，您需要将Helmet.js添加到项目的依赖项中。使用以下命令安装<code>helmet</code> npm包:</p>
<pre class="language-bash hljs">npm i helmet
</pre>
<p>您的<code>package.json</code>文件现在将在<a href="https://docs.npmjs.com/cli/v9/configuring-npm/package-json#dependencies"/><code><a href="https://docs.npmjs.com/cli/v9/configuring-npm/package-json#dependencies">dependencies</a></code><a href="https://docs.npmjs.com/cli/v9/configuring-npm/package-json#dependencies">字段</a>中包含<code>helmet</code>。</p>
<h3 id="setting-up-helmet-express">在Express中设置头盔</h3>
<p>将头盔集成到Node.js Express应用程序中很简单。如有问题，<a href="https://github.com/helmetjs/helmet#quick-start">遵循官方指南</a>。</p>
<p>在您的<code>index.js</code>文件中，使用以下命令导入<code>helmet</code>:</p>
<pre class="language-javascript hljs">const helmet = require("helmet")
</pre>
<p>现在，在您的快速应用程序中注册<code>helmet</code>,如下所示:</p>
<pre class="language-bash hljs">app.use(helmet())
</pre>
<p>记住<code>helmet()</code>只不过是<a href="https://expressjs.com/en/guide/using-middleware.html">一个快递中间件</a>。具体来说，顶层的<code>helmet()</code>函数是15个子中间件的包装器。所以，通过注册<code>helmet()</code>，你为你的应用程序增加了15个快速中间件。</p>
<p>注意，每个中间件负责设置一个HTTP安全头。</p>
<p>您的<code>index.js</code>文件现在将如下所示:</p>
<pre class="language-javascript hljs">// index.js

const express = require("express")
const helmet = require("helmet")

const PORT = process.env.PORT || 3000

const app = express()

// enabling the Helmet middleware
app.use(helmet())

// initializing a basic API that
// returns the "Hello, World!" message
app.get("/", (req, res) =&gt; {
    res.json("Hello, World!")
})

// running the server
app.listen(PORT, () =&gt; {
    console.log(`Starting Express server on http://localhost:${PORT}`)
})
</pre>
<p>就是这样！将头盔添加到Node.js应用程序中只需要两行代码！</p>
<h3 id="exploring-express-security-with-helmet">用头盔探索快递安全</h3>
<p>让我们重复前面执行的安全测试。使用以下命令停止Node.js本地服务器并重新启动它:</p>
<pre class="language-bash hljs">node index.js 
</pre>
<p>重复<code>curl</code>命令或使用HTTP客户端查看新响应的HTTP头:</p>
<pre class="language-bash hljs">curl http://localhost:3000/ --include
</pre>
<p>响应HTTP头部分现在将包括以下内容:</p>
<pre>Content-Security-Policy: default-src 'self';base-uri 'self';font-src 'self' https: data:;form-action 'self';frame-ancestors 'self';img-src 'self' data:;object-src 'none';script-src 'self';script-src-attr 'none';style-src 'self' https: 'unsafe-inline';upgrade-insecure-requests
Cross-Origin-Embedder-Policy: require-corp
Cross-Origin-Opener-Policy: same-origin
Cross-Origin-Resource-Policy: same-origin
X-DNS-Prefetch-Control: off
X-Frame-Options: SAMEORIGIN
Strict-Transport-Security: max-age=15552000; includeSubDomains
X-Download-Options: noopen
X-Content-Type-Options: nosniff
Origin-Agent-Cluster: ?1
X-Permitted-Cross-Domain-Policies: none
Referrer-Policy: no-referrer
X-XSS-Protection: 0
Content-Type: application/json; charset=utf-8
Content-Length: 15
ETag: W/"f-pob1Yw/KBE+3vrbZz9GAyq5P2gE"
Date: Fri, 20 Jan 2023 18:15:32 GMT
Connection: keep-alive
Keep-Alive: timeout=5
</pre>
<p>如您所见，响应中有许多新的HTTP头。还有，<code>X-Powered-By</code>被删除。</p>
<p>如果关闭了ngrok，请使用以下命令再次运行它:</p>
<pre class="language-bash hljs">ngrok http 3000
</pre>
<p>否则，请立即访问安全标题网站。就像之前一样，复制ngrok提供的网址，点击“扫描”。这一次，结果将会不同:</p>
<p><img data-attachment-id="162280" data-permalink="https://blog.logrocket.com/using-helmet-node-js-secure-application/attachment/img4-security-headers-a-report/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Security-Headers-A-report.png" data-orig-size="730,343" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Security-Headers-A-report" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Security-Headers-A-report-300x141.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Security-Headers-A-report.png" decoding="async" class="aligncenter size-full wp-image-162280 jetpack-lazy-image" src="../Images/a6dd0e75f94f2328a4a31ead51936c39.png" alt="Security Headers Online Service With Green Background And A Grade On Security Report Summary" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Security-Headers-A-report.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Security-Headers-A-report-300x141.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Security-Headers-A-report.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Security-Headers-A-report.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162280" data-permalink="https://blog.logrocket.com/using-helmet-node-js-secure-application/attachment/img4-security-headers-a-report/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Security-Headers-A-report.png" data-orig-size="730,343" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Security-Headers-A-report" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Security-Headers-A-report-300x141.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Security-Headers-A-report.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162280" src="../Images/a6dd0e75f94f2328a4a31ead51936c39.png" alt="Security Headers Online Service With Green Background And A Grade On Security Report Summary" srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Security-Headers-A-report.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Security-Headers-A-report-300x141.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Security-Headers-A-report.png"/></noscript>
<p>请注意，API响应现在涉及所有主要的HTTP安全头，除了<code><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Permissions_Policy">Permissions-Policy</a></code>。这使得Express应用程序从“F”级升至“A”级。仅仅两行代码带来了多么巨大的变化啊！</p>
<p>此外，正如Helmet.js的主要开发者之一在GitHub 上提到的<a href="https://github.com/helmetjs/helmet/issues/234">，Helmet不会自动支持<code>Permissions-Policy</code>，只是因为header规范仍处于草案状态。所以，这种情况可能很快就会改变。</a></p>

<p>正如你刚刚了解到的，头盔默认设置了很多头。由于安全策略会随着时间的推移而变化，因此始终保持<code>helmet</code>最新是至关重要的。这样，头盔引入的安全头将始终符合安全标准。</p>
<p>所有这些头文件都对应用程序的安全性有影响，但有些头文件比其他头文件更相关。现在让我们关注最重要的安全头，以理解它们为什么有用，头盔如何默认处理它们，以及如何用头盔配置它们。</p>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">内容安全策略</a>，也称为CSP，是一种安全措施，可帮助您缓解多种攻击，如跨站点脚本(XSS)和数据注入攻击。</p>
<p>具体来说，CSP允许您指定允许网页加载和执行哪些内容源。例如，您可以使用CSP阻止网页从其他网站加载图像和iframes。</p>
<p>您可以通过<code><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy">Content-Security-Policy</a></code> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy"> HTTP头</a>配置CSP。默认情况下，头盔赋予<code>Content-Security-Policy</code>头以下值:</p>
<pre>Content-Security-Policy: default-src 'self';base-uri 'self';font-src 'self' https: data:;form-action 'self';frame-ancestors 'self';img-src 'self' data:;object-src 'none';script-src 'self';script-src-attr 'none';style-src 'self' https: 'unsafe-inline';upgrade-insecure-requests
</pre>
<p>使用此策略，您的网页无法加载远程字体或样式。这是因为<code>font-src</code>和<code>style-src</code>分别被设置为<code>self</code>。默认情况下，头盔定义的CSP策略非常严格，但是您可以使用<code>contentSecurityPolicy()</code>对其进行如下更改:</p>
<pre>// overriding "font-src" and "style-src" while
// maintaining the other default values
helmet.contentSecurityPolicy({
  useDefaults: true,
  directives: {
    "font-src": ["'self'", "external-website.com"],
    // allowing styles from any website
    "style-src": null,
  },
})
</pre>
<p><code>useDefaults</code>应用默认值。然后，以下指令会覆盖默认值。将<code>useDefaults</code>设置为<code>false</code>以从头定义CSP策略。</p>

<p><code><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy">Referrer-Policy</a></code> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy"> HTTP头</a>定义了什么数据应该在<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer"/><code><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer">Referer</a></code><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer">头</a>中作为referrer信息发送。默认情况下，<code>Referer</code>通常包含执行HTTP请求的当前URL。</p>
<p>例如，如果你点击一个第三方网站的链接，<code>Referer</code>将包含当前网页的地址。因此，第三方网站可以使用标题来跟踪您或了解您正在访问的内容。</p>
<p>如果当前地址包含私人用户信息，第三方站点将能够从<code>Referer</code>头中窃取这些信息。正因为如此，即使这个头通常用于缓存或分析，它也会带来一些隐私问题，因为它可能会泄漏敏感信息。</p>
<p>头盔默认设置为<code>no-referrer</code>。这意味着<code>Referer</code>标题将总是空的。因此，由Node.js应用程序服务的网页执行的请求将不包含任何推荐人信息。</p>
<p>如果你想改变这种限制性政策，你可以用下面的<code>refererPolicy</code>来做:</p>
<pre>// setting "Referrer-Policy" to "no-referrer"
app.use(
  helmet.referrerPolicy({
    policy: "no-referrer",
  })
)
</pre>

<p>HTTP头<code>Strict-Transport-Security</code>，<a href="https://developer.mozilla.org/en-US/docs/Glossary/HSTS">，也称为HSTS </a>，指定一个站点或资源只能通过HTTPS访问。详细地说，<code>maxAge</code>参数定义了浏览器应该记住优先选择HTTPS而不是HTTP的秒数。</p>
<p>默认情况下，头盔按如下方式设置<code>Strict-Transport-Security</code>头:</p>
<pre>max-age=15552000; includeSubDomains
</pre>
<p>请注意，<code>15552000</code>秒相当于180天，<code>includeSubDomains</code>将HSTS策略扩展到了网站的所有子域。</p>
<p>您可以使用<code>hsts</code>头盔功能配置<code>Strict-Transport-Security</code>割台，如下所示:</p>
<pre>app.use(
  helmet.hsts({
    // 60 days
    maxAge: 86400,
    // removing the "includeSubDomains" option
    includeSubDomains: false,
  })
 )
</pre>

<p><code><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options">X-Content-Type-Options</a></code> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options"> HTTP头</a>定义了必须遵循<code><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type">Content-Type</a></code> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type">头</a>中使用的<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types"> MIME类型</a>。这减轻了<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types#mime_sniffing"> MIME类型嗅探</a>，这可能导致XSS攻击和其他漏洞。</p>
<p>例如，攻击者可以在一个<code>.png</code>文件中隐藏HTML代码。浏览器可能会执行MIME类型嗅探来确定资源的内容类型。</p>
<p>由于该文件包含HTML代码，浏览器将确定它是一个HTML文件，而不是JPG图像。因此，在呈现页面时，浏览器会相应地执行攻击者的代码。</p>
<p>默认情况下，头盔将<code>X-Content-Type-Options</code>设置为<code>nosniff</code>。这将禁用并阻止MIME类型嗅探。</p>
<p>注意<code>helmet()</code>中包含的<code>noSniff()</code>头盔功能不接受参数。如果你想禁用这种行为，违背推荐的安全策略，你可以用下面的方法阻止头盔导入<code>nosniff()</code>:</p>
<pre>app.use(
  // not loading the noSniff() middleware
  helmet({
    noSniff: false,
  })
)
</pre>

<p><code><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options">X-Frame-Options</a></code> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options"> HTTP响应头</a>指定是否允许浏览器在<code>&lt;frame&gt;</code>、<code>&lt;iframe&gt;</code>、<code>&lt;embed&gt;</code>和<code>&lt;object&gt;</code> HTML元素中呈现页面。</p>
<p>通过防止您站点的内容嵌入到其他站点，您可以避免点击劫持攻击。点击劫持攻击包括诱骗用户点击与他们感知或预期不同的内容。</p>
<p>默认情况下，头盔将<code>X-Frame-Options</code>设置为<code>SAMEORIGIN</code>。这允许将网页嵌入到与页面本身具有相同原点的页面上的框架中。您可以使用<code>frameguard()</code>在头盔中设置此标题，如下所示:</p>
<pre>// setting "X-Frame-Options" to "DENY"
app.use(
  helmet.frameguard({
    action: "deny",
  })
);
</pre>
<p>如果您想完全省略<code>X-Frame-Options</code>头，您可以使用以下命令禁用<code>frameguard()</code>中间件:</p>
<pre>app.use(
  // not including the frameguard() middleware
  helmet({
    frameguard: false,
  })
)
</pre>
<p>请注意，出于安全原因，不建议这样做。</p>
<h2 id="conclusion">结论</h2>
<p>在本文中，您了解了什么是Helmet.js，以及为什么它在保护Node.js应用程序时扮演着如此重要的角色。</p>
<p>正如您在这里看到的，在Express中开发的API不涉及安全HTTP头。因此，默认的Express应用程序会带来一些安全问题。</p>
<p>使用Helmet，您只需一行代码就可以为Node.js添加一个安全层，保护您的应用程序免受最常见的攻击和漏洞。</p><div class="code-block code-block-23">
<div class="blog-plug inline-plug node-plug"><h2>200只<img src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> <noscript> <img data-lazy-fallback="1" src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> </noscript>显示器出现故障，生产中网络请求缓慢</h2><p>部署基于节点的web应用程序或网站是容易的部分。确保您的节点实例继续为您的应用程序提供资源是事情变得更加困难的地方。如果您对确保对后端或第三方服务的请求成功感兴趣，</p><a href="https://lp.logrocket.com/blg/node-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer"><img src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/><noscript><img data-lazy-fallback="1" src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/></noscript></a><a href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用程序的DVR，记录下用户与你的应用程序交互时发生的一切。您可以汇总并报告有问题的网络请求，以快速了解根本原因，而不是猜测问题发生的原因。</p><p>LogRocket检测您的应用程序以记录基线性能计时，如页面加载时间、到达第一个字节的时间、慢速网络请求，还记录Redux、NgRx和Vuex操作/状态。</p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">Start monitoring for free</a><p>. </p></div>
</div>

<p class="clearfix"/>
 <p class="clearfix"/>
</article>


</div>    
</body>
</html>