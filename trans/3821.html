<html>
<head>
<title>Storybook visual regression testing with Lost Pixel and React </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>带有丢失像素和反应的故事书视觉回归测试</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/#0001-01-01">https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/#0001-01-01</a></blockquote><div><article class="article-post">
<p>测试是现代软件开发的重要部分；事实上，TDD范式是<a href="https://blog.logrocket.com/test-driven-development-methods-deno/">测试驱动开发的缩写，强调在编写哪怕一行代码之前编写测试</a>的重要性。</p>
<p>对于后端应用程序，这可能很简单；然而，测试以UI为中心的应用程序可能相当棘手。在这里，<a href="https://www.lost-pixel.com/">丢失像素</a>派上了用场；Lost Pixel是一个开源工具，它可以帮助我们识别用户界面中的每一个应用程序的退化。</p>
<p>在这篇文章中，我们将学习如何使用丢失像素来测试一些故事书组件。我们开始吧！</p>

<h2 id="what-is-lost-pixel">什么是丢失像素？</h2>
<p>根据<a href="https://github.com/lost-pixel/lost-pixel"> Lost Pixel </a> GitHub页面显示，Lost Pixel是一款开源的可视化回归测试工具。丢失像素渲染组件的实际图像；当我们对组件进行任何更改时，Lost Pixel会将原始图像与更改后的图像进行比较，从而检测回归。</p>
<p>Lost Pixel的方法与使用Jest的<a href="https://jestjs.io/docs/snapshot-testing">快照测试</a>截然不同，在Jest中，<a href="https://blog.logrocket.com/jest-testing-top-features/">整个组件以其冗长的文本格式表示</a>，然后与更改后的版本进行比较。</p>
<p>在编写的时候，Lost Pixel支持Storybook，Ladle，Next.js，Gatsby，和Remix。在这篇文章中，我们将探索使用丢失像素以及故事书组件。</p>
<h2 id="what-is-storybook">什么是故事书？</h2>
<p>故事书是一个工具，可以帮助我们<a href="https://blog.logrocket.com/using-storybook-to-develop-react-components-faster/">优化我们的React开发流程</a>。根据Storybook官方文档，Storybook是一个隔离组件的UI开发工具，使开发更快更容易。</p>
<p>我们可以把Storybook想象成一个平台，让我们彼此独立地为我们的应用程序编写构建模块。当我们最终将所有这些整合到有意义的应用程序中时，我们在行为上遇到的错误和意外会更少。此外，Storybook提供了我们所有组件的免费文档。为了更清楚地了解所有这些是如何工作的，让我们用Storybook、React和Vite构建一个动手项目。</p>
<h2 id="setting-up-storybook-react">使用React设置故事书</h2>
<h3 id="storybook-react-vite">带反应和邀请的故事书</h3>
<p>在本文中，我们将在React项目中设置Storybook。为此，我们首先需要一个基本的React项目。首先，让我们<a href="https://blog.logrocket.com/setting-up-dev-environment-react-vite-tailwind/">使用Vite </a>创建React项目:</p>
<pre class="language-bash hljs">npm create <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="93e5fae7f6d3fff2e7f6e0e7">[email protected]</a>
</pre>
<p>我们将按照屏幕上的提示用JavaScript创建一个React项目。一旦运行完成，我们就可以运行我们刚刚创建的项目，方法是进入该目录并启动dev服务器:</p>
<pre class="language-bash hljs">cd storybook-testing
npm run dev
</pre>
<p>通过在浏览器中访问相同的URL，您应该会看到在<code><a href="http://127.0.0.1:5173/" rel="nofollow">http://127.0.0.1:5173/</a></code>上运行的Vite + React主屏幕:</p>
<p><img data-attachment-id="155189" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/vite-react-homescreen-browser/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/vite-react-homescreen-browser.png" data-orig-size="730,399" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="vite-react-homescreen-browser" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/vite-react-homescreen-browser-300x164.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/vite-react-homescreen-browser.png" decoding="async" class="aligncenter wp-image-155189 size-full jetpack-lazy-image" src="../Images/a4315c30dafdb7393b59a15aa23c3079.png" alt="Vite React Homescreen Browser" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/vite-react-homescreen-browser.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/vite-react-homescreen-browser-300x164.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/vite-react-homescreen-browser.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/vite-react-homescreen-browser.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="155189" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/vite-react-homescreen-browser/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/vite-react-homescreen-browser.png" data-orig-size="730,399" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="vite-react-homescreen-browser" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/vite-react-homescreen-browser-300x164.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/vite-react-homescreen-browser.png" decoding="async" loading="lazy" class="aligncenter wp-image-155189 size-full" src="../Images/a4315c30dafdb7393b59a15aa23c3079.png" alt="Vite React Homescreen Browser" srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/vite-react-homescreen-browser.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/vite-react-homescreen-browser-300x164.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/vite-react-homescreen-browser.png"/></noscript>
<h3 id="storybook-setup">故事书设置</h3>
<p>现在，我们将通过运行以下代码在这个repo中设置Storybook:</p>
<pre class="language-bash hljs">npx storybook init
</pre>
<p>上面的命令将添加必要的文件，并对<code>package.json</code>进行必要的修改，以便Storybook能够正常工作。如果出现如下错误，选择<strong> yes </strong>在repo中创建一个新的<code>.npmrc</code>文件:</p>
<p><img data-attachment-id="155191" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/error-install-npm-rc-package/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/error-install-npm-rc-package.png" data-orig-size="730,174" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="error-install-npm-rc-package" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/error-install-npm-rc-package-300x72.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/error-install-npm-rc-package.png" decoding="async" class="aligncenter wp-image-155191 size-full jetpack-lazy-image" src="../Images/bc6711aa15d8c19c7fd87fd5c273d14c.png" alt="Error Install Npm Rc Package" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/error-install-npm-rc-package.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/error-install-npm-rc-package-300x72.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/error-install-npm-rc-package.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/error-install-npm-rc-package.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="155191" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/error-install-npm-rc-package/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/error-install-npm-rc-package.png" data-orig-size="730,174" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="error-install-npm-rc-package" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/error-install-npm-rc-package-300x72.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/error-install-npm-rc-package.png" decoding="async" loading="lazy" class="aligncenter wp-image-155191 size-full" src="../Images/bc6711aa15d8c19c7fd87fd5c273d14c.png" alt="Error Install Npm Rc Package" srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/error-install-npm-rc-package.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/error-install-npm-rc-package-300x72.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/error-install-npm-rc-package.png"/></noscript>
<p>接下来，我们可以使用下面的命令运行Storybook:</p>
<pre class="language-bash hljs">npm run storybook
</pre>
<p>上面的命令将在<code><a href="http://localhost:6006/" rel="nofollow">http://localhost:6006/</a></code>上打开故事书主页，如下图所示:</p>
<p><img data-attachment-id="155193" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/storybook-homepage-view/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-homepage-view.png" data-orig-size="730,412" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="storybook-homepage-view" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-homepage-view-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-homepage-view.png" decoding="async" class="aligncenter wp-image-155193 size-full jetpack-lazy-image" src="../Images/0ddc42e5e614b3977ca489c89dfdbcd3.png" alt="Storybook Homepage View" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-homepage-view.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-homepage-view-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-homepage-view.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-homepage-view.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="155193" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/storybook-homepage-view/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-homepage-view.png" data-orig-size="730,412" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="storybook-homepage-view" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-homepage-view-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-homepage-view.png" decoding="async" loading="lazy" class="aligncenter wp-image-155193 size-full" src="../Images/0ddc42e5e614b3977ca489c89dfdbcd3.png" alt="Storybook Homepage View" srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-homepage-view.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-homepage-view-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-homepage-view.png"/></noscript>
<p>请注意，Storybook已经创建了几个<code>button</code>组件，我们可以使用UI来探索这些组件:</p>
<p><img data-attachment-id="155196" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/storybook-button-component-example-gif/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-button-component-example-gif.gif" data-orig-size="730,403" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="storybook-button-component-example-gif" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-button-component-example-gif-300x166.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-button-component-example-gif.gif" decoding="async" class="aligncenter wp-image-155196 size-full jetpack-lazy-image" src="../Images/334e72a997ff80c108466cd3b9cabb44.png" alt="Storybook Button Component Example Gif" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-button-component-example-gif.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-button-component-example-gif.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="155196" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/storybook-button-component-example-gif/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-button-component-example-gif.gif" data-orig-size="730,403" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="storybook-button-component-example-gif" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-button-component-example-gif-300x166.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-button-component-example-gif.gif" decoding="async" loading="lazy" class="aligncenter wp-image-155196 size-full" src="../Images/334e72a997ff80c108466cd3b9cabb44.png" alt="Storybook Button Component Example Gif" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-button-component-example-gif.gif"/></noscript>
<p>我们将使用Lost Pixel对这些预定义的按钮进行回归测试。</p>
<h3 id="repo-setup">回购设置</h3>
<p>通过这些更改，我们可以将代码推送到一个新的GitHub repo，如下所示:</p>
<pre class="language-bash hljs">git init
git add --all
git commit -m 'first commit'
git remote add origin &lt;repo_origin_url&gt;
git push -u origin main
</pre>
<p>既然repo已经准备好了，我们将添加丢失的像素代码。</p>
<h3 id="lost-pixel-setup">丢失像素设置</h3>
<p>设置好UI后，我们将把丢失的像素引入到同一个存储库中。首先，我们使用下面的命令安装丢失的像素:</p>
<pre class="language-bash hljs">npm install lost-pixel
</pre>
<p>接下来，我们在Vite项目的根目录下创建一个<code>lost-pixel.config.js</code>文件:</p>
<pre class="language-javascript hljs">import { CustomProjectConfig } from 'lost-pixel';
export const config: CustomProjectConfig = {
  storybookShots: {
    storybookUrl: './storybook-static',
  },
  generateOnly: true,
  failOnDifference: true,
};
</pre>
<p>在上面的代码中，我们告诉Lost Pixel在哪里可以找到故事书组件。在我们的例子中，一旦Storybook build命令运行，Storybook组件将在<code>./storybook-static</code> URL中找到。</p>
<p>接下来，我们需要创建两个GitHub工作流。在repo的根目录下，创建一个名为<code>.github</code>的文件夹，并在其中创建另一个名为<code>workflows</code>的文件夹。我们将把下面两个文件放在<code>workflows</code>文件夹中。</p>
<h3 id="lost-pixel-update-yml"><code>lost-pixel-update.yml</code></h3>
<p><code>lost-pixel-update.yml</code>工作流将帮助Lost Pixel创建基线，它将根据基线执行回归测试。在执行测试时，Lost Pixel需要知道呈现组件的正确方式，以便确定组件是否偏离了该行为。</p>
<p><code>lost-pixel-update.yml</code>文件如下所示:</p>
<pre class="language-yml hljs">on: [workflow_dispatch]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d1b2b9b4b2babea4a591a7e3">[email protected]</a>
      - name: Setup Node.js
        uses: actions/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1665736263663b78797273566024">[email protected]</a>
        with:
          node-version: 16.x
         cache: 'npm'
      - name: Install dependencies
        run: npm ci
      - name: Build Storybook components
        run: npm run build-storybook
      - name: Run Lost Pixel container
        id: lp
      uses: lost-pixel/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e68a899592cb968f9e838aa690d4c8d7d7c8d6">[email protected]</a>
        env:
          LOST_PIXEL_MODE: update
      - name: Create Pull request
        uses: peter-evans/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0a69786f6b7e6f277a7f666627786f7b7f6f797e4a7c3e">[email protected]</a>
        if: ${{ failure() &amp;&amp; steps.lp.conclusion == 'failure' }}
        with:
          token: ${{ secrets.GH_TOKEN }}
          commit-message: update lost-pixel baselines
          delete-branch: true
          branch: "lost-pixel-baselines/${{ github.ref_name }}"
          title: "Lost Pixel updating baselines - ${{ github.ref_name }}"
          body: Automated baseline update PR - lost pixel
</pre>
<p>注意，这个GitHub操作的步骤很简单。我们创建一个Node.js容器，构建我们的Storybook组件，然后使用GitHub action store上发布的预构建动作运行Lost Pixel，<code>lost-pixel/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5c30332f28712c352439301c2a6e726d6d726c">[email protected]</a></code>。</p>
<p>此动作在<code>update</code>模式下运行丢失像素动作。但是，请注意最后一步是特殊的，创建一个包含变更组件的pull请求，以便这些组件可以与repo合并，并作为新的基线组件。我们在创建pull请求时使用<code>secrets.GH_TOKEN</code>进行认证，稍后我们将对此进行回顾。</p>
<h3 id="lost-pixel-test-yml"><code>lost-pixel-test.yml</code></h3>
<p><code>lost-pixel-test.yml</code>工作流将在每次推送到repo时被触发，从而为组件生成新的图像，并将它们与运行基线测试时生成的图像进行比较。如果两者之间有任何差异，测试将失败。<code>lost-pixel-test.yml</code>文件看起来像下面的代码:</p>
<pre class="language-yml hljs">on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ec8f84898f87839998ac9ade">[email protected]</a>
      - name: Setup Node
        uses: actions/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1f6c7a6b6a6f3271707b7a5f692d">[email protected]</a>
        with:
          node-version: 16.x
          cache: 'npm'
      - name: Install dependencies
        run: npm ci
      - name: Build Storybook
        run: npm run build-storybook
      - name: Lost Pixel
        id: lp
        uses: lost-pixel/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c2aeadb1b6efb2abbaa7ae82b4f0ecf3f3ecf2">[email protected]</a>
</pre>
<p>这个动作和上一个动作几乎一样，只是略有不同。创建PR的最后一步不见了，我们也没有在<code>update</code>模式下运行丢失像素。正如我们在<code>lost-pixel-update.yml</code>文件中注意到的，PR创建步骤要求我们提供<code>secrets.GH_TOKEN</code>。</p>
<h3 id="generate-auth-token">生成GitHub身份验证令牌</h3>
<p>查看这个<a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token#creating-a-personal-access-token-classic"> GitHub repo </a>，了解生成个人访问令牌的详细步骤。简而言之，步骤如下:</p>
<ul>
<li>访问您的<strong> GitHub </strong> <strong>个人资料设置</strong></li>
<li>点击<strong>开发者设置</strong>，然后点击<strong>个人访问令牌</strong></li>
<li>点击<strong>令牌(经典)</strong>然后<strong>生成新令牌</strong></li>
<li>选择令牌的范围为<strong>工作流</strong></li>
</ul>
<p><img data-attachment-id="155200" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/generate-new-personal-access-token-github-classic/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/generate-new-personal-access-token-github-classic.png" data-orig-size="730,344" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="generate-new-personal-access-token-github-classic" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/generate-new-personal-access-token-github-classic-300x141.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/generate-new-personal-access-token-github-classic.png" decoding="async" class="aligncenter wp-image-155200 size-full jetpack-lazy-image" src="../Images/01e830df99a5d3774ac88268ed705d53.png" alt="Generate New Personal Access Token Github Classic" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/generate-new-personal-access-token-github-classic.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/generate-new-personal-access-token-github-classic-300x141.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/generate-new-personal-access-token-github-classic.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/generate-new-personal-access-token-github-classic.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="155200" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/generate-new-personal-access-token-github-classic/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/generate-new-personal-access-token-github-classic.png" data-orig-size="730,344" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="generate-new-personal-access-token-github-classic" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/generate-new-personal-access-token-github-classic-300x141.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/generate-new-personal-access-token-github-classic.png" decoding="async" loading="lazy" class="aligncenter wp-image-155200 size-full" src="../Images/01e830df99a5d3774ac88268ed705d53.png" alt="Generate New Personal Access Token Github Classic" srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/generate-new-personal-access-token-github-classic.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/generate-new-personal-access-token-github-classic-300x141.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/generate-new-personal-access-token-github-classic.png"/></noscript>
<p>生成令牌后，将其复制到剪贴板。我们需要将它作为秘密添加到回购协议中:</p>
<ul>
<li>在存储库页面上，点击<strong>设置</strong></li>
<li>点击<strong>秘密</strong>，然后点击<strong>动作</strong></li>
<li>点击<strong>新建存储库密码</strong></li>
</ul>
<p><img data-attachment-id="155202" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/add-github-token-secret/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/add-github-token-secret.png" data-orig-size="730,386" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="add-github-token-secret" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/add-github-token-secret-300x159.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/add-github-token-secret.png" decoding="async" class="aligncenter wp-image-155202 size-full jetpack-lazy-image" src="../Images/876df68ff22caccad8e47adeb996bb0e.png" alt="Add Github Token Secret" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/add-github-token-secret.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/add-github-token-secret-300x159.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/add-github-token-secret.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/add-github-token-secret.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="155202" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/add-github-token-secret/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/add-github-token-secret.png" data-orig-size="730,386" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="add-github-token-secret" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/add-github-token-secret-300x159.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/add-github-token-secret.png" decoding="async" loading="lazy" class="aligncenter wp-image-155202 size-full" src="../Images/876df68ff22caccad8e47adeb996bb0e.png" alt="Add Github Token Secret" srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/add-github-token-secret.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/add-github-token-secret-300x159.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/add-github-token-secret.png"/></noscript>
<p>将秘密命名为<code>GH_TOKEN</code>，粘贴秘密，然后点击<strong>添加秘密</strong>。这将增加回购的秘密，以便公关创建步骤顺利进行。</p>
<h3 id="generating-baselines">生成基线</h3>
<p>设置完成后，我们现在可以运行操作来为我们所有的故事书组件生成基线。添加两个新创建的<code>.yml</code>文件，创建一个commit，并将其推送到远程repo。我们可以看到，测试在代码推送时立即被触发，但是它失败了，因为没有基线:</p>
<p><img data-attachment-id="155205" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/create-baselines-storybook-components/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/create-baselines-storybook-components.png" data-orig-size="730,379" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="create-baselines-storybook-components" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/create-baselines-storybook-components-300x156.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/create-baselines-storybook-components.png" decoding="async" class="aligncenter wp-image-155205 size-full jetpack-lazy-image" src="../Images/d35974836813cd525cc12dae64af4596.png" alt="Create Baselines Storybook Components" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/create-baselines-storybook-components.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/create-baselines-storybook-components-300x156.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/create-baselines-storybook-components.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/create-baselines-storybook-components.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="155205" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/create-baselines-storybook-components/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/create-baselines-storybook-components.png" data-orig-size="730,379" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="create-baselines-storybook-components" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/create-baselines-storybook-components-300x156.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/create-baselines-storybook-components.png" decoding="async" loading="lazy" class="aligncenter wp-image-155205 size-full" src="../Images/d35974836813cd525cc12dae64af4596.png" alt="Create Baselines Storybook Components" srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/create-baselines-storybook-components.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/create-baselines-storybook-components-300x156.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/create-baselines-storybook-components.png"/></noscript>
<p>让我们运行工作流来生成基线。访问GitHub repo的<strong>动作</strong>选项卡，然后选择<code>lost-pixel-update.yml</code>工作流。点击<strong>运行工作流程</strong>:</p>
<p><img data-attachment-id="155207" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/run-lost-pixel-storybook-github-action/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/run-lost-pixel-storybook-github-action.png" data-orig-size="730,333" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="run-lost-pixel-storybook-github-action" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/run-lost-pixel-storybook-github-action-300x137.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/run-lost-pixel-storybook-github-action.png" decoding="async" class="aligncenter wp-image-155207 size-full jetpack-lazy-image" src="../Images/3a9af97a1d8dafecbca17eb0a98ae8c2.png" alt="Run Lost Pixel Storybook Github Action" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/run-lost-pixel-storybook-github-action.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/run-lost-pixel-storybook-github-action-300x137.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/run-lost-pixel-storybook-github-action.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/run-lost-pixel-storybook-github-action.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="155207" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/run-lost-pixel-storybook-github-action/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/run-lost-pixel-storybook-github-action.png" data-orig-size="730,333" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="run-lost-pixel-storybook-github-action" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/run-lost-pixel-storybook-github-action-300x137.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/run-lost-pixel-storybook-github-action.png" decoding="async" loading="lazy" class="aligncenter wp-image-155207 size-full" src="../Images/3a9af97a1d8dafecbca17eb0a98ae8c2.png" alt="Run Lost Pixel Storybook Github Action" srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/run-lost-pixel-storybook-github-action.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/run-lost-pixel-storybook-github-action-300x137.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/run-lost-pixel-storybook-github-action.png"/></noscript>
<p>完成前面的所有步骤后，工作流顺利运行，结果创建了一个拉取请求:</p>
<p><img data-attachment-id="155209" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/storybook-lost-pixel-workflow-run-success/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-lost-pixel-workflow-run-success.png" data-orig-size="730,438" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="storybook-lost-pixel-workflow-run-success" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-lost-pixel-workflow-run-success-300x180.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-lost-pixel-workflow-run-success.png" decoding="async" class="aligncenter wp-image-155209 size-full jetpack-lazy-image" src="../Images/53f7db58ce070fc0a9aa524b6c392e05.png" alt="Storybook Lost Pixel Workflow Run Success" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-lost-pixel-workflow-run-success.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-lost-pixel-workflow-run-success-300x180.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-lost-pixel-workflow-run-success.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-lost-pixel-workflow-run-success.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="155209" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/storybook-lost-pixel-workflow-run-success/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-lost-pixel-workflow-run-success.png" data-orig-size="730,438" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="storybook-lost-pixel-workflow-run-success" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-lost-pixel-workflow-run-success-300x180.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-lost-pixel-workflow-run-success.png" decoding="async" loading="lazy" class="aligncenter wp-image-155209 size-full" src="../Images/53f7db58ce070fc0a9aa524b6c392e05.png" alt="Storybook Lost Pixel Workflow Run Success" srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-lost-pixel-workflow-run-success.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-lost-pixel-workflow-run-success-300x180.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/storybook-lost-pixel-workflow-run-success.png"/></noscript>
<p>合并拉取请求，以便对应于基线的<code>.png</code>文件在repo中被合并。</p>
<h3 id="testing-visual-regressions">测试视觉回归</h3>
<p>配置好基线后，让我们在故事书组件中引入一些可视化回归。访问故事<code>Button.stories.jsx</code>文件，将主按钮的标签改为<strong>测试按钮</strong>:</p>
<pre class="language-javascript hljs">export const Primary = Template.bind({});
// More on args: https://storybook.js.org/docs/react/writing-stories/args
Primary.args = {
  primary: true,
  label: 'Test Button',
};
</pre>
<p>保存文件，提交并推送到远程:</p>
<pre class="language-javascript hljs">git commit -m 'testing regression'
git pull --rebase
git push
</pre>
<p>您应该看到<code>lost-pixel-test.yml</code>工作流被立即触发。它运行了，成功地指出在组件的<code>primary button</code>版本中有一个回归:</p>
<p><img data-attachment-id="155211" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/lost-pixel-test-yml-workflow-triggered/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/lost-pixel-test-yml-workflow-triggered.png" data-orig-size="730,299" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="lost-pixel-test-yml-workflow-triggered" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/lost-pixel-test-yml-workflow-triggered-300x123.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/lost-pixel-test-yml-workflow-triggered.png" decoding="async" class="aligncenter wp-image-155211 size-full jetpack-lazy-image" src="../Images/3364090a301bb4e414b188acc4cb4644.png" alt="Lost Pixel Test YML Workflow Triggered" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/lost-pixel-test-yml-workflow-triggered.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/lost-pixel-test-yml-workflow-triggered-300x123.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/lost-pixel-test-yml-workflow-triggered.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/lost-pixel-test-yml-workflow-triggered.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="155211" data-permalink="https://blog.logrocket.com/storybook-visual-regression-testing-lost-pixel-react/attachment/lost-pixel-test-yml-workflow-triggered/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/lost-pixel-test-yml-workflow-triggered.png" data-orig-size="730,299" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="lost-pixel-test-yml-workflow-triggered" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/lost-pixel-test-yml-workflow-triggered-300x123.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/lost-pixel-test-yml-workflow-triggered.png" decoding="async" loading="lazy" class="aligncenter wp-image-155211 size-full" src="../Images/3364090a301bb4e414b188acc4cb4644.png" alt="Lost Pixel Test YML Workflow Triggered" srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/lost-pixel-test-yml-workflow-triggered.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/lost-pixel-test-yml-workflow-triggered-300x123.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/lost-pixel-test-yml-workflow-triggered.png"/></noscript>
<p>如果这是一个预期的回归，我们可以像以前一样触发<code>lost-pixel-update.yml</code>工作流，基线将被更新。</p>
<h2 id="conclusion">结论</h2>
<p>Lost Pixel为我们提供了一种替代方法来执行UI回归测试，这与快照测试的标准实践有很大不同。如果您的项目使用了大量的故事书组件，并且您不担心额外的<code>.png</code>图像被推送到存储库，您可以探索项目中丢失的像素来检测UI退化。</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720"><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener"> LogRocket </a>:全面了解您的生产React应用</h2><p>调试React应用程序可能很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪Redux状态、自动显示JavaScript错误以及跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" vwo-el-id="19356441070">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<p vwo-el-id="28675660440" class="">LogRocket 结合了会话回放、产品分析和错误跟踪，使软件团队能够创建理想的web和移动产品体验。这对你来说意味着什么？</p>
<p>LogRocket不是猜测错误发生的原因，也不是要求用户提供截图和日志转储，而是让您回放问题，就像它们发生在您自己的浏览器中一样，以快速了解哪里出错了。</p>
<p>不再有嘈杂的警报。智能错误跟踪允许您对问题进行分类，然后从中学习。获得有影响的用户问题的通知，而不是误报。警报越少，有用的信号越多。</p>
<p vwo-el-id="28675660750">LogRocket Redux中间件包为您的用户会话增加了一层额外的可见性。LogRocket记录Redux存储中的所有操作和状态。</p>
<p vwo-el-id="28675661060">现代化您调试React应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">开始免费监控</a>。</p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>