<html>
<head>
<title>Improve custom Hook debugging with useDebugValue - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用 useDebugValue - LogRocket 博客改进定制钩子调试</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/improve-custom-hook-debugging-with-usedebugvalue/#0001-01-01">https://blog.logrocket.com/improve-custom-hook-debugging-with-usedebugvalue/#0001-01-01</a></blockquote><div><article class="article-post">
<p>没有太多开发人员知道<a href="https://reactjs.org/docs/hooks-reference.html#usedebugvalue" target="_blank" rel="noopener"> <code>useDebugValue</code>钩子</a>，尽管它在调试定制钩子时提供了更好的调试体验。</p>
<p><code>useDebugValue</code>是一个简单的内置钩子，它提供了关于<a href="https://blog.logrocket.com/debug-react-applications-with-the-new-react-devtools/" target="_blank" rel="noopener"> React DevTools </a>中定制钩子内部逻辑的更多信息。它允许您在自定义挂钩旁边显示附加的、有用的信息，并带有可选的格式。</p>
<h2><code>useDebugValue</code>和 React DevTools</h2>
<p><code>useDebugValue</code>在 React DevTools 的<a href="https://github.com/facebook/react/tree/main/packages/react-devtools#inspecting-component-instances" target="_blank" rel="noopener">组件检查器</a>中扩展了定制钩子数据的可视化。你可以将<code>React DevTools</code>安装为<a href="https://www.npmjs.com/package/react-devtools" target="_blank" rel="noopener">独立应用</a>或<a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi" target="_blank" rel="noopener">浏览器扩展</a>。</p>
<p>下一个截图显示了 React DevTools Chrome 扩展的<strong>组件</strong>选项卡。</p>
<p><img data-attachment-id="70241" data-permalink="https://blog.logrocket.com/improve-custom-hook-debugging-with-usedebugvalue/components-tab-react-devtools-chrome-extension/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/components-tab-react-devtools-chrome-extension.png" data-orig-size="730,589" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="components-tab-react-devtools-chrome-extension" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/components-tab-react-devtools-chrome-extension-300x242.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/components-tab-react-devtools-chrome-extension.png" decoding="async" class="aligncenter size-full wp-image-70241 jetpack-lazy-image" src="../Images/5944749f83824d03dcd63aa8ba86b365.png" alt="The Components tab of the React DevTools Chrome extension" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/components-tab-react-devtools-chrome-extension.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/10/components-tab-react-devtools-chrome-extension-300x242.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/components-tab-react-devtools-chrome-extension.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/components-tab-react-devtools-chrome-extension.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="70241" data-permalink="https://blog.logrocket.com/improve-custom-hook-debugging-with-usedebugvalue/components-tab-react-devtools-chrome-extension/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/components-tab-react-devtools-chrome-extension.png" data-orig-size="730,589" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="components-tab-react-devtools-chrome-extension" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/components-tab-react-devtools-chrome-extension-300x242.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/components-tab-react-devtools-chrome-extension.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-70241" src="../Images/5944749f83824d03dcd63aa8ba86b365.png" alt="The Components tab of the React DevTools Chrome extension" srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/components-tab-react-devtools-chrome-extension.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/10/components-tab-react-devtools-chrome-extension-300x242.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/components-tab-react-devtools-chrome-extension.png"/></noscript>
<p>让我们看看如何利用<code>useDebugValue</code>钩子。考虑这个相当简单的定制取钩子。</p>
<pre class="language-javascript hljs">import { useEffect, useState } from "react";

export const useFetch = (url) =&gt; {
  const [response, setResponse] = useState([]);
  const [error, setError] = useState(null);
  useEffect(() =&gt; {
    async function fetchFiles() {
      try {
        const response = await fetch(url);
        const json = await response.json();
        setResponse(json);
      } catch (error) {
        setError(error);
      }
    }
    fetchFiles();
  }, [setError, setResponse, url]);
  return [response, error];
};
</pre>
<p>这就是钩子数据的显示方式。</p>
<p><img data-attachment-id="70243" data-permalink="https://blog.logrocket.com/improve-custom-hook-debugging-with-usedebugvalue/debug-information-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-information-output.png" data-orig-size="730,577" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="debug-information-output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-information-output-300x237.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-information-output.png" decoding="async" class="aligncenter size-full wp-image-70243 jetpack-lazy-image" src="../Images/969a8fda5971ed137b62356e17d43013.png" alt="The debug information output" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-information-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/10/debug-information-output-300x237.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-information-output.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-information-output.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="70243" data-permalink="https://blog.logrocket.com/improve-custom-hook-debugging-with-usedebugvalue/debug-information-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-information-output.png" data-orig-size="730,577" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="debug-information-output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-information-output-300x237.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-information-output.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-70243" src="../Images/969a8fda5971ed137b62356e17d43013.png" alt="The debug information output" srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-information-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/10/debug-information-output-300x237.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-information-output.png"/></noscript>
<p>调试信息仅限于显示我们的钩子内部使用的其他内置 React 钩子的信息(在本例中是<code>useState</code>和<code>useEffect</code>)。此外，这些信息很难阅读，因为没有描述性的标签——您必须计算输出中的每一行，以便知道哪些条目映射对应于代码库内部调用的钩子。</p>
<p>在内置的<code>useDebugValue</code>钩子的帮助下，我们可以通过为自定义钩子向 React DevTools 输出添加额外的条目来改善这种情况。</p>
<pre class="language-javascript hljs">import { useEffect, useDebugValue, useState } from "react";

export const useFetch = (url) =&gt; {
  useDebugValue(url);
  const [response, setResponse] = useState([]);
  const clown = "🤡";
  useDebugValue(`crazy ${clown}`);
  const [error, setError] = useState(null);
  const [httpResponse, setHttpResponse] = useState();
  useDebugValue(
    httpResponse ? "status code " + httpResponse.status : "no response"
  );
  useDebugValue(error, (e) =&gt;
    e ? `fetch failed due to ${e.message}` : "fetch successful"
  );
  useEffect(() =&gt; {
    async function fetchFiles() {
      try {
        const response = await fetch(url);
        setHttpResponse(response);
        const json = await response.json();
        setResponse(json);
      } catch (error) {
        setError(error);
      }
    }
    fetchFiles();
  }, [setError, setResponse, url]);
  useDebugValue(response, (mp3s) =&gt;
    mp3s.length &gt; 0 ? mp3s.map((mp3) =&gt; mp3.label) : "no mp3s loaded"
  );
  return [response, error];
}
</pre>
<p>下一个屏幕截图显示了出现网络错误时的输出。</p>
<p><img data-attachment-id="70245" data-permalink="https://blog.logrocket.com/improve-custom-hook-debugging-with-usedebugvalue/debug-output-fetch-error-case/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-fetch-error-case.png" data-orig-size="730,356" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="debug-output-fetch-error-case" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-fetch-error-case-300x146.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-fetch-error-case.png" decoding="async" class="aligncenter size-full wp-image-70245 jetpack-lazy-image" src="../Images/7e07bae4757f00652e09b33234e24645.png" alt="Debug output for the fetch error case" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-fetch-error-case.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-fetch-error-case-300x146.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-fetch-error-case.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-fetch-error-case.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="70245" data-permalink="https://blog.logrocket.com/improve-custom-hook-debugging-with-usedebugvalue/debug-output-fetch-error-case/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-fetch-error-case.png" data-orig-size="730,356" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="debug-output-fetch-error-case" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-fetch-error-case-300x146.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-fetch-error-case.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-70245" src="../Images/7e07bae4757f00652e09b33234e24645.png" alt="Debug output for the fetch error case" srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-fetch-error-case.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-fetch-error-case-300x146.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-fetch-error-case.png"/></noscript>
<p>展开的<code>DebugValue</code>条目按照源代码中出现的顺序列出了<code>useDebugValue</code>调用的输出。不同的条目显示了如何利用这个钩子。小丑条目并没有那么严肃，但是它表明您可以注销任何您想要的东西——数字、字符串和对象，而不仅仅是自定义钩子的函数参数或状态变量。</p>
<p>第三到第五项演示了<a href="https://reactjs.org/docs/hooks-reference.html#defer-formatting-debug-values" target="_blank" rel="noopener">可选的第二个参数</a>对<code>useDebugValue</code>钩子的使用。第二个参数是一个回调函数，它接收第一个参数中指定的数据，并返回一个格式化的显示值。</p>
<p>这是为了在计算要显示的值的开销很大的情况下推迟格式化。如果您使用第二个参数，当您在 React DevTools 中检查自定义钩子时，这个函数首先被执行。</p>
<h2><code>useDebugValue</code>的局限性</h2>
<p>当然，由于钩子的<a href="https://reactjs.org/docs/hooks-rules.html" target="_blank" rel="noopener">规则，您不能使用<code>useDebugValue</code>注销条件和嵌套数据。</a></p>
<p>这就是为什么我在上面的例子中使用了一个额外的状态变量<code>httpResponse</code>，来访问响应的状态代码。提醒一下，这是由于钩子的规则，它只允许钩子用在功能性 React 组件或定制钩子的顶层。</p>
<p>根据<a href="https://reactjs.org/docs/hooks-reference.html#defer-formatting-debug-values" target="_blank" rel="noopener">官方文档</a>，<code>useDebugValue</code>只能在自定义挂钩的情况下使用。如果您在 React 功能组件的顶层放置一个钩子调用，React DevTools 中将不会出现日志输出。</p>
<pre class="language-javascript hljs">const AwesomeComponent = () =&gt; {
  useDebugValue("hey there"); // this does not work
  return &lt;div&gt;what's up?&lt;/div&gt;;
};
</pre>
<h2>为<code>useState</code>调试改进 React DevTools 输出</h2>
<p>本节演示了如何使用<code>useDebugValue</code>钩子来改进关于<code>useState</code>钩子的调试信息。</p>
<p>当您在一个组件或定制钩子中使用几个<code>useState</code>钩子时，您可能熟悉 React DevTools 的可跟踪性问题:React DevTools 不显示状态条目的描述性标签。</p>
<p>下面是使用<code>useFetch</code>钩子的输出。</p>
<figure id="attachment_70247" aria-describedby="caption-attachment-70247" class="wp-caption aligncenter"><img data-attachment-id="70247" data-permalink="https://blog.logrocket.com/improve-custom-hook-debugging-with-usedebugvalue/debug-output-with-usefetch-hook/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-with-usefetch-hook.png" data-orig-size="730,193" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="debug-output-with-usefetch-hook" data-image-description="" data-image-caption="&lt;p&gt;React DevTools does not show a descriptive label for state entries&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-with-usefetch-hook-300x79.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-with-usefetch-hook.png" decoding="async" class="size-full wp-image-70247 jetpack-lazy-image" src="../Images/87492562b6b1bc40e4684b58f285be59.png" alt="Debug output for with the useFetch Hook." data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-with-usefetch-hook.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-with-usefetch-hook-300x79.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-with-usefetch-hook.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-with-usefetch-hook.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="70247" data-permalink="https://blog.logrocket.com/improve-custom-hook-debugging-with-usedebugvalue/debug-output-with-usefetch-hook/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-with-usefetch-hook.png" data-orig-size="730,193" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="debug-output-with-usefetch-hook" data-image-description="" data-image-caption="&lt;p&gt;React DevTools does not show a descriptive label for state entries&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-with-usefetch-hook-300x79.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-with-usefetch-hook.png" decoding="async" loading="lazy" class="size-full wp-image-70247" src="../Images/87492562b6b1bc40e4684b58f285be59.png" alt="Debug output for with the useFetch Hook." srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-with-usefetch-hook.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-with-usefetch-hook-300x79.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/debug-output-with-usefetch-hook.png"/></noscript><figcaption id="caption-attachment-70247" class="wp-caption-text">React DevTools does not show a descriptive label for state entries</figcaption></figure>
<p>假设您选择了一个具有多个布尔状态变量的组件。从长远来看，总是需要注意它们的顺序，以便将状态条目与源代码中相应的<code>useState</code>调用相关联，这将是令人疲惫的。</p>
<p>这里值得注意的是，使用多个“原子”状态变量是更好的方法，而不是用单个对象收集每个状态“工件”。由于<code>useState</code>钩子不提供类似于<a href="https://reactjs.org/docs/react-component.html#setstate"> setState </a>方法的东西，所以使用“基于类的单一状态对象模式”不是一个好主意，因为你必须小心地完全克隆复杂的状态对象，并且只更新相关的部分。</p>
<p>让我们看看如何利用<code>useDebugState</code>来解决这个问题。首先，我们需要创建另一个自定义挂钩。</p>
<pre class="language-javascript hljs">// useComponentState.js
import { useState, useDebugValue } from "react";

export function useComponentState(initialValue, name) {
  const [value, setValue] = useState(initialValue);
  useDebugValue(`${name}: ${value}`);
  return [value, setValue];
}
</pre>
<p>让我们替换我们的<code>useFetch</code>钩子中的<code>useState</code>调用。</p>
<pre class="language-javascript hljs">import { useEffect, useDebugValue } from "react";

import { useComponentState } from "./useComponentState";
const useFetch = (url) =&gt; {
  useDebugValue(url, (url) =&gt; `url: ${url}`);
  const [response, setResponse] = useComponentState([], "fetched mp3s");
  const [error, setError] = useComponentState(null, "fetch error");
  useEffect(() =&gt; {
    async function fetchFiles() {
      try {
        const response = await fetch(url);
        const json = await response.json();
        setResponse(json);
      } catch (error) {
        setError(error);
      }
    }
    fetchFiles();
  }, [setError, setResponse, url]);
  useDebugValue(response, (mp3s) =&gt; mp3s.map((mp3) =&gt; mp3.label));
  return [response, error];
};
</pre>
<p>现在看起来是这样的。更容易找出你的状态变量显示在哪里。</p>
<p><img data-attachment-id="70252" data-permalink="https://blog.logrocket.com/improve-custom-hook-debugging-with-usedebugvalue/react-devtools-render-labels-state-values/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/react-devtools-render-labels-state-values.png" data-orig-size="730,244" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="react-devtools-render-labels-state-values" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/react-devtools-render-labels-state-values-300x100.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/react-devtools-render-labels-state-values.png" decoding="async" class="aligncenter size-full wp-image-70252 jetpack-lazy-image" src="../Images/5440ea0bdb3d5c6d15767b5a33bf1c69.png" alt="React DevTools now renders labels with state values" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/react-devtools-render-labels-state-values.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/10/react-devtools-render-labels-state-values-300x100.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-devtools-render-labels-state-values.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-devtools-render-labels-state-values.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="70252" data-permalink="https://blog.logrocket.com/improve-custom-hook-debugging-with-usedebugvalue/react-devtools-render-labels-state-values/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/react-devtools-render-labels-state-values.png" data-orig-size="730,244" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="react-devtools-render-labels-state-values" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/react-devtools-render-labels-state-values-300x100.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/react-devtools-render-labels-state-values.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-70252" src="../Images/5440ea0bdb3d5c6d15767b5a33bf1c69.png" alt="React DevTools now renders labels with state values" srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/react-devtools-render-labels-state-values.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/10/react-devtools-render-labels-state-values-300x100.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-devtools-render-labels-state-values.png"/></noscript>
<h2>凡事都有代价</h2>
<p>在产品代码中大量使用<code>useDebugValue</code>可能会对应用程序的性能产生负面影响。我不认为把它留在您的产品代码中是一个好主意，但是正如官方文档所说，把它留在共享库中的定制钩子的代码中可能是好的。</p>
<p>不幸的是，在本文发表时，还没有办法基于环境变量有条件地呈现<code>useDebugValue</code>,因为钩子的规则阻止了条件代码中的钩子调用。</p>
<p>对我来说，<code>useDebugValue</code>是我工具箱中的另一个工具，我只在开发定制钩子时使用，并在将钩子推到 Git 库之前删除。它当然构成了对旧的<code>console.log</code>调用和调试断点的替代。</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用 LogRocket 消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款 React analytics 解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket 告诉您 React 应用程序中实际影响用户的最具影响力的 bug 和 UX 问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS 异常、前端性能指标和用户交互。然后，LogRocket 使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的 React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试 LogRocket】。</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>