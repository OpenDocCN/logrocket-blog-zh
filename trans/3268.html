<html>
<head>
<title>How to create a global custom plugin in Nuxt.js - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在Nuxt.js - LogRocket博客中创建全局自定义插件</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/create-global-custom-plugin-nuxt-js/#0001-01-01">https://blog.logrocket.com/create-global-custom-plugin-nuxt-js/#0001-01-01</a></blockquote><div><article class="article-post">
<p>Nuxt.js和Vue一样支持插件，插件可以有三种类型:定制插件、Vue插件、外部包和模块。虽然<a href="https://nuxtjs.org/docs/directory-structure/plugins/"> Nuxt文档</a>详细讨论了后两个，但它们只是简要解释了如何在Nuxt应用程序中构建和使用定制插件。</p>
<p>在一些情况下，全局定制插件可以派上用场。例如，让我们想象一下，你找不到你正试图实现的某个特性的开源插件，或者你对你找到的不完全满意。或者，也许你觉得有点创意，你有一些空闲时间。</p>
<p>在本教程中，我们将介绍两种不同的选择来构建我们自己的自定义插件，同时使用Vue和JavaScript。例如，我们的自定义插件将在你的Nuxt应用程序的控制台中显示我的生日，但你可以根据你的项目需求进行个性化设置。我们开始吧！</p>

<h2 id="building-component">构建组件</h2>
<p>第一步是构建Vue组件。对于本文，我们将使用一个基本的toast组件来显示简单的成功和错误消息。我已经为本文构建了一个，稍后我们将详细讨论它:</p>
<pre class="language-javascript hljs">&lt;template&gt;
  &lt;div class="toast-element"&gt;
    &lt;div :class="['toast-container', { success: state === 'success', error: state === 'error' }]"&gt;
      &lt;div class="icon"&gt;
        &lt;svg
          v-if="state === 'success'"
          width="8"
          height="7"
          viewBox="0 0 8 7"
          fill="none"
          
        &gt;
          &lt;path d="M6.96304 0.962891L2.88896 5.37647L1.03711 3.3703" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" /&gt;
        &lt;/svg&gt;
        &lt;svg
          v-else
          width="3"
          height="10"
          viewBox="0 0 3 10"
          fill="none"
          
        &gt;
          &lt;path d="M1 1.6665V4.99984" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /&gt;
          &lt;path d="M1 8.3335H1.00833" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /&gt;
        &lt;/svg&gt;
      &lt;/div&gt;
      &lt;p&gt;
        {{ message }}
      &lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  data () {
    return {
      toastIsVisible: false,
      message: '',
      state: ''
    }
  },
  mounted () {
    this.$store.subscribe((mutation, state) =&gt; {
      if (mutation.type === 'toast/showToast') {
        this.message = state.toast.content
        this.state = state.toast.state
        this.toastIsVisible = true
        document.querySelector('.toast-element').classList.add('enter')
        setTimeout(() =&gt; {
          if (this.toastIsVisible) {
            this.removeToast()
          }
        }, 3000)
      }
    })
  },
  methods: {
    removeToast () {
      document.querySelector('.toast-element').classList.replace('enter', 'leave')
      setTimeout(() =&gt; {
        this.toastIsVisible = false
      }, 240)
    }
  }
}
&lt;/script&gt;

&lt;style scoped&gt;
.toast-element {
  position: fixed;
  top: -90px;
  left: 0;
  width: 100%;
  height: max-content;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 7;
  opacity: 0;
  transition: all 240ms cubic-bezier(0, 0.0, 0.2, 1) 0s;
}
.enter {
  top: 20px;
  opacity: 1;
}
.leave {
  top: 20px;
  transform: scale(0.9);
}
.toast-container {
  width: fit-content;
  border: 1px solid transparent;
  border-radius: 5px;
  padding: 0.9375rem 1.875rem;
  display: grid;
  grid-template-columns: repeat(2, max-content);
  column-gap: 0.9375rem;
  align-items: center;
}
.success {
  border-color: #037F10;
  background-color: #F4FFF6;
}
.error {
  border-color: #FF2525;
  background-color: #FFF4F4;
}
.icon {
  border-radius: 50%;
  display: flex;
}
.success .icon {
  padding: 6px;
  background-color: #037F10;
}
.error .icon {
  padding: 5px 8px 5px 9px;
  background-color: #FF2525;
}
p {
  width: max-content;
  font-size: 1.0625rem;
  font-weight: 400;
}
.success p {
  color: #037F10;
}
.error p {
  color: #FF2525;
}
&lt;/style&gt;
</pre>
<p>toast组件创建如下所示的两个按钮:</p>
<figure id="attachment_128252" aria-describedby="caption-attachment-128252" class="wp-caption aligncenter"><img data-attachment-id="128252" data-permalink="https://blog.logrocket.com/create-global-custom-plugin-nuxt-js/attachment/toast-error/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/toast-error.png" data-orig-size="592,120" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="toast-error" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/toast-error-300x61.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/toast-error.png" decoding="async" class="wp-image-128252 size-full jetpack-lazy-image" src="../Images/49e573061d27448e07dd8ae9be99a9db.png" alt="Toast Error" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/toast-error.png 592w, https://blog.logrocket.com/wp-content/uploads/2022/08/toast-error-300x61.png 300w" data-lazy-sizes="(max-width: 592px) 100vw, 592px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/toast-error.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/toast-error.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="128252" data-permalink="https://blog.logrocket.com/create-global-custom-plugin-nuxt-js/attachment/toast-error/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/toast-error.png" data-orig-size="592,120" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="toast-error" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/toast-error-300x61.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/toast-error.png" decoding="async" loading="lazy" class="wp-image-128252 size-full" src="../Images/49e573061d27448e07dd8ae9be99a9db.png" alt="Toast Error" srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/toast-error.png 592w, https://blog.logrocket.com/wp-content/uploads/2022/08/toast-error-300x61.png 300w" sizes="(max-width: 592px) 100vw, 592px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/toast-error.png"/></noscript><figcaption id="caption-attachment-128252" class="wp-caption-text">Toast component error message</figcaption></figure>
<figure id="attachment_128257" aria-describedby="caption-attachment-128257" class="wp-caption aligncenter"><img data-attachment-id="128257" data-permalink="https://blog.logrocket.com/create-global-custom-plugin-nuxt-js/attachment/9thshg9w/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/9THshG9w.png" data-orig-size="660,120" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="toast-success" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/9THshG9w-300x55.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/9THshG9w.png" decoding="async" class="wp-image-128257 size-full jetpack-lazy-image" src="../Images/ffccbbb36244e5be9efc10509a842df6.png" alt="Toast Success" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/9THshG9w.png 660w, https://blog.logrocket.com/wp-content/uploads/2022/08/9THshG9w-300x55.png 300w" data-lazy-sizes="(max-width: 660px) 100vw, 660px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/9THshG9w.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/9THshG9w.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="128257" data-permalink="https://blog.logrocket.com/create-global-custom-plugin-nuxt-js/attachment/9thshg9w/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/9THshG9w.png" data-orig-size="660,120" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="toast-success" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/9THshG9w-300x55.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/9THshG9w.png" decoding="async" loading="lazy" class="wp-image-128257 size-full" src="../Images/ffccbbb36244e5be9efc10509a842df6.png" alt="Toast Success" srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/9THshG9w.png 660w, https://blog.logrocket.com/wp-content/uploads/2022/08/9THshG9w-300x55.png 300w" sizes="(max-width: 660px) 100vw, 660px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/9THshG9w.png"/></noscript><figcaption id="caption-attachment-128257" class="wp-caption-text">Toast component success message</figcaption></figure>
<p>如果您查看toast组件，您会注意到对商店的<code>subscribe()</code>方法的调用。因为我们的组件是动态的，所以我们需要从某个地方获取内容，即商店。</p>
<h2 id="the-store">故事</h2>
<p>在我们的toast组件中，有两个变量，toast消息及其状态，或者是<code>success</code>或者是<code>error</code>。<a href="https://blog.logrocket.com/managing-multiple-store-modules-vuex/">在Vuex </a>的帮助下，我们将在我们的Nuxt应用程序中存储状态。因此，我们需要一个商店，最好是一个不同于应用程序一般商店的商店:</p>
<pre class="language-javascript hljs">export const state = () =&gt; ({
  content: '',
  state: ''
})

export const mutations = {
  showToast (state, payload) {
    state.content = payload.content
    state.state = payload.state
  }
}
</pre>
<h2 id="subscribe-component-store">向商店订阅组件</h2>
<p>现在我们的存储已经准备好了，我们需要在存储和toast组件之间建立一个通信通道。这里，<code>subscribe()</code>方法派上了用场，它为组件订阅了存储库的变化。因此，它在存储的每次突变后被调用，接收突变和状态对象作为参数。要了解更多关于<code>subscribe()</code>方法的信息，请查看Vuex API页面上的<a href="https://vuex.vuejs.org/api/#subscribe">订阅部分</a>。</p>
<p>因为<code>subscribe()</code>方法是在存储的每次突变后调用的，所以我们需要确认toast存储发生了突变。一旦我们确认了这一点，我们就可以继续更新组件的变量、消息及其状态:</p>
<pre class="language-javascript hljs">this.$store.subscribe((mutation, state) =&gt; {
  if (mutation.type === 'toast/showToast') {
    this.message = state.toast.content
    this.state = state.toast.state
    this.toastIsVisible = true
    document.querySelector('.toast-element').classList.add('enter')
    setTimeout(() =&gt; {
      if (this.toastIsVisible) {
        this.removeToast()
      }
    }, 3000)
  }
})
</pre>
<p>我们检查突变的类型是<code>toast/showToast</code>，因为我们的toast存储在<code>toast.js</code>中，并且突变是<code>showToast()</code>方法。</p>
<h2 id="initialize-plugin">初始化插件</h2>
<p>既然我们已经完成了组件的构建并实现了它的功能，我们需要让它在Nuxt应用程序中可用，这样我们就可以在需要时调用一个<code>show</code>方法来显示toast组件；我们将在<code>plugins</code>文件夹中这样做。</p>
<p>使插件在整个应用程序中可用也称为注入插件，Vue为此提供了<code>inject()</code>函数。这反过来又给<code>show</code>方法的对象加上了一个<code>$</code>前缀:</p>
<pre class="language-javascript hljs">export default ({ app, store }, inject) =&gt; {
  inject('toaster', {
    showToast ({ content = '', state = '' }) {
      store.commit('toast/showToast', { content, state })
    }
  })
}
</pre>
<p>因此，每当我们在Nuxt应用程序中调用这个<code>$toaster.showToast()</code>方法时，我们也需要传入<code>content</code>和<code>state</code>参数。</p>
<p>然而，如果你的插件是为了一些JavaScript功能，比如在我们的例子中，显示我的生日，那么你只需要下面的代码:</p>
<pre class="language-javascript hljs">export default ({ app }, inject) =&gt; {
  inject('displayBirthday', () =&gt; {
    console.log(`March 3rd!`)
  })
}
</pre>
<p>将我的生日记录到你的控制台。对于这种情况，您不需要商店或组件。</p>
<p>如果您密切关注这两个代码片段，您会注意到<code>inject()</code>函数的第二个参数的类型有所不同。第一个是对象，第二个是函数。当你的插件需要多个动作时，对象类型是有用的，而函数最适合一个动作。但是，对象中只能有一个方法。</p>
<h2 id="define-register-plugin">定义并注册插件</h2>
<p>在我们渲染插件之前，我们的Nuxt应用程序需要确认toast插件存在。我们可以使用<code>nuxt.config.js</code>文件中的<code>plugins</code>属性来添加代码:</p>
<pre class="language-javascript hljs">export default {
  plugins: [
    { src: '~/plugins/toaster' }
  ]
}
</pre>
<p>插件注入代码在<code>plugins/toaster.js</code>文件中。</p>
<h2 id="using-plugin">使用插件</h2>
<p>这样，我们的插件就可以使用了！要查看我们的插件，首先，toast组件需要出现在页面上。然后，我们可以调用我们商店的<code>$toaster.showToast()</code>方法，并传递<code>content</code>和<code>state</code>参数:</p>
<pre class="language-javascript hljs">this.$toaster.showToast({
  content: 'Successfully logged in!',
  state: 'success'
})
</pre>
<h2 id="conclusion">结论</h2>
<p>在本文中，我们学习了如何使用Vue 和JavaScript在<a href="https://blog.logrocket.com/supercharge-vue-js-nuxt-js-apps-vueuse/"> Nuxt应用中构建一个全局定制插件。您可以使用该组件在您的应用程序中实现不同类型的功能，当您找不到适合您项目需求的开源插件时，它会派上用场。<span>我们还讨论了如何为插件使用组件，以及当插件不需要组件时该怎么做。</span></a></p>
<p>虽然本教程中的示例演示了相当简单的功能，即在控制台中显示日期，但是您可以随意构建这个项目并对其进行定制以满足您的需求。要了解更多关于Nuxt插件的信息，我推荐查看<a href="https://nuxtjs.org/docs/directory-structure/plugins/"> Nuxt文档</a>。快乐大厦！</p><div class="code-block code-block-2">
<div class="blog-plug base-cta"><h2>使用<a class="signup" href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>消除传统错误报告的干扰</h2>
<a href="https://lp.logrocket.com/blg/signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p><a href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一个数字体验分析解决方案，它可以保护您免受数百个假阳性错误警报的影响，只针对几个真正重要的项目。LogRocket会告诉您应用程序中实际影响用户的最具影响力的bug和UX问题。</p>
<p>然后，使用具有深层技术遥测的会话重放来确切地查看用户看到了什么以及是什么导致了问题，就像你在他们身后看一样。</p>
<p>LogRocket自动聚合客户端错误、JS异常、前端性能指标和用户交互。然后LogRocket使用机器学习来告诉你哪些问题正在影响大多数用户，并提供你需要修复它的上下文。</p>
<p>关注重要的bug—<a class="signup" href="https://lp.logrocket.com/blg/signup-issue-free" target="_blank" rel="noopener noreferrer">今天就试试LogRocket】。</a></p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>