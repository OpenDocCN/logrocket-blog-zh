<html>
<head>
<title>Implementing secure single sign-on authentication in NestJS </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在NestJS中实现安全的单点登录认证</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/#0001-01-01">https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/#0001-01-01</a></blockquote><div><article class="article-post">
<p><a href="https://docs.nestjs.com/"> NestJS </a>是一个进步的<a href="https://blog.logrocket.com/tag/node/"> Node.js框架</a>，用于构建高效、可靠、可伸缩的服务器端应用。在本教程中，我们将学习如何在NestJS后端服务中实现安全的Google单点登录(SSO ),并将其连接到React前端应用程序，以便在一个简单的web应用程序中对用户进行身份验证。</p>
<p><em>向前跳转:</em></p>

<h2 id="setting-up-client-server-folders">在NestJS中设置<code>client</code>和<code>server</code>文件夹</h2>
<p>首先，我们将创建前端<code>client</code>和后端<code>server</code>文件夹。接下来，我们将导航到<code>client</code>文件夹，并通过在终端中运行命令<code>npx create-react app react-nestjs</code>来初始化React应用程序。这将为我们的前端应用程序创建所有必要的文件。</p>
<p>对于后端，我们将在终端中运行<code>nest new server</code>命令。这将搭建一个新的NestJS项目目录，并用初始核心NestJS文件和支持模块填充该目录。</p>
<p>文件夹目录应该如下所示:</p>
<p><img data-attachment-id="139528" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-project-directory/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/Nest-js-project-directory-e1666917203269.png" data-orig-size="730,398" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Nest.js project directory" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/Nest-js-project-directory-e1666917203269-300x164.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/Nest-js-project-directory-e1666917203269.png" decoding="async" class="aligncenter wp-image-139528 size-full jetpack-lazy-image" src="../Images/7c374efcf4424ef4ab519bdae6a3cebd.png" alt="Nest.js Project Directory" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/Nest-js-project-directory-e1666917203269.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/Nest-js-project-directory-e1666917203269-300x164.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/Nest-js-project-directory-e1666917203269.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/Nest-js-project-directory-e1666917203269.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="139528" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-project-directory/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/Nest-js-project-directory-e1666917203269.png" data-orig-size="730,398" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Nest.js project directory" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/Nest-js-project-directory-e1666917203269-300x164.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/Nest-js-project-directory-e1666917203269.png" decoding="async" loading="lazy" class="aligncenter wp-image-139528 size-full" src="../Images/7c374efcf4424ef4ab519bdae6a3cebd.png" alt="Nest.js Project Directory" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/Nest-js-project-directory-e1666917203269.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/Nest-js-project-directory-e1666917203269-300x164.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/Nest-js-project-directory-e1666917203269.png"/></noscript>
<p>然后，我们将导航到<code>client</code>并运行<code>npm run start</code>来启动并运行我们的前端应用程序。这将启动一个本地开发服务器作为<code>localhost:3000</code>。</p>
<h3 id="starting-development-server">启动开发服务器</h3>
<p>为了开始我们的后端开发服务器，我们将导航到<code>server</code>文件夹并运行<code>npm run start</code>。因为我们已经使用了<code>localhost:3000</code>，我们将把后端的端口改为<code>main.ts</code>文件中的<code>localhost:8080</code>:</p>
<pre class="language-typescript hljs">import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';

async function bootstrap() {
 const app = await NestFactory.create(AppModule);
 await app.listen(8080);
}
bootstrap();
</pre>
<p><code>npm run start</code>将在<code>localhost:8080</code>为我们启动开发服务器，并显示“Hello，World！”来自<code>app.controller.ts</code>的文件。</p>
<p>当开发服务器在<code>localhost:8080</code>启动时，<a href="https://blog.logrocket.com/understanding-controllers-routes-nestjs/"> <code>app.controller.ts</code> </a>使用<code>app.service.ts</code>中定义的<code>getHello</code>方法返回文本。当你检查<code>app.controller.ts</code>时，你应该看到这个:</p>
<pre class="language-typescript hljs">import { Controller, Get, Post, Body } from '@nestjs/common';
import { AppService } from './app.service';
@Controller()
export class AppController {
 constructor(private readonly appService: AppService) {}

 @Get()
 getHello(): string {
   return this.appService.getHello();
 }
</pre>
<p>这是<code>app.service.ts</code>文件中的结果:</p>
<pre class="language-typescript hljs">import { Injectable } from '@nestjs/common';
@Injectable()
export class AppService {
  getHello(): string {
   return 'Hello World!';
 }
</pre>
<p>你可以在nestj<a href="https://docs.nestjs.com/controllers">这里</a>阅读更多关于控制器的内容。</p>
<h2 id="creating-project-google-cloud-project">在Google云平台上创建一个安全的SSO项目</h2>
<p>搭建好我们的应用程序后，我们将在<a href="https://cloud.google.com/">谷歌云平台</a>上建立一个新项目。首先，我们将导航到<a href="https://console.cloud.google.com">控制台</a>并通过选择左上角的<strong>项目栏</strong>创建一个新项目。然后，点击<strong>新建项目</strong>并输入您的项目详情。之后，在搜索栏中搜索凭证并选择<strong> API和服务。</strong></p>
<p>然后，在创建凭据之前，我们将通过单击<strong>配置同意屏幕</strong>来配置内容屏幕。接下来，选择<strong>C</strong>T4】组态画面，输入app信息。接下来，我们将选择<strong>保存并继续</strong>。然后点击<strong>凭证</strong>，<strong>创建凭证</strong>，选择<strong> OAuth客户端ID </strong>。</p>
<p>这将提示我们创建OAuth客户端ID的页面，在这里我们将选择<strong> Web应用程序</strong>作为<strong>应用程序类型</strong>。然后，我们可以添加JavaScript源和重定向URIs作为<code>locahost:3000</code>。我们还将添加第二个值为<a href="http://localhost" rel="nofollow"> http://localhost </a>的URI。最后，点击<strong> Create </strong>获取客户端ID和客户端密码:</p>
<p><img data-attachment-id="139555" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/google-auth-client-created/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/google-auth-client-created.png" data-orig-size="690,417" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="NestJS secure sign on with Google" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/google-auth-client-created-300x181.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/google-auth-client-created.png" decoding="async" class="aligncenter size-full wp-image-139555 jetpack-lazy-image" src="../Images/5372db6348d20ca8e427c354b2fc9bb4.png" alt="NestJS Secure Sign On With Google" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/google-auth-client-created.png 690w, https://blog.logrocket.com/wp-content/uploads/2022/11/google-auth-client-created-300x181.png 300w" data-lazy-sizes="(max-width: 690px) 100vw, 690px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/google-auth-client-created.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/google-auth-client-created.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="139555" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/google-auth-client-created/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/google-auth-client-created.png" data-orig-size="690,417" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="NestJS secure sign on with Google" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/google-auth-client-created-300x181.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/google-auth-client-created.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-139555" src="../Images/5372db6348d20ca8e427c354b2fc9bb4.png" alt="NestJS Secure Sign On With Google" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/google-auth-client-created.png 690w, https://blog.logrocket.com/wp-content/uploads/2022/11/google-auth-client-created-300x181.png 300w" sizes="(max-width: 690px) 100vw, 690px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/google-auth-client-created.png"/></noscript>
<h2 id="configuring-react-Oauth2-google-sign-in">为Google登录配置React OAuth 2.0</h2>
<p>为了建立<a href="https://blog.logrocket.com/guide-adding-google-login-react-app/"> Google Auth库</a>，我们将使用<a href="https://www.npmjs.com/package/@react-oauth/google"> React OAuth 2.0 </a>。首先，让我们在终端中运行命令<code>npm i @react-oauth/google</code>。创建我们的客户端ID后，我们将使用<code>GoogleOAuthProvider</code>包装主页。</p>
<p>然后，在<code>App.js</code>中，我们将清理引导代码，并用以下代码替换它:</p>
<pre class="language-javascript hljs">import "./App.css";
import { GoogleOAuthProvider, GoogleLogin } from "@react-oauth/google";

function App() {
 return (
   &lt;div className="App"&gt;
         &lt;h1&gt;Welcome&lt;/h1&gt;
         &lt;GoogleOAuthProvider      clientId="192710632585-6dvq7283tr2pug31h5i6ii07fgdeu6q3.apps.googleusercontent.com
"
         &gt;
           &lt;GoogleLogin
             onSuccess={async (credentialResponse) =&gt; {
             console.log(credentialResponse);
                        }}
             onError={() =&gt; {
               console.log("Login Failed");
             }}
           /&gt;
         &lt;/GoogleOAuthProvider&gt;
   &lt;/div&gt;
 );
}

export default App;
</pre>
<p>这里，我们使用了<code>GoogleOAuthProvider</code>和<code>GoogleLogin</code>API来实现Google SSO功能。然后，我们在控制台中记录了来自<code>GoogleLogin</code>的凭证响应。我们也把<code>clientId</code>传给了<code>GoogleOAuthProvider</code>。</p>
<h3 id="using-clientid">使用<code>clientId</code></h3>
<p>现在，我们将使用电子邮件登录，并检查控制台中记录的凭据响应。在控制台中，我们应该有一个<code>clientId</code>响应对象:</p>
<p><img data-attachment-id="139561" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-clientid-response-object/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-clientid-response-object.png" data-orig-size="730,126" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Example of Nest.js clientID response object" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-clientid-response-object-300x52.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-clientid-response-object.png" decoding="async" class="aligncenter wp-image-139561 size-full jetpack-lazy-image" src="../Images/1e05350080922ae7a15d89ab4a9d5e3b.png" alt="Example of NestJS ClientID Response Object" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-clientid-response-object.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-clientid-response-object-300x52.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-clientid-response-object.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-clientid-response-object.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="139561" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-clientid-response-object/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-clientid-response-object.png" data-orig-size="730,126" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Example of Nest.js clientID response object" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-clientid-response-object-300x52.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-clientid-response-object.png" decoding="async" loading="lazy" class="aligncenter wp-image-139561 size-full" src="../Images/1e05350080922ae7a15d89ab4a9d5e3b.png" alt="Example of NestJS ClientID Response Object" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-clientid-response-object.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-clientid-response-object-300x52.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-clientid-response-object.png"/></noscript>
<p>最后，我们必须将传递给<code>GoogleOAuthProvider</code>的<code>clientId</code>存储在一个环境变量文件中。因为它是一个秘密的ID，所以不应该直接暴露给浏览器，也不应该和其他代码一起放入存储库。</p>
<p>接下来，在<code>client</code>文件夹中创建一个<code>.env</code>文件，并将<code>.env</code>添加到<code>.gitignore</code>中，这样该文件在被推送到存储库时会被忽略。在<code>.env</code>中，创建一个<code>REACT_APP_GOOGLE_CLIENT_ID</code>变量并将其传入<code>clientId</code>原始值:</p>
<pre class="language-javascript hljs"># google client id
REACT_APP_GOOGLE_CLIENT_ID=192710632585-6dvq7283tr2pug31h5i6ii07fgdeu6q3.apps.googleusercontent.com
</pre>
<p>值得注意的是，变量名必须以关键字<code>REACT_APP</code>为前缀。</p>
<p>然后，在<code>App.js</code>中，我们将把<code>process.env.REACT_APP_GOOGLE_CLIENT_ID</code>作为<code>clientId</code>的值传递给React来读取<span> <span>。环境</span> </span>:</p>
<pre class="language-javascript hljs">import "./App.css";
import { GoogleOAuthProvider, GoogleLogin } from "@react-oauth/google";
function App() {
 return (
   &lt;div className="App"&gt;
         &lt;h1&gt;Welcome&lt;/h1&gt;
         &lt;GoogleOAuthProvider
           clientId={process.env.REACT_APP_GOOGLE_CLIENT_ID}
         &gt;
           &lt;GoogleLogin
             onSuccess={async (credentialResponse) =&gt; {
               console.log(credentialResponse);
                         }}
             onError={() =&gt; {
               console.log("Login Failed");
             }}
           /&gt;
         &lt;/GoogleOAuthProvider&gt;
       &lt;/div&gt;
 );
}

export default App;
</pre>
<h2 id="state-management-with-zustand">使用Zustand为您的NestJS项目进行状态管理</h2>
<p>我们将使用<a href="https://blog.logrocket.com/managing-react-state-zustand/"> Zustand </a>进行全球状态管理。但是，你可以使用<a href="https://blog.logrocket.com/understanding-redux-tutorial-examples/"> Redux </a>、<a href="https://recoiljs.org/">反冲</a>，或者任何你选择的状态管理。要开始，运行<code>npm install zustand</code>来安装该包:</p>
<p>然后，我们将创建一个<code>hook</code>文件夹，并创建<code>useStore.js</code>存储文件:</p>
<pre class="language-javascript hljs">import create from "zustand";

export const useStore = create((set) =&gt; ({
 // get the data from local storage
 authData: localStorage.getItem("authData")
   ? JSON.parse(localStorage.getItem("authData"))
   : null,

 setAuthData: (authData) =&gt; {
   localStorage.setItem("authData", JSON.stringify(authData));
   set({ authData });
 },
}));
</pre>
<p>接下来，每当用户登录时，我们将使用<code>Axios.post</code>方法发出一个<a href="https://blog.logrocket.com/how-to-make-http-requests-like-a-pro-with-axios/"> Axios POST </a>请求。</p>
<p>首先，安装带有<code>npm install axios</code>的Axios，并在选择<code>GoogleLogin</code>时发出<code>Post</code>请求:</p>
<pre class="language-javascript hljs">import "./App.css";
import { GoogleOAuthProvider, GoogleLogin } from "@react-oauth/google";
import axios from "axios";
import { useStore } from "./hooks/useStore";

function App() {
 const setAuthData = useStore((state) =&gt; state.setAuthData);
 return (
   &lt;div className="App"&gt;
              &lt;h1&gt;Welcome&lt;/h1&gt;
         &lt;GoogleOAuthProvider
           clientId={process.env.REACT_APP_GOOGLE_CLIENT_ID}
         &gt;
           &lt;GoogleLogin
             useOneTap={true}
             onSuccess={async (credentialResponse) =&gt; {
               console.log(credentialResponse);
               const { data } = await axios.post(
                 "http://localhost:8080/login",
                                );
               localStorage.setItem("AuthData", JSON.stringify(data));
               setAuthData(data);
             }}
             onError={() =&gt; {
               console.log("Login Failed");
             }}
           /&gt;
         &lt;/GoogleOAuthProvider&gt;   
      &lt;/div&gt;
 );
}

export default App;
</pre>
<p>记住，我们将后端的端口设置为<code>8080</code>，所以我们稍后将在后端请求<code>8080/login</code>。然后，我们将来自后端服务器的数据存储在本地存储器中，并将<code>setAuthData</code>设置为我们的后端服务将返回的数据。</p>
<h2 id="building-nest-js-folder">构建NestJS文件夹</h2>
<p>接下来，我们需要在之前创建的<code>server</code>中设置我们的NestJS文件夹:</p>
<p><img data-attachment-id="139565" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-server-folder/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-server-folder.png" data-orig-size="400,696" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Nest.js server folder" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-server-folder-172x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-server-folder.png" decoding="async" class="aligncenter wp-image-139565 size-full jetpack-lazy-image" src="../Images/b3672d410694709bdddc190f6b36f3bb.png" alt="NestJS SSO Server Folder" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-server-folder.png 400w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-server-folder-172x300.png 172w" data-lazy-sizes="(max-width: 400px) 100vw, 400px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-server-folder.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-server-folder.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="139565" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-server-folder/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-server-folder.png" data-orig-size="400,696" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Nest.js server folder" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-server-folder-172x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-server-folder.png" decoding="async" loading="lazy" class="aligncenter wp-image-139565 size-full" src="../Images/b3672d410694709bdddc190f6b36f3bb.png" alt="NestJS SSO Server Folder" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-server-folder.png 400w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-server-folder-172x300.png 172w" sizes="(max-width: 400px) 100vw, 400px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-server-folder.png"/></noscript>
<p>为了确认我们成功地将NestJS连接到前端应用程序，我们将使用<code>POST HTTP</code>请求方法返回<code>app.controller.ts</code>中的<code>React x NestJS</code>:</p>
<pre class="language-typescript hljs">import { Controller, Post } from '@nestjs/common';
import { AppService } from './app.service';
@Controller()
export class AppController {
 @Post('/login')
 login: string {
   return 'Reaxt x NestJS';
 }
}
</pre>
<p>现在，让我们登录前端应用程序，检查浏览器的本地存储:</p>
<p><img data-attachment-id="139567" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-browser-storage/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-browser-storage.png" data-orig-size="730,128" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Checking the Nest.js browser storage" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-browser-storage-300x53.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-browser-storage.png" decoding="async" class="aligncenter wp-image-139567 size-full jetpack-lazy-image" src="../Images/0e026ab041e605a05599ce2417ad16a8.png" alt="Checking the NestJS Browser Storage" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-browser-storage.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-browser-storage-300x53.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-browser-storage.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-browser-storage.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="139567" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-browser-storage/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-browser-storage.png" data-orig-size="730,128" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Checking the Nest.js browser storage" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-browser-storage-300x53.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-browser-storage.png" decoding="async" loading="lazy" class="aligncenter wp-image-139567 size-full" src="../Images/0e026ab041e605a05599ce2417ad16a8.png" alt="Checking the NestJS Browser Storage" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-browser-storage.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-browser-storage-300x53.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-browser-storage.png"/></noscript>
<p>一旦我们成功登录，我们就可以以文本形式发送响应。从这里，我们将创建一个模式并发送<code>name</code>、<code>email</code>、<code>picture</code>用户对象。</p>
<p>记住，对于NestJS和React之间的连接工作，我们需要在NestJS <code>main.ts</code>文件中启用<code>cors</code>。否则，调用后端端点时会出现错误:</p>
<pre class="language-typescript hljs">import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';

async function bootstrap() {
 const app = await NestFactory.create(AppModule);
 //enable cors
 app.enableCors({
   origin: 'http://localhost:3000',
 });
 await app.listen(8080);
}
bootstrap();
</pre>
<p>因为我们的端口原点是<code>localhost:3000</code>，所以我们会在<code>enableCors</code>方法中将其传递给原点。</p>
<h2 id="implementing-Google-OAuth-Nest-js">在NestJS中实现Google OAuth</h2>
<p>我们将从服务器端的<a href="https://cloud.google.com/nodejs/docs/reference/google-auth-library/latest"> Google Auth Library: Node.js客户端</a>开始。要安装这个包，运行<code>npm i google-auth-library</code>并导入<code>OAuth2Client</code>来检索访问令牌，然后刷新令牌。</p>
<p>接下来，我们将初始化一个新的<code>OAuth2Client</code>实例，传递<code>clientId</code>，并在设置Google云平台时生成秘密。</p>
<p>同样，我们不想在代码中简单地传递值，所以我们需要为服务器端实现<code>.env</code>。首先，创建一个<code>.env</code>并将其包含在<code>.gitignore</code>中。然后，在<code>.env</code>文件中添加两个变量:</p>
<pre class="language-javascript hljs">GOOGLE_CLIENT_ID=192710632585-6dvq7283tr2pug31h5i6ii07fgdeu6q3.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=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
</pre>
<p>现在，我们需要从项目根目录加载并解析<code>.env</code>。我们还将把来自<code>.env</code>的键值对与环境变量合并，并将结果存储在一个通过<code>ConfigService</code>访问的私有结构中。为此，我们将在内部安装使用<code>dotenv</code>的<code>npm i --save @nestjs/config</code>。</p>
<p>然后，我们将把<code>nest/config</code>中的<code>ConfigModule</code>导入到根<code>AppModule</code>中，并使用<code>.forRoot()</code>静态方法控制它的行为:</p>
<pre class="language-typescript hljs">import { Module } from '@nestjs/common';
import { AppController } from './app.controller';
import { AppService } from './app.service';
import { ConfigModule } from '@nestjs/config';

@Module({
 imports: [
   ConfigModule.forRoot({
     isGlobal: true,
     envFilePath: '.env',
   }),
  ],
 controllers: [AppController],
 providers: [AppService],
})
export class AppModule {}
</pre>
<p>现在，我们可以从项目的任何地方读取我们的<code>.env</code>变量。接下来，我们将在<code>app.controller.ts</code>中实现Google认证:</p>
<pre class="language-typescript hljs">import { Controller, Get, Post, Body } from '@nestjs/common';
import { AppService } from './app.service';
import { OAuth2Client } from 'google-auth-library';

const client = new OAuth2Client(
 process.env.GOOGLE_CLIENT_ID,
 process.env.GOOGLE_CLIENT_SECRET,
);

@Controller()
export class AppController {
 @Post('/login')
 async login(@Body('token') token): Promise&lt;any&gt; {
   const ticket = await client.verifyIdToken({
     idToken: token,
     audience: process.env.GOOGLE_CLIENT_ID,
   });
    // log the ticket payload in the console to see what we have
   console.log(ticket.getPayload());
    }
}
</pre>
<p>这里，我们将<code>idToken</code>和<code>audience</code>传递给<code>Body</code>装饰器，相当于<code>req.body</code>。<code>audience</code>是<code>clientId</code>，而<code>token</code>将来自我们前端的<code>credentialObject</code>。</p>
<p>我们将把<code>App.js</code>中的<code>token</code>作为<code>credentialObject.credentials</code>与<code>Body</code>一起传递:</p>
<pre class="language-javascript hljs">&lt;GoogleLogin
             useOneTap={true}
             onSuccess={async (credentialResponse) =&gt; {
               console.log(credentialResponse);
               const { data } = await axios.post(
                 "http://localhost:8080/login",
                 {
                   // pass the token as part of the req body
                   token: credentialResponse.credential,
                 }
               );
               localStorage.setItem("AuthData", JSON.stringify(data));
               setAuthData(data);
             }}
             onError={() =&gt; {
               console.log("Login Failed");
             }}
           /&gt;
</pre>
<p>当我们成功登录时，我们的终端中应该有这个作为<code>ticket.getPayload() data</code>:</p>
<p><img data-attachment-id="139569" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-sso-terminal/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-terminal.png" data-orig-size="730,228" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Nest.js sso terminal" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-terminal-300x94.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-terminal.png" decoding="async" class="aligncenter wp-image-139569 size-full jetpack-lazy-image" src="../Images/9a811b5b83323aa26e2f47c662225a72.png" alt="NestJS SSO Terminal" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-terminal.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-terminal-300x94.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-terminal.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-terminal.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="139569" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-sso-terminal/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-terminal.png" data-orig-size="730,228" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Nest.js sso terminal" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-terminal-300x94.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-terminal.png" decoding="async" loading="lazy" class="aligncenter wp-image-139569 size-full" src="../Images/9a811b5b83323aa26e2f47c662225a72.png" alt="NestJS SSO Terminal" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-terminal.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-terminal-300x94.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-terminal.png"/></noscript>
<h2 id="saving-Nest-js-project-data-MongoDB">将NestJS SSO项目数据保存到MongoDB</h2>
<p>对于本教程，我们将使用<a href="https://www.mongodb.com/"> MongoDB </a>在数据库中保存用户的信息。首先，注册或登录一个<a href="https://www.mongodb.com/cloud"> MongoDB云服务账户</a>。然后，创建一个新的自由层群集:</p>
<p><img data-attachment-id="139571" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-database-mongodb/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-database-mongodb.png" data-orig-size="730,375" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Adding Nest.js to the MongoDB database" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-database-mongodb-300x154.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-database-mongodb.png" decoding="async" class="aligncenter wp-image-139571 size-full jetpack-lazy-image" src="../Images/7616bfccb4ec8b40f6125aa4ec92b455.png" alt="Adding NestJS to the MongoDB Database" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-database-mongodb.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-database-mongodb-300x154.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-database-mongodb.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-database-mongodb.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="139571" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-database-mongodb/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-database-mongodb.png" data-orig-size="730,375" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Adding Nest.js to the MongoDB database" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-database-mongodb-300x154.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-database-mongodb.png" decoding="async" loading="lazy" class="aligncenter wp-image-139571 size-full" src="../Images/7616bfccb4ec8b40f6125aa4ec92b455.png" alt="Adding NestJS to the MongoDB Database" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-database-mongodb.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-database-mongodb-300x154.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-database-mongodb.png"/></noscript>
<p><img data-attachment-id="139573" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-shared-cluster/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-shared-cluster.png" data-orig-size="730,371" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Creating the Nest.js shared cluster" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-shared-cluster-300x152.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-shared-cluster.png" decoding="async" class="aligncenter wp-image-139573 size-full jetpack-lazy-image" src="../Images/b4fbf792eae3494686ce57a931092035.png" alt="Creating the NestJS Shared Cluster" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-shared-cluster.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-shared-cluster-300x152.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-shared-cluster.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-shared-cluster.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="139573" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-shared-cluster/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-shared-cluster.png" data-orig-size="730,371" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Creating the Nest.js shared cluster" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-shared-cluster-300x152.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-shared-cluster.png" decoding="async" loading="lazy" class="aligncenter wp-image-139573 size-full" src="../Images/b4fbf792eae3494686ce57a931092035.png" alt="Creating the NestJS Shared Cluster" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-shared-cluster.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-shared-cluster-300x152.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-shared-cluster.png"/></noscript>
<h3 id="building-user-schema">构建用户模式</h3>
<p>创建集群后，连接您的应用程序以获得您的MONGOURI <strong>。</strong>复制URI并粘贴到<code>server</code>的<code>.env</code>文件中。然后，我们将把我们的数据库与<code>app.module.ts</code>中的NestJS应用程序连接起来。</p>
<p>我们将通过创建<code>user.schema.ts</code>文件来创建一个用户模式。你可以在NestJS <a href="https://docs.nestjs.com/techniques/mongodb">这里</a>阅读更多关于连接MongoDB数据库的内容:</p>
<pre class="language-typescript hljs">MONGO_URI=mongodb+srv://Taofiq:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="6e3d0f020f082e1c0b0f0d1a43000b1d1a430a0f1a0f0c0f1d0b40590817051c5c184003010009010a0c40000b1a">[email protected]</a>/?retryWrites=true&amp;w=majority


import { Prop, Schema, SchemaFactory } from '@nestjs/mongoose';
import { Document } from 'mongoose';

export type UserDocument = User &amp; Document;

@Schema()
export class User {
 @Prop()
 name: string;

 @Prop()
 email: string;

 @Prop()
 image: string;
}

export const UserSchema = SchemaFactory.createForClass(User);
</pre>
<p>在我们的模式中，当向<code>Post</code>发出登录请求时，我们将发送<code>name</code>、<code>email</code>和<code>image</code>道具作为响应。</p>
<p>现在，在app模块中，我们将配置MongoDB连接:</p>
<pre class="language-typescript hljs">import { Module } from '@nestjs/common';
import { AppController } from './app.controller';
import { AppService } from './app.service';
import { ConfigModule } from '@nestjs/config';
import { MongooseModule } from '@nestjs/mongoose';
import { User, UserSchema } from './user.schema';

@Module({
 imports: [
   ConfigModule.forRoot({
     isGlobal: true,
     envFilePath: '.env',
   }),
   MongooseModule.forRoot(process.env.MONGO_URI),
   MongooseModule.forFeature([{ name: User.name, schema: UserSchema }]),
 ],
 controllers: [AppController],
 providers: [AppService],
})
export class AppModule {}
</pre>
<h2 id="Applying-frontend-sign-in-with-data-Nest-js">使用来自NestJS的数据应用前端安全单点登录</h2>
<p>接下来，我们将创建一个应用程序服务来创建新用户并让现有用户登录应用程序:</p>
<pre class="language-typescript hljs">import { Injectable } from '@nestjs/common';
import { InjectModel } from '@nestjs/mongoose';
import { Model } from 'mongoose';
import { User, UserDocument } from './user.schema';

@Injectable()
export class AppService {
 constructor(@InjectModel(User.name) private userModel: Model&lt;UserDocument&gt;) {}
 async login({
   email,
   name,
   image,
 }: {
   email: string;
   name: string;
   image: string;
 }): Promise&lt;any&gt; {
   const user = await this.userModel.findOne({ email: email });
   if (!user) {
     const newUser = new this.userModel({ email, name, image });
     await newUser.save();
     return newUser;
   } else {
     console.log(user);
     return user;
   }
 }
}
</pre>
<p>这里，我们将创建一个新的<code>login</code>函数。首先，我们将验证用户电子邮件的存在。如果它们不在数据库中，使用<code>userModel</code>创建一个新用户。如果用户已经存在于数据库中，当端点被调用时，我们将返回现有用户的<code>name</code>、<code>email</code>和<code>image</code>。从这里，一个<code>ticket</code> i <span> s被创建，并且<code>token</code> </span>和<code>audience</code> <span>值被传入:</span></p>
<pre class="prettyprint">{
                   // pass the token as part of the req body
                   token: credentialResponse.credential,
                 }
</pre>
<p>然后，在我们的<code>app.controller.ts</code>中，我们将通过使用我们在<code>App.js</code>中传递的<code>token</code>来使用<code>login</code>。下面是用户成功登录时的<code>ticket.getPayload()</code>对象数据:</p>
<p><img data-attachment-id="139576" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-sso-ticket-object-data/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-ticket-object-data.png" data-orig-size="730,226" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Successful Nest.js sso ticket object data" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-ticket-object-data-300x93.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-ticket-object-data.png" decoding="async" class="aligncenter wp-image-139576 size-full jetpack-lazy-image" src="../Images/4654bf47f50f082f1a6a0be9967e38de.png" alt="Successful NestJS SSO Ticket Object Data" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-ticket-object-data.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-ticket-object-data-300x93.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-ticket-object-data.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-ticket-object-data.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="139576" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-sso-ticket-object-data/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-ticket-object-data.png" data-orig-size="730,226" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Successful Nest.js sso ticket object data" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-ticket-object-data-300x93.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-ticket-object-data.png" decoding="async" loading="lazy" class="aligncenter wp-image-139576 size-full" src="../Images/4654bf47f50f082f1a6a0be9967e38de.png" alt="Successful NestJS SSO Ticket Object Data" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-ticket-object-data.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-ticket-object-data-300x93.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-ticket-object-data.png"/></noscript>
<p>由于我们的模式基于<code>name</code>、<code>email</code>和<code>image</code>，我们可以从<code>ticket.getPayload</code>中析构这些值，并在<code>login</code>中使用它们:</p>
<pre class="language-typescript hljs">@Post('/login')
 async login(@Body('token') token): Promise&lt;any&gt; {
   const ticket = await client.verifyIdToken({
     idToken: token,
     audience: process.env.GOOGLE_CLIENT_ID,
   });
   console.log(ticket.getPayload(), 'ticket');
   const { email, name, picture } = ticket.getPayload();
   const data = await this.appService.login({ email, name, image: picture });
   return {
     data,
     message: 'success',
   };
 }
</pre>
<p>当用户试图登录时，析构的道具从<code>ticket</code>对象数据中取出并传递给<code>login</code>。如果用户存在，登录用户，将用户数据发送回前端app。如果用户不存在，则为用户创建新数据，并将其发送回前端应用。</p>
<p>现在，我们可以返回到<code>client</code>并创建一个<code>User</code>组件，在用户登录时显示他们的详细信息。我们将用<code>User.js</code>文件创建一个<code>component</code>文件夹，并发回<code>name</code>、<code>email</code>和<code>image</code>。</p>
<p>我们将使用<code>useStore</code>钩子并在用户登录时呈现显示的数据。</p>
<p>我们还将检查<code>User</code>是否仅在数据从后端服务器发送时呈现，并使用<a href="https://developers.google.com/identity/sign-in/web/reference#googleauthsignout"> <code>GoogleAuth.signOut()</code> API </a>创建一个<code>Logout</code>按钮。点击后，按钮将被调用，从本地存储中删除<code>authData</code>，设置<code>setAuthData</code>为空，并重新加载窗口:</p>
<pre class="language-javascript hljs">import React from "react";
import { useStore } from "../hooks/useStore";
import { googleLogout } from "@react-oauth/google";
import "../User.css";
const User = () =&gt; {
 const { authData, setAuthData } = useStore();
 return (
   &lt;div className={"container"}&gt;
     {authData &amp;&amp; (
       &lt;&gt;
         &lt;h1&gt;{authData.data.name}&lt;/h1&gt;
         &lt;p&gt;{authData.data.email}&lt;/p&gt;
         &lt;img src={authData.data.image} alt="profile" /&gt;

         &lt;button
           onClick={() =&gt; {
             googleLogout();
             localStorage.removeItem("AuthData");
             setAuthData(null);
             window.location.reload();
           }}
           className={"button"}
         &gt;
           Logout
         &lt;/button&gt;
       &lt;/&gt;
     )}
   &lt;/div&gt;
 );
};

export default User;
</pre>
<p>现在，我们可以在<code>App.js</code>中使用<code>Logout</code>:</p>
<pre class="language-javascript hljs">import "./App.css";
import { GoogleOAuthProvider, GoogleLogin } from "@react-oauth/google";
import axios from "axios";
import { useStore } from "./hooks/useStore";
import User from "./components/User";

function App() {
 const setAuthData = useStore((state) =&gt; state.setAuthData);
 return (
   &lt;div className="App"&gt;
     {!useStore((state) =&gt; state.authData) ? (
       &lt;&gt;
         &lt;h1&gt;Welcome&lt;/h1&gt;
         &lt;GoogleOAuthProvider
           clientId={process.env.REACT_APP_GOOGLE_CLIENT_ID}
         &gt;
           &lt;GoogleLogin
             useOneTap={true}
             onSuccess={async (credentialResponse) =&gt; {
               console.log(credentialResponse);
               const { data } = await axios.post(
                 "http://localhost:8080/login",
                 {
                   // pass the token as part of the req body
                   token: credentialResponse.credential,
                 }
               );
               localStorage.setItem("AuthData", JSON.stringify(data));
               setAuthData(data);
             }}
             onError={() =&gt; {
               console.log("Login Failed");
             }}
           /&gt;
         &lt;/GoogleOAuthProvider&gt;
       &lt;/&gt;
     ) : (
       &lt;&gt;
         &lt;h1&gt;React x Nestjs Google Sign in&lt;/h1&gt;
         &lt;User /&gt;
       &lt;/&gt;
     )}
   &lt;/div&gt;
 );
}

export default App;
</pre>
<p>这里，我们将检查<code>authData</code>是否是用<code>useStore</code>钩子从后端服务器发送的。如果没有数据，它将呈现一个“欢迎”文本和谷歌登录按钮。但是，如果用户已经登录，我们将呈现<code>React x NestJs Google sign in</code>和<code>User Details</code>。</p>
<p>现在，让我们开始整个过程，看看它是如何运作的:</p>
<p><img data-attachment-id="139578" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-google-welcome-sso/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-welcome-sso-e1666919131928.png" data-orig-size="730,155" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Example of Nest.js sso welcome in Google" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-welcome-sso-e1666919131928-300x64.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-welcome-sso-e1666919131928.png" decoding="async" class="aligncenter wp-image-139578 size-full jetpack-lazy-image" src="../Images/1bdf45204ec61377b02843901901704e.png" alt="Example of NestJS SSO Welcome in Google" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-welcome-sso-e1666919131928.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-welcome-sso-e1666919131928-300x64.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-welcome-sso-e1666919131928.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-welcome-sso-e1666919131928.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="139578" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-google-welcome-sso/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-welcome-sso-e1666919131928.png" data-orig-size="730,155" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Example of Nest.js sso welcome in Google" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-welcome-sso-e1666919131928-300x64.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-welcome-sso-e1666919131928.png" decoding="async" loading="lazy" class="aligncenter wp-image-139578 size-full" src="../Images/1bdf45204ec61377b02843901901704e.png" alt="Example of NestJS SSO Welcome in Google" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-welcome-sso-e1666919131928.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-welcome-sso-e1666919131928-300x64.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-welcome-sso-e1666919131928.png"/></noscript>
<p>当我们登录时，我们有文本和用户详细信息:</p>
<p><img data-attachment-id="139581" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-google-secure-sign-on/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-secure-sign-on.png" data-orig-size="730,395" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Example of Nest.js Google sso" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-secure-sign-on-300x162.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-secure-sign-on.png" decoding="async" class="aligncenter wp-image-139581 size-full jetpack-lazy-image" src="../Images/665e4d86d61d598cfee457db56a69283.png" alt="Example of NestJS Secure SSO" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-secure-sign-on.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-secure-sign-on-300x162.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-secure-sign-on.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-secure-sign-on.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="139581" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-google-secure-sign-on/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-secure-sign-on.png" data-orig-size="730,395" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Example of Nest.js Google sso" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-secure-sign-on-300x162.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-secure-sign-on.png" decoding="async" loading="lazy" class="aligncenter wp-image-139581 size-full" src="../Images/665e4d86d61d598cfee457db56a69283.png" alt="Example of NestJS Secure SSO" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-secure-sign-on.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-secure-sign-on-300x162.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-google-secure-sign-on.png"/></noscript>
<p>接下来，我们可以检查我们的数据库，看看用户是否被保存:</p>
<p><img data-attachment-id="139583" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/react-nest-js-database/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/react-nest-js-database.png" data-orig-size="730,406" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Checking the React-Nest.js database" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/react-nest-js-database-300x167.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/react-nest-js-database.png" decoding="async" class="aligncenter wp-image-139583 size-full jetpack-lazy-image" src="../Images/5e63f4483d2953c9a6a5a05ef690d557.png" alt="Checking the React-NestJS Database" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/react-nest-js-database.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/react-nest-js-database-300x167.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/react-nest-js-database.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/react-nest-js-database.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="139583" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/react-nest-js-database/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/react-nest-js-database.png" data-orig-size="730,406" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Checking the React-Nest.js database" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/react-nest-js-database-300x167.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/react-nest-js-database.png" decoding="async" loading="lazy" class="aligncenter wp-image-139583 size-full" src="../Images/5e63f4483d2953c9a6a5a05ef690d557.png" alt="Checking the React-NestJS Database" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/react-nest-js-database.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/react-nest-js-database-300x167.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/react-nest-js-database.png"/></noscript>
<p>成功！我们的用户在我们的数据库中。总之，我们使用Google sign-in成功登录，从NestJS检索用户数据，并在用户登录后显示在React前端应用程序上。</p>
<p>现在，当我们注销时，我们会看到:</p>
<p><img data-attachment-id="139585" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-sso-google-log-out/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-google-log-out-e1666919280878.png" data-orig-size="730,244" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Nest.js sso log out" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-google-log-out-e1666919280878-300x100.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-google-log-out-e1666919280878.png" decoding="async" class="aligncenter wp-image-139585 size-full jetpack-lazy-image" src="../Images/980b5fbbf0e6c7fed2171f400967e5ae.png" alt="NestJS SSO Log Out" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-google-log-out-e1666919280878.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-google-log-out-e1666919280878-300x100.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-google-log-out-e1666919280878.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-google-log-out-e1666919280878.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="139585" data-permalink="https://blog.logrocket.com/implement-secure-single-sign-on-nestjs-google/attachment/nest-js-sso-google-log-out/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-google-log-out-e1666919280878.png" data-orig-size="730,244" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Nest.js sso log out" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-google-log-out-e1666919280878-300x100.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-google-log-out-e1666919280878.png" decoding="async" loading="lazy" class="aligncenter wp-image-139585 size-full" src="../Images/980b5fbbf0e6c7fed2171f400967e5ae.png" alt="NestJS SSO Log Out" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-google-log-out-e1666919280878.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-google-log-out-e1666919280878-300x100.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/nest-js-sso-google-log-out-e1666919280878.png"/></noscript>
<h2>结论</h2>
<p>在本教程中，我们学习了如何在NestJS项目中实现安全的Google登录。我们将它连接到一个基本的前端React应用程序，同时将用户信息保存在数据库中。你可以在我的库<a href="https://github.com/Taofiqq/react-nest-google-auth">这里</a>找到这个项目的完整代码。编码快乐！</p><div class="code-block code-block-4">
<div class="blog-plug base-cta"><h2>使用<a class="signup" href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>消除传统错误报告的干扰</h2>
<a href="https://lp.logrocket.com/blg/signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p><a href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一个数字体验分析解决方案，它可以保护您免受数百个假阳性错误警报的影响，只针对几个真正重要的项目。LogRocket会告诉您应用程序中实际影响用户的最具影响力的bug和UX问题。</p>
<p>然后，使用具有深层技术遥测的会话重放来确切地查看用户看到了什么以及是什么导致了问题，就像你在他们身后看一样。</p>
<p>LogRocket自动聚合客户端错误、JS异常、前端性能指标和用户交互。然后LogRocket使用机器学习来告诉你哪些问题正在影响大多数用户，并提供你需要修复它的上下文。</p>
<p>关注重要的bug—<a class="signup" href="https://lp.logrocket.com/blg/signup-issue-free" target="_blank" rel="noopener noreferrer">今天就试试LogRocket】。</a></p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>