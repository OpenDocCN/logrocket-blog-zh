<html>
<head>
<title>How to build and deploy a Telegram bot with Flask - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何使用 Flask - LogRocket 博客构建和部署电报机器人</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/build-deploy-telegram-bot-with-flask/#0001-01-01">https://blog.logrocket.com/build-deploy-telegram-bot-with-flask/#0001-01-01</a></blockquote><div><article class="article-post">
<p>今天，几乎每个 SaaS 网站或应用程序都使用聊天机器人。聊天机器人提供一致的信息、全天候服务和快速的响应时间。这些工具已被证明可以降低业务成本，提高客户满意度。</p>
<p>聊天机器人的主要应用之一是回答简单的查询，但它们也可以用于许多其他功能:</p>
<ul>
<li>消息广播</li>
<li>提醒</li>
<li>定制的通知和新闻</li>
<li>用户教育</li>
<li>比赛</li>
<li>搜索引擎应用</li>
<li>与其他服务的集成</li>
</ul>
<p>在本文中，我们将介绍如何设置一个<a href="https://telegram.org/" target="_blank" rel="noopener"> Telegram </a> bot，然后将其与<a href="https://flask.palletsprojects.com/en/2.0.x/" target="_blank" rel="noopener"> Flask </a>集成，以快速构建一个定制的字典应用程序并将其部署到 Heroku。</p>
<h2>设置电报机器人配置文件</h2>
<p>Telegram 是一个多媒体在线消息应用程序，具有标准的核心功能。用户可以创建群组对话，发送视频和照片，向其他用户发送消息，并与联系人进行语音和视频通话。</p>
<p>Telegram 区别于其他消息平台的一个方面是它的聊天机器人特别容易设置、编程和管理。电报机器人可以用于多种用途。</p>
<p>要设置电报机器人，首先登录您的电报档案。如果你还没有在 Telegram 上创建个人资料，你可以在这里注册<a href="https://telegram.org/" target="_blank" rel="noopener"/>。</p>
<p>接下来，通过将@BotFather 粘贴到 Telegram 的搜索栏中来查找 BotFather。BotFather 是 Telegram 的管理机器人，它使用户能够创建和管理机器人。<br/> <img data-attachment-id="85084" data-permalink="https://blog.logrocket.com/build-deploy-telegram-bot-with-flask/telegram-botfather-profile/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather-profile.png" data-orig-size="690,211" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Telegram BotFather profile" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather-profile-300x92.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather-profile.png" decoding="async" class="aligncenter wp-image-85084 size-full jetpack-lazy-image" src="../Images/88302466fcbd63bb603a31f385f94252.png" alt="Telegram BotFather Profile" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather-profile.png 690w, https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather-profile-300x92.png 300w" data-lazy-sizes="(max-width: 690px) 100vw, 690px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather-profile.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather-profile.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="85084" data-permalink="https://blog.logrocket.com/build-deploy-telegram-bot-with-flask/telegram-botfather-profile/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather-profile.png" data-orig-size="690,211" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Telegram BotFather profile" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather-profile-300x92.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather-profile.png" decoding="async" loading="lazy" class="aligncenter wp-image-85084 size-full" src="../Images/88302466fcbd63bb603a31f385f94252.png" alt="Telegram BotFather Profile" srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather-profile.png 690w, https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather-profile-300x92.png 300w" sizes="(max-width: 690px) 100vw, 690px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather-profile.png"/></noscript>
<p><img data-attachment-id="85086" data-permalink="https://blog.logrocket.com/build-deploy-telegram-bot-with-flask/telegram-botfather/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather.png" data-orig-size="720,849" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Telegram BotFather admin bot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather-254x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather.png" decoding="async" class="aligncenter wp-image-85086 size-full jetpack-lazy-image" src="../Images/384a165e379bd6d01f4dc3fada8ec854.png" alt="Telegram BotFather Admin Bot" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather-254x300.png 254w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="85086" data-permalink="https://blog.logrocket.com/build-deploy-telegram-bot-with-flask/telegram-botfather/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather.png" data-orig-size="720,849" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Telegram BotFather admin bot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather-254x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather.png" decoding="async" loading="lazy" class="aligncenter wp-image-85086 size-full" src="../Images/384a165e379bd6d01f4dc3fada8ec854.png" alt="Telegram BotFather Admin Bot" srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather-254x300.png 254w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-botfather.png"/></noscript>
<p>启动 BotFather 后，点击<strong>开始</strong>按钮或在用户界面的输入栏中键入命令<code>/start</code>开始对话。</p>
<p>BotFather 将使用一系列其他命令来响应<code>/start</code>,这些命令可以被调用来执行不同的操作:</p>
<p>要创建新的机器人，请在输入字段中键入<code>/newbot</code>命令。机器人父亲将会回应，询问关于新机器人的细节:<br/> <img data-attachment-id="85098" data-permalink="https://blog.logrocket.com/build-deploy-telegram-bot-with-flask/telegram-new-bot-settings/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-new-bot-settings.png" data-orig-size="720,631" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Telegram new bot settings" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-new-bot-settings-300x263.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-new-bot-settings.png" decoding="async" class="aligncenter wp-image-85098 size-full jetpack-lazy-image" src="../Images/88de1a04f67a409989b4a3e6d4d54478.png" alt="Telegram New Bot Settings" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-new-bot-settings.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-new-bot-settings-300x263.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-new-bot-settings.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-new-bot-settings.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="85098" data-permalink="https://blog.logrocket.com/build-deploy-telegram-bot-with-flask/telegram-new-bot-settings/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-new-bot-settings.png" data-orig-size="720,631" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Telegram new bot settings" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-new-bot-settings-300x263.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-new-bot-settings.png" decoding="async" loading="lazy" class="aligncenter wp-image-85098 size-full" src="../Images/88de1a04f67a409989b4a3e6d4d54478.png" alt="Telegram New Bot Settings" srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-new-bot-settings.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-new-bot-settings-300x263.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-new-bot-settings.png"/></noscript>
<p>接下来，您将收到来自 BotFather 的包含 HTTP 令牌的消息。不要公开此标记。任何有权访问令牌的人都可以对您的机器人进行修改。</p>
<p>我们将使用这个令牌通过 Flask 应用程序中的 Telegram API 与新的 bot 进行交互。</p>
<p><img data-attachment-id="85101" data-permalink="https://blog.logrocket.com/build-deploy-telegram-bot-with-flask/setting-up-new-telegram-bot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/setting-up-new-telegram-bot.png" data-orig-size="720,250" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Setting up new Telegram bot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/setting-up-new-telegram-bot-300x104.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/setting-up-new-telegram-bot.png" decoding="async" class="aligncenter wp-image-85101 size-full jetpack-lazy-image" src="../Images/d70714c947ba62ab7cd52cfbd347e563.png" alt="Setting Up New telegram Bot" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/setting-up-new-telegram-bot.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/01/setting-up-new-telegram-bot-300x104.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/setting-up-new-telegram-bot.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/setting-up-new-telegram-bot.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="85101" data-permalink="https://blog.logrocket.com/build-deploy-telegram-bot-with-flask/setting-up-new-telegram-bot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/setting-up-new-telegram-bot.png" data-orig-size="720,250" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Setting up new Telegram bot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/setting-up-new-telegram-bot-300x104.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/setting-up-new-telegram-bot.png" decoding="async" loading="lazy" class="aligncenter wp-image-85101 size-full" src="../Images/d70714c947ba62ab7cd52cfbd347e563.png" alt="Setting Up New telegram Bot" srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/setting-up-new-telegram-bot.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/01/setting-up-new-telegram-bot-300x104.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/setting-up-new-telegram-bot.png"/></noscript>
<h2>构建 Flask 应用程序</h2>
<p>Flask 是一个开源的 Python web 框架。它的轻量级代码库使它适合快速构建 web 应用程序。</p>
<p>对于这个例子，我们将构建一个 Flask 应用程序，作为一个字典。我们的应用程序将接收一个英语单词作为请求，并以关于该单词的信息做出响应，如其定义、示例、同义词和反义词。对于这个应用程序，我们将利用一个免费的<a href="https://dictionaryapi.dev/" target="_blank" rel="noopener">字典 API </a>。</p>
<p>首先，创建一个文件夹<code>Flask_Telegram</code>，将应用程序和<code>cd</code>包含到目录中。</p>
<pre class="language-python hljs">mkdir Flask_Telegram
cd Flask_Telegram</pre>
<p>安装<code>requests</code>库，向外部目录 API 发送 HTTP 请求:</p>
<pre class="language-python hljs">pip install requests</pre>
<p>接下来，创建一个<code>dictionary.py</code>文件，该文件将包含提供关于所请求单词的信息的逻辑。然后，添加以下代码片段:</p>
<pre class="language-python hljs">import os
import requests
from flask import Flask

app = Flask(__name__)


@app.route('/')
def get_info(word):

    url = 'https://api.dictionaryapi.dev/api/v2/entries/en/{}'.format(word)

    response = requests.get(url)

# return a custom response if an invalid word is provided
    if response.status_code == 404:
        error_response = 'We are not able to provide any information about your word. Please confirm that the word is ' \
                         'spelled correctly or try the search again at a later time.'
        return error_response

    data = response.json()[0]

    print(data)
    return data


get_info("food")


if __name__ == "__main__":
    port = int(os.environ.get('PORT', 5000))
    app.run(debug=True, host='0.0.0.0', port=port)</pre>
<p>在上面的示例<code>dictionary.py</code>文件中，<code>@app.route('/')</code>是应用程序的入口点。</p>
<p>当用户请求关于某个<code>word</code>的信息时，该值被传递给<code>get_info()</code>函数。然后，在将请求发送到字典 API 之前，我们将函数附加到<code>url</code>变量。</p>
<p>在执行任何附加操作之前，我们首先检查请求是否是一个有效的英语单词。对 dictionary API 的成功请求以列表的形式返回 JSON 数据。然后，我们从列表中提取 JSON 数据，并将其返回给客户机。但是，在无效的 word 请求的情况下，将返回 404 代码状态，并向用户显示一条自定义消息。</p>
<p>下面是应用程序收到关于<code>food</code>的信息请求时的预期响应:</p>
<p><img data-attachment-id="85105" data-permalink="https://blog.logrocket.com/build-deploy-telegram-bot-with-flask/flask-dictionary-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/flask-dictionary-output.png" data-orig-size="720,218" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Flask dictionary app output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/flask-dictionary-output-300x91.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/flask-dictionary-output.png" decoding="async" class="aligncenter wp-image-85105 size-full jetpack-lazy-image" src="../Images/de63123619afcef0325ef0f3d3d8260b.png" alt="Flask Dictionary App Output" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/flask-dictionary-output.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/01/flask-dictionary-output-300x91.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/flask-dictionary-output.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/flask-dictionary-output.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="85105" data-permalink="https://blog.logrocket.com/build-deploy-telegram-bot-with-flask/flask-dictionary-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/flask-dictionary-output.png" data-orig-size="720,218" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Flask dictionary app output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/flask-dictionary-output-300x91.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/flask-dictionary-output.png" decoding="async" loading="lazy" class="aligncenter wp-image-85105 size-full" src="../Images/de63123619afcef0325ef0f3d3d8260b.png" alt="Flask Dictionary App Output" srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/flask-dictionary-output.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/01/flask-dictionary-output-300x91.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/flask-dictionary-output.png"/></noscript>
<h2>将 Flask 应用程序与电报机器人集成在一起</h2>
<p>让我们通过将 Flask 字典脚本与 Telegram bot 集成来完成应用程序。</p>
<p>首先，创建一个新的 Python 文件<code>bot.py</code>，并添加以下代码片段:</p>
<pre class="language-python hljs">import telegram
from telegram.ext import Updater, MessageHandler, Filters
from telegram.ext import CommandHandler
from dictionary import get_info

telegram_bot_token = 

updater = Updater(token=telegram_bot_token, use_context=True)
dispatcher = updater.dispatcher


# set up the introductory statement for the bot when the /start command is invoked
def start(update, context):
    chat_id = update.effective_chat.id
    context.bot.send_message(chat_id=chat_id, text="Hello there. Provide any English word and I will give you a bunch "
                                                   "of information about it.")


# obtain the information of the word provided and format before presenting.
def get_word_info(update, context):
    # get the word info
    word_info = get_info(update.message.text)

    # If the user provides an invalid English word, return the custom response from get_info() and exit the function
    if word_info.__class__ is str:
        update.message.reply_text(word_info)
        return

    # get the word the user provided
    word = word_info['word']

    # get the origin of the word
    origin = word_info['origin']
    meanings = '\n'

    synonyms = ''
    definition = ''
    example = ''
    antonyms = ''

    # a word may have several meanings. We'll use this counter to track each of the meanings provided from the response
    meaning_counter = 1

    for word_meaning in word_info['meanings']:
        meanings += 'Meaning ' + str(meaning_counter) + ':\n'

        for word_definition in word_meaning['definitions']:
            # extract the each of the definitions of the word
            definition = word_definition['definition']

            # extract each example for the respective definition
            if 'example' in word_definition:
                example = word_definition['example']

            # extract the collection of synonyms for the word based on the definition
            for word_synonym in word_definition['synonyms']:
                synonyms += word_synonym + ', '

            # extract the antonyms of the word based on the definition
            for word_antonym in word_definition['antonyms']:
                antonyms += word_antonym + ', '

        meanings += 'Definition: ' + definition + '\n\n'
        meanings += 'Example: ' + example + '\n\n'
        meanings += 'Synonym: ' + synonyms + '\n\n'
        meanings += 'Antonym: ' + antonyms + '\n\n\n'

        meaning_counter += 1

    # format the data into a string
    message = f"Word: {word}\n\nOrigin: {origin}\n{meanings}"

    update.message.reply_text(message)

# run the start function when the user invokes the /start command 
dispatcher.add_handler(CommandHandler("start", start))

# invoke the get_word_info function when the user sends a message 
# that is not a command.
dispatcher.add_handler(MessageHandler(Filters.text, get_word_info))
updater.start_polling()</pre>
<p>在这个例子中，我们首先将电报模块和字典脚本导入<code>bot.py</code>文件。接下来，我们使用唯一的 HTTP 令牌初始化电报更新程序。</p>
<p><code>start(update, context)</code>函数包含在运行 bot 的<code>/start</code>命令时呈现自定义欢迎消息的逻辑。我们通过<code>context.bot.send_message</code>功能发起与用户的对话，使用<code>chat_id</code>来确定将响应定向到哪里。</p>
<p>在<code>get_word_info</code>函数中，我们执行逻辑来格式化从<code>dictionary.py</code>脚本中的<code>get_info</code>函数获得的数据。</p>
<p>如果用户提供一个有效的英文单词，<code>get_info</code>函数返回一个字典数据类型:<code>dict</code>。使用这种数据类型，我们执行进一步的操作，提取我们想要显示给用户的数据。提取的值然后被格式化成一个字符串，并存储在<code>message</code>变量中。</p>
<p>但是，如果用户提供了一个无效的英文单词，<code>get_info</code>函数将返回一个字符串数据类型:<code>str</code>。当这种情况发生时，在<code>dictionary.py</code>文件中创建的定制消息会显示给用户。</p>
<p>最后一步，我们告诉电报机器人在用户调用<code>/start</code>命令时执行启动功能，在用户发送非命令消息时执行<code>get_word_info</code>功能。</p>
<p><img data-attachment-id="85226" data-permalink="https://blog.logrocket.com/build-deploy-telegram-bot-with-flask/telegram-dictionary-bot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-dictionary-bot.gif" data-orig-size="600,745" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Telegram dictionary bot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-dictionary-bot-242x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-dictionary-bot.gif" decoding="async" class="aligncenter wp-image-85226 size-full jetpack-lazy-image" src="../Images/d19680a15f285d94e93b6c8b82f41e68.png" alt="Telegram Dictionary Bot" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-dictionary-bot.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-dictionary-bot.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="85226" data-permalink="https://blog.logrocket.com/build-deploy-telegram-bot-with-flask/telegram-dictionary-bot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-dictionary-bot.gif" data-orig-size="600,745" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Telegram dictionary bot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-dictionary-bot-242x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-dictionary-bot.gif" decoding="async" loading="lazy" class="aligncenter wp-image-85226 size-full" src="../Images/d19680a15f285d94e93b6c8b82f41e68.png" alt="Telegram Dictionary Bot" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/telegram-dictionary-bot.gif"/></noscript>
<h2>部署电报机器人</h2>
<p>让我们将应用程序部署到远程服务器上。我们将使用 Heroku 云平台来托管我们的应用程序。</p>
<p>如果您还没有 Heroku 帐户，您可以在此创建一个<a href="https://signup.heroku.com/" target="_blank" rel="noopener">。</a></p>
<p>要部署电报机器人，请遵循以下六个步骤:</p>
<h3>1.创建<code>requirements.txt</code>文件</h3>
<p><code>requirements.txt</code>文件包含应用程序成功运行所需的依赖项和各自的版本。</p>
<p>运行以下命令生成一个<code>requirements.txt</code>文件，其中包含用于构建电报机器人的依赖项:</p>
<pre class="language-python hljs">pip freeze &gt; requirements.txt</pre>
<p><code>requirements.txt</code>文件至少应包含以下包:</p>
<pre class="language-python hljs">python-telegram-bot==13.8.1
telegram==0.0.1
requests==2.25.1</pre>
<p>根据应用程序的类型，<code>requirements.txt</code>文件可能包含更多的包和不同的版本号。</p>
<h3>2.创建<code>Procfile</code></h3>
<p><code>Procfile</code>是一个文本文件，它定义了应用程序启动时应该在 Heroku 上运行的命令。</p>
<p>对于本例，在应用程序根目录中创建一个文件，并将其命名为<code>Procfile</code>。然后添加以下代码片段:</p>
<pre class="language-python hljs">web: python bot.py $PORT</pre>
<h3>3.创建 Heroku 应用程序</h3>
<p>使用以下命令指示 Heroku 创建具有指定名称的应用程序:</p>
<pre class="language-python hljs">heroku create</pre>
<p>成功运行此命令后，Heroku 将提供两个 URL:应用程序 URL 和远程 Git URL，Heroku 将通过这两个 URL 将应用程序部署到其服务器。</p>
<h3>4.添加应用程序构建包</h3>
<p>要查看应用程序，请访问 Heroku 仪表板。在<strong>设置</strong>选项卡中，点击<strong>添加 buildpack </strong>，选择<strong> heroku/python </strong>选项:</p>
<p><img data-attachment-id="85109" data-permalink="https://blog.logrocket.com/build-deploy-telegram-bot-with-flask/heroku-settings-app-name/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/heroku-settings-app-name.png" data-orig-size="720,344" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Heroku settings app name" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/heroku-settings-app-name-300x143.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/heroku-settings-app-name.png" decoding="async" class="aligncenter wp-image-85109 size-full jetpack-lazy-image" src="../Images/d98f9598fd913b949206c605b906a0ab.png" alt="Heroic Settings App Name" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/heroku-settings-app-name.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/01/heroku-settings-app-name-300x143.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/heroku-settings-app-name.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/heroku-settings-app-name.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="85109" data-permalink="https://blog.logrocket.com/build-deploy-telegram-bot-with-flask/heroku-settings-app-name/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/heroku-settings-app-name.png" data-orig-size="720,344" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Heroku settings app name" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/heroku-settings-app-name-300x143.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/heroku-settings-app-name.png" decoding="async" loading="lazy" class="aligncenter wp-image-85109 size-full" src="../Images/d98f9598fd913b949206c605b906a0ab.png" alt="Heroic Settings App Name" srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/heroku-settings-app-name.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/01/heroku-settings-app-name-300x143.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/heroku-settings-app-name.png"/></noscript>
<p><img data-attachment-id="85111" data-permalink="https://blog.logrocket.com/build-deploy-telegram-bot-with-flask/add-heroku-backpack/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/add-heroku-backpack.png" data-orig-size="720,120" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Add Heroku buildpack" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/add-heroku-backpack-300x50.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/add-heroku-backpack.png" decoding="async" class="aligncenter wp-image-85111 size-full jetpack-lazy-image" src="../Images/2f3ead373285772ac4253020b98bc150.png" alt="Add Heroku Buildpack" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/add-heroku-backpack.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/01/add-heroku-backpack-300x50.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/add-heroku-backpack.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/add-heroku-backpack.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="85111" data-permalink="https://blog.logrocket.com/build-deploy-telegram-bot-with-flask/add-heroku-backpack/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/add-heroku-backpack.png" data-orig-size="720,120" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Add Heroku buildpack" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/add-heroku-backpack-300x50.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/add-heroku-backpack.png" decoding="async" loading="lazy" class="aligncenter wp-image-85111 size-full" src="../Images/2f3ead373285772ac4253020b98bc150.png" alt="Add Heroku Buildpack" srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/add-heroku-backpack.png 720w, https://blog.logrocket.com/wp-content/uploads/2022/01/add-heroku-backpack-300x50.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/add-heroku-backpack.png"/></noscript>
<h3>5.修改<code>bot.py</code>文件</h3>
<p>在将机器人部署到 Heroku 之前，我们需要对文件<code>bot.py</code>的<code>updater.start_polling()</code>部分做一个小小的修改。</p>
<p>这一步是必不可少的，因为<code>updater.start_polling()</code>方法监控新消息的电报 API。因为我们将在远程 web 服务器上启动 bot，所以我们需要指示 Telegram 直接与 web 服务器通信。</p>
<p>用以下代码片段替换<code>updater.start_polling()</code>:</p>
<pre class="language-python hljs">updater.start_webhook(listen="0.0.0.0",
                      port=int(os.environ.get('PORT', 5000)),
                      url_path=telegram_bot_token,
                      webhook_url=  + telegram_bot_token
                      )</pre>
<h3>6.部署应用程序</h3>
<p>使用以下命令将 Telegram 应用程序部署到 Heroku:</p>
<pre class="language-python hljs">git add .
git commit -m "first commit"
git push heroku main</pre>
<h2>结论</h2>
<p>在本文中，我们演示了如何通过集成电报机器人和 Flask 来快速构建字典应用程序。这个项目在<a href="https://github.com/olu-damilare/dictionary_bot" target="_blank" rel="noopener"> GitHub </a>上有，你可以在这里和我们创建的<a href="https://t.me/dami_dictionaryBot" target="_blank" rel="noopener">字典机器人互动。</a></p>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>