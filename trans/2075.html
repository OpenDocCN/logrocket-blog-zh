<html>
<head>
<title>Build a chat app with react-native-gifted-chat - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用 react-native-gifted-chat-log rocket 博客构建一个聊天应用程序</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/build-chat-app-react-native-gifted-chat/#0001-01-01">https://blog.logrocket.com/build-chat-app-react-native-gifted-chat/#0001-01-01</a></blockquote><div><article class="article-post">
<p><strong> <em>编者按:</em> </strong> <em>本文于 2022 年 3 月 8 日更新，以反映 Firestore 的最新版本，并包括新的 Firebase SDK APIs。</em></p>
<p>随着实时通信需求的增长，开发人员正在寻找简单的方法来为移动应用程序添加可靠的通信渠道。在本教程中，我们将学习如何使用<a href="https://github.com/FaridSafi/react-native-gifted-chat" target="_blank" rel="noopener"> react-native-gifted-chat </a>在 React Native 中为 iOS 和 Android 构建移动聊天应用程序，react-native-gifted-chat 是一个聊天用户界面，旨在使应用程序开发人员能够构建跨平台的聊天应用程序。</p>
<p>要跟随本教程，您需要:</p>
<ul>
<li>CSS、HTML 和 Javascript ES6 的工作知识</li>
<li>安装在开发机器上的 Node.js 和 Watchman</li>
<li>用于测试的 iOS 模拟器或 Android 模拟器</li>
<li>安装在开发机器上的代码编辑器</li>
<li>React 和 React Native 的工作知识</li>
</ul>
<h2 id="contents">内容</h2>

<p>我们开始吧！</p>
<h2 id="react-native-gifted-chat-props">反应-原生-天赋-聊天道具</h2>
<p>让我们来看看我们将用来创建应用程序的几个内置道具:</p>
<ul>
<li><code>messages</code>(数组)显示消息</li>
<li><code>text</code>(字符串)，输入文本的类型。默认为<code>undefined</code></li>
<li><code>isTyping</code> (bool)处理打字指示器状态。默认为<code>false</code></li>
<li><code>timeFormat</code>(字符串)决定时间格式。默认为<code>LT</code></li>
<li><code>dateFormat</code>(字符串)决定日期格式。默认为<code>ll</code></li>
<li><code>placeholder</code>(文本)，空文本字段的占位符。默认为<code>Type a message...</code></li>
<li><code>user</code>(对象)，发送消息的用户的凭证，即<code>{_id, name, avatar}</code></li>
<li><code>messageIdGenerator</code>(函数)为每个新消息生成一个 id。<code>UUID</code>默认是<code>V4</code></li>
</ul>
<p>你可以在<a href="https://github.com/FaridSafi/react-native-gifted-chat#readme" target="_blank" rel="noopener">文档</a>中探索其他道具。</p>
<h2 id="installing-react-native-gifted-chat">安装 react-native-gifted-chat</h2>
<p>让我们从设置一个新的 React 原生应用程序开始。打开您的终端，导航到您的工作目录，并运行下面的命令来初始化一个新的 React 本机应用程序:</p>
<pre class="language-shell hljs">npx react-native init GiftedChatApp
</pre>
<p>安装完成后，导航到<code>GiftedChatApp</code>目录并运行以下命令来安装所需的依赖项:</p>
<pre class="language-shell hljs">cd GiftedChatApp &amp;&amp; npm install @react-navigation/native @react-navigation/stack react-native-gifted-chat react-native-reanimated react-native-gesture-handler react-native-screens react-native-safe-area-context @react-native-community/masked-view react-native-vector-icons
</pre>
<p>上面的命令将在您的项目中安装 React Navigation、react-native-gifted-chat 和其他必需的依赖项。如果你设置正确，一旦你用<code>npx react-native run-ios</code>或<code>npx react-native run-android</code>运行它，你的应用应该看起来像下面的截图:</p>
<p><img data-attachment-id="96912" data-permalink="https://blog.logrocket.com/build-chat-app-react-native-gifted-chat/react-native-gifted-chat-dependencies-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/react-native-gifted-chat-dependencies-1.png" data-orig-size="730,420" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="react-native-gifted-chat-dependencies" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/react-native-gifted-chat-dependencies-1-300x173.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/react-native-gifted-chat-dependencies-1.png" decoding="async" class="size-full wp-image-96912 aligncenter jetpack-lazy-image" src="../Images/b6e77dc35a11a422ce4422f1f075f65f.png" alt="react-native-gifted-chat dependencies" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/react-native-gifted-chat-dependencies-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/react-native-gifted-chat-dependencies-1-300x173.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/08/react-native-gifted-chat-dependencies-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/react-native-gifted-chat-dependencies-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="96912" data-permalink="https://blog.logrocket.com/build-chat-app-react-native-gifted-chat/react-native-gifted-chat-dependencies-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/react-native-gifted-chat-dependencies-1.png" data-orig-size="730,420" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="react-native-gifted-chat-dependencies" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/react-native-gifted-chat-dependencies-1-300x173.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/react-native-gifted-chat-dependencies-1.png" decoding="async" loading="lazy" class="size-full wp-image-96912 aligncenter" src="../Images/b6e77dc35a11a422ce4422f1f075f65f.png" alt="react-native-gifted-chat dependencies" srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/react-native-gifted-chat-dependencies-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/react-native-gifted-chat-dependencies-1-300x173.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/react-native-gifted-chat-dependencies-1.png"/></noscript>
<h2 id="building-login-screen">构建登录屏幕</h2>
<p>在我们开始构建登录屏幕之前，让我们更新代码，使<code>App.js</code>允许屏幕导航。打开<code>App.js</code>，然后复制并粘贴下面的代码:</p>
<pre class="language-javascript hljs">import React from 'react';
import { createStackNavigator } from '@react-navigation/stack'
import { NavigationContainer } from '@react-navigation/native';
import LoginScreen from './screens/Login';

const Stack = createStackNavigator();

const App = () =&gt; {
  return (
    &lt;NavigationContainer&gt;
      &lt;Stack.Navigator &gt;
        &lt;Stack.Screen name='Login' component={LoginScreen} /&gt;
      &lt;/Stack.Navigator&gt;
    &lt;/NavigationContainer&gt;
  );
};

export default App;
</pre>
<p>让我们安装最后一个依赖项。React Native Elements 是一个 UI 工具包，允许您轻松创建表单元素和图标。要安装 React 本地元素，请在您的终端中运行以下代码:</p>
<pre class="language-shell hljs">npm install react-native-elements
</pre>
<p>接下来，导航到您的项目目录，创建一个名为<code>screens</code>的新文件夹，创建一个名为<code>Login.js</code>的新文件，然后将下面的代码复制并粘贴到<code>Login.js</code>中:</p>
<pre class="language-javascript hljs">import React, { useState } from 'react';
import { View, StyleSheet } from 'react-native'
import { Input, Button } from 'react-native-elements';
import Icon from 'react-native-vector-icons/FontAwesome';

const Login = ({navigation}) =&gt; {
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');

    return (
        &lt;View style={styles.container}&gt;
            &lt;Input
                placeholder='Enter your email'
                label='Email'
                leftIcon={{ type: 'material', name: 'email' }}
                value={email}
                onChangeText={text =&gt; setEmail(text)}
            /&gt;
            &lt;Input
                placeholder='Enter your password'
                label='Password'
                leftIcon={{ type: 'material', name: 'lock' }}
                value={password}
                onChangeText={text =&gt; setPassword(text)}
                secureTextEntry
            /&gt;
            &lt;Button title='sign in' style={styles.button} /&gt;
            &lt;Button title='register' style={styles.button} /&gt;
        &lt;/View&gt;
    )
}
const styles = StyleSheet.create({
    container: {
        flex: 1,
        alignItems: 'center',
        padding: 10,
        marginTop: 100,
    },
    button: {
        width: 370,
        marginTop: 10
    }
});

export default Login;
</pre>
<p>在上面的代码块中，我们导入了<code>useState()</code>钩子，创建了两个状态来存储<code>email</code>和<code>password</code>字段，使用 React 本地元素创建了登录输入字段，最后添加了样式。</p>
<p>现在，运行<code>npx react-native run-ios</code>或<code>npx react-native run-android</code>，你的应用应该如下图所示:</p>
<p><img data-attachment-id="96914" data-permalink="https://blog.logrocket.com/build-chat-app-react-native-gifted-chat/install-react-native-elements-gifted-chat-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Install-React-Native-Elements-Gifted-Chat.png" data-orig-size="730,418" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Install-React-Native-Elements-Gifted-Chat" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Install-React-Native-Elements-Gifted-Chat-300x172.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Install-React-Native-Elements-Gifted-Chat.png" decoding="async" class="size-full wp-image-96914 aligncenter jetpack-lazy-image" src="../Images/4e1270c629e971648bf44d1b29f142f5.png" alt="Install React Native Elements Gifted Chat" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/Install-React-Native-Elements-Gifted-Chat.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/Install-React-Native-Elements-Gifted-Chat-300x172.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/08/Install-React-Native-Elements-Gifted-Chat.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/Install-React-Native-Elements-Gifted-Chat.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="96914" data-permalink="https://blog.logrocket.com/build-chat-app-react-native-gifted-chat/install-react-native-elements-gifted-chat-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Install-React-Native-Elements-Gifted-Chat.png" data-orig-size="730,418" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Install-React-Native-Elements-Gifted-Chat" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Install-React-Native-Elements-Gifted-Chat-300x172.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Install-React-Native-Elements-Gifted-Chat.png" decoding="async" loading="lazy" class="size-full wp-image-96914 aligncenter" src="../Images/4e1270c629e971648bf44d1b29f142f5.png" alt="Install React Native Elements Gifted Chat" srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/Install-React-Native-Elements-Gifted-Chat.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/Install-React-Native-Elements-Gifted-Chat-300x172.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/Install-React-Native-Elements-Gifted-Chat.png"/></noscript>
<h2 id="building-registration-screen">构建注册屏幕</h2>
<p>现在，让我们构建一个注册屏幕，向我们的应用程序添加新用户。</p>
<p>导航到<code>screens</code>文件夹，创建一个名为<code>Register.js</code>的新文件，然后复制并粘贴以下代码:</p>
<pre class="language-javascript hljs">import React, { useState } from 'react';
import { View, StyleSheet } from 'react-native'
import { Input, Button } from 'react-native-elements';

const Register = () =&gt; {
    const [name, setName] = useState('');
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [avatar, setAvatar] = useState('');

    return (
        &lt;View style={styles.container}&gt;
            &lt;Input
                placeholder='Enter your name'
                label='Name'
                value={name}
                onChangeText={text =&gt; setName(text)}
            /&gt;
            &lt;Input
                placeholder='Enter your email'
                label='Email'
                value={email}
                onChangeText={text =&gt; setEmail(text)}
            /&gt;
            &lt;Input
                placeholder='Enter your password'
                label='Password'
                value={password} onChangeText={text =&gt; setPassword(text)}
                secureTextEntry
            /&gt;
            &lt;Input
                placeholder='Enter your image url'
                label='Profile Picture'
                value = {avatar}
                onChangeText={text =&gt; setAvatar(text)}
            /&gt;
            &lt;Button title='register' style={styles.button} /&gt;
        &lt;/View&gt;
    )
}
const styles = StyleSheet.create({
    container: {
        flex: 1,
        alignItems: 'center',
        padding: 10,
        marginTop: 100,
    },
    button: {
        width: 370,
        marginTop: 10
    }
});

export default Register;
</pre>
<h2 id="setting-up-firebase-react-native">为 React Native 设置 Firebase</h2>
<p>现在，您已经完成了登录和注册屏幕的构建，让我们将 Firebase 添加到我们的应用程序中来验证用户。</p>
<p>通过运行以下代码安装 Firebase:</p>
<pre class="language-shell hljs">npm install --save firebase
</pre>
<p>以上命令将安装最新的 Firebase web SDK 版本。在本教程中，我们将使用 Firebase v.9 模块化库。现在，去<a href="https://firebase.google.com"> Firebase 网站</a>创建一个名为天才聊天应用的新项目:</p>
<p><img data-attachment-id="96916" data-permalink="https://blog.logrocket.com/build-chat-app-react-native-gifted-chat/firebase-project-new-react-native-project-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Project-New-React-Native-Project.png" data-orig-size="730,390" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Firebase Project New React Native Project" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Project-New-React-Native-Project-300x160.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Project-New-React-Native-Project.png" decoding="async" class="size-full wp-image-96916 aligncenter jetpack-lazy-image" src="../Images/ed701815a129caac27e937ddabfed8c8.png" alt="Firebase Project New React Native Project" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Project-New-React-Native-Project.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Project-New-React-Native-Project-300x160.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Project-New-React-Native-Project.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Project-New-React-Native-Project.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="96916" data-permalink="https://blog.logrocket.com/build-chat-app-react-native-gifted-chat/firebase-project-new-react-native-project-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Project-New-React-Native-Project.png" data-orig-size="730,390" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Firebase Project New React Native Project" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Project-New-React-Native-Project-300x160.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Project-New-React-Native-Project.png" decoding="async" loading="lazy" class="size-full wp-image-96916 aligncenter" src="../Images/ed701815a129caac27e937ddabfed8c8.png" alt="Firebase Project New React Native Project" srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Project-New-React-Native-Project.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Project-New-React-Native-Project-300x160.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Project-New-React-Native-Project.png"/></noscript>
<p>接下来，我们将向刚刚创建的 Firebase 项目添加一个 web 应用程序。在项目的根目录下创建一个名为<code>firebase.js</code>的新文件。从下面的屏幕中复制<code>firebaseConfig</code>凭证:</p>
<p><img data-attachment-id="96918" data-permalink="https://blog.logrocket.com/build-chat-app-react-native-gifted-chat/firebase-config-credentials-add-web-app-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Config-Credentials-Add-Web-App.png" data-orig-size="730,354" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Firebase Config Credentials Add Web App" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Config-Credentials-Add-Web-App-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Config-Credentials-Add-Web-App.png" decoding="async" class="size-full wp-image-96918 aligncenter jetpack-lazy-image" src="../Images/15733807d44193a373e63779cfc54c46.png" alt="Firebase Config Credentials Add Web App" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Config-Credentials-Add-Web-App.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Config-Credentials-Add-Web-App-300x145.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Config-Credentials-Add-Web-App.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Config-Credentials-Add-Web-App.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="96918" data-permalink="https://blog.logrocket.com/build-chat-app-react-native-gifted-chat/firebase-config-credentials-add-web-app-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Config-Credentials-Add-Web-App.png" data-orig-size="730,354" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Firebase Config Credentials Add Web App" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Config-Credentials-Add-Web-App-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Config-Credentials-Add-Web-App.png" decoding="async" loading="lazy" class="size-full wp-image-96918 aligncenter" src="../Images/15733807d44193a373e63779cfc54c46.png" alt="Firebase Config Credentials Add Web App" srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Config-Credentials-Add-Web-App.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Config-Credentials-Add-Web-App-300x145.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/Firebase-Config-Credentials-Add-Web-App.png"/></noscript>
<p>用您项目的独特详细信息替换当前在<code>firebaseConfig</code>中的凭证:</p>
<pre class="language-javascript hljs">import { initializeApp, getApp } from 'firebase/app';
import { initializeFirestore } from 'firebase/firestore';
import { getAuth } from 'firebase/auth';

const firebaseConfig = {
  apiKey: 'your_api_key',
  authDomain: 'your_auth_domain',
  projectId: 'your_project_id',
  storageBucket: 'your_storage_bucket',
  messagingSenderId: 'your_messaging_sender_id',
  appId: 'your_app_id',
  measurementId: 'your_measurement_id' // optional
};

const app = initializeApp(firebaseConfig);

const auth = getAuth(app);
const db = initializeFirestore(app, {experimentalForceLongPolling: true});

export { db, auth };
</pre>
<p>上述模块初始化一个 Firebase 应用程序和 Firestore 数据库连接。它还返回初始化的 Firestore 连接实例作为<code>db</code>和认证实例作为<code>auth</code>。</p>
<h2 id="authenticating-user-firebase">使用 Firebase 认证用户</h2>
<p>让我们使用<code>email</code>和<code>password</code>通过 Firebase 启用用户<a href="https://blog.logrocket.com/storing-retrieving-data-react-native-apps-firebase/" target="_blank" rel="noopener">认证。在 Firebase 控制台的工具条菜单中点击<strong>认证</strong>，选择<code>Email/Password</code>。</a></p>
<p>接下来，选择<strong>使能</strong>和<strong>保存</strong>:</p>
<p><img data-attachment-id="96922" data-permalink="https://blog.logrocket.com/build-chat-app-react-native-gifted-chat/add-authentication-firebase-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Add-Authentication-Firebase.png" data-orig-size="730,391" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Add Authentication Firebase" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Add-Authentication-Firebase-300x161.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Add-Authentication-Firebase.png" decoding="async" class="size-full wp-image-96922 aligncenter jetpack-lazy-image" src="../Images/4ae00d87adfae21e46d53000f7691d87.png" alt="Add Authentication Firebase" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/Add-Authentication-Firebase.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/Add-Authentication-Firebase-300x161.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/08/Add-Authentication-Firebase.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/Add-Authentication-Firebase.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="96922" data-permalink="https://blog.logrocket.com/build-chat-app-react-native-gifted-chat/add-authentication-firebase-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Add-Authentication-Firebase.png" data-orig-size="730,391" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Add Authentication Firebase" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Add-Authentication-Firebase-300x161.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Add-Authentication-Firebase.png" decoding="async" loading="lazy" class="size-full wp-image-96922 aligncenter" src="../Images/4ae00d87adfae21e46d53000f7691d87.png" alt="Add Authentication Firebase" srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/Add-Authentication-Firebase.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/Add-Authentication-Firebase-300x161.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/Add-Authentication-Firebase.png"/></noscript>
<p>现在 Firebase 的设置和配置已经完成，让我们更新<code>Register.js</code>文件来认证一个新用户。</p>
<p>首先，添加以下与 Firebase 相关的导入:</p>
<pre class="language-javascript hljs">import { auth } from '../firebase';
import { createUserWithEmailAndPassword, updateProfile } from 'firebase/auth';
</pre>
<p>复制下面的代码，并将其放在<code>Register</code>函数的<code>return</code>关键字之上:</p>
<pre class="language-javascript hljs">const register = () =&gt; {
  createUserWithEmailAndPassword(auth, email, password)
    .then((userCredential) =&gt; {
        // Registered
        const user = userCredential.user;
        updateProfile(user, {
            displayName: name,
            photoURL: avatar ? avatar : 'https://gravatar.com/avatar/94d45dbdba988afacf30d916e7aaad69?s=200&amp;d=mp&amp;r=x',
        })
        .then(() =&gt; {
            alert('Registered, please login.');
        })
        .catch((error) =&gt; {
            alert(error.message);
        })
    })
    .catch((error) =&gt; {
        const errorCode = error.code;
        const errorMessage = error.message;
        alert(errorMessage);
    });
}
</pre>
<p>首先，我们从之前创建的<code>firebase.js</code>文件中导入了<code>auth</code>对象。接下来，我们创建了一个<code>register</code>函数，并将<code>auth</code>对象、新用户的电子邮件和密码传递给了<code>createUserWithEmailAndPassword</code>方法。最后，我们用<code>name</code>和<code>avatar</code>更新了用户的凭证。</p>
<p>接下来，我们将用<code>onPress</code>处理程序将注册函数传递给注册按钮:</p>
<pre class="language-javascript hljs">&lt;Button title='register' onPress={register} style={styles.button} /&gt;
</pre>
<p>下面是经过上述修改后的<code>Register.js</code>文件的完整源代码:</p>
<pre class="language-javascript hljs">import React, { useState } from 'react';
import { View, StyleSheet } from 'react-native'
import { Input, Button } from 'react-native-elements';
import { auth } from '../firebase';
import { createUserWithEmailAndPassword, updateProfile } from 'firebase/auth';

const Register = () =&gt; {
    const [name, setName] = useState('');
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [avatar, setAvatar] = useState('');

    const register = () =&gt; {
      createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) =&gt; {
            // Registered
            const user = userCredential.user;
            updateProfile(user, {
                displayName: name,
                photoURL: avatar ? avatar : 'https://gravatar.com/avatar/94d45dbdba988afacf30d916e7aaad69?s=200&amp;d=mp&amp;r=x',
            })
            .then(() =&gt; {
              alert('Registered, please login.');
            })
            .catch((error) =&gt; {
                alert(error.message);
            })
        })
        .catch((error) =&gt; {
            const errorCode = error.code;
            const errorMessage = error.message;
            alert(errorMessage);
        });
    }

    return (
        &lt;View style={styles.container}&gt;
            &lt;Input
                placeholder='Enter your name'
                label='Name'
                value={name}
                onChangeText={text =&gt; setName(text)}
            /&gt;
            &lt;Input
                placeholder='Enter your email'
                label='Email'
                value={email}
                onChangeText={text =&gt; setEmail(text)}
            /&gt;
            &lt;Input
                placeholder='Enter your password'
                label='Password'
                value={password} onChangeText={text =&gt; setPassword(text)}
                secureTextEntry
            /&gt;
            &lt;Input
                placeholder='Enter your image url'
                label='Profile Picture'
                value = {avatar}
                onChangeText={text =&gt; setAvatar(text)}
            /&gt;
            &lt;Button title='register' onPress={register} style={styles.button} /&gt;
        &lt;/View&gt;
    )
}
const styles = StyleSheet.create({
    container: {
        flex: 1,
        alignItems: 'center',
        padding: 10,
        marginTop: 100,
    },
    button: {
        width: 370,
        marginTop: 10
    }
});

export default Register;
</pre>
<p>接下来，通过更新<code>App.js</code>文件将注册屏幕添加到导航堆栈，如以下代码所示:</p>
<pre class="language-javascript hljs">import React from 'react';
import {
  StyleSheet,
} from 'react-native';

import { createStackNavigator } from '@react-navigation/stack'
import { NavigationContainer } from '@react-navigation/native';
import LoginScreen from './screens/Login';
import RegisterScreen from './screens/Register';

const Stack = createStackNavigator();

const App = () =&gt; {
  return (
    &lt;NavigationContainer&gt;
      &lt;Stack.Navigator &gt;
        &lt;Stack.Screen name='Login' component={LoginScreen} /&gt;
        &lt;Stack.Screen name='Register' component={RegisterScreen} /&gt;
      &lt;/Stack.Navigator&gt;
    &lt;/NavigationContainer&gt;
  );
};

export default App;
</pre>
<p>此外，我们需要添加一个从登录屏幕到注册屏幕的导航动作，因此将以下代码添加到<code>Login.js</code>文件中:</p>
<pre class="language-javascript hljs">import React, { useState } from 'react';
import { View, StyleSheet } from 'react-native'
import { Input, Button } from 'react-native-elements';
import Icon from 'react-native-vector-icons/FontAwesome';

const Login = ({navigation}) =&gt; {
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');

    const openRegisterScreen = () =&gt; {
      navigation.navigate('Register');
    };

    return (
        &lt;View style={styles.container}&gt;
            &lt;Input
                placeholder='Enter your email'
                label='Email'
                leftIcon={{ type: 'material', name: 'email' }}
                value={email}
                onChangeText={text =&gt; setEmail(text)}
            /&gt;
            &lt;Input
                placeholder='Enter your password'
                label='Password'
                leftIcon={{ type: 'material', name: 'lock' }}
                value={password}
                onChangeText={text =&gt; setPassword(text)}
                secureTextEntry
            /&gt;
            &lt;Button title='sign in' style={styles.button} /&gt;
            &lt;Button title="register" style={styles.button} onPress={openRegisterScreen} /&gt;
        &lt;/View&gt;
    )
}
const styles = StyleSheet.create({
    container: {
        flex: 1,
        alignItems: 'center',
        padding: 10,
        marginTop: 100,
    },
    button: {
        width: 370,
        marginTop: 10
    }
});

export default Login;
</pre>
<p>现在，您可以从您的应用程序中注册一个新用户，并在 Firebase 控制台中列出他们:</p>
<p><img data-attachment-id="96925" data-permalink="https://blog.logrocket.com/build-chat-app-react-native-gifted-chat/register-new-user-firebase-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Register-New-User-Firebase.png" data-orig-size="730,388" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Register New User Firebase" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Register-New-User-Firebase-300x159.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Register-New-User-Firebase.png" decoding="async" class="size-full wp-image-96925 aligncenter jetpack-lazy-image" src="../Images/f4ae6ee0e5402e2c9357ae5432251951.png" alt="Register New User Firebase" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/Register-New-User-Firebase.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/Register-New-User-Firebase-300x159.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/08/Register-New-User-Firebase.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/Register-New-User-Firebase.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="96925" data-permalink="https://blog.logrocket.com/build-chat-app-react-native-gifted-chat/register-new-user-firebase-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Register-New-User-Firebase.png" data-orig-size="730,388" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Register New User Firebase" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Register-New-User-Firebase-300x159.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/Register-New-User-Firebase.png" decoding="async" loading="lazy" class="size-full wp-image-96925 aligncenter" src="../Images/f4ae6ee0e5402e2c9357ae5432251951.png" alt="Register New User Firebase" srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/Register-New-User-Firebase.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/Register-New-User-Firebase-300x159.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/Register-New-User-Firebase.png"/></noscript>
<h2 id="building-chat-screen">构建聊天屏幕</h2>
<p>接下来，我们将构建聊天屏幕，在成功登录后，我们将在其中重定向用户。<br/>在<code>screens</code>目录下创建一个名为<code>Chat.js</code>的新文件。</p>
<p>要创建一个基本的聊天应用程序，请将下面的代码复制并粘贴到文件中:</p>
<pre class="language-javascript hljs">import React, { useEffect, useCallback, useState, useLayoutEffect } from 'react';
import { View, Text, StyleSheet, TouchableOpacity } from 'react-native';
import { Avatar } from 'react-native-elements';
import { auth, db } from '../firebase';
import { signOut } from 'firebase/auth';
import { GiftedChat } from 'react-native-gifted-chat';

const Chat = ({ navigation }) =&gt; {
    const [messages, setMessages] = useState([]);
    const signOutNow = () =&gt; {
        signOut(auth).then(() =&gt; {
            // Sign-out successful.
            navigation.replace('Login');
        }).catch((error) =&gt; {
            // An error happened.
        });
    }
    useLayoutEffect(() =&gt; {
        navigation.setOptions({
            headerLeft: () =&gt; (
                &lt;View style={{ marginLeft: 20 }}&gt;
                    &lt;Avatar
                        rounded
                        source={{
                            uri: auth?.currentUser?.photoURL,
                        }}
                    /&gt;
                &lt;/View&gt;
            ),
            headerRight: () =&gt; (
                &lt;TouchableOpacity style={{
                    marginRight: 10
                }}
                    onPress={signOutNow}
                &gt;
                    &lt;Text&gt;logout&lt;/Text&gt;
                &lt;/TouchableOpacity&gt;
            )
        })
    }, [navigation]);

    useEffect(() =&gt; {
        setMessages([
            {
                _id: 1,
                text: 'Hello developer',
                createdAt: new Date(),
                user: {
                    _id: 2,
                    name: 'React Native',
                    avatar: 'https://placeimg.com/140/140/any',
                },
            },
        ])
    }, []);
    const onSend = useCallback((messages = []) =&gt; {
        setMessages(previousMessages =&gt; GiftedChat.append(previousMessages, messages))
    }, []);
    return (
        &lt;GiftedChat
            messages={messages}
            showAvatarForEveryMessage={true}
            onSend={messages =&gt; onSend(messages)}
            user={{
                _id: auth?.currentUser?.email,
                name: auth?.currentUser?.displayName,
                avatar: auth?.currentUser?.photoURL
            }}
        /&gt;
    );
}

export default Chat;
</pre>
<p>使用 Firebase <code>auth</code>对象，我们创建了<code>messages</code>状态和一个处理用户注销的函数。接下来，我们创建了一个基本的导航效果，用一个<code>useLayoutEffect</code>包装标题<code>nav</code>。</p>
<p>使用<code>useEffect</code>钩子，我们创建了一个虚拟消息，并将其安装到<code>GiftedChat</code>组件上。<code>GiftedChat</code>组件上的<code>user</code>道具指的是当前登录的用户，在本例中就是你。</p>
<p>我们需要实现登录特性来打开聊天屏幕，所以用下面的代码替换当前的登录屏幕源代码来完成 Firebase 身份验证。</p>
<pre class="language-javascript hljs">import React, { useState } from 'react';
import { View, StyleSheet } from 'react-native'
import { Input, Button } from 'react-native-elements';
import { auth } from '../firebase';
import { signInWithEmailAndPassword } from 'firebase/auth';
import Icon from 'react-native-vector-icons/FontAwesome';

const Login = ({navigation}) =&gt; {
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');

    const openRegisterScreen = () =&gt; {
      navigation.navigate('Register');
    };

    const signin = () =&gt; {
      signInWithEmailAndPassword(auth, email, password)
        .then((userCredential) =&gt; {
          navigation.navigate('Chat');
        })
        .catch((error) =&gt; {
          const errorCode = error.code;
          const errorMessage = error.message;
          alert(errorMessage);
        });
    };

    return (
        &lt;View style={styles.container}&gt;
            &lt;Input
                placeholder='Enter your email'
                label='Email'
                leftIcon={{ type: 'material', name: 'email' }}
                value={email}
                onChangeText={text =&gt; setEmail(text)}
            /&gt;
            &lt;Input
                placeholder='Enter your password'
                label='Password'
                leftIcon={{ type: 'material', name: 'lock' }}
                value={password}
                onChangeText={text =&gt; setPassword(text)}
                secureTextEntry
            /&gt;
            &lt;Button title="sign in" style={styles.button} onPress={signin} /&gt;
            &lt;Button title="register" style={styles.button} onPress={openRegisterScreen} /&gt;
        &lt;/View&gt;
    )
}
const styles = StyleSheet.create({
    container: {
        flex: 1,
        alignItems: 'center',
        padding: 10,
        marginTop: 100,
    },
    button: {
        width: 370,
        marginTop: 10
    }
});

export default Login;
</pre>
<p>接下来，我们需要将聊天屏幕组件添加到导航堆栈中。用以下代码替换<code>App.js</code>源文件内容，完成主应用程序屏幕实现:</p>
<pre class="language-javascript hljs">import React from 'react';
import {
  StyleSheet,
} from 'react-native';

import { createStackNavigator } from '@react-navigation/stack'
import { NavigationContainer } from '@react-navigation/native';
import LoginScreen from './screens/Login';
import RegisterScreen from './screens/Register';
import ChatScreen from './screens/Chat';

const Stack = createStackNavigator();

const App = () =&gt; {
  return (
    &lt;NavigationContainer&gt;
      &lt;Stack.Navigator &gt;
        &lt;Stack.Screen name='Login' component={LoginScreen} /&gt;
        &lt;Stack.Screen name='Register' component={RegisterScreen} /&gt;
        &lt;Stack.Screen name='Chat' component={ChatScreen} /&gt;
      &lt;/Stack.Navigator&gt;
    &lt;/NavigationContainer&gt;
  );
};

export default App;
</pre>
<p>现在，在您使用正确的用户名和密码登录后，您的应用程序应该看起来像下面的屏幕截图:</p>
<p><img data-attachment-id="96932" data-permalink="https://blog.logrocket.com/build-chat-app-react-native-gifted-chat/react-native-gifted-chat-dummy-message-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/React-Native-Gifted-Chat-Dummy-Message.png" data-orig-size="730,419" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React Native Gifted Chat Dummy Message" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/React-Native-Gifted-Chat-Dummy-Message-300x172.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/React-Native-Gifted-Chat-Dummy-Message.png" decoding="async" class="size-full wp-image-96932 aligncenter jetpack-lazy-image" src="../Images/209da5fc26f15398db7bfe1bb31ecfbc.png" alt="React Native Gifted Chat Dummy Message" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/React-Native-Gifted-Chat-Dummy-Message.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/React-Native-Gifted-Chat-Dummy-Message-300x172.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/08/React-Native-Gifted-Chat-Dummy-Message.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/React-Native-Gifted-Chat-Dummy-Message.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="96932" data-permalink="https://blog.logrocket.com/build-chat-app-react-native-gifted-chat/react-native-gifted-chat-dummy-message-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/React-Native-Gifted-Chat-Dummy-Message.png" data-orig-size="730,419" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React Native Gifted Chat Dummy Message" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/React-Native-Gifted-Chat-Dummy-Message-300x172.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/React-Native-Gifted-Chat-Dummy-Message.png" decoding="async" loading="lazy" class="size-full wp-image-96932 aligncenter" src="../Images/209da5fc26f15398db7bfe1bb31ecfbc.png" alt="React Native Gifted Chat Dummy Message" srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/React-Native-Gifted-Chat-Dummy-Message.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/React-Native-Gifted-Chat-Dummy-Message-300x172.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/React-Native-Gifted-Chat-Dummy-Message.png"/></noscript>
<p>目前，我们聊天应用中的消息不会存储在任何地方。为了在<code>firestore</code>中存储消息，我们将修改<code>onSend</code>函数:</p>
<pre class="language-javascript hljs">const onSend = useCallback((messages = []) =&gt; {
    setMessages(previousMessages =&gt; GiftedChat.append(previousMessages, messages))
    const { _id, createdAt, text, user,} = messages[0]

    addDoc(collection(db, 'chats'), { _id, createdAt,  text, user });
}, []);
</pre>
<p>上面的代码片段需要以下新的导入:</p>
<pre class="language-javascript hljs">import { collection, addDoc } from 'firebase/firestore';
</pre>
<p>此外，确保为 Firestore 控制台添加相关权限，以满足开发需求。例如，以下配置允许所有登录用户读/写整个数据库:</p>
<pre class="language-javascript hljs">rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
</pre>
<p>为了检索来自<code>firestore</code>的旧消息，我们将使用<code>useLayoutEffect</code>调用数据库。将下面的代码复制并粘贴到现有的<code>useLayoutEffect</code>钩子回调函数中，以加载聊天屏幕上的旧消息:</p>
<pre class="language-javascript hljs">const q = query(collection(db, 'chats'), orderBy('createdAt', 'desc'));
const unsubscribe = onSnapshot(q, (snapshot) =&gt; setMessages(
    snapshot.docs.map(doc =&gt; ({
        _id: doc.data()._id,
        createdAt: doc.data().createdAt.toDate(),
        text: doc.data().text,
        user: doc.data().user,
    }))
));

return () =&gt; {
  unsubscribe();
};
</pre>
<p>使用基于远程 Firestore 的实时消息支持查看完整的<code>Chat.js</code>源代码:</p>
<pre class="language-javascript hljs">import React, { useCallback, useState, useLayoutEffect } from 'react';
import { View, Text, StyleSheet, TouchableOpacity } from 'react-native';
import { Avatar } from 'react-native-elements';
import { auth, db } from '../firebase';
import { signOut } from 'firebase/auth';
import { collection, addDoc, getDocs, query, orderBy, onSnapshot } from 'firebase/firestore';
import { GiftedChat } from 'react-native-gifted-chat';

const Chat = ({ navigation }) =&gt; {
    const [messages, setMessages] = useState([]);
    const signOutNow = () =&gt; {
        signOut(auth).then(() =&gt; {
            // Sign-out successful.
            navigation.replace('Login');
        }).catch((error) =&gt; {
            // An error happened.
        });
    }
    useLayoutEffect(() =&gt; {
        navigation.setOptions({
            headerLeft: () =&gt; (
                &lt;View style={{ marginLeft: 20 }}&gt;
                    &lt;Avatar
                        rounded
                        source={{
                            uri: auth?.currentUser?.photoURL,
                        }}
                    /&gt;
                &lt;/View&gt;
            ),
            headerRight: () =&gt; (
                &lt;TouchableOpacity style={{
                    marginRight: 10
                }}
                    onPress={signOutNow}
                &gt;
                    &lt;Text&gt;logout&lt;/Text&gt;
                &lt;/TouchableOpacity&gt;
            )
        })

        const q = query(collection(db, 'chats'), orderBy('createdAt', 'desc'));
        const unsubscribe = onSnapshot(q, (snapshot) =&gt; setMessages(
            snapshot.docs.map(doc =&gt; ({
                _id: doc.data()._id,
                createdAt: doc.data().createdAt.toDate(),
                text: doc.data().text,
                user: doc.data().user,
            }))
        ));

        return () =&gt; {
          unsubscribe();
        };

    }, [navigation]);

    const onSend = useCallback((messages = []) =&gt; {
        const { _id, createdAt, text, user,} = messages[0]

        addDoc(collection(db, 'chats'), { _id, createdAt,  text, user });
    }, []);

    return (
        &lt;GiftedChat
            messages={messages}
            showAvatarForEveryMessage={true}
            onSend={messages =&gt; onSend(messages)}
            user={{
                _id: auth?.currentUser?.email,
                name: auth?.currentUser?.displayName,
                avatar: auth?.currentUser?.photoURL
            }}
        /&gt;
    );
}

export default Chat;
</pre>
<p>注意，我们在<code>onSnapshot</code>监听器中只使用了一个<code>setMessages</code>函数调用，以避免不必要的多种状态变化。在模拟器/仿真器和一个真实的物理设备上尝试两个调试应用程序实例，以测试实时消息传递应用程序。</p>
<h2 id="conclusion">结论</h2>
<p>现在，您知道如何使用 React Native 和 Firebase 构建具有跨平台兼容性的标准聊天应用程序了！我们的应用程序允许我们在多个设备之间与无限数量的用户聊天。您可以通过添加聊天声音、表情符号支持、主题、输入指示器动画、可触摸链接、离线通知、离线消息持久性和各种其他现代聊天应用程序功能来进一步扩展该应用程序。</p>
<p>React-native-gifted-chat 是在 React Native 中实现聊天的一个很好的工具，可以帮助您改善应用程序内部的通信。你可以在官方文档中阅读更多关于<a href="https://www.npmjs.com/package/react-native-gifted-chat" target="_blank" rel="noopener"> react-native-gifted-chat </a>和<a href="https://firebase.google.com/docs/auth/web/start" target="_blank" rel="noopener"> Firebase 认证</a>的内容。此外，你可以从官方<a href="https://firebase.google.com/docs/reference/js" target="_blank" rel="noopener"> Firebase JavaScript API 参考</a>了解更多 Firebase SDK 特性。</p><div class="code-block code-block-18">
<div class="blog-plug inline-plug react-native-plug"><h2><a href="https://lp.logrocket.com/blg/react-native-signup"> LogRocket </a>:即时重现 React 原生应用中的问题。</h2><a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/110055665562c1e02069b3698e6cc671.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/110055665562c1e02069b3698e6cc671.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/></noscript></a><p><a href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一款 React 原生监控解决方案，可帮助您即时重现问题、确定 bug 的优先级并了解 React 原生应用的性能。</p><p>LogRocket 还可以向你展示用户是如何与你的应用程序互动的，从而帮助你提高转化率和产品使用率。LogRocket 的产品分析功能揭示了用户不完成特定流程或不采用新功能的原因。</p><p>开始主动监控您的 React 原生应用— <a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer">免费试用 LogRocket】。</a></p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>