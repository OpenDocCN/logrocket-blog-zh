<html>
<head>
<title>Integrating Web3 into Vue applications - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>将 Web3 集成到 Vue 应用程序中</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/integrate-web3-into-vue/#0001-01-01">https://blog.logrocket.com/integrate-web3-into-vue/#0001-01-01</a></blockquote><div><article class="article-post">
<p>有了 Web3，就有可能在区块链网络上构建分散的应用程序，让用户完全拥有自己的数据。区块链网络使用智能合约来处理分散应用程序的所有后端逻辑。</p>
<p>作为最受欢迎的，<a href="https://blog.logrocket.com/deploy-ethereum-smart-contracts-cosmos-ecosystem/">可编程区块链网络，以太坊</a>允许开发者构建和操作去中心化应用(DApps)、去中心化金融(DeFi)、智能合约和不可替代令牌(NFT)。</p>
<p>在本文中，我们将介绍在 Vue 应用程序中使用 Web3 的基础知识，包括安装过程和与智能合约的交互。要阅读本文，您需要以下内容:</p>
<ul>
<li>了解 Vue CLI</li>
<li>对 Web3 的基本理解</li>
<li>熟悉 Solidity 智能合同并了解如何部署它们</li>
</ul>
<h2 id="tableofcontents">目录</h2>

<h2 id="what-web3">什么是 Web3？</h2>
<p>Web3 是基于区块链技术的新一代互联网，提倡去中心化和基于令牌的经济。调用智能合约和发送交易构成了区块链网络上的大部分交互。</p>
<h2 id="what-smart-contracts">什么是智能合约？</h2>
<p>智能合同是一种自动执行的计算机软件，它位于区块链网络上。区块链一部署就执行智能合同。当契约被执行时，它创建接口，DApps 使用这些接口来扩展它们的功能。</p>
<p>考虑以下简单的 Solidity smart 契约:</p>
<pre class="language-solidity">// SPDX-License-Identifier: GPL-3.0
pragma solidity &gt;=0.8.0;

contract Contract {
    string private text;

    function speak() public view returns (string memory) {
        return text;
    }

    function changeText(string memory newText) public {
        text = newText;
    }
}
</pre>
<p>当您将上面的契约部署到区块链网络时，它创建了两个接口方法，<code>speak</code>，它返回一个文本字符串，和<code>changeText</code>，它改变<code>speak</code>返回的字符串。</p>
<h2 id="project-setup">项目设置</h2>
<p>如果您已经有一个准备集成的 Vue 项目，您可以跳过这一部分。如果没有，请使用以下命令为 npx 包管理器创建项目:</p>
<pre>npx vue create web3-project
</pre>
<p>如果使用纱线卷装管理器，请使用以下命令:</p>
<pre class="language-bash">yarn vue create web3-project
</pre>
<p>在菜单提示中，选择<strong> Vue3 </strong>或<strong> Vue2 </strong>。你选择哪一个都没关系，因为你可以用同样的方式将 Web3 集成到两者中。创建项目后，在您的<code>App.vue</code>文件中编写以下代码:</p>
<pre class="language-javascript">&lt;template&gt;
  &lt;div&gt;
    &lt;!-- connect-wallet button is visible if the wallet is not connected --&gt;
  &lt;button v-if="!connected"&gt;Connect wallet&lt;/button&gt;
    &lt;!-- call-contract button is visible if the wallet is connected --&gt;
    &lt;button v-if="connected"&gt;Call contract&lt;/button&gt;
    {{ contractResult }}
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;

export default {
  name: 'App',

  data() {
    return {
      connected: false,
      contractResult: '',
    }
  },
}
&lt;/script&gt;
</pre>
<p>在<code>App.vue</code>中，我们有两个按钮；第一个用于连接钱包，第二个用于调用智能契约方法。</p>
<p>在用户将钱包连接到网络应用程序之前，<code>call contract</code>按钮是隐藏的。我们的应用程序使用<code>connected</code>状态变量来保存钱包连接状态。</p>
<h2 id="setting-up-web3">设置网站 3</h2>
<p>在您的项目目录中，运行以下命令以使用 npm 安装 Web3 包:</p>
<pre class="language-bash">npm install web3
</pre>
<p>如果您使用 Yarn，请改为运行以下命令:</p>
<pre class="language-bash">yarn add web3
</pre>
<p>安装包之后，我们将 Web3 导入到<code>App.vue</code>文件中，并运行项目来测试它的兼容性:</p>
<pre class="language-javascript">...
&lt;script&gt;
import Web3 from 'web3'
export default {
  name: 'App',
…
</pre>
<p>如果除了<code>Web3 is imported but never used</code>之外，你没有收到任何错误消息，那么 Web3 与你的框架是兼容的。但是，如果框架产生其他错误，您必须切换到旧版本的 Vue。Vue 3 使用的 Webpack 5 模块出现了兼容性问题。</p>
<h2 id="connecting-wallet">连接我们的钱包</h2>
<p>MetaMask 是一个应用程序，<a href="https://blog.logrocket.com/understanding-resolving-metamask-error-codes/">允许用户存储并将他们的钱包</a>连接到 Web3 应用程序。Metamask 可以安装在所有主流浏览器中。通过将钱包连接到网站，用户可以执行以下操作:</p>
<ul>
<li>在网站上买卖代币</li>
<li>管理区块链网络上的数字资产</li>
<li>在网站上向帐户进行交易</li>
<li>在区块链网络上与智能合约交互</li>
</ul>
<p>当您在浏览器中安装元掩码扩展时，该扩展会创建一个<code>window.ethereum</code>对象。Web3 应用程序使用<code>window.ethereum</code>对象访问用户的钱包并连接到以太坊网络。</p>
<p><code>window.ethereum.request()</code>方法提示用户连接他们的元掩码钱包:</p>
<pre class="language-javascript">ethereum.request({ method: 'eth_requestAccounts' })
</pre>
<p>我们可以使用这个提示将钱包连接事件注册到我们的<code>connect wallet</code>按钮。将以下代码添加到您的<code>App.vue</code>文件中:</p>
<pre class="language-javascript">&lt;template&gt;
  &lt;div&gt;
    &lt;!-- "connect" click event is registered --&gt;
&gt;    &lt;button v-if="!connected" @click="connect"&gt;Connect wallet&lt;/button&gt;
    &lt;button v-if="connected"&gt;Call contract&lt;/button&gt;
    {{ contractResult }}
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  name: 'App',

  data() {
    return {
      connected: false,
      contractResult: '',
    }
  },

&gt;  methods: {

&gt;    connect: function () {
&gt;        // this connects to the wallet
&gt;      
&gt;      if (window.ethereum) { // first we check if metamask is installed
&gt;        window.ethereum.request({ method: 'eth_requestAccounts' })
&gt;          .then(() =&gt; {
&gt;            this.connected = true; // If users successfully connected their wallet
&gt;          });
&gt;      }
&gt;    }
&gt;  }
}
&lt;/script&gt;
</pre>
<p>当用户点击<code>connect wallet</code>按钮时，会出现元掩码提示，允许用户选择他们想要连接的帐户。用户连接钱包后，<code>App.vue</code>文件中的<code>connected</code>状态变量变成了<code>true</code>。</p>
<h2 id="interact-deployed-smart-contracts">与部署的智能合同交互</h2>
<p>部署的智能合约创建 Web3 应用程序与之交互的接口。要访问这些接口，我们需要向 Web3 提供 ABI、智能合约接口的描述以及合约地址，即合约在以太网上的位置。</p>
<p>在写这篇文章之前，我在<a href="https://www.rinkeby.io/#stats"> Rinkeby 测试网络</a>上部署了一个智能合约。在下面的示例中，我将使用它的 ABI 和地址，但是如果您已经部署了一个智能契约，则可以使用该契约的地址和 ABI，而不是这里包含的地址和地址。</p>
<p>为了与部署的契约进行交互，使用<code>window.ethereum</code>对象创建一个 Web3 的实例:</p>
<pre class="language-javascript">let web3 = new Web3(window.ethereum);
</pre>
<p>然后，使用其 ABI 和地址创建对已部署合同的引用:</p>
<pre class="language-javascript">let contract = new web3.eth.Contract(abi, contractAddress)
</pre>
<p>初始化契约后，就可以与之进行交互了。如果契约有一个名为<code>greet</code>的接口方法，我们使用下面的代码调用它:</p>
<pre class="language-javascript">contract.methods.greet().call()
</pre>
<p>现在，我们将修改<code>call contract</code>按钮，用您部署的契约的<code>greet</code>方法调用一个契约:</p>
<pre>&lt;!-- vue --&gt;
&lt;button v-if="connected" @click="callContract"&gt;Call contract&lt;/button&gt;
</pre>
<p>接下来，在 Vue 对象中创建一个<code>call contract</code>按钮调用的<code>callContract</code>方法:</p>
<pre class="language-javascript">callContract: function () {
  // method for calling the contract method
  let web3 = new Web3(window.ethereum);
  let contractAddress = '0xC0B2D76aB95B7E31E241ce713ea1C72d0a50588e';

  let abi = JSON.parse(`[{"inputs": [],"stateMutability": "nonpayable","type": "constructor"},{"inputs": [],"name": "greet","outputs": [{"internalType": "string","name": "","type": "string"}],"stateMutability": "view","type": "function"}]`);


  let contract = new web3.eth.Contract(abi, contractAddress);

  contract.methods.greet().call()
    .then(result =&gt; this.contractResult = result);
}
</pre>
<p><code>callContract</code>方法将被注册为按钮的 click 事件，并将调用已部署的智能合约中的<code>greet</code>方法:</p>
<pre class="language-javascript">&lt;template&gt;
  &lt;div&gt;
    &lt;button v-if="!connected" @click="connect"&gt;Connect wallet&lt;/button&gt;

    &lt;!-- "callContract" event handler is added --&gt;
&gt;    &lt;button v-if="connected" @click="callContract"&gt;Call contract&lt;/button&gt;

    &lt;!-- displays the result of the contract --&gt;
    {{ contractResult }}
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import Web3 from 'web3'

export default {
  name: 'App',

  data() {
    return {
      connected: false,
      contractResult: '',
    }
  },

  methods: {

    connect: function () {
      let ethereum = window.ethereum;
      if (ethereum) {
      ethereum.request({ method: 'eth_requestAccounts' })
       .then(() =&gt; {
            this.connected = true;
          });
      }
    },

&gt;    callContract: function () {
&gt;        // method for calling the contract method
&gt;      let web3 = new Web3(window.ethereum);
&gt;      let contractAddress = '0xC0B2D76aB95B7E31E241ce713ea1C72d0a50588e';

&gt;      let abi = JSON.parse(`[{"inputs": [],"stateMutability": "nonpayable","type": "constructor"},{"inputs": [],"name": "greet","outputs": [{"internalType": "string","name": "","type": "string"}],"stateMutability": "view","type": "function"}]`);


&gt;      let contract = new web3.eth.Contract(abi, contractAddress);

&gt;      contract.methods.greet().call()
&gt;        .then(result =&gt; this.contractResult = result);
&gt;    }

  }
}
&lt;/script&gt;
</pre>
<p>在用户连接他们的钱包并调用合同后，应用程序应该类似于下图:</p>
<p><img data-attachment-id="114942" data-permalink="https://blog.logrocket.com/integrate-web3-into-vue/user-connect-wallet-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/06/user-connect-wallet-output.png" data-orig-size="730,191" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="user-connect-wallet-output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/06/user-connect-wallet-output-300x78.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/06/user-connect-wallet-output.png" decoding="async" class="aligncenter wp-image-114942 size-full jetpack-lazy-image" src="../Images/3039e2e2a6b3ca0a7bc2023230305559.png" alt="User Connect Wallet Output" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/06/user-connect-wallet-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/06/user-connect-wallet-output-300x78.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/06/user-connect-wallet-output.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/06/user-connect-wallet-output.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="114942" data-permalink="https://blog.logrocket.com/integrate-web3-into-vue/user-connect-wallet-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/06/user-connect-wallet-output.png" data-orig-size="730,191" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="user-connect-wallet-output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/06/user-connect-wallet-output-300x78.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/06/user-connect-wallet-output.png" decoding="async" loading="lazy" class="aligncenter wp-image-114942 size-full" src="../Images/3039e2e2a6b3ca0a7bc2023230305559.png" alt="User Connect Wallet Output" srcset="https://blog.logrocket.com/wp-content/uploads/2022/06/user-connect-wallet-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/06/user-connect-wallet-output-300x78.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/06/user-connect-wallet-output.png"/></noscript>
<h2 id="conclusion">结论</h2>
<p>在本文中，我们学习了如何使用 Vue 通过以太坊区块链网络创建 Web3 应用程序、连接 MetaMask 钱包以及与智能合约交互。正如你所看到的，只要你熟悉 Solidity，将 Web3 集成到 Vue 应用程序中是相当简单的。Web3 为隐私和数据所有权提供了主要的好处，我们探索了组成这一过程的一些工具和概念，如智能合同。</p>
<div class="code-block code-block-20">
<div class="blog-plug inline-plug vue-inline"><h2>像用户一样体验您的 Vue 应用</h2><p>调试 Vue.js 应用程序可能会很困难，尤其是当用户会话期间有几十个(如果不是几百个)突变时。如果您对监视和跟踪生产中所有用户的 Vue 突变感兴趣，</p><a href="https://lp.logrocket.com/blg/vue-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/0d269845910c723dd7df26adab9289cb.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/0d269845910c723dd7df26adab9289cb.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png"/></noscript></a><a href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用程序的 DVR，记录你的 Vue 应用程序中发生的一切，包括网络请求、JavaScript 错误、性能问题等等。您可以汇总并报告问题发生时应用程序的状态，而不是猜测问题发生的原因。</p><p>LogRocket Vuex 插件将 Vuex 突变记录到 LogRocket 控制台，为您提供导致错误的环境，以及出现问题时应用程序的状态。</p><p>现代化您调试 Vue 应用的方式- <a class="signup" href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div>


</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>