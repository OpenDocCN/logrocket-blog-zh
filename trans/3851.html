<html>
<head>
<title>How to implement infinite scroll with Vue </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何用Vue实现无限滚动</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/implement-infinite-scroll-vue/#0001-01-01">https://blog.logrocket.com/implement-infinite-scroll-vue/#0001-01-01</a></blockquote><div><article class="article-post">
<p>通过无限滚动，当用户向下滚动页面时，网页加载新内容，从而允许用户<a href="https://blog.logrocket.com/ux-design/pagination-vs-infinite-scroll-ux/">查看新内容，而不必点击新页面</a>或刷新页面。当您希望在用户需要时加载大量数据或图像，而不是一次全部加载时，此功能特别有用。</p>
<p>多年来，Twitter、脸书和Instagram等社交网站普及了无限卷轴。在本教程中，我们将使用<a href="https://blog.logrocket.com/how-to-use-vue-3-typescript/"> Vue实现无限滚动，这是一个用于构建用户界面和单页应用程序的JavaScript框架</a>。我们开始吧！</p>
<p><em>向前跳转</em></p>

<h2 id="getting-started-vue">Vue入门</h2>
<p>Vue是一个带有虚拟DOM的轻量级框架；它提供了一种以声明方式向DOM呈现数据的方法，并使用双向数据绑定来在数据发生变化时保持DOM最新。</p>
<p>我真正欣赏<a href="https://blog.logrocket.com/definitive-guide-vue-3-components/"> Vue 3的是代码</a>的紧凑性。包括脚本、HTML和样式在内的所有东西都在一个文件中有自己的位置。这种解决方案对于像我们这样最简单的项目来说是理想的，并且是开始摆弄一个想法的一个很好的选择。</p>
<h2 id="project-description">项目描述</h2>
<p>在我们的应用程序中，我们将实现一些可以在其他项目中派上用场的特性。我们将从随机在线数据生成器下载数据。对于这个项目，我们将使用<a href="http://random-data-api.com/">http://random-data-api.com</a>，它提供了一个有用的API和真实的数据，从而让我们看到我们的应用程序在现实世界中是如何工作的。</p>
<p>对于每一批新数据，当新数据被下载到浏览器中时，会出现一条短消息。这始终是一个好的实践，尤其是考虑到API的响应速度会有多慢。因此，用户会意识到在引擎盖下发生了一些事情。</p>
<p>对于显示数据的网格，我们将使用砖石CSS布局。在这个项目中，我们将使用我能找到的最简单的CSS布局之一。您可以轻松地将它用于其他框架，而无需太多的修改。</p>
<p>下图显示了最终结果:</p>
<p><img data-attachment-id="156173" data-permalink="https://blog.logrocket.com/implement-infinite-scroll-vue/attachment/1-vue-infinite-scroll-app-demo/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/1-vue-infinite-scroll-app-demo.png" data-orig-size="730,433" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="vue-infinite-scroll-app-demo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/1-vue-infinite-scroll-app-demo-300x178.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/1-vue-infinite-scroll-app-demo.png" decoding="async" class="aligncenter wp-image-156173 size-full jetpack-lazy-image" src="../Images/151c9568ab4e011d3bd222d8dbf73769.png" alt="Vue Infinite Scroll App Demo" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/1-vue-infinite-scroll-app-demo.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/1-vue-infinite-scroll-app-demo-300x178.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/1-vue-infinite-scroll-app-demo.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/1-vue-infinite-scroll-app-demo.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="156173" data-permalink="https://blog.logrocket.com/implement-infinite-scroll-vue/attachment/1-vue-infinite-scroll-app-demo/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/1-vue-infinite-scroll-app-demo.png" data-orig-size="730,433" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="vue-infinite-scroll-app-demo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/1-vue-infinite-scroll-app-demo-300x178.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/1-vue-infinite-scroll-app-demo.png" decoding="async" loading="lazy" class="aligncenter wp-image-156173 size-full" src="../Images/151c9568ab4e011d3bd222d8dbf73769.png" alt="Vue Infinite Scroll App Demo" srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/1-vue-infinite-scroll-app-demo.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/1-vue-infinite-scroll-app-demo-300x178.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/1-vue-infinite-scroll-app-demo.png"/></noscript>
<p>项目思路相当简单；在页面的第一印象中，第一批数据被下载到浏览器中并被可视化。当用户滚动可视化数据的组件时，点击页面底部将加载新的一批数据。在当前可视化结束时，新数据将被推送到UI，并且将有一个新的空间来容纳它。</p>
<p>接下来，您可以在GitHub 上找到这个项目<a href="https://github.com/rosdec/ethernal_scroll">的完整代码库。在下一节中，我们将详细讨论代码中最有趣的部分。</a></p>
<h2 id="masonry-component"><code>masonry</code>组件</h2>
<p>我们的目标是检测用户何时到达包含“无限”数据的组件底部。在源代码中，这个<a href="https://blog.logrocket.com/css-grid-guide/">组件被称为<code>masonry</code> </a>。我们可以通过操作以下三个属性来实现这一点:</p>
<ul>
<li><code>masonry.clientHeight</code>:整个<code>masonry</code>元素高度的像素数</li>
<li>项目列表中我们已经滚动过的像素数</li>
<li><code>window.scrollHeight</code>:项目列表中当前包含的像素数</li>
</ul>
<p>以下代码实现了这一想法:</p>
<pre class="language-javascript hljs">  mounted() {
    const masonry = document.querySelector('#infinite-list');
    document.title = "Ethrnal Scroll Demo";
    masonry.addEventListener('scroll', e =&amp;amp;gt; {
      if (masonry.scrollTop + masonry.clientHeight &amp;amp;gt;= masonry.scrollHeight) {
        this.getNextBatch(30);
      }
    })
  },
};
</pre>
<p>在下图中，您可以看到这三个变量是如何相互作用的。当<code>scrollTop</code>加上<code>clientHeight</code>大于<code>scrollHeight</code>时，那么我们已经滚动到列表的末尾，我们需要另一批项目:</p>
<p><img data-attachment-id="156175" data-permalink="https://blog.logrocket.com/implement-infinite-scroll-vue/attachment/scrolltop-clientheight-scrollheight-demo-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/scrolltop-clientheight-scrollheight-demo-diagram.png" data-orig-size="730,413" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="scrolltop-clientheight-scrollheight-demo-diagram" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/scrolltop-clientheight-scrollheight-demo-diagram-300x170.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/scrolltop-clientheight-scrollheight-demo-diagram.png" decoding="async" class="aligncenter wp-image-156175 size-full jetpack-lazy-image" src="../Images/b78470ddad101c04d103c56490bc1043.png" alt="Scrolltop Clientheight Scrollheight Demo Diagram" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/scrolltop-clientheight-scrollheight-demo-diagram.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/scrolltop-clientheight-scrollheight-demo-diagram-300x170.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/scrolltop-clientheight-scrollheight-demo-diagram.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/scrolltop-clientheight-scrollheight-demo-diagram.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="156175" data-permalink="https://blog.logrocket.com/implement-infinite-scroll-vue/attachment/scrolltop-clientheight-scrollheight-demo-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/scrolltop-clientheight-scrollheight-demo-diagram.png" data-orig-size="730,413" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="scrolltop-clientheight-scrollheight-demo-diagram" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/scrolltop-clientheight-scrollheight-demo-diagram-300x170.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/scrolltop-clientheight-scrollheight-demo-diagram.png" decoding="async" loading="lazy" class="aligncenter wp-image-156175 size-full" src="../Images/b78470ddad101c04d103c56490bc1043.png" alt="Scrolltop Clientheight Scrollheight Demo Diagram" srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/scrolltop-clientheight-scrollheight-demo-diagram.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/scrolltop-clientheight-scrollheight-demo-diagram-300x170.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/scrolltop-clientheight-scrollheight-demo-diagram.png"/></noscript>
<p>在下图中，您可以看到当我们滚动到内容末尾时，值是如何变化的:</p>
<p><img data-attachment-id="156177" data-permalink="https://blog.logrocket.com/implement-infinite-scroll-vue/attachment/values-change-reach-list-bottom/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/values-change-reach-list-bottom.png" data-orig-size="730,413" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="values-change-reach-list-bottom" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/values-change-reach-list-bottom-300x170.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/values-change-reach-list-bottom.png" decoding="async" class="aligncenter wp-image-156177 size-full jetpack-lazy-image" src="../Images/d733b6cba7a398f3abf40fc379f492d3.png" alt="Values Change Reach List Bottom" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/values-change-reach-list-bottom.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/values-change-reach-list-bottom-300x170.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/values-change-reach-list-bottom.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/values-change-reach-list-bottom.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="156177" data-permalink="https://blog.logrocket.com/implement-infinite-scroll-vue/attachment/values-change-reach-list-bottom/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/values-change-reach-list-bottom.png" data-orig-size="730,413" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="values-change-reach-list-bottom" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/values-change-reach-list-bottom-300x170.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/values-change-reach-list-bottom.png" decoding="async" loading="lazy" class="aligncenter wp-image-156177 size-full" src="../Images/d733b6cba7a398f3abf40fc379f492d3.png" alt="Values Change Reach List Bottom" srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/values-change-reach-list-bottom.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/values-change-reach-list-bottom-300x170.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/values-change-reach-list-bottom.png"/></noscript>
<p>一旦我们清除了检查我们是否到达列表底部的机制，我们必须在代码中找到一个好的地方来添加这个检查。一个自然的地方是<code>scroll</code>事件。因此，每次我们来回滚动时，<code>masonry</code>组件将能够控制我们是否到达列表的底部。</p>
<p>另一件值得注意的事情是，我们在Vue提供的<code>mounted()</code>方法中为scroll事件分配了监听器，允许我们在组件挂载后执行代码。</p>
<p>在讨论更多滚动之前，让我们看一下我们的应用程序将处理的数据:</p>
<pre class="language-javascript hljs">  data() {
    return {
      loading: false,
      items: [],
      page_count: 0,
      sizes: ["tall", "taller", "tallest"]
    };
  },
</pre>
<p>在<code>data()</code>中，我们有组件的状态。让我们仔细看看:</p>
<ul>
<li><code>loading</code>:一个布尔变量，当我们想要显示<code>Loading next batch</code>标签时，它将是<code>true</code>。参见<code>App.vue</code>文件中的第14行</li>
<li><code>items[]</code>:包含显示数据的对象数组</li>
<li><code>page_count</code>:我们从随机来源下载的批次数量</li>
<li><code>sizes[]</code>:一个数组，包含我们上面描述的瓷砖的三种样式的标签</li>
</ul>
<pre>grid-container {
      display: grid;
      /* 1 /
      grid-auto-rows: 50px;
      / 2 /
      grid-gap: 10px;
      / 3 /
      grid-template-columns: repeat(auto-fill, minmax(30%, 1fr));
      / 4 */
      overflow: auto;
      height: 30vh;
      border: 2px solid;
      border-radius: 5px;
      text-align: center;
      margin: 0 0 35px 0;
    }
    .tall {
      grid-row: span 2;
      background-color: #7632ed;
    }
    .taller {
      grid-row: span 3;
      background-color: #925cef;
    }
    .tallest {
      grid-row: span 4;
      background-color: #b9a3de;
    }</pre>
<p>上面的代码显示了在<code>App.vue</code>的<code>&lt;style&gt;</code>部分中定义的CSS的细节，在这里我们定义了<code>masonry</code>组件的不同瓦片。选择器、<code>tall</code>、<code>taller</code>和<code>tallest</code>被随机分配给下载的数据:</p>
<pre class="language-javascript hljs">getNextBatch(size) {
  this.loading = true;
  axios.get("https://random-data-api.com/api/v2/users?size=" + size + "&amp;amp;amp;response_type=json").then((response) =&amp;amp;gt; {
    response.data.map((x) =&amp;amp;gt; {
      const new_item = {
        name: x.first_name + " " + x.last_name,
        dob: x.date_of_birth,
        location: x.address.state,
        size: this.sizes[Math.floor(Math.random() * this.sizes.length)]
      };
      this.items.push(new_item)
    })
    this.loading = false;
    this.page_count++;
  });
}
</pre>
<p>我们在上面显示的Vue应用程序的唯一方法<code>getNextBatch</code>中实现了从随机源加载一批数据。它用<code>axios.get()</code>从随机数据源API下载一批新的物品，指定我们想要的物品数量。一旦数据通过，它被操作来提取一些字段并组装一个对象，该对象将被追加到<code>items[]</code>数组中。</p>
<p><code>getNextBatch()</code>也做两件简单的事情。首先，它更新了页面的数量，或者我们已经下载的批次的数量，并且从<code>App.vue</code>文件中显示和隐藏了<code>Loading next batch</code>标签。</p>
<p>请注意我们如何重复使用代码。我们还在页面加载后运行的<code>beforeMount()</code>方法中使用了<code>getNextBatch()</code>，但是还没有显示任何组件。这个调用的作用是用一些要在<code>masonry</code>组件中可视化的数据填充<code>items[]</code>数组。</p>
<h2 id="conclusion">结论</h2>
<p>在本文中，我们探索了在用Vue编写的网页上实现无限滚动的简化解决方案。</p>
<p>为了便于在其他项目中重用，我们在专用的<code>&lt;div&gt;</code>中实现了无限滚动功能。我们无限卷轴的另外两个部分在代码中被很好地分开了，包括下载一批新数据的函数和我们调用这个函数的地方。这将有助于开发人员用更有用的东西替换<code>getNextBatch()</code>函数中API的URL。</p>
<p>Vue3对于编写一个小的概念证明特别有效，就像这个例子一样。但是，您也可以通过组合组件来实现更复杂的功能。我希望你喜欢这篇文章，并</p><div class="code-block code-block-20">
<div class="blog-plug inline-plug vue-inline"><h2>像用户一样体验您的Vue应用</h2><p>调试Vue.js应用程序可能会很困难，尤其是当用户会话期间有几十个(如果不是几百个)突变时。如果您对监视和跟踪生产中所有用户的Vue突变感兴趣，</p><a href="https://lp.logrocket.com/blg/vue-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/0d269845910c723dd7df26adab9289cb.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/0d269845910c723dd7df26adab9289cb.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png"/></noscript></a><a href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用程序的DVR，记录你的Vue应用程序中发生的一切，包括网络请求、JavaScript错误、性能问题等等。您可以汇总并报告问题发生时应用程序的状态，而不是猜测问题发生的原因。</p><p>LogRocket Vuex插件将Vuex突变记录到LogRocket控制台，为您提供导致错误的环境，以及出现问题时应用程序的状态。</p><p>现代化您调试Vue应用的方式- <a class="signup" href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div>


</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>