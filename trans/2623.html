<html>
<head>
<title>How to build a Solana Discord wallet with Python - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何用 Python - LogRocket 博客构建一个 Solana Discord 钱包</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/how-to-build-solana-discord-wallet-python/#0001-01-01">https://blog.logrocket.com/how-to-build-solana-discord-wallet-python/#0001-01-01</a></blockquote><div><article class="article-post">
<p>在本教程中，我们将学习如何用 Python、discord.py 和 Solana Python SDK 构建一个 Solana Discord 聊天机器人钱包。这个聊天机器人将能够创建一个帐户，为一个帐户提供资金，检查帐户余额，并向另一个帐户发送索拉纳令牌，所有这些都通过 Discord 完成。</p>
<p>Solana 是一个区块链公共网络，允许其用户<a href="https://blog.logrocket.com/how-to-create-nfts-with-javascript/" target="_blank" rel="noopener">创建 NFTs </a>、财务应用和其他智能合同应用。索拉纳的原生代币被称为 SOL，根据 coinmarketcap.com<a href="https://coinmarketcap.com/">的消息，在撰写本文时，SOL 的市值在加密货币中排名第七。索拉纳钱包是一个应用程序，允许您创建索拉纳帐户，存储，发送和接收 SOL 和其他令牌，以及与智能合同进行交互。</a></p>
<p><a href="https://discord.com/" target="_blank" rel="noopener"> Discord </a>是一款流行的免费语音、视频和文本聊天应用，拥有超过 3.5 亿用户，运行在 Windows、macOS、Android、iOS、iPadOS、Linux 和 web 浏览器上。Discord 聊天机器人是一种能够响应命令并自动执行某些任务的机器人，例如欢迎新成员、调节内容和禁止违反规则者。我们将要创建的机器人将帮助我们创建和管理 Solana 钱包。</p>
<p>在本教程结束时，您将拥有一个如下所示的 Solana Discord 钱包:</p>
<p><img data-attachment-id="89608" data-permalink="https://blog.logrocket.com/how-to-build-solana-discord-wallet-python/solana-discord-bot-demo/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-Discord-bot-demo.gif" data-orig-size="730,329" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Solana-Discord-bot-demo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-Discord-bot-demo-300x135.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-Discord-bot-demo.gif" decoding="async" class="size-full wp-image-89608 aligncenter jetpack-lazy-image" src="../Images/7eb1742f83a7c977437b20bc9ceca9d0.png" alt="Gif demo of the final Solana Discord chat bot in action" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-Discord-bot-demo.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-Discord-bot-demo.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="89608" data-permalink="https://blog.logrocket.com/how-to-build-solana-discord-wallet-python/solana-discord-bot-demo/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-Discord-bot-demo.gif" data-orig-size="730,329" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Solana-Discord-bot-demo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-Discord-bot-demo-300x135.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-Discord-bot-demo.gif" decoding="async" loading="lazy" class="size-full wp-image-89608 aligncenter" src="../Images/7eb1742f83a7c977437b20bc9ceca9d0.png" alt="Gif demo of the final Solana Discord chat bot in action" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-Discord-bot-demo.gif"/></noscript>
<h2>先决条件</h2>
<ul>
<li>不一致的说法</li>
<li>您的设备上安装或可访问的 Discord</li>
<li>Python 3.6 以上版本</li>
</ul>
<h2>创造一个不和谐机器人</h2>
<p>在本节中，我们将创建一个新的 Discord bot 帐户，检索 bot 令牌，并将 bot 邀请到我们的一个服务器上。</p>
<p>使用您首选的浏览器，导航至 Discord 开发人员门户，并使用您的 Discord 帐户登录。导航到<strong>应用</strong>页面，点击<strong>新应用</strong>按钮。</p>
<p>给你的应用程序起一个名字，比如“Solana wallet”，然后按下<strong> Create </strong>。</p>
<p><img data-attachment-id="89611" data-permalink="https://blog.logrocket.com/how-to-build-solana-discord-wallet-python/create-discord-application-screen/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Create-discord-application-screen.png" data-orig-size="730,410" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Create-discord-application-screen" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Create-discord-application-screen-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Create-discord-application-screen.png" decoding="async" class="size-full wp-image-89611 aligncenter jetpack-lazy-image" src="../Images/6a9803dbd3438e1d8079e85ac40f8ee9.png" alt="Create application screen in Discord" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/Create-discord-application-screen.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/01/Create-discord-application-screen-300x168.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/Create-discord-application-screen.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/Create-discord-application-screen.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="89611" data-permalink="https://blog.logrocket.com/how-to-build-solana-discord-wallet-python/create-discord-application-screen/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Create-discord-application-screen.png" data-orig-size="730,410" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Create-discord-application-screen" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Create-discord-application-screen-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Create-discord-application-screen.png" decoding="async" loading="lazy" class="size-full wp-image-89611 aligncenter" src="../Images/6a9803dbd3438e1d8079e85ac40f8ee9.png" alt="Create application screen in Discord" srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/Create-discord-application-screen.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/01/Create-discord-application-screen-300x168.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/Create-discord-application-screen.png"/></noscript>
<p>接下来，导航到<strong>机器人</strong>选项卡，点击<strong>添加机器人</strong>按钮，创建一个机器人用户。</p>
<p><img data-attachment-id="89613" data-permalink="https://blog.logrocket.com/how-to-build-solana-discord-wallet-python/discord-bot-tab/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-bot-tab.png" data-orig-size="730,410" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Discord-bot-tab" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-bot-tab-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-bot-tab.png" decoding="async" class="size-full wp-image-89613 aligncenter jetpack-lazy-image" src="../Images/f34e4f14661629f6e563b7cb9ad6f82c.png" alt="Discord bot tab" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-bot-tab.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-bot-tab-300x168.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-bot-tab.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-bot-tab.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="89613" data-permalink="https://blog.logrocket.com/how-to-build-solana-discord-wallet-python/discord-bot-tab/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-bot-tab.png" data-orig-size="730,410" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Discord-bot-tab" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-bot-tab-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-bot-tab.png" decoding="async" loading="lazy" class="size-full wp-image-89613 aligncenter" src="../Images/f34e4f14661629f6e563b7cb9ad6f82c.png" alt="Discord bot tab" srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-bot-tab.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-bot-tab-300x168.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-bot-tab.png"/></noscript>
<p>向下滚动到页面的<strong> Build-A-Bot </strong>部分，点击<strong>复制</strong>按钮复制 Bot 令牌。我们将在下一节中使用这个 bot 令牌，所以请将它保存在安全的地方。这个令牌应该保持私有，因为任何能够访问这个令牌的人都能够控制您的 bot。</p>
<p>按照上述步骤操作后，您已经成功创建了一个 bot 帐户！现在，为了能够与这个 bot 帐户进行交互，您需要邀请它加入您的服务器。</p>
<p>导航到<strong> OAuth2 </strong>选项卡，然后导航到<strong> URL 生成器</strong>子选项卡。在<strong>范围</strong>部分，选择<strong>机器人</strong>。</p>
<p><img data-attachment-id="89616" data-permalink="https://blog.logrocket.com/how-to-build-solana-discord-wallet-python/discord-oauth2-tab/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-oAuth2-tab.png" data-orig-size="730,410" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Discord-oAuth2-tab" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-oAuth2-tab-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-oAuth2-tab.png" decoding="async" class="size-full wp-image-89616 aligncenter jetpack-lazy-image" src="../Images/ededd2c57d4bd4f3f62f86699151aa91.png" alt="Discord OAuth2 tab" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-oAuth2-tab.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-oAuth2-tab-300x168.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-oAuth2-tab.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-oAuth2-tab.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="89616" data-permalink="https://blog.logrocket.com/how-to-build-solana-discord-wallet-python/discord-oauth2-tab/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-oAuth2-tab.png" data-orig-size="730,410" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Discord-oAuth2-tab" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-oAuth2-tab-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-oAuth2-tab.png" decoding="async" loading="lazy" class="size-full wp-image-89616 aligncenter" src="../Images/ededd2c57d4bd4f3f62f86699151aa91.png" alt="Discord OAuth2 tab" srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-oAuth2-tab.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-oAuth2-tab-300x168.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-oAuth2-tab.png"/></noscript>
<p>在下面出现的<strong> Bot 权限</strong>部分，选择<strong>文本权限</strong>列中的所有字段。转到显示<strong>生成 URL </strong>的部分，点击<strong>复制</strong>按钮复制 bot 邀请 URL。</p>
<p>将复制的 URL 粘贴到一个新标签中，选择要添加机器人的服务器，然后单击<strong>继续</strong>按钮。</p>
<p><img data-attachment-id="89618" data-permalink="https://blog.logrocket.com/how-to-build-solana-discord-wallet-python/discord-add-bot-to-server/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-add-bot-to-server.png" data-orig-size="571,665" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Discord-add-bot-to-server" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-add-bot-to-server-258x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-add-bot-to-server.png" decoding="async" class="size-full wp-image-89618 aligncenter jetpack-lazy-image" src="../Images/6532ca070534d01fb44ab7ae9a06c94c.png" alt="Screenshot of button to add bot to discord server" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-add-bot-to-server.png 571w, https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-add-bot-to-server-258x300.png 258w" data-lazy-sizes="(max-width: 571px) 100vw, 571px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-add-bot-to-server.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-add-bot-to-server.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="89618" data-permalink="https://blog.logrocket.com/how-to-build-solana-discord-wallet-python/discord-add-bot-to-server/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-add-bot-to-server.png" data-orig-size="571,665" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Discord-add-bot-to-server" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-add-bot-to-server-258x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-add-bot-to-server.png" decoding="async" loading="lazy" class="size-full wp-image-89618 aligncenter" src="../Images/6532ca070534d01fb44ab7ae9a06c94c.png" alt="Screenshot of button to add bot to discord server" srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-add-bot-to-server.png 571w, https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-add-bot-to-server-258x300.png 258w" sizes="(max-width: 571px) 100vw, 571px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/Discord-add-bot-to-server.png"/></noscript>
<p>检查机器人的权限，当你满意时，点击<strong>授权</strong>按钮。</p>
<p>现在，您的机器人将被邀请到您的服务器，一旦我们对它进行编码，您就可以与它进行交互。</p>
<h2>创建项目结构</h2>
<p>在本节中，我们将创建我们的项目目录。在这个目录中，我们将创建并激活一个虚拟环境，然后安装构建这个聊天机器人所需的 Python 包。最后，我们将创建一个名为<code>.env</code>的文件，并在这个文件中存储我们的 Discord bot 令牌。</p>
<p>打开终端窗口，输入以下命令:</p>
<pre class="language-shell hljs">mkdir solana-discord-wallet
cd solana-discord-wallet
</pre>
<p>在我们的工作目录中，创建一个虚拟环境并激活它。如果您使用的是 Unix 或 MacOS 系统，请运行以下命令:</p>
<pre class="language-shell hljs">python3 -m venv venv
source venv/bin/activate
</pre>
<p>如果您在 Windows 上遵循教程，请改为运行以下命令:</p>
<pre class="language-shell hljs">python -m venv venv
venvScriptsactivate
</pre>
<p>现在我们已经创建并激活了虚拟环境，我们可以安装创建应用程序所需的库了:</p>
<pre class="language-python hljs">pip install discord.py solana python-dotenv 
</pre>
<p>在上面的命令中，我们使用了<code>pip</code>，Python 包安装程序，来安装我们将在这个项目中使用的以下包:</p>
<ul>
<li>discord.py 是一个现代的、易于使用的、功能丰富的异步 API 包装器，我们将使用它与 discord 的 API 进行交互</li>
<li><a href="https://github.com/michaelhly/solana-py" target="_blank" rel="noopener"> solana-py </a>是基于<a href="https://docs.solana.com/developing/clients/jsonrpc-api" target="_blank" rel="noopener"> JSON RPC API </a>构建的 Solana Python 库</li>
<li><a href="https://github.com/theskumar/python-dotenv" target="_blank" rel="noopener"> python-dotenv </a>是一个从<code>.env</code>文件中读取键值对并将它们作为环境变量添加的库。我们将使用这个模块来检索我们的 bot 令牌，它将存储在<code>.env</code>文件中</li>
</ul>
<p>现在让我们开始构建我们的应用程序。创建一个名为<code>.env</code>的文件，并将您在上一节中保存的 Discord bot 令牌粘贴为<code>BOT_TOKEN</code>。</p>
<h2>创建<code>main.py</code>文件</h2>
<p>在本节中，我们将创建 Python 脚本，允许我们的 Discord 聊天机器人发送和接收消息。</p>
<p>在项目的根目录下，创建一个名为<code>main.py</code>的文件。使用您最喜欢的文本编辑器打开它，并添加以下代码:</p>
<pre class="language-python hljs">import os
import discord
from discord.ext import commands
from dotenv import load_dotenv
</pre>
<p>这里，我们导入了聊天机器人应用程序发送和接收消息所需的所有包:</p>
<ul>
<li><code>os</code>将与<code>python-dotenv</code>一起用于从<code>.env</code>文件中检索我们的不和谐机器人令牌</li>
<li><code>discord</code>包将用于与 Discord 的 API 交互，并创建命令处理程序，从而允许我们发送和接收 Discord 消息</li>
</ul>
<p>将以下代码添加到<code>main.py</code>文件的底部:</p>
<pre class="language-python hljs">load_dotenv()
description = ''' A bot that allows you to create and manage a Solana wallet  '''
intents = discord.Intents.default()
bot = commands.Bot(command_prefix='/', description=description, intents=intents)

@bot.event
async def on_ready():
    print('Bot is online')
    print(bot.user.name)
    print(bot.user.id)
    print('------ n')
</pre>
<p>在上面的代码中，我们通过调用<code>load_dotenv()</code>导入了存储在<code>.env</code>文件中的环境变量。</p>
<p>加载变量后，我们为机器人创建了一个基本描述，并将机器人的意图设置为<code>default</code>。意图是指允许机器人订阅特定的事件，如直接消息、反应或输入。</p><div class="code-block code-block-54">
<hr/>
<h3>更多来自 LogRocket 的精彩文章:</h3>

<hr/></div>
<p>然后，我们创建了一个新的 bot 实例，并将命令前缀(<code>/</code>)、描述和意图作为参数传递给构造函数。我们将 bot 实例存储在一个名为<code>bot</code>的变量中。</p>
<p>最后，我们为 bot 运行时创建一个事件监听器。当这个事件侦听器被触发时，我们在控制台上打印几行内容，说明机器人在线，并显示机器人的用户名和用户 ID。</p>
<p>现在，在<code>on_ready()</code>函数下面添加以下代码:</p>
<pre class="language-python hljs">@bot.command(description='Create a new solana account')
async def create(ctx):
    await ctx.send('Create account')

@bot.command(description='Fund your account')
async def fund(ctx):
    await ctx.send('Fund your account')

@bot.command(description='Check account balance')
async def balance(ctx):
    await ctx.send('Check account balance')

@bot.command(description='Send SOL to another account')
async def send(ctx):
    await ctx.send('Send SOL to another account')


bot.run(os.environ['BOT_TOKEN'])
</pre>
<p>在上面的代码块中，我们为聊天机器人创建了所有的命令处理程序。上面的代码确定用户试图调用哪个命令，并采取适当的行动。</p>
<p>请注意，我们不需要在每个命令处理程序中指定命令前缀，因为我们在创建 bot 实例时已经这样做了。</p>
<p>我们的聊天机器人钱包将能够处理以下命令:</p>
<ul>
<li><code>/create</code>创建新的 Solana 帐户</li>
<li><code>/fund amount</code>用一定数量的 SOL 为现有的 Solana 帐户提供资金</li>
<li>检查现有 Solana 账户的余额</li>
<li><code>/send amount receiver</code>负责向另一个索拉纳账户发送一定数量的溶胶</li>
</ul>
<p>目前，每个命令处理程序只会发回一个描述用户想要执行的操作的文本。为了向用户发送消息，我们使用了每个命令处理程序中的 context ( <code>ctx</code>)对象提供的<code>send()</code>方法。</p>
<p>最后，我们调用了由<code>bot</code>对象提供的<code>run()</code>方法，并将机器人令牌作为参数传递，以启动我们的聊天机器人。</p>
<p>您的<code>main.py</code>文件应该如下所示:</p>
<pre class="language-python hljs">import os
import discord
from discord.ext import commands
from dotenv import load_dotenv

load_dotenv()
description = ''' A bot that allows you to create and manage a Solana wallet  '''
intents = discord.Intents.default()
bot = commands.Bot(command_prefix='/', description=description, intents=intents)

@bot.event
async def on_ready():
    print('Bot is online')
    print(bot.user.name)
    print(bot.user.id)
    print('------ n')

@bot.command(description='Create a new solana account')
async def create(ctx):
    await ctx.send('Create account')

@bot.command(description='Fund your account')
async def fund(ctx):
    await ctx.send('Fund your account')

@bot.command(description='Check account balance')
async def balance(ctx):
    await ctx.send('Check account balance')

@bot.command(description='Send SOL to another account')
async def send(ctx):
    await ctx.send('Send SOL to another account')

bot.run(os.environ['BOT_TOKEN'])
</pre>
<p>转到您的终端，运行以下命令以启动应用程序:</p>
<pre class="language-python hljs">python main.py
</pre>
<p>使用您首选的 Discord 客户端，向机器人发送<code>/create</code>命令，您应该会得到类似如下的响应:</p>
<p><img data-attachment-id="89621" data-permalink="https://blog.logrocket.com/how-to-build-solana-discord-wallet-python/solana-wallet-create-command/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-wallet-create-command.png" data-orig-size="730,435" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Solana-wallet-create-command" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-wallet-create-command-300x179.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-wallet-create-command.png" decoding="async" class="size-full wp-image-89621 aligncenter jetpack-lazy-image" src="../Images/e492b7571c1db22b75b270d4629f739e.png" alt="The /Create command in Discord" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-wallet-create-command.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-wallet-create-command-300x179.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-wallet-create-command.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-wallet-create-command.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="89621" data-permalink="https://blog.logrocket.com/how-to-build-solana-discord-wallet-python/solana-wallet-create-command/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-wallet-create-command.png" data-orig-size="730,435" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Solana-wallet-create-command" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-wallet-create-command-300x179.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-wallet-create-command.png" decoding="async" loading="lazy" class="size-full wp-image-89621 aligncenter" src="../Images/e492b7571c1db22b75b270d4629f739e.png" alt="The /Create command in Discord" srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-wallet-create-command.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-wallet-create-command-300x179.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/Solana-wallet-create-command.png"/></noscript>
<h2>创建<code>wallet.py</code>文件</h2>
<p>在本节中，我们将创建一个文件，该文件将允许我们创建一个 Solana 帐户，为该帐户提供资金，检查该帐户的余额，并将资金从该帐户发送到另一个帐户。</p>
<p>创建 Solana 帐户时，会生成一个 KeyPair 对象。该对象包含用于访问帐户的公钥和相应的私钥。</p>
<p>公钥类似于可以与任何人公开共享以接收资金的账号，而私钥是授予 Solana 用户对给定账户上的资金的所有权。顾名思义，这个私钥不应该公开共享。</p>
<p>一个索拉纳账户可能持有名为“lamports”的资金。灯端口是值为 0.000000001 SOL 的小数本机令牌。</p>
<p>在项目的根目录下，创建一个名为<code>wallet.py</code>的文件。使用您喜欢的文本编辑器打开它，然后添加以下代码:</p>
<pre class="language-python hljs">from solana.keypair import Keypair
from solana.publickey import PublicKey
from solana.rpc.api import Client
from solana.transaction import Transaction
from solana.system_program import TransferParams, transfer

import json

solana_client = Client("https://api.devnet.solana.com")
</pre>
<p>这里，我们从<code>Solana</code>包中导入了以下对象:</p>
<ul>
<li><code>Keypair</code>，它将用于创建一个新的 Solana 帐户</li>
<li><code>PublicKey</code>，它将把一个字符串格式的公钥转换成一个<code>PublicKey</code>对象，以便将 Solana 令牌发送到另一个帐户</li>
<li><code>Client</code>，创建一个 Solana 客户端实例，该实例将允许该应用程序与 Solana 区块链交互</li>
<li><code>Transaction</code>，创建一个索拉纳交易。事务是由客户端使用单个或多个密钥对签名的指令，并且自动执行，只有两种可能的结果:成功或失败</li>
<li><code>TransferParams</code>，创建一个包含转账交易参数的对象</li>
<li><code>transfer</code>，创建一个对象，允许一个账户向另一个账户发送资金</li>
</ul>
<p>之后我们导入了<code>json</code>，用来将创建的 Solana 账号公钥和私钥存放在一个文件中。</p>
<p>最后，我们在名为<code>solana_client</code>的变量中创建了一个 Solana 客户端实例，并将 RPC 端点设置为<code>devnet</code>。RPC(远程过程调用)端点是可以向其发送区块链数据请求的 URL。</p>
<h3>构建一个函数来创建新的 Solana 帐户</h3>
<p>将以下代码添加到<code>wallet.py</code>的底部:</p>
<pre class="language-python hljs">def create_account(sender_username):
    try:
        kp = Keypair.generate()
        public_key = str(kp.public_key)
        secret_key = kp.secret_key

        data = {
            'public_key': public_key,
            'secret_key': secret_key.decode("latin-1"),
        }

        file_name = '{}.txt'.format(sender_username)
        with open(file_name, 'w') as outfile:
            json.dump(data, outfile)

        return public_key

    except Exception as e:
        print('error:', e)
        return None
</pre>
<p>上面创建的<code>create_account()</code>函数接收发送<code>/create</code>命令的用户的用户名作为参数，它负责创建一个新的 Solana 帐户并将帐户细节存储在本地<code>.txt</code>文件中。</p>
<p>我们通过首先生成一个新的 Solana account KeyPair 对象并将其存储在一个名为<code>kp</code>的变量中来开始代码。</p>
<p>然后，我们将它存储在一个名为<code>data</code>的对象中，这是生成的帐户的<code>public_key</code>和<code>secret_key</code>的字符串值。</p>
<p>最后，我们使用存储在名为<code>sender_username</code>的变量中的值创建一个<code>.txt</code>文件，将<code>data</code>转储到其中，如果没有异常，则返回帐户的<code>public_key</code>。如果出了问题，我们返回<code>None</code>。</p>
<p>在<code>create_account()</code>函数下面添加以下代码:</p>
<pre class="language-python hljs">def load_wallet(sender_username):
    try:
        file_name = '{}.txt'.format(sender_username)
        with open(file_name) as json_file:
            account = json.load(json_file)
            account['secret_key'] = account['secret_key'].encode("latin-1")
            return account

    except Exception as e:
        print(e)
        return None  
</pre>
<p>在这里，我们创建了一个名为<code>load_wallet()</code>的函数。这个函数接收用户的用户名作为参数，并使用它从本地<code>.txt</code>文件中检索他的 Solana 帐户的公钥和私钥，这个文件是在调用<code>create_account()</code>函数时创建的。</p>
<h3>创建一个为 Solana 帐户提供资金的函数</h3>
<p>在<code>load_wallet()</code>函数下面添加以下代码:</p>
<pre class="language-python hljs">def fund_account(sender_username, amount):
    try:
        amount = int(1000000000 * amount)
        account = load_wallet(sender_username)
        resp = solana_client.request_airdrop(
            account['public_key'], amount)   
        print(resp)    

        transaction_id = resp['result']
        if transaction_id != None:
            return transaction_id
        else:
            return None

    except Exception as e:
        print('error:', e)
        return None
</pre>
<p>在上面的代码中，我们创建了一个名为<code>fund_account()</code>的函数。该函数负责为特定帐户请求 SOL，并接收发送<code>/fund</code>命令的用户的用户名和用户请求的 SOL 数量作为参数。</p>
<p>首先，我们使用一些基本的数学方法来防止 Solana 将我们希望请求的 SOL 数量转换成它应该达到的数量的一小部分。比方说，我们希望请求将一个 SOL 添加到我们的帐户中。如果我们只输入“1”作为金额，Solana 会将此金额转换为 0.000000001。所以为了防止这种行为，我们把我们想要的量乘以十亿(1000000000)。</p>
<p>然后，使用<code>load_wallet()</code>函数获取用户的 Solana 帐户数据，并将其存储在一个名为<code>account</code>的变量中。</p>
<p>最后，我们使用由<code>solana_client</code>对象提供的<code>request_airdrop()</code>方法为我们提供了公钥的帐户请求一些 SOL 令牌。如果请求成功，我们返回事务 ID，但是如果出错，我们返回<code>None</code>。</p>
<p>为了让我们认为请求是成功的，<code>request_airdrop()</code>方法应该返回类似如下的响应:</p>
<pre class="language-python hljs">{
    "jsonrpc": "2.0",
    "result":"uK6gbLbhnTEgjgmwn36D5BRTRkG4AT8r7Q162TLnJzQnHUZVL9r6BYZVfRttrhmkmno6Fp4VQELzL4AiriCo61U",
    "id": 1
}
</pre>
<p>您在上面看到的<code>jsonrpc</code>是使用的协议，<code>id</code>是请求 ID，<code>result</code>是响应结果，在这个特定的例子中，是一个事务 ID。</p>
<p>您可以通过首先导航到<a href="https://explorer.solana.com/?cluster=devnet" target="_blank" rel="noopener">索拉纳区块链探索</a> <a href="https://explorer.solana.com/?cluster=devnet"> r </a>，选择<code>Devnet</code>网络，并输入您在<code>result</code>属性中看到的交易 ID 来检查索拉纳交易的细节。</p>
<h3>创建一个函数来检查 Solana 帐户的余额</h3>
<p>在<code>fund_account()</code>方法下添加以下代码:</p>
<pre class="language-python hljs">def get_balance(sender_username):
    try:
        account = load_wallet(sender_username)
        resp = solana_client.get_balance(account['public_key'])
        print(resp)
        balance = resp['result']['value'] / 1000000000
        data = {
            "publicKey": account['public_key'],
            "balance": str(balance),
        }
        return data
    except Exception as e:
        print('error:', e)
        return None
</pre>
<p>这里我们创建了一个名为<code>get_balance()</code>的函数。这个函数接收发送<code>/balance</code>命令的用户的用户名作为参数，它负责检索用户的 Solana 帐户余额。</p>
<p>首先，我们使用<code>load_wallet()</code>方法获取用户的 Solana 帐户，然后我们调用 Solana 客户端提供的<code>get_balance()</code>方法获取帐户余额，将帐户公钥作为参数传递，并将响应赋给一个名为<code>resp</code>的变量。</p>
<p>在检索帐户余额后，我们将余额除以 10 亿，使其更具可读性。</p>
<p>最后，我们将公钥和帐户余额存储在一个名为<code>data</code>的对象中，然后我们返回这个对象。</p>
<p>如果由<code>get_balance()</code>方法发送的请求成功，您应该会看到类似如下的响应:</p>
<pre class="language-python hljs">{
    "jsonrpc": "2.0", 
    "result": {
        "context": { "slot": 228 }, 
        "value": 0
    }, 
    "id": 1
}
</pre>
<p>您在上面看到的<code>context</code>是一个<code>RpcResponseContext</code> JSON 结构，包括一个用于评估操作的<code>slot</code>字段。<code>value</code>是操作本身返回的值，在本例中是账户余额。</p>
<h3>创建一个在 Solana 钱包之间发送 SOL 的函数</h3>
<p>在<code>get_balance()</code>函数下面添加以下代码:</p>
<pre class="language-python hljs">def send_sol(sender_username, amount, receiver):
    try:
        account = load_wallet(sender_username)
        sender = Keypair.from_secret_key(account['secret_key'])
        amount = int(1000000000 * amount)

        txn = Transaction().add(transfer(TransferParams(
            from_pubkey=sender.public_key, to_pubkey=PublicKey(receiver), lamports=amount)))
        resp = solana_client.send_transaction(txn, sender)
        print(resp)

        transaction_id = resp['result']
        if transaction_id != None:
            return transaction_id
        else:
            return None

    except Exception as e:
        print('error:', e)
        return None
</pre>
<p>上面创建的<code>send_sol()</code>函数接收发送<code>/send</code>命令的用户的用户名、该用户希望发送的 SOL 的<code>amount</code>以及她希望发送到的 Solana 帐户地址作为参数。顾名思义，这个函数负责向用户提供的一个 SOL 账户地址发送一定量的 SOL。</p>
<p>首先，我们使用<code>load_wallet()</code>函数获取用户的 Solana 帐户，然后我们将用户的 Solana 帐户密钥对存储在一个名为<code>sender</code>的变量中。她希望发送的金额存储在一个名为<code>amount</code>的变量中。</p>
<p>然后，我们创建一个事务对象，添加发送者和接收者的公钥，添加她希望发送的 SOL 数量，并将该对象赋给一个名为<code>txn</code>的变量。</p>
<p>为了发送和签署事务，我们调用 Solana 客户端提供的<code>send_transaction()</code>方法，将事务对象和发送者的密钥对作为参数传递，然后将响应存储在名为<code>resp</code>的变量中。由<code>send_transaction()</code>方法发送的请求响应类似于我们前面看到的<code>request_airdrop()</code>方法响应。</p>
<p>最后，我们获取存储在<code>resp</code>对象的<code>result</code>属性中的事务 ID，将其存储在一个名为<code>transaction_id</code>的变量中，并返回它。</p>
<p><code>wallet.py</code>文件应该如下所示:</p>
<pre class="language-python hljs">from solana.keypair import Keypair
from solana.publickey import PublicKey
from solana.rpc.api import Client
from solana.transaction import Transaction
from solana.system_program import TransferParams, transfer

import json

solana_client = Client("https://api.devnet.solana.com")


def create_account(sender_username):
    try:
        kp = Keypair.generate()
        public_key = str(kp.public_key)
        secret_key = kp.secret_key

        data = {
            'public_key': public_key,
            'secret_key': secret_key.decode("latin-1"),
        }

        file_name = '{}.txt'.format(sender_username)
        with open(file_name, 'w') as outfile:
            json.dump(data, outfile)

        return public_key

    except Exception as e:
        print('error:', e)
        return None


def load_wallet(sender_username):
    try:
        file_name = '{}.txt'.format(sender_username)
        with open(file_name) as json_file:
            account = json.load(json_file)
            account['secret_key'] = account['secret_key'].encode("latin-1")
            return account

    except Exception as e:
        print(e)
        return None   


def fund_account(sender_username, amount):
    try:
        amount = int(1000000000 * amount)
        account = load_wallet(sender_username)
        resp = solana_client.request_airdrop(
            account['public_key'], amount)   
        print(resp)    

        transaction_id = resp['result']
        if transaction_id != None:
            return transaction_id
        else:
            return None

    except Exception as e:
        print('error:', e)
        return None


def get_balance(sender_username):
    try:
        account = load_wallet(sender_username)
        resp = solana_client.get_balance(account['public_key'])
        print(resp)
        balance = resp['result']['value'] / 1000000000
        data = {
            "publicKey": account['public_key'],
            "balance": str(balance),
        }
        return data
    except Exception as e:
        print('error:', e)
        return None


def send_sol(sender_username, amount, receiver):
    try:
        account = load_wallet(sender_username)
        sender = Keypair.from_secret_key(account['secret_key'])
        amount = int(1000000000 * amount)

        txn = Transaction().add(transfer(TransferParams(
            from_pubkey=sender.public_key, to_pubkey=PublicKey(receiver), lamports=amount)))
        resp = solana_client.send_transaction(txn, sender)
        print(resp)

        transaction_id = resp['result']
        if transaction_id != None:
            return transaction_id
        else:
            return None

    except Exception as e:
        print('error:', e)
        return None                
</pre>
<h2>把所有东西放在一起</h2>
<p>在上一节中，我们创建了包含允许聊天机器人在索拉纳区块链中执行事务的函数的文件。在本节中，我们将把这些功能与聊天机器人的命令处理程序集成在一起。</p>
<p>转到您的<code>main.py</code>，将以下代码添加到导入语句中:</p>
<pre class="language-python hljs">from wallet import create_account, fund_account, get_balance, send_sol
</pre>
<p>在上面的代码行中，我们将在前面几节中创建的所有函数导入到了<code>wallet.py</code>文件中。让我们仔细检查每个命令，将它们集成到聊天机器人的命令处理程序中。</p>
<h3><code>/create</code>命令</h3>
<p>在<code>main.py</code>文件中，用以下代码替换<code>/create</code>命令处理程序中的代码:</p>
<pre class="language-python hljs">async def create(ctx):
    sender_username = ctx.message.author
    try:
        public_key = create_account(sender_username)
        if public_key is not None:
            message = "Solana Account created successfully.n"
            message += "Your account public key is {}".format(public_key)
            await ctx.send(message)
        else:
            message = "Failed to create account.n"
            await ctx.send(message)
    except Exception as e:
        print('error:',e)
        await ctx.send('Failed to create account')
        return
</pre>
<p>这里，我们获取发送<code>/create</code>命令的用户的用户名，并将其存储在一个名为<code>sender_username</code>的变量中。</p>
<p>之后，我们调用<code>wallet.py</code>文件中的<code>create_account()</code>函数，将用户的用户名作为参数传递，并将其存储在一个名为<code>public_key</code>的变量中。新创建的 Solana 帐户的公钥由<code>create_account()</code>函数返回。</p>
<p>然后，我们使用条件逻辑来检查<code>public_key</code>的值是否不等于<code>None</code>，如果是这样，我们在一个名为<code>message</code>的变量中存储一条消息，说明 Solana 帐户创建成功，并显示公钥。之后，我们使用<code>send()</code>方法将消息发送给用户。</p>
<p>然而，如果<code>public_key</code>等于<code>None</code>,我们会发送一条消息，说明机器人未能创建帐户。</p>
<h3><code>/fund</code>命令</h3>
<p>现在，用以下代码替换<code>/fund</code>命令处理程序中的代码:</p>
<pre class="language-python hljs">async def fund(ctx):
    sender_username = ctx.message.author
    incoming_msg = ctx.message.content
    try:
        amount = float(incoming_msg.split(" ")[1])
        if amount &lt;= 2 :
            message = "Requesting {} SOL to your Solana account, please wait !!!".format(amount)
            await ctx.send(message)
            transaction_id = fund_account(sender_username, amount)
            if transaction_id is not None:
                message = "You have successfully requested {} SOL for your Solana account n".format(
                    amount)
                message += "The transaction id is {}".format(transaction_id)
                await ctx.send(message)
            else:
                message = "Failed to fund your Solana account"
                await ctx.send(message)
        else:
            message = "The maximum amount allowed is 2 SOL"
            await ctx.send(message)
    except Exception as e:
        print('error:',e)
        await ctx.send('Failed to fund account')
        return
</pre>
<p>在上面的代码中，我们获得了发送<code>/fund</code>命令的用户的用户名和收到的消息，然后我们将这些值分别存储在名为<code>sender_username</code>和<code>incoming_msg</code>的变量中。</p>
<p>然后，我们从收到的消息中检索用户想要请求的 SOL 数量，并将其存储在一个名为<code>amount</code>的变量中。</p>
<p>在获取金额后，我们检查<code>amount</code>是否大于 2，因为在写本教程时，2 是你可以请求的最大 SOL 金额。如果金额不大于 2，我们在名为<code>message</code>的变量中存储一条消息，说明用户请求的金额将被添加到他的帐户中，并要求他等待。然后，我们使用<code>send()</code>方法将这条消息发送给用户。</p>
<p>通知用户后，我们调用<code>wallet.py</code>文件中的<code>fund_account()</code>函数。我们将用户的用户名和他希望添加到帐户中的 SOL 数量作为参数传递。在调用了<code>fund_account()</code>函数之后，我们将返回的事务 ID 存储在一个名为<code>transaction_id</code>的变量中。</p>
<p>最后，我们使用条件逻辑来检查交易 ID 是否不等于<code>None</code>，如果是这样，我们在一个名为<code>message</code>的变量中存储一条消息，表明他请求的资金被添加到他的帐户中。我们将事务 ID 添加到该消息中，然后将该消息发送给用户。</p>
<p>但是，如果<code>transaction ID</code>等于<code>None</code>,我们会发送一条消息，说明机器人未能向帐户提供资金。</p>
<h3><code>/balance</code>命令</h3>
<p>现在让我们执行<code>/balance</code>命令。用以下代码替换<code>/balance</code>命令处理程序中的代码:</p>
<pre class="language-python hljs">async def balance(ctx):
    sender_username = ctx.message.author
    try:
        data = get_balance(sender_username)
        if data is not None:
            public_key = data['publicKey']
            balance = data['balance']
            message = "Your Solana account {} balance is {} SOL".format(
                public_key, balance)
            await ctx.send(message)
        else:
            message = "Failed to retrieve balance"
            await ctx.send(message)
    except Exception as e:
        print('error:',e)
        await ctx.send('Failed to check account balance')
        return
</pre>
<p>这里，首先，我们获取发送<code>/balance</code>命令的用户的用户名，并将其存储在一个名为<code>sender_username</code>的变量中。</p>
<p>然后我们调用<code>wallet.py</code>文件中的<code>get_balance()</code>函数。我们将用户的用户名作为参数传递，并将其存储在一个名为<code>data</code>的变量中，作为该函数返回的对象。这个对象应该包含用户的 Solana 帐户公钥和余额。</p>
<p>最后，我们使用条件逻辑来检查返回值是否不等于<code>None</code>。如果是这种情况，我们将消息存储在名为<code>message</code>的变量中，包含用户的 Solana 帐户公钥和余额，然后我们将消息发送给用户。</p>
<p>然而，如果由<code>get_balance()</code>返回的值等于<code>None</code>,我们将发送一条消息，说明机器人未能检索到帐户余额。</p>
<h3><code>/send</code>命令</h3>
<p>继续，用以下代码替换<code>/send</code>命令处理程序中的代码:</p>
<pre class="language-python hljs">async def send(ctx):
    sender_username = ctx.message.author
    incoming_msg = ctx.message.content
    try:
        split_msg = incoming_msg.split(" ")
        amount = float(split_msg[1])
        receiver = split_msg[2]
        message = "Sending {} SOL to {}, please wait !!!".format(
            amount, receiver)
        await ctx.send(message)
        transaction_id = send_sol(sender_username, amount, receiver)
        if transaction_id is not None:
            message = "You have successfully sent {} SOL to {} n".format(
                amount, receiver)
            message += "The transaction id is {}".format(transaction_id)
            await ctx.send(message)
        else:
            message = "Failed to send SOL"
            await ctx.send(message)
    except Exception as e:
        print('error:',e)
        await ctx.send('Failed to send SOL')
        return
</pre>
<p>在上面的代码中，我们获得了发送<code>/send</code>命令的用户的用户名，收到的消息，然后我们将这些值分别存储在一个名为<code>sender_username</code>和<code>incoming_msg</code>的变量中。</p>
<p>然后，我们解析传入的消息，从中检索用户希望发送的 SOL 数量和接收者帐户的地址，并将这些值分别存储在名为<code>amount</code>和<code>receiver</code>的变量中。</p>
<p>在存储了<code>amount</code>和<code>receiver</code>之后，向用户发送一条消息，通知她希望发送的 SOL 的数量正在被发送到接收器，并要求用户等待。</p>
<p>通知用户后，我们调用<code>wallet.py</code>文件中的<code>send_sol()</code>函数。我们将用户的用户名、她希望转移的 SOL 数量以及接收者的地址作为参数传递。然后，我们将该函数返回的事务 ID 存储在一个名为<code>transaction_id</code>的变量中。</p>
<p>最后，我们使用条件逻辑来检查事务 ID 是否不等于<code>None</code>。如果是这种情况，我们在名为<code>message</code>的变量中存储一条消息，说明用户成功地将 SOL 发送到了所需的帐户。我们将交易 ID 附加到消息中，然后将消息发送给用户。</p>
<p>然而，如果<code>send_sol()</code>函数返回的值等于<code>None</code>,我们会发送一条消息，说明机器人未能发送 SOL。</p>
<p>替换每个命令处理程序中的代码后，<code>main.py</code>文件应该如下所示:</p>
<pre class="language-python hljs">import os
import discord
from discord.ext import commands
from dotenv import load_dotenv
from wallet import create_account, fund_account, get_balance, send_sol

load_dotenv()
description = ''' A bot that allows you to create and manage a Solana wallet  '''
intents = discord.Intents.default()
bot = commands.Bot(command_prefix='/', description=description, intents=intents)

@bot.event
async def on_ready():
    print('Bot is online')
    print(bot.user.name)
    print(bot.user.id)
    print('------ n')

@bot.command(description='Create a new solana account')
async def create(ctx):
    sender_username = ctx.message.author
    try:
        public_key = create_account(sender_username)
        if public_key is not None:
            message = "Solana Account created successfully.n"
            message += "Your account public key is {}".format(public_key)
            await ctx.send(message)
        else:
            message = "Failed to create account.n"
            await ctx.send(message)
    except Exception as e:
        print('error:',e)
        await ctx.send('Failed to create account')
        return

@bot.command(description='Fund your account')
async def fund(ctx):
    sender_username = ctx.message.author
    incoming_msg = ctx.message.content
    try:
        amount = float(incoming_msg.split(" ")[1])
        if amount &lt;= 2 :
            message = "Requesting {} SOL to your Solana account, please wait !!!".format(amount)
            await ctx.send(message)
            transaction_id = fund_account(sender_username, amount)
            if transaction_id is not None:
                message = "You have successfully requested {} SOL for your Solana account n".format(
                    amount)
                message += "The transaction id is {}".format(transaction_id)
                await ctx.send(message)
            else:
                message = "Failed to fund your Solana account"
                await ctx.send(message)
        else:
            message = "The maximum amount allowed is 2 SOL"
            await ctx.send(message)
    except Exception as e:
        print('error:',e)
        await ctx.send('Failed to fund account')
        return

@bot.command(description='Check your account balance')
async def balance(ctx):
    sender_username = ctx.message.author
    try:
        data = get_balance(sender_username)
        if data is not None:
            public_key = data['publicKey']
            balance = data['balance']
            message = "Your Solana account {} balance is {} SOL".format(
                public_key, balance)
            await ctx.send(message)
        else:
            message = "Failed to retrieve balance"
            await ctx.send(message)
    except Exception as e:
        print('error:',e)
        await ctx.send('Failed to check account balance')
        return

@bot.command(description='Send SOL to another account')
async def send(ctx):
    sender_username = ctx.message.author
    incoming_msg = ctx.message.content
    try:
        split_msg = incoming_msg.split(" ")
        amount = float(split_msg[1])
        receiver = split_msg[2]
        message = "Sending {} SOL to {}, please wait !!!".format(
            amount, receiver)
        await ctx.send(message)
        transaction_id = send_sol(sender_username, amount, receiver)
        if transaction_id is not None:
            message = "You have successfully sent {} SOL to {} n".format(
                amount, receiver)
            message += "The transaction id is {}".format(transaction_id)
            await ctx.send(message)
        else:
            message = "Failed to send SOL"
            await ctx.send(message)
    except Exception as e:
        print('error:',e)
        await ctx.send('Failed to send SOL')
        return

bot.run(os.environ['BOT_TOKEN'])
</pre>
<p>返回运行<code>main.py</code>文件的终端窗口，停止该进程，然后使用以下命令再次运行它:</p>
<pre class="language-python hljs">python main.py
</pre>
<p>转到您喜欢的 Discord 客户端，向您的机器人发送<code>/create</code>命令，创建一个新的 Solana 帐户。您应该会看到类似下面的内容:</p>
<p><img decoding="async" src="../Images/f1bfe281c275167394ed95118f6356a5.png" alt="" data-lazy-src="https://paper-attachments.dropbox.com/s_49F870A97AE5AE1F3DD67AA50C67A2DD4A2FD98419F9C76FD978BEC8A8304603_1643058124448_d_create.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://paper-attachments.dropbox.com/s_49F870A97AE5AE1F3DD67AA50C67A2DD4A2FD98419F9C76FD978BEC8A8304603_1643058124448_d_create.png"/></p><noscript><img data-lazy-fallback="1" decoding="async" src="../Images/f1bfe281c275167394ed95118f6356a5.png" alt="" data-original-src="https://paper-attachments.dropbox.com/s_49F870A97AE5AE1F3DD67AA50C67A2DD4A2FD98419F9C76FD978BEC8A8304603_1643058124448_d_create.png"/></noscript>
<p>复制公钥并将其存储在某个地方以备后用。再次发送<code>/create</code>命令，生成一个新的 Solana 账户。</p>
<p>现在，发送<code>/fund 2</code>命令，用两个 SOL 令牌为您的 SOL 帐户提供资金。您可以随意将数量更改为小于 2 的任何值。您应该会看到类似下面的内容:</p>
<p><img decoding="async" class="alignnone jetpack-lazy-image" src="../Images/7f1f96796c971803119d5cec68c7a354.png" alt="Screenshot of the fund 2 command in action" data-lazy-src="https://paper-attachments.dropbox.com/s_49F870A97AE5AE1F3DD67AA50C67A2DD4A2FD98419F9C76FD978BEC8A8304603_1643058180014_d_fund.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://paper-attachments.dropbox.com/s_49F870A97AE5AE1F3DD67AA50C67A2DD4A2FD98419F9C76FD978BEC8A8304603_1643058180014_d_fund.png"/></p><noscript><img data-lazy-fallback="1" decoding="async" loading="lazy" class="alignnone" src="../Images/7f1f96796c971803119d5cec68c7a354.png" alt="Screenshot of the fund 2 command in action" data-original-src="https://paper-attachments.dropbox.com/s_49F870A97AE5AE1F3DD67AA50C67A2DD4A2FD98419F9C76FD978BEC8A8304603_1643058180014_d_fund.png"/></noscript>
<p>请务必测试其他命令，以确保它们都能按预期工作。</p>
<h2>结论</h2>
<p>在本教程中，您学习了如何创建一个 Solana Discord 聊天机器人钱包，该钱包能够创建一个 Solana 帐户，为该帐户提供资金，检索该帐户的余额，并将 SOL 发送到另一个 Solana 帐户。</p>
<p>我们在本教程中构建的 Solana Discord 钱包尚未准备好投入生产，我建议在将 SOL 发送到另一个帐户之前添加更多功能，如身份验证和帐户余额检查。完整的应用程序代码可以在<a href="https://github.com/CSFM93/logrocket-solana-discord-wallet" target="_blank" rel="noopener">这个库</a>中找到。</p>
<p>有关 Solana 和 discord.py 包的更多信息，请访问<a href="https://docs.solana.com/" target="_blank" rel="noopener"> Solana 文档</a>和<a href="https://discordpy.readthedocs.io/en/stable/" target="_blank" rel="noopener"> discord.py 文档</a>。</p><div class="code-block code-block-26">
<div class="blog-plug inline-plug blockchain-plug"><h2>加入像 Bitso 和 Coinsquare 这样的组织，他们使用 LogRocket 主动监控他们的 Web3 应用</h2><p>影响用户在您的应用中激活和交易的能力的客户端问题会极大地影响您的底线。如果您对监控 UX 问题、自动显示 JavaScript 错误、跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a target="_blank" href="https://lp.logrocket.com/blg/web3-signup">try LogRocket</a><p>.</p><a class="signup" href="https://lp.logrocket.com/blg/web3-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/dacb06c713aec161ffeaffae5bd048cd.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/dacb06c713aec161ffeaffae5bd048cd.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png"/></noscript></a><a href="https://lp.logrocket.com/blg/web3-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用的 DVR，记录你的网络应用或网站上发生的一切。您可以汇总和报告关键的前端性能指标，重放用户会话和应用程序状态，记录网络请求，并自动显示所有错误，而不是猜测问题发生的原因。</p><p>现代化您调试 web 和移动应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/web3-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>