<html>
<head>
<title>Exploring React Suspense with React Freeze - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>探索 React 悬念与 React 冻结日志火箭博客</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/exploring-react-suspense-react-freeze/#0001-01-01">https://blog.logrocket.com/exploring-react-suspense-react-freeze/#0001-01-01</a></blockquote><div><article class="article-post">
<p>如果你关注 React，你肯定听说过<a href="https://17.reactjs.org/docs/concurrent-mode-suspense.html">React suspension</a>，这是一个允许你在 React 项目中优雅地处理加载和渲染数据的组件。在写这篇文章的时候，React 悬疑还在实验阶段。</p>
<p>为了进一步发展 React 悬念背后的想法，<a href="https://github.com/software-mansion/react-freeze"> React Freeze </a>项目本质上使您能够冻结组件渲染并控制 React 应用程序中实际更新的内容。这种方法适用于 React 本地项目，以及常规的 React web 应用程序。</p>
<p>在本文中，我们将介绍 React Freeze，学习如何在我们的应用程序中使用它。首先，我将介绍 React 悬念，然后在一个演示项目中展示它是如何工作的。接下来，我将展示 React Freeze 如何增强你看到的 React 悬念。</p>
<p>如果你想继续，我在我的<a href="https://www.github.com/andrewevans0102/react-suspense-and-freeze">React-suspension-and-Freeze</a>GitHub repo 中有 React Suspense 和 React Freeze 实现的例子。我们开始吧！</p>

<h2 id="what-react-suspense">什么是反应悬疑？</h2>
<p>React 悬念是一个实验性的概念，在 React 18 中<a href="https://reactjs.org/blog/2022/03/29/react-v18.html#gradually-adopting-concurrent-features">可用。要安装 React 悬念，我推荐</a><a href="https://github.com/reactwg/react-18/discussions/9">安装 React 18 </a>并查看本 Github 线程中的<a href="https://github.com/reactwg/react-18/discussions/112">信息。本质上，React Suspense 允许您通过暂停渲染来优雅地处理加载数据，直到组件的所有部分都准备好显示。</a></p>
<p>开发人员在前端开发中面临的一个常见问题是，您可能需要等待 API 调用，或者您可能希望控制向用户显示什么，这样他们就不会看到不完整的数据。React Suspense 提供了一个<code>suspense</code>组件，它包括一个在组件加载时显示的<code>fallback</code>。</p>
<p>看看下面的例子，它最初是从 CodePen 项目复制而来的<a href="https://codesandbox.io/s/frosty-hermann-bztrp?file=/src/fakeApi.js:0-1585">:</a></p>
<pre class="“language-javascript">function ProfilePage() {
  return (
    &lt;Suspense
      fallback={&lt;h1&gt;Loading profile...&lt;/h1&gt;}
    &gt;
      &lt;ProfileDetails /&gt;
      &lt;Suspense
        fallback={&lt;h1&gt;Loading posts...&lt;/h1&gt;}
      &gt;
        &lt;ProfileTimeline /&gt;
      &lt;/Suspense&gt;
    &lt;/Suspense&gt;
  );
}</pre>
<p>正如您在上面的代码中看到的，有一个<code>&lt;ProfileDetails /&gt;</code>组件和一个<code>&lt;ProfileTimeline /&gt;</code>组件。</p>
<p><code>fallback</code>是一个基本的<code>&lt;h1&gt;</code>元素，只有单词<code>Loading profile…</code>和<code>Loading posts…</code>。有了这个功能，您不必添加任何条件语句或在代码中使用<code>useEffect</code>来验证是否加载了某些东西。</p>
<p>下面的例子<a href="https://codesandbox.io/s/frosty-hermann-bztrp">最初是从 React QuickStart 例子</a>中复制的，包括一个模仿 API 调用的<code>suspender</code>实现。我们使用了很多机制来处理这种活动，比如<code>try...catch</code>块，以及 Axios 之类的库。你可以在下面的<code>fakeApi.js</code>文件中的<code>wrapPromise</code>函数中看到:</p>
<pre class="“language-javascript">  function wrapPromise(promise) {
    let status = "pending";
    let result;
    let suspender = promise.then(
      (r) =&gt; {
        status = "success";
        result = r;
      },
      (e) =&gt; {
        status = "error";
        result = e;
      }
    );
    return {
      read() {
        if (status === "pending") {
          throw suspender;
        } else if (status === "error") {
          throw result;
        } else if (status === "success") {
          return result;
        }
      }
    };
  }
</pre>
<p>包装<code>&lt;Suspense&gt;</code>元素用<code>fallback</code>元素处理这个调用的结果。</p>
<p>这些概念可能对开发人员非常有用，我很高兴在 React 的未来版本中看到它们。如果你想了解更多关于这个特性开发的信息，请查看<a href="https://reactjs.org/blog/2021/06/08/the-plan-for-react-18.html"> React 文档</a>。</p>
<h2 id="what-react-freeze">什么是反应冻结？</h2>
<p>React Freeze 基于 React suspension 中提出的想法，使您能够暂停组件渲染以获得良好的用户体验。该方法类似于 React Suspense，如您在下面的示例中所见，该示例从 React Freeze GitHub Repo 中复制了<a href="https://github.com/software-mansion/react-freeze">:</a></p>
<pre class="“language-javascript">function SomeComponent({ shouldSuspendRendering }) {
  return (
    &lt;Freeze freeze={shouldSuspendRendering}&gt;
      &lt;MyOtherComponent /&gt;
    &lt;/Freeze&gt;
  );
}
</pre>
<p>在上面的例子中，您用一个<code>&lt;Freeze&gt;</code>元素包装您的组件。然后将一个<code>boolean</code>标志传递给<code>Freeze</code>元素，以确定子组件是否被呈现。在 web 应用程序中这样做是有利的，因为您可以控制应用程序的呈现，甚至可以防止不完整的数据被不必要地呈现。</p>
<p>如果您跟随我的示例项目，查看<code>react-freeze-sample-project</code>文件夹，您会看到下面的代码:</p>
<pre class="“language-javascript">   profileResponse === null ?  
      &lt;h1&gt;Loading profile...&lt;/h1&gt; :
      &lt;&gt;
        &lt;button onClick={() =&gt; callService()}&gt;refresh&lt;/button&gt;
        &lt;Freeze freeze={profileResponse === null}&gt;
          &lt;ProfileDetails user={profileResponse} /&gt;
          { postsResponse === null ?
            &lt;h1&gt;Loading posts...&lt;/h1&gt; :
            &lt;Freeze freeze={postsResponse === null}&gt;
              &lt;ProfileTimeline posts={postsResponse} /&gt;
            &lt;/Freeze&gt;
          }
        &lt;/Freeze&gt;  
      &lt;/&gt;
  );
</pre>
<p>类似于我们对悬念所做的，我们用一个<code>&lt;Freeze&gt;</code>元素包装我们的组件，然后决定何时显示它们。我的示例项目非常简单，但是您可以想象这在一个更大的应用程序中是多么有用。</p>
<p>就像有一个<code>Suspender</code>机制一样，如果你查看<a href="https://github.com/software-mansion/react-freeze/blob/main/src/index.tsx">React Freeze 源代码</a>，你会看到渲染实际上是如何处理的:</p>
<pre class="“language-javascript">function Suspender({
  freeze,
  children,
}: {
  freeze: boolean;
  children: React.ReactNode;
}) {
  const promiseCache = useRef&lt;StorageRef&gt;({}).current;
  if (freeze &amp;&amp; !promiseCache.promise) {
    promiseCache.promise = new Promise((resolve) =&gt; {
      promiseCache.resolve = resolve;
    });
    throw promiseCache.promise;
  } else if (freeze) {
    throw promiseCache.promise;
  } else if (promiseCache.promise) {
    promiseCache.resolve!();
    promiseCache.promise = undefined;
  }

  return &lt;Fragment&gt;{children}&lt;/Fragment&gt;;
}
</pre>
<h2 id="react-native-freeze">自然反应和冻结反应</h2>
<p>您也可以通过<a href="https://github.com/software-mansion/react-freeze">导入<code>Freeze</code>元素</a>在 React 本地应用程序中启用这种行为:</p>
<pre class="“language-javascript">import { enableFreeze } from "react-native-screens";

enableFreeze(true);
</pre>
<p>React 本机应用程序使用一个<a href="https://reactnative.dev/docs/navigation">导航堆栈</a>来处理屏幕，这意味着当用户前进时，前一个屏幕的状态会保存在一个堆栈中以供将来使用。如果使用 React Native 实现 React Freeze，则可以控制在不同屏幕上呈现的内容。</p>
<p>我的示例项目在一个 web 应用程序中只有暂停和冻结实现；如果你想看 React Freeze 和 React Native 的例子，可以查看 Natanaelvich 在<a href="https://github.com/Natanaelvich/react-freeze-example"> react-freeze-example </a>的示例项目。</p>
<h2 id="visualizing-freeze-suspense">可视化冻结和悬念</h2>
<p>当我写这篇文章时，我发现 Chrome DevTools 对可视化渲染非常有帮助。如果你打开 Chrome DevTools 并选择<strong>渲染</strong>，你可以选择<strong>绘制闪烁</strong>，这将绘制你的页面部分，如下图所示:</p>
<p><img data-attachment-id="103103" data-permalink="https://blog.logrocket.com/exploring-react-suspense-react-freeze/chrome-devtools-paint-flashing/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/04/chrome-devtools-paint-flashing.jpeg" data-orig-size="730,403" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="chrome-devtools-paint-flashing" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/04/chrome-devtools-paint-flashing-300x166.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/04/chrome-devtools-paint-flashing.jpeg" decoding="async" class="aligncenter wp-image-103103 size-full jetpack-lazy-image" src="../Images/1ca929a411b93ee646c4ce7247c6b023.png" alt="Chrome DevTools Paint Flashing" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/04/chrome-devtools-paint-flashing.jpeg 730w, https://blog.logrocket.com/wp-content/uploads/2022/04/chrome-devtools-paint-flashing-300x166.jpeg 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/04/chrome-devtools-paint-flashing.jpeg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/04/chrome-devtools-paint-flashing.jpeg"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="103103" data-permalink="https://blog.logrocket.com/exploring-react-suspense-react-freeze/chrome-devtools-paint-flashing/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/04/chrome-devtools-paint-flashing.jpeg" data-orig-size="730,403" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="chrome-devtools-paint-flashing" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/04/chrome-devtools-paint-flashing-300x166.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/04/chrome-devtools-paint-flashing.jpeg" decoding="async" loading="lazy" class="aligncenter wp-image-103103 size-full" src="../Images/1ca929a411b93ee646c4ce7247c6b023.png" alt="Chrome DevTools Paint Flashing" srcset="https://blog.logrocket.com/wp-content/uploads/2022/04/chrome-devtools-paint-flashing.jpeg 730w, https://blog.logrocket.com/wp-content/uploads/2022/04/chrome-devtools-paint-flashing-300x166.jpeg 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/04/chrome-devtools-paint-flashing.jpeg"/></noscript>
<p>我还推荐在 Chrome 上安装<a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=en"> React 开发者工具扩展。如果你这样做了，你可以在 Chrome DevTools 中打开它并查看渲染的内容:</a></p>
<p><img data-attachment-id="103105" data-permalink="https://blog.logrocket.com/exploring-react-suspense-react-freeze/react-dev-tools-extension/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/04/react-dev-tools-extension.jpeg" data-orig-size="730,259" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="react-dev-tools-extension" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/04/react-dev-tools-extension-300x106.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/04/react-dev-tools-extension.jpeg" decoding="async" class="aligncenter wp-image-103105 size-full jetpack-lazy-image" src="../Images/e7a990511f0855f8af4fae77a1b2c7bb.png" alt="React Dev Tools Extension" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/04/react-dev-tools-extension.jpeg 730w, https://blog.logrocket.com/wp-content/uploads/2022/04/react-dev-tools-extension-300x106.jpeg 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/04/react-dev-tools-extension.jpeg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/04/react-dev-tools-extension.jpeg"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="103105" data-permalink="https://blog.logrocket.com/exploring-react-suspense-react-freeze/react-dev-tools-extension/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/04/react-dev-tools-extension.jpeg" data-orig-size="730,259" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="react-dev-tools-extension" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/04/react-dev-tools-extension-300x106.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/04/react-dev-tools-extension.jpeg" decoding="async" loading="lazy" class="aligncenter wp-image-103105 size-full" src="../Images/e7a990511f0855f8af4fae77a1b2c7bb.png" alt="React Dev Tools Extension" srcset="https://blog.logrocket.com/wp-content/uploads/2022/04/react-dev-tools-extension.jpeg 730w, https://blog.logrocket.com/wp-content/uploads/2022/04/react-dev-tools-extension-300x106.jpeg 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/04/react-dev-tools-extension.jpeg"/></noscript>
<h2 id="wrappingup">包扎</h2>
<p>在这篇文章中，我们谈到了反应冻结和反应悬念。React 悬念是一个强大的概念，我希望在未来的 React 版本中可以使用。React Freeze 提供了类似概念的可靠实现，可以在 web 和 React 本地应用程序中使用。</p>
<p>要标准化这种行为还有一些工作要做，但是控制呈现内容的策略为 React 项目提供了可靠的用户体验和高性能的实现。我还推荐<a href="https://www.github.com/andrewevans0102/react-suspense-and-freeze">查看我的示例项目</a>，并使用 Chrome DevTools 来看看它的运行情况。</p>
<p>感谢您阅读我的帖子！在<a href="https://www.andrewevans.dev/"> andrewevans.dev </a>上关注我，在<a href="https://twitter.com/AndrewEvans0102"> @AndrewEvans0102 </a>的 Twitter 上与我联系。</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720"><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener"> LogRocket </a>:全面了解您的生产 React 应用</h2><p>调试 React 应用程序可能很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪 Redux 状态、自动显示 JavaScript 错误以及跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" vwo-el-id="19356441070">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<p vwo-el-id="28675660440" class="">LogRocket 结合了会话回放、产品分析和错误跟踪，使软件团队能够创建理想的 web 和移动产品体验。这对你来说意味着什么？</p>
<p>LogRocket 不是猜测错误发生的原因，也不是要求用户提供截图和日志转储，而是让您回放问题，就像它们发生在您自己的浏览器中一样，以快速了解哪里出错了。</p>
<p>不再有嘈杂的警报。智能错误跟踪允许您对问题进行分类，然后从中学习。获得有影响的用户问题的通知，而不是误报。警报越少，有用的信号越多。</p>
<p vwo-el-id="28675660750">LogRocket Redux 中间件包为您的用户会话增加了一层额外的可见性。LogRocket 记录 Redux 存储中的所有操作和状态。</p>
<p vwo-el-id="28675661060">现代化您调试 React 应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">开始免费监控</a>。</p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>