<html>
<head>
<title>Exploring bundling in Lightning CSS </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>探索Lightning CSS中的捆绑</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/exploring-bundling-lightning-css/#0001-01-01">https://blog.logrocket.com/exploring-bundling-lightning-css/#0001-01-01</a></blockquote><div><article class="article-post">
<p>随着Astro等专注于减少网站加载时间的框架的兴起，很明显，速度在提高网站性能方面起着至关重要的作用。</p>
<p>有多种方法可以提高网站的加载速度，包括删除多余的JavaScript代码、优化图片、执行延迟加载等等。或者，你可以考虑缩小你网站的CSS。</p>
<p>在本文中，我们将学习如何使用CSS精简器<a href="https://lightningcss.dev"> Lightning CSS </a>来捆绑我们的CSS代码。我们开始吧！</p>
<p><em>向前跳转:</em></p>

<h2 id="what-is-css-minification">什么是CSS缩小？</h2>
<p>CSS缩小是从CSS文件中移除空格、缩进、换行符和注释的过程，从而减小文件大小并将其转换为单行代码。由于重量较轻，CSS加载速度更快，从而减少了网站的整体加载时间:</p>
<p><img data-attachment-id="161971" data-permalink="https://blog.logrocket.com/exploring-bundling-lightning-css/attachment/original-css-vs-minified-css/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/original-css-vs-minified-css.png" data-orig-size="730,302" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="original-css-vs-minified-css" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/original-css-vs-minified-css-300x124.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/original-css-vs-minified-css.png" decoding="async" class="aligncenter wp-image-161971 size-full jetpack-lazy-image" src="../Images/343b01ab09d64c93e8bcbfdce5909698.png" alt="Original CSS Vs Minified CSS" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/original-css-vs-minified-css.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/original-css-vs-minified-css-300x124.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/03/original-css-vs-minified-css.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/original-css-vs-minified-css.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="161971" data-permalink="https://blog.logrocket.com/exploring-bundling-lightning-css/attachment/original-css-vs-minified-css/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/original-css-vs-minified-css.png" data-orig-size="730,302" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="original-css-vs-minified-css" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/original-css-vs-minified-css-300x124.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/original-css-vs-minified-css.png" decoding="async" loading="lazy" class="aligncenter wp-image-161971 size-full" src="../Images/343b01ab09d64c93e8bcbfdce5909698.png" alt="Original CSS Vs Minified CSS" srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/original-css-vs-minified-css.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/original-css-vs-minified-css-300x124.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/original-css-vs-minified-css.png"/></noscript>
<p>最初，开发人员用漂亮的、格式良好的代码编写CSS。但是，在将CSS代码投入生产之前，他们会将其缩小以加快加载速度。大多数现代前端框架和库，如React、Next.js和Astro，都预装了CSS minifier，有时，您可以选择不同的CSS minifier。</p>
<h2 id="what-is-css-bundler">什么是CSS bundler？</h2>
<p>在缩小过程中，我们使用CSS bundler来处理依赖关系。捆绑是通过解决依赖关系和合并文件来创建优化捆绑包的过程。</p>
<p>当CSS解析器读取CSS代码并将其转换为web浏览器可以理解的结构化格式时，浏览器将CSS中的字节转换为一种称为CSSOM的数据结构，这相当于HTML的DOM。下图显示了CSSOM的结构:</p>
<p><img data-attachment-id="162202" data-permalink="https://blog.logrocket.com/exploring-bundling-lightning-css/attachment/cssom-process-flowchart-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/cssom-process-flowchart-diagram.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="cssom-process-flowchart-diagram" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/cssom-process-flowchart-diagram-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/cssom-process-flowchart-diagram.png" decoding="async" class="aligncenter wp-image-162202 size-full jetpack-lazy-image" src="../Images/23a0c7f68134340e35ebe38ae1d49e08.png" alt="CSSOM Process Flowchart Diagram" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/cssom-process-flowchart-diagram.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/cssom-process-flowchart-diagram-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/03/cssom-process-flowchart-diagram.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/cssom-process-flowchart-diagram.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162202" data-permalink="https://blog.logrocket.com/exploring-bundling-lightning-css/attachment/cssom-process-flowchart-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/cssom-process-flowchart-diagram.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="cssom-process-flowchart-diagram" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/cssom-process-flowchart-diagram-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/cssom-process-flowchart-diagram.png" decoding="async" loading="lazy" class="aligncenter wp-image-162202 size-full" src="../Images/23a0c7f68134340e35ebe38ae1d49e08.png" alt="CSSOM Process Flowchart Diagram" srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/cssom-process-flowchart-diagram.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/cssom-process-flowchart-diagram-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/cssom-process-flowchart-diagram.png"/></noscript>
<p>不同的编程语言有不同的CSS解析器；<a href="https://lesscss.org/">小于</a>是JavaScript的一个。</p>
<h2 id="what-is-css-transformer">什么是CSS转换器？</h2>
<p>CSS转换器是一种工具或软件，它将CSS代码作为输入，并对其进行各种修改，例如，删除不必要的空白、优化样式或将其转换为不同的格式或语法。它还可以包括为支持不同CSS属性的不同浏览器添加前缀。</p>
<p>CSS转换器的目标是优化和简化CSS代码，以提高性能和减小文件大小，而不改变样式在浏览器中的显示方式。</p>
<h2 id="what-is-lightning-css">什么是闪电CSS？</h2>
<p>以前称为包裹CSS，照明CSS是用Rust编写的CSS解析器、转换器、捆绑器和迷你器。简而言之，Lightning CSS在CSS文件上运行，为web应用程序创建一个优化的CSS包。</p>
<p>与esbuild和cssnano等其他基于JavaScript的工具相比，使用Lightning CSS缩小大型CSS文件要快得多:</p>
<p><img data-attachment-id="161975" data-permalink="https://blog.logrocket.com/exploring-bundling-lightning-css/attachment/time-minify-bootstrap-lightning-css/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/time-minify-bootstrap-lightning-css.png" data-orig-size="730,143" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="time-minify-bootstrap-lightning-css" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/time-minify-bootstrap-lightning-css-300x59.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/time-minify-bootstrap-lightning-css.png" decoding="async" class="aligncenter wp-image-161975 size-full jetpack-lazy-image" src="../Images/85df0ebc4a9e456642d0f379a8ad4963.png" alt="Time Minify Bootstrap Lightning CSS" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/time-minify-bootstrap-lightning-css.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/time-minify-bootstrap-lightning-css-300x59.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/03/time-minify-bootstrap-lightning-css.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/time-minify-bootstrap-lightning-css.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="161975" data-permalink="https://blog.logrocket.com/exploring-bundling-lightning-css/attachment/time-minify-bootstrap-lightning-css/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/time-minify-bootstrap-lightning-css.png" data-orig-size="730,143" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="time-minify-bootstrap-lightning-css" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/time-minify-bootstrap-lightning-css-300x59.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/time-minify-bootstrap-lightning-css.png" decoding="async" loading="lazy" class="aligncenter wp-image-161975 size-full" src="../Images/85df0ebc4a9e456642d0f379a8ad4963.png" alt="Time Minify Bootstrap Lightning CSS" srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/time-minify-bootstrap-lightning-css.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/time-minify-bootstrap-lightning-css-300x59.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/time-minify-bootstrap-lightning-css.png"/></noscript>
<h2 id="implementing-lightningcss-different-bundlers">在不同的捆绑器中实现Lightning CSS</h2>
<h3 id="parcel">包裹</h3>
<p><a href="https://parceljs.org/">包</a>是一个开源的捆绑器。由同一个人<a href="https://twitter.com/devongovett">德文·戈维特</a>建造，包裹带有对闪电CSS的内置支持。默认情况下，Lightning CSS处理CSS转换；您可以在根目录下的<code>package.json</code>文件中使用以下设置对其进行配置:</p>
<ul>
<li><code>drafts</code>:启用CSS嵌套和自定义媒体查询</li>
<li><code>psedoClasses</code>:处理类似<code>:focus-visible</code>的伪类</li>
<li><code>cssModules</code>:全局启用CSS模块</li>
</ul>
<p>以下是上述配置的代码:</p>
<pre class="language-css hljs">{
  "@parcel/transformer-css": {
    "cssModules": true,
    "drafts": {
      "nesting": true,
      "customMedia": true
    },
    "pseudoClasses": {
      "focusVisible": "focus-ring"
    }
  }
}
</pre>
<h3 id="webpack">网络包</h3>
<p>webpack是另一个用于JavaScript的开源模块捆绑器。我们可以使用<a href="https://www.npmjs.com/package/css-minimizer-webpack-plugin?activeTab=readme"> <code>css-minimizer-webpack-plugin</code> </a>将Lightning CSS与webpack集成，它带有对Lightning CSS的内置支持。</p>
<p>使用下面的命令，安装<code>lightingcss</code>和<code>css-minimizer-webpack-plugin</code>。我们还增加了针对浏览器的<code>browserlist</code>:</p>
<pre class="language-bash hljs">npm install --save-dev lightningcss css-minimizer-webpack-plugin browserslist
</pre>
<p>现在，我们可以配置<code>webpack.config.js</code>文件了。从库中导入所有必需的模块，如下所示:</p>
<pre class="language-javascript hljs">const CssMinimizerPlugin = require('css-minimizer-webpack-plugin');
const lightningcss = require('lightningcss');
const browserslist = require('browserslist');
</pre>
<p>下面是配置:</p>
<pre>module.exports = {
  optimization: {
    minimize: true,
    minimizer: [
      new CssMinimizerPlugin({
        minify: CssMinimizerPlugin.lightningCssMinify,
        minimizerOptions: {
          targets: lightningcss.browserslistToTargets(browserslist('&gt;= 0.25%'))
        },
      }),
    ],
  },
};
</pre>
<h3 id="vite">轻快地</h3>
<p>再来说说Vite这个好奇的案例。在撰写本文时，还没有官方的方法将Lightning CSS与Vite集成，因为没有可用的插件。但是，有第三方库；<a href="https://github.com/lawrencecchen/vite-plugin-lightningcss"> <code>vite-plugin-lightningcss</code> </a>只能在transpilation方面帮到你，trans pilation是将现代CSS语法代码转换为支持旧版浏览器的过程。</p>
<p>用下面的命令安装<code>vite-plugin-lightningcss</code>:</p>
<pre class="language-bash hljs">npm install --save-dev vite-plugin-lightningcss
</pre>
<p>接下来，我们只需要使用下面的代码配置<code>vite.config.ts</code>文件:</p>
<pre class="language-javascript hljs">import lightningcss from 'vite-plugin-lightningcss';

export default {
  plugins: [
    lightningcss({
      browserslist: '&gt;= 0.25%',
    }),
  ],
};
</pre>
<h2 id="bundling-node-js">Node.js中的绑定</h2>
<p>Lightning CSS支持在Node.js应用程序中捆绑CSS代码。使用<code>bundle</code>函数，我们可以从特定文件中缩小并捆绑代码。<code>bundle</code>将使<code>code</code>和<code>map</code>返回缓冲状态；<code>code</code>是缩小的代码，<code>map</code>是文件的源码图，在调试时很有用:</p>
<pre class="language-javascript hljs">import { bundle } from 'lightningcss';

let { code, map } = bundle({
  filename: 'style.css',
  minify: true
});
</pre>
<h2 id="custom-javascript-resolver">自定义JavaScript解析器</h2>
<p>为了支持自定义解析器，Lightning CSS支持<code>bundleAsync</code>函数，这是常规<code>bundle</code>的异步版本。它支持添加自定义解析器，以<code>resolver</code>为对象。对象的属性是函数；<code>read</code>和<code>resolve</code>是两个功能，都是可选的。下面是示例的代码:</p>
<pre class="language-javascript hljs">import { bundleAsync } from 'lightningcss';

let { code, map } = await bundleAsync({
  filename: 'style.css',
  minify: true,
  resolver: {
    read(filePath) {
      return fs.readFileSync(filePath, 'utf8');
    },
    resolve(specifier, from) {
      return path.resolve(path.dirname(from), specifier);
    }
  }
});
</pre>
<h2 id="conclusion">结论</h2>
<p>在本教程中，我们探索了使用Lightning CSS库缩小和捆绑CSS，这是一个使用插件来集成包裹和其他捆绑应用程序的工具。其中一些不是官方插件，支持有限。但是，尽管如此，当您将Lightning CSS用作Node.js中的库时，它还是非常强大的。</p>
<p>如果你想让你喜欢的工具集成Lightning CSS，那么你可以将它们固定为插件。希望本文能帮助您更好地理解使用Lightning CSS进行捆绑。感谢阅读！</p><div class="code-block code-block-25">
<div class="blog-plug inline-plug css-plug"><h2>你的前端是否占用了用户的CPU？</h2><p>随着web前端变得越来越复杂，资源贪婪的特性对浏览器的要求越来越高。如果您对监控和跟踪生产环境中所有用户的客户端CPU使用、内存使用等感兴趣，</p><a target="_blank" href="https://lp.logrocket.com/blg/css-signup">try LogRocket</a><p>.</p><a class="signup" href="https://lp.logrocket.com/blg/css-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/dacb06c713aec161ffeaffae5bd048cd.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/dacb06c713aec161ffeaffae5bd048cd.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png"/></noscript></a><a href="https://lp.logrocket.com/blg/css-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用的DVR，记录你的网络应用或网站上发生的一切。您可以汇总和报告关键的前端性能指标，重放用户会话和应用程序状态，记录网络请求，并自动显示所有错误，而不是猜测问题发生的原因。</p><p>现代化您调试web和移动应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/css-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>