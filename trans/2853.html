<html>
<head>
<title>React Native WebView: A complete guide - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>React Native WebView:一个完整的指南- LogRocket 博客</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/react-native-webview-a-complete-guide/#0001-01-01">https://blog.logrocket.com/react-native-webview-a-complete-guide/#0001-01-01</a></blockquote><div><article class="article-post">
<p>WebViews 为开发人员提供了在 React 本地应用程序中呈现任何 web 组件的机会。web 组件可以是整个网页/应用程序中的任何内容，也可以只是一个简单的 HTML 文件。软件包<code><a href="https://github.com/react-native-webview/react-native-webview" target="_blank" rel="noopener">react-native-webview</a></code>使得将 WebViews 嵌入 React 本地应用程序变得非常简单！</p>
<p>在本帖中，我们将探讨 React Native WebView 最常见的使用案例，包括:</p>

<p>下面，你可以找到这个分步指南的最终结果。如您所见，我们显示随机编程语言，最后，我们被重定向到 LogRocket 博客部分！</p>
<p><img data-attachment-id="102118" data-permalink="https://blog.logrocket.com/?attachment_id=102118" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/final-react-native-webview-demo.gif" data-orig-size="730,1578" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="final-react-native-webview-demo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/final-react-native-webview-demo-139x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/final-react-native-webview-demo-474x1024.gif" decoding="async" class="aligncenter size-full wp-image-102118 jetpack-lazy-image" src="../Images/d2f49fe75e0c05d1d99f3f4e62bfa120.png" alt="Our final React Native WebView demo" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/02/final-react-native-webview-demo.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/final-react-native-webview-demo.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="102118" data-permalink="https://blog.logrocket.com/?attachment_id=102118" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/final-react-native-webview-demo.gif" data-orig-size="730,1578" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="final-react-native-webview-demo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/final-react-native-webview-demo-139x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/final-react-native-webview-demo-474x1024.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-102118" src="../Images/d2f49fe75e0c05d1d99f3f4e62bfa120.png" alt="Our final React Native WebView demo" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/final-react-native-webview-demo.gif"/></noscript>
<h3>先决条件</h3>
<p>我个人在开发 React 原生应用时使用<a href="https://docs.expo.dev" target="_blank" rel="noopener"> Expo </a>,所以您应该通过在您的机器上运行以下代码来安装 Expo 客户端:</p>
<pre class="language-bash hljs">npm install --global expo-cli</pre>
<p>除了使用 Expo，我可以推荐使用 Visual Studio 代码或类似的东西。此外，JavaScript、React/React Native 和 HTML 的一些基础知识将帮助您了解本教程。</p>
<h2 id="getting-started">入门指南</h2>
<p>所以，首先，让我们初始化我们的项目！转到您想要存储项目的目录。在这个目录中，运行<code>expo init my-project</code>来初始化 Expo 项目。您可以将“我的项目”替换为您喜欢的任何名称。</p>
<p>然后，用<code>cd my-project</code>切换到新创建的目录，并运行<code>expo start</code>来启动开发服务器。Expo 让你决定你想用哪种设备工作；我在上面的演示和视频中使用的设备是一台安装了 iOS 版本 14.5 的 iPhone 12 Pro Max。</p>
<p>但是在开始我们的应用之前，我们仍然需要安装<a href="https://github.com/react-native-webview/react-native-webview" target="_blank" rel="noopener"> React 原生 WebView 包</a>。为此，在项目目录中运行以下命令:</p>
<pre class="language-bash hljs">expo install react-native-webview
</pre>
<p>这个包可以在 Android 和 iOS 设备上运行。</p>
<p>以下是终端命令的简要概述:</p>
<pre class="language-bash hljs"># cd into the directory where to store your project
 $ cd dir

# initialize the expo project
$ expo init my-project

# navigate inside the newly created project
$ cd my-project

# install the webview package
$ expo install react-native-webview

# run the development server
$ expo start
</pre>
<h2 id="creating-basic-url-structure">创建基本的 URL 结构</h2>
<p>为了简单起见，我们将把我们的代码添加到<code>App.js</code>文件中，我们不会创建任何额外的文件。</p>
<p>将 WebView 嵌入 React 本机应用程序的最简单方法是提供一个 URL 作为 WebView 组件的源:</p>
<pre class="language-javascript hljs"># App.js
import React, { Component } from 'react';
import { SafeAreaView } from "react-native";
import { WebView } from 'react-native-webview';

class MyWeb extends Component {
  render() {
    return (
      &lt;SafeAreaView style={{ flex: 1 }}&gt;
        &lt;WebView 
          source={{ uri: 'https://reactnative.dev/' }} 
        /&gt;
      &lt;/SafeAreaView&gt;
    );
  }
}
</pre>
<p>为了使用 WebView 组件，您必须导入它，正如我们在第 4 行中所做的那样。之后你需要做的就是设置<code>source</code>道具！</p>
<p>请注意，<code>source</code>以一个对象作为值。在这种情况下，我们提供一个<code>URI</code>:</p>
<pre class="language-javascript hljs">source={{ uri: 'https://reactnative.dev/' }} 
</pre>
<p>这段代码将产生类似这样的结果:</p>
<p><img data-attachment-id="102121" data-permalink="https://blog.logrocket.com/?attachment_id=102121" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/basic-url-structure.png" data-orig-size="337,719" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="basic-url-structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/basic-url-structure-141x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/basic-url-structure.png" decoding="async" class="aligncenter size-full wp-image-102121 jetpack-lazy-image" src="../Images/8e675b6a9e76233210c2ffab8d337380.png" alt="Our basic URL structure has been created" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/02/basic-url-structure.png 337w, https://blog.logrocket.com/wp-content/uploads/2021/02/basic-url-structure-141x300.png 141w" data-lazy-sizes="(max-width: 337px) 100vw, 337px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/02/basic-url-structure.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/basic-url-structure.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="102121" data-permalink="https://blog.logrocket.com/?attachment_id=102121" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/basic-url-structure.png" data-orig-size="337,719" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="basic-url-structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/basic-url-structure-141x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/basic-url-structure.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-102121" src="../Images/8e675b6a9e76233210c2ffab8d337380.png" alt="Our basic URL structure has been created" srcset="https://blog.logrocket.com/wp-content/uploads/2021/02/basic-url-structure.png 337w, https://blog.logrocket.com/wp-content/uploads/2021/02/basic-url-structure-141x300.png 141w" sizes="(max-width: 337px) 100vw, 337px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/basic-url-structure.png"/></noscript>
<h2 id="writing-basic-inline-html">编写基本的内联 HTML</h2>
<p>为 WebView 提供源代码的另一种常见方式是编写一些内嵌的 HTML 代码。让我们从一个非常简单的例子开始:</p>
<pre class="language-javascript hljs"># App.js

class MyWeb extends Component {
  render() {
    const customHTML = `
      &lt;body style="display:flex; flex-direction: column;justify-content: center; 
        align-items:center; background-color: black; color:white; height: 100%;"&gt;
          &lt;h1 style="font-size:100px; padding: 50px; text-align: center;" 
          id="h1_element"&gt;
            This is simple html
          &lt;/h1&gt;
          &lt;h2 style="display: block; font-size:80px; padding: 50px; 
          text-align: center;" id="h2_element"&gt;
            This text will be changed later!
          &lt;/h2&gt;
       &lt;/body&gt;`;

    return (
      &lt;SafeAreaView style={{ flex: 1 }}&gt;
        &lt;WebView 
          source={{ html: customHTML }} 
        /&gt;
      &lt;/SafeAreaView&gt;
    );
  }
}
</pre>
<p>这将是结果:</p>
<p><img data-attachment-id="102123" data-permalink="https://blog.logrocket.com/?attachment_id=102123" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/writing-basic-inline-html.png" data-orig-size="730,1590" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="writing-basic-inline-html" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/writing-basic-inline-html-138x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/writing-basic-inline-html-470x1024.png" decoding="async" class="aligncenter size-full wp-image-102123 jetpack-lazy-image" src="../Images/42237ce640ddb6721c35ead41f6e4afe.png" alt="After writing the basic inline HTML we need, we receive this result" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/02/writing-basic-inline-html.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/02/writing-basic-inline-html-138x300.png 138w, https://blog.logrocket.com/wp-content/uploads/2021/02/writing-basic-inline-html-470x1024.png 470w, https://blog.logrocket.com/wp-content/uploads/2021/02/writing-basic-inline-html-705x1536.png 705w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/02/writing-basic-inline-html.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/writing-basic-inline-html.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="102123" data-permalink="https://blog.logrocket.com/?attachment_id=102123" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/writing-basic-inline-html.png" data-orig-size="730,1590" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="writing-basic-inline-html" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/writing-basic-inline-html-138x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/writing-basic-inline-html-470x1024.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-102123" src="../Images/42237ce640ddb6721c35ead41f6e4afe.png" alt="After writing the basic inline HTML we need, we receive this result" srcset="https://blog.logrocket.com/wp-content/uploads/2021/02/writing-basic-inline-html.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/02/writing-basic-inline-html-138x300.png 138w, https://blog.logrocket.com/wp-content/uploads/2021/02/writing-basic-inline-html-470x1024.png 470w, https://blog.logrocket.com/wp-content/uploads/2021/02/writing-basic-inline-html-705x1536.png 705w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/writing-basic-inline-html.png"/></noscript>
<p>这段代码与之前的代码最根本的区别在于，现在我们使用内联 HTML 作为 WebView 组件的源:<code>source={{ html: customHTML }}</code>。</p>
<p>从第 6–16 行，我们定义了常数<code>customHTML</code>。最终，这只是一个包含一个<code>h1</code>和一个<code>h2</code>标签的字符串，包裹在一个<code>body</code>标签中。</p>
<p>此外，我们定义了一些基本的内联样式，以便使元素居中并提供一些背景颜色。</p>
<p>这就是你如何轻松地呈现你的定制 HTML 代码。但是，如果您想要包含一些需要包含 JavaScript 的功能，比如动态特性，该怎么办呢？好吧，React Native WebView 也为这个问题提供了解决方案！</p>
<h2 id="communicating-between-javascript-native">JavaScript 和 Native 之间的通信</h2>
<p>让我们从一些代码开始:</p>
<pre class="language-javascript hljs"># App.js

class MyWeb extends Component {
  render() {
  const runFirst = `
      setTimeout(function() { 
          window.alert("Click me!");
          document.getElementById("h1_element").innerHTML = 
          "What is your favourite language?";
          document.getElementById("h2_element").innerHTML =
          "We will see!";
        }, 1000);
      true; // note: this is required, or you'll sometimes get silent failures
    `;

  const runBeforeFirst = `
      window.isNativeApp = true;
      true; // note: this is required, or you'll sometimes get silent failures
  `;

    return (
      &lt;SafeAreaView style={{ flex: 1 }}&gt;
        &lt;WebView 
          source={{ html: customHTML }} 
          onMessage={(event) =&gt; {}}
          injectedJavaScript={runFirst}
          injectedJavaScriptBeforeContentLoaded={runBeforeFirst}
        /&gt;
      &lt;/SafeAreaView&gt;
    );
  }
}
</pre>
<p>如果您看一下第 25–27 行中的 WebView 组件，您会注意到引入了三个新的道具:<code>onMessage</code>、<code>injectedJavaScript</code>和<code>injectedJavaScriptBeforeContentLoaded</code>。</p>
<p>提供给<code>injectedJavaScript</code> prop 的 JavaScript 代码只会在资源第一次加载后执行一次。即使刷新站点，代码也不会被再次执行！</p>
<p>我们的脚本叫做<code>runFirst</code>，可以在第 5–14 行找到。在这个脚本中，我们首先触发一条消息来呈现，然后，我们更改了我们的<code>h1</code>和<code>h2</code>元素的文本。所有这些都封装在一个<code>setTimeout</code>函数中，以便在<code>1s</code>之后运行这个脚本。</p>
<p>另一方面，<code>injectedJavaScriptBeforeContentLoaded</code> prop 中提供的脚本会在页面第一次加载之前执行。相应的脚本<code>runBeforeFirst</code>，可以在第 16–19 行找到。在这种情况下，这个脚本对我们的应用程序的视觉效果没有影响。</p>
<p><code>onMessage</code>道具是必需的，即使这个道具内的函数目前是空的。没有这个属性，脚本将无法运行！</p>
<p><img data-attachment-id="102126" data-permalink="https://blog.logrocket.com/?attachment_id=102126" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/run-injected-javascript-props.gif" data-orig-size="730,1578" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="run-injected-javascript-props" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/run-injected-javascript-props-139x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/run-injected-javascript-props-474x1024.gif" decoding="async" class="aligncenter size-full wp-image-102126 jetpack-lazy-image" src="../Images/a008eac4f00033cd3d22e1744706609b.png" alt="Running the injected JavaScript props we wrote in" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/02/run-injected-javascript-props.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/run-injected-javascript-props.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="102126" data-permalink="https://blog.logrocket.com/?attachment_id=102126" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/run-injected-javascript-props.gif" data-orig-size="730,1578" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="run-injected-javascript-props" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/run-injected-javascript-props-139x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/run-injected-javascript-props-474x1024.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-102126" src="../Images/a008eac4f00033cd3d22e1744706609b.png" alt="Running the injected JavaScript props we wrote in" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/run-injected-javascript-props.gif"/></noscript>
<h3>快速警告</h3>
<p><code>injectedJavaScript</code>和<code>injectedJavaScriptBeforeContentLoaded</code>道具的缺点是它们都只运行一次。然而，如您所知，有些情况下您希望不止一次地执行 JavaScript 代码。这就是我们在下一节要看的内容！</p>
<h2 id="injectjavascript-method"><code>injectJavaScript</code>法</h2>
<p>在这一节中，我们将实现这个演示应用程序的最终功能:随机显示编程语言，最后重定向到 LogRocket 博客的相应部分。</p>
<pre class="language-javascript hljs"># App.js
const selectProgrammingLanguage = () =&gt; {
  const languages = [
    "Rust",
    "Python",
    "JavaScript",
    "TypeScript",
    "C++",
    "Go",
    "R",
    "Java",
    "PHP",
    "Kotlin",
  ];
  const randomInt = Math.floor(Math.random() * languages.length);
  return languages[randomInt];
};

class MyWeb extends Component {
  render() {
  let counter = 1;

  const script = () =&gt; {
      const selectedLanguage = selectProgrammingLanguage();
      counter += 1;
      const newURL = "https://blog.logrocket.com";
      const redirectTo = 'window.location = "' + newURL + '"';

      if (counter &lt;= 10) {
        return `
          if (document.body.style.backgroundColor === 'white') {
            document.body.style.backgroundColor = 'black'
            document.body.style.color = 'white'
          } else {
            document.body.style.backgroundColor = 'white'
            document.body.style.color = 'black'
          };

          document.getElementById("h2_element").innerHTML = "${selectedLanguage}?";
          window.ReactNativeWebView.postMessage("counter: ${counter}");
          true;  // note: this is required, or you'll sometimes get silent failures
      `;
      } else if (counter === 11) {
        return `
          window.ReactNativeWebView.postMessage("you are now getting redirected!");
          ${redirectTo};
          true;  // note: this is required, or you'll sometimes get silent failures
        `;
      } else {
        return null;
      }
    };

    setInterval(() =&gt; {
        this.webref.injectJavaScript(script());
      }, 2000);

    return (
      &lt;SafeAreaView style={{ flex: 1 }}&gt;
        &lt;WebView 
          source={{ html: customHTML }} 
          ref={(r) =&gt; (this.webref = r)}
          onMessage={(event) =&gt; {
          console.log(event.nativeEvent.data);
          }}
          injectedJavaScript={runFirst}
          injectedJavaScriptBeforeContentLoaded={runBeforeFirst}
        /&gt;
      &lt;/SafeAreaView&gt;
    );
  }
}
</pre>
<p>在第 2–17 行，我们首先定义一个函数，它从第 3 行的<code>languages</code>数组中随机返回一种编程语言。然后在第 23 行定义的<code>script</code>函数中再次调用相同的函数。每次调用<code>script</code>函数时，都会创建一个随机编程语言，并包含在 HTML 代码的第 39 行:</p>
<pre class="language-javascript hljs">document.getElementById("h2_element").innerHTML = "${selectedLanguage}?";
</pre>
<p>此外，每次背景从黑色变为白色(或者相反)，我们也需要字体颜色发生变化——但是这只会发生在这个函数被调用的前十次。</p>
<p>在第十次执行之后，脚本跳转到第 44–48 行。在那里，我们定义了我们希望被重定向到第 26 和 27 行中定义的 URL。</p>
<p>最后，您可能会问自己在哪里调用了<code>script</code>函数。如果你看一下第 54-56 行，你会注意到每两秒钟，这段代码就会被执行一次:</p>
<pre class="language-javascript hljs">this.webref.injectJavaScript(script());
</pre>
<p>这就是你可以多次执行 JavaScript 的方法！</p>
<p>但是我们还没有完成。也许您注意到了第 63–65 行的<code>WebView</code>组件中的<code>onMessage</code>属性也发生了变化。您可以看到我们正在记录某种信息。</p>
<p>到目前为止，我们只将信息从我们的应用程序发送到网页。但是如果我们想从网页的接收信息<em>呢？这就是<code>onMessage</code>道具的用武之地。</em></p>
<p>我们已经用<code>(event.nativeEvent.data)</code>记录了这种数据。该数据来自第 49 行:</p>
<pre class="language-javascript hljs">window.ReactNativeWebView.postMessage("counter: ${counter}");
</pre>
<p>第 45 行:</p>
<pre class="language-javascript hljs">window.ReactNativeWebView.postMessage("you are now getting redirected!");
</pre>
<p>这是我们演示应用的最终结果:</p>
<p><img data-attachment-id="102118" data-permalink="https://blog.logrocket.com/?attachment_id=102118" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/final-react-native-webview-demo.gif" data-orig-size="730,1578" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="final-react-native-webview-demo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/final-react-native-webview-demo-139x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/final-react-native-webview-demo-474x1024.gif" decoding="async" class="aligncenter size-full wp-image-102118 jetpack-lazy-image" src="../Images/d2f49fe75e0c05d1d99f3f4e62bfa120.png" alt="Our final React Native WebView demo" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/02/final-react-native-webview-demo.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/final-react-native-webview-demo.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="102118" data-permalink="https://blog.logrocket.com/?attachment_id=102118" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/02/final-react-native-webview-demo.gif" data-orig-size="730,1578" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="final-react-native-webview-demo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/02/final-react-native-webview-demo-139x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/02/final-react-native-webview-demo-474x1024.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-102118" src="../Images/d2f49fe75e0c05d1d99f3f4e62bfa120.png" alt="Our final React Native WebView demo" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/02/final-react-native-webview-demo.gif"/></noscript>
<h2>结论</h2>
<p>在这篇文章中，我们回顾了如何将 WebViews 嵌入到 React 本地应用程序中。您可以为 WebView 组件提供 URL，也可以添加一些自定义的内嵌 HTML。此外，我们还讨论了如何将 JavaScript 代码注入到 WebView 组件中。</p>
<p>请随意使用这段代码作为进一步开发的基础。这个项目的<a href="https://github.com/kevintomas1995/rn_webview" target="_blank" rel="noopener">源代码可以在我的 GitHub 个人资料上找到！</a></p><div class="code-block code-block-18">
<div class="blog-plug inline-plug react-native-plug"><h2><a href="https://lp.logrocket.com/blg/react-native-signup"> LogRocket </a>:即时重现 React 原生应用中的问题。</h2><a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/110055665562c1e02069b3698e6cc671.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/110055665562c1e02069b3698e6cc671.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/></noscript></a><p><a href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一款 React 原生监控解决方案，可帮助您即时重现问题、确定 bug 的优先级并了解 React 原生应用的性能。</p><p>LogRocket 还可以向你展示用户是如何与你的应用程序互动的，从而帮助你提高转化率和产品使用率。LogRocket 的产品分析功能揭示了用户不完成特定流程或不采用新功能的原因。</p><p>开始主动监控您的 React 原生应用— <a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer">免费试用 LogRocket】。</a></p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>