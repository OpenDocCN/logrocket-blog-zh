<html>
<head>
<title>Creating a GraphQL server with Ktor - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用 Ktor - LogRocket 博客创建 GraphQL 服务器</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/#0001-01-01">https://blog.logrocket.com/creating-a-graphql-server-with-ktor/#0001-01-01</a></blockquote><div><article class="article-post">
<p>直到最近，REST 还是创建后端 API 的实际设计。在过去的几年里，GraphQL 作为 REST 的替代品越来越受欢迎。</p>
<p>类似地，在移动开发领域，Kotlin 作为 Java 的替代品，已经开始获得 Android 开发者的认可。Kotlin 的流行使其被用于其他技术，如后端和跨平台应用程序开发。</p>
<p>在本文中，我们将看看如何在<code>Ktor</code>中设置<code>GraphQL</code>,并将现有的数据源作为<code>GraphQL</code> API 公开。</p>

<h2>关于 Ktor 和 GraphQL 应该知道什么</h2>
<p>在我们进入细节之前，这里有一个我们将在本文中讨论的解决方案的纲要。</p>
<h3><strong>Ktor 是什么？</strong></h3>
<p>Ktor 是一个异步框架，用于创建 web 应用程序。它允许开发人员轻松地为移动或 web 客户端创建 Kotlin 后端 API。</p>
<h3><strong>什么是 GraphQL？</strong></h3>
<p>GraphQL 是一种查询数据的语言，它通过公开底层数据源中的数据来查询数据。GraphQL 不查询表或数据库；它不知道实际数据驻留在哪里(SQL/NoSQL 数据库、文件、微服务、REST APIs 等)。)</p>
<p>GraphQL 有三个主要操作:</p>
<ul>
<li><code>Query</code>:取数据</li>
<li><code>Mutation</code>:用于写入数据</li>
<li><code>Subscription</code>:用于数据变化时获取更新。(想想 RxJava <code>Observables</code>)</li>
</ul>
<p>(注意:这些只是规范而不是规则——后端服务器可以选择在<code>query</code>操作中改变它的数据。)</p>
<h3><strong>kot Lin 和 GraphQL 的相似之处</strong></h3>
<p>可空性作为一个特性内置在<code>Kotlin</code>和<code>GraphQL</code>中。在 Kotlin 中，可空字段用<code>?</code>表示，在 GraphQL 中，不可空字段显示为<code>!</code>。</p>
<pre class="language-kotlin hljs">// Kotlin

val name: String? // -&gt; nullable
val age: String   // -&gt; non-nullable
</pre>
<pre class="language-graphql hljs">// GraphQL

name: String // -&gt; nullable
age: String! // -&gt; non nullable
</pre>
<h2 id="creating-a-graphql-api">创建 GraphQL API</h2>
<p>我们可以从这里的<a href="https://start.ktor.io/" target="_blank" rel="noopener">创建一个初学者 Ktor 项目，或者使用 IntelliJ 插件(用于 IDEA Ultimate Edition)。</a></p>
<p>我们将使用<code>KGraphQL</code>库将数据公开为 GraphQL API。我将使用现有的<code>MySQL</code>数据库和以前项目中的<code><a href="https://blog.logrocket.com/intro-sqldelight/" target="_blank" rel="noopener">[SQLDelight]</a></code>作为底层数据源。</p>
<p>该数据库包含一个电影列表，在<code>/movies</code>端点中显示为一个<code>GET</code>查询。</p>
<pre class="language-kotlin hljs">val moviesRepository by inject&lt;MovieRepository&gt;()

routing {
    get("/movies") {
        call.respond(moviesRepository.getAllTheMovies(Long.MAX_VALUE))
    }
}
</pre>
<p><img data-attachment-id="97607" data-permalink="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/graphql-example-screenshot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphql-example-screenshot.png" data-orig-size="730,448" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphql-example-screenshot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphql-example-screenshot-300x184.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphql-example-screenshot.png" decoding="async" class="aligncenter wp-image-97607 size-full jetpack-lazy-image" src="../Images/8fcb84fd39a65148d60a546f7473f18a.png" alt="GraphQL Example Screenshot" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/graphql-example-screenshot.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/graphql-example-screenshot-300x184.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphql-example-screenshot.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphql-example-screenshot.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="97607" data-permalink="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/graphql-example-screenshot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphql-example-screenshot.png" data-orig-size="730,448" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphql-example-screenshot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphql-example-screenshot-300x184.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphql-example-screenshot.png" decoding="async" loading="lazy" class="aligncenter wp-image-97607 size-full" src="../Images/8fcb84fd39a65148d60a546f7473f18a.png" alt="GraphQL Example Screenshot" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/graphql-example-screenshot.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/graphql-example-screenshot-300x184.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphql-example-screenshot.png"/></noscript>
<p><code>Movie</code>模型类如下所示:</p>
<pre class="language-javascript hljs">@Serializable
data class Movie(
    val id: Int,
    val name: String?,
    val genre: String?,
    val leadStudio: String?,
    val audienceScore: Int?,
    val profitability: Double?,
    val rottenTomatoes: Int?,
    val worldwideGross: String?,
    val year: Int?
)
</pre>
<h2 id="setting-up-kgraphql">设置 KGraphQL</h2>
<p>向<code>build.gradle</code>或<code>build.gradle.kts</code>文件添加<code>KGraphQL</code>依赖项:</p>
<pre class="language-kotlin hljs">implementation("com.apurebase:kgraphql:0.17.14")
implementation("com.apurebase:kgraphql-ktor:0.17.14")
</pre>
<p>创建一个名为<code>KGraphQL.kt</code>的文件:</p>
<pre class="language-kotlin hljs">import com.apurebase.kgraphql.GraphQL
import io.ktor.application.Application
import io.ktor.application.install

fun Application.configureGraphQL() { 
  install(GraphQL) {
    playground = true
    schema {
     // TODO: next section
    }
  }
}
</pre>
<p>然后，将上述扩展函数添加到 Ktor 的<code>Application.kt</code>文件中:</p>
<pre class="language-kotlin hljs">fun main() {
    embeddedServer(Netty, port = 8080, host = "0.0.0.0") {
        configureKoin()
        configureHTTP()
        configureSerialization()
        configureRouting()
        configureGraphQL() // &lt;- Here
    }.start(wait = true)
}
</pre>
<h2 id="graphiql-playground">图形游乐场</h2>
<p>现在，当我们运行应用程序并到达<code>/graphql</code>端点时，我们会看到一个 graphic QL(读作“graphical”)平台。这允许我们在开发过程中测试我们的<code>GraphQL</code>查询。</p>
<p><img data-attachment-id="97609" data-permalink="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/graphiql-playground-screenshot-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-screenshot-example.png" data-orig-size="730,434" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphiql-playground-screenshot-example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-screenshot-example-300x178.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-screenshot-example.png" decoding="async" class="aligncenter wp-image-97609 size-full jetpack-lazy-image" src="../Images/8d37faa52ab4d07ffe2047f510f6d2ff.png" alt="GraphiQL Playground Screenshot Example" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-screenshot-example.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-screenshot-example-300x178.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-screenshot-example.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-screenshot-example.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="97609" data-permalink="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/graphiql-playground-screenshot-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-screenshot-example.png" data-orig-size="730,434" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphiql-playground-screenshot-example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-screenshot-example-300x178.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-screenshot-example.png" decoding="async" loading="lazy" class="aligncenter wp-image-97609 size-full" src="../Images/8d37faa52ab4d07ffe2047f510f6d2ff.png" alt="GraphiQL Playground Screenshot Example" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-screenshot-example.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-screenshot-example-300x178.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-screenshot-example.png"/></noscript>
<h2 id="query-and-type">查询和类型</h2>
<p>我们可以将我们的<code>Movie</code>数据类注册为<code>GraphQL</code>输出类型，方法是将它添加到<code>KGraphQL.kt</code>文件的<code>schema</code>块中。</p>
<pre class="language-kotlin hljs">schema {
    type&lt;Movie&gt;() {
        description = "Movie object"
    }
}
</pre>
<p>现在，在我们的 GraphiQL playground 中，我们可以在“SCHEMA”选项卡中看到详细信息。</p>
<p><img data-attachment-id="97613" data-permalink="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/graphicql-playground-schema-tab-example-screenshot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-schema-tab-example-screenshot.png" data-orig-size="730,433" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphicql-playground-schema-tab-example-screenshot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-schema-tab-example-screenshot-300x178.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-schema-tab-example-screenshot.png" decoding="async" class="aligncenter wp-image-97613 size-full jetpack-lazy-image" src="../Images/9250e58af07422d220af0efc1b93854c.png" alt="GraphiQL Playground Schema Tab Example Screenshot" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-schema-tab-example-screenshot.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-schema-tab-example-screenshot-300x178.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-schema-tab-example-screenshot.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-schema-tab-example-screenshot.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="97613" data-permalink="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/graphicql-playground-schema-tab-example-screenshot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-schema-tab-example-screenshot.png" data-orig-size="730,433" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphicql-playground-schema-tab-example-screenshot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-schema-tab-example-screenshot-300x178.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-schema-tab-example-screenshot.png" decoding="async" loading="lazy" class="aligncenter wp-image-97613 size-full" src="../Images/9250e58af07422d220af0efc1b93854c.png" alt="GraphiQL Playground Schema Tab Example Screenshot" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-schema-tab-example-screenshot.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-schema-tab-example-screenshot-300x178.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-schema-tab-example-screenshot.png"/></noscript>
<p>为了创建一个返回电影列表的简单查询，我们将在<code>schema</code>块中添加以下代码:</p>
<pre class="language-kotlin hljs">query("movies") {
    description = "Returns a list of movie"
    resolver { -&gt; movieRepository.getAllTheMovies(Long.MAX_VALUE) }
}
</pre>
<p>(注:这里，<code>movieRepository.getAllTheMovies()</code>内部查询 MySql 数据库。您可以将其更改为您喜欢的任何数据源。)</p>
<p>现在，让我们在操场上编写第一个<code>GraphQL</code>查询，并单击“Run ”(显示为“Play”符号)按钮。</p>
<pre class="language-graphql hljs">query {
  movies {
    id
    name
    genre
    year
  }
}
</pre>
<p><img data-attachment-id="97615" data-permalink="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/graphiql-playground-run-query-example-screenshot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-run-query-example-screenshot.png" data-orig-size="730,519" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphiql-playground-run-query-example-screenshot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-run-query-example-screenshot-300x213.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-run-query-example-screenshot.png" decoding="async" class="aligncenter wp-image-97615 size-full jetpack-lazy-image" src="../Images/662f80ecbae9ea88b02c015f1181e8e1.png" alt="GraphiQL Playground Run Query Example Screenshot" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-run-query-example-screenshot.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-run-query-example-screenshot-300x213.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-run-query-example-screenshot.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-run-query-example-screenshot.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="97615" data-permalink="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/graphiql-playground-run-query-example-screenshot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-run-query-example-screenshot.png" data-orig-size="730,519" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphiql-playground-run-query-example-screenshot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-run-query-example-screenshot-300x213.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-run-query-example-screenshot.png" decoding="async" loading="lazy" class="aligncenter wp-image-97615 size-full" src="../Images/662f80ecbae9ea88b02c015f1181e8e1.png" alt="GraphiQL Playground Run Query Example Screenshot" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-run-query-example-screenshot.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-run-query-example-screenshot-300x213.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-run-query-example-screenshot.png"/></noscript>
<h2 id="arguments">争论</h2>
<p>为了给<code>movies</code>查询添加一个参数，我们可以修改我们的解析器。我们将添加参数<code>first</code>来限制返回的电影数量。</p>
<pre class="language-kotlin hljs">resolver { first: Long -&gt; movieRepository.getAllTheMovies(first) }
</pre>
<p>要运行前面的查询，我们需要为<code>first</code>提供一个值:</p>
<pre class="language-graphql hljs">query {
  movies(first: 2) { 
    id
    name
    genre
    year
  }
}
</pre>
<p>这是一个必需的参数，如果没有这个参数，<code>GraphQL</code>将抛出如下错误:</p>
<p><img data-attachment-id="97617" data-permalink="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/graphiql-playground-error-thrown-example-screenshot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-error-thrown-example-screenshot.png" data-orig-size="730,484" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphiql-playground-error-thrown-example-screenshot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-error-thrown-example-screenshot-300x199.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-error-thrown-example-screenshot.png" decoding="async" class="wp-image-97617 size-full aligncenter jetpack-lazy-image" src="../Images/eba800d3eeebea8d1667293d345be6e9.png" alt="GraphiQL Playground Error Thrown Example Screenshot" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-error-thrown-example-screenshot.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-error-thrown-example-screenshot-300x199.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-error-thrown-example-screenshot.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-error-thrown-example-screenshot.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="97617" data-permalink="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/graphiql-playground-error-thrown-example-screenshot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-error-thrown-example-screenshot.png" data-orig-size="730,484" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphiql-playground-error-thrown-example-screenshot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-error-thrown-example-screenshot-300x199.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-error-thrown-example-screenshot.png" decoding="async" loading="lazy" class="wp-image-97617 size-full aligncenter" src="../Images/eba800d3eeebea8d1667293d345be6e9.png" alt="GraphiQL Playground Error Thrown Example Screenshot" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-error-thrown-example-screenshot.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-error-thrown-example-screenshot-300x199.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-error-thrown-example-screenshot.png"/></noscript>
<p>为了使参数可选，我们可以使用<code>withArgs</code>闭包为解析器提供一个默认值，如下所示:</p>
<pre class="language-kotlin hljs">resolver { first: Long -&gt; movieRepository.getAllTheMovies(first) }.withArgs {
    arg&lt;Long&gt; { name = "first"; defaultValue = 10L }
}
</pre>
<p>现在，如果我们运行不带<code>first</code>参数的<code>movies</code>查询，它将使用默认值 10。</p>
<p>类似地，我们可以创建另一个查询来获取与<code>id</code>匹配的单个电影。</p>
<pre class="language-kotlin hljs">query("movie") {
    description = "Returns a movie matched by id or null if id is invalid"
    resolver { id: Int -&gt; movieRepository.getMovieById(id) }
}
</pre>
<h2 id="mutation">变化</h2>
<p>我们可以创建一个类似于查询操作的变异操作:</p>
<pre class="language-kotlin hljs">schema {
 //...
  mutation("addMovie") {
    description = "Adds a new movie and return"
    resolver { movie: Movie -&gt; movieRepository.createMovie(movie) }
  }
}
</pre>
<p>运行上述模式会引发以下错误:</p>
<pre>"error": "Introspection must provide output type for fields, but received: [Movie!]!."
</pre>
<p>要使用自定义类作为解析器参数的类型，我们需要将其注册为<code>inputType</code>。这与我们之前做的<code>type&lt;movie&gt;{..}</code>注册不同。</p>
<pre class="language-kotlin hljs">inputType&lt;Movie&gt; {
    name = "movieInput"
}

mutation("addMovie") {
    description = "Adds a new movie and returns the id"
    resolver { movie: Movie -&gt; movieRepository.createMovie(movie) }
}
</pre>
<p>运行以下查询会向我们的数据库添加一个新行:</p>
<pre class="language-graphql hljs">mutation {
  addMovie(movie: {
    name: "Nobody"
    genre: "Thriller"
    leadStudio: "Universal Pictures"
    year: 2021
    worldwideGross: "$56.7",
    rottenTomatoes: 84,
    profitability: null,
    id: null,
    audienceScore: null
  })
}
</pre>
<p><img data-attachment-id="97619" data-permalink="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/graphiql-custom-class-query-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-custom-class-query-example.png" data-orig-size="730,519" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphiql-custom-class-query-example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-custom-class-query-example-300x213.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-custom-class-query-example.png" decoding="async" class="aligncenter wp-image-97619 size-full jetpack-lazy-image" src="../Images/7a618f020afea169706120f430768785.png" alt="GraphiQL Custom Class Query Example" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-custom-class-query-example.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-custom-class-query-example-300x213.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-custom-class-query-example.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-custom-class-query-example.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="97619" data-permalink="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/graphiql-custom-class-query-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-custom-class-query-example.png" data-orig-size="730,519" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphiql-custom-class-query-example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-custom-class-query-example-300x213.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-custom-class-query-example.png" decoding="async" loading="lazy" class="aligncenter wp-image-97619 size-full" src="../Images/7a618f020afea169706120f430768785.png" alt="GraphiQL Custom Class Query Example" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-custom-class-query-example.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-custom-class-query-example-300x213.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-custom-class-query-example.png"/></noscript>
<p>我们还可以使用 GraphiQL Playground 中的“查询变量”选项卡，并将<code>movie</code>对象作为 JSON 编码的变量传递:</p>
<p><img data-attachment-id="97621" data-permalink="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/graphicql-playground-query-variables-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-query-variables-example.png" data-orig-size="730,519" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphicql-playground-query-variables-example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-query-variables-example-300x213.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-query-variables-example.png" decoding="async" class="aligncenter wp-image-97621 size-full jetpack-lazy-image" src="../Images/be411ccc6d3e68bb1cb77dde239979a9.png" alt="GraphiQL Playground Query Variables Example" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-query-variables-example.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-query-variables-example-300x213.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-query-variables-example.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-query-variables-example.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="97621" data-permalink="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/graphicql-playground-query-variables-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-query-variables-example.png" data-orig-size="730,519" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphicql-playground-query-variables-example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-query-variables-example-300x213.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-query-variables-example.png" decoding="async" loading="lazy" class="aligncenter wp-image-97621 size-full" src="../Images/be411ccc6d3e68bb1cb77dde239979a9.png" alt="GraphiQL Playground Query Variables Example" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-query-variables-example.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-query-variables-example-300x213.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphicql-playground-query-variables-example.png"/></noscript>
<p>类似地，为了更新现有的电影，我们可以创建另一个变体——这一次，我们返回的不是一个<code>id</code>,而是电影对象。</p>
<p><img data-attachment-id="97623" data-permalink="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/graphiql-playground-movie-object-return-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-movie-object-return-example.png" data-orig-size="730,491" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphiql-playground-movie-object-return-example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-movie-object-return-example-300x202.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-movie-object-return-example.png" decoding="async" class="aligncenter wp-image-97623 size-full jetpack-lazy-image" src="../Images/49025d2c248ab111a4bb1f39ca24db4f.png" alt="GraphiQL Playground Move Object Query Return Example" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-movie-object-return-example.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-movie-object-return-example-300x202.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-movie-object-return-example.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-movie-object-return-example.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="97623" data-permalink="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/graphiql-playground-movie-object-return-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-movie-object-return-example.png" data-orig-size="730,491" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphiql-playground-movie-object-return-example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-movie-object-return-example-300x202.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-movie-object-return-example.png" decoding="async" loading="lazy" class="aligncenter wp-image-97623 size-full" src="../Images/49025d2c248ab111a4bb1f39ca24db4f.png" alt="GraphiQL Playground Move Object Query Return Example" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-movie-object-return-example.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-movie-object-return-example-300x202.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/graphiql-playground-movie-object-return-example.png"/></noscript>
<p>(注意:在变异操作中，由我们来决定是返回一个<code>id</code>还是一个完整的<code>movie</code>对象，或者根据需求返回其他任何东西。)</p>
<p>在撰写本文时，<code>KGraphQL</code>不支持<code>Subscription</code>操作。</p>
<h2 id="running-without-playground">无操场跑步</h2>
<p>开发时使用操场；当我们部署后端应用程序时，我们需要关闭它。</p>
<pre class="language-kotlin hljs">fun Application.configureGraphQL() {
    val movieRepository by inject&lt;MovieRepository&gt;()
    install(GraphQL) {
        playground = false
        schema {..}
    }
}
</pre>
<p>重启应用程序后，如果我们试图在浏览器上访问<code>http:0.0.0.0:8080/graphql</code>，我们会得到一个<code>404 Not Found</code>错误。</p>
<p>为了访问我们的 GraphQL API，我们需要发送一个<code>POST</code>请求。</p>
<p><img data-attachment-id="97625" data-permalink="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/postman-post-request-demo-screenshot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/postman-post-request-demo-screenshot.png" data-orig-size="730,718" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="postman-post-request-demo-screenshot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/postman-post-request-demo-screenshot-300x295.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/postman-post-request-demo-screenshot.png" decoding="async" class="aligncenter wp-image-97625 size-full jetpack-lazy-image" src="../Images/9a3bcaae33500645e82ff2f9e884b391.png" alt="Postman Post Request Demo Screenshot" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/postman-post-request-demo-screenshot.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/postman-post-request-demo-screenshot-300x295.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/postman-post-request-demo-screenshot.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/postman-post-request-demo-screenshot.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="97625" data-permalink="https://blog.logrocket.com/creating-a-graphql-server-with-ktor/postman-post-request-demo-screenshot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/postman-post-request-demo-screenshot.png" data-orig-size="730,718" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="postman-post-request-demo-screenshot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/postman-post-request-demo-screenshot-300x295.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/postman-post-request-demo-screenshot.png" decoding="async" loading="lazy" class="aligncenter wp-image-97625 size-full" src="../Images/9a3bcaae33500645e82ff2f9e884b391.png" alt="Postman Post Request Demo Screenshot" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/postman-post-request-demo-screenshot.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/postman-post-request-demo-screenshot-300x295.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/postman-post-request-demo-screenshot.png"/></noscript>
<p>我使用<code>Postman</code>应用程序来测试端点。在<code>Body</code>中，我们可以传递查询，如前所述，(因为 Postman 支持<code>GraphQL</code>)或者像下面这样的 JSON 格式的请求。</p>
<pre class="language-json hljs">{
    "query": "query {\n movies {\n id\n name\n genre\n  }\n}",
    "variables": {}
}
</pre>
<p>我们还可以在<code>install</code>块中将默认的<code>/graphql</code>端点改为自定义的，比如<code>/movies-graphql</code>，然后重启我们的应用程序。</p>
<pre class="language-kotlin hljs">install(GraphQL) {
  playground = false
  endpoint = "/movies-graphql"
  schema {..}
}
</pre>
<p>现在我们的 GraphQL API 将在这个端点:<code>https:0.0.0.0/movies-graphql</code>提供服务。</p>
<p>这个项目的完整源代码可以在<a href="https://github.com/jobinlawrance/ktor-graphql" target="_blank" rel="noopener">这里</a>找到。</p>
<h2 id="conclusion">结论</h2>
<p>本文向您展示了如何在 Ktor 中创建 GraphQL 服务器，以及如何将底层数据源公开为 GraphQL API 端点。</p>
<p>我们还研究了如何在开发过程中设置 GraphQL Playground 来测试和调试查询和变化，以及如何在产品的最终展示中禁用 Playground。</p><div class="code-block code-block-24">
<div class="blog-plug inline-plug graphql-plug"><h2>监控生产中失败和缓慢的 GraphQL 请求</h2><p>虽然 GraphQL 有一些调试请求和响应的特性，但确保 GraphQL 可靠地为您的生产应用程序提供资源是一件比较困难的事情。如果您对确保对后端或第三方服务的网络请求成功感兴趣，</p><a href="https://lp.logrocket.com/blg/graphql-signup" target="_blank">try LogRocket</a><p>.</p><a class="signup" href="https://lp.logrocket.com/blg/graphql-signup" target="_blank" rel="noopener noreferrer"><img src="../Images/432a3823c85b3fb72a206e6236a29f48.png" data-lazy-src="https://files.readme.io/69aa835-Image_2019-11-09_at_1.28.05_PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://files.readme.io/69aa835-Image_2019-11-09_at_1.28.05_PM.png"/><noscript><img data-lazy-fallback="1" src="../Images/432a3823c85b3fb72a206e6236a29f48.png" data-original-src="https://files.readme.io/69aa835-Image_2019-11-09_at_1.28.05_PM.png"/></noscript><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><a href="https://lp.logrocket.com/blg/graphql-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用的 DVR，记录下你网站上发生的每一件事。您可以汇总并报告有问题的 GraphQL 请求，以快速了解根本原因，而不是猜测问题发生的原因。此外，您可以跟踪 Apollo 客户机状态并检查 GraphQL 查询的键值对。</p><div class="code-block code-block-32">
<div class="blog-plug inline-plug kotlin-plug"><h2>LogRocket :即时重现你的安卓应用中的问题。</h2><a class="signup" href="https://lp.logrocket.com/blg/kotlin-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/b5ae4bd0ecde7aa9d5288746416d5e18.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/react-native-plug_android-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/react-native-plug_android-1.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/b5ae4bd0ecde7aa9d5288746416d5e18.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/react-native-plug_android-1.png"/></noscript></a><p><a href="https://lp.logrocket.com/blg/kotlin-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一款 Android 监控解决方案，可以帮助您即时重现问题，确定 bug 的优先级，并了解您的 Android 应用程序的性能。</p><p>LogRocket 还可以向你展示用户是如何与你的应用程序互动的，从而帮助你提高转化率和产品使用率。LogRocket 的产品分析功能揭示了用户不完成特定流程或不采用新功能的原因。</p><p>开始主动监控您的 Android 应用程序— <a class="signup" href="hhttps://lp.logrocket.com/blg/kotlin-signup" target="_blank" rel="noopener noreferrer">免费试用 LogRocket】。</a></p></div>
</div><p>LogRocket 检测您的应用程序以记录基线性能计时，如页面加载时间、到达第一个字节的时间、慢速网络请求，还记录 Redux、NgRx 和 Vuex 操作/状态。</p><a class="signup" href="https://lp.logrocket.com/blg/graphql-signup" target="_blank" rel="noopener noreferrer">Start monitoring for free</a><p>.</p></div>


</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>