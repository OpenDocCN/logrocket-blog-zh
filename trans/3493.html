<html>
<head>
<title>Editing GIFs in your Node.js project with canvas-gif </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用canvas-gif编辑Node.js项目中的gif</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/editing-gifs-node-js-project-canvas-gif/#0001-01-01">https://blog.logrocket.com/editing-gifs-node-js-project-canvas-gif/#0001-01-01</a></blockquote><div><article class="article-post">
<p>Canvas-gif是在Node.js项目中访问和编辑gif框架的优秀工具，包括添加文本、进一步动画和编辑框架。Canvas-gif利用了Canvas的所有超能力，允许你操作图像的每一部分，而不仅仅是给每个gif框架添加文本。</p>
<p>在本文中，我们将为您的下一个Node.js项目编写一个使用canvas-gif读取和编辑GIF的示例代码。在开始编辑gif之前，请确保您已经熟悉了使用node-canvas 创建和保存图像的<a href="https://blog.logrocket.com/creating-saving-images-node-canvas/" target="_blank" rel="noopener">。</a></p>
<p><em>向前跳转:</em></p>

<h2 id="getting-started-canvas-gif">开始使用canvas-gif</h2>
<p><a href="https://www.npmjs.com/package/canvas-gif" target="_blank" rel="noopener"> canvas-gif </a>库允许你将输入的gif作为<a href="https://blog.logrocket.com/node-js-buffer-complete-guide/" target="_blank" rel="noopener">缓冲区</a>来读取，并可以选择合并GIF。然而，如果你打算合并GIF，你需要安装<a href="https://imagemagick.org/script/download.php" target="_blank" rel="noopener"> ImageMagick </a>。</p>
<p>首先，canvas-gif将gif解码成一个<code>UInt8Array(s)</code>并为GIF返回的每一帧创建一个canvas实例。然后，它将<code>UInt8Array</code>转换成画布<a href="https://developer.mozilla.org/en-US/docs/Web/API/ImageData" target="_blank" rel="noopener"> <code>ImageData</code> </a>，并将其放入<a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D" target="_blank" rel="noopener"> <code>CanvasRenderingContext</code> </a>。从那里，库将上下文和其他相关信息传递给函数来编辑框架。</p>
<p>然后，该库将处理上下文，并将新编辑的帧的上下文添加到编码器中。最后，canvas-gif将返回编码器的数据作为缓冲区，我们将把它写入一个gif文件。</p>
<p>现在我们已经介绍了背景知识，让我们开始着手建立一个项目，探索一个实际的例子。</p>
<h2 id="project-setup">项目设置</h2>
<p>你需要安装<a href="https://nodejs.org/en/download/" target="_blank" rel="noopener"> Node.js </a>和<a href="http://npmjs.com/package/npm" target="_blank" rel="noopener"> npm </a>来处理canvas-gif。</p>
<p>为项目创建一个目录，初始化Node.js项目，并使用下面的命令安装<code>canvas-gif</code> npm库:</p>
<pre class="language-bash hljs">mkdir edit-gif &amp;&amp; cd edit-gif &amp;&amp; npm init -y &amp;&amp; npm install canvas-gif
</pre>
<p>下面是运行代码时会发生什么的示例:</p>
<p><img data-attachment-id="137739" data-permalink="https://blog.logrocket.com/editing-gifs-node-js-project-canvas-gif/attachment/editing-gifs-node-js-example-code/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/editing-gifs-node-js-example-code.png" data-orig-size="730,517" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Code for editing GIFs in Node.js projects using canvas-gif" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/editing-gifs-node-js-example-code-300x212.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/editing-gifs-node-js-example-code.png" decoding="async" class="aligncenter size-full wp-image-137739 jetpack-lazy-image" src="../Images/be8c92369660939993fd363f1ab09aed.png" alt="Code for Editing GIFs in Node.js Projects Using canvas-gif" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/editing-gifs-node-js-example-code.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/editing-gifs-node-js-example-code-300x212.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/editing-gifs-node-js-example-code.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/editing-gifs-node-js-example-code.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137739" data-permalink="https://blog.logrocket.com/editing-gifs-node-js-project-canvas-gif/attachment/editing-gifs-node-js-example-code/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/editing-gifs-node-js-example-code.png" data-orig-size="730,517" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Code for editing GIFs in Node.js projects using canvas-gif" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/editing-gifs-node-js-example-code-300x212.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/editing-gifs-node-js-example-code.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137739" src="../Images/be8c92369660939993fd363f1ab09aed.png" alt="Code for Editing GIFs in Node.js Projects Using canvas-gif" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/editing-gifs-node-js-example-code.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/editing-gifs-node-js-example-code-300x212.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/editing-gifs-node-js-example-code.png"/></noscript>
<p>设置和安装完成后，下载一个GIF文件并放在根目录下。对于本文，我们将使用这张<a href="https://c.tenor.com/1HnbW0C8O_0AAAAC/mr-rogers-nightmare.gif" target="_blank" rel="noopener"> GIF </a>:</p>
<p><img data-attachment-id="137847" data-permalink="https://blog.logrocket.com/editing-gifs-node-js-project-canvas-gif/attachment/gif-node-js-project-start-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/gif-node-js-project-start-1.gif" data-orig-size="720,540" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="GIF to start editing using canvas-gif for a Node.js project" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/gif-node-js-project-start-1-300x225.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/gif-node-js-project-start-1.gif" decoding="async" class="aligncenter wp-image-137847 size-full jetpack-lazy-image" src="../Images/4be995e6911c75bfce6ac5a58e283c78.png" alt="GIF to Start Editing Using Canvas-gif for a Node.js Project" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/gif-node-js-project-start-1.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/gif-node-js-project-start-1.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137847" data-permalink="https://blog.logrocket.com/editing-gifs-node-js-project-canvas-gif/attachment/gif-node-js-project-start-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/gif-node-js-project-start-1.gif" data-orig-size="720,540" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="GIF to start editing using canvas-gif for a Node.js project" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/gif-node-js-project-start-1-300x225.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/gif-node-js-project-start-1.gif" decoding="async" loading="lazy" class="aligncenter wp-image-137847 size-full" src="../Images/4be995e6911c75bfce6ac5a58e283c78.png" alt="GIF to Start Editing Using Canvas-gif for a Node.js Project" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/gif-node-js-project-start-1.gif"/></noscript>
<p>接下来，创建一个<code>app.js</code>文件，并向其中添加以下内容:</p>
<pre class="language-javascript hljs">const canvasGif = require("canvas-gif");
const fs = require("fs");

canvasGif(path.join(__dirname, "mr-rogers-nightmare.gif"), callBack, options)
  .then((buffer) =&gt;
    fs.writeFileSync(path.resolve(__dirname, "output1.gif"), buffer)
  )
  .catch((error) =&gt; {
    console.log(error);
  });
</pre>
<p>这里，<code>canvasGif</code>公开了<code>callBack</code>函数来接受GIF文件路径，并需要第三个可选的配置参数。不用担心；我们将很快研究如何处理这个问题。</p>
<h2 id="using-callback-function-canvas-gif">使用canvas-gif的<code>callBack</code>函数</h2>
<p>作为画布API的一部分，允许您修改框架的上下文。在这里，您可以渲染2D绘图，绘制形状，创建图像，文本，等等。我们将利用这个API来修改GIF。</p>
<p>在下面输入函数定义:</p>
<pre class="language-javascript hljs">const callBack = (context, width, height, totalFrames, currentFrame) =&gt; {
};
</pre>
<p>如您所见，<code>callBack</code>接受一个<code>context</code>作为第一个参数，后面是<code>width</code>、<code>height</code>、<code>totalFrames</code>和<code>currentFrame</code>，如上面的代码所示。</p>
<h2 id="editing-gifs-canvas-gif">编辑和添加文本到我们的Node.js GIF</h2>
<p>为了给每个框架添加文本，我们将通过输入以下代码来修改上下文:</p>
<pre class="language-javascript hljs">const callBack = (context, width, height, totalFrames, currentFrame) =&gt; {
// Edit the frame
  context.fillStyle = "#FFA500";
  context.font = '30px "Fira Code Retina"';
  context.fillText("Edited by Eze!", 40, 80);
}; 
</pre>
<p>当您将<code>callBack</code>传递给<code>canvasGif</code>时，它将操作GIF帧并添加<code>text</code>、<code>font</code>、<code>color</code>和字体系列。</p>
<p>现在，我们当前的代码将如下所示:</p>
<pre class="language-javascript hljs">const canvasGif = require("canvas-gif");
const fs = require("fs");

const callBack = (context, width, height, totalFrames, currentFrame) =&gt; {
// Edit the frame
  context.fillStyle = "#FFA500";
  context.font = '30px "Fira Code Retina"';
  context.fillText("Edited by Eze!", 40, 80);
}; 
const options = {}

canvasGif(path.join(__dirname, "mr-rogers-nightmare.gif"), callBack, options)
  .then((buffer) =&gt;
    fs.writeFileSync(path.resolve(__dirname, "output1.gif"), buffer)
  )
  .catch((error) =&gt; {
    console.log(error);
  });
</pre>
<p>然后，当我们运行它时，我们将得到这样的输出:</p>
<p><img data-attachment-id="137845" data-permalink="https://blog.logrocket.com/editing-gifs-node-js-project-canvas-gif/attachment/canvas-gif-edited-node-js-project/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/canvas-gif-edited-node-js-project.gif" data-orig-size="720,540" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Canvas-gif edited GIF in the Node.js project" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/canvas-gif-edited-node-js-project-300x225.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/canvas-gif-edited-node-js-project.gif" decoding="async" class="aligncenter size-full wp-image-137845 jetpack-lazy-image" src="../Images/4220c659ef234b525aa9b6e64ad77bc8.png" alt="Canvas-gif Edited GIF in the Node.js Project" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/canvas-gif-edited-node-js-project.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/canvas-gif-edited-node-js-project.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137845" data-permalink="https://blog.logrocket.com/editing-gifs-node-js-project-canvas-gif/attachment/canvas-gif-edited-node-js-project/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/canvas-gif-edited-node-js-project.gif" data-orig-size="720,540" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Canvas-gif edited GIF in the Node.js project" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/canvas-gif-edited-node-js-project-300x225.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/canvas-gif-edited-node-js-project.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137845" src="../Images/4220c659ef234b525aa9b6e64ad77bc8.png" alt="Canvas-gif Edited GIF in the Node.js Project" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/canvas-gif-edited-node-js-project.gif"/></noscript>
<h3 id="using-configurations-canvas-gif">使用canvas-gif中的配置</h3>
<p>文字在GIF里，但是GIF渲染太快了吧？这是因为，默认情况下，canvas-gif每秒渲染60帧(fps)。为了降低速度，让我们在选项参数中编辑fps，并通过添加一个值为<code>20</code>的键<code>fps</code>将其降低到20fps:</p>
<pre class="language-javascript hljs">let options = {
  fps: 20
};
</pre>
<p>当我们重新运行脚本时，会得到以下结果:</p>
<p><img data-attachment-id="137810" data-permalink="https://blog.logrocket.com/editing-gifs-node-js-project-canvas-gif/attachment/rerun-edited-gif-canvas-gif-node-js/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/rerun-edited-gif-canvas-gif-node-js.gif" data-orig-size="720,540" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Rerun of the edited GIF using canvas-gif in a Node.js project" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/rerun-edited-gif-canvas-gif-node-js-300x225.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/rerun-edited-gif-canvas-gif-node-js.gif" decoding="async" class="aligncenter size-full wp-image-137810 jetpack-lazy-image" src="../Images/31f2a74af10a4c990ab2960ae84a0e3b.png" alt="Rerun of the Edited GIF Using Canvas-gif in a Node.js Project" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/rerun-edited-gif-canvas-gif-node-js.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/rerun-edited-gif-canvas-gif-node-js.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137810" data-permalink="https://blog.logrocket.com/editing-gifs-node-js-project-canvas-gif/attachment/rerun-edited-gif-canvas-gif-node-js/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/rerun-edited-gif-canvas-gif-node-js.gif" data-orig-size="720,540" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Rerun of the edited GIF using canvas-gif in a Node.js project" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/rerun-edited-gif-canvas-gif-node-js-300x225.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/rerun-edited-gif-canvas-gif-node-js.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137810" src="../Images/31f2a74af10a4c990ab2960ae84a0e3b.png" alt="Rerun of the Edited GIF Using Canvas-gif in a Node.js Project" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/rerun-edited-gif-canvas-gif-node-js.gif"/></noscript>
<p>这要慢得多，并且类似于原始的GIF🙂。现在，您可以添加更多的配置，如循环GIF或设置停止点。</p>
<p>以下是配置模板示例:</p>
<pre class="language-javascript hljs">let options = {
   coalesce: false,
   delay: 0, 
   repeat: 0, 
   algorithm: "neuquant",
   optimiser: true,
   fps: 20, 
   quality: 100, 
};
</pre>
<p>让我们来看看每种配置:</p>
<ul>
<li><code>delay</code>:以毫秒为单位设置每帧之间的延迟，默认为<code>0</code></li>
<li><code>repeat</code>:描述GIF应该重复多少次，默认为<code>0</code>，无限运行GIF</li>
<li><code>algorithm</code>:定义编码器应该使用哪种算法作为<code>neuquant</code>，但可以设置为<code>octree</code>。虽然<code>octree</code>可能会增加处理时间，但它可以减小文件大小</li>
<li><code>optimiser</code>:告诉编码器是否使用内置优化器，默认为<code>false</code></li>
<li><code>fps</code>:描述每秒渲染的帧数，默认值为60fps</li>
<li><code>quality</code>:设置GIF的质量，从1到100。数字越高，质量越好。默认情况下，它设置为<code>100</code></li>
<li><code>coalesce</code>:这允许你合并GIF，默认为<code>false</code></li>
</ul>
<h3 id="adding-context-drawing">添加上下文绘图</h3>
<p>到目前为止，我们已经编辑了我们的GIF，并为每一帧添加了文本。但是，您可以做更多的事情，包括绘制形状、操作像素和合成。</p>
<p>例如，这是另一个呈现笑脸的上下文绘图:</p>
<pre class="language-javascript hljs">const canvasGif = require("canvas-gif");
const fs = require("fs");

const callBack = (context, width, height, totalFrames, currentFrame) =&gt; {
// Edit the frame
  context.fillStyle = '#FFA500';
  context.strokeStyle = 'black';
  context.lineWidth = 5;
  context.beginPath();
  context.arc(80, 60, 50, 0, 2 * Math.PI);
  context.fill();
  context.stroke();
  context.closePath();
  //eyes
  context.fillStyle = 'white';
  context.beginPath();
  context.arc(67, 43.75, 7.5, 0, 2 * Math.PI);
  context.fill();
  context.stroke();
  context.closePath();
  context.beginPath();
  context.arc(92.5, 43.75, 7.5, 0, 2 * Math.PI);
  context.fill();
  context.stroke();
  context.closePath();
  //mouth
  context.strokeStyle = 'magenta';
  context.lineWidth = 5;
  context.beginPath();
  context.arc(80, 60, 37.5, 0, -1 * Math.PI);
  context.stroke();
  context.closePath();

}; 

let options = {
   coalesce: false,
   delay: 0, 
   repeat: 0, 
   algorithm: "neuquant",
   optimiser: true,
   fps: 20, 
   quality: 100, 
};

canvasGif(path.join(__dirname, "mr-rogers-nightmare.gif"), callBack, options)
  .then((buffer) =&gt;
    fs.writeFileSync(path.resolve(__dirname, "output1.gif"), buffer)
  )
  .catch((error) =&gt; {
    console.log(error);
  });
</pre>
<p>这是最终产品:</p>
<p><img data-attachment-id="137801" data-permalink="https://blog.logrocket.com/editing-gifs-node-js-project-canvas-gif/attachment/edited-canvas-gif-context-image/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/edited-canvas-gif-context-image.gif" data-orig-size="700,525" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Example of context image edited canvas-gif in Node.js" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/edited-canvas-gif-context-image-300x225.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/edited-canvas-gif-context-image.gif" decoding="async" class="aligncenter size-full wp-image-137801 jetpack-lazy-image" src="../Images/0254741f06a2acd494eae234edbd2952.png" alt="Example of Context Image Edited Canvas-gif in Node.js" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/edited-canvas-gif-context-image.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/edited-canvas-gif-context-image.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137801" data-permalink="https://blog.logrocket.com/editing-gifs-node-js-project-canvas-gif/attachment/edited-canvas-gif-context-image/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/edited-canvas-gif-context-image.gif" data-orig-size="700,525" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Example of context image edited canvas-gif in Node.js" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/edited-canvas-gif-context-image-300x225.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/edited-canvas-gif-context-image.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137801" src="../Images/0254741f06a2acd494eae234edbd2952.png" alt="Example of Context Image Edited Canvas-gif in Node.js" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/edited-canvas-gif-context-image.gif"/></noscript>
<h2 id="alternatives-canvas-gif">画布的替代品-gif</h2>
<p>虽然有canvas-gif的替代方案，比如<a href="https://www.npmjs.com/package/jimp" target="_blank" rel="noopener"> jimp </a>、<a href="https://www.npmjs.com/package/gifwrap" target="_blank" rel="noopener"> gifwrap </a>和<a href="https://www.npmjs.com/package/text-on-gif" target="_blank" rel="noopener"> text-on-gif </a>，但是它们并没有直接解决canvas-gif的问题。</p>
<ul>
<li>Jimp是一个JavaScript库，允许您在代码中操作图像。使用jimp，您可以调整大小、增加亮度、翻转、裁剪，甚至增加图像的不透明度</li>
<li>Gifwrap是一个Node.js jimp可压缩库，用于处理gif。使用gifwrap，您可以创建gif并将其读入内部表示，以备操作</li>
<li>Text-on-gif是另一个允许你编辑gif的库，但是它的重点是操纵gif来添加文本</li>
</ul>
<h3 id="gifwrap-jimp">使用gifwrap和跳转</h3>
<p>为了实现类似于canvas-gif的功能，我们必须结合jimp和gifwrap的功能。下面是一个示例，说明如何使用这两个工具通过在GIF上放置文本来修改GIF:</p>
<pre class="language-javascript hljs">const { GifUtil, GifFrame, BitmapImage } = require("gifwrap");
const Jimp = require("jimp");
async function editGif() {
  var frames = [];
  let font = await Jimp.loadFont(Jimp.FONT_SANS_32_WHITE);
  let readGif = await GifUtil.read("mr-rogers-nightmare.gif");

  for (const frame of readGif.frames) {
    let jimpCopied = GifUtil.copyAsJimp(Jimp, frame);

    jimpCopied.print(font, 10, 0, "LogRocket");

    const modifiedFrame = new GifFrame(
      new BitmapImage(jimpCopied.bitmap, {
        disposalMethod: frame.disposalMethod,
        delayCentisecs: frame.delayCentisecs,
      })
    );

    frames.push(modifiedFrame);
  }

  GifUtil.quantizeDekker(frames);
  GifUtil.write("modified.gif", frames);
}
editGif()
</pre>
<p>在<code>let readGif = await GifUtil.read("mr-rogers-nightmare.gif");</code>中，我们用gifwrap将GIF读入内存，然后通过帧循环使用jimp来创建<code>jimpCopied.print(font, 10, 0, "LogRocket");</code>。在此基础上，我们根据特定框架中的文本和图像制作了一个新框架。</p>
<p>最后，我们将所有新的帧放入frames数组来创建一个新的编辑过的GIF。</p>
<p>这是您运行代码时将得到的结果:</p>
<p><img data-attachment-id="137813" data-permalink="https://blog.logrocket.com/editing-gifs-node-js-project-canvas-gif/attachment/gifwrap-jimp-gif-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/gifwrap-jimp-gif-example.gif" data-orig-size="720,540" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Example of a GIF created using gifwrap and jimp" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/gifwrap-jimp-gif-example-300x225.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/gifwrap-jimp-gif-example.gif" decoding="async" class="aligncenter size-full wp-image-137813 jetpack-lazy-image" src="../Images/43da8f0364ae2e7c0f427a0d2aaa980b.png" alt="Example of a GIF Created Using gifwrap and jimp" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/gifwrap-jimp-gif-example.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/gifwrap-jimp-gif-example.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137813" data-permalink="https://blog.logrocket.com/editing-gifs-node-js-project-canvas-gif/attachment/gifwrap-jimp-gif-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/gifwrap-jimp-gif-example.gif" data-orig-size="720,540" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Example of a GIF created using gifwrap and jimp" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/gifwrap-jimp-gif-example-300x225.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/gifwrap-jimp-gif-example.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137813" src="../Images/43da8f0364ae2e7c0f427a0d2aaa980b.png" alt="Example of a GIF Created Using gifwrap and jimp" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/gifwrap-jimp-gif-example.gif"/></noscript>
<p>虽然这个过程是可行的，但是它有性能问题，而且速度太慢。Canvas-gif修改一个gif大概需要三秒，但是用gifwrap和jimp操作同一个GIF需要21秒。</p>
<p>这种区别是因为gifwrap是基于现有的GIF生成一个新的GIF，而canvas-gif是直接修改框架。正因为如此，<code>Canvas-gif</code>实现比<code>Gifwrap</code>和<code>Jimp</code>实现的执行效率更高。</p>
<h3 id="text-on-gif">Node.js中使用text-on-gif</h3>
<p>尽管text-on-gif很简单，但它主要是处理gif，只添加文本。与利用canvas特性的canvas-gif不同，text-on-gif不能处理图像的每一部分，只能向每个gif框架添加文本。</p>
<p>这里有一个来自<a href="https://github.com/sanidhya711/text-on-gif" target="_blank" rel="noopener">文档</a>的例子:</p>
<pre class="language-javascript hljs">const TextOnGif = require("text-on-gif");
const generate = async ()=&gt;{

  var gif = new TextOnGif({
    file_path: "mr-rogers-nightmare.gif"
  });

  gif.font_color = "orange";
  gif.font_size = "30px";

  var buffer = await gif.textOnGif({
    text: "Made with Love ",
    write_path: "mrroger.gif"
  });
}
generate()
</pre>
<p>上面的代码将生成这个GIF:</p>
<p><img data-attachment-id="137815" data-permalink="https://blog.logrocket.com/editing-gifs-node-js-project-canvas-gif/attachment/text-on-gif-edited-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/text-on-gif-edited-example.gif" data-orig-size="720,540" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="GIF edited using text-on-gif" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/text-on-gif-edited-example-300x225.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/text-on-gif-edited-example.gif" decoding="async" class="aligncenter size-full wp-image-137815 jetpack-lazy-image" src="../Images/d2b12ccf72297bda69e6155d308060ab.png" alt="GIF Edited Using Text-on-gif" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/text-on-gif-edited-example.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/text-on-gif-edited-example.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137815" data-permalink="https://blog.logrocket.com/editing-gifs-node-js-project-canvas-gif/attachment/text-on-gif-edited-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/text-on-gif-edited-example.gif" data-orig-size="720,540" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="GIF edited using text-on-gif" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/text-on-gif-edited-example-300x225.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/text-on-gif-edited-example.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137815" src="../Images/d2b12ccf72297bda69e6155d308060ab.png" alt="GIF Edited Using Text-on-gif" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/text-on-gif-edited-example.gif"/></noscript>
<h2>结论</h2>
<p>在本文中，我们学习了如何使用canvas-gif编辑gif动画并添加形状、文本或图像。因为你可以用canvas-gif做的大部分事情取决于canvas API，我鼓励你在<a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API" target="_blank" rel="noopener"> MN </a>和<a href="https://www.npmjs.com/package/canvas" target="_blank" rel="noopener"> Node-canvas </a>文档中学习更多关于Canvas API的知识。</p>
<p>黑客快乐！</p><div class="code-block code-block-23">
<div class="blog-plug inline-plug node-plug"><h2>200只<img src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> <noscript> <img data-lazy-fallback="1" src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> </noscript>显示器出现故障，生产中网络请求缓慢</h2><p>部署基于节点的web应用程序或网站是容易的部分。确保您的节点实例继续为您的应用程序提供资源是事情变得更加困难的地方。如果您对确保对后端或第三方服务的请求成功感兴趣，</p><a href="https://lp.logrocket.com/blg/node-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer"><img src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/><noscript><img data-lazy-fallback="1" src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/></noscript></a><a href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用程序的DVR，记录下用户与你的应用程序交互时发生的一切。您可以汇总并报告有问题的网络请求，以快速了解根本原因，而不是猜测问题发生的原因。</p><p>LogRocket检测您的应用程序以记录基线性能计时，如页面加载时间、到达第一个字节的时间、慢速网络请求，还记录Redux、NgRx和Vuex操作/状态。</p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">Start monitoring for free</a><p>. </p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>