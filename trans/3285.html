<html>
<head>
<title>Use Magic with the Ethereum blockchain - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在以太坊区块链博客上使用魔法</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/magic-ethereum-blockchain/#0001-01-01">https://blog.logrocket.com/magic-ethereum-blockchain/#0001-01-01</a></blockquote><div><article class="article-post">
<p>在构建web应用程序时，身份验证可能是一个令人头疼的问题。开发人员需要决定他们想要实现什么样的安全模式，并以正确的方式来实现。</p>
<p>Magic ，前身为<a href="https://fortmatic.com/" target="_blank" rel="noopener"> Fortmatic </a>，以其快速、无缝、单向的网络认证集成而闻名，现在由于其<a href="https://magic.link/docs/auth/overview" target="_blank" rel="noopener"> Magic Auth产品</a>而成为区块链生态系统的主要参与者。</p>
<p>在本教程中，我们将演示如何在以太坊上使用魔法，讨论如何设置智能合约，并学习如何在以太坊区块链上使用魔法来认证用户。</p>
<p>您可以找到一个到公共repo 的<a href="https://github.com/chyke007/magic-ethereum" target="_blank" rel="noopener">链接，其中包含我们在本文中创建的项目。我们将讨论以下内容:</a></p>

<p>我们开始吧！</p>
<h2 id="blockchain">什么是区块链？</h2>
<p>区块链是一个在过去五年中搅动了互联网的时髦词，但简单地说，它是一个在计算机网络的节点之间共享的分布式数据库，以数字格式电子存储信息。区块链已经被广泛采用，因为它保证了数据记录的真实性和安全性。</p>
<p>区块链因其在加密货币系统中的关键作用而闻名，在加密货币系统中，他们维护着安全和分散的交易记录。</p>
<p>以太坊是一个流行的、去中心化的开源区块链，具有智能合约功能。在本文中，我们将使用以太坊作为我们交互的区块链。</p>
<h2 id="magic-auth">什么是魔法和魔法认证？</h2>
<p>Magic最初名为<a href="https://fortmatic.com/"> Fortmatic </a>，因提供无缝方式将身份验证集成到web应用程序中而广为人知。Magic是一个支持无密码身份验证的SDK，只需几行代码就可以集成到您的应用程序中。</p>
<p><a href="https://magic.link/auth" target="_blank" rel="noopener"> Magic Auth </a>，我们将在本文中使用，是一个SDK，当它集成到您的应用程序中时，可以使用magic links实现无密码的Web2和Web3登录和身份验证。在撰写本文时，Magic Auth支持超过20个区块链，只需几行代码就可以实现。</p>
<h2 id="web3-js">web3.js是什么？</h2>
<p>web3.js是一个库的集合，允许你使用HTTP、IPC或WebSocket与本地或远程以太坊节点进行交互。总之，Web3.js是一个库，它使我们能够使用JavaScript与以太坊区块链进行交互。</p>
<h2 id="magic-web3-js">设置Magic和Web3.js</h2>
<p>要开始在以太坊区块链使用魔法，我们需要添加一些配置和设置。</p>
<p>首先，创建一个新目录来存放我们的项目:</p>
<pre> mkdir magic-blockchain &amp;&amp; cd magic-blockchain
</pre>
<p>接下来，初始化Node.js项目:</p>
<pre>npm init -y
</pre>
<p>现在，我们将安装web3.js库和Magic SDK:</p>
<pre>npm install --save web3 <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b7dad6d0ded49ac4d3dcf78699879986">[email protected]</a> 
</pre>
<h2 id="writingsmartcontract">撰写我们的智能合同</h2>
<p>我们需要创建一个智能合同，我们可以稍后部署到以太坊区块链。智能合约是存储在区块链上的程序，在满足预定条件时运行。</p>
<p>我们将创建一个基本的“你好，世界！”聪明的合同。用以下代码创建一个名为<code>helloworld.sol</code>的新文件:</p>
<pre class="language-solidity hljs">// SPDX-License-Identifier: MIT

pragma solidity ^0.8.9;

contract helloworld {

  string public message = "Hello World";

  function update(string memory newMessage) public {
    message = newMessage;
  }

}
</pre>
<h2 id="compilethesmartcontract">编译智能合同</h2>
<p>如前所述，我们需要将我们的智能合约部署到以太坊区块链。为此，我们需要将它编译成一种可以在区块链中执行的形式。</p>
<p>我们将使用下面的代码，通过获取我们需要的Abi和字节码来帮助我们编译智能合约:</p>
<pre>npm i <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1f6c70737c5f2f31273126">[email protected]</a>
</pre>
<p>创建一个名为<code>compile.js</code>的文件，并将下面的代码添加到其中:</p>
<pre class="language-javascript hljs">const path  = require('path');
const fs = require('fs');
const  solc = require('solc')
const helloWorldPath = path.resolve(__dirname, '' , 'helloworld.sol');
const file = fs.readFileSync(helloWorldPath).toString();
// Input structure for solidity compiler
var input = {
    language: "Solidity",
    sources: {
      "helloworld.sol": {
        content: file,
      },
    },

    settings: {
      outputSelection: {
        "*": {
          "*": ["*"],
        },
      },
    },
  };
  const output = JSON.parse(solc.compile(JSON.stringify(input)));
  if(output.errors) {
      output.errors.forEach(err =&gt; {
          console.log(err.formattedMessage);
      });
  } else {
      const bytecode = output.contracts['helloworld.sol'].helloworld.evm.bytecode.object;
      const abi = output.contracts['helloworld.sol'].helloworld.abi;
      console.log(`bytecode: ${bytecode}`);
      console.log(`abi: ${JSON.stringify(abi, null, 2)}`);
  }
</pre>
<p>接下来，我们编译契约以获得我们需要的<code>abi</code>和<code>bytecode</code>。运行<code>node compile.js</code>并复制输出<code>bytecode</code>和<code>abi</code>到安全的地方存储它们。</p>
<p>对于契约部署，我将使用我已经部署的契约的地址。</p>
<h2 id="authenticatinguserswithmagicauth">使用Magic Auth认证用户</h2>
<p>如前所述，Magic Auth为所有经过身份验证的用户创建了一个以太坊公共地址，我们可以用它来对用户进行身份验证。</p>
<p>让我们创建一个<code>index.html</code>文件，作为我们将要开发的应用程序的GUI。</p>
<p>为了验证用户进入我们的应用程序，我们将与Magic集成。一旦用户通过认证，我们将能够在以太坊区块链上看到由Magic为该用户自动创建的帐户和公共地址。</p>
<p>在实现这一点之前，我们首先需要创建一个神奇的Auth应用程序来获取我们在应用程序中需要的密钥。</p>
<p>前往你的神奇仪表盘，点击<strong>新应用</strong>按钮，输入应用名称。然后，复制<code>PUBLISHABLE API KEY</code>的内容:</p>
<p><img data-attachment-id="128837" data-permalink="https://blog.logrocket.com/magic-ethereum-blockchain/attachment/new-app-magic-dashboard/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/new-app-magic-dashboard.png" data-orig-size="730,914" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="New app on Magic dashboard" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/new-app-magic-dashboard-240x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/new-app-magic-dashboard.png" decoding="async" class="aligncenter size-full wp-image-128837 jetpack-lazy-image" src="../Images/08615c7128517313a99a8ae13a444b6b.png" alt="New App On Magic Dashboard" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/new-app-magic-dashboard.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/new-app-magic-dashboard-240x300.png 240w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/new-app-magic-dashboard.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/new-app-magic-dashboard.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="128837" data-permalink="https://blog.logrocket.com/magic-ethereum-blockchain/attachment/new-app-magic-dashboard/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/new-app-magic-dashboard.png" data-orig-size="730,914" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="New app on Magic dashboard" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/new-app-magic-dashboard-240x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/new-app-magic-dashboard.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-128837" src="../Images/08615c7128517313a99a8ae13a444b6b.png" alt="New App On Magic Dashboard" srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/new-app-magic-dashboard.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/new-app-magic-dashboard-240x300.png 240w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/new-app-magic-dashboard.png"/></noscript>
<p><code>index.html</code>文件的内容支持登录和注销功能，以及与以太坊区块链的初始交互:</p>
<pre class="language-html hljs">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Magic and Ethereum&lt;/title&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;
    &lt;link rel="stylesheet" type="text/css" href="styles.css" /&gt;
    &lt;script src="https://auth.magic.link/sdk"&gt;&lt;/script&gt;
    &lt;script src="https://cdn.jsdelivr.net/npm/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="671002055427564955495656">[email protected]</a>/dist/web3.min.js"&gt;&lt;/script&gt;
    &lt;script&gt;
      /* Configure Ethereum provider */
      const magic = new Magic("pk_live_your_own_here", {
        network: "rinkeby"
      });
      const web3 = new Web3(magic.rpcProvider);
      const render = async () =&gt; {
        const isLoggedIn = await magic.user.isLoggedIn();

        let authHtml = `
          &lt;div class="container"&gt;
            &lt;h1&gt;Please sign up or login&lt;/h1&gt;
            &lt;form onsubmit="login(event)"&gt;
              &lt;input type="email" name="email" required="required" placeholder="Enter your email" /&gt;
              &lt;button type="submit"&gt;Send&lt;/button&gt;
            &lt;/form&gt;
          &lt;/div&gt;
        `;
        let userHtml = "";
        const target = document.querySelector("#app");
        if (isLoggedIn) {
          const userMetadata = await magic.user.getMetadata();
          const userAddress = (await web3.eth.getAccounts())[0];
          const userBalance = web3.utils.fromWei(
            await web3.eth.getBalance(userAddress)
          );
          authHtml = `
             &lt;div class="container"&gt;
              &lt;h1&gt;Current user: ${userMetadata.email}&lt;/h1&gt;
              &lt;h1&gt;User Address: ${userAddress}&lt;/h1&gt;
              &lt;h1&gt;Current Balance: ${userBalance} ETH&lt;/h1&gt;
              &lt;button onclick="logout()"&gt;Logout&lt;/button&gt;
            &lt;/div&gt;
         `;

          userHtml = `
            &lt;div class="container"&gt;
              &lt;h1&gt;Ethereum address&lt;/h1&gt;
              &lt;div class="info"&gt;
                &lt;a href="https://rinkeby.etherscan.io/address/${userAddres                    s}" target="_blank"&gt;${userAddress}&lt;/a&gt;
              &lt;/div&gt;
              &lt;h1&gt;Balance&lt;/h1&gt;
              &lt;div class="info"&gt;${userBalance} ETH&lt;/div&gt;
            &lt;/div&gt;
          `;
        }
        target.innerHTML = authHtml + userHtml
      };
      const login = async e =&gt; {
        e.preventDefault();
        const email = new FormData(e.target).get("email");
        if (email) {
          await magic.auth.loginWithMagicLink({ email });
          render();
        }
      };

      const logout = async () =&gt; {
        await magic.user.logout();
        render();
      };
&lt;/script&gt;
  &lt;/head&gt;
  &lt;body onload="render()"&gt;
    &lt;div id="app"&gt;
      &lt;div class="container"&gt;Loading...&lt;/div&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<p><img data-attachment-id="128839" data-permalink="https://blog.logrocket.com/magic-ethereum-blockchain/attachment/login-before-user-authentication/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/login-before-user-authentication.png" data-orig-size="730,353" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Login screen before user authentication" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/login-before-user-authentication-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/login-before-user-authentication.png" decoding="async" class="aligncenter size-full wp-image-128839 jetpack-lazy-image" src="../Images/72607130fb8119aad098181efc1e37a4.png" alt="Login Screen Before User Authentication" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/login-before-user-authentication.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/login-before-user-authentication-300x145.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/login-before-user-authentication.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/login-before-user-authentication.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="128839" data-permalink="https://blog.logrocket.com/magic-ethereum-blockchain/attachment/login-before-user-authentication/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/login-before-user-authentication.png" data-orig-size="730,353" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Login screen before user authentication" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/login-before-user-authentication-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/login-before-user-authentication.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-128839" src="../Images/72607130fb8119aad098181efc1e37a4.png" alt="Login Screen Before User Authentication" srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/login-before-user-authentication.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/login-before-user-authentication-300x145.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/login-before-user-authentication.png"/></noscript>
<p>用户通过身份验证后，我们向他们展示一些细节以确保一切正常:</p>
<p><img data-attachment-id="128841" data-permalink="https://blog.logrocket.com/magic-ethereum-blockchain/attachment/login-screen-after-user-authentication/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/login-screen-after-user-authentication.png" data-orig-size="730,652" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Login screen after user authentication" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/login-screen-after-user-authentication-300x268.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/login-screen-after-user-authentication.png" decoding="async" class="aligncenter size-full wp-image-128841 jetpack-lazy-image" src="../Images/e746d568ca6dac91df4153f013a87e3e.png" alt="Login Screen After User Authentication" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/login-screen-after-user-authentication.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/login-screen-after-user-authentication-300x268.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/login-screen-after-user-authentication.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/login-screen-after-user-authentication.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="128841" data-permalink="https://blog.logrocket.com/magic-ethereum-blockchain/attachment/login-screen-after-user-authentication/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/login-screen-after-user-authentication.png" data-orig-size="730,652" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Login screen after user authentication" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/login-screen-after-user-authentication-300x268.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/login-screen-after-user-authentication.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-128841" src="../Images/e746d568ca6dac91df4153f013a87e3e.png" alt="Login Screen After User Authentication" srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/login-screen-after-user-authentication.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/login-screen-after-user-authentication-300x268.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/login-screen-after-user-authentication.png"/></noscript>
<h2 id="writingtotheblockchain">给区块链写信</h2>
<p>用户登录后，他们可以通过魔术与区块链互动。为了测试这一点，我们将通过写入区块链来更新契约中的消息属性。</p>
<p>我们将简单地调用契约中的<code>update</code>方法，并传入新消息。让我们更新一下<code>index.html</code>文件:</p>
<pre class="language-html hljs">const contractABI = 'theabi';
let contractAddress = "0x83d2F577E2c4D056864543a62B8638bFA0ebaAD6";

let userHtml = "";
let contractHtml = "";
if (isLoggedIn) {
let contract = new web3.eth.Contract(
            JSON.parse(contractABI),
            contractAddress
          );
          const currentMessage = await contract.methods.message().call();
          contractHtml = `
            &lt;div class="container"&gt;
              &lt;h1&gt;Smart Contract&lt;/h1&gt;
              &lt;div class="info"&gt;
                &lt;a href="https://rinkeby.etherscan.io/address/${contractAddress}" target="_blank"&gt;${contractAddress}&lt;/a&gt;
              &lt;/div&gt;
              &lt;h1&gt;Message&lt;/h1&gt;
              &lt;div class="info"&gt;${currentMessage}&lt;/div&gt;
              &lt;form onsubmit="update(event)"&gt;
                &lt;input type="text" name="new-message" class="full-width" required="required" placeholder="New Message" /&gt;
                &lt;button id="btn-update-msg" type="submit"&gt;Update Message&lt;/button&gt;
              &lt;/form&gt;
            &lt;/div&gt;
          `;
        }

target.innerHTML = authHtml + userHtml + contractHtml
</pre>
<p>接下来，我们添加<code>update</code>方法，它简单地使用Magic提供的第一个公共以太坊帐户来发送对契约的<code>update</code>方法的调用:</p>
<pre class="language-html hljs">const update = async e =&gt; {
        e.preventDefault();
        const newMessage = new FormData(e.target).get("new-message");
        if (newMessage) {
          const btnUpdateMsg = document.getElementById("btn-update-msg");
          btnUpdateMsg.disabled = true;
          btnUpdateMsg.innerText = "Updating...";
          const fromAddress = (await web3.eth.getAccounts())[0];
          const contract = new web3.eth.Contract(
            JSON.parse(contractABI),
            contractAddress
          );
          const receipt = await contract.methods
            .update(newMessage)
            .send({ from: fromAddress });
          console.log("Completed:", receipt);
          render();
        }
      };
</pre>
<p>我们现在有了一个新的界面，如下图所示:</p>
<p><img data-attachment-id="128843" data-permalink="https://blog.logrocket.com/magic-ethereum-blockchain/attachment/ethereum-interface/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-interface.png" data-orig-size="730,800" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Ethereum interface" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-interface-274x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-interface.png" decoding="async" class="aligncenter size-full wp-image-128843 jetpack-lazy-image" src="../Images/606089926fb24a7dbd0c06a8eb5da0ea.png" alt="Ethereum Interface" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-interface.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-interface-274x300.png 274w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-interface.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-interface.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="128843" data-permalink="https://blog.logrocket.com/magic-ethereum-blockchain/attachment/ethereum-interface/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-interface.png" data-orig-size="730,800" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Ethereum interface" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-interface-274x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-interface.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-128843" src="../Images/606089926fb24a7dbd0c06a8eb5da0ea.png" alt="Ethereum Interface" srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-interface.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-interface-274x300.png 274w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-interface.png"/></noscript>
<p>一旦用户输入新消息，将启动一个新事务来更新消息属性。</p>
<p>请记住，我们需要将测试醚添加到用于与区块链交互的帐户中。为此，请前往<a href="https://rinkeby-faucet.com/" target="_blank" rel="noopener"> Rinkeby乙醚龙头</a>。在您的帐户中获得一些乙醚后，请刷新页面以反映所做的更改:</p>
<p><img data-attachment-id="128847" data-permalink="https://blog.logrocket.com/magic-ethereum-blockchain/attachment/updated-ethereum-balance/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-ethereum-balance.png" data-orig-size="730,340" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Updated Ethereum balance" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-ethereum-balance-300x140.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-ethereum-balance.png" decoding="async" class="aligncenter size-full wp-image-128847 jetpack-lazy-image" src="../Images/0c6530bfe8d5da137a727a69bacddf5d.png" alt="Updated Ethereum Balance" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-ethereum-balance.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/updated-ethereum-balance-300x140.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-ethereum-balance.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-ethereum-balance.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="128847" data-permalink="https://blog.logrocket.com/magic-ethereum-blockchain/attachment/updated-ethereum-balance/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-ethereum-balance.png" data-orig-size="730,340" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Updated Ethereum balance" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-ethereum-balance-300x140.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-ethereum-balance.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-128847" src="../Images/0c6530bfe8d5da137a727a69bacddf5d.png" alt="Updated Ethereum Balance" srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-ethereum-balance.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/updated-ethereum-balance-300x140.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-ethereum-balance.png"/></noscript>
<p>接下来，用户通过插入新消息来更新消息。这将需要一些时间，因为它需要与运行在Rinkeby网络上的以太坊区块链进行交互。一旦完成，它应该重新呈现页面，并显示新的合同消息。</p>
<p><img data-attachment-id="128851" data-permalink="https://blog.logrocket.com/magic-ethereum-blockchain/attachment/updated-smart-contract-message/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-smart-contract-message.png" data-orig-size="730,514" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Updated smart contract message" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-smart-contract-message-300x211.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-smart-contract-message.png" decoding="async" class="aligncenter size-full wp-image-128851 jetpack-lazy-image" src="../Images/74aeabee8ea7bb431edad77f86ac774e.png" alt="Updated Smart Contract Message" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-smart-contract-message.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/updated-smart-contract-message-300x211.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-smart-contract-message.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-smart-contract-message.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="128851" data-permalink="https://blog.logrocket.com/magic-ethereum-blockchain/attachment/updated-smart-contract-message/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-smart-contract-message.png" data-orig-size="730,514" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Updated smart contract message" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-smart-contract-message-300x211.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-smart-contract-message.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-128851" src="../Images/74aeabee8ea7bb431edad77f86ac774e.png" alt="Updated Smart Contract Message" srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-smart-contract-message.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/updated-smart-contract-message-300x211.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/updated-smart-contract-message.png"/></noscript>
<p>通过<a href="https://rinkeby.etherscan.io/address/0x83d2F577E2c4D056864543a62B8638bFA0ebaAD6" target="_blank" rel="noopener">点击链接</a>到已部署的智能合同，转到Rinkeby，验证我们可以看到部署合同和更新消息的事务:</p>
<p><img data-attachment-id="128853" data-permalink="https://blog.logrocket.com/magic-ethereum-blockchain/attachment/rinkeby-transaction/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/rinkeby-transaction.png" data-orig-size="730,355" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Rinkeby transaction" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/rinkeby-transaction-300x146.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/rinkeby-transaction.png" decoding="async" class="aligncenter size-full wp-image-128853 jetpack-lazy-image" src="../Images/833d5d8d793f9b9718785be46ce6fcc2.png" alt="Rinkeby Transaction" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/rinkeby-transaction.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/rinkeby-transaction-300x146.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/rinkeby-transaction.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/rinkeby-transaction.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="128853" data-permalink="https://blog.logrocket.com/magic-ethereum-blockchain/attachment/rinkeby-transaction/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/rinkeby-transaction.png" data-orig-size="730,355" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Rinkeby transaction" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/rinkeby-transaction-300x146.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/rinkeby-transaction.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-128853" src="../Images/833d5d8d793f9b9718785be46ce6fcc2.png" alt="Rinkeby Transaction" srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/rinkeby-transaction.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/rinkeby-transaction-300x146.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/rinkeby-transaction.png"/></noscript>
<p>本次更新从我们用于更新的帐户中扣除了一些油费。如果我们检查当前余额，我们会看到所需的乙醚被扣除:</p>
<p><img data-attachment-id="128857" data-permalink="https://blog.logrocket.com/magic-ethereum-blockchain/attachment/ethereum-balance-after-update/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-balance-after-update.png" data-orig-size="730,340" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Ethereum balance after update" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-balance-after-update-300x140.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-balance-after-update.png" decoding="async" class="aligncenter size-full wp-image-128857 jetpack-lazy-image" src="../Images/e22243a6857455a265fa69fa4153a5d7.png" alt="Ethereum Balance After Update" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-balance-after-update.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-balance-after-update-300x140.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-balance-after-update.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-balance-after-update.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="128857" data-permalink="https://blog.logrocket.com/magic-ethereum-blockchain/attachment/ethereum-balance-after-update/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-balance-after-update.png" data-orig-size="730,340" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Ethereum balance after update" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-balance-after-update-300x140.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-balance-after-update.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-128857" src="../Images/e22243a6857455a265fa69fa4153a5d7.png" alt="Ethereum Balance After Update" srcset="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-balance-after-update.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-balance-after-update-300x140.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/08/ethereum-balance-after-update.png"/></noscript>
<h2 id="conclusion">结论</h2>
<p>在本文中，我们了解了Magic以及它如何使用web3.js JavaScript库与以太坊区块链集成。</p>
<p>希望您喜欢这篇文章，并对Magic给区块链开发人员创造安全、分散的应用程序的机会感到兴奋。感谢阅读！</p><div class="code-block code-block-26">
<div class="blog-plug inline-plug blockchain-plug"><h2>加入像Bitso和Coinsquare这样的组织，他们使用LogRocket主动监控他们的Web3应用</h2><p>影响用户在您的应用中激活和交易的能力的客户端问题会极大地影响您的底线。如果您对监控UX问题、自动显示JavaScript错误、跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a target="_blank" href="https://lp.logrocket.com/blg/web3-signup">try LogRocket</a><p>.</p><a class="signup" href="https://lp.logrocket.com/blg/web3-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/dacb06c713aec161ffeaffae5bd048cd.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/dacb06c713aec161ffeaffae5bd048cd.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png"/></noscript></a><a href="https://lp.logrocket.com/blg/web3-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用的DVR，记录你的网络应用或网站上发生的一切。您可以汇总和报告关键的前端性能指标，重放用户会话和应用程序状态，记录网络请求，并自动显示所有错误，而不是猜测问题发生的原因。</p><p>现代化您调试web和移动应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/web3-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>