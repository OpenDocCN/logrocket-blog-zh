<html>
<head>
<title>Using CSS media queries in React with Fresnel - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在 React with Fresnel - LogRocket 博客中使用 CSS 媒体查询</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/using-css-media-queries-react-fresnel/#0001-01-01">https://blog.logrocket.com/using-css-media-queries-react-fresnel/#0001-01-01</a></blockquote><div><article class="article-post">
<p>据 StatCounter <a href="https://gs.statcounter.com/platform-market-share/desktop-mobile-tablet" target="_blank" rel="noopener">数据</a>显示，如今的设备市场由移动、桌面和平板电脑主导。为了给用户提供最好的 UX，响应式设计是现代 web 开发中的必备工具。</p>
<p>在本文中，我们将检查一下<a href="https://www.npmjs.com/package/@artsy/fresnel" target="_blank" rel="noopener"> Fresnel </a>包，它是实现服务器端渲染(SSR)的响应式设计的最有效方法之一。这是一个由<a href="https://artsy.github.io/" target="_blank" rel="noopener"> Artsy </a>创建的开源 npm 项目，易于使用，受到开发者的信任。</p>
<p><img data-attachment-id="97227" data-permalink="https://blog.logrocket.com/using-css-media-queries-react-fresnel/downloads-over-year/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/downloads-over-year.png" data-orig-size="730,299" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Downloads over year" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/downloads-over-year-300x123.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/downloads-over-year.png" decoding="async" class="aligncenter size-full wp-image-97227 jetpack-lazy-image" src="../Images/40101ff26c008e41efc97b7c5b40fda5.png" alt="Downloads Over Year" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/downloads-over-year.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/downloads-over-year-300x123.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/downloads-over-year.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/downloads-over-year.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="97227" data-permalink="https://blog.logrocket.com/using-css-media-queries-react-fresnel/downloads-over-year/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/downloads-over-year.png" data-orig-size="730,299" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Downloads over year" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/downloads-over-year-300x123.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/downloads-over-year.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-97227" src="../Images/40101ff26c008e41efc97b7c5b40fda5.png" alt="Downloads Over Year" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/downloads-over-year.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/downloads-over-year-300x123.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/downloads-over-year.png"/></noscript>
<p>我们将探索它与传统方法的不同之处，以及为什么您应该使用它。我们还将在 React 中创建一个响应式色卡应用程序，以在实践中展示其功能。</p>
<h2>什么是 CSS 媒体查询？</h2>
<p>媒体查询允许开发人员为不同的视口大小定义不同的样式规则。</p>
<p>通常，我们会使用传统的方法，首先创建 HTML 元素，然后使用 CSS 通过媒体查询来描述它在不同屏幕宽度上的行为。</p>
<p>一个简单的例子是:</p>
<pre class="language-xml hljs">&lt;div class="wrapper"&gt;&lt;/div&gt;</pre>
<p>然后通过 CSS:</p>
<pre class="language-css hljs">.wrapper {
  width: 300px;
  height: 300px;
  background: gold;
}

@media screen and (min-width: 480px) {
  .wrapper {
    background-color: light green;
  }
}</pre>
<p>如果我们在<a href="https://jsbin.com" target="_blank" rel="noopener"> JSBin </a>上运行一个例子，我们会看到当满足视窗的<code>480px</code>宽度时，正方形元素改变了它的背景颜色:</p>
<p><img data-attachment-id="97232" data-permalink="https://blog.logrocket.com/using-css-media-queries-react-fresnel/changing-square-color/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/changing-square-color.gif" data-orig-size="730,244" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Changing square color" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/changing-square-color-300x100.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/changing-square-color.gif" decoding="async" class="aligncenter size-full wp-image-97232 jetpack-lazy-image" src="../Images/31b57e4a821fd8ee8bb0b5a470e6e0c3.png" alt="Changing Square Color" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/changing-square-color.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/changing-square-color.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="97232" data-permalink="https://blog.logrocket.com/using-css-media-queries-react-fresnel/changing-square-color/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/changing-square-color.gif" data-orig-size="730,244" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Changing square color" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/changing-square-color-300x100.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/changing-square-color.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-97232" src="../Images/31b57e4a821fd8ee8bb0b5a470e6e0c3.png" alt="Changing Square Color" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/changing-square-color.gif"/></noscript>
<h2>什么是菲涅尔？</h2>
<p>Fresnel 将传统的媒体查询方法转移到 React 生态系统。</p>
<p>当一个应用程序需要扩展并且组件的复杂性增加时，它的断点逻辑是有益的。</p>
<p>基本实现如下所示:</p>
<pre class="language-javascript hljs">import React from "react"
import ReactDOM from "react-dom"
import { createMedia } from "@artsy/fresnel"

const { MediaContextProvider, Media } = createMedia({
  breakpoints: {
    sm: 0,
    md: 768,
    lg: 1024,
    xl: 1192,
  },
})

const App = () =&gt; (
  &lt;MediaContextProvider&gt;
    &lt;Media at="sm"&gt;
      &lt;MobileComponent /&gt;
    &lt;/Media&gt;
    &lt;Media at="md"&gt;
      &lt;TabletComponent /&gt;
    &lt;/Media&gt;
    &lt;Media greaterThanOrEqual="lg"&gt;
      &lt;DesktopComponent /&gt;
    &lt;/Media&gt;
  &lt;/MediaContextProvider&gt;
)

ReactDOM.render(&lt;App /&gt;, document.getElementById("react"));</pre>
<p>多亏了它的<a href="https://github.com/artsy/fresnel#api" target="_blank" rel="noopener"> API </a>，我们可以使用<code>MediaContextProvider</code>和<code>Media</code>组件为一个响应式 web 应用程序构建一个坚实的基础。</p>
<p>某些屏幕宽度上的行为是通过提供定义的断点作为道具来控制的。这些包括<code>at</code>、<code>lessThan</code>、<code>greaterThan</code>、<code>greaterThanOrEqual</code>和<code>between</code>，它们的名字不言自明。</p>
<h2>菲涅尔和条件渲染有什么不同？</h2>
<p>如果您以前在 React 中实现过响应式布局，上面示例的代码结构可能看起来很熟悉。您可能使用过条件渲染，如下所示:</p>
<pre class="language-javascript hljs">const App = () =&gt; {
  const { width } = useViewport();
  const breakpoint = 768;

  return width &lt; breakpoint ? &lt;MobileComponent /&gt; : &lt;DesktopComponent /&gt;;
}</pre>
<p>除非您需要实现服务器端呈现解决方案，否则上面的例子就可以了。这就是 Fresnel 的用武之地，它将自己与其他解决方案区分开来。</p>
<p>为了解释这个概念，<a href="https://blog.logrocket.com/why-you-should-render-react-on-the-server-side-a50507163b79/" target="_blank" rel="noopener">服务器端呈现</a> (SSR)是一种在服务器上呈现客户端单页应用程序(SPA)的技术。这样，客户端接收到一个呈现的 HTML 文件。</p>
<p>使用 Fresnel，我们可以在服务器上渲染所有断点，以便在 React 启动之前正确渲染 HTML/CSS。这提高了用户的 UX。</p>
<h2>使用 React 和 Fresnel 构建应用程序</h2>
<p>我们将创建一个色卡应用程序，为移动和桌面视图切换其布局。</p>
<p>移动视图上的卡片将被放置在单列布局中，而桌面视图将使用更复杂的网格样式布局，在水平和垂直卡片之间交替。</p>
<p>以下是显示卡片序列的项目线框:</p>
<p><img data-attachment-id="97230" data-permalink="https://blog.logrocket.com/using-css-media-queries-react-fresnel/desktop-mobile-views/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/desktop-mobile-views.png" data-orig-size="730,370" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Desktop and mobile views" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/desktop-mobile-views-300x152.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/desktop-mobile-views.png" decoding="async" class="aligncenter size-full wp-image-97230 jetpack-lazy-image" src="../Images/4084c4a021b9a98fea79e4b9fe766737.png" alt="Desktop and Mobile Views" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/desktop-mobile-views.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/desktop-mobile-views-300x152.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/desktop-mobile-views.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/desktop-mobile-views.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="97230" data-permalink="https://blog.logrocket.com/using-css-media-queries-react-fresnel/desktop-mobile-views/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/desktop-mobile-views.png" data-orig-size="730,370" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Desktop and mobile views" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/desktop-mobile-views-300x152.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/desktop-mobile-views.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-97230" src="../Images/4084c4a021b9a98fea79e4b9fe766737.png" alt="Desktop and Mobile Views" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/desktop-mobile-views.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/desktop-mobile-views-300x152.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/desktop-mobile-views.png"/></noscript>
<h2>初始化 React 应用程序</h2>
<p>我们将开始为我们的项目创建一个单独的文件夹，并将工作方向更改为它。为此，在终端中运行以下命令:<code>mkdir fresnel-demo &amp;&amp; cd fresnel-demo</code>。</p>
<p>要初始化一个新项目，运行<code>npm init -y</code>。</p>
<p>请注意，<code>-y</code>标记将批准包配置的所有默认值，因此您不必在终端中经历多步向导。</p>
<p>接下来，我们将安装前端的基本先决条件。运行<code>npm i react react-dom</code>。</p>
<p>对于后端，我们将使用 Express。要安装它，运行<code>npm i express</code>。</p>
<p>当我们在根目录下时，让我们通过运行<code>npm i @artsy/fresnel</code>来安装 Fresnel 库。</p>
<h2>React 中的建模数据</h2>
<p>因为我们正在构建颜色应用程序，所以我们需要的主要数据是颜色名称。</p>
<p>将数据从应用程序逻辑中分离出来是一个很好的实践。出于这个原因，我们将从创建<code>src</code>文件夹开始，其中包含一个名为<code>data</code>的文件夹。</p><div class="code-block code-block-54">
<hr/>
<h3>更多来自 LogRocket 的精彩文章:</h3>

<hr/></div>
<p>在<code>data</code>文件夹中，创建一个名为<code>colors.jsx</code>的新文件，并包含以下代码:</p>
<pre class="language-javascript hljs">export const colors = [
  "gold",
  "tomato",
  "limegreen",
  "slateblue",
  "deeppink",
  "dodgerblue",
];</pre>
<p>我们创建了<code>colors</code>变量，将所有颜色名称存储为一个字符串数组。</p>
<h2>创建断点</h2>
<p>现在我们必须定义我们的应用程序将使用的断点。</p>
<p>在<code>src</code>文件夹中，创建另一个名为<code>media</code>的文件夹。在其中，创建一个名为<code>breakpoints.jsx</code>的文件，并包含以下代码:</p>
<pre class="language-javascript hljs">import { createMedia } from "@artsy/fresnel";

const ExampleAppMedia = createMedia({
  breakpoints: {
    sm: 0,
    md: 768,
    lg: 1024,
    xl: 1192,
  },
});

export const mediaStyle = ExampleAppMedia.createMediaStyle();
export const { Media, MediaContextProvider } = ExampleAppMedia;</pre>
<p>我们使用<code>createMedia</code>来定义特定的断点并导出<code>mediaStyle</code>，稍后我们将把它注入到服务器端。我们还将<code>Media</code>和<code>MediaContexProvider</code>包裹在需要响应的组件周围。</p>
<h2>创建组件</h2>
<p>在同一个<code>src</code>文件夹中，创建另一个名为<code>components</code>的文件夹。</p>
<p>在里面，创建四个单独的文件:<code>DesktopComponent.jsx</code>、<code>DesktopComponent.css</code>、<code>MobileComponent.jsx,</code>和<code>MobileComponent.css</code>。</p>
<p>打开<code>DesktopComponent.jsx</code>文件并包含以下代码:</p>
<pre class="language-javascript hljs">import React from "react";
import "./DesktopComponent.css";
import { colors } from "../data/colors";

export const DesktopComponent = () =&gt; {
  return (
    &lt;div className="dWrapper"&gt;
      {colors.map((el, i) =&gt; (
        &lt;div
          style={{ backgroundColor: el, gridArea: `c${i + 1}` }}
          key={i}
        &gt;&lt;/div&gt;
      ))}
    &lt;/div&gt;
  );
};</pre>
<p>我们导入了外部样式表和颜色名称。在组件中，我们遍历了所有的颜色，并指定了背景色以及在网格中的位置。</p>
<p>现在，打开<code>DesktopComponent.css</code>并添加以下样式规则:</p>
<pre class="language-css hljs">.dWrapper {
  max-width: 1200px;
  height: 500px;
  margin: 0 auto;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  grid-template-rows: repeat(3, 1fr);
  gap: 20px;
  grid-template-areas:
    "c1 c1 c2 c3"
    "c4 c5 c2 c3"
    "c4 c5 c6 c6";
}</pre>
<p>我们设置包装器的最大宽度和高度，并使其在视口中居中。然后，我们使用网格模板来定义列和行，并创建布局模式。</p>
<p>接下来，打开<code>MobileComponent.jsx</code>文件并包含以下代码:</p>
<pre class="language-javascript hljs">import React from "react";
import "./MobileComponent.css";
import { colors } from "../data/colors";

export const MobileComponent = () =&gt; {
  return (
    &lt;div className="mWrapper"&gt;
      {colors.map((el, i) =&gt; (
        &lt;div style={{ backgroundColor: el }} key={i}&gt;&lt;/div&gt;
      ))}
    &lt;/div&gt;
  );
};</pre>
<p>这里，我们导入了外部样式和颜色名称。然后我们遍历颜色，并为每个元素分配背景色。</p>
<p>最后，打开<code>MobileComponent.css</code>并添加以下样式规则:</p>
<pre class="language-css hljs">.mWrapper {
  width: 100%;
  display: grid;
  grid-template-rows: repeat(6, 100px);
  gap: 20px;
}</pre>
<p>我们设置宽度以填充整个视口，对行使用网格系统，并在它们之间添加间隙。</p>
<h2>用 Fresnel 实现 React 前端</h2>
<p>让我们创建一个实际的<code>App</code>组件，它将呈现我们之前创建的组件。在<code>src</code>文件夹中，创建<code>App.jsx</code>并包含以下代码:</p>
<pre class="language-javascript hljs">import React from "react";
import { Media, MediaContextProvider } from "./media/breakpoints";
import { MobileComponent } from "./components/MobileComponent";
import { DesktopComponent } from "./components/DesktopComponent";

export const App = () =&gt; {
  return (
    &lt;MediaContextProvider&gt;
      &lt;Media at="sm"&gt;
        &lt;MobileComponent /&gt;
      &lt;/Media&gt;
      &lt;Media greaterThan="sm"&gt;
        &lt;DesktopComponent /&gt;
      &lt;/Media&gt;
    &lt;/MediaContextProvider&gt;
  );
};</pre>
<p>注意，我们从<code>breakpoints.jsx</code>文件中导入了<code>Media</code>和<code>MediaContextProvider</code>，并用它们来控制哪些组件应该显示在哪些视口中。</p>
<p>为了将<code>App</code>呈现到屏幕上，我们需要一个基本文件来访问 DOM 树的<code>root</code>元素并呈现它。在<code>src</code>文件夹中创建一个名为<code>index.jsx</code>的新文件，并包含以下代码:</p>
<pre class="language-javascript hljs">import React from "react";
import ReactDOM from "react-dom";
import { App } from "./App";

ReactDOM.hydrate(&lt;App /&gt;, document.getElementById("root"));</pre>
<p>注意，我们使用了<code>hydrate</code>而不是<code>render</code>。这是服务器端呈现的推荐方式，因为它通过附加事件处理程序将服务器呈现的 HTML 转换为动态网页。</p>
<h2>设置后端</h2>
<p>现在让我们把焦点从前端转移到后端。导航回项目的根目录，创建一个名为<code>server</code>的新文件夹。</p>
<p>在<code>server</code>中，创建一个文件<code>index.jsx</code>。单个文件就足以提供服务器端呈现的功能。</p>
<p>包括以下代码:</p>
<pre class="language-javascript hljs">import React from "react";
import ReactDOMServer from "react-dom/server";
import { App } from "../src/App";
import { mediaStyle } from "../src/media/breakpoints";

import express from "express";
const app = express();
const PORT = 3000;

app.get("/", (req, res) =&gt; {
  const app = ReactDOMServer.renderToString(&lt;App /&gt;);

  const html = `
        &lt;html lang="en"&gt;
        &lt;head&gt;
        &lt;title&gt;Fresnel SSR example&lt;/title&gt;
        &lt;style type="text/css"&gt;${mediaStyle}&lt;/style&gt;
        &lt;link rel="stylesheet" href="app.css"&gt;
        &lt;script src="app.js" async defer&gt;&lt;/script&gt;
        &lt;/head&gt;
        &lt;body&gt;
            &lt;div id="root"&gt;${app}&lt;/div&gt;
        &lt;/body&gt;
        &lt;/html&gt;
    `;
  res.send(html);
});

app.use(express.static("./built"));

app.listen(PORT, () =&gt; {
  console.log(`App started on port ${PORT}`);
});</pre>
<p>首先，我们创建了一个 Express 实例，并将其分配给端口<code>3000</code>。对于在<code>"/"</code>路由上的所有传入 GET 请求，我们使用<code>renderToString()</code>在服务器上生成 HTML 并发送标记作为响应。</p>
<p>注意，我们还在 HTML 的 head 部分注入了<code>mediaStyle</code>。这就是 Fresnel 能够在服务器上呈现断点的方式。</p>
<h2>配置版本</h2>
<p>在运行我们的应用程序之前，我们需要捆绑我们的文件，以便我们可以在 SSR 期间访问它们。我们将使用<a href="https://esbuild.github.io/" target="_blank" rel="noopener"> esbuild </a>，它是一个快速捆绑器。</p>
<p>首先，通过运行<code>npm i --dev esbuild.</code>安装它</p>
<p>在项目根目录中，打开文件<code>package.json</code>并将<code>scripts</code>设置为如下:</p>
<pre class="language-json hljs">"scripts": {
    "client:build": "esbuild src/index.jsx --bundle --outfile=built/app.js",
    "server:build": "esbuild server/index.jsx --bundle --outfile=built/server.js --platform=node",
    "start": "node built/server.js"
  }</pre>
<p>我们将首先运行前端的构建脚本。使用命令<code>npm run client:build</code>。这将生成一个新文件夹<code>built</code>，其中包含<code>app.js</code>和<code>app.css</code>文件。</p>
<p>接下来，我们将不得不对服务器文件做同样的事情。运行<code>npm run server:build</code>。</p>
<h2>测试 React 应用程序</h2>
<p>现在，我们要做的就是运行命令<code>npm start</code>来启动应用程序。您将在终端中收到来自<code>server.jsx</code>文件的消息，通知您开发者服务器已经在端口<code>3000</code>上准备好了。</p>
<p>打开浏览器并导航至<a href="http://localhost:3000" target="_blank" rel="noopener"> http://localhost:3000 </a>。您应该会看到一个响应式应用程序。通过按键盘上的<strong> F12 </strong>打开开发工具，并尝试调整浏览器视图的大小:</p>
<p><img data-attachment-id="97234" data-permalink="https://blog.logrocket.com/using-css-media-queries-react-fresnel/resizing-browser/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/resizing-browser.gif" data-orig-size="730,272" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Resizing browser" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/resizing-browser-300x112.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/resizing-browser.gif" decoding="async" class="aligncenter size-full wp-image-97234 jetpack-lazy-image" src="../Images/418c77fbbf8e242ae144c066518085f2.png" alt="Resizing Browser" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/resizing-browser.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/resizing-browser.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="97234" data-permalink="https://blog.logrocket.com/using-css-media-queries-react-fresnel/resizing-browser/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/resizing-browser.gif" data-orig-size="730,272" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Resizing browser" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/resizing-browser-300x112.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/resizing-browser.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-97234" src="../Images/418c77fbbf8e242ae144c066518085f2.png" alt="Resizing Browser" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/resizing-browser.gif"/></noscript>
<p>请注意，如果您想要在前端或服务器上进行任何更改，您必须重新构建应用程序并重启服务器。或者，您可以在构建命令的末尾使用<code>--watch</code>标志。这里有更多关于那个<a href="https://esbuild.github.io/api/#watch" target="_blank" rel="noopener">的说明</a>。</p>
<h2>结论</h2>
<p>在本文中，我们研究了 Fresnel 包并构建了一个完全响应的 web 应用程序。</p>
<p>我们还学习了如何在不使用 CRA 等外部工具的情况下从头开始设置 React 项目，如何在 React 中设置 SSR 渲染，以及如何使用 esbuild 等构建器。</p>
<p>下次你需要在 React 应用上提供最佳渲染体验时，你的工具箱里会有一个秘密方法。通过 Fresnel 包在服务器上渲染媒体断点，你就会知道这是可能的。</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用 LogRocket 消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款 React analytics 解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket 告诉您 React 应用程序中实际影响用户的最具影响力的 bug 和 UX 问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS 异常、前端性能指标和用户交互。然后，LogRocket 使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的 React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试 LogRocket】。</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>