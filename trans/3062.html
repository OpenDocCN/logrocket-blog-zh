<html>
<head>
<title>What you need to know about the new Next.js router - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>关于新的 Next.js router - LogRocket 博客，你需要知道什么</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/what-you-need-know-new-next-js-router/#0001-01-01">https://blog.logrocket.com/what-you-need-know-new-next-js-router/#0001-01-01</a></blockquote><div><article class="article-post">
<p>自 2016 年成立以来，Next.js 一直对自己的路由固执己见。其基于页面的方法允许开发人员指定何时呈现这些页面(服务器、客户端或静态页面的预呈现)。</p>
<p>然而，这种方法并非没有一些不便之处。幸运的是，托管平台背后的公司和 Next.js 的创造者 Vercel 听到了这些担忧。在 5 月 4 日戏弄了一次重大升级后，一篇<a href="https://nextjs.org/blog/layouts-rfc?utm_source=next-site&amp;utm_medium=banner&amp;utm_campaign=next-website" target="_blank" rel="noopener">博客帖子</a>在两周后删除，解释了 Next.js 路由器的一些重大变化:</p>
<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light">

<p>📣Next.js 路由器正在进行重大升级！◆嵌套路由/布局◆客户端和服务器路由◆ React 18 个功能–开始过渡、暂停◆专为服务器组件设计◆ 100%可增量采用🤯预计 RFC 将很快出台👀</p>
</blockquote>
<p/>
<p> </p>
<p>在本文中，如果您还不熟悉 Next.js 的路由器，您将了解它目前是如何工作的。然后，您将发现会出现什么样的问题，以及此更新计划如何解决这些问题。</p>

<h2 id="how-nextjs-routing-currently-works">Next.js 路由当前如何工作</h2>
<p>如上所述，Next.js 使用基于页面的方法来创建路线。具体来说，这意味着在每个 Next.js 项目中，都存在一个<code>pages</code>文件夹。在这个特殊的文件夹中，每个文件和文件夹都构成了一条新的路径。</p>
<p>在<code>pages</code>文件夹中，第一个根路径是<code>index.js</code>，在<code>/</code> URL 呈现主页。您也可以命名您的文件并创建一个静态路由(例如，<code>/about</code>路由的<code>about.js</code>)。</p>
<p>同样，文件夹也可用于创建嵌套路线。例如，创建一个名为<code>support</code>的文件夹和一个在<code>faq.js</code>中的文件将会创建路线<code>/support/faq</code>。</p>
<p>下面的图表可以更好地说明这一点:</p>
<p><img data-attachment-id="119752" data-permalink="https://blog.logrocket.com/what-you-need-know-new-next-js-router/attachment/pages-folder-structure/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/06/pages-folder-structure.png" data-orig-size="730,331" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Pages folder structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/06/pages-folder-structure-300x136.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/06/pages-folder-structure.png" decoding="async" class="aligncenter size-full wp-image-119752 jetpack-lazy-image" src="../Images/689b68f6f7bec2a0f3b6d1606dfd9c24.png" alt="Pages Folder Structure" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/06/pages-folder-structure.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/06/pages-folder-structure-300x136.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/06/pages-folder-structure.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/06/pages-folder-structure.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="119752" data-permalink="https://blog.logrocket.com/what-you-need-know-new-next-js-router/attachment/pages-folder-structure/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/06/pages-folder-structure.png" data-orig-size="730,331" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Pages folder structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/06/pages-folder-structure-300x136.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/06/pages-folder-structure.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-119752" src="../Images/689b68f6f7bec2a0f3b6d1606dfd9c24.png" alt="Pages Folder Structure" srcset="https://blog.logrocket.com/wp-content/uploads/2022/06/pages-folder-structure.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/06/pages-folder-structure-300x136.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/06/pages-folder-structure.png"/></noscript>
<p>也支持动态路由。通过在文件名或文件夹名中加上方括号，可以创建动态路由。例如，<code>/blog/[article-id].js</code>将支持<code>/blog/1</code>、<code>/blog/nextjs-dynamic-routing</code>等多条路线。</p>
<h2 id="nextjs-router-limitations">Next.js 路由器限制</h2>
<p>不幸的是，这种方法有一个很大的局限性。也就是说，尽管嵌套路由共享一个父路由，但您不能在它们之间共享状态或布局。</p>
<p>例如，以认证为例。在 React 中，使用<a href="https://reactrouterdotcom.fly.dev/docs/en/v6" target="_blank" rel="noopener"> react-router </a>库，您可以创建自定义路由。例如，您可以创建一个受保护的路由来验证用户是否登录。如果用户没有登录，路由会将他们重定向到登录或注册页面。然后，您可以将这个受保护的路由分配给路由器中<code>/authentication</code>下的任何路径。这样，嵌套路由就不必担心身份验证，因为父路由会为它们处理身份验证。</p>
<p>不幸的是，这种情况在 Next.js 中是不可能的。您可以创建一个自定义的 route 组件，但是您必须将它分别包装在每个受保护的页面上。</p>
<p>同样的问题也适用于布局。如果你的应用程序有一个仪表板，那么多个页面将共享一个相似的布局(导航、页脚等)。).就目前情况而言，一次将一个布局应用到多个页面的唯一方法是在应用程序级别上这样做。这种布局将应用于您的整个应用程序。不幸的是，如果你有多个布局，你必须在每页的基础上定义它们。</p>
<h2 id="nextjs-router-changes">Next.js 路由器变更</h2>
<p>知道了所有这些，Vercel 的团队决定修正这些限制。</p>
<h3 id="route-creation-changes">路线创建更改</h3>
<p>首先，与<code>pages</code>文件夹类似，将有一个名为<code>app</code>的新文件夹。这是为了提供向后兼容性，并允许开发人员慢慢迁移到新的路由器。</p>
<p>然后，文件夹结构仍将决定新的路由。这意味着<code>app</code>中的<code>dashboard</code>文件夹将链接到<code>/dashboard</code>路线。然而，有趣的是这些路径中的文件。</p>
<p>之前的路由器假设<code>/pages</code>中的每个文件都是一个新的路由。顺便说一句，这导致开发人员将他们的页面和非页面 React 组件(即<code>Navbar</code>、<code>Header</code>、<code>Footer</code>)分开。将类似于<code>Navbar.js</code>的文件放在主页上，即<code>/pages/index.js</code>，会使路由器认为<code>Navbar</code>是一条新的路由，而不是一个简单的子组件。结果，许多开发人员不得不创建一个<code>components</code>文件夹，并将他们不同的组件分开。</p>
<p>但是，新路由器假定每个文件都不是路由，除非明确说明。因此，要创建新的路线，您必须在文件夹中创建一个<code>page.js</code>。</p>
<p>因此，对于新路由器，我们之前的项目示例如下所示:</p>
<p><img data-attachment-id="119756" data-permalink="https://blog.logrocket.com/what-you-need-know-new-next-js-router/attachment/app-folder-structure/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure.png" data-orig-size="730,677" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="App folder structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure-300x278.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure.png" decoding="async" class="aligncenter size-full wp-image-119756 jetpack-lazy-image" src="../Images/6ba8163877cdd714e5ff13eb68a958ff.png" alt="App Folder Structure" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure-300x278.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="119756" data-permalink="https://blog.logrocket.com/what-you-need-know-new-next-js-router/attachment/app-folder-structure/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure.png" data-orig-size="730,677" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="App folder structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure-300x278.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-119756" src="../Images/6ba8163877cdd714e5ff13eb68a958ff.png" alt="App Folder Structure" srcset="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure-300x278.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure.png"/></noscript>
<p>也支持动态路由。有了这种新格式，例如，要有一个<code>/blog/[article-id]</code> URL，您将需要一个<code>/app/blog/[article-id]/page.js</code>文件夹结构。</p>
<p>简而言之，以下是一些文件夹结构及其对应的路径:</p>
<ul>
<li><code>/app/blog/[article-id]/page.js</code> → <code>/blog/[article-id]</code></li>
<li><code>/app/blog/[category-id]/page.js</code> → <code>/blog/[category-id]</code></li>
<li><code>/app/blog/[category-id]/[article-id]/page.js</code> → <code>/blog/[category-id]/[article-id]</code></li>
</ul>
<h3 id="nested-layouts">嵌套布局</h3>
<p>布局也得到了更新。</p>
<p>以前，您可以在单独的文件中创建布局，然后将布局导入到页面中。例如，下面是一个仪表板页面:</p>
<pre class="language-javascript hljs">    import DashboardLayout from '../components/DashboardLayout'

    export default function DashboardPage() {
      /* The content for your dashboard page */
    }

    DashboardPage.getLayout = function getLayout(page) {
      return (
        &lt;DashboardLayout&gt;
          {page}
        &lt;/DashboardLayout&gt;
      )
    }</pre>
<p>如果需要嵌套，可以将多个布局导入到页面中。但是，由于这是在每页的基础上完成的，所以嵌套在仪表板中的每个页面都必须导入布局并嵌套它们。</p>
<p>谢天谢地，这种情况正在改变！使用新的路由器，您将能够为您的仪表板页面指定布局，任何嵌套的页面都将自动接收此布局。您只需在文件夹中创建一个<code>layout.js</code>文件，将该布局应用于该文件夹中的所有路线。</p>
<p>更具体地说，这里有一个例子:</p>
<p><img data-attachment-id="119758" data-permalink="https://blog.logrocket.com/what-you-need-know-new-next-js-router/attachment/app-folder-structure-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure-2.png" data-orig-size="730,478" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="App folder structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure-2-300x196.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure-2.png" decoding="async" class="aligncenter size-full wp-image-119758 jetpack-lazy-image" src="../Images/9239b2431a20c24bc103b5e85f385620.png" alt="App Folder Structure" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure-2.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure-2-300x196.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure-2.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="119758" data-permalink="https://blog.logrocket.com/what-you-need-know-new-next-js-router/attachment/app-folder-structure-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure-2.png" data-orig-size="730,478" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="App folder structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure-2-300x196.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure-2.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-119758" src="../Images/9239b2431a20c24bc103b5e85f385620.png" alt="App Folder Structure" srcset="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure-2.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure-2-300x196.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/06/app-folder-structure-2.png"/></noscript>
<p>在这个例子中，在根级别创建了一个<code>layout.js</code>文件，也就是在<code>app</code>文件夹中。该布局自动应用于应用程序中的任何路线。</p>
<p>这个应用程序也有两个部分:仪表板和支持。因为每个都有自己的样式，所以会创建一个<code>layout.js</code>文件来为它们的路线应用特定的样式。在根布局之上，这意味着<code>/dashboard</code>下的任何路线都将接收应用程序的布局和仪表板的布局。</p>
<p>因此，<code>pages.js</code>不再需要指定它使用的布局，因为它是由<code>layout.js</code>文件自动完成的。</p>
<p>与 Next.js 目前的路由器相反，它只允许你在页面级别获取数据，你也可以从布局中获取数据。您将能够使用<code>getStaticProps</code>和<code>getServerProps</code>来检索数据并构建您的布局。</p>
<p>因此，您的<code>/dashboard</code>页面将能够从多个组件(应用程序的布局、仪表板的布局和页面本身)获取数据。</p>
<h2>结论</h2>
<p>我们已经快速浏览了 Next.js 当前路由器的工作方式及其局限性。然后，我们发现 Next.js 的新路由器带来了一些最大的变化，包括嵌套布局和新的子树导航。</p>
<p>接下来还有更多。该 RFC 包括考虑 React 18 的新特性和服务器组件的更改。因此，我强烈建议你查看 RFC 以获得完整的要点:<a href="https://github.com/vercel/next.js/discussions/37136" target="_blank" rel="noopener">https://github.com/vercel/next.js/discussions/37136</a>。</p>
<p>Next.js 团队还计划在未来发表一篇博文，介绍更先进的路由技术。所以，敬请期待！</p><div class="code-block code-block-30">
<div class="blog-plug inline-plug next-plug"><h2><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank"> LogRocket </a>:全面了解生产 Next.js 应用</h2><p>调试下一个应用程序可能会很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪状态、自动显示 JavaScript 错误、跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-lazy-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/></noscript></a><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><p>LogRocket 就像是网络和移动应用的 DVR，记录下你的 Next.js 应用上发生的一切。您可以汇总并报告问题发生时应用程序的状态，而不是猜测问题发生的原因。LogRocket 还可以监控应用程序的性能，报告客户端 CPU 负载、客户端内存使用等指标。</p><p>LogRocket Redux 中间件包为您的用户会话增加了一层额外的可见性。LogRocket 记录 Redux 存储中的所有操作和状态。</p><p>让您调试 Next.js 应用的方式现代化— <a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>