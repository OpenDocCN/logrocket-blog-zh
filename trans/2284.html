<html>
<head>
<title>How to develop, test, and deploy smart contracts using Ganache - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何使用 Ganache - LogRocket 博客开发、测试和部署智能合约</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/develop-test-deploy-smart-contracts-ganache/#0001-01-01">https://blog.logrocket.com/develop-test-deploy-smart-contracts-ganache/#0001-01-01</a></blockquote><div><article class="article-post">
<p>开发、测试和部署智能合约是区块链开发人员的一项重要工作，本教程将向您展示如何开始使用智能合约。</p>
<p>在我们开始之前，理解加密和区块链的基本概念是很重要的。如果你不熟悉 crypto，我推荐你看这个简短的视频。</p>
<h2>什么是智能合同？</h2>
<p>智能合约是存储在区块链上的不可变程序。它们根据满足的预定条件自动执行交易，并广泛用于以分散的方式执行协议，无需中间人。</p>
<p>智能契约具有特定的结果，这些结果由不可变的代码控制，因此契约的参与者可以对契约的执行充满信心。没有第三方的参与，没有时间损失—当条件满足时，立即执行协议。</p>
<p>智能合约可以部署在区块链上使用。以太坊支持用<a href="https://docs.soliditylang.org/en/v0.8.9/" target="_blank" rel="noopener"> Solidity 编程语言</a>编写的智能合约。</p>
<h2>先决条件</h2>
<p>本教程使用 JavaScript 和 Solidity 在以太坊区块链上开发、测试和部署智能合约。</p>
<p>所以，你需要 JavaScript、Node.js 和 Solidity 的基础知识。</p>
<p>可靠性类似于 JavaScript，所以概念相当容易理解。</p>
<h2>设置项目</h2>
<p>本教程将会非常简单。<a href="https://github.com/KumarAbhirup/truffle-tutorial" target="_blank" rel="noopener">查看这个 GitHub repo </a>来看看本教程中的代码。</p>
<p>我们将使用这些工具来开发和测试智能合同:</p>

<h3>初始化松露</h3>
<p>Truffle 为您提供了开发和测试智能合约的所有必要工具。你可以用<code>truffle init</code>初始化一个 Truffle 项目。</p>
<pre>$ truffle init

✔ Preparing to download
✔ Downloading
✔ Cleaning up temporary files
✔ Setting up box

Unbox successful. Sweet!

Commands:

  Compile:        truffle compile
  Migrate:        truffle migrate
  Test contracts: truffle test

$ ~
</pre>
<p>这将创建一个新的项目，包含三个文件夹(<code>/contracts</code>、<code>/migrations</code>和<code>/tests</code>)和一个配置文件<code>truffle-config.js</code>。</p>
<h3>创建 Ganache 以太坊区块链实例</h3>
<p>下载完 Ganache 之后，快速启动一个区块链实例。您应该会看到这样的屏幕:</p>
<p><img data-attachment-id="73222" data-permalink="https://blog.logrocket.com/develop-test-deploy-smart-contracts-ganache/ganache-dashboard/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/ganache-dashboard.jpeg" data-orig-size="730,507" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Ganache dashboard" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/ganache-dashboard-300x208.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/ganache-dashboard.jpeg" decoding="async" class="aligncenter size-full wp-image-73222 jetpack-lazy-image" src="../Images/8ff0541dac4ac5a80cc2c2e1adced17e.png" alt="Ganache Dashboard" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/ganache-dashboard.jpeg 730w, https://blog.logrocket.com/wp-content/uploads/2021/10/ganache-dashboard-300x208.jpeg 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/ganache-dashboard.jpeg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/ganache-dashboard.jpeg"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="73222" data-permalink="https://blog.logrocket.com/develop-test-deploy-smart-contracts-ganache/ganache-dashboard/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/10/ganache-dashboard.jpeg" data-orig-size="730,507" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Ganache dashboard" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/10/ganache-dashboard-300x208.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/10/ganache-dashboard.jpeg" decoding="async" loading="lazy" class="aligncenter size-full wp-image-73222" src="../Images/8ff0541dac4ac5a80cc2c2e1adced17e.png" alt="Ganache Dashboard" srcset="https://blog.logrocket.com/wp-content/uploads/2021/10/ganache-dashboard.jpeg 730w, https://blog.logrocket.com/wp-content/uploads/2021/10/ganache-dashboard-300x208.jpeg 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/ganache-dashboard.jpeg"/></noscript>
<p>检查<strong> RPC 服务器</strong>配置中的端口。，一般是<code>7545</code>。现在，在<code>truffle-config.js</code>中进行以下更改，并填写正确的端口号:</p>
<pre>module.exports = {
  networks: {
    development: {
     host: "127.0.0.1",     // Localhost (default: none)
     port: 7545,            // Standard Ethereum port (default: none)
     network_id: "*"        // Any network (default: none)
    }
  }
}
</pre>
<p>现在，运行<code>truffle migrate</code>。如果它没有抛出任何错误，您就可以开始了。</p>
<h3>撰写智能合同</h3>
<p>合同将存储在<code>/contracts</code>文件夹下。你会发现这里已经有<code>migrations.sol</code>了。</p>
<p>在目录中创建一个名为<code>TruffleTutorial.sol</code>的新文件:</p>
<pre>pragma solidity &gt;=0.4.22 &lt;0.9.0;

contract TruffleTutorial {
  address public owner = msg.sender;
  string public message;

  // this function runs when the contract is deployed
  constructor() public {
    // set initial message
    message = "Hello World!";
  }

  modifier ownerOnly() {
    require(
      msg.sender == owner,
      "This function is restricted to the contract's owner"
    );
    _;
  }

  // function that only contract owner can run, to set a new message
  function setMessage(string memory _message) 
    public 
    ownerOnly 
    returns(string memory) 
  {
    // message must not be empty
    require(bytes(_message).length &gt; 0);

    // set new message
    message = _message;
    return message;
  }
}
</pre>
<p>请注意，这是名为<code>TruffleTutorial</code>的智能契约。您可以检查代码中的注释，以了解每个函数和代码行的作用，但我将在这里解释要点。</p>
<p>此智能合约存储一条消息，并且只允许智能合约的所有者更改此消息。该合同还允许区块链上的每个人都能阅读这条消息。当第一次部署协定时，智能协定中存储在区块链上的消息将是“Hello World！”。</p>
<blockquote><p>你也可以在 remix.ethereum.org 上快速测试智能合约。</p></blockquote>
<h3>将智能合约部署到 Ganache 以太坊本地测试网络</h3>
<p>现在，让我们将这个智能契约部署到由 Ganache 本地测试网络启动的区块链实例。</p>
<p>如果您以前使用过 MySQL 或 Postgres 之类的数据库，我假设您熟悉迁移。</p>
<p>在<code>/migrations</code>文件夹中，您将看到初始迁移。您必须为这个新的智能合约创建一个新的迁移文件。</p>
<p>创建<code>2_TruffleTutorial_migration.js</code>。</p>
<pre>// Help Truffle find `TruffleTutorial.sol` in the `/contracts` directory
const TruffleTutorial = artifacts.require("TruffleTutorial");

module.exports = function(deployer) {
  // Command Truffle to deploy the Smart Contract
  deployer.deploy(TruffleTutorial);
};
</pre>
<p>您可能想知道<code>artifacts</code>和<code>deployer</code>函数是什么。它们由松露照顾。当您运行<code>truffle migrate</code>时，它会查看<code>/migrations</code>目录，并将所有链接的智能合同部署到区块链，就像迁移文件告诉它们的那样。</p><div class="code-block code-block-54">
<hr/>
<h3>更多来自 LogRocket 的精彩文章:</h3>

<hr/></div>
<p>当您用这段代码创建文件时，只需运行<code>truffle migrate</code> <code>--reset</code>，这将把智能合同部署到本地测试网络。它还将构建以太坊虚拟机能够理解的 ABI 和字节码文件。</p>
<h3>与部署的智能合约交互</h3>
<p>现在你的智能合约在区块链上，你如何与之互动？如何检索消息，如何设置消息？松露控制台让我们做到了这一点。</p>
<blockquote><p>更容易与智能合同交互的 GUI 方法是通过<a href="https://remix.ethereum.org/" rel="nofollow">https://remix.ethereum.org/</a>。</p></blockquote>
<p>在终端中，代码<code>truffle console</code>，它启动一个控制台，使您能够与智能合约进行交互。</p>
<pre>$ truffle console
truffle(development)&gt; const truffleTutorial = await TruffleTutorial.deployed()
truffle(development)&gt; const address = await truffleTutorial.address
truffle(development)&gt; address
'0x46C00D73bF785000B3c3F93569E84415AB2381f2'
</pre>
<p>尝试所有这些线路，看看你是否得到地址。如果您这样做了，智能协定就成功部署了，并且您的项目可以与它对话。</p>
<p>现在尝试将消息存储在智能合约中:</p>
<pre>truffle(development)&gt; const message = await truffleTutorial.message()
truffle(development)&gt; message
'Hello World!'
</pre>
<p>您现在可以读取存储在智能合约上的值了！</p>
<p>让我们尝试设置一条新消息。</p>
<pre>truffle(development)&gt; await truffleTutorial.setMessage('Hi there!')
truffle(development)&gt; await truffleTutorial.message()
'Hi there!'
</pre>
<p>就这样，你做到了！智能合同有效！</p>
<p>不过，我们手动测试了这个。理想情况下，您会希望设置自动测试来检查所有这些是否都完美地工作。</p>
<h3>测试智能合约</h3>
<p>您将在<code>/test</code>文件夹中编写测试。在那里创建一个名为<code>TruffleTutorial.js</code>的新文件。</p>
<pre>const { assert } = require("chai")

const TruffleTutorial = artifacts.require("./TruffleTutorial.sol")

require("chai")
  .use(require("chai-as-promised"))
  .should()

contract('TruffleTutorial', ([contractOwner, secondAddress, thirdAddress]) =&gt; {
  let truffleTutorial

  // this would attach the deployed smart contract and its methods 
  // to the `truffleTutorial` variable before all other tests are run
  before(async () =&gt; {
    truffleTutorial = await TruffleTutorial.deployed()
  })

  // check if deployment goes smooth
  describe('deployment', () =&gt; {
    // check if the smart contract is deployed 
    // by checking the address of the smart contract
    it('deploys successfully', async () =&gt; {
      const address = await truffleTutorial.address

      assert.notEqual(address, '')
      assert.notEqual(address, undefined)
      assert.notEqual(address, null)
      assert.notEqual(address, 0x0)
    })

    // check if the message is stored on deployment as expected
    it('has a message', async () =&gt; {
      const message = await truffleTutorial.message()
      assert.equal(message, 'Hello World!')
    })
  })

  describe('message', () =&gt; {
    // check if owner can set new message, check if setMessage works
    it('contract owner sets a message', async () =&gt; {
      // set new message
      await truffleTutorial.setMessage('Hi there!', { from: contractOwner }) 
      // `from` helps us identify by any address in the test

      // check new message
      const message = await truffleTutorial.message()
      assert.equal(message, 'Hi there!')
    })

    // make sure only owner can setMessage and no one else
    it('address that is not the owner fails to set a message', async () =&gt; {
      await truffleTutorial.setMessage('Hi there!', { from: secondAddress })
        .should.be.rejected
      // this tells Chai that the test should pass if the setMessage function fails.

      await truffleTutorial.setMessage('Hi there!', { from: thirdAddress })
        .should.be.rejected
    })
  })
})
</pre>
<p>这里，我们使用<a href="https://www.chaijs.com/" target="_blank" rel="noopener"> Chai </a>测试框架来断言值，并查看它们是否成立。如果您看到代码，您将意识到它与您在 Truffle 控制台中尝试的类似，只是这次您将这些代码行与 Chai 测试框架配对。</p>
<blockquote><p>接受两个参数，如果匹配，测试通过，否则测试失败。</p></blockquote>
<p>现在，运行<code>truffle test</code>。您应该看到所有测试都通过了:</p>
<pre>$ truffle test
Using network 'development'.

  Contract: TruffleTutorial
    deployment
      ✓ deploys successfully
      ✓ has a message (236ms)
    message
      ✓ contract owner sets a message (165ms)
      ✓ address that is not the owner fails to set a message (250ms)

  4 passing (735ms)
</pre>
<p>现在，您已经使用 Truffle 和 Ganache 开发、测试和部署了智能契约。</p>
<h3>额外收获:将智能合同部署到以太坊主网</h3>
<blockquote><p>注意，在以太坊主网上部署将需要你支付一些油费。此外，每次你在区块链上写东西(例如，当执行<code>setMessage</code>函数时)，它会花费你汽油费，但是阅读智能合同仍然是免费的。</p></blockquote>
<p>首先，安装<a href="https://metamask.io/" target="_blank" rel="noopener">元掩码</a>浏览器扩展。现在，参观 https://remix.ethereum.org 的<a href="https://remix.ethereum.org" rel="nofollow"/>。</p>
<p>在这里，创建或编辑现有项目——在<code>/contracts</code>文件夹中创建<code>TruffleTutorial.sol</code>,并将所有智能合同代码粘贴到那里。</p>
<p>在侧边栏中，您应该看到一个选项来切换侧边栏中的<strong> SOLIDITY 编译器</strong>窗格。单击它并编译 solidity 智能合同代码。它应该创建 ABI 和字节码文件。</p>
<p>编译完成后，从侧边栏打开<strong>部署&amp;运行事务</strong>窗格。您可以尝试在 Remix 以太坊测试 JavaScript VM 网络上部署智能合约。您也可以在同一个面板中使用混音工具本身进行手动测试。</p>
<p>现在是时候部署到 Mainnet 了。首先，确保你的 Metamask 钱包里有一些以太币余额，这样你就可以支付汽油费了。我通常在我的 coinbase 钱包里放大约 50 美元的$ETH，然后将$ETH 转移到 Metamask 钱包。</p>
<p>在<strong>部署&amp;运行事务</strong>窗格中，设置<code>JavaScript VM</code>到<code>Injected Web3</code>的“环境”。当你这样做时，你将把你的元掩码钱包连接到主网。最后点击<strong>部署</strong>。你必须与 Metamask 签署一项交易，但一旦完成，你的<code>TruffleTutorial</code>智能合同将被部署！</p>
<blockquote><p>确保在部署智能合约后检查智能合约地址，以便其他客户端可以使用该地址与您的智能合约进行对话。</p></blockquote>
<h2>结论</h2>
<p>Web3 正在蓬勃发展，这个空间是新的和令人兴奋的。智能合约是大多数 Dapps(去中心化应用程序)的后端，如果你想成为一名区块链开发者，学习如何开发、测试和部署它们将是有用的。</p><div class="code-block code-block-26">
<div class="blog-plug inline-plug blockchain-plug"><h2>加入像 Bitso 和 Coinsquare 这样的组织，他们使用 LogRocket 主动监控他们的 Web3 应用</h2><p>影响用户在您的应用中激活和交易的能力的客户端问题会极大地影响您的底线。如果您对监控 UX 问题、自动显示 JavaScript 错误、跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a target="_blank" href="https://lp.logrocket.com/blg/web3-signup">try LogRocket</a><p>.</p><a class="signup" href="https://lp.logrocket.com/blg/web3-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/dacb06c713aec161ffeaffae5bd048cd.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/dacb06c713aec161ffeaffae5bd048cd.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png"/></noscript></a><a href="https://lp.logrocket.com/blg/web3-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用的 DVR，记录你的网络应用或网站上发生的一切。您可以汇总和报告关键的前端性能指标，重放用户会话和应用程序状态，记录网络请求，并自动显示所有错误，而不是猜测问题发生的原因。</p><p>现代化您调试 web 和移动应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/web3-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>