<html>
<head>
<title>A guide to React Native’s AsyncStorage - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>React Native 的 AsyncStorage - LogRocket 博客指南</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/guide-react-natives-asyncstorage/#0001-01-01">https://blog.logrocket.com/guide-react-natives-asyncstorage/#0001-01-01</a></blockquote><div><article class="article-post">
<p><code>AsyncStorage</code>是 React Native 中的一个数据存储系统，它是不加密的、异步的，允许用户在 React Native 应用程序中离线保存数据。</p>
<p>由于<code>AsyncStorage</code>是未加密的，存储的数据不会被转换成代码或加密以防止未经授权的访问，这意味着任何人都可以通过您的设备轻松获取数据。</p>
<p>然而，由于它是未加密的，从<code>AsyncStorage</code>获取或检索数据更容易，并且不涉及任何进一步的解密。</p>
<p><code>AsyncStorage</code>也是异步的，这意味着它的方法与你的代码的其余部分同时运行，并且它是持久的，这意味着即使你注销或重启应用程序，存储的数据也总是全局可用的。</p>
<p>这允许您使用和访问来自任何 React 本地组件的数据，并提高应用程序的性能和体验，因为从<code>AsyncStorage</code>存储和检索数据不会影响其他代码的运行。</p>
<p><code>AsyncStorage</code>就像 web 中的<code>localStorage</code>，像<code>localStorage</code>一样使用键值对持久化数据。如果你以前用过<code>localStorage</code>和<code>sessionStorage</code>，那么<code>AsyncStorage</code>会很熟悉，很好用。</p>
<p>在本文中，我们将涵盖<code>AsyncStorage</code>如何工作、<code>AsyncStorage</code>的重要性、用例，以及如何使用<code>AsyncStorage</code>方法与数据存储系统交互，包括:</p>

<h2 id="how-asyncstorage-works"><code>AsyncStorage</code>如何工作</h2>
<p>只接受和存储字符串数据，所以如果数据不是字符串，我们必须在存储之前序列化它。这意味着在存储之前，我们必须先将其转换为字符串数据；这里，键和值都是字符串。</p>
<p>为了将我们想要保存的对象转换成字符串，我们使用<code>JSON.stringify()</code>。在我们从存储中取回数据的情况下，我们使用<code>JSON.parse()</code>将其转换回 object:</p>
<pre class="language-javascript hljs">// storing data
const storeUser = async (value) =&gt; {
  try {
    await AsynStorage.setItem("user", JSON.stringify(value));
  } catch (error) {
    console.log(error);
  }
};

// getting data
const getUser = async () =&gt; {
  try {
    const userData = JSON.parse(await AsynStorage.getItem("user"))
  } catch (error) {
   console.log(error); 
  }
};
</pre>
<p>有很多场景可以使用<code>AsyncStorage</code>，比如存储主题数据或者存储离线数据。</p>
<p>但是，不建议将敏感信息存储在<code>AsyncStorage</code>中，因为这对敏感信息不安全。这是因为任何能接触到你手机的人都可以读取储存在你手机文档文件系统中的数据。</p>
<h2 id="how-to-install-asyncstorage">如何安装<code>AsyncStorage</code></h2>
<p>在使用<code>AsyncStorage</code>之前，我们必须先安装<code>AsyncStorage</code>包。要安装该软件包，请打开您的终端并运行以下任何命令:</p>
<pre class="language-bash hljs">#using npm
npm install @react-native-async-storage/async-storage

#using yarn
yarn add @react-native-async-storage/async-storage
</pre>
<p>之后，您可以将它导入到您想要使用的 React Native 的任何组件中。只需从模块中导入它，然后调用任何方法:</p>
<pre class="language-javascript hljs">// React Native component

import AsyncStorage from '@react-native-async-storage/async-storage';
</pre>
<h2 id="asyncstorage-methods"><code>AsyncStorage</code>方法</h2>
<p><code>AsyncStorage</code>方法有几种与 React Native <code>async</code>数据存储系统工作或交互的方式。它们为开发人员提供了在存储系统中执行操作的方法。</p>
<p>我们可以用<code>AsyncStorage</code> : <code>Set</code>、<code>Get</code>和<code>Delete</code>执行三个主要动作:</p>
<ul>
<li><code>Set</code>使用键值对在<code>async</code>存储器中设置或存储数据</li>
<li><code>Get</code>使用密钥从<code>async</code>存储器中获取数据值</li>
<li><code>Delete</code>使用键删除特定的一段或多段数据</li>
</ul>
<p>没有这些方法，我们无法用<code>AsycnStorage</code>执行这些操作。这些方法包括:</p>
<ol>
<li><code>setItem()</code></li>
<li><code>getItem()</code></li>
<li><code>mergeItem()</code></li>
<li><code>removeItem()</code></li>
<li><code>multiGet()</code></li>
<li><code>clear()</code></li>
</ol>
<p>因为<code>AsyncStorage</code>使用键和值来存储数据，所以键是我们想要存储数据的名称，而值是我们存储的数据。</p>
<h3 id="using-the-setitem-method">使用<code>setItem()</code>方法</h3>
<p><code>setItem</code>方法将数据保存到<code>AsyncStorage</code>并允许一个键和值。这里，键是数据或值被分配到的字符串:</p>
<pre class="language-javascript hljs">// React Native component

const value = {
    name: "Chimezie",
    job: "Software Developer"
  };

  const storeUser = async () =&gt; {
    try {
      await AsyncStorage.setItem("user", JSON.stringify(value));
    } catch (error) {
      console.log(error);
    }
  };
</pre>
<p><code>value</code>对象是我们想要保存的数据。为了保存它，我们必须首先序列化它，因为<code>AsyncStorage</code>只存储字符串，我们可以使用<code>JSON.stringify()</code>来序列化它。</p>
<h3 id="using-the-getitem-method">使用<code>getItem()</code>方法</h3>
<p><code>getItem()</code>方法允许我们通过使用保存数据的密钥从<code>AsyncStorage</code>取回数据。</p>
<p>例如，假设我们使用<code>setItem</code>保存了上面的数据，我们使用键<code>"user"</code>接收数据:</p>
<pre class="language-javascript hljs">// React Native component

const getUser = async () =&gt; {
    try {
      const savedUser = await AsyncStorage.getItem("user");
      const currentUser = JSON.parse(savedUser);
      console.log(currentUser);
    } catch (error) {
      console.log(error);
    }
  };
</pre>
<h3 id="using-the-mergeitem-method">使用<code>mergeItem()</code>方法</h3>
<p><code>mergeItem</code>方法通过用新值替换一个值来修改或合并一个键下的现有值:</p>
<pre class="language-javascript hljs">// React Native component

const value = {
    name: "Innocent"
  };

const mergeUser = async () =&gt; {
    try {
      await AsyncStorage.mergeItem("user", JSON.parse(value));
    } catch (error) {
      console.log(error);
    }
  };
</pre>
<p>在上面的场景中，<code>AsyncStorage</code>中的<code>value</code>将被替换为这个新值<code>"Innocent"</code>。</p>
<h3 id="using-the-removeitem-method">使用<code>removeItem()</code>方法</h3>
<p><code>removeItem()</code>方法通过使用键删除存储的数据来从<code>AsyncStorage</code>中删除数据:</p>
<pre class="language-javascript hljs">// React Native component

const removeUser = async () =&gt; {
    try {
      await AsyncStorage.removeItem("user");
    } catch (error) {
      console.log(error);
    }
  };
</pre>
<h3 id="using-the-clear-method">使用<code>clear()</code>方法</h3>
<p><code>clear</code>方法从<code>AsyncStorage</code>中删除所有数据。它不需要密钥，因为它会删除所有存储的数据:</p>
<pre class="language-javascript hljs">// React Native component

const removeData = async () =&gt; {
    try {
      const savedUser = await AsyncStorage.clear();
    } catch (error) {
      console.log(error);
    }
  };
</pre>
<h3 id="using-the-multiget-method">使用<code>multiGet()</code>方法</h3>
<p>顾名思义，<code>multiGet</code>方法从<code>AsyncStorage</code>获取多条数据，并返回一个键值对数组。</p>
<p>如果我们在存储系统中有多条数据，比如存储<code>city</code>和<code>user</code>数据，我们可以通过使用<code>multiGet</code>方法获得这两条数据:</p>
<pre class="language-javascript hljs"> // React Native component

 const getMultipleData = async () =&gt; {
    try {
      const savedData = await AsyncStorage.multiGet(["city", "user"]);
      console.log(savedData);
    } catch (error) {
      console.log(error);
    }
  };
</pre>
<p>从这里，它返回两个数据的数组:<code>city</code>和<code>user</code>以及键和值。</p>
<p><img data-attachment-id="97389" data-permalink="https://blog.logrocket.com/guide-react-natives-asyncstorage/attachment/image-of-the-returned-data/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-returned-data.png" data-orig-size="652,93" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Image of the returned data" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-returned-data-300x43.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-returned-data.png" decoding="async" class="aligncenter size-full wp-image-97389 jetpack-lazy-image" src="../Images/ac1c1dc61e0ddc24846c74c9e465d7af.png" alt="Image Of The Returned Data" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-returned-data.png 652w, https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-returned-data-300x43.png 300w" data-lazy-sizes="(max-width: 652px) 100vw, 652px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-returned-data.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-returned-data.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="97389" data-permalink="https://blog.logrocket.com/guide-react-natives-asyncstorage/attachment/image-of-the-returned-data/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-returned-data.png" data-orig-size="652,93" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Image of the returned data" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-returned-data-300x43.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-returned-data.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-97389" src="../Images/ac1c1dc61e0ddc24846c74c9e465d7af.png" alt="Image Of The Returned Data" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-returned-data.png 652w, https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-returned-data-300x43.png 300w" sizes="(max-width: 652px) 100vw, 652px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-returned-data.png"/></noscript>
<h3 id="using-the-multiset-method">使用<code>multiSet()</code>方法</h3>
<p>这个方法一次存储多个键值对。<code>multiSet</code>方法接受并在数组中存储数据。</p>
<p>例如，如果我们想要存储多个不相关的数据，如<code>places</code>和<code>food</code>，我们可以使用<code>multiSet</code>方法来实现:</p>
<pre class="language-javascript hljs">// React Native component

 const places = {
    name: "Abuja",
    country: "Nigeria"
  };

  const food = {
    name: "Spaghetti Pasta"
  };

  const firstData = ["places", JSON.stringify(places)];
  const secondData = ["food", JSON.stringify(food)];

  const storeMultipleData = async () =&gt; {
    try {
      await AsyncStorage.multiSet([firstData, secondData]);
    } catch (error) {
      console.log(error);
    }
  };
</pre>
<p><code>places</code>和<code>food</code>是我们要存储的两个对象。因此，我们用键值对将它们分配给不同的数组。另外，请注意，在将对象解析到<code>multiSet</code>数组之前，我们对其进行了字符串化。这是因为<code>AsyncStorage</code>除了字符串不接受任何东西。</p>
<p><img data-attachment-id="97391" data-permalink="https://blog.logrocket.com/guide-react-natives-asyncstorage/attachment/image-of-the-stored-data/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-stored-data.png" data-orig-size="540,105" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Image of the stored data" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-stored-data-300x58.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-stored-data.png" decoding="async" class="aligncenter size-full wp-image-97391 jetpack-lazy-image" src="../Images/d2d6700170b95a7b07a8aefdc91bcd2a.png" alt="Image Of The Stored Data" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-stored-data.png 540w, https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-stored-data-300x58.png 300w" data-lazy-sizes="(max-width: 540px) 100vw, 540px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-stored-data.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-stored-data.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="97391" data-permalink="https://blog.logrocket.com/guide-react-natives-asyncstorage/attachment/image-of-the-stored-data/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-stored-data.png" data-orig-size="540,105" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Image of the stored data" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-stored-data-300x58.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-stored-data.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-97391" src="../Images/d2d6700170b95a7b07a8aefdc91bcd2a.png" alt="Image Of The Stored Data" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-stored-data.png 540w, https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-stored-data-300x58.png 300w" sizes="(max-width: 540px) 100vw, 540px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/image-of-the-stored-data.png"/></noscript>
<h3 id="using-the-multimerge-method">使用<code>multiMerge()</code>方法</h3>
<p><code>multiMerge</code>方法将多条现有数据与新数据合并，并以批处理方式完成:</p>
<pre class="language-javascript hljs">// React Native component

 const places = {
    name: "Mumbai",
    country: "India"
  };

  const food = {
    name: "Rice"
  };

  const firstData = ["places", JSON.stringify(places)];
  const secondData = ["food", JSON.stringify(food)];

  const mergeMultiData = async () =&gt; {
    try {
      await AsyncStorage.multiMerge([firstData, secondData]);
    } catch (error) {
      console.log(error);
    }
  };
</pre>
<h3 id="using-the-multiremove-method">使用<code>multiRemove()</code>方法</h3>
<p>此方法通过使用键数组批量删除数据来移除或删除多个键值对。</p>
<p>让我们删除上面创建的两个数组，即<code>places</code>和<code>food</code>数据:</p>
<pre class="language-javascript hljs">// React Native component

  const multiRemoveData = async () =&gt; {
    try {
      await AsyncStorage.multiRemove(["places", "food"]);
    } catch (error) {
      console.log(error);
    }
  };
</pre>
<h2 id="conclusion">结论</h2>
<p>如上所述，不建议使用<code>AsyncStorage</code>来存储敏感数据，如 API 密钥、令牌、用户详细信息等，因为它们很容易被访问。然而，一个好的主要用例是使用<code>AsyncStorage</code>存储主题。</p>
<p>黑暗主题如今在应用程序中非常普遍，并受到用户的广泛赞赏。当用户选择黑暗模式作为首选主题时，保存数据的更好方法是将数据存储在<code>AsyncStorage</code>中，这样用户就不需要在登录时持续选择它。</p>
<p>存储并持久化数据，这样即使在用户注销并重新登录后，持久化的数据(在这种情况下，是黑暗主题)仍然可用。</p>
<p>作为开发人员，你需要做的只是检查数据是否存在于数据存储系统中；如果是(意味着黑暗主题存在)，应用程序主题会自动变为黑暗，如果不是，应用程序将使用默认的光明主题打开。</p>
<p>我们现在已经看到了<code>AsyncStorage</code>提供给我们的不同方法，包括如何使用不同的<code>AsyncStorage</code>方法以及我们可以应用它们的用例。希望这篇文章能帮助简化 React Native 的<code>AsyncStorage</code>。感谢您的阅读！</p><div class="code-block code-block-18">
<div class="blog-plug inline-plug react-native-plug"><h2><a href="https://lp.logrocket.com/blg/react-native-signup"> LogRocket </a>:即时重现 React 原生应用中的问题。</h2><a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/110055665562c1e02069b3698e6cc671.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/110055665562c1e02069b3698e6cc671.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/></noscript></a><p><a href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一款 React 原生监控解决方案，可帮助您即时重现问题、确定 bug 的优先级并了解 React 原生应用的性能。</p><p>LogRocket 还可以向你展示用户是如何与你的应用程序互动的，从而帮助你提高转化率和产品使用率。LogRocket 的产品分析功能揭示了用户不完成特定流程或不采用新功能的原因。</p><p>开始主动监控您的 React 原生应用— <a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer">免费试用 LogRocket】。</a></p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>