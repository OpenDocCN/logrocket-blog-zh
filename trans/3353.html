<html>
<head>
<title>Troubleshooting a Next.js app with ESLint - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用ESLint - LogRocket博客对Next.js应用程序进行故障排除</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/troubleshooting-next-js-app-eslint/#0001-01-01">https://blog.logrocket.com/troubleshooting-next-js-app-eslint/#0001-01-01</a></blockquote><div><article class="article-post">
<p>ESLint是一个很棒的工具，它强化了代码风格，并有助于保持代码的整洁。它可以帮助防止错误，并允许我们编写更多可读的代码。除了独立开发人员之外，如果您在团队中工作，使用该工具也将有所帮助，并有助于在跨多个开发人员的项目中保持一定的一致性。</p>
<p>在本文中，我将向您展示如何在一个<a href="https://blog.logrocket.com/tag/nextjs/"> Next.js </a>应用程序中使用ESLint进行设置和故障排除。</p>

<h2 id="setting-up-eslint-next-js">使用Next.js设置ESLint</h2>
<p>在Next.js应用程序中，添加一个名为<code>lint</code>的新脚本，它的值应该是<code>next lint</code>:</p>
<pre class="language-json hljs">"scripts" : {
   ...
   "lint": "next lint"
}
</pre>
<p>现在运行:</p>
<pre class="language-bash hljs">yarn lint
</pre>
<p>您将看到一条消息，说“您希望如何配置ESLint？”我建议使用“严格”，但您可以根据自己的需求选择。</p>
<p><img data-attachment-id="131710" data-permalink="https://blog.logrocket.com/troubleshooting-next-js-app-eslint/attachment/enable-strict-configuration-eslint/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/enable-strict-configuration-eslint.png" data-orig-size="730,611" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="enable-strict-configuration-eslint" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/enable-strict-configuration-eslint-300x251.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/enable-strict-configuration-eslint.png" decoding="async" class="aligncenter wp-image-131710 size-full jetpack-lazy-image" src="../Images/d987ee75b9c4abb971e989232a6a5c40.png" alt="How to enable strict configuration in ESLint" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/enable-strict-configuration-eslint.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/enable-strict-configuration-eslint-300x251.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/enable-strict-configuration-eslint.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/enable-strict-configuration-eslint.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="131710" data-permalink="https://blog.logrocket.com/troubleshooting-next-js-app-eslint/attachment/enable-strict-configuration-eslint/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/enable-strict-configuration-eslint.png" data-orig-size="730,611" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="enable-strict-configuration-eslint" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/enable-strict-configuration-eslint-300x251.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/enable-strict-configuration-eslint.png" decoding="async" loading="lazy" class="aligncenter wp-image-131710 size-full" src="../Images/d987ee75b9c4abb971e989232a6a5c40.png" alt="How to enable strict configuration in ESLint" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/enable-strict-configuration-eslint.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/enable-strict-configuration-eslint-300x251.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/enable-strict-configuration-eslint.png"/></noscript>
<p>您现在会看到已经为您创建了一个新的<code>.eslintrc.json</code>文件。您可以使用该文件自定义规则。</p>
<h2 id="custom-rules-plugins">自定义规则和插件</h2>
<p>使用ESLint时，自定义规则和插件非常重要，因为它们定义了您希望如何构建代码、何时给出警告以及何时给出错误。</p>
<p>首先将<code>.eslintrc.json</code>改名为<code>.eslintrc.js</code>。现在，让我们看看如何应用一些严格的规则来维护良好的代码结构。这是我喜欢使用的ESLint配置:</p>
<pre class="language-js hljs">const prettierConfig = require("./.prettierrc.js");

module.exports = {
  env: {
    browser: true,
    commonjs: true,
    es2021: true,
    node: true,
  },
  extends: [
    "eslint:recommended",
    "plugin:react/recommended",
    "plugin:react-hooks/recommended",
    "plugin:prettier/recommended",
    "plugin:@typescript-eslint/eslint-recommended",
    "plugin:@typescript-eslint/recommended",
    "next/core-web-vitals",
  ],
  parserOptions: {
    ecmaFeatures: {
      jsx: true,
    },
    ecmaVersion: 12,
    sourceType: "module",
  },
  plugins: ["react"],
  rules: {
    // Possible errors
    "no-console": "warn",
    // Best practices
    "dot-notation": "error",
    "no-else-return": "error",
    "no-floating-decimal": "error",
    "no-sequences": "error",
    // Stylistic
    "array-bracket-spacing": "error",
    "computed-property-spacing": ["error", "never"],
    curly: "error",
    "no-lonely-if": "error",
    "no-unneeded-ternary": "error",
    "one-var-declaration-per-line": "error",
    quotes: [
      "error",
      "single",
      {
        allowTemplateLiterals: false,
        avoidEscape: true,
      },
    ],
    // ES6
    "array-callback-return": "off",
    "prefer-const": "error",
    // Imports
    "import/prefer-default-export": "off",
    "sort-imports": [
      "error",
      {
        ignoreCase: true,
        ignoreDeclarationSort: true,
      },
    ],
    "no-unused-expressions": "off",
    "no-prototype-builtins": "off",
    // REACT
    "react/jsx-uses-react": "off",
    "react/react-in-jsx-scope": "off",
    "jsx-a11y/href-no-hash": [0],
    "react/display-name": 0,
    "react/no-deprecated": "error",
    "react/no-unsafe": [
      "error",
      {
        checkAliases: true,
      },
    ],
    "react/jsx-sort-props": [
      "error",
      {
        ignoreCase: true,
      },
    ],
    "react-hooks/rules-of-hooks": "error",
    "react-hooks/exhaustive-deps": 0,
    // Prettier
    // eslint looks for the prettier config at the top level of the package/app
    // but the config lives in the `config/` directory. Passing the config here
    // to get around this.
    "prettier/prettier": ["error", prettierConfig],
  },
  settings: {
    react: {
      version: "detect",
    },
  },
};
</pre>
<p>让我们更详细地检查一下这个文件。</p>
<h2 id="react">反应</h2>
<p>在这里，我使用了<a href="https://www.npmjs.com/package/eslint-plugin-react" target="_blank" rel="noopener"> React </a>和<a href="https://www.npmjs.com/package/eslint-plugin-react-hooks" target="_blank" rel="noopener"> react-hooks </a>插件，因为它带有一些默认配置，也有助于定制代码结构。</p>
<p>你可以设置它来显示错误，比如使用不推荐的/不安全的东西，分类道具等等。要使用它，请添加以下包:</p>
<pre class="language-bash hljs">npm i -D eslint-plugin-react eslint-plugin-react-hooks # npm

yarn add -D eslint-plugin-react eslint-plugin-react-hooks # yarn
</pre>
<p>以下是ESLint React和react-hooks插件将帮助您更快地排除故障的一些示例:</p>
<ul>
<li>有条件地使用钩子</li>
<li>不在useEffect的依赖数组中添加项</li>
<li>在钩子或React组件之外调用钩子</li>
</ul>
<h2 id="formatting">格式化</h2>
<p>格式是一个重要的问题，因为有些人可能不遵循一种风格，这可能会导致进一步的问题，所以这里我们使用更漂亮和更漂亮的插件来确保格式得到保持。</p>
<p>我创建了这个<code>.prettierrc.js</code>文件来添加一些格式选项:</p>
<pre class="language-js hljs">module.exports = {
    arrowParens: 'avoid',
    singleQuote: true,
    trailingComma: 'all',
    tabWidth: 4,
    endOfLine: 'auto',
};
</pre>
<p>你需要安装更漂亮的插件来使用它:</p>
<pre class="language-bash hljs">npm i -D eslint-config-prettier # npm

yarn add -D eslint-config-prettier # yarn
</pre>
<p>如您所见，我还在ESLint配置中添加了排序导入选项。这确保了导入也被正确排序。有一个更漂亮的插件叫做@ trivago/prettle-plugin-sort-imports。</p>
<p>所以，基本上，如果代码没有按照正确的格式格式化或者导入没有排序，那么这个插件就会对你大喊大叫！</p>
<h2 id="typescript">以打字打的文件</h2>
<p>如果您没有传递正确的值或类型，还有另一个用于typescript的ESLint插件，它可以改进键入和一般的键入错误。这也在你使用像<code>any</code>这样不应该使用的类型时给出警告。</p>
<pre class="language-bash hljs">npm i -D @typescript-eslint/eslint-plugin # npm

yarn add -D @typescript-eslint/eslint-plugin # yarn
</pre>
<h2 id="next-js">Next.js</h2>
<p>有一个Next.js团队做的插件，提示你使用更多Next.js的惊艳功能；例如，使用下一个<span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qowz80zsz71ztdz77zfz81z7z72z58dz88za7y3z77zz84zoz81zi3z75zz88z2z122zz78zz65zd"> &lt;图像/ &gt; </span>组件代替普通的<img/><span class=" author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qowz80zsz71ztdz77zfz81z7z72z58dz88za7y3z77zz84zoz81zi3z75zz88z2z122zz78zz65zd">&lt;【img/&gt;</span>。</p>
<p>这也给出了更多类似<code>&lt;Link&gt;</code>的Next.js组件的警告。例如，如果您没有在需要的地方传入passHref，它会警告您应该传入<code>passHref</code>属性。这对<code>_document.tsx</code>文件也有帮助，因为这个文件的一些导入与其他文件不同！</p>
<p>安装:</p>
<pre class="language-bash hljs">npm i eslint-config-next -D # npm

yarn add -D eslint-config-next # yarn
</pre>
<h2 id="general-code-styles">常规代码样式</h2>
<p>我也有一些干净代码的通用规则，比如没有<code>else</code>返回语句，在可能的地方使用<code>const</code>，没有不需要的三元组，如果有控制台日志就给出警告，因为在生产中通常不应该有任何控制台日志。这些确保代码在整个代码库中是一致的。您可以根据自己的喜好增加或减少这个配置！</p>
<h2>结论</h2>
<p>ESLint非常有用，在Next.js中使用它将帮助您和您的团队成员轻松地准备好代码，并轻松地排除错误🚀。这将需要一些时间来适应它，但从长远来看，它肯定会帮助你！</p><div class="code-block code-block-30">
<div class="blog-plug inline-plug next-plug"><h2><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank"> LogRocket </a>:全面了解生产Next.js应用</h2><p>调试下一个应用程序可能会很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪状态、自动显示JavaScript错误、跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-lazy-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/></noscript></a><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><p>LogRocket 就像是网络和移动应用的DVR，记录下你的Next.js应用上发生的一切。您可以汇总并报告问题发生时应用程序的状态，而不是猜测问题发生的原因。LogRocket还可以监控应用程序的性能，报告客户端CPU负载、客户端内存使用等指标。</p><p>LogRocket Redux中间件包为您的用户会话增加了一层额外的可见性。LogRocket记录Redux存储中的所有操作和状态。</p><p>让您调试Next.js应用的方式现代化— <a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>