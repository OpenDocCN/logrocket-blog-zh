<html>
<head>
<title>Creating a custom React Native dropdown - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>创建一个自定义的 React 本地下拉式日志博客</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/creating-custom-react-native-dropdown/#0001-01-01">https://blog.logrocket.com/creating-custom-react-native-dropdown/#0001-01-01</a></blockquote><div><article class="article-post">
<p>有许多第三方 React 本地库为您的应用程序提供下拉菜单，这些功能允许用户从项目列表中选择一个项目来填充表单字段。</p>
<p>但是大多数第三方库实际上是移动术语中所谓的“spinners”。在 Android 上，它们类似于下拉菜单，而在 iOS 上，它们可能看起来像屏幕底部的一个旋转的轮子，也可能有其他配置，这取决于组件中的道具和您使用的 iOS 版本。</p>
<p>在本文中，我们将构建您在 web 开发中可能习惯的下拉列表类型:一个基本的选择表单字段，在 Android 和 iOS 手机上看起来基本相同。</p>
<h2>为 React Native 创建下拉字段</h2>
<p>我使用<a href="https://github.com/expo/create-react-native-app" target="_blank" rel="noopener"> create-react-native-app </a>创建了这个项目。你可以在这里找到 GitHub repo <a href="https://github.com/eristoddle/log-rocket-react-native-dropdown-tutoria" target="_blank" rel="noopener">和</a><a href="https://snack.expo.dev/@eristoddle/react-native-select-dropdown" target="_blank" rel="noopener">世博小吃</a>。这是下拉组件的起点。</p>
<p>它有一个<code>TouchableOpacity</code>按钮，你可以触摸它使下拉菜单可见或不可见，但是现在，显示下拉菜单的功能只显示一些文本。我唯一使用的第三方库是<a href="https://www.npmjs.com/package/react-native-elements" target="_blank" rel="noopener"> react-native-elements </a>，它使得向下拉菜单添加图标变得简单。</p>
<p>注意，只有一个状态变量用于切换可见性，并且<code>dropdown</code>元素的位置是绝对的，所以它在表单的其余部分打开。</p>
<pre>import React, { FC, useState } from 'react';
import { StyleSheet, Text, TouchableOpacity } from 'react-native';
import { Icon } from 'react-native-elements';

interface Props {
  label: string;
}

const Dropdown: FC&lt;Props&gt; = ({ label }) =&gt; {
  const [visible, setVisible] = useState(false);

  const toggleDropdown = () =&gt; {
    setVisible(!visible);
  };

  const renderDropdown = () =&gt; {
    if (visible) {
      return (
          &lt;Text style={styles.dropdown}&gt;
            This is where the dropdown will be rendered.
          &lt;/Text&gt;
      );
    }
  };

  return (
    &lt;TouchableOpacity
      style={styles.button}
      onPress={toggleDropdown}
    &gt;
      {renderDropdown()}
      &lt;Text style={styles.buttonText}&gt;{label}&lt;/Text&gt;
      &lt;Icon type='font-awesome' name='chevron-down'/&gt;
    &lt;/TouchableOpacity&gt;
  );
}

const styles = StyleSheet.create({
  button: {
    flexDirection: 'row',
    alignItems: 'center',
    backgroundColor: '#efefef',
    height: 50,
    width: '90%',
    paddingHorizontal: 10,
    zIndex: 1,
  },
  buttonText: {
    flex: 1,
    textAlign: 'center',
  },
  dropdown: {
    position: 'absolute',
    backgroundColor: '#fff',
    top: 50,
  },
});

export default Dropdown;
</pre>
<p>在这里，我修改了 create-react-native-app 生成的<code>App.tsx</code>文件，使其包含 dropdown 组件和一些打开时可以覆盖的文本，但文件的其余部分保持不变:</p>
<pre>export default function App() {
  return (
    &lt;View style={styles.container}&gt;
      &lt;Dropdown label={'Select Item'} /&gt;
      &lt;Text&gt;This is the rest of the form.&lt;/Text&gt;
      &lt;StatusBar style="auto" /&gt;
    &lt;/View&gt;
  );
}
</pre>
<p>下面是它的实际应用:</p>
<p><img data-attachment-id="81782" data-permalink="https://blog.logrocket.com/creating-custom-react-native-dropdown/dropdown-skeleton/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/12/dropdown-skeleton.gif" data-orig-size="362,143" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Dropdown skeleton" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/12/dropdown-skeleton-300x119.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/12/dropdown-skeleton.gif" decoding="async" class="aligncenter size-full wp-image-81782 jetpack-lazy-image" src="../Images/8b25c3334d6a8ae6661a87386ebc9681.png" alt="Dropdown Skeleton" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/12/dropdown-skeleton.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/12/dropdown-skeleton.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="81782" data-permalink="https://blog.logrocket.com/creating-custom-react-native-dropdown/dropdown-skeleton/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/12/dropdown-skeleton.gif" data-orig-size="362,143" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Dropdown skeleton" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/12/dropdown-skeleton-300x119.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/12/dropdown-skeleton.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-81782" src="../Images/8b25c3334d6a8ae6661a87386ebc9681.png" alt="Dropdown Skeleton" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/12/dropdown-skeleton.gif"/></noscript>
<h2>在 React Native 中创建真正的下拉菜单</h2>
<p>这就是有趣的地方。我们的组件还需要几个道具:一个用于填充下拉列表项的数据，以及一个在选择一项时触发的函数。</p>
<p>这是下拉菜单中道具的新界面:</p>
<pre>interface Props {
  label: string;
  data: Array&lt;{ label: string; value: string }&gt;;
  onSelect: (item: { label: string; value: string }) =&gt; void;
}
</pre>
<h2>为下拉菜单使用模态</h2>
<p>为了创建下拉列表，我们将使用一个<code><a href="https://blog.logrocket.com/deep-dive-react-native-flatlist/" target="_blank" rel="noopener">Flatist</a></code>。它对于这类事情来说很方便，并且具有内置功能，这使得它比<code>ScrollView</code>更具性能。</p>
<p>我们可以单独使用<code>FlatList</code>，除了一个原因。当你点击下拉列表之外的时候，它不会自动关闭，会迫使用户选择一个项目来让它消失。</p>
<p>因此，为了获得我们想要的功能，我们必须将<code>renderDropdown</code>函数改为:</p>
<pre>const renderDropdown = (): ReactElement&lt;any, any&gt; =&gt; {
    return (
      &lt;Modal visible={visible} transparent animationType="none"&gt;
        &lt;TouchableOpacity
          style={styles.overlay}
          onPress={() =&gt; setVisible(false)}
        &gt;
          &lt;View style={[styles.dropdown, { top: dropdownTop }]}&gt;
            &lt;FlatList
              data={data}
              renderItem={renderItem}
              keyExtractor={(item, index) =&gt; index.toString()}
            /&gt;
          &lt;/View&gt;
        &lt;/TouchableOpacity&gt;
      &lt;/Modal&gt;
    );
  };
</pre>
<p>在<code>FlatList</code>上使用的道具数量很少:</p>
<ul>
<li><code>data</code>:用于建立列表的数据</li>
<li><code>renderItem</code>:返回每个项目的组件</li>
<li><code>keyExtractor</code>:设置物品上的按键，以便识别。大多数情况下，您可以复制并粘贴这个相同的函数</li>
</ul>
<p>在代码块中，我们在<code>Modal</code>上设置了<code>transparent</code>道具。这意味着<code>Modal</code>将充满整个屏幕，但是任何没有内容的部分将被透明覆盖。</p>
<p>在<code>Modal</code>内部，我们添加了一个 100%宽和高的<code>TouchableOpacity</code>来覆盖整个覆盖图，这样当点击它时，我们可以将<code>visible</code>设置为<code>false</code>并隐藏<code>Modal</code>。</p>
<p>包装<code>FlatList</code>的<code>View</code>为模态的可见部分设置样式，并且拥有所有元素中最多的样式属性:</p>
<pre>dropdown: {
    position: 'absolute',
    backgroundColor: '#fff',
    width: '100%',
    shadowColor: '#000000',
    shadowRadius: 4,
    shadowOffset: { height: 4, width: 0 },
    shadowOpacity: 0.5,
  },
</pre>
<h2>修改可见性切换功能</h2>
<p>您可能已经注意到，在我们刚刚检查的视图中，样式中的<code>top</code>值是用一个变量设置的。</p>
<p>因为模态覆盖了整个屏幕，下拉菜单在其中有一个绝对位置，我们必须测量按钮在屏幕上的位置，并将这个<code>top</code>值设置为按钮的高度加上它离屏幕顶部的距离。</p>
<p>所以，我们还需要几个常量:</p>
<pre>const DropdownButton = useRef();
const [dropdownTop, setDropdownTop] = useState(0);
</pre>
<p>并将我们创建的引用添加到按钮:</p>
<pre>&lt;TouchableOpacity
  ref={DropdownButton}
  style={styles.button}
  onPress={toggleDropdown}
&gt;
</pre>
<p>当我们将下拉菜单的可见性设置为<code>false</code>时，功能不会改变。但是当我们使下拉菜单可见时，我们从引用中获得按钮的当前实例，并使用元素的<code>measure</code>方法来找到它的高度和它在屏幕上的垂直位置。然后我们将<code>dropdownTop</code>状态变量设置为高度和垂直位置的和。</p>
<pre>const toggleDropdown = (): void =&gt; {
  visible ? setVisible(false) : openDropdown();
};

const openDropdown = (): void =&gt; {
  DropdownButton.current.measure((_fx, _fy, _w, h, _px, py) =&gt; {
    setDropdownTop(py + h);
  });
  setVisible(true);
};
</pre>
<h2>呈现项目</h2>
<p>还记得<code>FlatList</code>的<code>renderItem</code>道具吗？下面是实现这一点的函数:</p>
<pre>const renderItem = ({ item }): ReactElement&lt;any, any&gt; =&gt; (
  &lt;TouchableOpacity style={styles.item} onPress={() =&gt; onItemPress(item)}&gt;
    &lt;Text&gt;{item.label}&lt;/Text&gt;
  &lt;/TouchableOpacity&gt;
);
</pre>
<p>没什么大不了的。我们需要显示标签，并在项目被按下时做一些事情。</p>
<p>下面是<code>onItemPress</code>函数:</p>
<pre> const onItemPress = (item): void =&gt; {
    setSelected(item);
    onSelect(item);
    setVisible(false);
  };
</pre>
<p>第一行设置一个状态变量来跟踪选中的项目。</p>
<pre>const [selected, setSelected] = useState(undefined);
</pre>
<p>然后，当按钮标签存在时，我们使用所选项目来替换它:</p>
<pre>&lt;Text style={styles.buttonText}&gt;
  {(selected &amp;&amp; selected.label) || label}
&lt;/Text&gt;
</pre>
<p>函数中的下一行调用<code>onSelect</code>属性来设置项目。然后，我们隐藏下拉菜单。列表中的每一项都应用了最少量的样式来填充和分隔它们。</p>
<pre>item: {
  paddingHorizontal: 10,
  paddingVertical: 10,
  borderBottomWidth: 1,
},
</pre>
<h2>修改<code>App.tsx</code>文件</h2>
<p>下面是新的<code>App.tsx</code>函数:</p>
<pre>const App: FC = () =&gt; {
  const [selected, setSelected] = useState(undefined);
  const data = [
    { label: 'One', value: '1' },
    { label: 'Two', value: '2' },
    { label: 'Three', value: '3' },
    { label: 'Four', value: '4' },
    { label: 'Five', value: '5' },
  ];

  return (
    &lt;View style={styles.container}&gt;
      {!!selected &amp;&amp; (
        &lt;Text&gt;
          Selected: label = {selected.label} and value = {selected.value}
        &lt;/Text&gt;
      )}
      &lt;Dropdown label="Select Item" data={data} onSelect={setSelected} /&gt;
      &lt;Text&gt;This is the rest of the form.&lt;/Text&gt;
    &lt;/View&gt;
  );
};
</pre>
<p>我们为下拉列表中选中的项目添加了一个状态变量、一些要使用的数据、一个显示选中的<code>Item</code>的<code>Text</code>元素以及下拉列表组件的新道具。结果如下:</p>
<p><img data-attachment-id="81785" data-permalink="https://blog.logrocket.com/creating-custom-react-native-dropdown/final-dropdown/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/12/final-dropdown.gif" data-orig-size="730,755" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Final dropdown" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/12/final-dropdown-290x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/12/final-dropdown.gif" decoding="async" class="aligncenter size-full wp-image-81785 jetpack-lazy-image" src="../Images/c8afd780a234d76423f131efe7da2b2d.png" alt="Final Dropdown" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/12/final-dropdown.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/12/final-dropdown.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="81785" data-permalink="https://blog.logrocket.com/creating-custom-react-native-dropdown/final-dropdown/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/12/final-dropdown.gif" data-orig-size="730,755" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Final dropdown" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/12/final-dropdown-290x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/12/final-dropdown.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-81785" src="../Images/c8afd780a234d76423f131efe7da2b2d.png" alt="Final Dropdown" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/12/final-dropdown.gif"/></noscript>
<h2>结论</h2>
<p>我们创建的下拉组件通常在 Android 或 iOS 上看起来是一样的。它现在非常基础，但是随着主要功能的完成，你可以添加更好的风格和更多的特性。</p>
<p>它确实为下拉图标使用了一个外部库，如果您想要一个自包含的组件，可以很容易地用图像替换它。你可以在这个<a href="https://github.com/eristoddle/log-rocket-react-native-dropdown-tutoria" target="_blank" rel="noopener"> GitHub repo </a>找到这个教程的代码。随意叉一下，添加功能！你也可以在这个<a href="https://snack.expo.dev/@eristoddle/react-native-select-dropdown" target="_blank" rel="noopener">世博小吃</a>中看到它的作用。</p><div class="code-block code-block-18">
<div class="blog-plug inline-plug react-native-plug"><h2><a href="https://lp.logrocket.com/blg/react-native-signup"> LogRocket </a>:即时重现 React 原生应用中的问题。</h2><a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/110055665562c1e02069b3698e6cc671.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/110055665562c1e02069b3698e6cc671.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/></noscript></a><p><a href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一款 React 原生监控解决方案，可帮助您即时重现问题、确定 bug 的优先级并了解 React 原生应用的性能。</p><p>LogRocket 还可以向你展示用户是如何与你的应用程序互动的，从而帮助你提高转化率和产品使用率。LogRocket 的产品分析功能揭示了用户不完成特定流程或不采用新功能的原因。</p><p>开始主动监控您的 React 原生应用— <a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer">免费试用 LogRocket】。</a></p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>