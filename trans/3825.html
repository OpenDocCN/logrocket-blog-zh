<html>
<head>
<title>Using Re.pack for large-scale React Native projects </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>对大型React本地项目使用Re.pack</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/repack-large-scale-react-native-apps/#0001-01-01">https://blog.logrocket.com/repack-large-scale-react-native-apps/#0001-01-01</a></blockquote><div><article class="article-post">
<p>Re.pack是一个基于webpack的工具包，用于构建完全支持webpack生态系统的React原生应用程序，它已经存在了一段时间，通过为React原生应用程序带来代码拆分、模块联合和多捆绑支持，正在解决大规模应用程序的一个大问题。</p>
<p>在本文中，我们将看看Re.pack为React原生应用程序提供了什么，并对其功能进行一个小实验。</p>
<p>向前跳:</p>

<h2 id="bundling-javascript-react-native">绑定JavaScript和React Native</h2>
<p>捆绑器是所有JavaScript应用的基础技术。React原生应用也是如此；随着我们在React Native中开发更复杂的应用程序，有效捆绑大量JavaScript的想法开始出现。</p>
<p>脸书最近投资了“我”<a href="https://facebook.github.io/metro/">tro bundler</a>,并在社区的帮助下取得了显著成效。但是对于服务于几十个具有大量特性的模块的大规模应用程序，需要一个更加动态和特性更加丰富的捆绑器。如果你有webpack，还能去哪里找呢？🙂</p>
<p>Re.pack带来了社区十年来为React Native开发的webpack的所有优点，这意味着我们现在可以利用现代思想，如模块联合和动态代码分割，来开发React Native应用程序。</p>
<h2 id="repack-features">重新打包功能</h2>
<h3 id="better-code-splitting">更好的代码分割</h3>
<p>自从SPAs出现以来，代码分割就一直是人们谈论的话题，当时我们开始提供大量的JavaScript来呈现哪怕是最小的UI。对于React原生app来说，就有点不一样了；在这里，它是关于在主线程上只加载所需的JS，以使我们的应用程序启动更快，并优化内存消耗。尽管React悬疑代码拆分现在对于React应用来说非常简单，但对于RN应用来说仍然是一个麻烦。</p>
<p>Re.pack允许创建基于悬念的应用程序块，每个块只在需要时加载到主线程上。在本文的后面，我们将探讨这个特性的详细实现。</p>
<h3 id="module-federation">模块联盟</h3>
<p>前端工程中最近出现了几种模式，其中最突出的是模块联合——下面是webpack <a href="https://webpack.js.org/concepts/module-federation/">如何定义概念</a> <a href="https://webpack.js.org/concepts/module-federation/"> : </a></p>
<blockquote><p>多个独立的构建应该形成一个应用程序。这些独立的构建就像容器一样，可以在构建之间公开和使用代码，从而创建一个统一的应用程序。</p></blockquote>
<p>这支持跨应用程序的大量代码重用，而无需处理软件包管理的麻烦。Re.pack允许RN应用程序使用本地和远程块的模块联邦，这使得同时向几个应用程序发布错误修复和升级变得非常容易。</p>
<h2 id="plugin-ecosystem">插件生态系统</h2>
<p>在过去的十年中，社区已经为webpack开发了大量的插件，为捆绑领域带来了一些非常酷的想法。为React本地捆绑启用webpack意味着我们可以利用这些插件，并创建更加优化和高效的JS捆绑包。</p>
<p>让我们创建一个小的演示应用程序来测试我们上面讨论的特性。</p>
<h2 id="building-demo-react-native-app">构建我们的演示React本机应用程序</h2>
<h3 id="initializing-react-native-app">初始化我们的React本地应用</h3>
<p>我们将从通过CLI使用TypeScript模板设置React本机应用程序开始:</p>
<pre class="language-typescript hljs">npx react-native init RepackDemo --template react-native-template-typescript</pre>
<h3 id="adding-dependencies">添加依赖关系</h3>
<p>项目启动并运行后，使用以下命令之一将Re.pack相关的依赖项添加到我们的应用程序中:</p>
<pre class="language-javascript hljs">npm i -D @callstack/repack babel-loader swc-loader terser-webpack-plugin webpack @types/react</pre>
<p>或者:</p>
<pre class="language-bash hljs">yarn add -D @callstack/repack babel-loader swc-loader terser-webpack-plugin webpack @types/react</pre>
<h3 id="configuring-commands">配置命令</h3>
<p>使用Re.pack意味着我们正在远离React Native的默认metro bundler，因此默认的<code>react-native start</code>命令不再有用。相反，我们将使用<code>react-native webpack-start</code>来运行我们的JS服务器。</p>
<p>为了使这个命令在React Native中可用，我们必须用以下内容更新我们的<code>react-native.config.js</code>:</p>
<pre class="language-javascript hljs">module.exports = {
 commands: require('@callstack/repack/commands'),
};
</pre>
<p>这将使Re.pack命令<code>react-native webpack-start</code>和<code>react-native webpack-bundle</code>与React Native无缝挂钩。现在，为了让我们的开发更快，我们将把package.json中的<code>start</code>脚本更新为<code>react-native webpack-start</code>:</p>
<pre class="language-javascript hljs">{
  “scripts”: {
    “start”: “react-native webpack-start”
  }
}
</pre>
<h3 id="configuring-webpack">配置webpack</h3>
<p>为了使用我们新的<code>start</code>命令，我们需要一个webpack配置文件。出于演示目的，我们使用现成的配置。您可以根据自己的需求不断深入和更新配置。您可以从我们的演示项目中复制<a href="https://github.com/zsajjad/RepackDemo/blob/main/webpack.config.mjs">这些配置</a>，并将其放在项目根目录下的<code>webpack.config.mjs</code>中。</p>
<h3 id="configure-ios-native">配置iOS原生</h3>
<p>对于发布构建，我们的JavaScript是使用Xcode的构建阶段任务捆绑的。为了在那里重新打包，我们将更新构建阶段。将下面一行添加到<code>Bundle React Native code and images</code>任务:</p>
<pre class="language-javascript hljs">export BUNDLE_COMMAND=webpack-bundle
</pre>
<p><img data-attachment-id="155270" data-permalink="https://blog.logrocket.com/repack-large-scale-react-native-apps/attachment/bundle-react-native-code-images-task-xcode/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-react-native-code-images-task-xcode.png" data-orig-size="730,285" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The bundle React Native code and images task in Xcode" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-react-native-code-images-task-xcode-300x117.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-react-native-code-images-task-xcode.png" decoding="async" class="aligncenter size-full wp-image-155270 jetpack-lazy-image" src="../Images/06e802ce05b02b06a30d839ae5261369.png" alt="The Bundle React Native Code And Images Task In Xcode" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-react-native-code-images-task-xcode.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-react-native-code-images-task-xcode-300x117.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-react-native-code-images-task-xcode.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-react-native-code-images-task-xcode.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="155270" data-permalink="https://blog.logrocket.com/repack-large-scale-react-native-apps/attachment/bundle-react-native-code-images-task-xcode/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-react-native-code-images-task-xcode.png" data-orig-size="730,285" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The bundle React Native code and images task in Xcode" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-react-native-code-images-task-xcode-300x117.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-react-native-code-images-task-xcode.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-155270" src="../Images/06e802ce05b02b06a30d839ae5261369.png" alt="The Bundle React Native Code And Images Task In Xcode" srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-react-native-code-images-task-xcode.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-react-native-code-images-task-xcode-300x117.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-react-native-code-images-task-xcode.png"/></noscript>
<h3 id="configure-android-native">配置Android原生</h3>
<p>就像在iOS应用程序中一样，我们将更新<code>buildCommand</code>来为Android应用程序构建一个命令。</p>
<p>在我们的项目中更新<code>app/build.gradle</code>中的以下行:</p>
<pre class="language-javascript hljs">project.ext.react = [
    enableHermes: true,  // clean and rebuild if changing
    bundleCommand: "webpack-bundle",
]
</pre>
<p>🥳:我们现在准备开始在React Native中利用Re.pack进行JavaScript捆绑。</p>
<h2 id="how-code-splitting-works-repack">代码分割如何与Re.pack一起工作</h2>
<p>让我们开始探索代码分割如何与Re.pack一起工作。重申一下，本地块是应用程序自带的，而远程块是通过网络提供的，不是应用程序构建的一部分。对于我们的例子，我们将创建本地和远程块以获得更好的理解。</p>
<p>这是我们的应用程序回购的样子:</p>
<p><img data-attachment-id="155272" data-permalink="https://blog.logrocket.com/repack-large-scale-react-native-apps/attachment/apps-repo/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/apps-repo.png" data-orig-size="560,649" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Apps’ repo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/apps-repo-259x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/apps-repo.png" decoding="async" class="aligncenter size-full wp-image-155272 jetpack-lazy-image" src="../Images/66fa037704221cc5e31b4b0c1dae0b56.png" alt="Apps' Repo" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/apps-repo.png 560w, https://blog.logrocket.com/wp-content/uploads/2023/01/apps-repo-259x300.png 259w" data-lazy-sizes="(max-width: 560px) 100vw, 560px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/apps-repo.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/apps-repo.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="155272" data-permalink="https://blog.logrocket.com/repack-large-scale-react-native-apps/attachment/apps-repo/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/apps-repo.png" data-orig-size="560,649" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Apps’ repo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/apps-repo-259x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/apps-repo.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-155272" src="../Images/66fa037704221cc5e31b4b0c1dae0b56.png" alt="Apps' Repo" srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/apps-repo.png 560w, https://blog.logrocket.com/wp-content/uploads/2023/01/apps-repo-259x300.png 259w" sizes="(max-width: 560px) 100vw, 560px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/apps-repo.png"/></noscript>
<p>我们创建了两个模块:<code>LocalModule</code>和<code>Remote Module</code>。</p>
<p>这里是我们封装动态加载的<a href="https://www.dropbox.com/paper/ep/redirect/external-link?url=https%3A%2F%2Fgithub.com%2Fzsajjad%2FRepackDemo%2Fblob%2Fmain%2Fsrc%2Fmodules%2FRemoteModule%2Findex.tsx&amp;hmac=1wAChinqucoFoJ5QsRKWZJ%2BEtoUGg9Ahaqe598n5NfE%3D">模块包装器</a>:</p>
<pre class="language-typescript hljs">/**
 * path: src/modules/RemoteModule/index.tsx
 * description:
 *    This is a remote module that is loaded asynchronously.
 *    This file encapsulate React.lazy and React.Suspense over the remote module.
 */
import React from 'react';
import { Text } from '../../components/Text';
const Component = React.lazy(() =&gt; import(/* webpackChunkName: "remoteModule" */ './RemoteModule'));
export default () =&gt; (
  &lt;React.Suspense fallback={&lt;Text&gt;Loading Remote Module...&lt;/Text&gt;}&gt;
    &lt;Component /&gt;
  &lt;/React.Suspense&gt;
);
</pre>
<p>下面是<a href="https://github.com/zsajjad/RepackDemo/blob/main/src/modules/RemoteModule/index.tsx">模块的代码</a>的样子:</p>
<pre class="language-typescript hljs">/**
z * path: src/modules/RemoteModule/RemoteModule.tsx
 * description:
 *   This is a remote module that is loaded asynchronously.
 *   This file is the actual module that is loaded asynchronously.
 */
import React from 'react';
import { useColorScheme, View } from 'react-native';
import { Colors } from 'react-native/Libraries/NewAppScreen';
import { Section } from '../../components/Section';
import { Text } from '../../components/Text';
function RemoteModule() {
  const isDarkMode = useColorScheme() === 'dark';
  return (
    &lt;View
      style={{
        backgroundColor: isDarkMode ? Colors.black : Colors.white,
      }}
    &gt;
      &lt;Section title="Remote Module"&gt;
        &lt;Text&gt;
          This module is loading dynamically for execution and is not shipped with the app. It is a remote module.
        &lt;/Text&gt;
      &lt;/Section&gt;
      &lt;Section title="Details"&gt;
        &lt;Text&gt;
          This will not be part of app's initial bundle size. This will be loaded in app after consuming network
          bandwidth.
        &lt;/Text&gt;
      &lt;/Section&gt;
    &lt;/View&gt;
  );
}
export default RemoteModule;
</pre>
<p>一旦我们的模块准备就绪，我们将设置我们的webpack配置、app配置和根文件，以支持这些模块的动态加载。</p>
<p>在应用程序配置方面，我们将定义我们希望动态加载的模块。对于我们的示例，我们将定义以下模块:</p>
<pre class="language-json hljs">// app.json
{
  "localChunks": ["src_modules_LocalModule_LocalModule_tsx"],
  "remoteChunks": ["src_modules_RemoteModule_RemoteModule_tsx"],
}
</pre>
<p>这里，<code>localChunks</code>是app自带的模块，<code>remoteChunks</code>是动态加载的模块。这些模块被传递给webpack配置，以便能够动态加载这些模块。</p>
<p>在webpack配置方面，我们将为应用程序定义入口点。对于我们的示例，我们将定义以下入口点:</p>
<pre class="language-javascript hljs">// webpack.config.mjs#222
new Repack.RepackPlugin({
  ...
  extraChunks: [
    {
      include: appJson.localChunks,
      type: 'local',
    },
    {
      include: appJson.remoteChunks,
      type: 'remote',
      outputPath: path.join('build/output', platform, 'remote'),
    },
  ],
  ...
}),
</pre>
<p>这里，我们在主包旁边定义了两个额外的块——一个用于本地模块，一个用于远程模块。我们还为远程块定义了一个输出路径。在构建过程结束时，远程块将保存在这里。</p>
<p>在根文件端，我们将定义如何加载这些模块。对于我们的示例，让我们定义以下根文件:</p>
<pre class="language-javascript hljs">// index.js
import { AppRegistry, Platform } from 'react-native';
import { ScriptManager, Script } from '@callstack/repack/client';
import App from './src/App';
import { name as appName, localChunks, remoteChunkUrl, remoteChunkPort } from './app.json';

/**
 * We need to set storage for the ScriptManager to enable caching. This enables us to avoid downloading the same script multiple times.
 */
import AsyncStorage from '@react-native-async-storage/async-storage';
ScriptManager.shared.setStorage(AsyncStorage);

/**
 * We need to set a resolver for the ScriptManager to enable loading scripts from the remote server.
 * The resolver is a function that takes a scriptId and returns a promise that resolves to a script object.
 * The script object has the following shape:
 */
ScriptManager.shared.addResolver(async (scriptId) =&gt; {
  // For development we want to load scripts from the dev server.
  if (__DEV__) {
    return {
      url: Script.getDevServerURL(scriptId),
      cache: false,
    };
  }

  // For production we want to load local chunks from from the file system.
  if (localChunks.includes(scriptId)) {
    return {
      url: Script.getFileSystemURL(scriptId),
    };
  }

  /**
   * For production we want to load remote chunks from the remote server.
   *
   * We have create a small http server that serves the remote chunks.
   * The server is started by the `start:remote` script. It serves the chunks from the `build/output` directory.
   * For customizing server see `./serve-remote-bundles.js`
   */
  const scriptUrl = Platform.select({
    ios: `http://localhost:${remoteChunkPort}/build/output/ios/remote/${scriptId}`,
    android: `${remoteChunkUrl}:${remoteChunkPort}/build/output/android/remote/${scriptId}`,
  });

  return {
    url: Script.getRemoteURL(scriptUrl),
  };
});

/**
 * We can also add a listener to the ScriptManager to get notified about the loading process. This is useful for debugging.
 *
 * This is optional and can be removed.
 */
ScriptManager.shared.on('resolving', (...args) =&gt; {
  console.log('DEBUG/resolving', ...args);
});

ScriptManager.shared.on('resolved', (...args) =&gt; {
  console.log('DEBUG/resolved', ...args);
});

ScriptManager.shared.on('prefetching', (...args) =&gt; {
  console.log('DEBUG/prefetching', ...args);
});

ScriptManager.shared.on('loading', (...args) =&gt; {
  console.log('DEBUG/loading', ...args);
});

ScriptManager.shared.on('loaded', (...args) =&gt; {
  console.log('DEBUG/loaded', ...args);
});

ScriptManager.shared.on('error', (...args) =&gt; {
  console.log('DEBUG/error', ...args);
});

/**
 * We need to register the root component of the app with the AppRegistry.
 * Just like in the default React Native setup.
 */
AppRegistry.registerComponent(appName, () =&gt; App);
</pre>
<p>这使得我们的应用程序可以加载远程模块。我们现在可以运行我们的应用程序并查看结果。因为模块是在调试模式下从开发服务器加载的，所以它与默认设置没有太大的不同。但是在生产模式下，我们可以看到远程模块是在主包旁边创建的，并且是动态加载的。</p>
<p>为了更好地理解，我们创建了一个发布APK，并将其放在Android Studio中的APK分析工具下。我们可以看到本地模块不是主包的一部分，而远程模块不在APK内部；相反，它是在我们应用程序的repo的<code>build/output/android/remote</code>目录中创建的:</p>
<p><img data-attachment-id="155274" data-permalink="https://blog.logrocket.com/repack-large-scale-react-native-apps/attachment/bundle-files-created-under-assets-directory/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-files-created-under-assets-directory.png" data-orig-size="730,290" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Bundle files created under assets directory" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-files-created-under-assets-directory-300x119.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-files-created-under-assets-directory.png" decoding="async" class="aligncenter size-full wp-image-155274 jetpack-lazy-image" src="../Images/37ec78f23ffc95bc30cd2defda800623.png" alt="Bundle Files Created Under Assets Directory" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-files-created-under-assets-directory.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-files-created-under-assets-directory-300x119.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-files-created-under-assets-directory.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-files-created-under-assets-directory.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="155274" data-permalink="https://blog.logrocket.com/repack-large-scale-react-native-apps/attachment/bundle-files-created-under-assets-directory/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-files-created-under-assets-directory.png" data-orig-size="730,290" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Bundle files created under assets directory" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-files-created-under-assets-directory-300x119.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-files-created-under-assets-directory.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-155274" src="../Images/37ec78f23ffc95bc30cd2defda800623.png" alt="Bundle Files Created Under Assets Directory" srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-files-created-under-assets-directory.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-files-created-under-assets-directory-300x119.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/bundle-files-created-under-assets-directory.png"/></noscript>
<p><img data-attachment-id="155277" data-permalink="https://blog.logrocket.com/repack-large-scale-react-native-apps/attachment/remote-bundles-generated-build-folder/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/remote-bundles-generated-build-folder.png" data-orig-size="730,176" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Remote bundles are generated in the build folder" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/remote-bundles-generated-build-folder-300x72.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/remote-bundles-generated-build-folder.png" decoding="async" class="aligncenter size-full wp-image-155277 jetpack-lazy-image" src="../Images/5052614c191cbd98b1fbc893adeb9ece.png" alt="Remote Bundles Are Generated In The Build Folder " data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/remote-bundles-generated-build-folder.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/remote-bundles-generated-build-folder-300x72.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/remote-bundles-generated-build-folder.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/remote-bundles-generated-build-folder.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="155277" data-permalink="https://blog.logrocket.com/repack-large-scale-react-native-apps/attachment/remote-bundles-generated-build-folder/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/remote-bundles-generated-build-folder.png" data-orig-size="730,176" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Remote bundles are generated in the build folder" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/remote-bundles-generated-build-folder-300x72.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/remote-bundles-generated-build-folder.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-155277" src="../Images/5052614c191cbd98b1fbc893adeb9ece.png" alt="Remote Bundles Are Generated In The Build Folder " srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/remote-bundles-generated-build-folder.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/remote-bundles-generated-build-folder-300x72.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/remote-bundles-generated-build-folder.png"/></noscript>
<p>出于测试目的，我们开始捆绑服务于HTTP服务器，并在生产模式下测试我们的应用程序。我们可以看到远程模块是从HTTP服务器加载的:</p>
<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light">

<p>Dropbox是一项免费服务，可以让你将照片、文档和视频带到任何地方，并轻松分享。永远不要再给自己发邮件了！</p>
</blockquote>
<p>多个入口点</p>
<h2 id="multiple-entry-points-repack">webpack的主要优势之一是它允许我们为应用程序创建多个入口点。这对于大规模和<a href="https://en.wikipedia.org/wiki/Brownfield_(software_development)"> B </a> <a href="https://en.wikipedia.org/wiki/Brownfield_(software_development)"> rownfield </a>应用程序非常有用，我们希望将我们的应用程序分成多个包。</h2>
<p>特别是对于React Native为某些功能提供支持的棕色地带应用程序，每个功能都可以被视为一个独立的捆绑包，在它们之间共享某些本机依赖关系。本节将展示如何使用Re.pack为我们的应用程序创建多个入口点。</p>
<p>在我们的app中，我们创建了一个更小更简单的入口点，<code>Bitsy</code>；它是从不同的入口点<code>/bitsy.js</code>加载的。</p>
<p>我们更新了webpack配置，如下所示:</p>
<p>要从本机启动<code>Bitsy</code>，您可以按如下方式更新<code>MainActivity.java</code>:</p>
<pre class="language-javascript hljs">    // webpack.config.js#L70
    entry: [
      ...
      path.join(dirname, 'bitsy.js'),
      ...
    ]
</pre>
<p>或者<code>AppDelegate.m</code>如下:</p>
<pre class="language-javascript hljs">    // MainActivity.java#L15
    @Override
    protected String getMainComponentName() {
        return "RepackBitsy";
    }
</pre>
<p>运行应用程序将启动<code>Bitsy</code>模块，而不是<code>RepackDemo</code>应用程序。</p>
<pre class="language-javascript hljs">    // AppDelegate.m#L47
    UIView *rootView = RCTAppSetupDefaultRootView(bridge, @"RepackBitsy", initProps);
</pre>
<p>结论</p>
<h2 id="conclusion">从过去十年开始，webpack就出现在前端开发中。我们看到了很多围绕它开发的插件，为大型app解决捆绑和优化领域的复杂问题。让React Native具备所有这些能力，将有助于我们轻松维护大型移动应用。这也可以帮助RN应用程序变得更加安全和高效。</h2>
<p>用Re.pack 检查这个<a href="https://github.com/zsajjad/RepackDemo">样本项目。您可能需要调整项目的webpack配置，以确保获得最佳结果。有关每个选项的详细信息，请参考配置文件和webpack文档中的注释。</a></p>
<p><a href="https://lp.logrocket.com/blg/react-native-signup"> LogRocket </a>:即时重现React原生应用中的问题。</p><div class="code-block code-block-18">
<div class="blog-plug inline-plug react-native-plug"><h2><a href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一款React原生监控解决方案，可帮助您即时重现问题、确定bug的优先级并了解React原生应用的性能。</h2><a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/110055665562c1e02069b3698e6cc671.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/110055665562c1e02069b3698e6cc671.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/></noscript></a><p>LogRocket还可以向你展示用户是如何与你的应用程序互动的，从而帮助你提高转化率和产品使用率。LogRocket的产品分析功能揭示了用户不完成特定流程或不采用新功能的原因。</p><p>开始主动监控您的React原生应用— <a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer">免费试用LogRocket】。</a></p><p>Start proactively monitoring your React Native apps — <a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer">try LogRocket for free</a>.</p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>