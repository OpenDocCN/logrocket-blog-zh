<html>
<head>
<title>Implementing Okta authentication in a React app - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在 React app - LogRocket 博客中实现 Okta 认证</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/implementing-okta-authentication-react-app/#0001-01-01">https://blog.logrocket.com/implementing-okta-authentication-react-app/#0001-01-01</a></blockquote><div><article class="article-post">
<p>对于大多数应用程序来说，验证用户的身份是最重要的。建立自己的身份验证系统起初可能很简单，但是当您考虑安全桥梁以及与第三方(如谷歌或脸书)集成的便利性时，您会发现构建和维护自己的身份验证系统会变得非常繁琐和复杂。</p>
<p>一个好的方法是使用专门处理认证的解决方案，比如 Okta。Okta 为您提供了一个专门的安全专家团队，因此您不必担心管理用户数据的麻烦。</p>
<p>在本教程中，我们将向您展示如何在 React 中实现 Okta 认证。为了跟上进度，您应该熟悉 JavaScript 和<a href="https://blog.logrocket.com/react-hooks-the-good-the-bad-and-the-ugly/" target="_blank" rel="noopener"> React 钩子</a>。</p>
<h2>设置 React 应用程序</h2>
<p>第一个要求是<a href="https://developer.okta.com/signup/" target="_blank" rel="noopener">报名 Okta </a>的开发者版。这使我们可以访问<a href="https://developer.okta.com/login/" target="_blank" rel="noopener">管理仪表板</a>，在这里我们将创建登录方法和应用程序类型——在我们的例子中，是一个单页应用程序(SPA)。</p>
<figure id="attachment_61820" aria-describedby="caption-attachment-61820" class="wp-caption aligncenter"><img data-attachment-id="61820" data-permalink="https://blog.logrocket.com/implementing-okta-authentication-react-app/okta-application-type/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-application-type.png" data-orig-size="730,308" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Okta application type" data-image-description="" data-image-caption="&lt;p&gt;Application route to begin integration with Okta.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-application-type-300x127.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-application-type.png" decoding="async" class="size-full wp-image-61820 jetpack-lazy-image" src="../Images/10304f5cc572a1c18e5efb724ddcf496.png" alt="Application Page To Create A Single-Page Application" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-application-type.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/okta-application-type-300x127.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-application-type.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-application-type.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="61820" data-permalink="https://blog.logrocket.com/implementing-okta-authentication-react-app/okta-application-type/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-application-type.png" data-orig-size="730,308" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Okta application type" data-image-description="" data-image-caption="&lt;p&gt;Application route to begin integration with Okta.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-application-type-300x127.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-application-type.png" decoding="async" loading="lazy" class="size-full wp-image-61820" src="../Images/10304f5cc572a1c18e5efb724ddcf496.png" alt="Application Page To Create A Single-Page Application" srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-application-type.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/okta-application-type-300x127.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-application-type.png"/></noscript><figcaption id="caption-attachment-61820" class="wp-caption-text">Application route to begin integration with Okta.</figcaption></figure>
<p>在应用路线下，我们可以生成一个 app 集成(我们的签到方式)。</p>
<figure id="attachment_61826" aria-describedby="caption-attachment-61826" class="wp-caption aligncenter"><img data-attachment-id="61826" data-permalink="https://blog.logrocket.com/implementing-okta-authentication-react-app/okta-sign-in-method/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-sign-in-method.png" data-orig-size="730,308" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Okta sign in method" data-image-description="" data-image-caption="&lt;p&gt;App integration button to select sign-in method.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-sign-in-method-300x127.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-sign-in-method.png" decoding="async" class="size-full wp-image-61826 jetpack-lazy-image" src="../Images/32712bd023120b128a3ea8068991f142.png" alt="Applications Creation Page Highlighting Create App Integration Button" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-sign-in-method.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/okta-sign-in-method-300x127.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-sign-in-method.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-sign-in-method.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="61826" data-permalink="https://blog.logrocket.com/implementing-okta-authentication-react-app/okta-sign-in-method/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-sign-in-method.png" data-orig-size="730,308" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Okta sign in method" data-image-description="" data-image-caption="&lt;p&gt;App integration button to select sign-in method.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-sign-in-method-300x127.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-sign-in-method.png" decoding="async" loading="lazy" class="size-full wp-image-61826" src="../Images/32712bd023120b128a3ea8068991f142.png" alt="Applications Creation Page Highlighting Create App Integration Button" srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-sign-in-method.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/okta-sign-in-method-300x127.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-sign-in-method.png"/></noscript><figcaption id="caption-attachment-61826" class="wp-caption-text">App integration button to select sign-in method.</figcaption></figure>
<p>点击<strong>创建应用程序集成</strong>按钮，会生成一个包含登录方法的对话框。因为我们的应用程序是一个 SPA，我们没有连接到后端，所以我们将使用 OpenID Connect 登录方法，它为我们提供了一个登录小部件(我们稍后还将构建自己的自定义登录表单)。</p>
<p><img data-attachment-id="61842" data-permalink="https://blog.logrocket.com/implementing-okta-authentication-react-app/okta-pop-up-openid-connect/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-pop-up-openid-connect.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Okta pop up openid connect" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-pop-up-openid-connect-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-pop-up-openid-connect.png" decoding="async" class="aligncenter size-full wp-image-61842 jetpack-lazy-image" src="../Images/019f22467ed699f7a3455e5e57defe0b.png" alt="Pop-Up Confirming A OpenID Connect Sign-In Method" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-pop-up-openid-connect.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/okta-pop-up-openid-connect-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-pop-up-openid-connect.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-pop-up-openid-connect.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="61842" data-permalink="https://blog.logrocket.com/implementing-okta-authentication-react-app/okta-pop-up-openid-connect/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-pop-up-openid-connect.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Okta pop up openid connect" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-pop-up-openid-connect-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-pop-up-openid-connect.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-61842" src="../Images/019f22467ed699f7a3455e5e57defe0b.png" alt="Pop-Up Confirming A OpenID Connect Sign-In Method" srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-pop-up-openid-connect.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/okta-pop-up-openid-connect-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-pop-up-openid-connect.png"/></noscript>
<p>选择应用程序集成后，我们要选择<strong>单页应用程序</strong>并继续。</p>
<p>下一步是指定一个登录重定向 URI(一个回调 URI)。这一点非常重要，因为当使用 OpenID Connect 登录方法时，我们被重定向到 Okta 托管的登录小部件(与我们的应用程序不同的端点),并且需要一个回调 URL，Okta 通过这个 URL 将用户的详细信息返回到我们的应用程序。</p>
<p>您还可以指定其他路径，例如注销重定向 URI，这是当我们注销应用程序时，应用程序应该被重定向到的页面。对于我们的用例，我们可以指定基本 URL/登录路由作为我们的注销端点，这意味着用户被重定向到登录页面或登录页面，这取决于我们指定的端点。如果不指定端点，用户将被重定向到 Okta 登录小部件</p>
<p>URI 基地是可选的。如果您计划自己托管 Okta 登录小部件，这是很有用的，但是超出了本教程的范围。</p>
<h2>与 React 集成</h2>
<p>现在，我们已经准备好了应用程序与 Okta 的集成，让我们将它与 React 应用程序集成。</p>
<p>在处理这种集成时，要特别注意客户端 ID 和 Okta 域，它们都可以在<strong>应用程序</strong>选项卡中找到。</p>
<p>第一步是安装 Okta SDK 和 Okta Auth JavaScript SDK:</p>
<pre class="language-bash hljs"># yarn
yarn add @okta/okta-auth-js @okta/okta-react

# npm
npm install --save @okta/okta-auth-js @okta/okta-react
</pre>
<p>让我们为 Okta 配置数据创建环境变量(以<code>.env</code>文件的形式)。</p>
<pre>OKTA_DOMAIN=&lt;YOUR_OKTA_DOMAIN&gt;
CLIENT_ID=&lt;YOUR_CLIENT_ID&gt;
CALLBACK_PATH='/login/callback'
ISSUER='https://&lt;YOUR_OKTA_DOMAIN&gt;/oauth2/default'
HOST='window.location.host'
SCOPES='openid profile email'
</pre>
<p>现在我们可以配置我们的应用程序来使用 Okta。</p>
<pre>import React from "react";
import { BrowserRouter as Router, Route, useHistory } from "react-router-dom";
import { Security, SecureRoute } from "@okta/okta-react";
import { OktaAuth, toRelativeUrl } from "@okta/okta-auth-js";
import { LandingPage } from "./LandingPage";
import { Dashboard } from "./Dashboard";
import { Header } from "./Header";
const CLIENT_ID = process.env.CLIENT_ID;
const CALLBACK_PATH = process.env.CALLBACK_PATH;
const ISSUER = process.env.ISSUER;
const HOST = process.env.HOST;
const REDIRECT_URI = `http://${HOST}${CALLBACK_PATH}`;
const SCOPES = process.env.SCOPES;

if (!SCOPES || !CLIENT_ID || !CALLBACK_PATH || !ISSUER || !HOST) {
  throw new Error("All environmental variables must be set");
}

const config = {
  issuer: ISSUER,
  clientId: CLIENT_ID,
  redirectUri: REDIRECT_URI,
  scopes: SCOPES.split(/\s+/),
};

const oktaAuth = new OktaAuth(config);

const App = () =&gt; {
  const history = useHistory();
  const restoreOriginalUri = async (_oktaAuth: any, originalUri: any) =&gt; {
    history.replace(toRelativeUrl(originalUri || "/", window.location.origin));
  };
  return (
    &lt;Router&gt;
      &lt;Security restoreOriginalUri={restoreOriginalUri} oktaAuth={oktaAuth}&gt;
        &lt;Header /&gt;
        &lt;Route path="/" exact={true} component={LandingPage} /&gt;
        &lt;SecureRoute path="/dashboard" exact={true} component={Dashboard} /&gt;
      &lt;/Security&gt;
    &lt;/Router&gt;
  );
};

export default App;
</pre>
<p>用配置对象创建一个新的<code>oktaAuth</code>实例。这被传递到安全组件中，该组件包装了我们应用程序的所有路由，并向它的所有子组件(路由中的组件)提供了<code>oktaAuth</code>和<code>authState</code>对象。</p>
<p>对象可以用来改变或读取认证状态的信息。</p>
<p><code>authState</code>对象包含:</p>
<ul>
<li><code>isAuthenticated</code>，一个布尔值，表示用户是否通过身份验证。如果<code>idToken</code>和<code>accessToken</code>出现在<code>tokenManager</code>中，则该值为真</li>
<li><code>accessToken</code>，分配给当前认证用户的 JWT 访问令牌</li>
<li><code>idToken</code>，分配给当前认证用户的 JWT ID 令牌</li>
<li><code>error</code>，认证过程失败时返回</li>
</ul>
<p>还要注意，我们不需要处理一个<code>SecureRoute ourselves</code>；Okta 为此提供了一个开箱即用的路由，它保护了指定的路径。</p>
<p>让我们实现一个登录按钮来触发登录小部件。这在 header 组件中很常见，所以我们将在那里处理它。</p>
<p>我们提供了一个<code>useOktaAuth</code>钩子，它让我们可以访问<code>oktaAuth</code>和<code>authState</code>对象。</p>
<pre>import React from "react";
import { useOktaAuth } from "@okta/okta-react";

function Header() {
  const { authState, oktaAuth } = useOktaAuth();
  const loginWithRedirect = () =&gt;
    oktaAuth.signInWithRedirect({ originalUri: "/dashboard" });
  const logOut = () =&gt; oktaAuth.signOut();

  const buttonText = authState.isAuthenticated ? "Logout" : "Login";
  const btnLogic = authState.isAuthenticated ? logOut : loginWithRedirect;

  return (
    &lt;&gt;
      &lt;div&gt;Okta React&lt;/div&gt;
      &lt;button onClick={btnLogic}&gt;{buttonText}&lt;/button&gt;
    &lt;/&gt;
  );
}

export { Header };
</pre>
<p>我们使用<code>authState</code>来确定我们是否想要登录或退出我们的应用程序。</p>
<p><code>loginWithRedirect</code>函数处理登录触发器，并在成功登录时重定向回仪表板路由，如下所示:</p>
<p><img data-attachment-id="61848" data-permalink="https://blog.logrocket.com/implementing-okta-authentication-react-app/okta-login-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-login-page.png" data-orig-size="730,435" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Okta login page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-login-page-300x179.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-login-page.png" decoding="async" class="aligncenter size-full wp-image-61848 jetpack-lazy-image" src="../Images/a1f9f52f50d9db117dc8d6169a9447a0.png" alt="Okta's Login Page For Users" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-login-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/okta-login-page-300x179.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-login-page.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-login-page.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="61848" data-permalink="https://blog.logrocket.com/implementing-okta-authentication-react-app/okta-login-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-login-page.png" data-orig-size="730,435" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Okta login page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-login-page-300x179.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-login-page.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-61848" src="../Images/a1f9f52f50d9db117dc8d6169a9447a0.png" alt="Okta's Login Page For Users" srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-login-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/okta-login-page-300x179.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-login-page.png"/></noscript>
<p>登录后，用户会立即被重定向到仪表板路由。</p>
<p>为了让注销功能在 localhost 中工作，我们需要将 localhost 添加到可信路由列表中。这将允许在我们的应用程序中交叉起源。</p>
<p><img data-attachment-id="61856" data-permalink="https://blog.logrocket.com/implementing-okta-authentication-react-app/okta-localhost-logout/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-localhost-logout.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Okta localhost logout" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-localhost-logout-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-localhost-logout.png" decoding="async" class="aligncenter size-full wp-image-61856 jetpack-lazy-image" src="../Images/854590f07528524be5d88b68631b2f43.png" alt="Page To Add Trusted Routes" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-localhost-logout.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/okta-localhost-logout-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-localhost-logout.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-localhost-logout.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="61856" data-permalink="https://blog.logrocket.com/implementing-okta-authentication-react-app/okta-localhost-logout/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-localhost-logout.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Okta localhost logout" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-localhost-logout-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-localhost-logout.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-61856" src="../Images/854590f07528524be5d88b68631b2f43.png" alt="Page To Add Trusted Routes" srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-localhost-logout.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/08/okta-localhost-logout-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/okta-localhost-logout.png"/></noscript>
<p>现在，如果我们单击标题中的注销按钮，它会成功地将我们的用户注销，并将他们重定向到登录页面。</p>
<p>我们成功了！我们已经在 React 应用程序中成功实现了 Okta 认证。</p>
<h2>自定义登录表单</h2>
<p>Okta 登录界面很好，也很容易上手，但是假设我们想要实现一个具有独特设计的自定义登录表单，并且让我们的用户保持在页面上，而不重定向到 Okta。</p>
<p>我们可以用调用<code>useOktaAuth</code>钩子时提供的<code>oktaAuth</code>来实现这一点。</p>
<p>让我们实现一个自定义的登录表单:</p>
<pre>import React from "react";
import { useOktaAuth } from "@okta/okta-react/bundles/types";

function SignIn() {
  const { oktaAuth } = useOktaAuth();
  const [sessionToken, setSessionToken] = React.useState&lt;string | null&gt;(null);

  const onSubmit = (event: React.SyntheticEvent&lt;HTMLFormElement&gt;) =&gt; {
    event.preventDefault();

    const username = event.currentTarget.elements.namedItem(
      "username"
    ) as HTMLInputElement;
    const password = event.currentTarget.elements.namedItem(
      "password"
    ) as HTMLInputElement;

    const data = {
      username: username.value,
      password: password.value,
    };

    oktaAuth
      .signInWithCredentials(data)
      .then((res) =&gt; {
        const sessionToken = res.sessionToken;
        if (!sessionToken) {
          throw new Error("authentication process failed");
        }
        setSessionToken(sessionToken);
        oktaAuth.signInWithRedirect({
          originalUri: "/dashboard",
          // @ts-ignore
          sessionToken: sessionToken,
        });
      })
      .catch((err) =&gt; console.log("handle error here": err));
  };

  if (sessionToken) return &lt;div /&gt;;

  return (
    &lt;div&gt;
      &lt;form onSubmit={onSubmit}&gt;
        &lt;label htmlFor="username"&gt;Username&lt;/label&gt;
        &lt;input type="text" id="username" /&gt;
        &lt;label htmlFor="password"&gt;Password&lt;/label&gt;
        &lt;input type="password" id="password" /&gt;
        &lt;button type="submit"&gt;SignIn&lt;/button&gt;
      &lt;/form&gt;
    &lt;/div&gt;
  );
}
export { SignIn };
</pre>
<p>我们有自己的表单，我们正在利用<code>oktaAuth</code>中的<code>signInWithCredentials</code>选项来处理自定义表单提交。<code>sessionToken</code>是一个一次性令牌，是身份验证成功后收到的值。当调用<code>useOktaAuth</code>钩子时，我们仍然可以通过在<code>authState</code>对象中提供的 ID 或访问令牌获得详细信息。</p>
<p>成功登录后，我们可以使用<code>signInWithRedirect</code>功能将用户发送到原来的 URI(主要是受保护的仪表板路线),还包括<code>sessionToken</code>。</p>
<p>让我们运行我们的应用程序，连接登录按钮以重定向到这个登录表单端点，并更新我们的路由:</p>
<pre>import React from "react";
import { useOktaAuth } from "@okta/okta-react";
import { Link } from "react-router-dom";

function Header() {
  const { authState, oktaAuth } = useOktaAuth();

  if (!authState) return null;

  const logOutRedirect = async () =&gt; await oktaAuth.signOut();

  function btnToRender() {
    return authState.isAuthenticated ? (
      &lt;button onClick={logOutRedirect}&gt;LogOut&lt;/button&gt;
    ) : (
      &lt;button&gt;
        &lt;Link to="/login"&gt;Login&lt;/Link&gt;
      &lt;/button&gt;
    );
  }

  return (
    &lt;&gt;
      &lt;div&gt;Okta React&lt;/div&gt;
      {btnToRender()}
    &lt;/&gt;
  );
}
export { Header };
</pre>
<p>路线更新如下所示:</p>
<pre>&lt;Security restoreOriginalUri={restoreOriginalUri} oktaAuth={oktaAuth}&gt;
  &lt;Header /&gt;
  &lt;Route path="/" exact={true} component={LandingPage} /&gt;
  &lt;Route path="/login" component={SignIn} /&gt;
  &lt;SecureRoute path="/dashboard" exact={true} component={Dashboard} /&gt;
  &lt;Route path={CALLBACK_PATH} component={LoginCallback} /&gt;
&lt;/Security&gt;
</pre>
<p>现在，当我们点击登录按钮时，我们被重定向到登录页面。</p>
<p>恭喜你！你已经成功地用 Okta 在 React 应用中实现了一个定制的登录屏幕。</p>
<h2>结论</h2>
<p>用户数据是非常敏感的信息，如果泄露会导致严重的隐私问题。在本教程中，我们向您展示了如何在带有 Okta 的 React 应用程序中实现一种更安全的方式来处理身份验证。</p>
<p>对于不构建后端服务的前端开发人员来说——考虑到 Jamstack 和 serverless 等框架的兴起，这些框架使您能够在没有实际 API 服务器的情况下构建应用程序——Okta 提供了一种在 React 应用程序中实现身份验证的好方法，而不会带来过多的复杂性。</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用 LogRocket 消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款 React analytics 解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket 告诉您 React 应用程序中实际影响用户的最具影响力的 bug 和 UX 问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS 异常、前端性能指标和用户交互。然后，LogRocket 使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的 React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试 LogRocket】。</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>