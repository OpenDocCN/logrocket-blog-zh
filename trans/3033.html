<html>
<head>
<title>Getting started with Vue composables - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Vue 组件入门- LogRocket 博客</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/getting-started-vue-composables/#0001-01-01">https://blog.logrocket.com/getting-started-vue-composables/#0001-01-01</a></blockquote><div><article class="article-post">
<p>Vue 3 引入了几个新概念和不同的处理逻辑的方式，其中之一就是 Vue composables。Vue 组件允许我们提取反应状态和功能，以便在其他组件中重用。</p>
<p>在本文中，我们将通过在 Vue 应用程序中实现 Vue 组件来全面理解它们。我们开始吧！</p>

<h2 id="what-are-vue-composables">什么是组件视图？</h2>
<p>Vue composables 是使用组合 API 来实现反应性和可重用逻辑的功能。Composables 充当一个外部函数，它提取反应状态和功能，以便跨几个其他组件使用。可组合函数也可以称为组合函数。</p>
<p>Composables】类似于 Vue 2 中 Options API 中的 mixins，以及 React 中钩子的实现。</p>
<h2 id="reusability-composable-functions">可组合功能的可重用性</h2>
<p>在现代 web 应用程序中，代码库总是被分成不同的组件，提供一个有组织的结构和简单的工作流程。使用可组合函数，您可以通过将功能提取和导入到一个外部文件中来进一步简化您的工作流，该文件可以在多个组件中使用。</p>
<p><a href="https://blog.logrocket.com/vue-composition-api-vs-react-hooks/">可组合函数背后的概念是由组合 API </a>带来的，它给你充分的灵活性，根据逻辑考虑将你的组件代码组织成更小的函数。</p>
<p>可组合函数的可重用特性提供了许多好处。首先，提取的逻辑可以重用，用易于导航的结构促进代码组织。Composables 还可以作为一个使用反应状态的实用函数，并且可以针对应用程序中的不同目的进行定制。</p>
<p>最后，composables 可以根据用例管理输出的状态，允许您选择状态应该是全局的还是局部的。与其他状态管理工具相比，这种自由消除了一些复杂性和依赖性。</p>
<p>关于可组合函数的另一个有趣的事情是，它们可以相互嵌套，这意味着一个可组合函数可以调用一个或多个其他可组合函数。因此，我们能够将复杂的逻辑分解成更小的单元，就像我们如何使用组件来分离整个应用程序一样。</p>
<h2 id="creating-vue-composable-scratch">从头开始创建可组合的 Vue</h2>
<p>让我们通过在 Vue 应用程序中创建和使用 composables 来尝试一下。为了跟随本教程，您需要安装 Node.js 和<a href="https://cli.vuejs.org/guide/installation.html"> Vue CLI </a>。首先，创建 Vue 项目，如下所示:</p>
<pre class="language-javascript">vue create vue-composables
</pre>
<p>项目创建后，使用以下代码导航到<code>vue-composables</code>:</p>
<pre class="language-javascript">cd vue-composables</pre>
<p>对于一个有组织的结构，我们将创建一个单独的文件夹来处理项目所需的所有组件。</p>
<p>使用<a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API"> Web Speech API </a>，我们将创建一个用于语音识别的自定义可组合组件。web Speech API 使开发人员能够在 Web 浏览器中实现语音识别和语音合成功能，使 Web 应用程序能够将语音数据转换为可读的文本格式。在本教程中，我们将创建一个可在您的应用程序中重用的语音识别组件。</p>
<p>API 用<code>SpeechRecognition()</code>构造函数初始化，它创建一个新的语音识别对象实例。</p>
<p>在创建可组合组件时，有一些重要的事情需要注意，包括命名约定。可组合函数使用骆驼大小写，其名称以前缀<code>use</code>开头。例如，我们用于演示的可组合函数将被命名为<code>useSpeechRecognition</code>。</p>
<p>就像常规函数一样，可组合函数接受可用于需要动态数据的函数的参数。最好从 composables 返回一个<code>refs</code>对象。因此，即使可组合组件被析构以用于不同的组件，这些值仍将保持它们的反应性。</p>
<p>每个可组合组件的基本结构如下:</p>
<pre class="language-javascript">export default function useComposableFunction() {
  // The logic
  return {// return values}
}
</pre>
<p>让我们创建<code>useSpeechRecognition</code>合成函数。在<code>composable</code>文件夹中，创建一个名为<code>useSpeechRecognition.js</code>的新文件，然后在其中放置以下逻辑功能:</p>
<pre class="language-javascript">import { ref,watch} from 'vue'

// the function accepts parameters
export function useSpeechRecognition({lang,continuous,interimResults}) {
    const isListening = ref(false)
    const isFinal = ref(false)
    const result = ref('')
    const error = ref(')

   // Intialize the web speech API
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition
    // Checks if the browser supports the API
    const isSupported = Boolean(SpeechRecognition)
    // The speech recognition constructor
    const recognition = SpeechRecognition? new SpeechRecognition() : false

     // a function to set it for listening
    const start = () =&gt; {
      isListening.value = true
    }

     // a function to stop it from listening
    const stop = () =&gt; {
      isListening.value = false
    }

   // Checks if the browser supports
    if (isSupported) {
      recognition.continuous = continuous
      recognition.interimResults = interimResults
      recognition.lang = lang

      recognition.onstart = () =&gt; {
        isFinal.value = false
      }

      // the method to get the result of the transcription
      recognition.onresult = (event) =&gt; {
        // raw words that the user spoke
        const transcript = Array.from(event.results)
          .map((result) =&gt; {
            isFinal.value = result.isFinal
            return result[0]
          })
          .map(result =&gt; result.transcript)
          .join('')

        result.value = transcript
        error.value = undefined
      }

      // method to handle error
      recognition.onerror = (event) =&gt; {
        error.value = 'Speech recognition error detected: ' + event.error
      }

      recognition.onend = () =&gt; {
        isListening.value = false
      }

      watch(isListening, () =&gt; {
        if (isListening.value)
        // Starting the speech recognition
          recognition.start()
        else
        // stopping the recognition
          recognition.stop()
      })
    }
  }
</pre>
<p>使用 Web Speech API，我们能够创建一个函数来接受来自用户的声音，并将它们转换成可读的文本。首先，我们确保我们的函数接受参数，然后初始化 Web Speech API，检查浏览器是否支持它。我们添加了一个函数来检查我们的 API 是否在监听<code>isListening.value</code>，将值设置为<code>true</code>或<code>false</code>。</p>
<p>使用<code>recognition.onresult</code>方法，我们得到转录的结果。此外，我们添加了一些错误处理方法。这种格式使我们不必根据我们构建的内容在不同的文件中重复这种逻辑。</p>
<p>接下来，我们返回对象中的值和方法:</p>
<pre class="language-javascript">    return {
      isSupported,
      isListening,
      isFinal,
      recognition,
      result,
      error,
      start,
      stop,
    }
</pre>
<p>然后，我们在组件中使用 composable。在<code>App.vue</code>文件中，我们首先导入以下函数:</p>
<pre class="language-javascript">import {useSpeechRecognition} from './composables/useSpeechRecognition'
</pre>
<p>通过调用函数，我们存储了可组合的返回值。我们还传递参数值:</p>
<pre class="language-javascript">const { isListening, isSupported, stop, result,start,error } = useSpeechRecognition({
        lang:'en-US',
        continuous: true,
        interimResults : true,
      })
</pre>
<p>设置完成后，我们将从组件中返回将要在组件中使用的值:</p>
<pre class="language-javascript">return {isListening,isSupported,stop,result,start,error}
</pre>
<p>最后，我们在组件中实现该功能:</p>
<pre class="language-javascript">&lt;template&gt;
  &lt;div class="app"&gt;
    &lt;div v-if="!isSupported"&gt;
      Your browser does not support SpeechRecognition API,
      &lt;a
        href="https://caniuse.com/mdn-api_speechrecognition"
        target="_blank"
      &gt;more details&lt;/a&gt;
    &lt;/div&gt;
    &lt;div v-else &gt;
      &lt;header&gt;
      &lt;h1&gt; Speech Recognition  &lt;/h1&gt;
      &lt;i class="header-icon fas fa-microphone-alt"&gt;&lt;/i&gt;
    &lt;/header&gt;
    &lt;main&gt;
      &lt;div class="mic-buttons"&gt;
        &lt;!-- To handle the controls --&gt;
    &lt;button v-if="!isListening" @click="start"&gt;
        Speak 
      &lt;/button&gt;
      &lt;button v-if="isListening" class="orange" @click="stop"&gt;
        Stop
      &lt;/button&gt;
      &lt;/div&gt;
      &lt;h2&gt; English Transcript &lt;/h2&gt;
      &lt;!-- Conditionals to handle errors --&gt;
      &lt;p v-if="error" &gt;{{error}}&lt;/p&gt;
      &lt;div v-else&gt;
      &lt;textarea v-model="result" class="text-transcript" cols="30" rows="10"&gt;  &lt;/textarea&gt;
      &lt;/div&gt;
    &lt;/main&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
</pre>
<p>这里是完整代码的<a href="https://codesandbox.io/s/speech-recognition-vue-composable-91wzi4">链接，以防你想尝试一下。</a></p>
<p>有了这个组件，我们可以轻松地在我们的 Vue 应用中实现语音识别功能，该功能也可重复用于不同的功能。</p>
<h2 id="external-libraries-composable-functions">可组合函数的外部库</h2>
<p>在 Vue 应用程序中使用 composables 的另一种方法是通过外部开源库，创建这些库是为了利用定制的组合 API 函数。</p>
<h3 id="vueuse">武尤斯</h3>
<p>完全用 TypeScript 编写的<a href="https://vueuse.org"> VueUse </a>库提供了 200 多个可组合的函数，适用于 Vue 2 和 3 应用。这些功能可以通过 CDN 定制并在您的项目中使用，也可以通过 npm 直接安装:</p>
<pre class="language-bash">npm i @vueuse/core

&lt;script src="https://unpkg.com/@vueuse/core"&gt;&lt;/script&gt;
</pre>
<p>文档写得很好，有交互式演示和代码。这些功能<a href="https://vueuse.org/functions.html">分为九种类型</a>:浏览器、传感器、动画、状态、元素、组件、手表、网络、实用程序和杂项。你可以从<a href="https://vueuse.org/functions.html">官方文档</a>中获得关于不同功能的更多信息。</p>
<h3 id="vue-composables">视图-零部件</h3>
<p>vue-composable 是一个库，它提供了现成的、通用的组合 API 函数。vue-composable 完全由 TypeScript 构建，支持 Vue 2 和 Vue 3 应用程序。您可以使用 Yarn 或 npm 安装它:</p>
<pre class="language-bash"># install with yarn
yarn add @vue/composition-api vue-composable
# install with npm
npm install @vue/composition-api vue-composable
</pre>
<p>它提供的一些功能类别有事件、日期、格式、断点、存储、i18n 和 Web。可以从<a href="https://pikax.me/vue-composable/">官方文档</a>中了解更多。</p>
<h2 id="conclusion">结论</h2>
<p>可组合函数分别提取逻辑功能，以便在其他几个组件中重用，这样就不必在多个不同的实例中复制代码来获得相同的结果。</p>
<p>composables 背后的概念改变了我们在应用程序中处理可重用性的方式，提供了一种更简单、更灵活、更有效的方法。现在是重构代码库以便在应用程序中使用组件的好时机！</p>
<p>如果你有任何问题，你可以在推特上联系我或者在下面留言。感谢阅读！</p><div class="code-block code-block-20">
<div class="blog-plug inline-plug vue-inline"><h2>像用户一样体验您的 Vue 应用</h2><p>调试 Vue.js 应用程序可能会很困难，尤其是当用户会话期间有几十个(如果不是几百个)突变时。如果您对监视和跟踪生产中所有用户的 Vue 突变感兴趣，</p><a href="https://lp.logrocket.com/blg/vue-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/0d269845910c723dd7df26adab9289cb.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/0d269845910c723dd7df26adab9289cb.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png"/></noscript></a><a href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用程序的 DVR，记录你的 Vue 应用程序中发生的一切，包括网络请求、JavaScript 错误、性能问题等等。您可以汇总并报告问题发生时应用程序的状态，而不是猜测问题发生的原因。</p><p>LogRocket Vuex 插件将 Vuex 突变记录到 LogRocket 控制台，为您提供导致错误的环境，以及出现问题时应用程序的状态。</p><p>现代化您调试 Vue 应用的方式- <a class="signup" href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div>


</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>