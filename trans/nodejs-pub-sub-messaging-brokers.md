# 最佳发布/订阅消息经纪人- LogRocket 博客

> 原文：<https://blog.logrocket.com/nodejs-pub-sub-messaging-brokers/>

网络中计算机相互交互的最基本技术之一是请求/响应或请求/回复。它被 HTTP 广泛使用，HTTP 是万维网数据传输的基础。HTTP 遵循传统的客户机-服务器体系结构，客户机发起连接以发出请求，然后等待响应。

虽然这种客户机-服务器体系结构非常有用，并且有许多应用程序，但它也有一定的局限性。例如，当通信是异步的或者包含大量节点时，请求/回复模式就变得更加困难。

因此，开发人员需要一种架构模式，这种模式可以异步运行，并且可以独立于节点数量很好地伸缩。在本教程中，我们将探索发布/订阅架构模式，以及实现它的最佳消息代理。我们开始吧！

### 目录

## 发布/订阅架构简介

Pub/sub 是 publish/subscribe 的缩写，是一种异步消息传递体系结构，在该体系结构中，消息在实体之间传输，而发送方或接收方不知道对方的身份。

换句话说，发布/订阅架构的两端是松散连接的，这使得它成为集成扩展分布式系统节点的合适设计。Pub/sub 允许机器实时交互和响应数据更新，这不同于通常的请求/响应通信范例，在这种范例中，数据定期更新。

发布/订阅架构由三个主要组件组成:发布者、事件总线或代理以及订阅者。我们来定义一下这些。

### 出版商

发布者是生成消息的节点，这些消息随后使用事件总线/代理在系统中发送。

### 事件总线/代理

事件总线/代理节点充当中间人，促进消息从发布者到订阅者的流动。代理进一步加强了系统节点之间的解耦，因为订户与代理而不是整个系统打交道。

### 订阅者

订户本质上是在不知道这些通信的发送者是谁的情况下收听关于他们感兴趣的主题和类别的通信。

订户通常表示他们对接收特定消息感兴趣，充当过滤机制。由于细粒度的主题控制，很容易确保各种事件总线发送正确的消息。我们可以使用基于主题的过滤或基于内容的过滤来实现这种类型的过滤。

### 基于主题的过滤

基于主题的过滤要求将消息传播到逻辑通道中。订阅者只从他们订阅的逻辑信道获取消息。

### 基于内容的过滤

基于内容的过滤使订户能够根据消息的内容接收消息。订户具有检查正在广播的消息的内容是否与订户定义的约束相匹配的过滤器。

## 发布/订阅架构用例

发布/订阅架构对于拥有大量客户的分布式架构来说是一个很好的选择，因为它使用松散链接的节点。下面是几个如何使用发布/订阅架构的示例:

### 物联网

物联网(IoT)是由嵌入了传感器等技术的物理对象组成的，可以实时收集数据。捕获的数据然后通过互联网或其他通信网络传输到其他设备和系统。

pub/sub 吸引物联网用例的两个主要功能包括支持发布者和订阅者之间的灵活耦合，以及对点到多点传输的内在支持。MQTT 和 DDS 是物联网应用中广泛使用的两种知名协议。

### 事件通知

发布-订阅功能是事件通知架构的核心。同时向大量接收者发送事件是传统请求-响应模式的一个常见技术挑战。

例如，客户端或消息接收者可能不总是可用，因此您需要一个系统来允许他们接收他们可能错过的消息。这不仅仅存在于请求-响应模式中。由于发布/订阅架构的松散耦合，发布者可以发送事件而不用担心哪些客户端在线，因为这些消息存储在[订阅队列](https://www.ibm.com/docs/en/ibm-mq/8.0?topic=subscriptions-managed-queues-publishsubscribe)中。

### 数据流

数据流是传输连续数据流的技术。数据流是按时间排列的数据片段序列。这些信号不断流入信息流。因此，数据流可以被描述为连续的和时间敏感的。发布/订阅是数据流的理想选择，因为它允许计算机在数据更新发生时进行交互并做出反应。

## 发布/订阅消息代理

消息代理是一个计算机程序模块，它支持应用程序、系统和服务之间的消息验证、通信和路由。消息代理充当节点之间的中间人，从而促进发布者和订阅者之间的消息交换。

代理的主要目的是获取来自应用程序的传入消息，并对其执行一些操作。消息代理通过最小化节点之间的相互感知来有效地实现解耦。

以下是发布/订阅消息代理的一些功能:

*   管理工作负载队列
*   提供可靠的存储
*   保证消息传递
*   将消息路由到不同的目的地

代理是单点故障，这是使用消息代理的一个显著缺点。如果消息代理失败，整个系统将停止运行。

发布/订阅模式是一个通用指南，因此它没有指定消息代理的精确实现细节。有各种各样的第三方消息代理。它们中的每一个都是奇妙而有效的工具。让我们不分先后地回顾一下其中的一些。

### 阿帕奇卡夫卡

[Apache Kafka 是一个开源的分布式事件流平台](https://kafka.apache.org)，旨在为处理实时数据提供一个统一的、高吞吐量、低延迟的平台。[优步、Spotify、Shopify 和 Slack 等公司使用 Kafka](https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/) ，因为它非常适合高性能数据管道、流分析、数据集成和关键任务应用。

### activemq

根据其官方文档，Apache ActiveMQ 是最流行的开源、多协议、基于 Java 的消息代理之一。它足够灵活，可以适应任何消息传递用例。此外，它支持 [MQTT，你可以用它来管理你的物联网设备](https://blog.logrocket.com/getting-started-with-node-js-mqtt/)。Active MQ 还提供了一些高级特性，如消息负载平衡、镜像队列和 AMQ 消息存储，这保证了更快的持久性。

### 雷迪斯

根据 Redis 的文档，Redis 是一个开源的内存数据结构存储，用作数据库、缓存和消息代理。 [Redis 支持各种各样的数据结构](https://blog.logrocket.com/using-redis-pub-sub-node-js/)，比如字符串、列表、地图、集合、有序集合、超级日志、位图、流和空间索引。

### ZeroMQ、MQ 或 0MQ

ZeroMQ 是一个异步消息库，用于实现应用程序和进程之间的消息和通信系统。这些应用程序可以是分布式的，也可以是并发的。ZeroMQ 提供了一个消息队列，它可以在有或没有专用消息代理的情况下运行。难怪微软、三星、AT & T、Auth0、比特币等公司都用 ZeroMQ。

## 结论

在本文中，我们回顾了 pub/sub 模式，这是一种异步消息传递体系结构，在这种体系结构中，消息在不知道发送者或接收者身份的情况下在节点之间交换。一些节点发布消息，因此被称为发布者。

其他节点基于兴趣订阅接收某些消息，因此被称为订阅者。事件总线/代理是指便于发布者和订阅者之间交换消息的节点。

请记住，发布/订阅架构并不是一个万能的解决方案。请求/响应模型仍然是相关的，并且可以在许多情况下使用。

然而，发布/订阅架构非常适合系统敏捷性和互操作性至关重要的情况。例如，您必须持续监视资源状态，并在尽可能短的时间内获得有关任何更改和更新的信息。

实现发布/订阅架构还有很多其他的选择，比如 Rabbit MQ、IBM MQ 和 Faye。我建议对这些进行调查，并选择最符合您要求的一个。我希望你喜欢这篇文章。如果您有任何问题，请随时发表评论。

## 使用 [LogRocket](https://lp.logrocket.com/blg/signup) 消除传统错误报告的干扰

[![LogRocket Dashboard Free Trial Banner](img/d6f5a5dd739296c1dd7aab3d5e77eeb9.png)](https://lp.logrocket.com/blg/signup)

[LogRocket](https://lp.logrocket.com/blg/signup) 是一个数字体验分析解决方案，它可以保护您免受数百个假阳性错误警报的影响，只针对几个真正重要的项目。LogRocket 会告诉您应用程序中实际影响用户的最具影响力的 bug 和 UX 问题。

然后，使用具有深层技术遥测的会话重放来确切地查看用户看到了什么以及是什么导致了问题，就像你在他们身后看一样。

LogRocket 自动聚合客户端错误、JS 异常、前端性能指标和用户交互。然后 LogRocket 使用机器学习来告诉你哪些问题正在影响大多数用户，并提供你需要修复它的上下文。

关注重要的 bug—[今天就试试 LogRocket】。](https://lp.logrocket.com/blg/signup-issue-free)

## 200 只![](img/61167b9d027ca73ed5aaf59a9ec31267.png)显示器出现故障，生产中网络请求缓慢

部署基于节点的 web 应用程序或网站是容易的部分。确保您的节点实例继续为您的应用程序提供资源是事情变得更加困难的地方。如果您对确保对后端或第三方服务的请求成功感兴趣，

[try LogRocket](https://lp.logrocket.com/blg/node-signup)

.

[![LogRocket Network Request Monitoring](img/cae72fd2a54c5f02a6398c4867894844.png)](https://lp.logrocket.com/blg/node-signup)[https://logrocket.com/signup/](https://lp.logrocket.com/blg/node-signup)

LogRocket 就像是网络和移动应用程序的 DVR，记录下用户与你的应用程序交互时发生的一切。您可以汇总并报告有问题的网络请求，以快速了解根本原因，而不是猜测问题发生的原因。

LogRocket 检测您的应用程序以记录基线性能计时，如页面加载时间、到达第一个字节的时间、慢速网络请求，还记录 Redux、NgRx 和 Vuex 操作/状态。

[Start monitoring for free](https://lp.logrocket.com/blg/node-signup)

.