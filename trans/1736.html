<html>
<head>
<title>Using state machines with XState and React - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>通过 XState 和 React - LogRocket 博客使用状态机</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/using-state-machines-with-xstate-and-react/#0001-01-01">https://blog.logrocket.com/using-state-machines-with-xstate-and-react/#0001-01-01</a></blockquote><div><article class="article-post">
<p>当我们的应用程序变得更大时，我们需要一种方法来保持处理应用程序状态的复杂性。状态是由我们正在运行的应用程序操作和反映的数据。在 React 中有许多方法来处理应用程序的状态。一些最流行的状态管理库是<a href="https://redux.js.org/" target="_blank" rel="noopener"> Redux </a>、<a href="https://reactjs.org/docs/context.html" target="_blank" rel="noopener">上下文 API </a>、<a href="https://react-query.tanstack.com/" target="_blank" rel="noopener"> React Query </a>、反冲和<a href="https://xstate.js.org/docs/" target="_blank" rel="noopener"> XState </a>。</p>
<p>在本文中，我们将使用 XState，因为它是在任何 JavaScript 应用程序中处理状态的最简单和最有效的方法之一，而不是与框架无关的。当使用 XState 时，我们可以很容易地利用状态机来管理和设计全局或组件状态。</p>
<h2>什么是有限状态机？</h2>
<p><a href="https://brilliant.org/wiki/finite-state-machines/" target="_blank" rel="noopener">有限状态机</a>是一种计算的数学模型，最初开发于 20 世纪 40 年代初，几十年来一直用于为各种技术构建硬件和软件。它帮助我们减少可能状态的数量，并控制移动状态的转换，从而产生可预测和可靠的应用程序。</p>
<p>使用状态机的另一个好处是，在我们构建之前和/或之后，他们还有一个可视化工具来查看图中的状态，称为<a href="https://xstate.js.org/viz/" target="_blank" rel="noopener"> XState Visualizer </a>。</p>
<h2>先决条件</h2>
<ul>
<li>熟悉 JavaScript 并对 ES6 语法有基本了解。</li>
<li>安装在计算机上的 Node.js</li>
<li><a href="https://docs.npmjs.com/downloading-and-installing-node-js-and-npm" target="_blank" rel="noopener"> NPM 安装了</a></li>
</ul>
<p>在本教程中，我们将构建一个简单的书店，并实现构建该商店所需的所有必要状态。这个存储将涉及构建一般应用程序所需的所有 CRUD(创建、读取、更新、删除)功能。</p>
<p>对于 API 端点，我们将利用 Airtable 提供的特性，用它为我们的应用程序提供数据，并用<a href="https://tailwindcss.com/" target="_blank" rel="noopener"> Tailwind CSS </a>来设计我们的应用程序。</p>
<h3>添加图书状态机</h3>
<p>在我们的 XState 可视化工具中，我们将首先编写一个简单的状态机来为我们的书店创建一本新书:</p>
<pre>export const addbookMachine = {
 id: 'addBooks',
 initial: 'addNew',
 states: {
   addNew: {},
   adding: {
     invoke: {
       id: 'addingBook',
       src: addingBook,
       onDone: {
         target: 'success',
         actions: assign({ fields: (_context, event) =&gt; event.data }),
       },
       onError: {
         target: 'failed',
         actions: assign({ error: (_context, event) =&gt; event.data }),
       },
     },
   },
   success: {},
   failed: {},
 },
};
</pre>
<p>可视化这个简单的状态机，我们可以看到什么时候我们能够填充<code>add a book</code>表单，它将它的状态从<code>addNew</code>转换到<code>adding</code>，并且，基于那个特定的承诺，我们改变到成功和错误。这是一个简单的状态机，当函数调用时，它可以根据成功和失败来转换状态。</p>
<figure id="attachment_45770" aria-describedby="caption-attachment-45770" class="wp-caption aligncenter"><img data-attachment-id="45770" data-permalink="https://blog.logrocket.com/using-state-machines-with-xstate-and-react/xstate-visualizer-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/xstate-visualizer.png" data-orig-size="730,131" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="XState Visualizer" data-image-description="" data-image-caption="&lt;p&gt;ddd&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/xstate-visualizer-300x54.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/xstate-visualizer.png" decoding="async" class="size-full wp-image-45770 jetpack-lazy-image" src="../Images/9f31b2c793ff5c2031cc7fbfe9001fef.png" alt="XState Visualizer" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/xstate-visualizer.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/xstate-visualizer-300x54.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/04/xstate-visualizer.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/xstate-visualizer.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="45770" data-permalink="https://blog.logrocket.com/using-state-machines-with-xstate-and-react/xstate-visualizer-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/xstate-visualizer.png" data-orig-size="730,131" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="XState Visualizer" data-image-description="" data-image-caption="&lt;p&gt;ddd&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/xstate-visualizer-300x54.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/xstate-visualizer.png" decoding="async" loading="lazy" class="size-full wp-image-45770" src="../Images/9f31b2c793ff5c2031cc7fbfe9001fef.png" alt="XState Visualizer" srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/xstate-visualizer.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/xstate-visualizer-300x54.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/xstate-visualizer.png"/></noscript><figcaption id="caption-attachment-45770" class="wp-caption-text">XState Visualizer generated from <a href="https://xstate.js.org/viz/" target="_blank" rel="noopener">XState Visualizer</a>.</figcaption></figure>
<p>我们还将创建一个函数来确定我们的调用是成功还是失败。我们之前已经在我们的状态机中把它命名为<code>invoke</code>里面的<code>addingBook</code>。</p>
<pre>const addingBook = (context, event) =&gt;
 new Promise(async (resolve, reject) =&gt; {
   let result = await addTheBooks(context, event);
   if (result.status === 200) {
     resolve(result);
   } else {
     reject('books');
   }
 });
</pre>
<p>这个承诺解决或拒绝我们提供的等待其值的函数调用。如果响应是<code>200</code>，我们就去<code>onDone</code>；否则，我们将过渡到<code>OnError</code>状态。</p>
<p>让我们也连接到我们的 Airtable API 来进行这个调用。我们将创建一个新文件夹，并将其命名为<strong> API </strong>，在这里我们将放置应用程序所需的所有 API 调用。在里面，我们将创建一个新文件，并将其命名为<strong> addBook </strong>。</p>
<pre>const addTheBooks = async (_context, event) =&gt; {
 const { Name, Author, Published, Currency, Category } = event;
 const formater = {
   records: [
     {
       fields: { Name, Author, Published, Currency, Category },
     },
   ],
 };
 const res = await fetch(process.env.REACT_APP_BASE_URL + 'Books', {
   method: 'POST',
   headers: new Headers({
     Authorization: process.env.REACT_APP_API_KEY,
     'Content-Type': 'application/json',
   }),
   body: JSON.stringify(formater),
 });
 return res;
};
 
export default addTheBooks;
</pre>
<p>在这里，我们从我们的 Airtable 调用了一个 API 端点来<code>POST</code>我们添加的书籍。我们还添加了一个格式化常量来构造 API 采用的数据格式。表单字段将作为 JSON 有效负载发送给 formatter 常量，该常量将字段值作为键值对。</p>
<p>最后，为了在书店中添加书籍，我们创建了一个组件来添加书籍。这与状态机通信，以便在应用程序的指定状态中流动。</p>
<pre>import React, { useContext, useRef } from 'react';
import { Link } from 'react-router-dom';
import { MachineContext } from '../state/index';
 
// eslint-disable-next-line
function Addbook({}) {
 const book = useRef();
 const authorName = useRef();
 const date = useRef();
 const price = useRef();
 const category = useRef();
 const [machine, sendToMachine] = useContext(MachineContext);
 
 const addAbook = async () =&gt; {
   const Name = book.current.value;
   const Author = authorName.current.value;
   const Published = date.current.value;
   const Currency = parseFloat(price.current.value);
   const Category = category.current.value;
   sendToMachine('ADD_BOOK', { Name, Author, Published, Currency, Category });
   book.current.value = '';
   authorName.current.value = '';
   date.current.value = '';
   price.current.value = '';
   category.current.value = '';
 };
 
 return (
   &lt;div&gt;
     &lt;div className="flex items-left justify-left"&gt;
       &lt;div className="max-w-md w-full"&gt;
         &lt;div&gt;
           &lt;div&gt;
             &lt;Link
               to="/"
               className="text-indigo-500 inline-flex items-center font-bold"
             &gt;
               &lt;svg
                 className="w-6 h-6 mr-2"
                 fill="none"
                 stroke="currentColor"
                 viewBox="0 0 24 24"
                 
               &gt;
                 &lt;path
                   strokeLinecap="round"
                   strokeLinejoin="round"
                   strokeWidth="2"
                   d="M7 16l-4-4m0 0l4-4m-4 4h18"
                 &gt;&lt;/path&gt;
               &lt;/svg&gt;
               Go back
             &lt;/Link&gt;
           &lt;/div&gt;
           &lt;h4 className="text-left text-2xl font-bold text-gray-500"&gt;
             Fill details to add new book.
           &lt;/h4&gt;
         &lt;/div&gt;
         &lt;form className="mt-10 space-y-6"&gt;
           &lt;input type="hidden" name="remember" value="true" /&gt;
           &lt;div className="rounded-md shadow-sm"&gt;
             &lt;div className="mb-3"&gt;
               &lt;label htmlFor="book-name" className="sr-only"&gt;
                 Book Name
               &lt;/label&gt;
               &lt;input
                 id="book-name"
                 name="book"
                 type="text"
                 autoComplete="bookname"
                 className="w-full bg-white rounded border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
                 placeholder="book name"
                 ref={book}
               /&gt;
             &lt;/div&gt;
             &lt;div className="mb-3"&gt;
               &lt;label htmlFor="author-name" className="sr-only"&gt;
                 Author Name
               &lt;/label&gt;
               &lt;input
                 id="author-name"
                 name="author"
                 type="text"
                 autoComplete="authorname"
                 className="w-full bg-white rounded border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
                 placeholder="author name"
                 ref={authorName}
               /&gt;
             &lt;/div&gt;
             &lt;div className="mb-3"&gt;
               &lt;label htmlFor="published-date" className="sr-only"&gt;
                 Published date
               &lt;/label&gt;
               &lt;input
                 id="published-date"
                 name="date"
                 type="date"
                 autoComplete="published date"
                 className="w-full bg-white rounded border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
                 placeholder="published date"
                 ref={date}
               /&gt;
             &lt;/div&gt;
             &lt;div className="mb-3"&gt;
               &lt;label htmlFor="currency" className="sr-only"&gt;
                 Price
               &lt;/label&gt;
               &lt;input
                 id="currency"
                 name="currency"
                 type="text"
                 autoComplete="currencyname"
                 className="w-full bg-white rounded border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
                 placeholder="price of book"
                 ref={price}
               /&gt;
             &lt;/div&gt;
 
             &lt;div className="relative"&gt;
               &lt;select
                 className="rounded border appearance-none border-gray-300 py-2 w-full placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 text-base pl-3 pr-10 sm:text-sm"
                 ref={category}
               &gt;
                 &lt;option default value="select one"&gt;
                   select one
                 &lt;/option&gt;
                 &lt;option&gt;Psychology&lt;/option&gt;
                 &lt;option&gt;Related&lt;/option&gt;
                 &lt;option&gt;Others&lt;/option&gt;
                 &lt;option&gt;Research&lt;/option&gt;
                 &lt;option&gt;Testing&lt;/option&gt;
                 &lt;option&gt;Usability&lt;/option&gt;
               &lt;/select&gt;
               &lt;span className="absolute right-0 top-0 h-full w-10 text-center text-gray-600 pointer-events-none flex items-center justify-center"&gt;
                 &lt;svg
                   fill="none"
                   stroke="currentColor"
                   strokeLinecap="round"
                   strokeLinejoin="round"
                   strokeWidth="2"
                   className="w-4 h-4"
                   viewBox="0 0 24 24"
                 &gt;
                   &lt;path d="M6 9l6 6 6-6"&gt;&lt;/path&gt;
                 &lt;/svg&gt;
               &lt;/span&gt;
             &lt;/div&gt;
           &lt;/div&gt;
 
           &lt;div className="inline-flex rounded-md shadow"&gt;
             &lt;input
               type="button"
               value="Add My Book"
               className="inline-flex items-center justify-center px-5 py-3 border border-transparent text-base font-medium rounded-md bg-indigo-600 text-white hover:bg-indigo-700"
               onClick={addAbook}
             &gt;&lt;/input&gt;
           &lt;/div&gt;
 
           {machine.matches('addbookMachine.adding') &amp;&amp; (
             &lt;span&gt;
               &lt;svg
                 
                 width="24"
                 height="24"
                 viewBox="0 0 24 24"
                 fill="none"
                 stroke="currentColor"
                 strokeWidth="2"
                 strokeLinecap="round"
                 strokeLinejoin="round"
                 className="feather feather-loader"
               &gt;
                 &lt;line x1="12" y1="2" x2="12" y2="6"&gt;&lt;/line&gt;
                 &lt;line x1="12" y1="18" x2="12" y2="22"&gt;&lt;/line&gt;
                 &lt;line x1="4.93" y1="4.93" x2="7.76" y2="7.76"&gt;&lt;/line&gt;
                 &lt;line x1="16.24" y1="16.24" x2="19.07" y2="19.07"&gt;&lt;/line&gt;
                 &lt;line x1="2" y1="12" x2="6" y2="12"&gt;&lt;/line&gt;
                 &lt;line x1="18" y1="12" x2="22" y2="12"&gt;&lt;/line&gt;
                 &lt;line x1="4.93" y1="19.07" x2="7.76" y2="16.24"&gt;&lt;/line&gt;
                 &lt;line x1="16.24" y1="7.76" x2="19.07" y2="4.93"&gt;&lt;/line&gt;
               &lt;/svg&gt;
             &lt;/span&gt;
           )}
         &lt;/form&gt;
       &lt;/div&gt;
     &lt;/div&gt;
     {machine.matches('addbookMachine.success') &amp;&amp; (
       &lt;div className="bg-green-200 px-2 py-2 text-green-800 mt-2 inline-flex"&gt;
         Your book has been added!
       &lt;/div&gt;
     )}
     {machine.matches('addbookMachine.failed') &amp;&amp; (
       &lt;div className="bg-red-200 px-2 py-2 text-red-800 mt-2 inline-flex"&gt;
         Sorry we cannot add new book!
       &lt;/div&gt;
     )}
   &lt;/div&gt;
 );
}
 
export default Addbook;
</pre>
<p>很明显，我们需要我们的应用程序包装一个 XState 提供者。为此，您仍然可以查看下面共享的代码库。</p>
<h3>更新图书状态机</h3>
<p>为了更新我们的图书详细信息，我们需要创建两个 API 调用:第一个调用获取一本图书的详细信息，第二个调用提交一个补丁请求来编辑该特定的图书。</p>
<p>让我们首先创建一个 fetchsinglebook.js 文件，并在那里编写我们的机器代码:</p>
<pre>export const fetchOneBookMachine = {
 id: 'fetchonebook',
 initial: 'start',
 states: {
   start: {},
   fetching: {
     invoke: {
       id: 'getOneBook',
       src: getOneBook,
       onDone: {
         target: 'success',
         actions: assign({ list: (_context, event) =&gt; event.data }),
       },
       onError: {
         target: 'failed',
         actions: assign({ error: (_context, event) =&gt; event.data }),
       },
     },
   },
   editing: {
     invoke: {
       id: 'editOneBook',
       src: editOneBook,
       onDone: {
         target: 'success',
         actions: assign({ list: (_context, event) =&gt; event.data }),
       },
       onError: {
         target: 'failed',
         actions: assign({ error: (_context, event) =&gt; event.data }),
       },
     },
   },
   success: {},
   failed: {},
 },
};
</pre>
<p>这就是我真正喜欢状态机的地方。只要看一眼这些嵌套的对象结构，我们就能明白发生了什么。</p>
<p>我们现在简单地添加了五个状态，最初是起始状态。当我们调用函数<code>FETCH_A_BOOK</code>时，它将自己转换为在<code>fetchOneBookMachine</code>中获取。</p>
<p>同样，一旦进入编辑状态，我们也可以添加 PUT API 请求。所有的状态天气移动到成功或失败状态。我们还需要创建一个承诺来确定函数是<code>onDone</code>还是<code>onError</code>状态。</p>
<pre>const getOneBook = (context, event) =&gt;
 new Promise(async (resolve, reject) =&gt; {
   let result = await fetchSingleBook(context, event);
   if (result.status === 200) {
     resolve(result);
   } else {
     reject('book');
   }
 });
 
const editOneBook = (context, event) =&gt; {
 new Promise(async (resolve, reject) =&gt; {
   let result = await editTheBook(context, event);
   if (result.status === 200) {
     resolve(result);
   } else {
     reject('book');
   }
 });
};
</pre>
<p>让我们也为编辑我们的书写我们的 API 调用。这里，我们还需要两个函数:一个是获取单本书的值，另一个是以非破坏性的方式将值添加到数据库中。</p>
<pre>const fetchSingleBook = async (props) =&gt; {
 const { id } = props;
 const res = await fetch(process.env.REACT_APP_BASE_URL + 'Books/' + id, {
   method: 'GET',
   headers: new Headers({
     Authorization: process.env.REACT_APP_API_KEY,
     'Content-Type': 'application/json',
   }),
 }).then((x) =&gt; x.json());
 return res;
};
 
export default fetchSingleBook;
</pre>
<p>最后，我们将创建我们的<code>editbook</code>组件。在它的内部，我们将使用<code>useEffect</code>钩子来获取一本书。这本书是我们在我们的路线上点击和访问的同一 ID，我们将从我们的状态中过滤下来(当我们获得所有书籍的列表时更新)。</p>
<pre>import React, { useContext, useEffect, useState } from 'react';
import { MachineContext } from '../state/index';
import { useHistory } from "react-router-dom";
 
import { Link } from 'react-router-dom';
 
function Editbook(route) {
 const [machine, sendToMachine] = useContext(MachineContext);
 const id = route.match.params.id;
 const [selectedBook, setSeletedBook] = useState({
   id: '',
   fields: {
     Category: '',
     Name: '',
     Published: '',
     Currency: '',
     Author: '',
   },
   createdTime: '',
 });
 let history = useHistory();
 
 useEffect(() =&gt; {
   sendToMachine('FETCH_A_BOOK', { id });
   const { books, error } = machine.context;
   const list = books.records;
   const filterObj = list.filter((list) =&gt; list.id === id);
   setSeletedBook(filterObj[0]);
 }, []);
 
 const handleOnChange = (userKey, value) =&gt; {
   setSeletedBook({ ...selectedBook, fields: { [userKey]: value } });
 };
 
 const editAbook = async () =&gt; {
   sendToMachine('EDIT_A_BOOK', selectedBook);
   history.push("/");
 };
 
 return (
   &lt;div&gt;
     &lt;div className="flex items-left justify-left"&gt;
       &lt;div className="max-w-md w-full"&gt;
         &lt;div&gt;
           &lt;div&gt;
             &lt;Link
               to="/"
               className="text-indigo-500 inline-flex items-center font-bold"
             &gt;
               &lt;svg
                 className="w-6 h-6 mr-2"
                 fill="none"
                 stroke="currentColor"
                 viewBox="0 0 24 24"
                 
               &gt;
                 &lt;path
                   strokeLinecap="round"
                   strokeLinejoin="round"
                   strokeWidth="2"
                   d="M7 16l-4-4m0 0l4-4m-4 4h18"
                 &gt;&lt;/path&gt;
               &lt;/svg&gt;
               Go back
             &lt;/Link&gt;
           &lt;/div&gt;
           &lt;h4 className="text-left text-2xl font-bold text-gray-500"&gt;
             Fill details to edit book details.
           &lt;/h4&gt;
         &lt;/div&gt;
       &lt;/div&gt;
     &lt;/div&gt;
     &lt;section&gt;
       {machine.matches('fetchOneBookMachine.fetching') &amp;&amp; (
         &lt;&gt;
           &lt;svg
             
             width="24"
             height="24"
             viewBox="0 0 24 24"
             fill="none"
             stroke="currentColor"
             strokeWidth="2"
             strokeLinecap="round"
             strokeLinejoin="round"
             className="feather feather-loader animate-spin text-2xl"
           &gt;
             &lt;line x1="12" y1="2" x2="12" y2="6"&gt;&lt;/line&gt;
             &lt;line x1="12" y1="18" x2="12" y2="22"&gt;&lt;/line&gt;
             &lt;line x1="4.93" y1="4.93" x2="7.76" y2="7.76"&gt;&lt;/line&gt;
             &lt;line x1="16.24" y1="16.24" x2="19.07" y2="19.07"&gt;&lt;/line&gt;
             &lt;line x1="2" y1="12" x2="6" y2="12"&gt;&lt;/line&gt;
             &lt;line x1="18" y1="12" x2="22" y2="12"&gt;&lt;/line&gt;
             &lt;line x1="4.93" y1="19.07" x2="7.76" y2="16.24"&gt;&lt;/line&gt;
             &lt;line x1="16.24" y1="7.76" x2="19.07" y2="4.93"&gt;&lt;/line&gt;
           &lt;/svg&gt;
         &lt;/&gt;
       )}
       &lt;div&gt;
         &lt;form className="mt-10 space-y-6"&gt;
           &lt;input type="hidden" name="remember" value="true" /&gt;
           &lt;div className="rounded-md shadow-sm"&gt;
             &lt;div className="mb-3"&gt;
               &lt;label htmlFor="book-name" className="sr-only"&gt;
                 Book Name
               &lt;/label&gt;
               &lt;input
                 id="book-name"
                 name="book"
                 type="text"
                 autoComplete="bookname"
                 value={selectedBook.fields.Name}
                 onChange={(e) =&gt; handleOnChange('Name', e.target.value)}
                 className="w-full bg-white rounded border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
               /&gt;
             &lt;/div&gt;
             &lt;div className="mb-3"&gt;
               &lt;label htmlFor="author-name" className="sr-only"&gt;
                 Author Name
               &lt;/label&gt;
               &lt;input
                 id="author-name"
                 name="author"
                 type="text"
                 autoComplete="authorname"
                 className="w-full bg-white rounded border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
                 placeholder="author name"
                 value={selectedBook.fields.Author}
                 onChange={(e) =&gt; handleOnChange('Author', e.target.value)}
               /&gt;
             &lt;/div&gt;
             &lt;div className="mb-3"&gt;
               &lt;label htmlFor="published-date" className="sr-only"&gt;
                 Published date
               &lt;/label&gt;
               &lt;input
                 id="published-date"
                 name="date"
                 type="date"
                 autoComplete="published date"
                 className="w-full bg-white rounded border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
                 placeholder="published date"
                 value={selectedBook.fields.Published}
                 onChange={(e) =&gt; handleOnChange('Published', e.target.value)}
               /&gt;
             &lt;/div&gt;
             &lt;div className="mb-3"&gt;
               &lt;label htmlFor="currency" className="sr-only"&gt;
                 Price
               &lt;/label&gt;
               &lt;input
                 id="currency"
                 name="currency"
                 type="text"
                 autoComplete="currencyname"
                 className="w-full bg-white rounded border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
                 placeholder="price of book"
                 value={selectedBook.fields.Currency}
                 onChange={(e) =&gt; handleOnChange('Currency', e.target.value)}
               /&gt;
             &lt;/div&gt;
 
             &lt;div className="relative"&gt;
               &lt;select
                 onChange={(e) =&gt; handleOnChange('Category', e.target.value)}
                 className="rounded border appearance-none border-gray-300 py-2 w-full placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-200 focus:border-indigo-500 text-base pl-3 pr-10 sm:text-sm"
               &gt;
                 &lt;option default value={selectedBook.fields.Category}&gt;
                   {selectedBook.fields.Category}
                 &lt;/option&gt;
                 &lt;option&gt;Psychology&lt;/option&gt;
                 &lt;option&gt;Related&lt;/option&gt;
                 &lt;option&gt;Others&lt;/option&gt;
                 &lt;option&gt;Research&lt;/option&gt;
                 &lt;option&gt;Testing&lt;/option&gt;
                 &lt;option&gt;Usability&lt;/option&gt;
               &lt;/select&gt;
               &lt;span className="absolute right-0 top-0 h-full w-10 text-center text-gray-600 pointer-events-none flex items-center justify-center"&gt;
                 &lt;svg
                   fill="none"
                   stroke="currentColor"
                   strokeLinecap="round"
                   strokeLinejoin="round"
                   strokeWidth="2"
                   className="w-4 h-4"
                   viewBox="0 0 24 24"
                 &gt;
                   &lt;path d="M6 9l6 6 6-6"&gt;&lt;/path&gt;
                 &lt;/svg&gt;
               &lt;/span&gt;
             &lt;/div&gt;
           &lt;/div&gt;
 
           &lt;div className="inline-flex rounded-md shadow"&gt;
             &lt;input
               type="button"
               value="Edit My Book"
               className="inline-flex items-center justify-center px-5 py-3 border border-transparent text-base font-medium rounded-md bg-indigo-600 text-white hover:bg-indigo-700"
               onClick={editAbook}
             &gt;&lt;/input&gt;
           &lt;/div&gt;
         &lt;/form&gt;
       &lt;/div&gt;
     &lt;/section&gt;
   &lt;/div&gt;
 );
}
 
export default Editbook;
</pre>
<h3>删除图书状态机</h3>
<p>让我们从删除我们的书的机器开始。这将类似于我们以前创建的许多其他状态机。为了删除一本书，我们需要一个获取的书的列表，所以我们将创建两个文件。</p>
<p>第一个用于获取所有的书，另一个用于删除一本书。我们将为我们的机器添加一些状态来实现这一点。</p>
<pre>export const removebookMachine = {
 id: 'removebook',
 initial: 'start',
 states: {
   start: {},
   deleting: {
     invoke: {
       id: 'deletingBooks',
       src: deletingBooks,
       onDone: {
         target: 'success',
         actions: assign({ fields: (_context, event) =&gt; event.data }),
       },
       onError: {
         target: 'failed',
         actions: assign({ error: (_context, event) =&gt; event.data }),
       },
     },
   },
   success: {},
   failed: {},
 },
};
</pre>
<p>这个代码片段用于删除图书机。我们还将添加获取所有机器的机器代码。</p>
<pre>export const appMachine = Machine({
 id: 'app',
 initial: 'init',
 context: {
   books: [],
   error: undefined,
   fields: '',
 },
 states: {
   init: {},
   addbookMachine,
   removebookMachine,
   fetchOneBookMachine,
   list: {
     states: {
       loading: {
         invoke: {
           id: 'fetchAllBooks',
           src: fetchAllBooks,
           onDone: {
             target: 'success',
             actions: assign({ books: (_context, event) =&gt; event.data }),
           },
           onError: {
             target: 'failed',
             actions: assign({ error: (_context, event) =&gt; event.data }),
           },
         },
       },
       success: {},
       failed: {},
     },
   },
 },
 on: {
   LOAD_BOOKS: {
     target: 'list.loading',
   },
   DELETE_BOOK: {
     target: 'removebookMachine.deleting',
     actions: assign((_ctx, evt) =&gt; ({
       id: evt.id,
     })),
   }
 },
});
</pre>
<p>正如您可能已经注意到的，我们还用它的命名导出导入了其他机器代码。这有助于我们将状态机彼此分开。</p><div class="code-block code-block-54">
<hr/>
<h3>更多来自 LogRocket 的精彩文章:</h3>

<hr/></div>
<p>现在，让我们转到<code>Booklist</code>组件，在那里我们可以调用我们的机器来为我们调用一个动作。删除相应动作的<code>book</code>和<code>load books</code>。</p>
<pre>import React, { useContext, useEffect } from 'react';
import { MachineContext } from '../state/index';
 
import { Deleteicon } from './Deleteicon';
import { Link } from 'react-router-dom';
 
function Booklist() {
 const [machine, sendToMachine] = useContext(MachineContext);
 const { books, error } = machine.context;
 const list = books.records;
 
 useEffect(() =&gt; {
   sendToMachine('LOAD_BOOKS');
   // eslint-disable-next-line
 }, []);
 
 const removeBook = (id) =&gt; {
   sendToMachine('DELETE_BOOK', { id });
 };
 
 return (
   &lt;&gt;
     {machine.matches('list.loading') &amp;&amp; (
       &lt;span className="w-full"&gt;
         &lt;svg
           
           width="24"
           height="24"
           viewBox="0 0 24 24"
           fill="none"
           stroke="currentColor"
           strokeWidth="2"
           strokeLinecap="round"
           strokeLinejoin="round"
           className="feather feather-loader animate-spin text-2xl"
         &gt;
           &lt;line x1="12" y1="2" x2="12" y2="6"&gt;&lt;/line&gt;
           &lt;line x1="12" y1="18" x2="12" y2="22"&gt;&lt;/line&gt;
           &lt;line x1="4.93" y1="4.93" x2="7.76" y2="7.76"&gt;&lt;/line&gt;
           &lt;line x1="16.24" y1="16.24" x2="19.07" y2="19.07"&gt;&lt;/line&gt;
           &lt;line x1="2" y1="12" x2="6" y2="12"&gt;&lt;/line&gt;
           &lt;line x1="18" y1="12" x2="22" y2="12"&gt;&lt;/line&gt;
           &lt;line x1="4.93" y1="19.07" x2="7.76" y2="16.24"&gt;&lt;/line&gt;
           &lt;line x1="16.24" y1="7.76" x2="19.07" y2="4.93"&gt;&lt;/line&gt;
         &lt;/svg&gt;
       &lt;/span&gt;
     )}
     &lt;section&gt;
       {list &amp;&amp; list.length &gt; 0 &amp;&amp; (
         &lt;div&gt;
           {list.map((b) =&gt; (
             &lt;div key={b.id}&gt;
               {b.fields.Name}
               {b.fields.Published}
               {b.fields.Author}
               {b.fields.Currency}
               {b.fields.Category}
               &lt;Deleteicon clickDelete={() =&gt; removeBook(b.id)} /&gt;
               &lt;Link to={`/editbook/${b.id}`}&gt;
                 &lt;span&gt;
                   &lt;svg
                     className="w-6 h-6"
                     fill="currentColor"
                     viewBox="0 0 20 20"
                     
                   &gt;
                     &lt;path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"&gt;&lt;/path&gt;
                   &lt;/svg&gt;
                 &lt;/span&gt;
               &lt;/Link&gt;
             &lt;/div&gt;
           ))}
         &lt;/div&gt;
       )}
     &lt;/section&gt;
     &lt;div&gt;
       {machine.matches('list.failed') &amp;&amp; (
         &lt;span&gt;Data cannot be loaded {error.toString()}&lt;/span&gt;
       )}
     &lt;/div&gt;
     &lt;div&gt;
       {machine.matches('removebookMachine.deleting') &amp;&amp; (
         &lt;span&gt;
           &lt;svg
             
             width="24"
             height="24"
             viewBox="0 0 24 24"
             fill="none"
             stroke="currentColor"
             strokeWidth="2"
             strokeLinecap="round"
             strokeLinejoin="round"
             className="feather feather-loader animate-spin text-2xl"
           &gt;
             &lt;line x1="12" y1="2" x2="12" y2="6"&gt;&lt;/line&gt;
             &lt;line x1="12" y1="18" x2="12" y2="22"&gt;&lt;/line&gt;
             &lt;line x1="4.93" y1="4.93" x2="7.76" y2="7.76"&gt;&lt;/line&gt;
             &lt;line x1="16.24" y1="16.24" x2="19.07" y2="19.07"&gt;&lt;/line&gt;
             &lt;line x1="2" y1="12" x2="6" y2="12"&gt;&lt;/line&gt;
             &lt;line x1="18" y1="12" x2="22" y2="12"&gt;&lt;/line&gt;
             &lt;line x1="4.93" y1="19.07" x2="7.76" y2="16.24"&gt;&lt;/line&gt;
             &lt;line x1="16.24" y1="7.76" x2="19.07" y2="4.93"&gt;&lt;/line&gt;
           &lt;/svg&gt;
         &lt;/span&gt;
       )}
     &lt;/div&gt;
       {machine.matches('removebookMachine.success') &amp;&amp; (
                 &lt;div className="bg-green-200 px-2 py-2 text-green-800 mt-2 inline-flex"&gt;
                 Your book has been removed!
               &lt;/div&gt;
       )}
       {machine.matches('removebookMachine.failed') &amp;&amp; (
                   &lt;div className="bg-green-200 px-2 py-2 text-green-800 mt-2 inline-flex"&gt;
                   Your book has not been removed!
                 &lt;/div&gt;
       )}
   &lt;/&gt;
 );
}
 
export default Booklist;
</pre>
<p>使用这种方法，我们可以创建一个简单的、功能齐全的 CRUD 书店应用程序。在其中，我们可以存储、编辑和删除关于 Airtable 中书籍的信息。</p>
<p>利用 XState，我们可以确定应用程序的有限数量的状态，并从整体上进行更好的控制。</p>
<h2>结论</h2>
<p>作为开发人员，我们需要外部库来维护应用程序的状态。使用<code>useState</code>仅仅使用 React 的内部状态不是一个解决方案，<a href="https://blog.logrocket.com/state-driven-interfaces-with-xstate/" target="_blank" rel="noopener">因为这带来了一种基于事件的方法来编码，并且我们在使用它时会面临许多缺陷</a>。</p>
<p>毕竟，我们让状态机负责转换，是为了让应用程序的性能更加健壮。这确保了您一次只能有一个状态，这是您预定义的状态之一，并且只有在我们明确启用的情况下，才可能从某个状态转换到另一个状态。所以，我们称之为有限状态机。</p>
<p>你可以在 github 库<a href="https://github.com/ishan-me/xstate_airtable_crudApp/tree/main" target="_blank" rel="noopener">这里</a>找到文章的源代码。编码快乐！</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720"><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener"> LogRocket </a>:全面了解您的生产 React 应用</h2><p>调试 React 应用程序可能很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪 Redux 状态、自动显示 JavaScript 错误以及跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" vwo-el-id="19356441070">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<p vwo-el-id="28675660440" class="">LogRocket 结合了会话回放、产品分析和错误跟踪，使软件团队能够创建理想的 web 和移动产品体验。这对你来说意味着什么？</p>
<p>LogRocket 不是猜测错误发生的原因，也不是要求用户提供截图和日志转储，而是让您回放问题，就像它们发生在您自己的浏览器中一样，以快速了解哪里出错了。</p>
<p>不再有嘈杂的警报。智能错误跟踪允许您对问题进行分类，然后从中学习。获得有影响的用户问题的通知，而不是误报。警报越少，有用的信号越多。</p>
<p vwo-el-id="28675660750">LogRocket Redux 中间件包为您的用户会话增加了一层额外的可见性。LogRocket 记录 Redux 存储中的所有操作和状态。</p>
<p vwo-el-id="28675661060">现代化您调试 React 应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">开始免费监控</a>。</p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>