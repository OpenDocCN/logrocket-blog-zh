<html>
<head>
<title>How to place React useReducer Hooks into web workers - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何将 React useReducer 挂钩放入 web workers - LogRocket 博客</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/react-usereducer-hooks-web-workers/#0001-01-01">https://blog.logrocket.com/react-usereducer-hooks-web-workers/#0001-01-01</a></blockquote><div><article class="article-post">
<p>当一个网页加载时，它变得没有反应，直到所有的资源都完全加载。加载资源时，用户可能无法在页面上执行某些功能，如单击、选择或拖动元素。web workers 帮助我们解决了这个问题，使我们的应用程序变得动态，从而加载得更快。</p>
<p>在本教程中，我们将学习如何在 React 应用程序中使用 web workers。我们还将学习如何在带有<code>useWorkerizedReducer</code>的 web worker 中使用<code>useReducer</code>钩子。我们开始吧！</p>
<h2>目录</h2>

<h2 id="what-is-webworker">什么是网络工作者？</h2>
<p>web worker 是在后台运行的 JavaScript 脚本，不会干扰其他脚本的执行。</p>
<p>因为 JavaScript 是单线程语言，所以它不能同时运行几个脚本，这对于运行大型计算脚本来说是一个问题。web workers 帮助在后台加载繁重的计算脚本，而不会影响页面的性能。</p>
<h2 id="web-worker-syntax">web worker 语法</h2>
<pre class="“language-javascript">const worker = new Worker(new URL("./worker.js", import.meta.url), {
 type: "module",
});
</pre>
<p>worker 构造函数接受两个参数；第一个是工作者文件名，第二个是工作者类型。工人类型可以是<code>classic</code>或<code>module</code>。如果没有指定类型，默认类型将是<code>classic</code>。</p>
<p>在本教程中，我们将使用<code>module type</code>,因为减速器只能在组件内部使用。为了在 web worker 组件中使用导入功能，我们必须将<code>import.meta.url</code>添加到<code>URL constructor</code>中。我们将在教程的后面演示这一点。</p>
<h2 id="the-usereducer-hook">什么是<code>useReducer</code>钩？</h2>
<p><code>useReducer</code>是一个附加的<a href="https://blog.logrocket.com/react-hooks-cheat-sheet-unlock-solutions-to-common-problems-af4caf699e70/"> React 钩子</a>，用于存储和更新状态。它接受三个参数，<code>reducer</code>，初始状态，最后一个参数，初始函数，这是可选的:</p>
<pre class="“language-react">const [state, dispatch] = useReducer(reducer, initialArg, init);
</pre>
<p><code>useReducer</code>返回一个包含当前状态值的数组，以及一个分派函数，您可以向该函数提供要执行的操作。</p>
<p><code>dispatch</code>函数接受一个指定要执行的动作类型的对象。它本质上将动作类型传递给 reducer 函数，后者当然会更新状态。</p>
<h2 id="the-reducer-function"><code>reducer</code>功能</h2>
<p><code>reducer</code>是一个接受两个参数的函数，当前状态和一个动作对象。它使用接收到的动作来确定状态的变化并返回新的状态。</p>
<p>下面的代码演示了如何使用<code>reducer</code>函数来改变状态:</p>
<pre class="“language-react">function reducer(state, action) {
  switch (action.type) {
    case 'increment':
      return {count: state.count + 1};
    case 'decrement':
      return {count: state.count - 1};

   default:
      throw new Error();
  }
}
</pre>
<p>每当<code>reducer</code>函数被动作类型触发时，它返回新的状态作为<code>reducer</code>函数内部的变化。</p>
<p><code>action</code>是一种指示减速器如何改变状态的对象。它必须有一个<code>type</code>属性。可以在条件语句中使用<code>action</code>类型来决定状态如何变化，如上面的代码块所示。</p>
<p>要让 reducer 在 web worker 中运行，我们必须使用<code>useWorkerizedReducer</code>。</p>
<h2 id="useworkerizedreducer"><code>useWorkerizedReducer</code></h2>
<p><a href="https://github.com/surma/use-workerized-reducer"> <code>useWorkerizedReducer</code>类似于<code>useReducer</code> </a>，除了它允许 reducer 在一个 worker 中执行，允许我们创建一个动态的 React 应用程序。</p>
<p><code>useWorkerizedReducer</code>还允许将长时间运行的计算放在 reducer 中，而不会影响应用程序的响应能力。<code>useWorkerizedReducer</code>负责向工人提供<code>useReducer</code>的能力。</p>
<p>通过将缩减器的状态复制到主线程，<code>useWorkerizedReducer</code>在工作线程和主线程之间架起了一座桥梁。reducer 操纵 worker 的状态对象，唯一的补丁将是<code>postMessage()</code>通过<a href="https://blog.logrocket.com/immer-and-immutable-js-how-do-they-compare/"> Immer 来保持主线程的状态副本当前</a>。</p>
<h2 id="counter-app">构建一个简单的计数器应用程序</h2>
<p>为了学习如何将<code>Reducer</code>放置在 web worker 中，让我们创建一个简单的<code>counter</code>程序，它将在当前状态改变时返回。要创建新程序，请打开命令行并输入以下命令:</p>
<pre class="“language-bash">npx create-react-app my-app
cd my-app
npm start
</pre>
<p>应用程序安装成功后，我们需要安装<code>useWorkerizedReducer</code>作为我们程序的依赖项来使用它。要安装<code>useWorkerizedReducer</code>，请在终端中运行以下命令:</p>
<pre class="“language-bash">npm i use-workerized-reducer
</pre>
<p>现在我们已经成功安装了<code>useWorkerizedReducer</code>，让我们继续创建一个<code>worker.js</code>模块文件。</p>
<h2 id="creating-workerjs">正在创建<code>worker.js</code></h2>
<p>由于我们在<code>worker.js</code>文件中使用了<code>reducer</code>，我们将在<code>src</code>文件夹中创建<code>worker.js</code>文件。要创建<code>worker.js</code>文件，点击<strong>创建新文件</strong>，将文件命名为<code>worker.js</code>，然后将其保存在<code>src</code>文件夹中，如下图所示:</p>
<p><img data-attachment-id="96524" data-permalink="https://blog.logrocket.com/react-usereducer-hooks-web-workers/attachment/worker-js-src-folder/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/worker-js-src-folder.png" data-orig-size="730,424" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="worker-js-src-folder" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/worker-js-src-folder-300x174.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/worker-js-src-folder.png" decoding="async" class="aligncenter wp-image-96524 size-full jetpack-lazy-image" src="../Images/0c8636b9402f26d488e02f73b10599d6.png" alt="Workerjs Src Folder" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/worker-js-src-folder.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/worker-js-src-folder-300x174.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/worker-js-src-folder.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/worker-js-src-folder.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="96524" data-permalink="https://blog.logrocket.com/react-usereducer-hooks-web-workers/attachment/worker-js-src-folder/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/worker-js-src-folder.png" data-orig-size="730,424" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="worker-js-src-folder" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/worker-js-src-folder-300x174.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/worker-js-src-folder.png" decoding="async" loading="lazy" class="aligncenter wp-image-96524 size-full" src="../Images/0c8636b9402f26d488e02f73b10599d6.png" alt="Workerjs Src Folder" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/worker-js-src-folder.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/worker-js-src-folder-300x174.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/worker-js-src-folder.png"/></noscript>
<p>现在我们已经创建了<code>worker.js</code>文件，让我们在其中添加下面的<code>reducer</code>代码:</p>
<pre class="“language-react">// worker.js
import { initWorkerizedReducer } from "use-workerized-reducer";

initWorkerizedReducer(
 "counter", // Name of the reducer
 async (state, action) =&gt; {
   // Reducers can be async!
   // Manipulate `state` directly. ImmerJS will take
   // care of maintaining referential equality.
   switch (action.type) {
     case "increment":
       state.counter += 1;
       break;
     case "decrement":
       state.counter -= 1;
       break;
     default:
       throw new Error();
   }
 }
);
</pre>
<p>从上面的代码中，我们从<code>use-workerized-reducer</code>中导入<code>initWorkerizedReducer</code>，这可以从<code>useWorkerizedReducer</code>依赖项中获得。</p>
<p><code>initWorkerizedReducer()</code>带两个参数；第一个是<code>reducer name(counter)</code>，第二个是<code>async function</code>。</p>
<h2 id="adding-webworker">添加 web worker</h2>
<p>现在我们已经准备好了<code>worker.js</code>文件，我们需要从<code>use-workerized-reducer/react</code>导入<code>useWorkerizedReducer</code>，这使我们能够从 worker 文件中调用<code>reducer</code>函数:</p>
<pre class="“language-react">// main.js
import { render, h, Fragment } from "react";
import { useWorkerizedReducer } from "use-workerized-reducer/react";

// Spin up the worker running the reducers.
const worker = new Worker(new URL("./worker.js", import.meta.url), {
 type: "module",
});

function App() {
 // A worker can contain multiple reducers, each with a unique name.
 // `busy` is true if any action is still being processed.
 const [state, dispatch, busy] = useWorkerizedReducer(
   worker,
   "counter", // Reducer name
   { counter: 0 } // Initial state
 );

 return (
   &lt;&gt;
     Count: {state.counter}
     &lt;button disabled={busy} onClick={() =&gt; dispatch({ type: "decrement" })}&gt;
       -
     &lt;/button&gt;
     &lt;button disabled={busy} onClick={() =&gt; dispatch({ type: "increment" })}&gt;
       +
     &lt;/button&gt;
   &lt;/&gt;
 );
}

export default App;
</pre>
<p><code>useWorkerizedReducer</code>函数接受三个参数并返回一个值。当前状态是第一个参数，动作是第二个参数，初始状态是第三个参数。我们正在处理的数据是状态。一个<code>dispatch</code>函数执行一个传递给<code>reducer</code>函数的动作。</p>
<p><code>Busy</code>将保持<code>true</code>，直到工作者的初始状态<code>counter</code>被成功复制到工作者。此后，如果动作仍在处理中，<code>Busy</code>返回 true，否则返回 false。</p><div class="code-block code-block-54">
<hr/>
<h3>更多来自 LogRocket 的精彩文章:</h3>

<hr/></div>
<p><code>reducer</code>根据动作类型改变状态。动作类型<code>increment</code>、<code>decrement</code>和<code>reset</code>都是在被调度时更新应用状态的动作类型。</p>
<p>初始状态是<code>{ counter: 0 }</code>。当<code>increment</code>动作类型被分派时，我们简单地设置 count <code>{state.count + 1}</code>来增加状态。</p>
<h2 id="running-the-program">运行程序</h2>
<p>要启动该应用程序，请在命令行中输入以下命令:</p>
<pre class="“language-bash">npm start
</pre>
<h2 id="conclusion">结论</h2>
<p>在本文中，我们简要介绍了 web worker 和 React 中的附加钩子<code>useReducer</code>，以及如何在 React 应用程序中构建和添加 web worker 文件。</p>
<p>我们还讨论了<code>useWorkerizedReducer</code>，它为 web 工作者带来了<code>useReducer</code>的功能。最后，我们介绍了在<code>useWorkerizedReducer</code>的帮助下在 web worker 内部使用 reducer。</p>
<p>我希望你喜欢这篇文章！如果你有任何问题，一定要留下评论。编码快乐！</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用 LogRocket 消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款 React analytics 解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket 告诉您 React 应用程序中实际影响用户的最具影响力的 bug 和 UX 问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS 异常、前端性能指标和用户交互。然后，LogRocket 使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的 React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试 LogRocket】。</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>