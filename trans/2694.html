<html>
<head>
<title>getInitialProps vs. getServerSideProps in Next.js - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Next.js - LogRocket 博客中的 getInitialProps 与 getServerSideProps</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/getinitialprops-vs-getserversideprops-nextjs/#0001-01-01">https://blog.logrocket.com/getinitialprops-vs-getserversideprops-nextjs/#0001-01-01</a></blockquote><div><div class="mainheading">



<h1 class="posttitle">Next.js 中的<code>getInitialProps</code>与<code>getServerSideProps</code></h1>
<h2 class="post-subtitle"/>
<p><span class="post-date"><time class="post-date">2022 年 2 月 22 日</time> </span> <span class="dot"/> <span class="readingtime"> 2 分钟阅读</span> <span class="wordcount"> 678 </span> <span class="logrocket_editor"/></p>
</div>
<article class="article-post">
<p>在<a href="https://blog.logrocket.com/the-latest-features-in-next-js/"> Next.js v9.3 包含的变化中有<code>getServerSideProps</code> </a>的引入。当涉及到为服务器端呈现的页面定义道具时，<a href="https://nextjs.org/docs/api-reference/data-fetching/get-server-side-props"> <code>getServerSideProps</code> </a>实质上取代了<code><a href="https://nextjs.org/docs/api-reference/data-fetching/get-initial-props">getInitialProps</a></code>。</p>
<p>如今，一些开发人员偶尔会遇到关于使用哪种方法的的<a href="https://github.com/vercel/next.js/discussions/11211">困惑。在这篇文章中，我们将探索<code>getServerSideProps</code>和<code>getInitialProps</code>是如何工作的，并分别回顾一个例子。我们开始吧！</a></p>
<h2 id="getserversideprops-getstaticprops"><code>getServerSideProps</code>和<code>getStaticProps</code>的内部工作原理</h2>
<p>本质上，如果您需要在发出任何请求之前在构建时呈现页面，那么您应该使用<code>getStaticProps</code>。<code>getStaticProps</code>会将页面标记为静态呈现，这意味着在下一次构建之前不会重新呈现。虽然这种方法对于速度和 SEO 来说很好，但是对于经常变化的动态数据来说就不太好了。</p>
<p>如果希望在请求时呈现页面，可以在响应请求之前使用<code>getServerSideProps</code>在服务器上呈现页面。<code>getServerSideProps</code>将在每个请求上标记要呈现的页面。在这种方法中，服务器每次都必须构建页面，这会降低整个过程的速度。然而，这种方法仍然比使用普通的 React 提供了更多的 SEO 好处，后者可以在客户端呈现你的内容。</p>
<p><img data-attachment-id="94066" data-permalink="https://blog.logrocket.com/getinitialprops-vs-getserversideprops-nextjs/next-getserversideprops-getstaticprops-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/02/next-getserversideprops-getstaticprops-diagram.png" data-orig-size="827,240" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="next-getserversideprops-getstaticprops-diagram" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/02/next-getserversideprops-getstaticprops-diagram-300x87.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/02/next-getserversideprops-getstaticprops-diagram.png" decoding="async" class="aligncenter wp-image-94066 size-full jetpack-lazy-image" src="../Images/5029a14b89ce7c658aae836429d8b83a.png" alt="Next Getserversideprops Getstaticprops Diagram" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/02/next-getserversideprops-getstaticprops-diagram.png 827w, https://blog.logrocket.com/wp-content/uploads/2022/02/next-getserversideprops-getstaticprops-diagram-300x87.png 300w, https://blog.logrocket.com/wp-content/uploads/2022/02/next-getserversideprops-getstaticprops-diagram-768x223.png 768w, https://blog.logrocket.com/wp-content/uploads/2022/02/next-getserversideprops-getstaticprops-diagram-825x240.png 825w" data-lazy-sizes="(max-width: 827px) 100vw, 827px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/02/next-getserversideprops-getstaticprops-diagram.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/02/next-getserversideprops-getstaticprops-diagram.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="94066" data-permalink="https://blog.logrocket.com/getinitialprops-vs-getserversideprops-nextjs/next-getserversideprops-getstaticprops-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/02/next-getserversideprops-getstaticprops-diagram.png" data-orig-size="827,240" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="next-getserversideprops-getstaticprops-diagram" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/02/next-getserversideprops-getstaticprops-diagram-300x87.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/02/next-getserversideprops-getstaticprops-diagram.png" decoding="async" loading="lazy" class="aligncenter wp-image-94066 size-full" src="../Images/5029a14b89ce7c658aae836429d8b83a.png" alt="Next Getserversideprops Getstaticprops Diagram" srcset="https://blog.logrocket.com/wp-content/uploads/2022/02/next-getserversideprops-getstaticprops-diagram.png 827w, https://blog.logrocket.com/wp-content/uploads/2022/02/next-getserversideprops-getstaticprops-diagram-300x87.png 300w, https://blog.logrocket.com/wp-content/uploads/2022/02/next-getserversideprops-getstaticprops-diagram-768x223.png 768w, https://blog.logrocket.com/wp-content/uploads/2022/02/next-getserversideprops-getstaticprops-diagram-825x240.png 825w" sizes="(max-width: 827px) 100vw, 827px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/02/next-getserversideprops-getstaticprops-diagram.png"/></noscript>
<p>关于语言和框架的更新，向后兼容性很重要。即使将来的项目不再需要旧的模式和方法，它们仍然被维护以避免破坏遗留代码和偶尔的边缘情况。这就是<code>getInitialProps</code>的情况，它的行为几乎与<code>getServerSideProps</code>相同。</p>
<h2><code>getInitialProps</code>和<code>getServerSideProps</code>有区别吗？</h2>
<p>传统的<code>getInitialProps</code>和新的<code>getServerSideProps</code>之间的主要区别是如何在过渡期间使用该功能，当用户点击一个<code>Link</code>来访问你网站的不同部分。</p>
<p>使用<code>getInitialProps</code>，转换将在初始页面加载时在服务器端执行，然后在页面转换期间在客户端执行。但是，如果逻辑涉及到数据库之类的东西，而这些东西在客户机上可能是不可访问的，这就可能产生问题。</p>
<p>例如，在下面的代码片段中，直接来自数据库的用户的<code>fetch</code>将处理初始页面加载。但是，它可能会在转换时失败，因为<code>User</code>模型在客户机上不可用。</p>
<p>作为解决方案，我们可以使用 Next.js API 端点。但是，这种方法比直接访问服务器端的数据库效率低:</p>
<pre>// Import a User model
import User from "../models/User"
function Page({ User }) {
    return &lt;div&gt;Username: {User.username}&lt;/div&gt;
  }

  Page.getInitialProps = async (ctx) =&gt; {
    // Get user id
    const User = await User.findOne(ctx.query.id)
    // return props
    return {
        User
    }
  }

  export default Page
</pre>
<p>另一方面，<code>getServerSideProps</code>将在初始页面加载时执行服务器端的转换。在页面转换时，<code>getServerSideProps</code>将对服务器进行 API 调用，在服务器上再次运行逻辑，并将结果作为 JSON 返回。</p>
<p>通过这种改变，我们解决了使用<code>getInitialProps</code>时出现的上下文切换问题。在下面的例子中，您可以直接调用数据库，它将在初始页面加载和转换时正常工作:</p>
<pre>// Import a User model
import User from "../models/User"
function Page({ User }) {
    return &lt;div&gt;Username: {User.username}&lt;/div&gt;
  }
  export async function getServerSideProps(context) {
    // Get user id
    const User = await User.findOne(ctx.query.id)
    return {
      props: {User}, // will be passed to the page component as props
    }
  } 

  export default Page
</pre>
<h2>你应该用哪一个？</h2>
<p>如果您正在创建更新的 Next.js 应用程序，可能没有理由使用像<code>getInitialProps</code>这样的遗留方法，因为<code>getServerSideProps</code>和<code>getStaticProps</code>提供了更好的功能和语义。</p>
<p>在本文中，我们阐明了<code>getServerSideProps</code>和<code>getInitialProps</code>之间的区别，看一个我们如何用<code>getServerSideProps</code>解决<code>getInitialProps</code>中的上下文切换的例子。</p>
<p>我希望你喜欢这篇文章，如果你有任何问题，请留下评论。要了解更多关于 Next.js 和其他元框架的信息，请务必查看这篇比较<a href="https://blog.logrocket.com/react-remix-vs-next-js-vs-sveltekit/"> Next.js 和 Remix </a>的文章。</p><div class="code-block code-block-30">
<div class="blog-plug inline-plug next-plug"><h2><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank"> LogRocket </a>:全面了解生产 Next.js 应用</h2><p>调试下一个应用程序可能会很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪状态、自动显示 JavaScript 错误、跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-lazy-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/></noscript></a><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><p>LogRocket 就像是网络和移动应用的 DVR，记录下你的 Next.js 应用上发生的一切。您可以汇总并报告问题发生时应用程序的状态，而不是猜测问题发生的原因。LogRocket 还可以监控应用程序的性能，报告客户端 CPU 负载、客户端内存使用等指标。</p><p>LogRocket Redux 中间件包为您的用户会话增加了一层额外的可见性。LogRocket 记录 Redux 存储中的所有操作和状态。</p>
<p>让您调试 Next.js 应用的方式现代化— <a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>