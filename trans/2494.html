<html>
<head>
<title>Creating animations with lottie-react-native - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用 lottie-react-native - LogRocket 博客创作动画</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/creating-animations-lottie-react-native/#0001-01-01">https://blog.logrocket.com/creating-animations-lottie-react-native/#0001-01-01</a></blockquote><div><article class="article-post">
<h2>洛蒂是什么？</h2>
<p>Lottie 是一个开源的动画库，用于渲染基于 Lottie 的动画。基于 Lottie 的文件较小，但保留了它们的质量，并且可以进行交互。作为开发者，我们可以随时用代码操纵基于 Lottie 的动画。最成功和最著名的移动应用程序使用 Lottie 为其用户提供增强的视觉体验。</p>
<p>LottieFiles 最初是由<a href="https://medium.com/airbnb-engineering/introducing-lottie-4ff4a0afac0e" target="_blank" rel="noopener"> Airbnb </a>推出的，用于无缝集成原生 iOS、Android 和 React 原生应用中的复杂动画。</p>
<p>从本质上来说，LottieFiles 是使用名为<a href="https://aescripts.com/bodymovin/" target="_blank" rel="noopener"> Bodymovin </a>的扩展名从<a href="https://www.adobe.com/in/products/aftereffects.html" target="_blank" rel="noopener"> Adobe After Effects </a>动画文件中直接导出的<code>JSON</code>文件。然后，<a href="https://www.npmjs.com/package/lottie-react-native" target="_blank" rel="noopener"> lottie-react-native </a>用于在 React Native 中本地渲染 lottie 动画。</p>
<h2>在 React Native 中实现洛蒂动画</h2>
<p>为了在我们的 React Native 项目中实现基于 Lottie 的动画，我们将使用<a href="https://www.npmjs.com/package/lottie-react-native" target="_blank" rel="noopener"> lottie-react-native </a>库，它是原生<a href="https://github.com/airbnb/lottie-ios" target="_blank" rel="noopener"> iOS </a>和<a href="https://github.com/airbnb/lottie-android" target="_blank" rel="noopener"> Android </a>库的包装器。</p>
<p>我们还需要 LottieFiles，我们实际上希望在 UI 中以动画的形式显示它。</p>
<p>如果您有 After Effects 的经验，您可以创建自己的动画，并通过 Bodymovin 将其导出为 JSON 文件。</p>
<p>如果你是开发者，可以使用<a href="https://lottiefiles.com/" target="_blank" rel="noopener"> LottieFiles </a>。他们有来自世界各地的人们已经创建的大量 Lottie 文件，所以你可以选择任何适合你的用例的动画。</p>
<h2>洛蒂入门</h2>
<p>我们将构建一个简单的 React 本地应用程序，它将有三个不同的动画:</p>
<ul>
<li>一个随机图片列表。当我们向下滚动时，我们将在标题处看到一个滚动进度动画，它将根据列表的<code>scrollPosition</code>动态更新</li>
<li>当用户喜欢一张图片时的“喜欢”动画</li>
<li>当用户不喜欢图片时的“不喜欢”动画</li>
</ul>
<p>用户界面如下所示:</p>
<p><img data-attachment-id="83658" data-permalink="https://blog.logrocket.com/creating-animations-lottie-react-native/scrolling-animation-ios/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/12/scrolling-animation-ios.gif" data-orig-size="133,283" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Scrolling animation in iOS" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/12/scrolling-animation-ios.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/12/scrolling-animation-ios.gif" decoding="async" class="aligncenter size-full wp-image-83658 jetpack-lazy-image" src="../Images/836853cf4f89802e5d7c7c87af8f6463.png" alt="Scrolling Animation in iOS" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/12/scrolling-animation-ios.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/12/scrolling-animation-ios.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="83658" data-permalink="https://blog.logrocket.com/creating-animations-lottie-react-native/scrolling-animation-ios/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/12/scrolling-animation-ios.gif" data-orig-size="133,283" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Scrolling animation in iOS" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/12/scrolling-animation-ios.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/12/scrolling-animation-ios.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-83658" src="../Images/836853cf4f89802e5d7c7c87af8f6463.png" alt="Scrolling Animation in iOS" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/12/scrolling-animation-ios.gif"/></noscript><br/>
<img data-attachment-id="83660" data-permalink="https://blog.logrocket.com/creating-animations-lottie-react-native/scrolling-animation-android/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/12/scrolling-animation-android.gif" data-orig-size="144,320" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Scrolling animation in Android" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/12/scrolling-animation-android-135x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/12/scrolling-animation-android.gif" decoding="async" class="aligncenter size-full wp-image-83660 jetpack-lazy-image" src="../Images/b88d754a552035a888082917171ebe0d.png" alt="Scrolling Animation in Android" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/12/scrolling-animation-android.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/12/scrolling-animation-android.gif"/><noscript><img data-lazy-fallback="1" data-attachment-id="83660" data-permalink="https://blog.logrocket.com/creating-animations-lottie-react-native/scrolling-animation-android/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/12/scrolling-animation-android.gif" data-orig-size="144,320" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Scrolling animation in Android" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/12/scrolling-animation-android-135x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/12/scrolling-animation-android.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-83660" src="../Images/b88d754a552035a888082917171ebe0d.png" alt="Scrolling Animation in Android" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/12/scrolling-animation-android.gif"/></noscript>
<blockquote><p>您可以在这个<a href="https://github.com/hrupesh/lottieAnimationsRN" target="_blank" rel="noopener">库</a>中查看完整的代码。</p></blockquote>
<p>我们开始吧！要创建新的 React 本地项目，请在终端窗口中键入以下内容:</p>
<pre>react-native init LottieAnimations
</pre>
<p>我已经把这个项目命名为<code>LottieAnimations</code>。通过执行以下命令，您可以将终端中的当前工作目录更改为我们刚刚创建的项目:</p>
<pre>cd &lt;Your-Project-Name&gt;
</pre>
<p>接下来，我们将在 iOS 项目中安装 Pods，方法是将<code>cwd</code>更改为<code>iOS</code>并执行以下命令:</p>
<pre>cd iOS
pod install
cd ..
</pre>
<p>接下来，在 iOS 和 Android 上运行应用程序。如果使用纱线:</p>
<pre>yarn ios
yarn android
</pre>
<p>如果您使用 npm:</p>
<pre>npm run ios
npm run android
</pre>
<p>一旦应用程序在我们的设备上运行，您将看到默认的 React 本机样板代码。让我们删除<code>App.js</code>中的代码，并粘贴以下内容:</p>
<pre>import React from 'react'
import { SafeAreaView, Text } from 'react-native'
const App = () =&gt; {
    return (
        &lt;SafeAreaView&gt;
            &lt;Text&gt;Lottie Animations&lt;/Text&gt;
        &lt;/SafeAreaView&gt;
    );
};
export default App;
</pre>
<p>现在，你应该会在屏幕上看到文字“洛蒂动画”。</p>
<p><img data-attachment-id="83662" data-permalink="https://blog.logrocket.com/creating-animations-lottie-react-native/black-screen-lottie-animations/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/12/black-screen-lottie-animations.jpeg" data-orig-size="730,1581" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Black screen with words lottie-animations" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/12/black-screen-lottie-animations-139x300.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/12/black-screen-lottie-animations-473x1024.jpeg" decoding="async" class="aligncenter size-full wp-image-83662 jetpack-lazy-image" src="../Images/6ccbe266bca7771986e3aeee655be8a3.png" alt="Black Screen With Words lottie-animations" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/12/black-screen-lottie-animations.jpeg 730w, https://blog.logrocket.com/wp-content/uploads/2021/12/black-screen-lottie-animations-139x300.jpeg 139w, https://blog.logrocket.com/wp-content/uploads/2021/12/black-screen-lottie-animations-473x1024.jpeg 473w, https://blog.logrocket.com/wp-content/uploads/2021/12/black-screen-lottie-animations-709x1536.jpeg 709w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/12/black-screen-lottie-animations.jpeg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/12/black-screen-lottie-animations.jpeg"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="83662" data-permalink="https://blog.logrocket.com/creating-animations-lottie-react-native/black-screen-lottie-animations/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/12/black-screen-lottie-animations.jpeg" data-orig-size="730,1581" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Black screen with words lottie-animations" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/12/black-screen-lottie-animations-139x300.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/12/black-screen-lottie-animations-473x1024.jpeg" decoding="async" loading="lazy" class="aligncenter size-full wp-image-83662" src="../Images/6ccbe266bca7771986e3aeee655be8a3.png" alt="Black Screen With Words lottie-animations" srcset="https://blog.logrocket.com/wp-content/uploads/2021/12/black-screen-lottie-animations.jpeg 730w, https://blog.logrocket.com/wp-content/uploads/2021/12/black-screen-lottie-animations-139x300.jpeg 139w, https://blog.logrocket.com/wp-content/uploads/2021/12/black-screen-lottie-animations-473x1024.jpeg 473w, https://blog.logrocket.com/wp-content/uploads/2021/12/black-screen-lottie-animations-709x1536.jpeg 709w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/12/black-screen-lottie-animations.jpeg"/></noscript>
<p>现在，让我们给我们的应用程序添加一些样式。我们将样式保存在不同的文件中，以保持我们的<code>App.js</code>文件干净。在项目的根目录下创建一个<code>AppStyles.js</code>文件:</p>
<pre>import {StyleSheet} from 'react-native';
export default StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: 'rgb(255, 255, 255)',
  },
  header: {
    height: 80,
    width: '100%',
    backgroundColor: 'rgb(255, 255, 255)',
    alignItems: 'stretch',
    justifyContent: 'center',
    zIndex: 1,
  },
});
</pre>
<p>这里，我们为<code>header</code>添加了一个样式对象，但是我们没有为它创建任何组件。让我们将<code>header</code>添加到我们的应用程序中。将这段代码添加到<code>SafeAreaView</code>组件内的<code>App.js</code>文件中:</p>
<pre>      &lt;StatusBar
        backgroundColor={'rgb(255, 255, 255)'}
        barStyle={'dark-content'}
      /&gt;
      &lt;View style={styles.header}&gt;
        {/* We will add Lottie Animation file here */}
      &lt;/View&gt;
</pre>
<p>现在，让我们在<code>header</code>中添加动画。请注意，我们添加了一个<code>StatusBar</code>组件，我们将使用它来覆盖 Android 和 iOS 中的原生<code>StatusBar</code>的样式。</p>
<h2>添加洛蒂动画反应原生</h2>
<p>接下来，将 lottie-react-native 包安装到我们的项目中:</p>
<pre>yarn add lottie-react-native <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="6804071c1c010d4501071b285b465a465b">[email protected]</a>
</pre>
<blockquote><p>注意:您需要根据您的 React Native 版本安装特定版本的<code>lottie-ios</code>，您可以在这里勾选<a href="https://www.npmjs.com/package/lottie-react-native/v/5.0.1#:~:text=Versioning,the%20compatibility%20list%3A" target="_blank" rel="noopener">。</a></p></blockquote>
<p>为 iOS 项目安装 pod。</p>
<pre>cd ios
pod install
</pre>
<p>安装完成后，我们需要重新构建我们的应用程序，以便将库文件添加到原生 Android 中，并编译 iOS 项目。</p>
<pre>yarn ios
yarn android
</pre>
<p>在我们从 lottie-react-native 添加<code>LottieView</code>组件之前，我们需要我们的资产或<code>JSON</code> Lottie 文件。如果你想添加一些其他洛蒂动画，你可以从<a href="https://lottiefiles.com/" target="_blank" rel="noopener">洛蒂文件</a>下载文件。为了节省你搜索动画的时间，你可以从<a href="https://github.com/hrupesh/lottieAnimationsRN/tree/main/assets" target="_blank" rel="noopener">这里</a>下载我在这个项目中使用的资源。</p>
<p>下载并保存在我们应用程序根目录下的<code>assets</code>文件夹中。现在，向该文件夹添加一个<code>index.js</code>文件，将资产导出到代码中。该目录将如下所示:</p>
<p><img data-attachment-id="83664" data-permalink="https://blog.logrocket.com/creating-animations-lottie-react-native/assets-directory/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/12/assets-directory.png" data-orig-size="379,112" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Assets directory" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/12/assets-directory-300x89.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/12/assets-directory.png" decoding="async" class="aligncenter size-full wp-image-83664 jetpack-lazy-image" src="../Images/49f435a753ca9ebfe8e6ccfb0d1eee12.png" alt="Assets Directory" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/12/assets-directory.png 379w, https://blog.logrocket.com/wp-content/uploads/2021/12/assets-directory-300x89.png 300w" data-lazy-sizes="(max-width: 379px) 100vw, 379px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/12/assets-directory.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/12/assets-directory.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="83664" data-permalink="https://blog.logrocket.com/creating-animations-lottie-react-native/assets-directory/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/12/assets-directory.png" data-orig-size="379,112" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Assets directory" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/12/assets-directory-300x89.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/12/assets-directory.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-83664" src="../Images/49f435a753ca9ebfe8e6ccfb0d1eee12.png" alt="Assets Directory" srcset="https://blog.logrocket.com/wp-content/uploads/2021/12/assets-directory.png 379w, https://blog.logrocket.com/wp-content/uploads/2021/12/assets-directory-300x89.png 300w" sizes="(max-width: 379px) 100vw, 379px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/12/assets-directory.png"/></noscript>
<p>在<code>index.js</code>文件中添加以下代码:</p>
<pre>const assets = {
  lottieFiles: {
    planePath: require('./planePath.json'),
    like: require('./like.json'),
    unLike: require('./unLike.json'),
  },
};
export default assets;
</pre>
<p>现在我们已经有了资产，我们可以在我们的 UI 上显示这些动画。</p>
<p>切换到<code>App.js</code>文件，导入<code>LottieView</code>组件，负责渲染洛蒂动画。</p>
<pre>import LottieView from 'lottie-react-native';
</pre>
<p>然后将该组件添加到<code>header</code>:</p>
<pre>  &lt;View style={styles.header} &gt;      
    &lt;LottieView
      autoplay
      loop
      source={Assets.lottieFiles.planePath}
      colorFilters={[{keypath: 'Plane', color: 'rgb(255, 100, 0)'}]}
    /&gt;
  &lt;/View&gt;
</pre>
<p>当您在设备上保存并运行应用程序时，您会看到动画自动在标题中运行。很酷吧。</p>
<p>请注意，我们使用<code>autoplay</code>和<code>loop</code>来让动画知道它应该在渲染后自动开始播放，并在完成后继续播放。</p>
<p>我们还使用了<code>colorFilters</code>道具，它可以用来改变动画文件中特定层的任何属性值。在我们的例子中，我们正在改变<code>Plane</code>的<code>color</code>。</p>
<p>这个组件为我们提供了一堆<a href="https://github.com/lottie-react-native/lottie-react-native/blob/master/docs/api.md" target="_blank" rel="noopener">有用的道具</a>。</p>
<h2>创建滚动进度指示器动画</h2>
<p>让我们创建一个动画，让用户知道他们在<code>ScrollView</code>中的位置。首先，向应用程序添加一个<code>List</code>。</p>
<p>创建一个名为<code>StaticData.js</code>的文件，并添加以下代码:</p>
<pre>export const StaticData = [
  {key: 1, title: 'First Item', img: 'https://picsum.photos/800'},
  {key: 2, title: 'Second Item', img: 'https://picsum.photos/800'},
  {key: 3, title: 'Third Item', img: 'https://picsum.photos/800'},
  {key: 4, title: 'Fourth Item', img: 'https://picsum.photos/800'},
  {key: 5, title: 'Fifth Item', img: 'https://picsum.photos/800'},
  {key: 6, title: 'Sixth Item', img: 'https://picsum.photos/800'},
];
</pre>
<p>这将导出一个<code>StaticData</code>数组，我们将把它用作我们的<code>FlatList</code>的<code>DataSource</code>。</p>
<pre>import { StaticData } from './StaticData';
</pre>
<p>现在，在<code>App.js</code>中添加<code>FlatList</code>以在 UI 上显示图像列表。</p>
<pre>  &lt;FlatList
    showsVerticalScrollIndicator={false}
    data={StaticData}
    keyExtractor={item =&gt; item?.key}
    renderItem={({item}) =&gt; &lt;ImageCard data={item} /&gt;}
    contentContainerStyle={styles.list}
  /&gt;
</pre>
<p>注意，我们正在呈现一个在 UI 中显示图像的<code>ImageCard</code>组件，但是我们还没有创建这个组件。</p>
<p>在项目的根目录下创建一个<code>ImageCard.js</code>文件，并添加以下代码:</p>
<pre>import LottieView from 'lottie-react-native';
import React, {useState} from 'react';
import {Image, Text, View} from 'react-native';
import styles from './AppStyles';
import Assets from './assets';

export const ImageCard = ({data}) =&gt; {
  const [isLiked, setIsLiked] = useState(false);

  return (
    &lt;View
      key={data?.key}
      style={styles.item}
    &gt;
      &lt;Image
        source={{uri: data?.img}}
        resizeMode={'cover'}
        style={styles.itemImage}
      /&gt;
      &lt;View style={styles.cardRow}&gt;
        &lt;Text style={styles.itemText}&gt;{data?.title}&lt;/Text&gt;
        &lt;Text style={styles.likeText}&gt;{isLiked ? 'UnLike' : 'Like'}&lt;/Text&gt;
      &lt;/View&gt;
    &lt;/View&gt;
  );
};
</pre>
<p>这将显示一个图像，下面有一些数据。注意我们有<code>isLiked</code>状态，我们用它来表示喜欢和不喜欢的动画。</p>
<p>我们必须为这些新组件创建样式。将所有样式添加到我们的<code>AppStyles.js</code>后，它看起来会是这样的:</p>
<pre>import {StyleSheet} from 'react-native';
export default StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: 'rgb(255, 255, 255)',
  },
  header: {
    height: 80,
    width: '100%',
    backgroundColor: 'rgb(255, 255, 255)',
    alignItems: 'stretch',
    justifyContent: 'center',
    zIndex: 1,
  },
  text: {
    fontSize: 30,
    color: '#fff',
  },
  list: {
    backgroundColor: 'rgb(240, 240, 240)',
    paddingVertical: 14,
  },
  item: {
    paddingVertical: 14,
    marginVertical: 10,
    zIndex: 1,
  },
  itemText: {
    color: 'rgb(0, 0, 0)',
    fontSize: 20,
    letterSpacing: 2,
    fontWeight: 'bold',
    paddingTop: 12,
  },
  likeText: {
    color: 'rgb(255, 100, 0)',
    fontWeight: '600',
    fontSize: 16,
    letterSpacing: 2,
  },
  itemImage: {
    height: 400,
    width: '100%',
  },
  cardRow: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'baseline',
    paddingHorizontal: 10,
  },
  infoText: {
    fontSize: 12,
    color: 'rgb(255, 100, 0)',
    fontWeight: '900',
    letterSpacing: 0.2,
    lineHeight: 12,
    textAlign: 'center',
    zIndex: 2,
    alignSelf: 'center',
    position: 'absolute',
    bottom: -24,
  },
  overlayLottie: {
    ...StyleSheet.absoluteFillObject,
    zIndex: 10,
    justifyContent: 'center',
    alignItems: 'center',
    backgroundColor: 'rgba(240, 240, 240, 0.4)',
  },
});
</pre>
<p>这些是我们将在这个项目中使用的所有样式，其用户界面如下所示:</p>
<p><img data-attachment-id="83666" data-permalink="https://blog.logrocket.com/creating-animations-lottie-react-native/animation-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/12/animation-example.jpeg" data-orig-size="730,1581" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Animation example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/12/animation-example-139x300.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/12/animation-example-473x1024.jpeg" decoding="async" class="aligncenter size-full wp-image-83666 jetpack-lazy-image" src="../Images/fa522edf3dee4352bc5ff293f875f54b.png" alt="Animation Example" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/12/animation-example.jpeg 730w, https://blog.logrocket.com/wp-content/uploads/2021/12/animation-example-139x300.jpeg 139w, https://blog.logrocket.com/wp-content/uploads/2021/12/animation-example-473x1024.jpeg 473w, https://blog.logrocket.com/wp-content/uploads/2021/12/animation-example-709x1536.jpeg 709w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/12/animation-example.jpeg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/12/animation-example.jpeg"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="83666" data-permalink="https://blog.logrocket.com/creating-animations-lottie-react-native/animation-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/12/animation-example.jpeg" data-orig-size="730,1581" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Animation example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/12/animation-example-139x300.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/12/animation-example-473x1024.jpeg" decoding="async" loading="lazy" class="aligncenter size-full wp-image-83666" src="../Images/fa522edf3dee4352bc5ff293f875f54b.png" alt="Animation Example" srcset="https://blog.logrocket.com/wp-content/uploads/2021/12/animation-example.jpeg 730w, https://blog.logrocket.com/wp-content/uploads/2021/12/animation-example-139x300.jpeg 139w, https://blog.logrocket.com/wp-content/uploads/2021/12/animation-example-473x1024.jpeg 473w, https://blog.logrocket.com/wp-content/uploads/2021/12/animation-example-709x1536.jpeg 709w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/12/animation-example.jpeg"/></noscript>
<p>让我们开始在头部动画我们的飞机！动画非常简单——我们只需要在用户滚动列表时改变我们的<code>LottieView</code>组件的<code>progress</code>属性。</p>
<p>我们将使用<code>FlatList</code>的<code>onScroll</code>事件，每次用户滚动列表时都会触发该事件。我们还会使用<code>scrollEventThrottle</code>，这样我们就不会错过任何来自<code>ScrollView</code> / <code>FlatList</code>的滚动事件。</p>
<p>进行这些更改后，<code>App.js</code>将如下所示:</p>
<pre>import LottieView from 'lottie-react-native';
import React, {useRef} from 'react';
import {Animated, SafeAreaView, StatusBar, Text, View} from 'react-native';
import styles from './AppStyles';
import Assets from './assets';
import {ImageCard} from './ImageCard';
import {StaticData} from './StaticData';
const App = () =&gt; {
  const scrollPosition = useRef(new Animated.Value(0)).current;
  const handleScroll = ({nativeEvent}) =&gt; {
    const calculatedScrollPosition =
      nativeEvent.contentOffset.y /
      (nativeEvent.contentSize.height - nativeEvent.layoutMeasurement.height);
    scrollPosition.setValue(calculatedScrollPosition);
  };

  return (
    &lt;SafeAreaView style={styles.container}&gt;
      &lt;StatusBar
        backgroundColor={'rgb(255, 255, 255)'}
        barStyle={'dark-content'}
      /&gt;
      &lt;View style={styles.header}&gt;
        &lt;LottieView
          progress={scrollPosition.interpolate({
            inputRange: [0, 1],
            outputRange: [0, 1],
            extrapolate: 'clamp',
          })}
          source={Assets.lottieFiles.planePath}
          colorFilters={[{keypath: 'Plane', color: 'rgb(255, 100, 0)'}]}
        /&gt;
      &lt;/View&gt;
      &lt;FlatList
        bounces={false}
        showsVerticalScrollIndicator={false}
        scrollEventThrottle={1}
        onScroll={handleScroll}
        data={StaticData}
        keyExtractor={item =&gt; item?.key}
        renderItem={({item}) =&gt; &lt;ImageCard data={item} /&gt;}
        contentContainerStyle={styles.list}
      /&gt;
    &lt;/SafeAreaView&gt;
  );
};

export default App;
</pre>
<p>我们创建了以下内容:</p>
<ul>
<li><code>Animated</code>变量<code>scrollPosition</code>，它将跟踪用户在<code>ScrollView</code>中的位置</li>
<li><code>handleScroll</code>方法，每次用户滚动列表时都会触发。它根据事件中接收的值计算用户的滚动位置，然后将该值设置为<code>scrollPosition</code></li>
<li>我们的<code>LottieView</code>组件中的一个<code>progress</code>道具，使用了来自<code>0 to 1</code>的<code>scrollPosition</code>的<code>interpolated</code>值</li>
<li>我们已经在<code>FlatList</code>中将<code>bounces</code>设置为假，这样我们就不会在 iOS 中得到负的<code>scrollValues</code></li>
</ul>
<p>如果您保存并重新运行该应用程序，您将会看到当您滚动列表时，飞机会移动。</p>
<h2>用 Lottie 创建喜欢和不喜欢的动画</h2>
<p>让我们创造我们喜欢和不喜欢的动画。我们将使用的逻辑是这样的:当用户<code>longPresses</code>图片时，图片被喜欢。但是如果用户在喜欢该图像之后再次<code>longPresses</code>该图像，则该图像变得不喜欢。我们将为每个动作播放两秒钟的动画。</p>
<p>在<code>ImageCard.js</code>中修改之后，我们的文件看起来会是这样的:</p>
<pre>import LottieView from 'lottie-react-native';
import React, {useRef, useState} from 'react';
import {Animated, Image, Pressable, Text, View} from 'react-native';
import styles from './AppStyles';
import Assets from './assets';
export const ImageCard = ({data}) =&gt; {
  const [isLiked, setIsLiked] = useState(false);
  const [processing, setProcessing] = useState(false);
  const animationProgress = useRef(new Animated.Value(0)).current;
  const showAnimation = () =&gt; {
    setProcessing(true);
    animationProgress.setValue(0);
    Animated.timing(animationProgress, {
      toValue: 1,
      duration: 2000,
      useNativeDriver: true,
    }).start(({finished}) =&gt; {
      if (finished) {
        setIsLiked(!isLiked);
        setProcessing(false);
      }
    });
  };
  return (
    &lt;Pressable
      key={data?.key}
      style={styles.item}
      onLongPress={() =&gt; showAnimation()}&gt;
      {processing &amp;&amp; (
        &lt;Animated.View
          style={[
            styles.overlayLottie,
            {
              opacity: animationProgress.interpolate({
                inputRange: [0, 0.1, 0.9, 1],
                outputRange: [0, 1, 1, 0],
                extrapolate: 'clamp',
              }),
            },
          ]}&gt;
          &lt;LottieView
            progress={animationProgress}
            source={
              isLiked ? Assets.lottieFiles.unLike : Assets.lottieFiles.like
            }
          /&gt;
        &lt;/Animated.View&gt;
      )}
      &lt;Image
        source={{uri: data?.img}}
        resizeMode={'cover'}
        style={styles.itemImage}
      /&gt;
      &lt;View style={styles.cardRow}&gt;
        &lt;Text style={styles.itemText}&gt;{data?.title}&lt;/Text&gt;
        &lt;Text style={styles.likeText}&gt;{isLiked ? 'UnLike' : 'Like'}&lt;/Text&gt;
      &lt;/View&gt;
    &lt;/Pressable&gt;
  );
};
</pre>
<p>我们来分析一下。我们添加了:</p>
<ul>
<li>引入一个<code>processing</code>状态来确定是否有任何动画已经在进行中</li>
<li><code>Animated</code> <code>animationProgress</code>处理<code>LottieView</code>的动画<code>progress</code></li>
<li><code>showAnimation</code>的方法是:<ul>
<li>将<code>processing</code>状态设置为 true，这样我们就知道动画正在进行中</li>
<li>如果动画已经运行，将<code>animationProgress</code>重置为 0</li>
<li>在<code>animationProgress</code>上开始 2 秒钟的动画，以及在 UI 线程上开始动画，这样 JS 线程不会被阻塞，用户可以继续滚动列表</li>
<li>当动画结束时，我们切换<code>isLiked</code>状态并将<code>processing</code>标志设置为假</li>
</ul>
</li>
</ul>
<p>请注意，只有当动画正在进行中时，我们才会在图像上方的 UI 上显示动画覆盖图，并且我们已经将<code>LottieView</code>包裹在了<code>Animated.View</code>的周围。这是使用<code>animationProgress</code>的<code>interpolated</code>值作为<code>opacity</code>，以便覆盖容器在隐藏或显示时能够<code>fadeIn</code>和<code>fadeOut</code>。</p>
<p>最后，在我们实际的动画中，<code>LottieView</code>使用<code>animationProgress</code>作为动画的<code>progress</code>。我们根据<code>isLiked</code>状态改变动画文件的来源。例如，如果状态是<code>false</code>，即图像不被喜欢，那么我们显示喜欢的动画，反之亦然。</p>
<p>现在，如果你保存并重新运行应用程序，当你<code>longPress</code>图像时，你可以看到<code>Like</code>动画。如果你<code>longPress</code>同样的图像，你会看到<code>UnLike</code>的动画。</p>
<p>就是这样！我们已经学习了如何在 React Native 应用程序中使用 lottie-react-native 创建交互式动画。这个项目的完整代码可在<a href="https://github.com/hrupesh/lottieAnimationsRN" target="_blank" rel="noopener">这里</a>获得。</p>
<h2>结论</h2>
<p>基于 Lottie 的动画是网络和移动应用无缝精确动画的未来。当你想在应用程序中实现一个复杂的、高性能的、小尺寸的动画时，你应该使用它们。感谢阅读！</p><div class="code-block code-block-18">
<div class="blog-plug inline-plug react-native-plug"><h2><a href="https://lp.logrocket.com/blg/react-native-signup"> LogRocket </a>:即时重现 React 原生应用中的问题。</h2><a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/110055665562c1e02069b3698e6cc671.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/110055665562c1e02069b3698e6cc671.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/></noscript></a><p><a href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一款 React 原生监控解决方案，可帮助您即时重现问题、确定 bug 的优先级并了解 React 原生应用的性能。</p><p>LogRocket 还可以向你展示用户是如何与你的应用程序互动的，从而帮助你提高转化率和产品使用率。LogRocket 的产品分析功能揭示了用户不完成特定流程或不采用新功能的原因。</p><p>开始主动监控您的 React 原生应用— <a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer">免费试用 LogRocket】。</a></p></div>
</div>

<p class="clearfix"/>
 <p class="clearfix"/>
</article>

</div>    
</body>
</html>