<html>
<head>
<title>What’s new in React Hook Form V7 - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>React Hook Form V7 的新特性</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/whats-new-in-react-hook-form-v7/#0001-01-01">https://blog.logrocket.com/whats-new-in-react-hook-form-v7/#0001-01-01</a></blockquote><div><article class="article-post">
<p>在 React 中使用表单一直是一件痛苦的事情，React 生态系统中的开发人员一直在努力简化这项繁琐的任务。React Hook Form ，许多由此产生的库之一，已经被证明在处理和验证表单方面是有效的。它还为开发人员提供了其他工具，这些工具可以改善开发人员的体验，并使构建表单更加令人兴奋。</p>
<p>从一开始，React Hook Form 就致力于不仅服务于最终用户，而且让开发者的工作变得更容易。</p>
<p>4 月初，React 团队发布了新版本的库，<a href="https://react-hook-form.com/migrate-v6-to-v7/"> React Hook Form V7。这个版本的亮点是 React Hook Form 现在在 TypeScript 的帮助下支持严格类型的表单，这预示着这个库的未来。</a></p>
<p>让我们仔细看看这些新添加的功能，包括:</p>

<h2 id="reacthookformv7example">反应钩子形式 V7 示例</h2>
<p>为了演示如何严格地输入表单，我们需要创建一个示例项目，其中包含一个带有一些输入字段的表单。如果你想继续下去，你需要:</p>
<ul>
<li>一个文本编辑器，比如 VS 代码</li>
<li>您机器上安装的最新版本的<a href="https://nodejs.org/en/"> Node.js </a></li>
</ul>
<p>有了这些，我们现在可以开始设置我们的项目。</p>
<p>因为我们将使用类型检查，所以我们需要通过在终端中运行以下命令在项目中包含 TypeScript:</p>
<pre>npx create-react-app hook-form --template typescript
</pre>
<p>这将创建一个名为<code>hook-form</code>的集成了 TypeScript 的 React 应用程序。它还提供了一个<code>tsconfig.json</code>文件，所以您不需要创建一个。</p>
<p>接下来，将<code>react-hook-form</code>添加到项目中:</p>
<pre>npm i react-hook-form
</pre>
<p>设置好示例应用程序后，我们就可以探索 React Hook Form V7 的新特性了。</p>
<h2 id="strictlytypedformsinreacthookformv7">React Hook Form V7 中的严格类型表单</h2>
<p>React Hook Form V7 在 React 表单中引入了静态类型的好处。这个特性使您能够编写错误较少的高效表单。</p>
<p>要查看严格类型的表单，请打开您的<code>App.tsx</code>文件并用下面的代码替换它的内容:</p>
<pre>import React from 'react';
import { useForm } from 'react-hook-form'

function App() {
  return (
    &lt;form&gt;
      &lt;label htmlFor="firstName"&gt;First Name&lt;/label&gt;
      &lt;input type="text" /&gt;

      &lt;label htmlFor="email"&gt;Email&lt;/label&gt;
      &lt;input type="email" /&gt;

      &lt;label htmlFor="phone"&gt;Phone Number&lt;/label&gt;
      &lt;input type="number" /&gt;

      &lt;label htmlFor="gender"&gt;&lt;/label&gt;
      &lt;input type="text" /&gt;

      &lt;input type="submit" value="submit"/&gt;
    &lt;/form&gt;
  );
}
export default App;
</pre>
<p>在这里，我们创建了一个带有几个输入字段的简单表单，从<code>react-hook-form</code>引入了<code>useForm</code>钩子，并从<code>useForm</code>提取了<code>register</code>函数。</p>
<p>为了实现严格类型化的形式，我们需要在函数体上声明一个类型别名(我们称之为<code>FormValues</code>)，并将其作为泛型类型传递给<code>useForm</code>:</p>
<pre>import React from 'react';
import { useForm } from 'react-hook-form'

function App() {
  const { register } = useForm&lt;FormValues&gt;()

  type FormValues = {
    firstName: string,
    email: string,
    phone: number,
    gender: any
  }

  return (
    // ...
  );
}
export default App;
</pre>
<p>此别名包含每个输入字段上允许的类型的类型规范。</p>
<p>通过将它传递给<code>useForm</code> , <code>FormValues</code>现在充当一种模式，以确保任何输入字段的名称与别名中的一个键相关，并且输入到输入字段中的值符合类型规范。</p>
<p>有了这些，我们现在可以使用 React Hook Form 的<code>register</code>函数来注册我们创建的输入字段。但是在注册这些字段之前，我们应该指出版本 7 中 register 函数的语法变化。</p>
<p>在这个新版本之前，用于在 React Form Hook 中注册输入字段的语法如下所示:</p>
<pre>&lt;input type="text" name="firstName" ref={register} /&gt;
&gt;</pre>
<p>我们希望<code>react-hook-form</code>返回的输入字段的名称必须存储在 HTML 5 <code>name</code>属性中。虽然这样做很好，但也有局限性。</p>
<p>为了实现严格的类型检查，React Hook V7 利用了 TypeScript 4.1 <a href="https://www.typescriptlang.org/docs/handbook/2/template-literal-types.html">模板文字</a>。register 函数已被修改，以接受输入字段的名称(作为其第一个参数)，并使用该名称对传入<code>useForm</code>的任何别名进行类型检查:</p>
<pre>&lt;input type="text" {...register('firstName') /&gt;
</pre>
<p>以下属性将扩展到输入中:</p>
<pre>const { onChange, blur, ref, name } = register('firstName')
</pre>
<p>现在让我们在每个字段上使用 register 函数，但是我们将故意在电子邮件输入上打一个错字，以查看 TypeScript 如何反应:</p>
<p><img data-attachment-id="46749" data-permalink="https://blog.logrocket.com/whats-new-in-react-hook-form-v7/typescript-register-function-intentional-typo/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/typescript-register-function-intentional-typo.jpeg" data-orig-size="730,304" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="typescript-register-function-intentional-typo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/typescript-register-function-intentional-typo-300x125.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/typescript-register-function-intentional-typo.jpeg" decoding="async" class="aligncenter wp-image-46749 size-full jetpack-lazy-image" src="../Images/32419161006792bac1179140870ab2f4.png" alt="Typescript Register Function Intentional Typo" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/typescript-register-function-intentional-typo.jpeg 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/typescript-register-function-intentional-typo-300x125.jpeg 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/04/typescript-register-function-intentional-typo.jpeg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/typescript-register-function-intentional-typo.jpeg"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="46749" data-permalink="https://blog.logrocket.com/whats-new-in-react-hook-form-v7/typescript-register-function-intentional-typo/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/typescript-register-function-intentional-typo.jpeg" data-orig-size="730,304" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="typescript-register-function-intentional-typo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/typescript-register-function-intentional-typo-300x125.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/typescript-register-function-intentional-typo.jpeg" decoding="async" loading="lazy" class="aligncenter wp-image-46749 size-full" src="../Images/32419161006792bac1179140870ab2f4.png" alt="Typescript Register Function Intentional Typo" srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/typescript-register-function-intentional-typo.jpeg 730w, https://blog.logrocket.com/wp-content/uploads/2021/04/typescript-register-function-intentional-typo-300x125.jpeg 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/typescript-register-function-intentional-typo.jpeg"/></noscript>
<p>这个特性的好处是不可否认的。使用严格类型的表单，您可以确保用户将正确的数据发送到服务器，并且甚至在运行之前就从代码中删除了错误。如果你问我，那是一个大胜利。</p>
<h2 id="reducedpackagesize">缩小包装尺寸</h2>
<p>反应钩形式 V7 带来了减少 13%的包装尺寸。这是因为减少了解析器包的大小。</p>
<p>下表显示了每个文件大小的变化:</p>
<p><img data-attachment-id="46750" data-permalink="https://blog.logrocket.com/whats-new-in-react-hook-form-v7/react-hook-v7-reduce-package-size/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/react-hook-v7-reduce-package-size.jpeg" data-orig-size="458,300" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="react-hook-v7-reduce-package-size" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/react-hook-v7-reduce-package-size-300x197.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/react-hook-v7-reduce-package-size.jpeg" decoding="async" class="aligncenter wp-image-46750 size-full jetpack-lazy-image" src="../Images/fd01e193d601b4b21dd233dd99dee7d1.png" alt="React Hook V7 Reduce Package Size" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/react-hook-v7-reduce-package-size.jpeg 458w, https://blog.logrocket.com/wp-content/uploads/2021/04/react-hook-v7-reduce-package-size-300x197.jpeg 300w" data-lazy-sizes="(max-width: 458px) 100vw, 458px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/04/react-hook-v7-reduce-package-size.jpeg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/react-hook-v7-reduce-package-size.jpeg"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="46750" data-permalink="https://blog.logrocket.com/whats-new-in-react-hook-form-v7/react-hook-v7-reduce-package-size/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/04/react-hook-v7-reduce-package-size.jpeg" data-orig-size="458,300" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="react-hook-v7-reduce-package-size" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/04/react-hook-v7-reduce-package-size-300x197.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/04/react-hook-v7-reduce-package-size.jpeg" decoding="async" loading="lazy" class="aligncenter wp-image-46750 size-full" src="../Images/fd01e193d601b4b21dd233dd99dee7d1.png" alt="React Hook V7 Reduce Package Size" srcset="https://blog.logrocket.com/wp-content/uploads/2021/04/react-hook-v7-reduce-package-size.jpeg 458w, https://blog.logrocket.com/wp-content/uploads/2021/04/react-hook-v7-reduce-package-size-300x197.jpeg 300w" sizes="(max-width: 458px) 100vw, 458px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/04/react-hook-v7-reduce-package-size.jpeg"/></noscript>
<h2 id="improvedperformance">改进的性能</h2>
<p>React 团队竭尽全力增强 React 钩子表单库的性能，包括引入一个新的自定义钩子和对 API 中一些现有钩子的改进。</p>
<p>让我们更详细地检查一下这些改进。</p>
<h3>useFormState(新)</h3>
<p>这个新钩子的引入允许您订阅单独的表单状态，使得每个受控输入在 rerender 方面完全隔离。</p>
<p>这意味着，当您需要订阅表单的一部分时，只要该部分的状态发生变化，就会被重新呈现，而不是从根级别重新呈现整个应用程序。这种隔离渲染也适用于<code>useController</code>和<code>Controller</code>。</p>
<p>例如，假设我们希望在用户触摸任何输入字段时得到通知。这是组件级状态的一个例子。我们可以通过<code>useFormState</code>实现这一点:</p>
<pre>import * as React from "react";
import { useForm, useFormState } from "react-hook-form";

export default function App() {
  const { register, control } = useForm();

  const { touchedFields } = useFormState({control});

  console.log(touchedFields)

  return (
    &lt;form onSubmit={handleSubmit(onSubmit)}&gt;
      &lt;input {...register("firstName")} /&gt;
      &lt;input {...register("lastName")} /&gt;

      &lt;input type="submit" /&gt;
    &lt;/form&gt;
  );
}


// Object logged to the console when user touches the firstName input field
{ firstName: true }

// Object logged when user touches both fields
{ firstName: true, lastName: true }
</pre>
<p>每次触摸输入字段并将对象记录到控制台时，其他输入中的现有表单状态不会改变，因为整个应用程序不会重新呈现。</p><div class="code-block code-block-54">
<hr/>
<h3>更多来自 LogRocket 的精彩文章:</h3>

<hr/></div>
<p>为了让<code>useFormState</code>工作，来自<code>useForm</code>的<code>control</code>对象必须被传递给它，因为这个对象包含将组件注册到<code>react-hook-form</code>的方法。</p>
<p>使用这个钩子可以提高大型复杂表单应用程序的性能。查看可通过<code>useFormState</code>认购的房产的<a href="https://react-hook-form.com/api/useformstate">完整列表。</a></p>
<h3>useFieldArray</h3>
<p>这个定制钩子在语法上没有变化，但是在幕后有所改进。用于维护这个钩子的数据结构得到了增强，使它能够执行得更快。它还允许改进焦点管理，这意味着您可以将任何输入作为焦点，只要它们公开它们的 ref 属性。</p>
<h3>使用手表</h3>
<p>其手表机制得到了改进，使得订阅表单更改变得更加容易。</p>
<h2 id="removedsupportforie11">移除了对 IE 11 的支持</h2>
<p>像技术世界中任何其他有远见的社区一样，React 团队用 React Hook Form V7 结束了对 Internet Explorer 11 的支持。微软本身将于 2021 年 8 月 17 日停止支持 IE 11，因此可以肯定地说，我们将不再担心网络开发领域的 IE 11。</p>
<p>尽管如此变化，React Hook Form V6 仍将保持支持 IE 11。我们将很快讨论关于迁移到最新版本的细节。</p>
<h2 id="newimprovementstoresolver">解析器的新改进</h2>
<p>如果你以前使用过 React Hook Form，你应该知道 resolver 函数，并且可能知道如何在验证包中使用它，比如<a href="https://blog.logrocket.com/react-native-form-validations-with-formik-and-yup/"> Yup </a>。React Hook Form V7 通过向代码库引入第三个参数对此 API 进行了新的改进:</p>
<pre>- resolver: (values: any, context?: object) =&gt; Promise&lt;ResolverResult&gt; | ResolverResult
+ resolver: (
+   values: any,
+   context: object | undefined,
+   options: {
+     criteriaMode?: 'firstError' | 'all',
+     names?: string[],
+     fields: { [name]: Field } // Support nested fields
+   }
+ ) =&gt; Promise&lt;ResolverResult&gt; | ResolverResult
</pre>
<p>新的<code>options</code>参数使其他库能够深入了解验证过程，并使开发人员能够编写更好的定制逻辑来:</p>

<p>这些例子归功于 React Hook Form 项目的核心贡献者 Joris T1。</p>
<p>React Hook Form V7 还支持其他验证库，如<a href="https://blog.logrocket.com/comparing-schema-validation-libraries-zod-vs-yup/"> Zod </a>、<a href="https://ealush.com/vest/"> Vest </a>、<a href="https://joi.dev/"> Joi </a>和<a href="https://docs.superstructjs.org/"> Superstruct </a>。</p>
<p>异步和同步验证选项也被添加到了<code>resolver</code> API 中，默认选项是<code>async</code>。我们可以通过使用<code>mode</code>参数在两者之间切换:</p>
<pre>useForm({ resolver: yupResolver(schema, schemaOptions, { mode: "async" | "sync"}) })
</pre>
<p>除了 Superstruct，所有外部验证库中都有<code>async</code>选项。</p>
<h2 id="migratingfromreacthookformv6tov7">从 React Hook 版本 6 迁移到版本 7</h2>
<p><a href="https://twitter.com/bluebill1049">React Hook Form 的创造者 Bill Luo </a>整理了一份<a href="https://react-hook-form.com/migrate-v6-to-v7/">详细指南</a>帮助你将现有的 V6 应用迁移到 React Hook Form V7。该指南包括您需要对代码进行的更改，以及使您现有的应用程序与 React Hook Form V7 一起工作所需的其他重要信息。</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用 LogRocket 消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款 React analytics 解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket 告诉您 React 应用程序中实际影响用户的最具影响力的 bug 和 UX 问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS 异常、前端性能指标和用户交互。然后，LogRocket 使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的 React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试 LogRocket】。</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>