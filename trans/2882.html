<html>
<head>
<title>How to build faster animation transitions in React - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在 React - LogRocket 博客中构建更快的动画过渡</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/how-build-faster-animation-transitions-react/#0001-01-01">https://blog.logrocket.com/how-build-faster-animation-transitions-react/#0001-01-01</a></blockquote><div><article class="article-post">
<p>在你的网站的组件和元素中添加动画和过渡效果可以改善用户体验，也可以增加一些特色。然而，使用大量动画库创建的过渡往往很慢，因为这些库会增加应用程序的开销。</p>
<p>虽然我们不能完全消除由动画造成的性能下降，即使在较小的库中，我们可以通过选择正确的包来减少它。</p>
<p>在本教程中，我们将演示如何使用<a href="https://github.com/iamyoki/transition-hook" target="_blank" rel="noopener">过渡钩子</a>在 React 中创建快速过渡动画。</p>
<p>本文将涵盖以下内容:</p>

<p>在撰写本文时，transition-hook 还没有准备好投入生产，所以不能用于实际应用。然而，它已经达到了 v1.5.1 发布状态，因此一个稳定的、可用于生产的版本可能指日可待！</p>
<h2 id="getting-started">入门指南</h2>
<p>按照本文中使用的示例，设置一个 React 项目并安装带有 Yarn 或 npm 的过渡挂钩:</p>
<pre>/*yarn*/
yarn add transition-hook

/*npm*/
npm install transition-hook --save
</pre>
<h2 id="what-is-transition-hook">什么是过渡钩？</h2>
<p>transition-hook 是 React 中许多可用于创建动画的挂钩之一。它类似于流行的<a href="https://github.com/reactjs/react-transition-group" target="_blank" rel="noopener"> react-transition-group </a>，但是它是轻量级的，语法更简单，性能更高。</p>
<p>需要明确的是，transition-hook 并不是一个像<a href="https://www.framer.com/motion/" target="_blank" rel="noopener">成帧器动作</a>或<a href="https://react-spring.io" target="_blank" rel="noopener">反应弹簧</a>那样的全能动画库。它不会自动激活元素。相反，它允许您使用 CSS 类和样式的生命周期方法将动画添加到元素的 DOM 入口和出口。</p>
<p>用<a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener"> React Hooks </a>为你的应用程序添加动画的开销是可以忽略的，因为与完整的动画库相比，Hooks 是相当小的。</p>
<p>例如，缩小版的<a href="https://github.com/reactjs/react-transition-group" target="_blank" rel="noopener"> react-transition-group </a>为应用程序增加了 13.5kB 的包重量，在 4G 网络上加载大约需要 5 毫秒。相比之下，transition-hook 只增加了 4.3kB 的包重量，加载时间仅为 1 毫秒。它的轻量级本质和渲染快速、优化动画的能力使 transition-hook 比它的前辈更具性能。</p>
<p>下面是两个库的包大小的对比:</p>
<figure id="attachment_104591" aria-describedby="caption-attachment-104591" class="wp-caption aligncenter"><img data-attachment-id="104591" data-permalink="https://blog.logrocket.com/how-build-faster-animation-transitions-react/bundle-size-graph/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/04/bundle-size-graph.png" data-orig-size="730,268" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Bundle size graph" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/04/bundle-size-graph-300x110.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/04/bundle-size-graph.png" decoding="async" class="wp-image-104591 size-full jetpack-lazy-image" src="../Images/8d42368f176848c6fac59703e100ab73.png" alt="Bundle Size Graph" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/04/bundle-size-graph.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/04/bundle-size-graph-300x110.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/04/bundle-size-graph.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/04/bundle-size-graph.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="104591" data-permalink="https://blog.logrocket.com/how-build-faster-animation-transitions-react/bundle-size-graph/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/04/bundle-size-graph.png" data-orig-size="730,268" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Bundle size graph" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/04/bundle-size-graph-300x110.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/04/bundle-size-graph.png" decoding="async" loading="lazy" class="wp-image-104591 size-full" src="../Images/8d42368f176848c6fac59703e100ab73.png" alt="Bundle Size Graph" srcset="https://blog.logrocket.com/wp-content/uploads/2022/04/bundle-size-graph.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/04/bundle-size-graph-300x110.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/04/bundle-size-graph.png"/></noscript><figcaption id="caption-attachment-104591" class="wp-caption-text">Source: <a href="https://bundlephobia.com/package/react-transition-group@4.4.2" target="_blank" rel="noopener">bundlephobia</a>.</figcaption></figure>
<figure id="attachment_104594" aria-describedby="caption-attachment-104594" class="wp-caption aligncenter"><img data-attachment-id="104594" data-permalink="https://blog.logrocket.com/how-build-faster-animation-transitions-react/transition-hook-bundle-size/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/04/transition-hook-bundle-size.png" data-orig-size="630,423" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Transition-hook bundle size" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/04/transition-hook-bundle-size-300x201.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/04/transition-hook-bundle-size.png" decoding="async" class="wp-image-104594 size-full jetpack-lazy-image" src="../Images/39ffcc6f929bae9fc5fafa004020f8ec.png" alt="Transition-hook Bundle Size" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/04/transition-hook-bundle-size.png 630w, https://blog.logrocket.com/wp-content/uploads/2022/04/transition-hook-bundle-size-300x201.png 300w" data-lazy-sizes="(max-width: 630px) 100vw, 630px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/04/transition-hook-bundle-size.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/04/transition-hook-bundle-size.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="104594" data-permalink="https://blog.logrocket.com/how-build-faster-animation-transitions-react/transition-hook-bundle-size/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/04/transition-hook-bundle-size.png" data-orig-size="630,423" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Transition-hook bundle size" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/04/transition-hook-bundle-size-300x201.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/04/transition-hook-bundle-size.png" decoding="async" loading="lazy" class="wp-image-104594 size-full" src="../Images/39ffcc6f929bae9fc5fafa004020f8ec.png" alt="Transition-hook Bundle Size" srcset="https://blog.logrocket.com/wp-content/uploads/2022/04/transition-hook-bundle-size.png 630w, https://blog.logrocket.com/wp-content/uploads/2022/04/transition-hook-bundle-size-300x201.png 300w" sizes="(max-width: 630px) 100vw, 630px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/04/transition-hook-bundle-size.png"/></noscript><figcaption id="caption-attachment-104594" class="wp-caption-text">Source: <a href="https://bundlephobia.com/package/transition-hook@1.5.2" target="_blank" rel="noopener">bundlephobia</a>.</figcaption></figure>
<p>这里有一个比较，显示了过渡钩束大小与其他 React 动画库的比较:react-spring、framer-motion、<a href="https://github.com/chenglou/react-motion" target="_blank" rel="noopener"> react-motion </a>和<a href="https://github.com/sghall/react-move" target="_blank" rel="noopener"> react-move </a>:</p>
<figure id="attachment_104596" aria-describedby="caption-attachment-104596" class="wp-caption aligncenter"><img data-attachment-id="104596" data-permalink="https://blog.logrocket.com/how-build-faster-animation-transitions-react/similar-packages-react/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/04/similar-packages-react.png" data-orig-size="730,216" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Similar packages React" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/04/similar-packages-react-300x89.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/04/similar-packages-react.png" decoding="async" class="wp-image-104596 size-full jetpack-lazy-image" src="../Images/a55106454c50201afebca42232bdf158.png" alt="Similar Packages for React Animations" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/04/similar-packages-react.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/04/similar-packages-react-300x89.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/04/similar-packages-react.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/04/similar-packages-react.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="104596" data-permalink="https://blog.logrocket.com/how-build-faster-animation-transitions-react/similar-packages-react/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/04/similar-packages-react.png" data-orig-size="730,216" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Similar packages React" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/04/similar-packages-react-300x89.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/04/similar-packages-react.png" decoding="async" loading="lazy" class="wp-image-104596 size-full" src="../Images/a55106454c50201afebca42232bdf158.png" alt="Similar Packages for React Animations" srcset="https://blog.logrocket.com/wp-content/uploads/2022/04/similar-packages-react.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/04/similar-packages-react-300x89.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/04/similar-packages-react.png"/></noscript><figcaption id="caption-attachment-104596" class="wp-caption-text">Source: <a href="https://bundlephobia.com/package/transition-hook@1.5.2" target="_blank" rel="noopener">bundlephobia</a>.</figcaption></figure>
<h2 id="how-does-transition-hook-work">过渡挂钩是如何工作的？</h2>
<p>transition-hook 利用了当组件进入和退出 DOM 时调用的一系列生命周期方法。transition-hook 使用这些生命周期方法来创建过渡阶段，允许我们根据组件的安装和卸载时间，使用 CSS 类和样式向组件添加动画。</p>
<p>当一个组件被挂载时，它作为一个元素被插入到 DOM 中。当一个组件被卸载时，情况正好相反；它会从 DOM 中移除。但是，这些生命周期方法可以被覆盖，以便在流程中的特定时间运行所需的逻辑。</p>
<p>transition-hook 公开了三个 React 挂钩:</p>
<ul>
<li><code>useTransition</code></li>
<li><code>useSwitchTransition</code></li>
<li><code>listTransition</code></li>
</ul>
<p>这些挂钩将布尔状态转换为转换阶段，当组件在指定的持续时间后安装或卸载时，可以调用这些转换阶段。这允许我们根据不同的阶段添加 CSS 样式来创建动画过渡。</p>
<p>以下是 transition-hook 的过渡阶段:</p>
<ul>
<li><code>from</code>:元素进入前</li>
<li><code>enter</code>:元素进入时</li>
<li><code>leave</code>:元素退出前</li>
</ul>
<p>现在，让我们看一些实际的例子来清楚地了解它是如何工作的。</p>
<h2 id="using-usetransition">使用<code>useTransition</code></h2>
<p>下面是一个简单组件的例子，使用<code>useTransition</code>钩子实现淡入淡出动画:</p>
<pre class="language-javascript hljs">const [onOff, setOnOff] = useState(true)
const {stage, shouldMount} = useTransition(onOff, 300) // (state, timeout)
return &lt;div&gt;
  {shouldMount &amp;&amp; (
    &lt;p style={{
      ….
      transition: '.3s',
      opacity: stage === 'enter' ? 1 : 0
    }}&gt;
      I will fade
    &lt;/p&gt;
  )}
  &lt;button onClick={()=&gt;setOnOff(!onOff)}&gt;toggle&lt;/button&gt;
&lt;/div&gt;
</pre>
<p>在这个例子中，我们首先用<code>useState</code>钩子创建一个<code>onOff</code>状态变量，然后将它作为一个道具传递给<code>useTransition</code>钩子，附带一个 3 毫秒的超时时间。</p>
<p><code>onOff</code>状态变量通过控制来自<code>useTransition</code>钩子的被析构的<code>shouldMount</code>变量的布尔值来指示组件是否应该进入 DOM。如果该值设置为 true，则组件将被装载，并且在指定的超时时间内将调用转换阶段，直到组件被卸载。</p>
<pre class="language-javascript hljs">const {stage, shouldMount} = useTransition(onOff, 300)
</pre>
<p><code>stage</code>变量让我们可以访问前面提到的转换阶段。我们可以使用<code>stage</code>变量来改变组件的 CSS 样式和动画组件。</p>
<p>但是首先，我们需要检查组件是否已经安装。我们使用逻辑 AND ( <code>&amp;&amp;</code>)操作符在下面的代码片段中执行这个检查。只有当<code>shouldMount</code>变量的布尔值为真时，<code>&amp;&amp;</code>右边的元素才会被计算(安装)。在这种情况下，<code>onOff</code>状态变量的值被默认设置为 true，因此组件将被挂载，从而允许我们访问转换阶段。</p>
<pre class="language-javascript hljs">  {shouldMount &amp;&amp; (
    &lt;p style={{
      ….
      transition: '.3s',
      opacity: stage === 'enter' ? 1 : 0
    }}&gt;
      I will fade
    &lt;/p&gt;
  )}
</pre>
<p>在下面的代码中，负责动画的 CSS 样式内联应用于段落元素。属性是魔法发生的地方！</p>
<p>用 CSS 创建动画就像给元素添加一个过渡属性，然后有条件地切换<code>opacity</code>或变换值一样简单。这正是我们在这个例子中所做的；段落元素上的<code>opacity</code>属性的值基于<code>transition</code>阶段有条件地应用。</p>
<pre class="language-javascript hljs">&lt;p style={{
      ….
      transition: 'all 3s',
      opacity: stage === 'enter' ? 1 : 0
    }}&gt;
      I will fade
&lt;/p&gt;</pre>
<p>当组件到达<code>enter</code>转换阶段时，段落的<code>opacity</code>值将被设置为 1，否则，它将被设置为零。</p>
<pre class="language-javascript hljs">opacity: stage === 'enter' ? 1 : 0</pre>
<p>由于一个<code>transition</code>属性也被应用到元素，当组件被安装和卸载时，淡入和淡出效果将被创建，如下所示:</p>
<p><img data-attachment-id="104598" data-permalink="https://blog.logrocket.com/how-build-faster-animation-transitions-react/toggle-fade/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/04/toggle-fade.gif" data-orig-size="511,338" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Toggle fade" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/04/toggle-fade-300x198.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/04/toggle-fade.gif" decoding="async" class="aligncenter size-full wp-image-104598 jetpack-lazy-image" src="../Images/0765d90f3df4bbf7aa91896ad7b4d523.png" alt="Toggle Fade" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/04/toggle-fade.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/04/toggle-fade.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="104598" data-permalink="https://blog.logrocket.com/how-build-faster-animation-transitions-react/toggle-fade/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/04/toggle-fade.gif" data-orig-size="511,338" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Toggle fade" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/04/toggle-fade-300x198.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/04/toggle-fade.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-104598" src="../Images/0765d90f3df4bbf7aa91896ad7b4d523.png" alt="Toggle Fade" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/04/toggle-fade.gif"/></noscript>
<p>还可以通过将样式应用于具有类的元素来创建动画。但是在这种情况下，<code>className</code>是有条件应用的:</p>
<pre class="language-javascript hljs">&lt;p className={stage === 'enter' ? 'fade-in' : 'fade-out'}&gt;
      I will fade
&lt;/p&gt;
</pre>
<p><code>useTransition</code>挂钩对于创建简单的线性动画很有用。然而，当动画基于特定的标准和复杂的功能时，<code>useSwitchTransition</code>和<code>listTransition</code>挂钩是更好的选择。</p>
<p>接下来，我们将回顾几个可用于动画元素的 React 挂钩，并查看每个挂钩的具体用例。</p>
<h2 id="using-useswitchtransition">使用<code>useSwitchTransition</code></h2>
<p><code>useSwitchTransition</code>钩子根据状态变化来激活元素。假设我们有一个按钮，它在两种状态之间来回切换，并需要改变另一个元素的外观。在这种情况下，<code>useSwitchTransition</code>是最好的钩子。</p><div class="code-block code-block-54">
<hr/>
<h3>更多来自 LogRocket 的精彩文章:</h3>

<hr/></div>
<p>useSwitchTransition 挂钩接受三个属性；<code>state</code>、<code>timeout</code>和<code>mode</code>。我们已经在前面的章节中讨论了前两个道具，我们将看看<code>mode</code>道具，并通过一个实际例子来学习如何使用它。</p>
<p><code>mode</code>道具指示组件的状态如何改变，以及它们如何进入或退出场景。当组件的状态改变时，该组件退出，具有新状态的新组件进入。</p>
<p><code>mode</code>属性接受三个值之一:<code>default</code>、<code>out-in</code>或<code>in-out</code>。<code>out-in</code>值表示在新状态进入之前，旧状态将首先退出场景。相反，<code>in-out</code>值表示新状态将在旧状态退出之前进入场景。</p>
<p>下面一个表情切换器的例子恰当地展示了<code>useSwitchTransition</code>钩子的综合用途:</p>
<pre class="language-javascript hljs">export function EmojiSwitchTransition() {
  const [isHappy, setIsHappy] = useState(false)
  const transition = useSwitchTransition(isHappy, 300)

  return (
    &lt;div className="EmojiSwitchTransition"&gt;
      &lt;Button
        onClick={() =&gt; {
          setIsHappy(!isHappy)
        }}
      &gt;
        Toggle
      &lt;/Button&gt;

      &lt;div
        style={{
          display: 'flex',
          justifyContent: 'center',
        }}
      &gt;
        {transition((state, stage) =&gt; (
          &lt;h1
            style={{
              transition: '.3s',
              marginTop: 40,
              fontSize: '5em',
              position: 'absolute',
              opacity: stage === 'enter' ? 1 : 0,
              transformOrigin: 'center bottom',
              transform: {
                from: 'translateX(-100%) rotate(-90deg)',
                enter: 'translateX(0%)',
                leave: 'translateX(100%) rotate(90deg)',
              }[stage],
            }}
          &gt;
            {state ? '🤣' : '😝'}
          &lt;/h1&gt;
        ))}
      &lt;/div&gt;
    &lt;/div&gt;
  )
}
</pre>
<p>在这个例子中，我们有一个<code>isHappy</code>状态变量和一个<code>transition</code>变量，它存储了带有<code>isHappy</code>状态变量的<code>useSwitchTransition</code>函数、一个 3 毫秒超时和一个传递给它的<code>default</code>模式属性。</p>
<pre class="language-javascript hljs">  const [isHappy, setIsHappy] = useState(false)
  const transition = useSwitchTransition(isHappy, 300, "default")
</pre>
<p>在前面的<code>useTransition</code>例子中，我们从<code>useTransition</code>钩子中析构了 stage 和<code>shouldMount</code>变量，而不是像这个例子那样将它们存储在一个变量中。</p>
<p>在组件主体中，有一个带有事件监听器的按钮，用于在 true 和 false 之间切换<code>isHappy</code>变量的状态，还有一个包装转换呈现函数的 div 元素。</p>
<pre class="language-javascript hljs">{transition((state, stage) =&gt; (
          &lt;h1
            style={{
              transition: '.3s',
              marginTop: 40,
              fontSize: '5em',
              position: 'absolute',
              opacity: stage === 'enter' ? 1 : 0,
              transformOrigin: 'center bottom',
              transform: {
                from: 'translateX(-100%) rotate(-90deg)',
                enter: 'translateX(0%)',
                leave: 'translateX(100%) rotate(90deg)',
              }[stage],
            }}
          &gt;
            {state ? '🤣' : '😝'}
          &lt;/h1&gt;
        ))}       
</pre>
<p>在 render 函数中，有一个回调函数，它有两个参数:<code>state</code>和<code>stage</code>。这些参数分别代表<code>isHappy</code>状态和<code>transition</code>阶段。</p>
<p>回调函数中有一个<code>h1</code>元素，根据当前状态显示两个表情符号中的一个。</p>
<pre class="language-javascript hljs">{state ? '🤣' : '😝'}
</pre>
<p>这些表情符号由应用于<code>h1</code>元素的内嵌样式激活。<code>opacity</code>和<code>transform</code>属性负责动画，它们是基于过渡阶段设置的。</p>
<pre class="language-javascript hljs">style={{
              ...
              opacity: stage === 'enter' ? 1 : 0,
              ...
          }}          
</pre>
<p>每个表情符号的<code>opacity</code>默认设置为 0，当状态变化到进入阶段时，<code>opacity</code>会设置为 1，休假时设置为 0。这将在元素进入和退出场景时向元素添加淡入和淡出动画。</p>
<p><code>transform</code>方法根据过渡阶段向元素添加平移和旋转动画。</p>
<pre class="language-javascript hljs">style={{
              ...
              …
              transform: {
                from: 'translateX(-100%) rotate(-90deg)',
                enter: 'translateX(0%)',
                leave: 'translateX(100%) rotate(90deg)',
              }[stage],
          }}          
</pre>
<p>当处于<code>from</code>过渡阶段时，表情符号从 x 轴的负平面(即从左侧)移动，并在进入场景时逆时针旋转 90 度。</p>
<p>在<code>enter</code>过渡阶段，translate 方法被设置为零，从而使表情符号采用其默认的变换位置。离开过渡阶段通过将表情符号从默认位置移动到 x 轴的正平面(即向右)并将其顺时针旋转 90 度来启动退出动画。</p>
<p><img data-attachment-id="104600" data-permalink="https://blog.logrocket.com/how-build-faster-animation-transitions-react/toggle-emojis/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/04/toggle-emojis.gif" data-orig-size="530,295" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Toggle emojis" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/04/toggle-emojis-300x167.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/04/toggle-emojis.gif" decoding="async" class="aligncenter size-full wp-image-104600 jetpack-lazy-image" src="../Images/5bc6986b05aa9ea41c5b2071b4f2157e.png" alt="Toggle Emojis" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/04/toggle-emojis.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/04/toggle-emojis.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="104600" data-permalink="https://blog.logrocket.com/how-build-faster-animation-transitions-react/toggle-emojis/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/04/toggle-emojis.gif" data-orig-size="530,295" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Toggle emojis" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/04/toggle-emojis-300x167.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/04/toggle-emojis.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-104600" src="../Images/5bc6986b05aa9ea41c5b2071b4f2157e.png" alt="Toggle Emojis" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/04/toggle-emojis.gif"/></noscript>
<h2 id="using-listtransition">使用<code>listTransition</code></h2>
<p>如果您有一个项目列表，并且想要在列表中添加或删除元素时显示动画，那么<code>listTransition</code>挂钩是最好的选择。</p>
<p>这个钩子接受数组列表和<code>useRef</code>钩子的当前属性作为超时属性。在组件体中，封装了一个带有两个参数的回调函数:<code>item</code>和<code>stage</code>。<code>item</code>参数表示将基于过渡阶段使用<code>stage</code>参数进行动画处理的项目数组。</p>
<p>下面是来自 CodeSandbox 的<code>listTransition</code>钩子<a href="https://codesandbox.io/embed/transition-hook-examples-o3f41?codemirror=1" target="_blank" rel="noopener">的一个实际应用:</a></p>
<pre class="language-javascript hljs">export function ListShifting() {
  const [list, setList] = useState([1])
  const timeoutRef = useRef(300)
  const transition = useListTransition(list, timeoutRef.current)

  return (
    &lt;div className="ListShifting"&gt;
      &lt;div
        style={{
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          gap: 20,
          marginBottom: 50,
        }}
      &gt;
        &lt;Button onClick={() =&gt; setList((prev) =&gt; prev.concat(prev.length + 1))}&gt;
          Add Item
        &lt;/Button&gt;
        &lt;Button
          variant="danger"
          onClick={() =&gt; {
            setList([])
            timeoutRef.current = list.length * 50
          }}
        &gt;
          Remove All
        &lt;/Button&gt;
      &lt;/div&gt;
      {transition((item, stage) =&gt; (
        &lt;h1
          style={{
            transition: '.3s',
            ...(stage === 'leave' &amp;&amp; { transitionDelay: item * 50 + 'ms' }),
            opacity: stage === 'enter' ? 1 : 0,
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            gap: 20,
            transformOrigin: 'center right',
            transform: {
              from: 'translateX(-100%) rotate(90deg)',
              enter: 'translateX(0%)',
              leave: 'translateX(100%) rotate(-90deg)',
            }[stage],
          }}
        &gt;
          Item: {item}
          &lt;Button
            variant="danger"
            size="sm"
            onClick={() =&gt;
              setList((prev) =&gt; prev.filter((pitem) =&gt; pitem !== item))
            }
          &gt;
            &lt;RiSubtractLine /&gt;
          &lt;/Button&gt;
        &lt;/h1&gt;
      ))}
    &lt;/div&gt;
  )
}
</pre>
<h2 id="using-an-facc-pattern">使用 FaCC 模式</h2>
<p>transition-hook 提供了使用函数作为子组件(FaCC)模式创建动画的选项。该模式允许您将渲染函数作为子道具传递给组件。</p>
<p>这是一种更简洁、更全面的用过渡钩子创建动画的方式。我们可以使用这种模式将转换函数定义为组件，并将<code>state</code>、<code>timeout</code>和<code>mode</code>作为道具传递给它们。</p>
<h3 id="facc-pattern-with-usetransition">带<code>useTransition</code>的 FaCC 模式</h3>
<p>这里有一个 JSX 的<code>Transition</code>函数的例子:</p>
<pre class="language-javascript hljs">const [onOff, setOnOff] = useState(true);
const {stage, shouldMount} = useTransition(onOff, 300);
...
{shouldMount &amp;&amp; (
   {...}  
)}
</pre>
<p>下面是使用带有<code>useTransition</code>的 FaCC 模式的同一个例子:</p>
<pre class="language-javascript hljs">const [onOff, setOnOff] = useState(true);
...
&lt;Transition state={onOff} timeout={300}&gt;
    {...}
&lt;/Transition&gt;
</pre>
<h3 id="facc-pattern-with-useswitchtransition">带<code>useSwitchTransition</code>的 FaCC 模式</h3>
<p>这里有一个 JSX 的<code>SwitchTransition</code>函数的例子:</p>
<pre class="language-javascript hljs">const [isHappy, setIsHappy] = useState(false);
const transition = useSwitchTransition(isHappy, 300, "default");
...
{transition((state, stage) =&gt; (
     {...}     
  )}
</pre>
<p>下面是使用带有<code>useSwitchTansition</code>的 FaCC 模式的同一个例子:</p>
<pre class="language-javascript hljs">const [isHappy, setIsHappy] = useState(false);
...
&lt;SwitchTransition state={isHappy} timeout={300} mode='default'&gt;
    {...}
&lt;/SwitchTransition&gt;
</pre>
<h3 id="facc-pattern-with-listtransition">带<code>listTransition</code>的 FaCC 模式</h3>
<p>这里有一个 JSX 的<code>listTransition</code>函数的例子:</p>
<pre class="language-javascript hljs">const [list, setList] = useState([1]);
  const timeoutRef = useRef(300);
  const transition = useListTransition(list, timeoutRef.current);
...
{transition((item, stage) =&gt; (
    {...}
  )
}
</pre>
<p>下面是使用带有<code>listTransition</code>的 FaCC 模式的同一个例子:</p>
<pre class="language-javascript hljs">const [list, setList] = useState([1]);
const timeoutRef = useRef(300);
...
&lt;listTransition state={list} timeout={timeoutRef.current}&gt;
 {...}
&lt;/listTransition&gt;
</pre>
<h2 id="conclusion">结论</h2>
<p>在本教程中，我们讨论了 transition-hook 的特性及其工作原理。我们还演示了如何使用 transition-hook 在 React 组件进入或退出 DOM 时对其进行动画处理，并查看了该库公开的每个钩子的具体用例。</p>
<p>要了解更多关于 transition-hook 的信息，请访问<a href="https://github.com/iamyoki/transition-hook#useswitchtransitionstate-timeout-mode" target="_blank" rel="noopener"> GitHub </a>。如需更多示例和用例，请访问这个<a href="https://codesandbox.io/embed/transition-hook-examples-o3f41?codemirror=1" target="_blank" rel="noopener">代码沙箱</a>。</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720"><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener"> LogRocket </a>:全面了解您的生产 React 应用</h2><p>调试 React 应用程序可能很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪 Redux 状态、自动显示 JavaScript 错误以及跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" vwo-el-id="19356441070">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<p vwo-el-id="28675660440" class="">LogRocket 结合了会话回放、产品分析和错误跟踪，使软件团队能够创建理想的 web 和移动产品体验。这对你来说意味着什么？</p>
<p>LogRocket 不是猜测错误发生的原因，也不是要求用户提供截图和日志转储，而是让您回放问题，就像它们发生在您自己的浏览器中一样，以快速了解哪里出错了。</p>
<p>不再有嘈杂的警报。智能错误跟踪允许您对问题进行分类，然后从中学习。获得有影响的用户问题的通知，而不是误报。警报越少，有用的信号越多。</p>
<p vwo-el-id="28675660750">LogRocket Redux 中间件包为您的用户会话增加了一层额外的可见性。LogRocket 记录 Redux 存储中的所有操作和状态。</p>
<p vwo-el-id="28675661060">现代化您调试 React 应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">开始免费监控</a>。</p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>