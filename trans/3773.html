<html>
<head>
<title>Next.js font optimization: Adding custom and Google fonts </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Next.js字体优化:添加自定义字体和谷歌字体</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/next-js-font-optimization/#0001-01-01">https://blog.logrocket.com/next-js-font-optimization/#0001-01-01</a></blockquote><div><article class="article-post">
<p>我们如何在web项目中加载字体可以决定用户体验的成败。使用系统字体，我们可以保证文本会在尽可能早的时间呈现。但是我们可能不需要这些字体类型，更重要的是，它们在操作系统之间并不一致。</p>
<p>另一方面，网络字体允许我们保持一致的外观。添加web字体可能是一项简单的任务。然而，如果我们关心性能优化，它也会变得乏味。</p>
<p>与由诸如Google Fonts的字体传送服务托管的web字体相关的一个问题是外部网络请求的成本。虽然我们可以通过自托管字体来大大降低这一成本，但我们也要处理布局变化的问题。</p>
<p>Next.js v13引入了一个名为<code>@next/font</code>的字体系统来帮助抽象优化字体的复杂性。本课讲述如何使用这个字体系统在Next.js项目中添加自定义字体和Google字体，以及优化字体加载体验。</p>
<p>向前跳:</p>

<p>在这里看<a href="https://next-js-fonts-optimization.vercel.app/">演示项目。您可以与项目进行交互，以查看页面元素如何呈现不同的字体。下面是</a><a href="https://github.com/Ibaslogic/Next.js-fonts-optimization">项目的源代码</a>。</p>
<p>现在，让我们开始吧。</p>
<h2 id="adding-fonts-next-js">在Next.js中添加字体</h2>
<p><a href="https://blog.logrocket.com/how-to-use-web-fonts-css/">在Next.js应用程序中添加像谷歌字体</a>这样的网络字体可以简单到将字体交付服务生成的<code>&lt;link&gt;</code>标签嵌入到<code>pages/_document.js</code>文件的<code>Head</code>组件中。</p>
<h3>创建您的项目</h3>
<p>如果没有Next.js项目，可以使用以下命令创建一个项目:</p>
<pre class="language-bash hljs">npx <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5e3d2c3b3f2a3b73303b262a733f2e2e1e323f2a3b2d2a">[email protected]</a> nextjs-fonts 
cd nextjs-fonts
</pre>
<p>然后，用<code>npm run dev</code>运行您的构建过程。</p>
<p>现在，在<code>pages/index.js</code>文件中添加下面的<code>Home</code>组件:</p>
<pre class="language-javascript hljs">export default function Home() {
  return (
    &lt;div&gt;
      &lt;h1&gt;Home page&lt;/h1&gt;
    &lt;/div&gt;
  );
}
</pre>
<p>让我们通过将字体交付服务提供的<code>&lt;link&gt;</code>标签添加到 <code>pages/_document.js</code>文件的<code><a href="https://github.com/Ibaslogic/Next.js-fonts-optimization/blob/main/pages/_document.js">Head</a></code> <a href="https://github.com/Ibaslogic/Next.js-fonts-optimization/blob/main/pages/_document.js">组件中，从谷歌字体实现一个名为</a><a href="https://fonts.google.com/specimen/Dancing+Script?query=danc&amp;vfonly=true">舞蹈脚本</a>的可变字体<a href="https://fonts.google.com/knowledge/glossary/variable_fonts">，如下所示:</a></p>
<pre class="language-javascript hljs">&lt;Head&gt;
  {/* preconnect scripts... */}
  &lt;link
    href="https://fonts.googleapis.com/css2?family=Dancing+Script:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0473636c70443034342a2a333434">[email protected]</a>&amp;display=swap"
    rel="stylesheet"
  /&gt;
&lt;/Head&gt;
</pre>
<p>之后，我们将更新<code>styles/globals.css</code>中的字体系列:</p>
<pre class="language-css hljs">body {
  /* ... */
  font-family: 'Dancing Script', cursive;
}
</pre>
<p>输出如下所示:</p>
<p><img data-attachment-id="153303" data-permalink="https://blog.logrocket.com/next-js-font-optimization/attachment/img1-dancing-script-font-embedded-link-tag/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img1-Dancing-Script-font-embedded-Link-tag.png" data-orig-size="730,358" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Dancing-Script-font-embedded-Link-tag" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img1-Dancing-Script-font-embedded-Link-tag-300x147.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img1-Dancing-Script-font-embedded-Link-tag.png" decoding="async" class="aligncenter size-full wp-image-153303 jetpack-lazy-image" src="../Images/d3efc04878eeb6147def3cf5327e4826.png" alt="Browser Opened To Localhost In Light Mode With Text In Dancing Script Font Reading Home Page" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/12/img1-Dancing-Script-font-embedded-Link-tag.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/12/img1-Dancing-Script-font-embedded-Link-tag-300x147.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img1-Dancing-Script-font-embedded-Link-tag.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img1-Dancing-Script-font-embedded-Link-tag.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="153303" data-permalink="https://blog.logrocket.com/next-js-font-optimization/attachment/img1-dancing-script-font-embedded-link-tag/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img1-Dancing-Script-font-embedded-Link-tag.png" data-orig-size="730,358" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Dancing-Script-font-embedded-Link-tag" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img1-Dancing-Script-font-embedded-Link-tag-300x147.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img1-Dancing-Script-font-embedded-Link-tag.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-153303" src="../Images/d3efc04878eeb6147def3cf5327e4826.png" alt="Browser Opened To Localhost In Light Mode With Text In Dancing Script Font Reading Home Page" srcset="https://blog.logrocket.com/wp-content/uploads/2022/12/img1-Dancing-Script-font-embedded-Link-tag.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/12/img1-Dancing-Script-font-embedded-Link-tag-300x147.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img1-Dancing-Script-font-embedded-Link-tag.png"/></noscript>
<p>这很简单，对吗？让我们在下一节看看这个实现的问题。</p>
<h3>字体渲染过程</h3>
<p>理想情况下，当web字体应用于web文档时，浏览器将在解析HTML后开始下载字体。这发生在文本呈现之前。</p>
<p>虽然我们希望字体能够快速加载和渲染，但事实并非总是如此。字体加载可能需要额外的时间，尤其是当它涉及到外部请求时，比如谷歌字体。</p>
<p>请参见下面的请求URL:</p>
<p><img data-attachment-id="153305" data-permalink="https://blog.logrocket.com/next-js-font-optimization/attachment/img2-font-rendering-request-url/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img2-Font-rendering-request-URL.png" data-orig-size="730,383" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Font-rendering-request-URL" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img2-Font-rendering-request-URL-300x157.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img2-Font-rendering-request-URL.png" decoding="async" class="aligncenter size-full wp-image-153305 jetpack-lazy-image" src="../Images/d59bfee91b80ac593f3dcabac9a4a888.png" alt="Browser Developer Pane Open In Dark Mode With Red Arrow Pointing To External Request Url For Font Rendering" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/12/img2-Font-rendering-request-URL.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/12/img2-Font-rendering-request-URL-300x157.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img2-Font-rendering-request-URL.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img2-Font-rendering-request-URL.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="153305" data-permalink="https://blog.logrocket.com/next-js-font-optimization/attachment/img2-font-rendering-request-url/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img2-Font-rendering-request-URL.png" data-orig-size="730,383" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Font-rendering-request-URL" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img2-Font-rendering-request-URL-300x157.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img2-Font-rendering-request-URL.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-153305" src="../Images/d59bfee91b80ac593f3dcabac9a4a888.png" alt="Browser Developer Pane Open In Dark Mode With Red Arrow Pointing To External Request Url For Font Rendering" srcset="https://blog.logrocket.com/wp-content/uploads/2022/12/img2-Font-rendering-request-URL.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/12/img2-Font-rendering-request-URL-300x157.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img2-Font-rendering-request-URL.png"/></noscript>
<p>因此，在下载字体完成之前，浏览器会退回到使用系统字体。</p>
<p>正如我们在Google字体中看到的，URL中的<code>display=swap</code>参数将触发一个<code>font-display: swap</code>，指示浏览器使用备用字体。网页字体下载完成后，它会交换字体。</p>
<p>当字体改变时，这种切换会导致文本布局的改变。这种效果被称为<a href="https://fonts.google.com/knowledge/glossary/fout">无样式文本的闪现</a>，也称为FOUT。</p>
<p>我们可以使用三种策略来改善装载体验:</p>
<ol>
<li>通过从我们的域本地提供字体来消除外部网络请求</li>
<li>使用<code>font-display: optional</code>防止布局移动，同时预加载字体</li>
<li>使用CSS <code>size-adjust</code>属性减少字体切换时的布局偏移</li>
</ol>
<p>虽然我们可以手动实现这些优化策略，但我们将看看Next.js 13如何通过<code>@next/font</code>系统使这个过程变得更容易。</p>
<h2 id="how-next-font-system-helps-font-optimization-next-js">在Next.js中,<code>@next/font</code>系统如何帮助字体优化</h2>
<p>系统是Next.js 13中引入的众多强大特性之一。这个字体系统大大简化了字体优化。它通过将任何Google字体与其他web组件(如HTML和CSS文件)一起包含在部署中来自动托管它们。</p>
<p>由于浏览器不涉及外部请求，因此加载速度更快。它使用<a href="https://blog.logrocket.com/css-font-size-adjust-how-to/"> CSS </a> <code><a href="https://blog.logrocket.com/css-font-size-adjust-how-to/">size-adjust</a></code> <a href="https://blog.logrocket.com/css-font-size-adjust-how-to/">属性</a>实现了一种防止布局偏移或显著降低影响的策略。</p>
<h3>安装<code>@next/font</code></h3>
<p>在Next.js中，<code>@next/font</code>是一个独立的包，所以它不会使内核膨胀。让我们将它安装在我们的项目中:</p>
<pre class="language-bash hljs">npm install @next/font
</pre>
<p>请确保您使用的是Next.js v13或更高版本。</p>
<h2 id="adding-google-fonts-next-font">用<code>@next/font</code>添加谷歌字体</h2>
<p>Web字体，包括来自Google Fonts的字体，可以是可变字体，也可以是不可变字体。可变字体的优势在于可以将一种字体的多种变体整合到一个文件中。与非可变类型相比，Next.js推荐这种类型的字体。所以，让我们从这个开始。</p>
<h3>在单页上添加字体</h3>
<p><a href="https://fonts.google.com/specimen/Dancing+Script?query=danc&amp;vfonly=true">来自谷歌字体的舞蹈脚本</a>是一种可变字体。如果您在之前我们讨论<code>&lt;link&gt;</code> tags方法时将该字体添加到您的项目中，请确保在继续之前将其移除。</p>
<p>现在，让我们使用<code>@next/font</code>系统加载舞蹈脚本。在<code>pages/index.js</code>文件中，让我们从<code>@next/font/google</code>导入字体作为一个函数，并创建它的一个新实例:</p>
<pre class="language-javascript hljs">import { Dancing_Script } from '@next/font/google';
const dancingScript = Dancing_Script();
console.log(dancingScript);

export default function Home() {
  return (
    // ...
  );
}
</pre>
<p>在代码中，我们将字体实例分配给一个<code>dancingScript</code>变量，并记录它以查看它返回什么。如果我们保存文件并重新加载页面，我们应该在browser developer tools面板和终端中看到返回的对象:</p>
<p><img data-attachment-id="153307" data-permalink="https://blog.logrocket.com/next-js-font-optimization/attachment/img3-returned-object-dancingscript-variable-developer-tools-panel/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img3-Returned-object-dancingScript-variable-developer-tools-panel.png" data-orig-size="730,128" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Returned-object-dancingScript-variable-developer-tools-panel" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img3-Returned-object-dancingScript-variable-developer-tools-panel-300x53.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img3-Returned-object-dancingScript-variable-developer-tools-panel.png" decoding="async" class="aligncenter size-full wp-image-153307 jetpack-lazy-image" src="../Images/5ebdabba48e88695c04822f6405ad727.png" alt="Browser Developer Tools Panel Showing Returned Object For Dancing Script Variable" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/12/img3-Returned-object-dancingScript-variable-developer-tools-panel.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/12/img3-Returned-object-dancingScript-variable-developer-tools-panel-300x53.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img3-Returned-object-dancingScript-variable-developer-tools-panel.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img3-Returned-object-dancingScript-variable-developer-tools-panel.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="153307" data-permalink="https://blog.logrocket.com/next-js-font-optimization/attachment/img3-returned-object-dancingscript-variable-developer-tools-panel/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img3-Returned-object-dancingScript-variable-developer-tools-panel.png" data-orig-size="730,128" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Returned-object-dancingScript-variable-developer-tools-panel" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img3-Returned-object-dancingScript-variable-developer-tools-panel-300x53.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img3-Returned-object-dancingScript-variable-developer-tools-panel.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-153307" src="../Images/5ebdabba48e88695c04822f6405ad727.png" alt="Browser Developer Tools Panel Showing Returned Object For Dancing Script Variable" srcset="https://blog.logrocket.com/wp-content/uploads/2022/12/img3-Returned-object-dancingScript-variable-developer-tools-panel.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/12/img3-Returned-object-dancingScript-variable-developer-tools-panel-300x53.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img3-Returned-object-dancingScript-variable-developer-tools-panel.png"/></noscript>
<p>字体加载器返回一个包含选项的对象，我们可以用它来应用字体样式。</p>
<h3>应用字体样式</h3>
<p>如上所示，返回的对象包含了<code>className</code>属性和一个<code>style</code>对象，我们可以用它来应用字体。使用<code>className</code>，我们可以将一种字体应用于一个元素，如下所示:</p>
<pre class="language-javascript hljs">export default function Home() {
  return (
    &lt;div&gt;
      &lt;h1 className={dancingScript.className}&gt;Home page&lt;/h1&gt;
    &lt;/div&gt;
  );
}
</pre>
<p>我们可以保存文件并重启开发服务器。</p>
<p>如果我们检查前端，我们应该看到应用的字体。然而，由于谷歌浏览器的行为方式，可能会使用备用字体。</p>
<p>出于优化目的，每种字体都应用了一个<code>font-display</code>属性。默认情况下，应用于来自<code>@next/font</code>系统的字体的值是<code>font-display:optional</code>。这意味着如果字体在短期内不可用，将使用后备字体，不会发生交换。</p>
<p>我们可以指定一个值<code>font-display:swap</code>来在字体加载完成后立即切换到该字体，如下所示:</p>
<pre class="language-javascript hljs">const dancingScript = Dancing_Script({ display: 'swap' });
</pre>
<p>这应该行得通。然而，在某些情况下，我们可能会注意到轻微的变化。</p>
<p>出于这个原因，我们将使用默认的<code>display: optional</code>属性，同时预加载字体，这样我们就可以省略shift。这种方法产生最有效的结果。</p>
<p>要预加载字体，我们必须将它分成所需字符的子集—例如，<code>latin</code>。因此，让我们通过<code>subsets</code>选项添加一个子集:</p>
<pre class="language-javascript hljs">const dancingScript = Dancing_Script({ subsets: ['latin'] });
</pre>
<p>该选项将从web字体中去除不需要的语言，并确保在<code>&lt;head&gt;</code>元素中添加所需语言的预加载链接。如果我们保存文件，我们应该会看到注入的链接:</p>
<p><img data-attachment-id="153310" data-permalink="https://blog.logrocket.com/next-js-font-optimization/attachment/img4-injected-preload-link-head-element/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img4-Injected-preload-link-head-element.png" data-orig-size="730,205" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Injected-preload-link-head-element" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img4-Injected-preload-link-head-element-300x84.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img4-Injected-preload-link-head-element.png" decoding="async" class="aligncenter size-full wp-image-153310 jetpack-lazy-image" src="../Images/40e40f09e504e8d5f205124afee7956f.png" alt="Head Element In Html File With Red Arrow Pointing To Injected Preload Link For Dancing Script Font" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/12/img4-Injected-preload-link-head-element.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/12/img4-Injected-preload-link-head-element-300x84.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img4-Injected-preload-link-head-element.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img4-Injected-preload-link-head-element.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="153310" data-permalink="https://blog.logrocket.com/next-js-font-optimization/attachment/img4-injected-preload-link-head-element/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img4-Injected-preload-link-head-element.png" data-orig-size="730,205" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Injected-preload-link-head-element" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img4-Injected-preload-link-head-element-300x84.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img4-Injected-preload-link-head-element.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-153310" src="../Images/40e40f09e504e8d5f205124afee7956f.png" alt="Head Element In Html File With Red Arrow Pointing To Injected Preload Link For Dancing Script Font" srcset="https://blog.logrocket.com/wp-content/uploads/2022/12/img4-Injected-preload-link-head-element.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/12/img4-Injected-preload-link-head-element-300x84.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img4-Injected-preload-link-head-element.png"/></noscript>
<p>预加载提示浏览器应该安排字体提前下载，Next.js将确保资源可供使用。</p>
<p>添加后，该字体现在应该也适用于Chrome浏览器。下图还显示，该请求来自我们的基础设施，而不是来自交付服务:</p>
<p><img data-attachment-id="153313" data-permalink="https://blog.logrocket.com/next-js-font-optimization/attachment/img5-updated-request-url-localhost/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img5-Updated-request-URL-localhost.png" data-orig-size="730,290" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Updated-request-URL-localhost" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img5-Updated-request-URL-localhost-300x119.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img5-Updated-request-URL-localhost.png" decoding="async" class="aligncenter size-full wp-image-153313 jetpack-lazy-image" src="../Images/3d8460df2f64efe4c5eb87e86a05e7d6.png" alt="Browser Developer Tools Panel With Red Arrow Pointing To Updated Request Url Showing Request Now Comes From Within Infrastructure" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/12/img5-Updated-request-URL-localhost.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/12/img5-Updated-request-URL-localhost-300x119.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img5-Updated-request-URL-localhost.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img5-Updated-request-URL-localhost.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="153313" data-permalink="https://blog.logrocket.com/next-js-font-optimization/attachment/img5-updated-request-url-localhost/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img5-Updated-request-URL-localhost.png" data-orig-size="730,290" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Updated-request-URL-localhost" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img5-Updated-request-URL-localhost-300x119.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img5-Updated-request-URL-localhost.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-153313" src="../Images/3d8460df2f64efe4c5eb87e86a05e7d6.png" alt="Browser Developer Tools Panel With Red Arrow Pointing To Updated Request Url Showing Request Now Comes From Within Infrastructure" srcset="https://blog.logrocket.com/wp-content/uploads/2022/12/img5-Updated-request-URL-localhost.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/12/img5-Updated-request-URL-localhost-300x119.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img5-Updated-request-URL-localhost.png"/></noscript>
<p>请记住，有时<code>@next/font</code>中的默认<code>display: optional</code>会导致Chrome浏览器出现问题。在我们手动刷新chrome选项卡之前，应用的字体可能会在导航离开后恢复到后退状态。我们将在本课稍后讨论这个问题，并学习如何克服它。</p>
<h3>添加多种字体</h3>
<p>使用<code>@next/font</code>添加多个Next.js字体就像定义多个字体实例并将自动生成的类应用到文档元素一样简单:</p>
<pre class="language-javascript hljs">import { Dancing_Script, Oswald } from '@next/font/google';

const dancingScript = Dancing_Script({ subsets: ['latin'] });
const oswald = Oswald({ subsets: ['latin'] });

export default function Home() {
  return (
    &lt;div className={oswald.className}&gt;
      &lt;h1 className={dancingScript.className}&gt;Home page&lt;/h1&gt;
      &lt;p&gt;This paragraph uses another font&lt;/p&gt;
    &lt;/div&gt;
  );
}
</pre>
<p>在上面的代码中，我们从Google导入了一个<code>Oswald</code>变量字体，并将其应用于包装元素，使其可用于子元素。包装内的段落将继承该字体。同时，标题元素上的字体将覆盖包装字体。</p>
<p>请参见下面的输出:</p>
<p><img data-attachment-id="153315" data-permalink="https://blog.logrocket.com/next-js-font-optimization/attachment/img6-multiple-fonts-next-js-developer-pane/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img6-Multiple-fonts-Next-js-developer-pane.png" data-orig-size="730,507" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Multiple-fonts-Next-js-developer-pane" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img6-Multiple-fonts-Next-js-developer-pane-300x208.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img6-Multiple-fonts-Next-js-developer-pane.png" decoding="async" class="aligncenter size-full wp-image-153315 jetpack-lazy-image" src="../Images/28485cfbdd029ff57bf357d05170a581.png" alt="Browser Open To Localhost With Title Text In Dancing Script Font Reading Home Page Above Paragraph Text In Oswald Font. Developer Tools Panel Is Open With Red Arrow Pointing To Overridden Wrapper Font In H1" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/12/img6-Multiple-fonts-Next-js-developer-pane.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/12/img6-Multiple-fonts-Next-js-developer-pane-300x208.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img6-Multiple-fonts-Next-js-developer-pane.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img6-Multiple-fonts-Next-js-developer-pane.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="153315" data-permalink="https://blog.logrocket.com/next-js-font-optimization/attachment/img6-multiple-fonts-next-js-developer-pane/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img6-Multiple-fonts-Next-js-developer-pane.png" data-orig-size="730,507" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Multiple-fonts-Next-js-developer-pane" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img6-Multiple-fonts-Next-js-developer-pane-300x208.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img6-Multiple-fonts-Next-js-developer-pane.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-153315" src="../Images/28485cfbdd029ff57bf357d05170a581.png" alt="Browser Open To Localhost With Title Text In Dancing Script Font Reading Home Page Above Paragraph Text In Oswald Font. Developer Tools Panel Is Open With Red Arrow Pointing To Overridden Wrapper Font In H1" srcset="https://blog.logrocket.com/wp-content/uploads/2022/12/img6-Multiple-fonts-Next-js-developer-pane.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/12/img6-Multiple-fonts-Next-js-developer-pane-300x208.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img6-Multiple-fonts-Next-js-developer-pane.png"/></noscript>
<h3>使用<code>style</code>道具</h3>
<p>我们也可以使用字体加载器返回的<code>style</code>选项，通过<code>style</code>属性应用字体。以下代码使用<code>style</code>选项将字体应用于包装元素:</p>
<pre class="language-javascript hljs">export default function Home() {
  return (
    &lt;div style={oswald.style}&gt;
      &lt;h1 className={dancingScript.className}&gt;Home page&lt;/h1&gt;
      &lt;p&gt;This paragraph uses another font&lt;/p&gt;
    &lt;/div&gt;
  );
}
</pre>
<p>上面的代码会给我们和以前一样的结果。</p>
<h3>不可变字体</h3>
<p>与可变字体不同，非可变字体需要一个<code>weight</code>选项。<code>weight</code>可以是一个字符串或一组值。</p>
<p>Merriweather 就是一个<a href="https://fonts.google.com/specimen/Merriweather">非可变字体的例子，它也可以通过Google Fonts获得。让我们从导入它开始:</a></p>
<pre class="language-javascript hljs">import {
  // ...
  Merriweather,
} from '@next/font/google';
</pre>
<p>然后，向字体实例添加一个必需的<code>weight</code>选项，并将生成的类应用于文档元素:</p>
<pre class="language-javascript hljs">const merriweather = Merriweather({
  weight: ['300', '400', '700'],
  style: ['normal', 'italic'],
  subsets: ['latin'],
});

export default function Home() {
  return (
    // ...
    &lt;p className={merriweather.className}&gt;
      This text uses a non variable font
    &lt;/p&gt;
    // ...
  );
}
</pre>
<p>我们还在font实例中添加了一些可选的<code>style</code>值。保存文件，字体应该适用。</p>
<h3>添加全局字体样式</h3>
<p>为了在整个web文档中应用字体，我们将在<code>pages/_app.js</code>文件中导入字体，并将生成的类传递给<code>Component</code>包装元素，如下所示:</p>
<pre class="language-javascript hljs">import { Raleway } from '@next/font/google';
const raleway = Raleway({ subsets: ['latin'] });

function MyApp({ Component, pageProps }) {
  return (
    &lt;div className={raleway.className}&gt;
      &lt;Component {...pageProps} /&gt;
    &lt;/div&gt;
  );
}

export default MyApp;
</pre>
<p>在上面的代码中，我们导入了一个<code>Raleway</code>字体，也是可变字体。因此，在配置中添加重量选项是可选的。</p>
<h3>在<code>&lt;head&gt;</code>中注入字体</h3>
<p>另一种在文档中应用字体的方法是在<code>&lt;head&gt;</code>中注入字体。在<code>pages/_app.js</code>文件中，我们可以在<code>Component</code>前使用<code>&lt;style&gt;</code>标签来应用全局字体:</p>
<pre class="language-javascript hljs">function MyApp({ Component, pageProps }) {
  return (
    &lt;&gt;
      &lt;style jsx global&gt;{`
        html {
          font-family: ${raleway.style.fontFamily};
        }
      `}&lt;/style&gt;
      &lt;Component {...pageProps} /&gt;
    &lt;/&gt;
  );
}

export default MyApp;
</pre>
<p>记住，我们可以从<code>style</code>对象访问字体系列。</p>
<h3>用CSS变量语法声明全局字体</h3>
<p>CSS变量的语法提供了在样式表中声明多种字体的灵活性。下面的代码在<code>pages/_app.js</code>文件中导入了两种不同的字体，然后我们用它来声明全局CSS变量:</p>
<pre class="language-javascript hljs">import { Raleway, IBM_Plex_Sans } from '@next/font/google';

const raleway = Raleway({ subsets: ['latin'] });
const ibmSans = IBM_Plex_Sans({
  weight: '700',
  subsets: ['latin'],
});

function MyApp({ Component, pageProps }) {
  return (
    &lt;&gt;
      &lt;style jsx global&gt;{`
        :root {
          --raleway-font: ${raleway.style.fontFamily};
          --ibmSans-font: ${ibmSans.style.fontFamily};
        }
      `}&lt;/style&gt;
      &lt;Component {...pageProps} /&gt;
    &lt;/&gt;
  );
}

export default MyApp;
</pre>
<p>代码中的<code>:root</code>伪类将选择根元素，即<code>&lt;html&gt;</code>。</p>
<p>现在，我们可以在CSS文件中应用CSS变量。以下代码应用了一个<code>styles/globals.css</code>文件中的变量:</p>
<pre class="language-css hljs">body {
  font-family: var(--raleway-font);
}

h1, h2, h3 {
  font-family: var(--ibmSans-font);
}
</pre>
<h3><code>variable</code>键选项</h3>
<p>在创建字体实例时，我们还可以添加一个<code>variable</code>键，让我们声明一个CSS变量。这个选项让我们不用使用全局的<code>&lt;style&gt;</code>语法就可以轻松地将字体用于Tailwind CSS和CSS模块。</p>
<p>下面的代码通过<code>variable</code>键选项声明了一个名为<code>--antonio-font</code>的CSS变量:</p>
<pre class="language-css hljs">const antonio = Antonio({
  subsets: ['latin'],
  variable: '--antonio-font',
});
</pre>
<p>如果我们记录结果，我们应该看到返回的对象包含一个<code>variable</code>属性，它将允许我们访问字体:</p>
<p><img data-attachment-id="153317" data-permalink="https://blog.logrocket.com/next-js-font-optimization/attachment/img7-returned-object-antonio-font-css-variable/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img7-Returned-object-antonio-font-CSS-variable.png" data-orig-size="730,146" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Returned-object-antonio-font-CSS-variable" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img7-Returned-object-antonio-font-CSS-variable-300x60.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img7-Returned-object-antonio-font-CSS-variable.png" decoding="async" class="aligncenter size-full wp-image-153317 jetpack-lazy-image" src="../Images/3f1f4c9cbd92e2da7db57f0d54521c57.png" alt="Browser Developer Tools Panel Showing Returned Object For Antonio Font Variable" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/12/img7-Returned-object-antonio-font-CSS-variable.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/12/img7-Returned-object-antonio-font-CSS-variable-300x60.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img7-Returned-object-antonio-font-CSS-variable.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img7-Returned-object-antonio-font-CSS-variable.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="153317" data-permalink="https://blog.logrocket.com/next-js-font-optimization/attachment/img7-returned-object-antonio-font-css-variable/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img7-Returned-object-antonio-font-CSS-variable.png" data-orig-size="730,146" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Returned-object-antonio-font-CSS-variable" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img7-Returned-object-antonio-font-CSS-variable-300x60.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img7-Returned-object-antonio-font-CSS-variable.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-153317" src="../Images/3f1f4c9cbd92e2da7db57f0d54521c57.png" alt="Browser Developer Tools Panel Showing Returned Object For Antonio Font Variable" srcset="https://blog.logrocket.com/wp-content/uploads/2022/12/img7-Returned-object-antonio-font-CSS-variable.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/12/img7-Returned-object-antonio-font-CSS-variable-300x60.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img7-Returned-object-antonio-font-CSS-variable.png"/></noscript>
<p>我们现在可以通过容器元素上的<code>className</code>属性来应用变量名。如果我们在<code>pages/_app.js</code>文件中声明了一个全局字体，<code>Component</code>包装器应该是这样的:</p>
<pre class="language-javascript hljs">&lt;div className={antonio.variable}&gt;
  &lt;Component {...pageProps} /&gt;
&lt;/div&gt;
</pre>
<p>从这里开始，我们可以在Tailwind中使用字体——你将在本课后面看到——或者在CSS模块中使用<a href="https://blog.logrocket.com/a-deep-dive-into-css-modules/">。对于CSS模块，假设我们有一个使用该模块的<code>About</code>页面组件，如下所示:</a></p>
<pre class="language-css hljs">import styles from './About.module.css';

const About = () =&gt; {
  return (
    &lt;div&gt;
      &lt;h1&gt;About page&lt;/h1&gt;
      &lt;p className={styles.text}&gt;This is about page content&lt;/p&gt;
    &lt;/div&gt;
  );
};

export default About;
</pre>
<p>我们可以使用之前声明的CSS变量来访问<code>About.module.css</code>文件中的字体，如下所示:</p>
<pre class="language-css hljs">.text {
  font-family: var(--antonio-font);
  font-style: italic;
}
</pre>
<h2 id="adding-custom-fonts-next-js">在Next.js中添加自定义字体</h2>
<p>在某些场景中，我们想要在Next.js中使用的字体可能不是来自Google Fonts。相反，它可以是我们创建的自定义字体，我们购买的字体，或者我们从另一个字体网站下载的字体。</p>
<p>通过使用<code>@next/font/local</code>配置它们，我们可以在本地使用这些字体中的任何一种。在本节中，我们将通过从字体松鼠下载一个名为<a href="https://www.fontsquirrel.com/fonts/cooper-hewitt">库珀休伊特</a>的字体来演示如何做到这一点。</p>
<p>库珀·休伊特字体没有更现代、压缩更好的格式。因此，我们的第一步是使用<a href="https://www.fontsquirrel.com/tools/webfont-generator">字体</a> <a href="https://www.fontsquirrel.com/tools/webfont-generator"> S </a> <a href="https://www.fontsquirrel.com/tools/webfont-generator">奇洛</a><a href="https://www.fontsquirrel.com/tools/webfont-generator">W</a><a href="https://www.fontsquirrel.com/tools/webfont-generator">EB Font</a><a href="https://www.fontsquirrel.com/tools/webfont-generator">G</a><a href="https://www.fontsquirrel.com/tools/webfont-generator">生成器</a>对其进行转换。之后，我们将在我们项目的<code><a href="https://github.com/Ibaslogic/Next.js-fonts-optimization/tree/main/public/fonts">public/fonts</a></code> <a href="https://github.com/Ibaslogic/Next.js-fonts-optimization/tree/main/public/fonts">文件夹中添加字体的<code>bold</code>和<code>normal</code>粗细变化:</a></p>
<p><img data-attachment-id="153320" data-permalink="https://blog.logrocket.com/next-js-font-optimization/attachment/img8-custom-fonts-next-js-cooper-hewitt-weight-variations/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img8-Custom-fonts-Next-js-Cooper-Hewitt-weight-variations.png" data-orig-size="730,176" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Custom-fonts-Next-js-Cooper-Hewitt-weight-variations" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img8-Custom-fonts-Next-js-Cooper-Hewitt-weight-variations-300x72.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img8-Custom-fonts-Next-js-Cooper-Hewitt-weight-variations.png" decoding="async" class="aligncenter size-full wp-image-153320 jetpack-lazy-image" src="../Images/a1d23a199967ba63466681f6e7f48427.png" alt="Project File Structure With Public Folder Open To Show Fonts Subfolder, Which Is Also Open And Contains Two Cooper Hewitt Font Variations" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/12/img8-Custom-fonts-Next-js-Cooper-Hewitt-weight-variations.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/12/img8-Custom-fonts-Next-js-Cooper-Hewitt-weight-variations-300x72.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img8-Custom-fonts-Next-js-Cooper-Hewitt-weight-variations.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img8-Custom-fonts-Next-js-Cooper-Hewitt-weight-variations.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="153320" data-permalink="https://blog.logrocket.com/next-js-font-optimization/attachment/img8-custom-fonts-next-js-cooper-hewitt-weight-variations/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img8-Custom-fonts-Next-js-Cooper-Hewitt-weight-variations.png" data-orig-size="730,176" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Custom-fonts-Next-js-Cooper-Hewitt-weight-variations" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img8-Custom-fonts-Next-js-Cooper-Hewitt-weight-variations-300x72.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img8-Custom-fonts-Next-js-Cooper-Hewitt-weight-variations.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-153320" src="../Images/a1d23a199967ba63466681f6e7f48427.png" alt="Project File Structure With Public Folder Open To Show Fonts Subfolder, Which Is Also Open And Contains Two Cooper Hewitt Font Variations" srcset="https://blog.logrocket.com/wp-content/uploads/2022/12/img8-Custom-fonts-Next-js-Cooper-Hewitt-weight-variations.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/12/img8-Custom-fonts-Next-js-Cooper-Hewitt-weight-variations-300x72.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img8-Custom-fonts-Next-js-Cooper-Hewitt-weight-variations.png"/></noscript>
<h3>使用本地配置的字体</h3>
<p>就像在Next.js中使用Google字体一样，我们可以加载整个文档或特定页面的本地字体。为了加载站点范围内的本地字体，我们将从<code>pages/_app.js</code>文件中的<code>@next/font/local</code>导入字体加载器:</p>
<pre class="language-javascript hljs">import localFont from '@next/font/local';
</pre>
<p>之后，我们将定义一个新的实例，将本地字体文件的<code>src</code>指定为一个对象数组:</p>
<pre class="language-javascript hljs">const cooper = localFont({
  src: [
    {
      path: '../public/fonts/cooperhewitt-book-webfont.woff2',
      weight: '400',
    },
    {
      path: '../public/fonts/cooperhewitt-bold-webfont.woff2',
      weight: '700',
    },
  ],
});
</pre>
<p>每个对象都代表特定粗细的字体。如果我们使用可变字体，我们可以将<code>src</code>指定为字符串，如下所示:</p>
<pre class="language-javascript hljs">const variableFont = localFont({ src: '../public/fonts/my-variable-font.woff2' });
</pre>
<p>从这一点来看，我们如何应用字体样式与前面讨论的Google字体的方法是一样的。我们可以使用<code>className</code>语法、<code>style</code>或CSS变量。</p>
<p>让我们用<code>&lt;style&gt;</code>语法为本地字体声明一个CSS变量:</p>
<pre class="language-css hljs">function MyApp({ Component, pageProps }) {
  return (
    &lt;&gt;
      &lt;style jsx global&gt;{`
        :root {
          /* ... */
          --cooper-font: ${cooper.style.fontFamily};
        }
      `}&lt;/style&gt;
      &lt;Component {...pageProps} /&gt;
    &lt;/&gt;
  );
}
</pre>
<p>我们现在可以在组件样式表中使用<code>--cooper-font</code> CSS变量。假设我们有一个<code>Contact</code>页面组件，如下所示:</p>
<pre class="language-javascript hljs">import styles from './Contact.module.css';

const contact = () =&gt; {
  return (
    &lt;div className={styles.contact}&gt;
      &lt;h1&gt;Contact page&lt;/h1&gt;
      &lt;p&gt;This is contact content uses a local font&lt;/p&gt;
    &lt;/div&gt;
  );
};

export default contact;
</pre>
<p>我们可以使用CSS变量来访问<code>Contact.module.css</code>文件中的字体，就像这样:</p>
<pre class="language-css hljs">.contact &gt; *{
  font-family: var(--cooper-font);
}
</pre>
<h2 id="adding-fonts-next-js-tailwind-css">使用Tailwind CSS向Next.js添加字体</h2>
<p>为了将<code>@next/font</code>包<a href="https://blog.logrocket.com/how-to-use-custom-fonts-tailwind-css/">与Tailwind CSS </a>一起使用，我们将使用CSS变量语法。幸运的是，我们已经在<code>pages/_app.js</code>文件中声明了几个CSS变量。</p>
<p>回想一下之前，我们在<code>&lt;head&gt;</code>中注入了以下内容:</p>
<pre class="language-javascript hljs">&lt;style jsx global&gt;{`
  :root {
    --raleway-font: ${raleway.style.fontFamily};
    --ibmSans-font: ${ibmSans.style.fontFamily};
    --cooper-font: ${cooper.style.fontFamily};
  }
`}&lt;/style&gt;
</pre>
<p>我们还用<code>variable</code>选项定义了一个CSS变量名，如下所示:</p>
<pre class="language-css hljs">const antonio = Antonio({
  subsets: ['latin'],
  variable: '--antonio-font',
});
</pre>
<p>我们可以使用这些CSS变量声明中的任何一个，用Tailwind CSS添加Next.js字体。让我们在下一节看看如何实现。</p>
<h3>正在配置<code>tailwind.config.js</code>文件</h3>
<p>我们将CSS变量作为字体系列添加到Tailwind CSS配置文件中:</p>
<pre class="language-css hljs">const { fontFamily } = require('tailwindcss/defaultTheme');

/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    './pages/**/*.{js,ts,jsx,tsx}',
    './components/**/*.{js,ts,jsx,tsx}',
  ],
  theme: {
    extend: {
      fontFamily: {
        antonio: ['var(--antonio-font)', ...fontFamily.sans],
        ibm: ['var(--ibmSans-font)', ...fontFamily.sans],
        cooper: ['var(--cooper-font)', 'ui-serif', 'Georgia'],
      },
    },
  },
  plugins: [],
};
</pre>
<p>我们现在可以使用<code>font-antonio</code>、<code>font-ibm</code>和<code>font-cooper</code>实用程序类名来应用字体。实现这些实用程序的组件将如下所示:</p>
<pre class="language-javascript hljs">const Tailwind = () =&gt; {
  return (
    &lt;div&gt;
      &lt;h1 className="font-ibm"&gt;With Tailwind CSS&lt;/h1&gt;
      &lt;p className="font-antonio"&gt;This is a first paragraph&lt;/p&gt;
      &lt;p className="font-cooper"&gt;This is a second paragraph&lt;/p&gt;
    &lt;/div&gt;
  );
};

export default Tailwind;
</pre>
<h2 id="issue-display-optional-chrome">Chrome浏览器中的一个问题</h2>
<p>在单个页面中使用默认的<code>display: optional</code>可能会遇到Chrome问题。此问题会导致元素在导航到其他页面重新加载后恢复回退字体。请参见下面的演示:</p>
<p><img data-attachment-id="153322" data-permalink="https://blog.logrocket.com/next-js-font-optimization/attachment/img9-chrome-display-optional-issue/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img9-Chrome-display-optional-issue.gif" data-orig-size="730,406" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Chrome-display-optional-issue" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img9-Chrome-display-optional-issue-300x167.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img9-Chrome-display-optional-issue.gif" decoding="async" class="aligncenter size-full wp-image-153322 jetpack-lazy-image" src="../Images/011ff5a91bc48915fb0ee896f1c6ea73.png" alt="Browser Opened To Localhost 3000 In Light Mode With Menu Bar And Four Lines Of Text In Varying Fonts. User Shown Navigating To Different Page In Menu Bar, Refreshing Page, Then Returning To Home Page, Where Fonts Have Reverted To Fallback Fonts. User Then Refreshes Home Page To Reapply Proper Web Fonts" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img9-Chrome-display-optional-issue.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img9-Chrome-display-optional-issue.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="153322" data-permalink="https://blog.logrocket.com/next-js-font-optimization/attachment/img9-chrome-display-optional-issue/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img9-Chrome-display-optional-issue.gif" data-orig-size="730,406" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Chrome-display-optional-issue" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img9-Chrome-display-optional-issue-300x167.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/12/img9-Chrome-display-optional-issue.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-153322" src="../Images/011ff5a91bc48915fb0ee896f1c6ea73.png" alt="Browser Opened To Localhost 3000 In Light Mode With Menu Bar And Four Lines Of Text In Varying Fonts. User Shown Navigating To Different Page In Menu Bar, Refreshing Page, Then Returning To Home Page, Where Fonts Have Reverted To Fallback Fonts. User Then Refreshes Home Page To Reapply Proper Web Fonts" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/12/img9-Chrome-display-optional-issue.gif"/></noscript>
<p>如上面的GIF所示，在手动刷新其他页面后，应用于主页元素的字体恢复为备用字体。我们不得不再次刷新主页以重新应用正确的web字体。</p>
<p>解决这个问题的一个方法是在字体实例中使用<code>display: 'swap'</code>而不是默认的。然而，正如我们已经知道的，交换字体可能会导致明显的布局变化。</p>
<p>相反，我建议将字体实例移动到<code>pages/_app.js</code>文件中，并使用<code>className</code>属性、<code>style</code>对象或CSS变量在任何页面上应用字体。</p>
<p>对于我们的项目，我们将把字体声明从<code>pages/index.js</code>文件移动到<code>pages/_app.js</code>文件，并为字体系列声明CSS变量，如下所示:</p>
<pre class="language-javascript hljs">&lt;style jsx global&gt;{`
  :root {
    /* ... */
    --oswald-font: ${oswald.style.fontFamily};
    --merriweather-font: ${merriweather.style.fontFamily};
    --dancingScript-font: ${dancingScript.style.fontFamily};
  }
`}&lt;/style&gt;
</pre>
<p>我们现在可以重构<code>pages/index.js</code>文件来使用CSS模块，就像这样:</p>
<pre class="language-javascript hljs">import styles from './Home.module.css';

export default function Home() {
  return (
    &lt;&gt;
      &lt;div className={styles.oswald}&gt;
        &lt;h1 className={styles.dancingScript}&gt;Home page&lt;/h1&gt;
        &lt;p className={styles.merriweather}&gt;
          This text uses a non variable font
        &lt;/p&gt;
        &lt;p&gt;This paragraph uses another font&lt;/p&gt;
      &lt;/div&gt;
      &lt;p&gt;This text should take global styles&lt;/p&gt;
    &lt;/&gt;
  );
}
</pre>
<p>然后，使用我们声明的CSS变量来访问<code>Home.module.css</code>文件中的字体，就像这样:</p>
<pre class="language-css hljs">.oswald {
  font-family: var(--oswald-font);
}
.dancingScript {
  font-family: var(--dancingScript-font);
}
.merriweather {
  font-family: var(--merriweather-font);
}
</pre>
<p>如果我们保存了所有文件，这些字体现在应该可以像在其他浏览器中一样在Chrome上正常使用了。</p>
<h2 id="conclusion">结论</h2>
<p>正如我们在本课中看到的，Next.js v13中引入的<code>@next/font</code>系统通过抽象其复杂性来简化字体优化。我们已经使用这个系统在Next.js应用程序中添加了自定义字体和Google字体。</p>
<p><a href="https://next-js-fonts-optimization.vercel.app/">在我们的演示项目</a>中，我们添加了多种字体来帮助演示在Next.js中使用字体的各种方法。然而，在生产站点中，我们应该考虑尽量减少预加载字体的数量。</p>
<p>我希望你喜欢这一课。如果你有问题或贡献，请在评论区分享你的想法。参见GitHub 上项目的<a href="https://github.com/Ibaslogic/Next.js-fonts-optimization">完整源代码。</a></p><div class="code-block code-block-30">
<div class="blog-plug inline-plug next-plug"><h2><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank"> LogRocket </a>:全面了解生产Next.js应用</h2><p>调试下一个应用程序可能会很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪状态、自动显示JavaScript错误、跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-lazy-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/></noscript></a><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><p>LogRocket 就像是网络和移动应用的DVR，记录下你的Next.js应用上发生的一切。您可以汇总并报告问题发生时应用程序的状态，而不是猜测问题发生的原因。LogRocket还可以监控应用程序的性能，报告客户端CPU负载、客户端内存使用等指标。</p><p>LogRocket Redux中间件包为您的用户会话增加了一层额外的可见性。LogRocket记录Redux存储中的所有操作和状态。</p><p>让您调试Next.js应用的方式现代化— <a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>