<html>
<head>
<title>Using React with Appwrite to set up user authentication </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用React和Appwrite设置用户身份验证</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/using-react-appwrite-user-authentication/#0001-01-01">https://blog.logrocket.com/using-react-appwrite-user-authentication/#0001-01-01</a></blockquote><div><article class="article-post">
<p>用户身份验证是任何web应用程序的重要组成部分，对于许多开发人员来说，设置用户身份验证是一项艰巨的任务。但是，在Appwrite的帮助下，这个过程可以变得更加容易和简化。</p>
<p>本教程将介绍如何使用Appwrite Web SDK与Appwrite的新Graphql API进行交互，以便在React应用程序中设置用户身份验证。我们将讨论如何实现注册功能，处理用户登录和注销，以及实现电子邮件验证功能。</p>
<p>向前跳:</p>

<p>要学习本教程，您应该对React及其概念有一个基本的了解。本教程还要求对GraphQL有基本的了解，包括如何编写查询和变异。</p>
<p>所以，让我们开始吧！</p>
<h2 id="setting-up-appwrite">设置Appwrite</h2>
<p>在这篇博客中，我们将讨论如何使用Appwrite在React应用程序中轻松实现用户认证。但是在深入细节之前，我们先简单讨论一下Appwrite是什么。</p>
<p>Appwrite是一个开源、自托管、后端即服务的平台。它提供了所有的核心API，允许开发人员轻松地管理各种服务并与之交互，例如用户认证、数据库管理和文件存储。</p>
<p>通过使用Appwrite，开发人员可以专注于构建他们的核心应用程序逻辑，而将后端基础架构留给Appwrite。</p>
<p>设置Appwrite的第一步是使用Docker安装它。为此，您需要在您的主机上安装<a href="https://www.docker.com/products/docker-desktop/"> Docker CLI </a>。然后，您可以根据您的操作系统运行以下命令之一来安装Appwrite。</p>
<p>在运行该命令之前，请确保Docker正在您的机器上运行。</p>
<p>要在Mac或Linux设备上安装Appwrite，请使用以下命令:</p>
<pre class="language-bash hljs">docker run -it --rm \
    --volume /var/run/docker.sock:/var/run/docker.sock \
    --volume "$(pwd)"/appwrite:/usr/src/code/appwrite:rw \
    --entrypoint="install" \
    appwrite/appwrite:1.2.0
</pre>
<p>要在Windows设备上安装Appwrite，请使用命令提示符运行以下命令:</p>
<pre class="language-bash hljs">docker run -it --rm ^
    --volume //var/run/docker.sock:/var/run/docker.sock ^
    --volume "%cd%"/appwrite:/usr/src/code/appwrite:rw ^
    --entrypoint="install" ^
    appwrite/appwrite:1.2.0
</pre>
<p>运行该命令后，将提示您一系列配置问题。这些问题会询问诸如HTTP端口、主机名和其他设置等信息。您可以通过按enter键选择默认选项，或者根据需要修改选项。</p>
<p>关于安装Appwrite的更多详细说明，可以参考Appwrite网站上的官方<a href="https://appwrite.io/docs/installation">安装文档</a>。</p>
<h2 id="creating-project-appwrite-console">在Appwrite控制台上创建项目</h2>
<p>现在您已经在机器上安装并运行了Appwrite，您可以通过导航到<a href="http://localhost" rel="nofollow"> http://localhost </a>来访问Appwrite控制台。</p>
<p>系统将提示您创建新帐户。此帐户将用于访问Appwrite控制台并管理您的项目和服务。</p>
<p>要创建项目，请单击Appwrite仪表板上的“创建项目”按钮，输入项目名称，然后单击“创建”</p>
<p>一旦您创建了一个项目，您将需要向您的项目添加一个web平台来初始化Appwrite SDK并与Appwrite APIs进行交互。您可以通过点击Appwrite控制台上的“Web App”按钮来完成此操作。</p>
<p>系统将提示您输入项目名称和主机名。出于开发目的，您可以使用<code>localhost</code>作为您的主机名。一旦添加了web平台，您将能够使用Appwrite SDK与Appwrite服务进行交互。</p>
<h2 id="cloning-starter-code-react-appwrite-project">克隆React和Appwrite项目的启动代码</h2>
<p>为了快速开始，我创建了一个包含所有必要代码的<a href="https://github.com/rishipurwar1/appwrite-graphql-authentication"> starter代码库</a>。要克隆启动代码，请打开终端并运行以下命令:</p>
<pre class="language-bash hljs">git clone https://github.com/rishipurwar1/appwrite-graphql-authentication.git
</pre>
<p>一旦您克隆了starter代码库，您将在<code>src/components</code>文件夹中找到所有的<code>components</code>。这些组件包括:</p>
<ul>
<li><code>Navbar.js</code> —负责在应用程序顶部显示导航栏<ul>
<li>包含应用程序不同页面的链接</li>
</ul>
</li>
<li><code>Home.js</code> —示例应用程序的主登录页面</li>
<li><code>Login.js</code> —包含登录表单的代码</li>
<li><code>Signup.js</code> —包含注册表单的代码</li>
<li><code>Profile.js</code> —包含个人资料页面的代码<ul>
<li>显示用户的配置文件信息(显示名称、电子邮件地址等。)</li>
</ul>
</li>
</ul>
<p>除了前面提到的组件之外，starter代码存储库还在<code>src/App.js</code>文件中包含React路由器的<a href="https://blog.logrocket.com/migrating-react-router-v6-guide/">路由设置。例如，<code>/</code> URL被映射到<code>Home</code>组件，<code>/login</code> URL被映射到<code>Login</code>组件，等等。</a></p>
<p>您还可以在<code>src/App.css</code>文件中找到所有组件的CSS代码，这些代码被导入到<code>App.js</code>文件中。</p>
<p>在克隆了起始代码存储库之后，您必须在运行应用程序之前安装所有的依赖项。为此，您需要导航到<code>appwrite-graphql-authentication</code>目录并运行以下命令:</p>
<pre class="language-bash hljs">npm install
</pre>
<p>安装完依赖项后，您可以使用以下命令运行应用程序:</p>
<pre class="language-javascript hljs">npm start
</pre>
<p>该命令将启动应用程序，您可以通过在web浏览器中导航到<a href="http://localhost:3000/"> http://localhost:3000 </a>来访问该应用程序。</p>
<h2 id="setting-up-appwrite-web-sdk">设置Appwrite Web SDK</h2>
<p>既然我们的示例应用程序已经启动并运行，我们可以继续安装<code>appwrite</code>包，以便使用Appwrite Web SDK轻松地与Appwrite服务进行交互。为此，通过运行以下命令安装<code>appwrite</code>包:</p>
<pre class="language-bash hljs">npm install appwrite
</pre>
<p>一旦软件包安装完毕，在<code>src</code>文件夹中创建一个<code>appwrite</code>文件夹，并在其中创建一个<code>config.js</code>文件。该文件将用于导入和初始化Appwrite SDK。</p>
<p>在<code>config.js</code>文件中，您可以导入Appwrite模块，并通过向文件添加以下代码来初始化Appwrite SDK:</p>
<pre class="language-javascript hljs">import { Client, Graphql } from "appwrite";

// initialize SDK
const client = new Client();
client
  .setEndpoint("YOUR_API_ENDPOINT") // Replace this
  .setProject("YOUR_PROJECT_ID"); // Replace this

export const graphql = new Graphql(client);
</pre>
<p>确保用项目的API端点和项目ID替换“您的API端点”和“您的项目ID”。您可以在Appwrite项目设置页面上找到此信息:</p>
<p><img data-attachment-id="161992" data-permalink="https://blog.logrocket.com/using-react-appwrite-user-authentication/attachment/img1-appwrite-api-credentials/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Appwrite-API-credentials.png" data-orig-size="730,412" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Appwrite-API-credentials" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Appwrite-API-credentials-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Appwrite-API-credentials.png" decoding="async" class="aligncenter size-full wp-image-161992 jetpack-lazy-image" src="../Images/fc12f8fa399a4c140f1ce8962b931a1f.png" alt="Appwrite Project Settings Page With Yellow Arrows Pointing To Project Id And Api Endpoint" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Appwrite-API-credentials.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Appwrite-API-credentials-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Appwrite-API-credentials.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Appwrite-API-credentials.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="161992" data-permalink="https://blog.logrocket.com/using-react-appwrite-user-authentication/attachment/img1-appwrite-api-credentials/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Appwrite-API-credentials.png" data-orig-size="730,412" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Appwrite-API-credentials" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Appwrite-API-credentials-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Appwrite-API-credentials.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-161992" src="../Images/fc12f8fa399a4c140f1ce8962b931a1f.png" alt="Appwrite Project Settings Page With Yellow Arrows Pointing To Project Id And Api Endpoint" srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Appwrite-API-credentials.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Appwrite-API-credentials-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img1-Appwrite-API-credentials.png"/></noscript>
<p>在代码的最后一行，我们创建并导出了<code>graphql</code>实例，我们将在其他组件中使用它来与Appwrite Graphql API进行交互。</p>
<h2 id="implementing-signup-functionality-react-app">在React应用中实现注册功能</h2>
<p>在本节中，我们将实现React应用程序的注册功能。为此，我们将<a href="https://blog.logrocket.com/create-your-own-custom-react-hooks/">创建一个定制钩子</a>，它将包含用于<code>login</code>、<code>signup</code>和<code>logout</code>动作的函数。这个钩子也有一个状态变量来跟踪登录的用户。</p>
<p>通过创建自定义挂钩，我们可以在一个地方轻松管理与用户身份验证相关的状态和功能。这将使跨不同组件重用代码变得容易，并使应用程序保持有序。</p>
<p>现在，让我们在<code>src</code>文件夹中创建一个<code>hooks</code>文件夹，然后创建一个<code>useAuth.js</code>文件。在这个文件的顶部，从<code>config.js</code>导入<code>graphql</code>。然后，您需要通过添加以下代码来创建一个<code>useAuth</code>函数:</p>
<pre class="language-javascript hljs">import { graphql } from "../appwrite/config";

const useAuth = () =&gt; {
  // useAuth hook code goes here
};

export default useAuth;
</pre>
<p>让我们在<code>useAuth</code>中创建一个<code>signup</code>函数。我们可以通过添加以下代码来实现这一点:</p>
<pre class="language-javascript hljs">import { graphql } from "../appwrite/config";

const useAuth = () =&gt; {
  // sign up functionality
  const signup = async (email, password, username) =&gt; {
    const response = await graphql.mutation({
      query: `mutation (
                $email: String!,
                $password: String!,
                $name: String
            ) {
                accountCreate(
                    userId: "unique()",
                    email: $email,
                    password: $password,
                    name: $name
                ) {
                  _id
                }
            }`,
      variables: {
        email: email,
        password: password,
        name: username,
      },
    });

    if (response.errors) {
      throw response.errors[0].message;
    }
  };

  return {
    signup,
  };
};

export default useAuth;
</pre>
<p>我们在上面的代码中创建的<code>signup</code>函数接受三个参数— <code>email</code>、<code>password</code>和<code>username</code>。在函数内部，有一个叫做<code>graphql.mutation</code>的方法，用于对数据进行修改。在这种情况下，该方法使用提供的电子邮件、密码和用户名创建一个新帐户。</p>
<p><code>mutation</code>方法接受一个包含两个属性的对象——<code>query</code>属性和<code>variables</code>对象。</p>
<p><code>query</code>属性使用<code>accountCreate</code>变异，用提供的电子邮件、密码和用户名创建一个新的用户帐户。</p>
<p><code>variables</code>对象用于将<code>email</code>、<code>password</code>和<code>username</code>的值动态传递给<code>accountCreate</code>变异。如果变异成功，会返回创建账号的<code>_id</code>。</p>
<p>添加<code>if</code>块是为了在创建账户时检查任何错误。</p>
<p>最后，钩子返回一个包含<code>signup</code>函数的对象，该函数可以在其他组件中使用。</p>
<h3>在我们的Appwrite项目中使用<code>signup</code>函数</h3>
<p>现在我们已经在我们的<code>useAuth</code>钩子中创建了<code>signup</code>函数，我们可以在我们的<code>Signup</code>组件中使用它来创建一个新账户。在此之前，让我解释一下<code>Signup</code>组件代码。</p>
<p>在这个组件中，我们有两个函数— <code>handleChange</code>和<code>handleSubmit</code>。</p>
<p><code>handleChange</code>函数用于用用户在表单输入字段中输入的值更新<code>user</code>状态变量。</p>
<p><code>handleSubmit</code>函数用于处理表单提交事件，防止默认的表单提交行为。在这个例子中，这个函数只将用户对象记录到控制台，但是稍后，我们将使用<code>signup</code>函数创建一个新帐户。</p>
<p>该表单有三个输入字段，分别为<code>email</code>、<code>username</code>和<code>password</code>。每个输入字段都有一个<code>onChange</code>事件，该事件调用<code>handleChange</code>函数用用户输入的值更新<code>user</code>状态变量。</p>
<p><code>form</code>元素还有一个<code>onSubmit</code>事件，当用户点击提交按钮时，该事件调用<code>handleSubmit</code>函数。</p>
<p>当用户使用<code>Signup</code>表单注册时，让我们使用<code>signup</code>函数创建一个新的用户帐户。</p>
<p>为此，首先，我们需要在<code>Signup</code>组件中导入<code>useAuth</code>钩子，然后调用<code>useAuth</code>钩子并从中析构<code>signup</code>函数。然后，用用户输入的<code>email</code>、<code>password</code>和<code>username</code>的值调用<code>handleSubmit</code>函数内的<code>signup</code>函数。</p>
<p>您的代码应该如下所示:</p>
<pre class="language-javascript hljs">import { useState } from "react";
import { Link } from "react-router-dom";
import { useAuth } from "../hooks/useAuth"; // import useAuth

const Signup = () =&gt; {
  const [user, setUser] = useState({});
  const { signup } = useAuth();

  const handleChange = (e) =&gt; {
    setUser({ ...user, [e.target.name]: e.target.value });
  };

  const handleSubmit = async (e) =&gt; {
    e.preventDefault();
    try {
      await signup(user.email, user.password, user.username);
      alert("Account created successfully!");
    } catch (error) {
      console.log(error);
    }
  };

  // rest of the code
}
</pre>
<p>要测试注册功能，请打开应用程序的注册页面。在表格中填写您的电子邮件、用户名和密码。请记住，密码长度至少应为八个字符。</p>
<p><img data-attachment-id="161994" data-permalink="https://blog.logrocket.com/using-react-appwrite-user-authentication/attachment/img2-application-signup-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Application-signup-page.png" data-orig-size="730,415" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Application-signup-page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Application-signup-page-300x171.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Application-signup-page.png" decoding="async" class="aligncenter size-full wp-image-161994 jetpack-lazy-image" src="../Images/96fe5c250707cb863bbc8ccef4ed4db4.png" alt="React Application Appwrite Signup Page With Input Fields For Email, Username, And Password With Blue Sign Up Button" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Application-signup-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Application-signup-page-300x171.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Application-signup-page.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Application-signup-page.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="161994" data-permalink="https://blog.logrocket.com/using-react-appwrite-user-authentication/attachment/img2-application-signup-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Application-signup-page.png" data-orig-size="730,415" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Application-signup-page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Application-signup-page-300x171.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Application-signup-page.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-161994" src="../Images/96fe5c250707cb863bbc8ccef4ed4db4.png" alt="React Application Appwrite Signup Page With Input Fields For Email, Username, And Password With Blue Sign Up Button" srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Application-signup-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Application-signup-page-300x171.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img2-Application-signup-page.png"/></noscript>
<p>填写完表格后，单击“注册”按钮提交表格。如果帐户创建成功，您应该会看到一条警告消息。如果帐户创建失败，控制台上会显示一条错误消息。</p>
<p>您还可以通过检查您的Appwrite项目仪表板来验证用户是否已经创建。登录到您的Appwrite帐户，导航到项目仪表板，并选择侧边栏上的“Auth”选项卡。在这里，您将能够看到刚刚创建的新用户帐户:</p>
<p><img data-attachment-id="161996" data-permalink="https://blog.logrocket.com/using-react-appwrite-user-authentication/attachment/img3-appwrite-project-dashboard-new-user/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Appwrite-project-dashboard-new-user.png" data-orig-size="730,412" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Appwrite-project-dashboard-new-user" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Appwrite-project-dashboard-new-user-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Appwrite-project-dashboard-new-user.png" decoding="async" class="aligncenter size-full wp-image-161996 jetpack-lazy-image" src="../Images/ccd5647e6cea77fc351e3771ec15aeda.png" alt="Appwrite Project Dashboard Displaying Newly Created User" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Appwrite-project-dashboard-new-user.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Appwrite-project-dashboard-new-user-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Appwrite-project-dashboard-new-user.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Appwrite-project-dashboard-new-user.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="161996" data-permalink="https://blog.logrocket.com/using-react-appwrite-user-authentication/attachment/img3-appwrite-project-dashboard-new-user/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Appwrite-project-dashboard-new-user.png" data-orig-size="730,412" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Appwrite-project-dashboard-new-user" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Appwrite-project-dashboard-new-user-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Appwrite-project-dashboard-new-user.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-161996" src="../Images/ccd5647e6cea77fc351e3771ec15aeda.png" alt="Appwrite Project Dashboard Displaying Newly Created User" srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Appwrite-project-dashboard-new-user.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Appwrite-project-dashboard-new-user-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img3-Appwrite-project-dashboard-new-user.png"/></noscript>
<p>恭喜你！🎉您已经使用Appwrite在React应用程序中成功实现了注册功能。</p>
<h2 id="implementing-login-functionality-react-app">在React应用中实现登录功能</h2>
<p>为了使用Appwrite在React应用程序中实现登录功能，我们将遵循与注册功能类似的方法。首先，通过添加以下代码，在<code>useAuth</code>挂钩内创建一个<code>login</code>函数:</p>
<pre class="language-javascript hljs">import { graphql } from "../appwrite/config";

const useAuth = () =&gt; {
  const signup = async (email, password, username) =&gt; {
   // signup function code
  };

  const login = async (email, password) =&gt; {
    const response = await graphql.mutation({
      query: `mutation (
          $email: String!,
          $password: String!,
      ) {
        accountCreateEmailSession(
          email: $email,
          password: $password,
      ) {
          _id
        }
      }`,
      variables: {
        email: email,
        password: password,
      },
    });

    if (response.errors) {
      throw response.errors[0].message;
    }
  };

  return {
    signup,
    login, // return it
  };
};

export default useAuth;
</pre>
<p>上面的查询属性使用了<code>accountCreateEmailSession</code>突变，允许用户通过提供有效的电子邮件和密码来登录他们的帐户。这将为用户创建一个新会话。</p>
<h3>在我们的Appwrite项目中使用<code>login</code>函数</h3>
<p>让我们在<code>Login.js</code>文件中导入<code>useAuth</code>钩子，并在<code>Login</code>组件中调用它。然后，从<code>useAuth</code>钩子中析构<code>login</code>函数。最后，调用<code>handleSubmit</code>函数内部的<code>login</code>函数，传入用户输入的<code>email</code>和<code>password</code>的值。</p>
<p>代码应该如下所示:</p>
<pre class="language-javascript hljs">import { useState } from "react";
import { Link, useNavigate } from "react-router-dom";
import useAuth from "../hooks/useAuth";

const Login = () =&gt; {
  const [user, setUser] = useState({});
  const navigate = useNavigate();
  const { login } = useAuth();

  const handleChange = (e) =&gt; {
    setUser({ ...user, [e.target.name]: e.target.value });
  };

  const handleSubmit = async (e) =&gt; {
    e.preventDefault();
    try {
      await login(user.email, user.password);
      navigate("/profile");
    } catch (error) {
      console.log(error);
    }
  };

  // rest of the code
};

export default Login;
</pre>
<p>要测试登录特性，请打开应用程序的登录页面。在表格中填写您的电子邮件和密码。填写完表格后，单击“登录”按钮提交表格。</p>
<p><img data-attachment-id="161998" data-permalink="https://blog.logrocket.com/using-react-appwrite-user-authentication/attachment/img4-application-login-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Application-login-page.png" data-orig-size="730,415" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Application-login-page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Application-login-page-300x171.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Application-login-page.png" decoding="async" class="aligncenter size-full wp-image-161998 jetpack-lazy-image" src="../Images/a798502b499713ffcfeabcd73c425a50.png" alt="React Application Appwrite Login Form With Fields For Email And Password Above Blue Log In Button" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Application-login-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Application-login-page-300x171.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Application-login-page.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Application-login-page.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="161998" data-permalink="https://blog.logrocket.com/using-react-appwrite-user-authentication/attachment/img4-application-login-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Application-login-page.png" data-orig-size="730,415" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Application-login-page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Application-login-page-300x171.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Application-login-page.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-161998" src="../Images/a798502b499713ffcfeabcd73c425a50.png" alt="React Application Appwrite Login Form With Fields For Email And Password Above Blue Log In Button" srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Application-login-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Application-login-page-300x171.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img4-Application-login-page.png"/></noscript>
<p>如果登录成功，用户将被导航到<code>/profile</code>页面。如果登录失败，控制台上会显示一条错误消息。</p>
<p>目前，配置文件页面上显示的信息是硬编码的，但是我们将在下一节中通过使用Appwrite API获取登录用户的数据来使其动态化。</p>
<h2 id="fetching-logged-in-user-data-appwrite-api">使用Appwrite API获取登录的用户数据</h2>
<p>在这一节中，我将向您展示如何获取登录用户的数据并将其显示在<code>Profile</code>组件上。首先，让我们使用<code>useAuth</code>钩子中的<a href="https://blog.logrocket.com/guide-usestate-react/"/><code><a href="https://blog.logrocket.com/guide-usestate-react/">useState</a></code><a href="https://blog.logrocket.com/guide-usestate-react/">钩子</a>创建一个用户状态，并将其设置为<code>null</code>:</p>
<pre class="language-javascript hljs">import { useState } from "react"; // import useState

const useAuth = () =&gt; {
  const [user, setUser] = useState(null); // create a user state

  // rest of the code
}
</pre>
<p>接下来，我们将在<code>useAuth</code>钩子内部创建<code>getCurrentUser</code>函数。<code>getCurrentUser</code>函数使用Appwrite GraphQL API提供的<code>accountGet</code>查询来获取当前登录用户的数据。</p>
<p>下面是<code>getCurrentUser</code>函数的代码:</p>
<pre class="language-javascript hljs">const getCurrentUser = async () =&gt; {
  const response = await graphql.query({
    query: `query {
          accountGet {
              _id
              name
              emailVerification
              email
          }
      }`,
  });
  return response.data.accountGet;
};
</pre>
<p>如您所见，该查询返回一个包含用户ID、姓名、电子邮件地址和电子邮件验证状态的对象。</p>
<p>接下来，我们将使用<a href="https://blog.logrocket.com/useeffect-hook-complete-guide/"/><code><a href="https://blog.logrocket.com/useeffect-hook-complete-guide/">useEffect</a></code><a href="https://blog.logrocket.com/useeffect-hook-complete-guide/">钩子</a>调用<code>getCurrentUser</code>函数，并用返回的数据更新<code>user</code>状态。</p>
<p>最后，我们将从<code>useAuth</code>钩子返回<code>user</code>状态，这样就可以在其他组件中访问它。</p>
<p>您的<code>useAuth</code>代码应该是这样的:</p>
<pre class="language-javascript hljs">import { useEffect, useState } from "react"; // import useEffect
import { graphql } from "../appwrite/config";

const useAuth = () =&gt; {
  const [user, setUser] = useState(null);

  const signup = async (email, password, username) =&gt; {
    // signup code
  };

  const login = async (email, password) =&gt; {
    // login code
  };

  const getCurrentUser = async () =&gt; {
    // getCurrentUser code
  };

  // fetching the logged user data
  useEffect(() =&gt; {
    const fetchUser = async () =&gt; {
      const userDetails = await getCurrentUser();
      setUser(userDetails);
    };
    fetchUser();
  }, []);

  return {
    signup,
    login,
    user, // return it
  };
};

export default useAuth;
</pre>
<h2 id="using-user-state-profile-component">使用<code>Profile</code>组件中的用户状态</h2>
<p>在<code>Profile</code>组件中，您可以导入<code>useAuth</code>钩子并析构<code>user</code>状态。然后，您可以使用<code>user</code>数据在个人资料页面上显示用户的姓名、电子邮件和其他信息。</p>
<p>下面是<code>Profile</code>组件的更新代码:</p>
<pre class="language-javascript hljs">import useAuth from "../hooks/useAuth"; // import useAuth

const Profile = () =&gt; {
  const { user } = useAuth(); // destructure user

  return (
    &lt;div className="profile"&gt;
      &lt;h1 className="name"&gt;Welcome, {user?.name}&lt;/h1&gt;
      &lt;h2 className="email"&gt;Email: {user?.email}&lt;/h2&gt;
    &lt;/div&gt;
  );
};

export default Profile;
</pre>
<p>更新代码后，您应该会看到当前登录的用户名和电子邮件显示在<code>/profile</code>页面上:</p>
<p><img data-attachment-id="162000" data-permalink="https://blog.logrocket.com/using-react-appwrite-user-authentication/attachment/img5-application-welcome-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img5-Application-welcome-page.png" data-orig-size="730,410" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Application-welcome-page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img5-Application-welcome-page-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img5-Application-welcome-page.png" decoding="async" class="aligncenter size-full wp-image-162000 jetpack-lazy-image" src="../Images/aa938679dac894353e9ed83da92633a5.png" alt="React Application Welcome Screen With Welcome Message, Test Username, And Email Displayed" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img5-Application-welcome-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img5-Application-welcome-page-300x168.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img5-Application-welcome-page.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img5-Application-welcome-page.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162000" data-permalink="https://blog.logrocket.com/using-react-appwrite-user-authentication/attachment/img5-application-welcome-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img5-Application-welcome-page.png" data-orig-size="730,410" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Application-welcome-page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img5-Application-welcome-page-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img5-Application-welcome-page.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162000" src="../Images/aa938679dac894353e9ed83da92633a5.png" alt="React Application Welcome Screen With Welcome Message, Test Username, And Email Displayed" srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img5-Application-welcome-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img5-Application-welcome-page-300x168.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img5-Application-welcome-page.png"/></noscript>
<h2 id="implementing-logout-functionality-react-app">在React应用中实现注销功能</h2>
<p>要使用Appwrite在React应用中实现注销功能，首先通过添加以下代码在<code>useAuth</code>挂钩中创建一个<code>logout</code>函数:</p>
<pre class="language-javascript hljs">const logout = async () =&gt; {
  const response = await graphql.mutation({
    query: `mutation {
          accountDeleteSession(
              sessionId: "current"
          ) {
              status
          }
      }`,
  });

  if (response.errors) {
    throw response.errors[0].message;
  }
};
</pre>
<p>如您所见，<code>accountDeleteSession</code>突变将“current”作为会话ID，从当前设备会话中注销当前登录的用户。</p>
<p>最后，我们将从<code>useAuth</code>钩子返回<code>logout</code>函数，这样就可以在其他组件中访问它。</p>
<p>您的<code>useAuth</code>代码应该是这样的:</p>
<pre class="language-javascript hljs">import { useEffect, useState } from "react";
import { graphql } from "../appwrite/config";

const useAuth = () =&gt; {
  const [user, setUser] = useState(null);

  const signup = async (email, password, username) =&gt; {
    // signup code
  };

  const login = async (email, password) =&gt; {
    // login code
  };

  const getCurrentUser = async () =&gt; {
    // getCurrentUser code
  };

  // logout function
  const logout = async () =&gt; {
    // logout code
  };

  useEffect(() =&gt; {
    // code
  }, []);

  return {
    signup,
    login,
    logout, // return logout
    user
  };
};

export default useAuth;
</pre>
<h3>在我们的Appwrite项目中使用注销功能</h3>
<p>让我们在<code>Profile.js</code>文件中导入<code>useAuth</code>钩子，并在<code>Profile</code>组件中调用它。然后，从<code>useAuth</code>钩子中析构<code>logout</code>函数。</p>
<p>接下来，通过添加以下代码，在<code>Profile</code>组件中创建一个<code>handleLogout</code>函数:</p>
<pre class="language-javascript hljs">const handleLogout = async () =&gt; {
  try {
    await logout();
    navigate("/login");
  } catch (error) {
    console.log(error);
  }
};
</pre>
<p>最后，向“注销”按钮添加一个<code>onClick</code>事件监听器。您的<code>Profile</code>组件代码应该如下所示:</p>
<pre class="language-javascript hljs">import { useNavigate } from "react-router-dom"; // import useNavigate
import useAuth from "../hooks/useAuth";

const Profile = () =&gt; {
  const { logout, user } = useAuth();
  const navigate = useNavigate();

  const handleLogout = async () =&gt; {
    try {
      await logout();
      navigate("/login");
    } catch (error) {
      console.log(error);
    }
  };

  return (
    &lt;div className="profile"&gt;
      &lt;h1 className="name"&gt;Welcome, {user?.name}&lt;/h1&gt;
      &lt;h2 className="email"&gt;Email: {user?.email}&lt;/h2&gt;
      &lt;button className="logOut-btn" onClick={handleLogout}&gt;
        Log Out
      &lt;/button&gt;
    &lt;/div&gt;
  );
};
export default Profile;
</pre>
<p>要测试<code>logout</code>功能，请打开个人资料页面并点击“注销”按钮。如果注销操作成功，用户将被重定向到<code>/login</code>页面。如果注销操作失败，控制台上会显示一条错误消息。</p>
<h2 id="adding-email-verification-functionality-appwrites-graphql-api">使用Appwrite的GraphQL API添加电子邮件验证功能</h2>
<p>在本节中，我们将学习如何使用Appwrite的GraphQL API在我们的应用程序中实现电子邮件验证功能。要验证用户的电子邮件地址，我们需要完成两个步骤:</p>
<ul>
<li>向用户的电子邮件地址发送验证链接</li>
<li>一旦用户点击验证链接，请确认电子邮件地址</li>
</ul>
<p>但是在我们开始之前，需要注意的是，为了发送验证邮件，我们需要设置一个第三方SMTP提供商，比如SendGrid 或MailGun。在本教程中，我们将使用MailGun。</p>
<p>要设置MailGun，首先<a href="https://www.mailgun.com/">到MailGun网站</a>注册一个免费账户。注册后，你将被带到仪表板，在那里你需要通过<a href="https://help.mailgun.com/hc/en-us/articles/217531258-Authorized-Recipients">按照MailGun的指示</a>来验证你的电子邮件地址。</p>
<p>之后，选择“概述”页面上的“SMTP”选项。在这里，您可以找到您的SMTP凭证，如主机名、端口、用户名和密码:</p>
<p><img data-attachment-id="162002" data-permalink="https://blog.logrocket.com/using-react-appwrite-user-authentication/attachment/img6-mailgun-smtp-credentials/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img6-MailGun-SMTP-credentials.png" data-orig-size="730,255" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="MailGun-SMTP-credentials" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img6-MailGun-SMTP-credentials-300x105.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img6-MailGun-SMTP-credentials.png" decoding="async" class="aligncenter size-full wp-image-162002 jetpack-lazy-image" src="../Images/6905114121db1c94f1eb30d6e5838c80.png" alt="Mailgun Dashboard With Overview Menu Item Open And Smtp Option Selected" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img6-MailGun-SMTP-credentials.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img6-MailGun-SMTP-credentials-300x105.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img6-MailGun-SMTP-credentials.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img6-MailGun-SMTP-credentials.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162002" data-permalink="https://blog.logrocket.com/using-react-appwrite-user-authentication/attachment/img6-mailgun-smtp-credentials/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img6-MailGun-SMTP-credentials.png" data-orig-size="730,255" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="MailGun-SMTP-credentials" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img6-MailGun-SMTP-credentials-300x105.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img6-MailGun-SMTP-credentials.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162002" src="../Images/6905114121db1c94f1eb30d6e5838c80.png" alt="Mailgun Dashboard With Overview Menu Item Open And Smtp Option Selected" srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img6-MailGun-SMTP-credentials.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img6-MailGun-SMTP-credentials-300x105.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img6-MailGun-SMTP-credentials.png"/></noscript>
<h3>用您的SMTP凭证配置<code>.env</code>文件</h3>
<p>现在，打开安装Appwrite时创建的<code>appwrite</code>文件夹，而不是我们在项目文件夹中创建的文件夹。在这个文件夹中，您会发现一个名为<code>.env</code>的文件，它需要用您的SMTP凭证进行更新。</p>
<p>打开<code>.env</code>文件，用项目的相关信息更新以下字段:</p>
<ul>
<li><code>_APP_SMTP_HOST</code> —您的SMTP主机名</li>
<li><code>_APP_SMTP_PORT</code> —您的SMTP端口</li>
<li><code>_APP_SMTP_SECURE</code> — SMTP安全连接协议(如果在安全连接上运行，您可以将其设置为“tls”)</li>
<li><code>_APP_SMTP_USERNAME</code> —您的SMTP用户名</li>
<li><code>_APP_SMTP_PASSWORD</code> —您的SMTP密码</li>
<li><code>_APP_SYSTEM_EMAIL_ADDRESS</code> —您的SMTP电子邮件地址</li>
</ul>
<p>一旦更新了<code>.env</code>文件，保存它并通过运行以下命令重新启动Appwrite服务器:</p>
<pre class="language-bash hljs">docker compose up -d
</pre>
<p>现在我们已经设置了SMTP配置，我们可以继续实现电子邮件验证功能。</p>
<h3>向新注册用户发送验证电子邮件</h3>
<p>使用下面的代码在<code>useAuth</code>钩子中创建一个<code>sendVerificationEmail</code>函数:</p>
<pre class="language-javascript hljs">const useAuth = () =&gt; {
  // other functions and state

const sendVerificationEmail = async () =&gt; {
    const response = await graphql.mutation({
      query: `mutation {
        accountCreateVerification(
            url: "http://localhost:3000/profile"
        ) {
            _id
            _createdAt
            userId
            secret
            expire
        }
    }`,
    });

    if (response.errors) {
      throw response.errors[0].message;
    }
  };

  return {
    signup,
    login,
    logout,
    user,
    sendVerificationEmail // return this
  };
};
</pre>
<p>该功能将负责发送验证电子邮件。请注意，该函数中的<code>accountCreateVerification</code>变异接受一个<code>url</code>属性，这是用户单击发送到其电子邮件地址的验证链接后将被重定向到的URL。</p>
<p>在我们使用此功能之前，需要注意的是，您只能在为用户创建登录会话后发送验证电子邮件。为此，您需要在调用<code>Signup</code>组件的<code>handleSubmit</code>函数中的<code>signup</code>函数之后立即调用<code>login</code>函数，如下所示:</p>
<pre class="language-javascript hljs">const Signup = () =&gt; {
  const [user, setUser] = useState({});
  const { signup, login } = useAuth(); // add login function

  const handleChange = (e) =&gt; {
    setUser({ ...user, [e.target.name]: e.target.value });
  };

  const handleSubmit = async (e) =&gt; {
    e.preventDefault();
    try {
      await signup(user.email, user.password, user.username);
      await login(user.email, user.password); // call login function
      alert("Account created successfully!");
    } catch (error) {
      console.log(error);
    }
  };

  // rest of the code
};
</pre>
<p>让我们在调用<code>login</code>函数后调用<code>sendVerificationEmail</code>函数来发送验证邮件:</p>
<pre class="language-javascript hljs">const Signup = () =&gt; {
  const [user, setUser] = useState({});
  const { signup, login, sendVerificationEmail } = useAuth(); // add sendVerificationEmail function

  const handleChange = (e) =&gt; {
    setUser({ ...user, [e.target.name]: e.target.value });
  };

  const handleSubmit = async (e) =&gt; {
    e.preventDefault();
    try {
      await signup(user.email, user.password, user.username);
      await login(user.email, user.password);
      await sendVerificationEmail(); // call sendVerificationEmail function
      alert("Account created and verification email sent successfully!");
    } catch (error) {
      console.log(error);
    }
  };

  // rest of the code
};
</pre>
<p>若要测试此功能，请使用您在MailGun上验证的电子邮件在您的应用程序中注册一个帐户。您应该会在电子邮件中收到一个验证链接。请务必检查您的垃圾邮件文件夹:</p>
<p><img data-attachment-id="162004" data-permalink="https://blog.logrocket.com/using-react-appwrite-user-authentication/attachment/img7-appwrite-verification-email/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img7-Appwrite-verification-email.png" data-orig-size="730,401" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Appwrite-verification-email" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img7-Appwrite-verification-email-300x165.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img7-Appwrite-verification-email.png" decoding="async" class="aligncenter size-full wp-image-162004 jetpack-lazy-image" src="../Images/a0ce4634a3e4a44aeb43603056da495f.png" alt="Appwrite Verification Email Containing Link And Instructions To Verify Email Address From Appwrite" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img7-Appwrite-verification-email.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img7-Appwrite-verification-email-300x165.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img7-Appwrite-verification-email.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img7-Appwrite-verification-email.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162004" data-permalink="https://blog.logrocket.com/using-react-appwrite-user-authentication/attachment/img7-appwrite-verification-email/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img7-Appwrite-verification-email.png" data-orig-size="730,401" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Appwrite-verification-email" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img7-Appwrite-verification-email-300x165.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/03/img7-Appwrite-verification-email.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162004" src="../Images/a0ce4634a3e4a44aeb43603056da495f.png" alt="Appwrite Verification Email Containing Link And Instructions To Verify Email Address From Appwrite" srcset="https://blog.logrocket.com/wp-content/uploads/2023/03/img7-Appwrite-verification-email.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/03/img7-Appwrite-verification-email-300x165.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/03/img7-Appwrite-verification-email.png"/></noscript>
<h3>验证用户的电子邮件</h3>
<p>在您收到的验证链接中，您会看到附加的<code>userId</code>和<code>secret</code>参数。我们将使用这些参数发出另一个API请求来验证用户的电子邮件地址。让我们使用下面的代码在<code>useAuth</code>钩子中创建一个函数:</p>
<pre class="language-javascript hljs">const useAuth = () =&gt; {
  // other functions and state

  const confirmEmailVerification = async (userId, secret) =&gt; {
    const response = await graphql.mutation({
      query: `mutation (
          $userId: String!,
          $secret: String!,
      ) {
          accountUpdateVerification(
              userId: $userId,
              secret: $secret
          ) {
              _id
          }
      }`,
      variables: {
        userId: userId,
        secret: secret,
      },
    });

    if (response.errors) {
      throw response.errors[0].message;
    }
  };

  return {
    // rest of the functions and state
    confirmEmailVerification
  };
};
</pre>
<p>在<code>Profile</code>组件中，我们需要从重定向的URL中提取参数，并在用户重定向后位于个人资料页面时将它们作为参数传递给<code>confirmEmailVerification</code>函数。这可以通过使用以下代码来完成:</p>
<pre class="language-javascript hljs">import { useNavigate } from "react-router-dom";
import useAuth from "../hooks/useAuth";
const Profile = () =&gt; {
  const { logout, user, confirmEmailVerification } = useAuth(); // add confirmEmailVerification

  // rest of the code

  const handleLogout = async () =&gt; {
    // code
  };

  const urlParams = new URLSearchParams(window.location.search);
  const userId = urlParams.get("userId"); // extract userId
  const secret = urlParams.get("secret"); // extract secret

  const handleConfirmEmailVerification = async () =&gt; {
    try {
      await confirmEmailVerification(userId, secret);
      alert("Email verified successfully!");
      navigate("/profile");
    } catch (err) {
      console.log(err);
    }
  };

  if (!user?.emailVerification &amp;&amp; userId &amp;&amp; secret) {
    handleConfirmEmailVerification();
  }

  // rest of the code
};
export default Profile;
</pre>
<p>您应该能够验证用户的电子邮件地址。至此，本教程结束！</p>
<h2 id="conclusion">结论</h2>
<p>我们关于使用Appwrite和GraphQL API在React中设置用户认证的教程到此结束。我们讨论了安装和设置Appwrite、创建项目、实现注册和登录功能、获取登录用户的信息以及设置电子邮件验证功能。</p>
<p>我希望你喜欢这篇文章！感谢您花时间阅读它。如果你在阅读这篇文章时有任何问题，或者有进一步的疑问，请在评论区告诉我。</p>
<p>如果你喜欢我在这里做的事情，并想帮助我继续做下去，别忘了点击分享按钮。编码快乐！</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用LogRocket消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款React analytics解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket告诉您React应用程序中实际影响用户的最具影响力的bug和UX问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS异常、前端性能指标和用户交互。然后，LogRocket使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试LogRocket】。</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>