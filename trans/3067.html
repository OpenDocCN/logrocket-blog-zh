<html>
<head>
<title>Internationalization for Flutter apps - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Flutter 应用程序的国际化</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/internationalization-flutter-apps/#0001-01-01">https://blog.logrocket.com/internationalization-flutter-apps/#0001-01-01</a></blockquote><div><article class="article-post">
<p>最近发布的 Flutter 3，凭借其出色的开发体验和在许多平台上工作的单一代码库的承诺，已经成为许多 iOS 和 Android 应用程序的瑞士军刀，桌面和 web 应用程序也在慢慢加快步伐。</p>
<p>当你发布一个将在全球使用的应用程序时，只有一种语言并不能为每个最终用户提供相同的体验。虽然英语是使用最广泛的语言之一，但翻译该应用程序可以让所有用户更容易理解。因此，我们将在本文中学习如何本地化我们的 Flutter 应用程序。</p>
<h2 id="what-will-we-build">我们将建造什么？</h2>
<p>我们将尝试通过使用一个计数器应用程序来理解本地化，这个应用程序在您创建一个 Flutter 项目时会派上用场，并在反例中做了一些更改来演示本地化。</p>
<p>我们将使用 Flutter 本地化包成功地将我们的应用程序翻译成另一种语言，包括单词和短语的插值以及单数和复数的正确翻译。</p>
<h3 id="table-of-contents">目录</h3>

<h2 id="project-configuration">项目配置</h2>

<p>如上所示更改您的<code>pubspec.yaml</code>文件。<code>flutter localizations</code>包括一个本地本地化包和允许国际化和本地化的<code>intl</code>，包括消息翻译、复数和性别。<code>generate: true</code>行对于本地化包的自动代码生成是必不可少的，可以节省大量时间。</p>
<p>在我们项目的根目录下创建一个<code>l10n.yaml</code>文件；即<code>lib/l10n.yaml</code>。该文件指定我们的翻译文件的位置以及自动生成的 Dart 文件的名称:</p>
<pre class="language-yaml hljs">arb-dir: lib/l10n
template-arb-file: app_en.arb
output-localization-file: app_localizations.dart
</pre>
<p>默认情况下，Flutter 本地化将其翻译存储在 ARB(应用程序资源包)文件中。这些只是像 JSON 一样的键值对文件。让我们首先为我们的默认英语创建一个名为<code>app_en.arb</code>的<code>arb</code>文件，并将它放在<code>lib/l10n/app_en.arb</code>中。</p>
<p>由于我们支持多个地区，我们必须为我们的应用程序支持的每个地区创建一个单独的文件。在本文中，我们仅支持英语和印地语作为示例。</p>
<p>您可以添加您想要支持的任意数量的语言环境的<code>arb</code>文件。目前，让我们创建两个单独的<code>arb</code>文件，因为在本例中我们只支持两种语言环境:</p>
<p><code>lib/l10n/app_en.arb</code></p>
<pre class="language-yaml hljs">{
  "appTitle": "Demo App"
}
</pre>
<p><code>lib/l10n/app_hi.arb</code></p>
<pre class="language-yaml hljs">{
  "appTitle": "डेमो ऐप"
}
</pre>
<p>接下来，让我们给<code>MaterialApp</code>添加本地化:</p>
<pre class="language-dart hljs">import 'package:flutter_gen/gen_l10n/app_localizations.dart';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({Key? key}) : super(key: key);

  // This widget is the root of your application.
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
      localizationsDelegates: AppLocalizations.localizationsDelegates,
      supportedLocales: AppLocalizations.supportedLocales,
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: const MyHomePage(title: 'Flutter Demo'),
    );
  }
}
</pre>
<p><code>AppLocalizations.localizationsDelegates</code>负责我们应用的本地化。Flutter 团队已经提供了 Flutter 部件、Material 和 Cupertino 的本地化版本。例如，如果你使用<code>showDatePicker()</code>打开<code>DatePicker</code>，你会发现对话已经被翻译成设备的语言环境，不需要本地化文件。有了<code>AppLocalizations.supportedLocales</code>，Flutter 只在检测到新的语言环境并将其添加到<code>MaterialApp</code>的<code>supportedLocales</code>时才重建我们应用的 UI。</p>
<p>为了支持 iOS 中的本地化，我们需要对<code>Info.plist</code>进行以下更改:</p>
<pre class="language-yaml hljs">&lt;key&gt;CFBundleLocalizations&lt;/key&gt;
&lt;array&gt;
    &lt;string&gt;en&lt;/string&gt;
    &lt;string&gt;hi&lt;/string&gt;
&lt;/array&gt;
</pre>
<h3 id="localization-code-generation">本地化代码生成</h3>
<p>为了使用我们之前添加的 ARB 文件的翻译，我们需要生成替代 ARB 文件的 Dart 文件，这些文件可以导入到我们想要使用本地化值的任何地方。要生成这些文件，只需在完成上述配置更改后启动应用程序。代码生成完成后，您应该会看到以下文件:</p>
<ul>
<li><code>.dart_tool/flutter_gen/gen_l10n/app_localizations.dart</code></li>
<li><code>.dart_tool/flutter_gen/gen_l10n/app_localizations_en.dart</code></li>
<li><code>.dart_tool/flutter_gen/gen_l10n/app_localizations_hi.dart</code></li>
</ul>
<blockquote><p>注意:如果本地化代码没有自动生成，运行<code>flutter gen-l10n</code>就可以了。</p></blockquote>
<p>如果您打开<code>app_localizations.dart</code>，您会看到文件包含一个抽象类<code>AppLocalizations</code>，它有<code>localizationsDelegates</code>和<code>supportedLocales</code>以及您在 ARB 文件中添加的区域设置值。其他文件<code>app_localizations_en.dart</code>和<code>app_localizations_hi.dart</code>包含用特定于地区的变量和方法扩展<code>AppLocalizations</code>的类。</p>
<h2 id="lets-localize-our-app">让我们本地化我们的应用程序</h2>
<p>为了使用<code>AppLocalizaions</code>类，您必须首先导入这个类:</p>
<pre class="language-dart hljs">import 'package:flutter_gen/gen_l10n/app_localizations.dart';
</pre>
<p>之后，您可以使用<code>AppLocalizations.of(context).appTitle</code>访问区域设置值。我们的<code>MaterialApp</code>现在看起来是这样的:</p>
<pre class="language-dart hljs">class MyApp extends StatelessWidget {
  const MyApp({Key? key}) : super(key: key);

  // This widget is the root of your application.
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
      localizationsDelegates: AppLocalizations.localizationsDelegates,
      supportedLocales: AppLocalizations.supportedLocales,
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: const MyHomePage(title: AppLocalizations.of(context).appTitle),
    );
  }
}

class MyHomePage extends StatefulWidget {
  const MyHomePage({Key? key, required this.title}) : super(key: key);

  final String title;

  @override
  State&lt;MyHomePage&gt; createState() =&gt; _MyHomePageState();
}

class _MyHomePageState extends State&lt;MyHomePage&gt; {
  int _counter = 0;

  void _incrementCounter() {
    setState(() {
      _counter++;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text(widget.title),
      ),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: &lt;Widget&gt;[
            const Padding(
              padding:  EdgeInsets.only(top: 32),
              child: Text(
                'Flutter is Awesome',
                style:  TextStyle(fontSize: 24),
              ),
            ),
            Expanded(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  Text('You have pushed this button :',
                      style: Theme.of(context).textTheme.headline6),
                  Text(
                    '$_counter times',
                    style: Theme.of(context).textTheme.headline4,
                  )
                ],
              ),
            ),
          ],
        ),
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: _incrementCounter,
        tooltip: 'Increment',
        child: const Icon(Icons.add),
      ),
    );
  }
}
</pre>
<p>恭喜，我们的应用标题现已成功本地化。我们只需要更新其他的<code>String</code>值。</p>
<h2 id="interpolating-words-and-phrases-for-internationalization">为国际化插入单词和短语</h2>
<p>插值只是将某种东西插入另一种不同的东西中。当您希望某个单词或文本使用所有支持的区域设置的默认语言(例如英语)时，插值在本地化中非常有用。例如，在我们的演示应用程序中，我们希望显示一个文本“Flutter is awesome”，但问题是，无论用户设备上使用什么语言环境，我们都希望单词 Flutter 是英语。</p>
<p>让我们将插入的句子添加到我们的区域 ARB 文件中:</p>
<p><code>lib/l10n/app_en.arb</code>:</p>
<pre class="language-yaml hljs">{
  "appTitle": "Demo App",
  "appDescription": "{flutter} is Awesome",
  "@appDescription": {
    "placeholders": {
      "flutter": {
        "type": "String",
        "example": "Flutter"
      }
    }
  },
}
</pre>
<p><code>lib/l10n/app_hi.arb</code>:</p>
<pre class="language-yaml hljs">{
  "appTitle": "डेमो ऐप",
  "appDescription": "{flutter} बहुत बढ़िया है",
}
</pre>
<p>现在，我们必须使用添加到 ARB 文件中的插入文本描述。因为我们要在多个地方访问<code>AppLocalizations</code>，我们将创建一个实例变量<code>_locale</code>并在<code>didChangeDependencies()</code>中初始化它:</p>
<pre class="language-dart hljs">class _MyHomePageState extends State&lt;MyHomePage&gt; {
  int _counter = 0;
  late AppLocalizations _local;

  @override
  void didChangeDependencies() {
    _local = AppLocalizations.of(context);
    super.didChangeDependencies();
  }

  void _incrementCounter() {
    setState(() {
      _counter++;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text(_local.appTitle),
      ),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: &lt;Widget&gt;[
            Padding(
              padding: const EdgeInsets.only(top: 32),
              child: Text(
                _local.appDescription('Flutter'),
                style: const TextStyle(fontSize: 24),
              ),
            ),
            Expanded(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  Text("You have pushed this button :",
                      style: Theme.of(context).textTheme.headline6),
                  Text(
                    "$_counter",
                    style: Theme.of(context).textTheme.headline4,
                  )
                ],
              ),
            ),
          ],
        ),
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: _incrementCounter,
        tooltip: "Increment",
        child: const Icon(Icons.add),
      ),
    );
  }
}
</pre>
<p>运行应用程序，你会发现无论你的设备被设置为什么语言，单词“Flutter”都会是英语。</p>
<h2 id="singular-and-plural-support">单复数支持</h2>
<p>在本地化中，我们经常要处理单数和复数。例如——“恭喜你🎉，你赢得了一张优惠券，“或者，”恭喜🎉，你中了两张优惠券。”需要注意的是，不同的语言处理复数的方式不同，使用复数时要小心，因为你需要了解你要翻译的语言。</p>
<p>让我们进行必要的更改以支持本地化文件中的复数:</p>
<p><code>lib/l10n/app_en.arb</code>:</p>
<pre class="language-yaml hljs">{
  "appTitle": "Demo App",
  "appDescription": "{flutter} is Awesome",
  "@appDescription": {
    "placeholders": {
      "flutter": {
        "type": "String",
        "example": "Flutter"
      }
    }
  },
  "counterText": "You have pushed this button :",
  "counter": "{count,plural, =0{0} =1{1 time} other{{count} times}}",
  "@counter": {
    "placeholders": {
      "count": {
        "type": "int",
        "example": "count"
      }
    }
  },
  "counterButtonText": "Increment"
}
</pre>
<p><code>lib/l10n/app_hi.arb</code>:</p>
<pre class="language-yaml hljs">{
  "appTitle": "डेमो ऐप",
  "appDescription": "{flutter} बहुत बढ़िया है",
  "counterText": "आपने यह बटन दबा दिया है :",
  "counter": "{count,plural, =0{0} =1{1 बार} other{{count} बार}}",
  "counterButtonText": "जोड़ें"
}
</pre>
<p>现在我们已经为两个 ARB 文件在键<code>counter</code>中添加了复数，还添加了将用作增量按钮工具提示的<code>counterButtonText</code>，我们可以这样写:</p>
<pre class="language-dart hljs">class MyHomePage extends StatefulWidget {
  const MyHomePage({Key? key}) : super(key: key);

  @override
  State&lt;MyHomePage&gt; createState() =&gt; _MyHomePageState();
}

class _MyHomePageState extends State&lt;MyHomePage&gt; {
  int _counter = 0;
  late AppLocalizations _local;

  @override
  void didChangeDependencies() {
    _local = AppLocalizations.of(context);
    super.didChangeDependencies();
  }

  void _incrementCounter() {
    setState(() {
      _counter++;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text(_local.appTitle),
      ),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: &lt;Widget&gt;[
            Padding(
              padding: const EdgeInsets.only(top: 32),
              child: Text(
                _local.appDescription('Flutter'),
                style: const TextStyle(fontSize: 24),
              ),
            ),
            Expanded(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  Text(_local.counterText,
                      style: Theme.of(context).textTheme.headline6),
                  Text(
                    _local.counter(_counter),
                    style: Theme.of(context).textTheme.headline4,
                  )
                ],
              ),
            ),
          ],
        ),
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: _incrementCounter,
        tooltip: _local.counterButtonText,
        child: const Icon(Icons.add),
      ),
    );
  }
}
</pre>
<p>注意我们是如何将<code>_counter</code>值传递给<code>AppLocalizations.counter()</code>的，它最终会检查该值是单数还是复数，并基于此返回一个<code>String</code>值。</p>
<h2 id="conclusion">结论</h2>
<p>在本教程中，您学习了如何本地化您的 flutter 应用程序，并使其更易于用户访问。希望你不断尝试新事物！</p>
<p>现在我们已经做好了一切准备，您所要做的就是运行应用程序并开始享受。</p>
<p>祝你好运！开心飘飘！</p>
<p>如果你有任何问题，请随时发表。欢迎任何反馈。</p><div class="code-block code-block-2">
<div class="blog-plug base-cta"><h2>使用<a class="signup" href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>消除传统错误报告的干扰</h2>
<a href="https://lp.logrocket.com/blg/signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p><a href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一个数字体验分析解决方案，它可以保护您免受数百个假阳性错误警报的影响，只针对几个真正重要的项目。LogRocket 会告诉您应用程序中实际影响用户的最具影响力的 bug 和 UX 问题。</p>
<p>然后，使用具有深层技术遥测的会话重放来确切地查看用户看到了什么以及是什么导致了问题，就像你在他们身后看一样。</p>
<p>LogRocket 自动聚合客户端错误、JS 异常、前端性能指标和用户交互。然后 LogRocket 使用机器学习来告诉你哪些问题正在影响大多数用户，并提供你需要修复它的上下文。</p>
<p>关注重要的 bug—<a class="signup" href="https://lp.logrocket.com/blg/signup-issue-free" target="_blank" rel="noopener noreferrer">今天就试试 LogRocket】。</a></p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>