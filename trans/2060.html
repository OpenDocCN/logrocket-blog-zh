<html>
<head>
<title>Storing credentials using react-native-keychain - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用 react-native-keychain-log rocket 博客存储凭证</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/storing-credentials-using-react-native-keychain/#0001-01-01">https://blog.logrocket.com/storing-credentials-using-react-native-keychain/#0001-01-01</a></blockquote><div><article class="article-post">
<p>在本教程中，我们将向您展示如何在 React Native 应用程序中安全地存储用户凭据，并使用这些凭据对用户进行身份验证。</p>
<p>当您在应用程序中实现登录系统时，您需要一种保存登录凭证的方法。例如，您可能想要保存用户登录令牌或刷新令牌，以避免用户在打开应用程序时重复输入用户名和密码。</p>
<p>所以问题是，我们可以在哪里保存登录凭证？有些人会说，“让我们把这些信息保存在<code>AsyncStorage</code>中，”但是相信我，你不应该把关键信息保存在一个简单、普通和不安全的环境中。</p>
<p>为了在本地安全地存储信息，您应该使用<a href="https://github.com/oblador/react-native-keychain"> react-native-keychain </a>。</p>
<p>想知道如何在自己的 React Native app 中使用 react-native-keychain？要理解一件事，最好的办法就是以身作则。</p>
<p>因此，我们将制作一个模拟登录流程的小型基本应用程序，它将向您展示如何安全地保存令牌并使用令牌来验证用户。</p>
<h2>构建基本的用户界面</h2>
<p>首先，让我们<a href="https://blog.logrocket.com/top-9-ui-libraries-kits-react/">为登录屏幕构建一个基本的 UI </a>。请看下图，我们的登录界面会是什么样子。</p>
<p><img data-attachment-id="63553" data-permalink="https://blog.logrocket.com/storing-credentials-using-react-native-keychain/basic-ui-react-native-keychain/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/basic-ui-react-native-keychain.png" data-orig-size="270,414" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Basic UI for react-native-keychain app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/basic-ui-react-native-keychain-196x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/basic-ui-react-native-keychain.png" decoding="async" class="size-full wp-image-63553 aligncenter jetpack-lazy-image" src="../Images/f9fe9eb59a0fa4e113712e807b7279e1.png" alt="Basic UI for react-native-keychain App" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/basic-ui-react-native-keychain.png 270w, https://blog.logrocket.com/wp-content/uploads/2021/08/basic-ui-react-native-keychain-196x300.png 196w" data-lazy-sizes="(max-width: 270px) 100vw, 270px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/08/basic-ui-react-native-keychain.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/basic-ui-react-native-keychain.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="63553" data-permalink="https://blog.logrocket.com/storing-credentials-using-react-native-keychain/basic-ui-react-native-keychain/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/basic-ui-react-native-keychain.png" data-orig-size="270,414" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Basic UI for react-native-keychain app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/basic-ui-react-native-keychain-196x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/basic-ui-react-native-keychain.png" decoding="async" loading="lazy" class="size-full wp-image-63553 aligncenter" src="../Images/f9fe9eb59a0fa4e113712e807b7279e1.png" alt="Basic UI for react-native-keychain App" srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/basic-ui-react-native-keychain.png 270w, https://blog.logrocket.com/wp-content/uploads/2021/08/basic-ui-react-native-keychain-196x300.png 196w" sizes="(max-width: 270px) 100vw, 270px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/basic-ui-react-native-keychain.png"/></noscript>
<p>一个非常基本的登录界面，有一个黑暗的主题(附注:我喜欢黑暗的主题😉 ).</p>
<p>以下是该用户界面的代码:</p>
<pre>// App.js
import React from "react";
import { StyleSheet, Text, TextInput, View, Dimensions } from "react-native";

export default function App() {

  return (
    &lt;View style={styles.container}&gt;
        &lt;View&gt;
          &lt;Text style={styles.helloText}&gt;Hello There!&lt;/Text&gt;
          &lt;TextInput placeholder="email" style={styles.textInput} /&gt;
          &lt;TextInput
            placeholder="password"
            secureTextEntry
            style={styles.textInput}
          /&gt;
          &lt;Text style={styles.loginBtn}&gt;
            Login
          &lt;/Text&gt;
        &lt;/View&gt;
    &lt;/View&gt;
  );
}
const screenWidth = Dimensions.get("screen").width;
const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: "#1f1f1f",
    alignItems: "center",
    paddingTop: 250,
  },
  helloText: {
    color: "white",
    marginBottom: 20,
    fontSize: 30,
  },
  textInput: {
    padding: 5,
    paddingStart: 15,
    backgroundColor: "#3b3b3b",
    width: screenWidth * 0.8,
    borderRadius: 25,
    marginBottom: 15,
    color: "white",
    fontWeight: "600",
  },
  loginBtn: {
    paddingHorizontal: 25,
    paddingVertical: 10,
    backgroundColor: "#ff1178",
    borderRadius: 25,
    color: "white",
    textAlign: "center",
  }
});
</pre>
<h2>安装 react-native-keychain</h2>
<p>我们有登录界面；现在，让我们安装 keychain 来安全地存储登录凭证。</p>
<p>要安装，请在项目的根目录下运行以下命令:</p>
<pre class="language-bash hljs">yarn add react-native-keychain
</pre>
<p>或者，如果您使用 npm:</p>
<pre class="language-bash hljs">npm i -S react-native-keychain
</pre>
<p>安装 react-native-keychain 后，我们可以继续实现登录系统。</p>
<h2>实现 react-native-keychain</h2>
<p>这个钥匙串提供了许多我们可以在各种场景中使用的方法，但是为了简单起见，我们将使用三种主要方法来保存、检索和删除凭证。</p>
<p>这些方法是:</p>
<ul>
<li><code>setGenericPassword</code></li>
<li><code>getGenericPassword</code></li>
<li><code>resetGenericPassword</code></li>
</ul>
<p>这些方法的作用不言自明。但是，我将简要概述一下。</p>
<p>为了存储凭证，我们使用<code>setGenericPassword</code>方法并传递两个参数。第一个参数是用户名，第二个参数是令牌或密码。</p>
<p>要读取存储凭证的值，我们可以使用不带任何参数的<code>getGenericPassword</code>方法。</p>
<p>最后，要删除凭证，我们可以使用不带任何参数的<code>resetGenericPassword</code>方法。</p>
<p>让我们存储用户凭证:</p>
<pre>// App.js
import React, { useEffect, useState } from "react";
import { StyleSheet, Text, TextInput, View, Dimensions } from "react-native";
import * as Keychain from "react-native-keychain";
export default function App() {
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const [userDetails, setUserDetails] = useState({});

  const handleLogin = async () =&gt; {
    // login api call here
    const token =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c";
    const username = "Akshay";
    await Keychain.setGenericPassword(username, token);
    setIsLoggedIn(true);
    setUserDetails({token, username});
  };

  return (
    &lt;View style={styles.container}&gt;
        &lt;View&gt;
          &lt;Text style={styles.helloText}&gt;Hello There!&lt;/Text&gt;
          &lt;TextInput placeholder="email" style={styles.textInput} /&gt;
          &lt;TextInput
            placeholder="password"
            secureTextEntry
            style={styles.textInput}
          /&gt;
          &lt;Text style={styles.loginBtn} onPress={handleLogin}&gt;
            Login
          &lt;/Text&gt;
        &lt;/View&gt;
    &lt;/View&gt;
  );
}
const screenWidth = Dimensions.get("screen").width;
const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: "#1f1f1f",
    alignItems: "center",
    // justifyContent: 'center',
    paddingTop: 250,
  },
  helloText: {
    color: "white",
    marginBottom: 20,
    fontSize: 30,
  },
  textInput: {
    padding: 5,
    paddingStart: 15,
    backgroundColor: "#3b3b3b",
    width: screenWidth * 0.8,
    borderRadius: 25,
    marginBottom: 15,
    color: "white",
    fontWeight: "600",
  },
  loginBtn: {
    paddingHorizontal: 25,
    paddingVertical: 10,
    backgroundColor: "#ff1178",
    borderRadius: 25,
    color: "white",
    textAlign: "center",
  }
});
</pre>
<p>正如您在上面的代码中看到的，我已经创建了一个<code>handleLogin</code>函数，并将其设置为登录文本的<code>onPress</code>。</p>
<p>在<code>handleLogin</code>函数中，我们还没有实现一个完整的登录系统，但是我们假设用户得到了授权，并且登录服务器返回了用户详细信息和一个令牌。</p>
<p>因此，我们会将这些信息保存在安全的存储中。</p>
<p>注意，我们保存的是用户令牌，而不是密码本身。在客户端保存用户密码不是一个好的做法。永远带着有有效期的代币。</p>
<p>为了保存信息，我们使用了<code>setGenericPassword</code>方法，并将用户名和令牌作为参数传递。</p>
<p>成功保存后，我们正在更新状态，将登录屏幕更改为欢迎屏幕。</p>
<h2>构建欢迎屏幕</h2>
<p>登录后，我们将显示一个带有用户名的欢迎屏幕。我们的欢迎屏幕将如下所示:</p>
<p><img data-attachment-id="63555" data-permalink="https://blog.logrocket.com/storing-credentials-using-react-native-keychain/welcome-screen-react-native-keychain/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/welcome-screen-react-native-keychain.png" data-orig-size="270,351" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Welcome screen for react-native-keychain app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/welcome-screen-react-native-keychain-231x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/welcome-screen-react-native-keychain.png" decoding="async" class="size-full wp-image-63555 aligncenter jetpack-lazy-image" src="../Images/6cdaf04077c7365549d5c50ed4999953.png" alt="Welcome Screen for react-native-keychain App" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/welcome-screen-react-native-keychain.png 270w, https://blog.logrocket.com/wp-content/uploads/2021/08/welcome-screen-react-native-keychain-231x300.png 231w" data-lazy-sizes="(max-width: 270px) 100vw, 270px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/08/welcome-screen-react-native-keychain.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/welcome-screen-react-native-keychain.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="63555" data-permalink="https://blog.logrocket.com/storing-credentials-using-react-native-keychain/welcome-screen-react-native-keychain/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/08/welcome-screen-react-native-keychain.png" data-orig-size="270,351" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Welcome screen for react-native-keychain app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/08/welcome-screen-react-native-keychain-231x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/08/welcome-screen-react-native-keychain.png" decoding="async" loading="lazy" class="size-full wp-image-63555 aligncenter" src="../Images/6cdaf04077c7365549d5c50ed4999953.png" alt="Welcome Screen for react-native-keychain App" srcset="https://blog.logrocket.com/wp-content/uploads/2021/08/welcome-screen-react-native-keychain.png 270w, https://blog.logrocket.com/wp-content/uploads/2021/08/welcome-screen-react-native-keychain-231x300.png 231w" sizes="(max-width: 270px) 100vw, 270px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/08/welcome-screen-react-native-keychain.png"/></noscript>
<p>只有一条欢迎消息，后面是用户名和注销按钮。</p>
<p>基于<code>isLoggedIn</code>的状态变化，我们会显示一个欢迎界面，隐藏登录界面。</p>
<p>我们的代码将如下所示:</p>
<pre>// App.js
import React, { useEffect, useState } from "react";
import { StyleSheet, Text, TextInput, View, Dimensions } from "react-native";
import * as Keychain from "react-native-keychain";
export default function App() {
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const [userDetails, setUserDetails] = useState({});
  useEffect(() =&gt; {
    (async () =&gt; {
      try {
        const credentials = await Keychain.getGenericPassword();
        if (credentials) {
          setIsLoggedIn(true);
          setUserDetails(credentials);
        } else {
          console.log("No credentials stored");
        }
      } catch (error) {
        console.log("Keychain couldn't be accessed!", error);
      }
    })();
  }, []);
  const handleLogin = async () =&gt; {
    // login api call here
    const token =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c";
    const username = "Akshay";
    await Keychain.setGenericPassword(username, token);
    setIsLoggedIn(true);
    setUserDetails({token, username});
  };
  const handleLogout = async()=&gt;{
    const logout = await Keychain.resetGenericPassword();
    console.log({logout});
    if(logout){
      setIsLoggedIn(false);
      setUserDetails({});
    }
  }
  return (
    &lt;View style={styles.container}&gt;
      {!isLoggedIn ? (
        &lt;View&gt;
          &lt;Text style={styles.helloText}&gt;Hello There!&lt;/Text&gt;
          &lt;TextInput placeholder="email" style={styles.textInput} /&gt;
          &lt;TextInput
            placeholder="password"
            secureTextEntry
            style={styles.textInput}
          /&gt;
          &lt;Text style={styles.loginBtn} onPress={handleLogin}&gt;
            Login
          &lt;/Text&gt;
        &lt;/View&gt;
      ) : (
        &lt;View&gt;
          &lt;Text style={styles.welcomeText}&gt;
            Welcome back! {userDetails.username}
          &lt;/Text&gt;
          &lt;Text style={styles.logoutBtn} onPress={handleLogout} &gt;Logout&lt;/Text&gt;
        &lt;/View&gt;
      )}
    &lt;/View&gt;
  );
}
const screenWidth = Dimensions.get("screen").width;
const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: "#1f1f1f",
    alignItems: "center",
    // justifyContent: 'center',
    paddingTop: 250,
  },
  helloText: {
    color: "white",
    marginBottom: 20,
    fontSize: 30,
  },
  textInput: {
    padding: 5,
    paddingStart: 15,
    backgroundColor: "#3b3b3b",
    width: screenWidth * 0.8,
    borderRadius: 25,
    marginBottom: 15,
    color: "white",
    fontWeight: "600",
  },
  loginBtn: {
    paddingHorizontal: 25,
    paddingVertical: 10,
    backgroundColor: "#ff1178",
    borderRadius: 25,
    color: "white",
    textAlign: "center",
  },
  welcomeText: {
    color: "white",
    marginBottom: 20,
    fontSize: 30,
  },
  logoutBtn: {
    paddingHorizontal: 25,
    paddingVertical: 10,
    backgroundColor: "#ff1178",
    borderRadius: 25,
    color: "white",
    textAlign: "center",
  },
});
</pre>
<p>我们的整个代码将是这样的:</p>
<p>首先，我们的状态<code>isLoggedIn</code>在初始阶段被设置为<code>false</code>。因此，我们将显示我们的登录用户界面，当用户成功登录时，我们将凭据保存在安全存储中，并更新登录状态和用户详细信息状态。</p>
<p>状态更新后，我们将显示一个带有用户名和注销按钮的欢迎用户界面。</p>
<p>在注销按钮上，我们增加了一个<code>handleLogout</code>功能。在这个函数中，我们从我们的安全存储中重置或删除用户的凭证，并将我们的状态设置为初始数据。</p>
<p>你可能已经注意到有一个<code>useEffect</code>钩子也被写了。在这个钩子中，我们从安全存储中检索用户凭证，并在用户返回应用程序时根据这些信息更新状态。</p>
<p>如果用户已经在存储器中保存了他们的信息，那么我们将向他们显示欢迎用户界面。否则，我们将向他们显示登录用户界面，告诉他们没有登录。</p>
<p>这是您可以轻松存储和读取用户凭证而不危及用户安全的方式。</p>
<h2>结论</h2>
<p>在本教程中，您学习了如何使用 react-native-keychain 安全地将用户的信息保存在他们的设备上，而不会危及他们的安全。现在你可以在你的应用程序中实现你自己完整的登录系统。</p><div class="code-block code-block-18">
<div class="blog-plug inline-plug react-native-plug"><h2><a href="https://lp.logrocket.com/blg/react-native-signup"> LogRocket </a>:即时重现 React 原生应用中的问题。</h2><a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/110055665562c1e02069b3698e6cc671.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/110055665562c1e02069b3698e6cc671.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/></noscript></a><p><a href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一款 React 原生监控解决方案，可帮助您即时重现问题、确定 bug 的优先级并了解 React 原生应用的性能。</p><p>LogRocket 还可以向你展示用户是如何与你的应用程序互动的，从而帮助你提高转化率和产品使用率。LogRocket 的产品分析功能揭示了用户不完成特定流程或不采用新功能的原因。</p><p>开始主动监控您的 React 原生应用— <a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer">免费试用 LogRocket】。</a></p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>