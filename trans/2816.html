<html>
<head>
<title>How to build a multi-step form with only the useState Hook - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何只用 useState Hook - LogRocket 博客构建多步表单</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/build-multi-step-form-usestate-hook/#0001-01-01">https://blog.logrocket.com/build-multi-step-form-usestate-hook/#0001-01-01</a></blockquote><div><article class="article-post">
<p>表单是大多数应用程序的重要组成部分。在不同的建筑模板包中有很多可用的包。在本文中，我们将使用<code>useState</code>钩子构建一个多步表单，而不使用任何第三方包，同时实现相同的功能。</p>
<p>本教程的主要重点是分析多步表单的逻辑。我们将跳过大部分的样式部分，所以如果你在某个地方卡住了，看看这个<a href="https://github.com/GeoBrodas/multi-step-supabase" target="_blank" rel="noopener">库</a>。</p>
<p>以下是我们将在本教程中涉及的内容，因此您可以随意跳到您想要的任何部分:</p>

<h2 id="initializing-the-starting-files">初始化启动文件</h2>
<p>让我们通过输入以下命令来安装一个新的 Next.js 项目:</p>
<pre class="language-javascript hljs">npx create-next-app mulitstep-form
</pre>
<p>如果您愿意，React 项目也可以很好地工作。要安装新的 React 项目，请输入以下内容:</p>
<pre class="language-javascript hljs">npx create-react-app multistep-form 
</pre>
<p>样式是可选的，但如果你想跟着做，我们将在这个项目中使用 Mantine CSS。</p>
<p><strong>安装 Mantine CSS </strong></p>
<pre class="language-javascript hljs">npm install @mantine/core @mantine/next @mantine/hooks
</pre>
<p>在这里遵循 Next.js <a href="https://mantine.dev/theming/next/" target="_blank" rel="noopener">的设置指南。</a></p>
<p>接下来，让我们为多步表单中的每一步构建一些组件。</p>
<p>首先，我们将构建<code>Form</code>组件，它将处理大部分表单逻辑。继续在<code>./components/Form.js</code>创建一个新文件。</p>
<pre class="language-javascript hljs">import { Box, Button, Title } from '@mantine/core';

function Form() {
  return (
    &lt;Box
      sx={boxStyle}
    &gt;
      &lt;Title
        sx={{
          textAlign: 'center',
        }}
        order={2}
      &gt;
        Hey there!
      &lt;/Title&gt;
        {/* Steps */}
      &lt;Button&gt;Submit&lt;/Button&gt;
    &lt;/Box&gt;
  );
}
export default Form;
</pre>
<p>(注意:这里，术语“步骤”只是指多步骤形式的不同阶段)</p>
<p>接下来，让我们完成表单的第一步——一条简单的介绍性消息。</p>
<p>在<code>./components/First/index.js</code>中创建一个新文件:</p>
<pre class="language-javascript hljs">import { Box, Text, TextInput } from '@mantine/core';
function First() {
  return (
    &lt;Box
      sx={boxStyle}
    &gt;
      &lt;Text&gt;To start with, whats your beautiful name?&lt;/Text&gt;
      &lt;Box
        sx={{
          margin: '1rem 0',
        }}
      &gt;
        &lt;TextInput
          placeholder="John Doe"
          required
        /&gt;
      &lt;/Box&gt;
    &lt;/Box&gt;
  );
}
export default First;
</pre>
<p>您的输出现在应该是这样的:</p>
<p><img data-attachment-id="101051" data-permalink="https://blog.logrocket.com/build-multi-step-form-usestate-hook/state-hook-simple-introductory-messgae/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/state-hook-simple-introductory-messgae.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="state-hook-simple-introductory-messgae" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/state-hook-simple-introductory-messgae-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/state-hook-simple-introductory-messgae.png" decoding="async" class="aligncenter wp-image-101051 size-full jetpack-lazy-image" src="../Images/fadaa14ddf009ab2617abea081406fde.png" alt="State Hook Simple Introductory Message" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/state-hook-simple-introductory-messgae.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/state-hook-simple-introductory-messgae-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/state-hook-simple-introductory-messgae.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/state-hook-simple-introductory-messgae.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="101051" data-permalink="https://blog.logrocket.com/build-multi-step-form-usestate-hook/state-hook-simple-introductory-messgae/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/state-hook-simple-introductory-messgae.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="state-hook-simple-introductory-messgae" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/state-hook-simple-introductory-messgae-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/state-hook-simple-introductory-messgae.png" decoding="async" loading="lazy" class="aligncenter wp-image-101051 size-full" src="../Images/fadaa14ddf009ab2617abea081406fde.png" alt="State Hook Simple Introductory Message" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/state-hook-simple-introductory-messgae.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/state-hook-simple-introductory-messgae-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/state-hook-simple-introductory-messgae.png"/></noscript>
<h2 id="using-the-usestate-hook-to-move-between-components">使用<code>useState</code>钩在组件之间移动</h2>
<p>接下来，我们将使用<code>useState</code>钩子在不同的步骤之间移动。</p>
<p>到目前为止，我们只完成了一个步骤，但是您可以随意添加您自己的步骤。下面是本教程中的流程图。</p>
<p><img data-attachment-id="101053" data-permalink="https://blog.logrocket.com/build-multi-step-form-usestate-hook/usestate-hook-tutorial-example-screens/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/usestate-hook-tutorial-example-screens.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="usestate-hook-tutorial-example-screens" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/usestate-hook-tutorial-example-screens-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/usestate-hook-tutorial-example-screens.png" decoding="async" class="aligncenter wp-image-101053 size-full jetpack-lazy-image" src="../Images/9cef988415cde5c9cdae5e6e4a84e847.png" alt="UseState Hook Tutorial Example Screens" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/usestate-hook-tutorial-example-screens.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/usestate-hook-tutorial-example-screens-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/usestate-hook-tutorial-example-screens.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/usestate-hook-tutorial-example-screens.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="101053" data-permalink="https://blog.logrocket.com/build-multi-step-form-usestate-hook/usestate-hook-tutorial-example-screens/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/usestate-hook-tutorial-example-screens.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="usestate-hook-tutorial-example-screens" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/usestate-hook-tutorial-example-screens-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/usestate-hook-tutorial-example-screens.png" decoding="async" loading="lazy" class="aligncenter wp-image-101053 size-full" src="../Images/9cef988415cde5c9cdae5e6e4a84e847.png" alt="UseState Hook Tutorial Example Screens" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/usestate-hook-tutorial-example-screens.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/usestate-hook-tutorial-example-screens-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/usestate-hook-tutorial-example-screens.png"/></noscript>
<p>现在组件准备好了，让我们添加在组件之间切换的逻辑。</p>
<p>初始化一个新的<code>useState</code>钩子，初始值为 0。</p>
<pre class="language-javascript hljs">const [page, setPage] = useState(0);
</pre>
<p>创建另一个函数，根据<code>page</code>值有条件地呈现不同的组件:</p>
<pre class="language-javascript hljs">import First from './First';
import SecondStep from './Second';
import ThirdStep from './Third';

export default function Form () {
  const conditionalComponent = () =&gt; {
    switch (page) {
      case 0:
        return &lt;First /&gt;;
      case 1:
        return &lt;SecondStep /&gt;;
       case 2:
         return &lt;ThirdStep /&gt;;
       default:
         return &lt;First /&gt;;
    }
  }; 

return (
    &lt;&gt;
      &lt;Box&gt;
        {conditionalComponent()}
      &lt;/Box&gt;
    &lt;/&gt;
  )
}
</pre>
<p>接下来，让我们创建一个按钮，它在<code>onClick</code>将<code>page</code>的值增加 1:</p>
<pre class="language-javascript hljs">//...imports
import { Button } from "@mantine/core"

export default function Form () {
  // stuff

  function handleSubmit () {
    //...stuff
  }

  return (
    &lt;&gt;
      {conditionalComponent()}
      &lt;Button onClick={handleSubmit}&gt;
        { page === 0 || page === 1 ? "Next" : "Submit" }
      &lt;/Button&gt;
    &lt;/&gt;
  )
}
</pre>
<p>同时，在<code>handleSubmit</code>函数中，我们将增加页面。在本文前面，我们将添加验证并使用<code>fetch</code> API 将数据发送到 Supabase 实例。</p>
<pre class="language-javascript hljs">function handleSubmit () {
  setPage(page + 1);
}
</pre>
<p>同样，我们需要一个按钮和一个函数来返回到之前的<code>page</code>。如果用户在第一页，则不会显示后退按钮，因此:</p>
<pre class="language-javascript hljs">{
  page &gt; 0 &amp;&amp; &lt;Button onClick={() =&gt; setPage(page - 1)}&gt;Back&lt;/Button&gt;
}
</pre>
<h2 id="keeping-track-of-form-data">跟踪表单数据</h2>
<p>为了跟踪用户输入，我们将创建另一个<code>useState</code>钩子。</p>
<pre class="language-javascript hljs">const [formData, setFormData] = useState({
  name: '',
  email: '',
  employment_status: null
});
</pre>
<p>接下来，我们将把<code>formData</code>和<code>setFormData</code>作为道具传递给每个条件组件。</p>
<pre class="language-javascript hljs">const conditionalComponent = () =&gt; {
   switch (page) {
    case 0:
       return &lt;First formData={formData} setFormData={setFormData} /&gt;;
     case 1:
      return &lt;SecondStep formData={formData} setFormData={setFormData} /&gt;;
    case 2:
      return &lt;ThirdStep formData={formData} setFormData={setFormData} /&gt;;
    default:
      return &lt;First formData={formData} setFormData={setFormData} /&gt;;
  }
};
</pre>
<p>为了从输入字段中获取表单数据，我们将利用<code>Input</code>字段中的<code>value</code>和<code>onChange</code>属性。</p>
<pre class="language-javascript hljs">import { Box, Text, TextInput } from '@mantine/core';

function First({ formData, setFormData }) {
  return (
    &lt;Box
      sx={boxStyle}
    &gt;
      &lt;Text&gt;To start with, whats your beautiful name?&lt;/Text&gt;
      &lt;Box&gt;
        &lt;TextInput
          onChange={(e) =&gt; {
            setFormData({
              ...formData,
              name: e.target.value,
            });
          }}
          value={formData.name}
          placeholder="John Doe"
          required
        /&gt;
      &lt;/Box&gt;
    &lt;/Box&gt;
  );
}

export default First;
</pre>
<p>这里发生了两件事:</p>
<ul>
<li><code>value</code>属性包含相应的<code>Input</code>字段的当前值</li>
<li>每当用户试图更改<code>Input</code>字段时，就会调用<code>onChange</code>属性</li>
</ul>
<p><code>select</code>组件作为受控输入，如下所示:</p>
<pre class="language-javascript hljs">&lt;Select
    data={[
    { value: 'Student', label: 'Student' },
    { value: 'Employed', label: 'Employed' },
    { value: 'Business', label: 'Business' },
   ]}
    onChange={(e) =&gt; {
    console.log(e);
    setFormData({ ...formData, employment_status: e });
   }}
   value={formData.employment_status}
   sx={selectInputStyle}
   label="Your emplyment status"
   placeholder="Choose one"
/&gt;
</pre>
<p>这里，代替<code>e.target.value</code>，我们简单地将<code>e</code>对象作为一个整体传递。确保除了在<code>Select</code>组件内的<code>data</code>道具中的字符串之外，不要传递任何其他东西。</p>
<p>在最后一步中，我们将简单地显示表单数据供用户交叉检查和验证，如果需要，还可以让用户选择返回并更改之前输入的内容。</p>
<p>因为我们在最后一个组件中没有任何输入字段，所以只需传递<code>formData</code>并相应地显示它们:</p>
<pre class="language-javascript hljs">import { Box, Text } from '@mantine/core';
import Detail from '../Detail';

function ThirdStep({ formData }) {
  const boxStyle = {
    width: '70%',
    margin: '1rem auto',
    textAlign: 'center',
    padding: '1rem 0',
  };

  return (
    &lt;Box sx={{ ...boxStyle, textAlign: 'left' }}&gt;
      &lt;Detail title="Name" data={formData.name} /&gt;
      &lt;Detail title="Email" data={formData.email} /&gt;
      &lt;Detail title="Employment status" data={formData.employment_status} /&gt;
    &lt;/Box&gt;
  );
}
export default ThirdStep;
</pre>
<p><code>Detail</code>组件看起来像这样:</p>
<pre class="language-javascript hljs">import { Box, Text } from '@mantine/core';

function Detail({ title, data }) {
  return (
    &lt;Box
      sx={{
        margin: '10px 0',
      }}
    &gt;
      &lt;Text weight={300}&gt;{title}&lt;/Text&gt;
      &lt;Text&gt;{data}&lt;/Text&gt;
    &lt;/Box&gt;
  );
}

export default Detail;
</pre>
<p>完成后，您的多步骤表单现在可以无缝地跟踪表单数据。</p><div class="code-block code-block-54">
<hr/>
<h3>更多来自 LogRocket 的精彩文章:</h3>

<hr/></div>
<h2 id="adding-form-validation">添加表单验证</h2>
<p>接下来，我们将添加表单验证，以接受来自用户的有效数据。</p>
<p>在<code>handleSubmit</code>函数中，我们将创建一个<code>if...else</code>流来检查每页上的输入字段，并随后将用户移动到下一页。</p>
<pre class="language-javascript hljs">function handleSubmit () {
  if (page === 0) {
    // do form validation
  } else if (page === 1) {
    // do form validation again
  } else if (page === 2) {
    // set page === 0 , and clear fields
  } else setPage(page + 1);
} 
</pre>
<p>在第一个<code>if</code>语句中:</p>
<pre class="language-javascript hljs">if (page === 0) {
  if (formData.name === '' || formData.name.length &lt;= 1) {
    return alert('Please enter your name');
  } else {
    setPage(page + 1);
    console.log(formData);
  }
}
</pre>
<p>这里，如果<code>name</code>字段为空或者长度小于 1，则显示一个<code>alert</code>框。</p>
<p>类似地，我们向第二个页面添加以下验证，它由一个电子邮件地址字段和一个用于<code>employment_status</code>的字段组成:</p>
<pre class="language-javascript hljs">else if (page === 1) {
  if (formData.email === '' || !formData.email.includes('@')) {
    return alert('Please enter a valid email');
  } else if (!formData.employment_status) {
    return alert('Please select your employment status');
  } else {
    setPage(page + 1);
    console.log(formData);
  }
}
</pre>
<p>这里，我们将首先检查电子邮件是否存在，或者电子邮件是否包含“@”符号。如果它通过了第一次检查，那么我们将检查<code>employment_status</code>字段是否包含任何内容；否则，我们增加<code>page</code>并记录数据。</p>
<p>对于最后一页，我们只想显示表单数据，因此将<code>page</code>设置为 0 并清除所有输入字段就足够了。</p>
<pre class="language-javascript hljs">else if (page === 2) {
  setPage(0);
  console.log(formData);
  setFormData({
     name: '',
     email: '',
     employment_status: null,
  });
}
</pre>
<p>这就是我们所有的验证！</p>
<h2 id="setting-up-a-supabase-instance">设置超级数据库实例</h2>
<p>让我们将表单数据发送到一个新的 Supabase 实例。Supabase 是 Firebase 的开源替代方案。如果您是新用户，请前往<a href="https://app.supabase.io/" target="_blank" rel="noopener"> Supabase </a>创建一个新帐户。</p>
<p><img data-attachment-id="101055" data-permalink="https://blog.logrocket.com/build-multi-step-form-usestate-hook/supabase-instance-create-new-project/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-create-new-project.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="supabase-instance-create-new-project" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-create-new-project-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-create-new-project.png" decoding="async" class="aligncenter wp-image-101055 size-full jetpack-lazy-image" src="../Images/ffe3db7b1b13170a8df25501af19cfb2.png" alt="Supabase Instance Create New Project" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-create-new-project.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-create-new-project-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-create-new-project.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-create-new-project.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="101055" data-permalink="https://blog.logrocket.com/build-multi-step-form-usestate-hook/supabase-instance-create-new-project/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-create-new-project.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="supabase-instance-create-new-project" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-create-new-project-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-create-new-project.png" decoding="async" loading="lazy" class="aligncenter wp-image-101055 size-full" src="../Images/ffe3db7b1b13170a8df25501af19cfb2.png" alt="Supabase Instance Create New Project" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-create-new-project.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-create-new-project-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-create-new-project.png"/></noscript>
<p>创建项目后，进入新创建项目的主页，点击<code>anon key</code>和<code>url</code>。</p>
<p>(注:如果您找不到您的密钥，请尝试在<strong>设置</strong> &gt; <strong> API </strong>中找到它们)</p>
<p><img data-attachment-id="101057" data-permalink="https://blog.logrocket.com/build-multi-step-form-usestate-hook/supabase-project-api-keys/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-project-api-keys.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="supabase-project-api-keys" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-project-api-keys-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-project-api-keys.png" decoding="async" class="aligncenter wp-image-101057 size-full jetpack-lazy-image" src="../Images/abdfb60ad591fbbc66a1f7678cc502fd.png" alt="Supabase Project API Keys" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-project-api-keys.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-project-api-keys-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-project-api-keys.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-project-api-keys.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="101057" data-permalink="https://blog.logrocket.com/build-multi-step-form-usestate-hook/supabase-project-api-keys/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-project-api-keys.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="supabase-project-api-keys" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-project-api-keys-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-project-api-keys.png" decoding="async" loading="lazy" class="aligncenter wp-image-101057 size-full" src="../Images/abdfb60ad591fbbc66a1f7678cc502fd.png" alt="Supabase Project API Keys" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-project-api-keys.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-project-api-keys-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-project-api-keys.png"/></noscript>
<p>完成后，现在安装 Supabase SDK，使用:</p>
<pre class="language-javascript hljs">npm install @supabase/supabase-js
</pre>
<p>在<code>./lib/supabase.js</code>新建一个文件，导出 Supabase 客户端，如下图所示。</p>
<pre class="language-javascript hljs">import { createClient } from '@supabase/supabase-js';

export const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL,
  process.env.NEXT_PUBLIC_SUPABASE_KEY
)
</pre>
<p>对于环境变量，在根目录下创建一个名为<code>.env.local</code>的新文件，并传递密钥。</p>
<pre class="language-javascript hljs">NEXT_PUBLIC_SUPABASE_KEY=&lt;Your key&gt;
NEXT_PUBLIC_SUPABASE_URL=&lt;Your url&gt;
</pre>
<h2 id="sending-data-to-a-supabase-table">向超级数据库表发送数据</h2>
<p>返回到新创建的 Supabase 实例，并在表编辑器中创建一个新表。</p>
<p><img data-attachment-id="101059" data-permalink="https://blog.logrocket.com/build-multi-step-form-usestate-hook/supabase-instance-table-editor/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-table-editor.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="supabase-instance-table-editor" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-table-editor-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-table-editor.png" decoding="async" class="aligncenter wp-image-101059 size-full jetpack-lazy-image" src="../Images/cabd1a32a302ae1aadc9228984ce371b.png" alt="Supabase Instance Table Editor" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-table-editor.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-table-editor-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-table-editor.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-table-editor.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="101059" data-permalink="https://blog.logrocket.com/build-multi-step-form-usestate-hook/supabase-instance-table-editor/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-table-editor.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="supabase-instance-table-editor" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-table-editor-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-table-editor.png" decoding="async" loading="lazy" class="aligncenter wp-image-101059 size-full" src="../Images/cabd1a32a302ae1aadc9228984ce371b.png" alt="Supabase Instance Table Editor" srcset="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-table-editor.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-table-editor-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/03/supabase-instance-table-editor.png"/></noscript>
<p>为了处理 Supabase 逻辑，我们将创建一个单独的 Next.js API 路由，从而通过本机 Fetch API 发出一个<code>POST</code>请求。</p>
<p>继续在<code>./pages/api/post-supabase.js</code>创建一个新的 Next.js API 路径。</p>
<pre class="language-javascript hljs">async function handler (req, res) {
  // server-side logic
}

export default handler;
</pre>
<p>现在，由于我们有了一个传递表单数据的 API 路径，我们可以添加另一层保护来验证表单数据。客户端验证并不总是可靠的，所以在将用户数据保存到 Supabase 表之前，也应该总是实现服务器端验证。</p>
<p>在<code>handler</code>函数内部，我们将首先检查 fetch 方法是否为<code>POST</code>。</p>
<pre class="language-javascript hljs">async function handler (req, res) {
  if(req.method === 'POST') {
    // post logic
    return res.status(200).json({message: "Success"});
  }
}
</pre>
<p>接下来，从请求体中析构所有表单数据，如下所示:</p>
<pre class="language-javascript hljs">if(req.method === "POST") {
  const { name, email, employment_status } = req.body;
}
</pre>
<p>接下来，我们将执行服务器端验证:</p>
<pre class="language-javascript hljs">if(req.method === "POST") {
  const { name, email, employment_status } = req.body;

    // server-side validation
    if (!name || name.length &lt;= 3) {
      return res.status(400).json({
        status: 'fail',
        message: 'Please enter your name',
      });
    } else if (!email || !email.includes('@')) {
      return res.status(400).json({
        status: 'fail',
        message: 'Please enter a valid email',
      });
    } else if (!employment_status) {
      return res.status(400).json({
        status: 'fail',
        message: 'Please select your employment status',
      });
    }
}
</pre>
<p>在这种情况下，如果有人试图篡改客户端验证或执行 MITM 攻击，服务器仍然能够拒绝表单数据，并发回错误响应。</p>
<p>验证完成后，剩下的工作就是将表单数据发送到 Supabase 表。为此，导入 Supabase 客户端并调用<code>insert</code>方法。</p>
<pre class="language-javascript hljs">import { supabase } from 'utils/supabase';

async function handler (req, res) {
  // ...server-side validation 
  try {
    await supabase.from('formdata').insert({
      name,
      email,
      employment_status,
    });
    return res
        .status(200)
        .json({ success: true, message: 'Post successful' });
  } catch (error) {
    console.log(error.response.data.message);
    return res.status(500).json({
        status: 'fail',
        message: 'Something went wrong',
      });
  }
}
</pre>
<p><code>.from</code>是要插入数据的表格。现在这已经完成了，当用户点击按钮提交时，我们将从客户端向这个 API 路由发出一个<code>POST</code>请求。</p>
<p>回到<code>handleSubmit</code>函数，在这里我们编写了<code>page === 2</code>的提交逻辑。让我们对 API 路由<code>/api/post-supabase</code>调用一个获取请求:</p>
<pre class="language-javascript hljs">try {
    await fetch('/api/post-supabase', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(formData),
  });
    setFormData({
    name: '',
    email: '',
    mployment_status: null,
    });
    setPage(0);
  } catch (error) {
    console.log(error);
}
</pre>
<p>如果<code>fetch</code>方法按预期运行，我们将重置表单数据并将<code>page</code>设置为 0，如果出现任何错误，我们将简单地记录错误(您也可以将其显示为警报)。</p>
<p>继续并尝试多步表单——您应该能够在 Supabase 表中看到一个新条目。</p>
<h2 id="conclusion">结论</h2>
<p>在这篇博文中，我们学习了如何创建多步表单。使用<code>useState</code>钩子，我们成功地创建了易于操作的表单。</p>
<p>我们可以创建具有验证功能的表单，并且可以轻松重用，而不需要为不同的用例创建新的表单。最重要的是，我们构建了这个多步表单，没有任何第三方包，比如 React-Stepzilla。</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720"><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener"> LogRocket </a>:全面了解您的生产 React 应用</h2><p>调试 React 应用程序可能很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪 Redux 状态、自动显示 JavaScript 错误以及跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" vwo-el-id="19356441070">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<p vwo-el-id="28675660440" class="">LogRocket 结合了会话回放、产品分析和错误跟踪，使软件团队能够创建理想的 web 和移动产品体验。这对你来说意味着什么？</p>
<p>LogRocket 不是猜测错误发生的原因，也不是要求用户提供截图和日志转储，而是让您回放问题，就像它们发生在您自己的浏览器中一样，以快速了解哪里出错了。</p>
<p>不再有嘈杂的警报。智能错误跟踪允许您对问题进行分类，然后从中学习。获得有影响的用户问题的通知，而不是误报。警报越少，有用的信号越多。</p>
<p vwo-el-id="28675660750">LogRocket Redux 中间件包为您的用户会话增加了一层额外的可见性。LogRocket 记录 Redux 存储中的所有操作和状态。</p>
<p vwo-el-id="28675661060">现代化您调试 React 应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">开始免费监控</a>。</p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>