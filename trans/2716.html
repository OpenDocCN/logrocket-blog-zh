<html>
<head>
<title>Creating a reading progress bar with React - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用 React - LogRocket 博客创建阅读进度条</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/creating-reading-progress-bar-react/#0001-01-01">https://blog.logrocket.com/creating-reading-progress-bar-react/#0001-01-01</a></blockquote><div><article class="article-post">
<p>阅读进度条在博客和在线社交阅读平台中相当常见，比如 Wattpad。进度条让读者知道他们已经读了多少，增加了整体用户体验，让读者着迷。</p>
<p>好消息是，这是一个非常简单的功能，可以添加到您的网站或博客。在本文中，我们将在 React 中创建一个阅读进度条。可以看到最终应用的现场<a href="https://i0k8e8.csb.app/">演示。我们开始吧！</a></p>
<h3>目录</h3>

<h2 id="creating-new-react-app">创建新的 React 应用程序</h2>
<p>首先，我们需要为我们的项目创建一个新的 React 应用程序。使用以下命令从头开始创建 React 应用程序:</p>
<pre>npx create-react-app my-app
cd my-app
npm start
</pre>
<p>接下来，删除<code>App.js</code>文件中的所有内容，使其为空。我们将在<code>App.js</code>中添加所有组件。</p>
<h2 id="creating-dummy-blog-post">创建虚拟博客帖子</h2>
<p>因为我们的主要目标是创建一个阅读进度条，而不是一个博客，我们将使用现有的模板创建一个虚拟的博客帖子。我正在使用一个免费的博客模板，名为<a href="https://media.themeslab.org/preview/html/philosophy/single-standard.html">哲学</a>，这是我在网上找到的，然而，你可以使用任何模板或虚拟内容。</p>
<p>通过下面的步骤，我们将创建一个虚拟的<code>content</code>组件，并将其导入到我们的<code>App.js</code>文件中:</p>
<ol>
<li>在您的<code>Src</code>文件夹中创建一个<code>Components</code>文件夹</li>
<li>在这个文件夹中创建一个名为<code>DummyContent.js</code>的新文件</li>
<li>接下来，在<code>DummyContent.js</code>中添加博客文章的 HTML</li>
<li>在<code>DummyContent.js</code>中，创建一个名为<code>Dummy.css</code>的新 CSS 文件，它将包含博客文章的样式</li>
</ol>
<p>您的目录应该类似于下图:</p>
<p><img data-attachment-id="95155" data-permalink="https://blog.logrocket.com/creating-reading-progress-bar-react/app-directory-structure/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/02/app-directory-structure.png" data-orig-size="393,385" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="app-directory-structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/02/app-directory-structure-300x294.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/02/app-directory-structure.png" decoding="async" class="aligncenter wp-image-95155 size-full jetpack-lazy-image" src="../Images/27038c5bba7985696c0d9c3db459539f.png" alt="App Directory Structure" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/02/app-directory-structure.png 393w, https://blog.logrocket.com/wp-content/uploads/2022/02/app-directory-structure-300x294.png 300w" data-lazy-sizes="(max-width: 393px) 100vw, 393px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/02/app-directory-structure.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/02/app-directory-structure.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="95155" data-permalink="https://blog.logrocket.com/creating-reading-progress-bar-react/app-directory-structure/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/02/app-directory-structure.png" data-orig-size="393,385" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="app-directory-structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/02/app-directory-structure-300x294.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/02/app-directory-structure.png" decoding="async" loading="lazy" class="aligncenter wp-image-95155 size-full" src="../Images/27038c5bba7985696c0d9c3db459539f.png" alt="App Directory Structure" srcset="https://blog.logrocket.com/wp-content/uploads/2022/02/app-directory-structure.png 393w, https://blog.logrocket.com/wp-content/uploads/2022/02/app-directory-structure-300x294.png 300w" sizes="(max-width: 393px) 100vw, 393px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/02/app-directory-structure.png"/></noscript>
<p>现在，在您的<code>App.js</code>文件中导入并渲染<code>DummyContent.js</code>文件。现在，您有了一个简单的博客布局，您的<code>App.js</code>文件将类似于下面的代码:</p>
<pre>import React from "react";
import DummyContent from "./Components/DummyContent";
function App() {
  return (
    &lt;div className="main"&gt;
      &lt;DummyContent /&gt;
    &lt;/div&gt;
  );
}
export default App;
</pre>
<h2 id="creating-reading-progress-bar">创建阅读进度条</h2>
<p>对于我们的主要目标，我们首先需要创建阅读栏组件。在同一个<code>Components</code>文件夹中，创建名为<code>ReadingBar.js</code>的新文件。通过键入<code>rfce</code>，在 VS 代码中添加基本标记。</p>
<h2 id="styled-components">样式组件</h2>
<p>为了创建阅读进度条的样式，我们将使用样式化组件轻松地在 JavaScript 中添加 CSS。我们将创建一个名为<code>Bar</code>的<code>styled.div</code>，它将包含我们的阅读栏的样式。</p>
<p>确保在我们的主<code>ReadingBar</code>函数之外创建<code>Bar</code>。通过在 React 组件的 render 方法中声明 styled-component，将在每次渲染时创建一个新组件，从而导致性能问题和不可预测的行为:</p>
<pre>import { React } from "react";
import styled from "styled-components";
// Bar Styled Component
const Bar = styled.div`
  position: fixed;
  height: 6px;
  border-radius: 0px 2px 0px 0px;
  background: linear-gradient(
    90deg,
    rgba(109, 227, 219, 1) 0%,
    rgba(132, 115, 177, 1) 100%,
    rgba(3, 9, 112, 1) 100%
  );
`;
function ReadingBar() {
  return &lt;Bar style={{ width: "0%" }}&gt;&lt;/Bar&gt;;
}
export default ReadingBar;
</pre>
<p>正如你在上面看到的，样式非常简单。酒吧是固定在顶部，我们还增加了背景颜色渐变。在<code>return</code>函数中，<code>width</code>作为一个样式。它目前被设置为<code>0%</code>，但是我们稍后会用一个州来替换它。</p>

<p>计算精确的滚动百分比有时会很棘手。这是大多数开发人员陷入困境的地方。</p>
<p>在大多数情况下，精确的百分比并不重要，比如粘性标题和滚动到顶部按钮。然而，在我们的例子中，我们需要使用精确的滚动条滚动百分比。即使是一点点不准确也会导致进度条要么过早完成，要么最后没有完成。</p>
<p>幸运的是，我们有一个简单的方法来解决这个问题:</p>
<pre>var el = document.documentElement,
  ScrollTop = el.scrollTop || document.body.scrollTop,
  ScrollHeight = el.scrollHeight || document.body.scrollHeight;
var percent = (ScrollTop / (ScrollHeight - el.clientHeight)) * 100;
</pre>
<p><code>document.documentElement</code>返回文档的根元素。我们在这里使用这个元素是因为我们想看看<code>page</code>还剩多少可以滚动。</p>
<p><code>Scroll top</code>是在元素内容中垂直滚动的像素数。<code>Scroll Height</code>是元素内容高度的完整度量，也包括因溢出而在屏幕上不可见的内容。最后，<code>Client Height</code>是一个元素的内部高度，在我们的例子中是<code>page</code>。</p>
<p>为了计算百分比，我们将<code>Scroll top</code>除以剩余的滚动量。要计算还剩多少可以滚动，用可见的<code>Height</code>减去完整的<code>Scroll Height</code>:</p>
<p><img data-attachment-id="95157" data-permalink="https://blog.logrocket.com/creating-reading-progress-bar-react/scroll-top-calculation-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/02/scroll-top-calculation-diagram.png" data-orig-size="730,319" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="scroll-top-calculation-diagram" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/02/scroll-top-calculation-diagram-300x131.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/02/scroll-top-calculation-diagram.png" decoding="async" class="aligncenter wp-image-95157 size-full jetpack-lazy-image" src="../Images/bca4bf2e07df8041615b58108db58468.png" alt="Scroll Top Calculation Diagram" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/02/scroll-top-calculation-diagram.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/02/scroll-top-calculation-diagram-300x131.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/02/scroll-top-calculation-diagram.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/02/scroll-top-calculation-diagram.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="95157" data-permalink="https://blog.logrocket.com/creating-reading-progress-bar-react/scroll-top-calculation-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/02/scroll-top-calculation-diagram.png" data-orig-size="730,319" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="scroll-top-calculation-diagram" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/02/scroll-top-calculation-diagram-300x131.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/02/scroll-top-calculation-diagram.png" decoding="async" loading="lazy" class="aligncenter wp-image-95157 size-full" src="../Images/bca4bf2e07df8041615b58108db58468.png" alt="Scroll Top Calculation Diagram" srcset="https://blog.logrocket.com/wp-content/uploads/2022/02/scroll-top-calculation-diagram.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/02/scroll-top-calculation-diagram-300x131.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/02/scroll-top-calculation-diagram.png"/></noscript>
<p>如你所见，<code>Scroll Height</code>是元素的完整高度，甚至是由于溢出而不可见的部分。<code>Client Height</code>为内部高度。因此，我们可以通过用<code>Height</code>减去完整的<code>Scroll Height</code>来得到尚未滚动的区域。</p>
<h2 id="using-states">使用状态</h2>
<p>现在，我们需要存储这个百分比值。我们将使用一个简单的状态来存储它，然后我们将在<code>Bar</code>组件的内联样式中使用状态，如下所示:</p>
<pre>import { React, useState } from "react";
import styled from "styled-components";
// Bar Styled Component
const Bar = styled.div`
  position: fixed;
  height: 6px;
  border-radius: 0px 2px 0px 0px;
  background: linear-gradient(
    90deg,
    rgba(109, 227, 219, 1) 0%,
    rgba(132, 115, 177, 1) 100%,
    rgba(3, 9, 112, 1) 100%);
`;
function ReadingBar() {
  //Width State
  const [width, setWidth] = useState(0);
  // scroll function
  const scrollHeight = () =&gt; {
    var el = document.documentElement,
      ScrollTop = el.scrollTop || document.body.scrollTop,
      ScrollHeight = el.scrollHeight || document.body.scrollHeight;
    var percent = (ScrollTop / (ScrollHeight - el.clientHeight)) * 100;
    // store percentage in state
    setWidth(percent);
  };
  return &lt;Bar style={{ width: width + "%" }}&gt;&lt;/Bar&gt;;
}
export default ReadingBar;</pre>
<blockquote><p>注意:当使用百分比符号时，也需要将其附加到值上。</p></blockquote>
<h2 id="why-need-useeffect-hook">为什么我们需要<code>useEffect</code>钩子</h2>
<p>我们的进度条的逻辑是完整的，但是缺少一个重要的功能，组件生命周期。你可以把<code>useEffect</code>钩子想象成<code>componentDidMount</code>、<code>componentDidUpdate</code>和<code>componentWillUnmount</code>的组合。</p>
<p>我们将如下使用<code>useEffect</code>钩子:</p>
<pre>//useEffect to control the component lifecycle
useEffect(() =&gt; {
  window.addEventListener("scroll", scrollHeight);
  return () =&gt; window.removeEventListener("scroll", scrollHeight);
});
</pre>
<p><code>useEffect</code>钩子用于副作用，在我们的例子中是用于 DOM 操作的。<code>useEffect</code>钩子基本上告诉 React 你的组件在渲染后需要做一些事情，在我们的例子中，在 scroll 上运行<code>scrollHeight</code>函数。</p>
<p>在我们的例子中，<code>useEffect</code>钩子做了以下事情:</p>
<ol>
<li>它检查组件是否已安装</li>
<li>如果组件已安装，它将运行回调函数</li>
<li>如果对状态或滚动位置进行了任何更改，它会更新</li>
</ol>
<p>当组件被卸载时，我们的<code>useEffect</code>钩子中的返回函数删除事件监听器。</p>
<h2 id="wrapping-up">包扎</h2>
<p>最后，在您的<code>App.js</code>文件中导入<code>Bar</code>组件并运行它:</p>
<pre>import React from "react";
import DummyContent from "./Components/DummyContent";
import ReadingBar from "./Components/ReadingBar";
function App() {
  return (
    &lt;div className="main"&gt;
      &lt;ReadingBar /&gt;
      &lt;DummyContent /&gt;
    &lt;/div&gt;
  );
}
export default App;
</pre>
<p>现在，你的阅读进度条应该功能齐全了。我希望你喜欢这个教程。如果您有任何问题或顾虑，请务必留下评论。编码快乐！</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用 LogRocket 消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款 React analytics 解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket 告诉您 React 应用程序中实际影响用户的最具影响力的 bug 和 UX 问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS 异常、前端性能指标和用户交互。然后，LogRocket 使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的 React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试 LogRocket】。</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>