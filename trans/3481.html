<html>
<head>
<title>Guide to building a React Native MQTT messaging app - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>构建React原生MQTT消息传递应用指南</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/#0001-01-01">https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/#0001-01-01</a></blockquote><div><article class="article-post">
<p>React Native是一个基于JavaScript的跨平台移动应用开发框架。React本机使用React为iOS和Android平台编写移动应用程序，并提供与本机应用程序相当的性能和可用性。</p>
<p>物联网(IoT)为许多移动应用提供了动力，React Native在物联网应用的开发方面提供了帮助。<a href="https://mqtt.org/" target="_blank" rel="noopener"> MQTT </a>(消息队列遥测传输)协议促进了物联网设备之间的通信，并实现了客户端和服务器之间的双向数据交换。</p>
<p>在本文中，我们将演示如何设置一个MQTT代理，使用客户端代理向iOS和Android应用程序订阅和发布主题。我们还将展示如何配置MQTT并将其连接到React本地应用程序。</p>
<h2 id="contents">内容</h2>

<h2 id="what-is-mqtt">MQTT是什么？</h2>
<p>MQTT是物联网的通用消息协议。这种实时消息协议(通常称为机器对机器协议)是一种设备通信机制，旨在实现快速数据传输。</p>
<p>MQTT是一个轻量级的发布和订阅消息传输，它允许我们发送和接收消息。它有助于几个设备之间的通信。</p>
<h2 id="setting-up-the-react-native-project">设置React本地项目</h2>
<p>要遵循本指南，请确保您的开发环境具有以下配置:</p>

<p>查看React Native的官方文档,了解如何在本地机器上设置React Native开发环境的详细说明。</p>
<p>使用以下命令创建React本地项目:</p>
<pre class="language-javascript hljs">npx react-native init recatNativeMqtt
# navigate to project directory
cd recatNativeMqtt
</pre>
<h2 id="adding-the-mqtt-library">添加MQTT库</h2>
<p>为了将我们的应用程序连接到MQTT，我们将使用来自Eclipse Paho项目的开源库<a href="https://github.com/eclipse/paho.mqtt.javascript" target="_blank" rel="noopener">Eclipse Paho JavaScript Client</a>与MQTT代理通信。<a href="https://projects.eclipse.org/projects/iot.paho" target="_blank" rel="noopener"> Eclipse Paho项目</a>旨在提供一个高效、轻量级和可伸缩的消息协议解决方案。</p>
<p>有许多编程语言支持Eclipse Paho。我们使用Eclipse Paho JavaScript客户端，因为我们的解决方案使用React Native，这是一个基于JavaScript的框架。Paho JavaScript客户机是一个基于浏览器的MQTT解决方案，它使用WebSockets连接到MQTT代理。</p>
<p>要添加Paho JavaScript客户端，在我们项目的根级别创建一个<code>lib</code>文件夹，创建一个<code>mqtt.js</code>文件，并将下面的<a href="https://raw.githubusercontent.com/eclipse/paho.mqtt.javascript/master/src/paho-mqtt.js" target="_blank" rel="noopener">源代码</a>添加到该文件中。</p>
<p>接下来，我们需要为Paho JavaScript客户机提供对本地存储的访问。我们在<code>lib</code>文件夹下创建一个<code>storage.js</code>文件，并在内存中添加一个全局<code>localStorage</code>的替代文件，如下所示:</p>
<pre class="language-javascript hljs">const storage = {
  setItem: (key, item) =&gt; {
    storage[key] = item;
  },
  getItem: key =&gt; storage[key],
  removeItem: key =&gt; {
    delete storage[key];
  },
};
export default storage;
</pre>
<p>现在我们已经添加了MQTT库，我们需要配置MQTT代理；这个中介将使客户端能够进行通信。</p>
<h2 id="configuring-the-mqtt-broker">配置MQTT代理</h2>
<p>有几个免费的<a href="https://mqtt.org/software/" target="_blank" rel="noopener"> MQTT代理</a>可供选择。对于本文，我们将使用Eclipse <a href="https://www.mosquitto.org/" target="_blank" rel="noopener"> Mosquitto </a> MQTT代理，这是一个用于MQTT协议的开源消息代理。</p>
<p>在<a href="https://www.mosquitto.org/download/" target="_blank" rel="noopener">官方文档</a>中提供了为开发环境设置Mosquitto的详细下载和配置信息。配置也可以使用Eclipse Mosquitto Docker映像来处理，如<a href="https://hub.docker.com/_/eclipse-mosquitto" target="_blank" rel="noopener"> Docker的说明</a>中所述。</p>
<p>Paho JavaScript客户机需要使用一个可以在WebSockets和TCP之间转发的网关，或者一个本地支持WebSockets的代理。</p>
<p>为了使WebSockets能够监听端口<code>9001</code>，我们将下面的代码添加到<code>mosquitto.config</code>文件中以访问配置文件；路径位置是<code>/usr/local/etc/mosquitto/mosquitto.conf</code>:</p>
<pre class="language-javascript hljs">listener 1883 0.0.0.0
allow_anonymous true


listener 9001 127.0.0.1
protocol websockets
</pre>
<p><img data-attachment-id="137333" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/protocol-websockets/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/protocol-websockets.png" data-orig-size="730,558" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Protocol websockets" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/protocol-websockets-300x229.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/protocol-websockets.png" decoding="async" class="aligncenter size-full wp-image-137333 jetpack-lazy-image" src="../Images/ab348099d158d77717c76e343b9023e9.png" alt="Protocol Websockets" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/protocol-websockets.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/protocol-websockets-300x229.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/protocol-websockets.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/protocol-websockets.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137333" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/protocol-websockets/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/protocol-websockets.png" data-orig-size="730,558" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Protocol websockets" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/protocol-websockets-300x229.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/protocol-websockets.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137333" src="../Images/ab348099d158d77717c76e343b9023e9.png" alt="Protocol Websockets" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/protocol-websockets.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/protocol-websockets-300x229.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/protocol-websockets.png"/></noscript>
<p>要在开发环境中启动Mosquitto代理，请运行以下命令:</p>
<p><code>/usr/local/sbin/mosquitto -c /usr/local/etc/mosquitto/mosquitto.conf</code></p>
<p>执行这个命令后，MQTT代理将在本地主机上运行，并开始监听端口<code>9001</code>。</p>
<p>接下来，运行以下命令，在iOS模拟器和Android模拟器中启动React本地应用程序:</p>
<pre class="language-javascript hljs"># To start metro
yarn react-native start 

# TO start iOS simulator
yarn react-native run-ios

# To start Android emulator
yarn react-native run-android
</pre>
<p>如下所示，iOS模拟器正在运行，并显示它连接到MQTT:</p>
<p><img data-attachment-id="137336" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/mqtt-connected-to-ios/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-ios.png" data-orig-size="730,456" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="MQTT connected to iOS" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-ios-300x187.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-ios.png" decoding="async" class="aligncenter size-full wp-image-137336 jetpack-lazy-image" src="../Images/f5fd6d305d0d83bd9cc8d11dd7c3c518.png" alt="MQTT Connected to iOS" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-ios.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-ios-300x187.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-ios.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-ios.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137336" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/mqtt-connected-to-ios/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-ios.png" data-orig-size="730,456" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="MQTT connected to iOS" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-ios-300x187.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-ios.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137336" src="../Images/f5fd6d305d0d83bd9cc8d11dd7c3c518.png" alt="MQTT Connected to iOS" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-ios.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-ios-300x187.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-ios.png"/></noscript>
<p>Android模拟器也在运行，并显示它连接到MQTT，如下所示:</p>
<p><img data-attachment-id="137338" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/mqtt-connected-to-android/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-android.png" data-orig-size="730,1522" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="MQTT connected to Android" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-android-144x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-android-491x1024.png" decoding="async" class="aligncenter size-full wp-image-137338 jetpack-lazy-image" src="../Images/4da6942ee8100f223ee118762b0d43d3.png" alt="MQTT Connected to Android" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-android.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-android-144x300.png 144w, https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-android-491x1024.png 491w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-android.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-android.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137338" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/mqtt-connected-to-android/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-android.png" data-orig-size="730,1522" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="MQTT connected to Android" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-android-144x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-android-491x1024.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137338" src="../Images/4da6942ee8100f223ee118762b0d43d3.png" alt="MQTT Connected to Android" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-android.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-android-144x300.png 144w, https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-android-491x1024.png 491w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/mqtt-connected-to-android.png"/></noscript>
<h2 id="configuring-mqttbox-for-testing">为测试配置MQTTBox</h2>
<p>MQTTBox是一个免费的开源开发工具，用于监控和测试MQTT服务器。我们可以使用MQTTBox来订阅主题，并将有效负载发布到订阅的设备。MQTTBox连接到MQTT代理，以便向我们的应用程序发送消息。</p>
<p>我们将使用<a href="https://chrome.google.com/webstore/detail/mqttbox/kaajoficamnjijhkeomgfljpicifbkaf" target="_blank" rel="noopener"> MQTTBox chrome扩展</a>来测试我们的MQTT代理并发布消息。</p>
<p>下面的MQTTBox屏幕显示了如何将MQTTBox配置到本地主机:</p>
<p><img data-attachment-id="137340" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/configure-mqttbox-to-localhost/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-mqttbox-to-localhost.png" data-orig-size="730,456" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Configure MQTTBox to localhost" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-mqttbox-to-localhost-300x187.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-mqttbox-to-localhost.png" decoding="async" class="aligncenter size-full wp-image-137340 jetpack-lazy-image" src="../Images/a0df4b52ef7bf60bb1ec8ef80f2518d9.png" alt="Configure MQTTBox to Localhost" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-mqttbox-to-localhost.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/configure-mqttbox-to-localhost-300x187.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-mqttbox-to-localhost.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-mqttbox-to-localhost.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137340" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/configure-mqttbox-to-localhost/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-mqttbox-to-localhost.png" data-orig-size="730,456" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Configure MQTTBox to localhost" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-mqttbox-to-localhost-300x187.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-mqttbox-to-localhost.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137340" src="../Images/a0df4b52ef7bf60bb1ec8ef80f2518d9.png" alt="Configure MQTTBox to Localhost" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-mqttbox-to-localhost.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/configure-mqttbox-to-localhost-300x187.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/configure-mqttbox-to-localhost.png"/></noscript>
<p><img data-attachment-id="137342" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/topic-boxes/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/topic-boxes.png" data-orig-size="730,410" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Topic boxes" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/topic-boxes-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/topic-boxes.png" decoding="async" class="aligncenter size-full wp-image-137342 jetpack-lazy-image" src="../Images/1168f2e7ce7c890b5b53c9301ba866fd.png" alt="Topic Boxes" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/topic-boxes.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/topic-boxes-300x168.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/topic-boxes.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/topic-boxes.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137342" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/topic-boxes/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/topic-boxes.png" data-orig-size="730,410" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Topic boxes" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/topic-boxes-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/topic-boxes.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137342" src="../Images/1168f2e7ce7c890b5b53c9301ba866fd.png" alt="Topic Boxes" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/topic-boxes.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/topic-boxes-300x168.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/topic-boxes.png"/></noscript>
<p>如下所示，我们发布到同一个主题，并从MQTTBox订阅它，以验证我们的代理已经启动并运行:</p>
<p><img data-attachment-id="137344" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/publish-and-subscribe-topics/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/publish-and-subscribe-topics.png" data-orig-size="730,408" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Publish and subscribe topics" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/publish-and-subscribe-topics-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/publish-and-subscribe-topics.png" decoding="async" class="aligncenter size-full wp-image-137344 jetpack-lazy-image" src="../Images/941ca4749dc9af8cb7f7ce23dbbc3ee0.png" alt="Publish and Subscribe Topics" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/publish-and-subscribe-topics.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/publish-and-subscribe-topics-300x168.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/publish-and-subscribe-topics.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/publish-and-subscribe-topics.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137344" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/publish-and-subscribe-topics/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/publish-and-subscribe-topics.png" data-orig-size="730,408" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Publish and subscribe topics" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/publish-and-subscribe-topics-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/publish-and-subscribe-topics.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137344" src="../Images/941ca4749dc9af8cb7f7ce23dbbc3ee0.png" alt="Publish and Subscribe Topics" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/publish-and-subscribe-topics.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/publish-and-subscribe-topics-300x168.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/publish-and-subscribe-topics.png"/></noscript>
<p>接下来，我们将演示如何通过MQTTBox发布主题并从React本地应用程序订阅。</p>
<h2 id="publishing-and-subscribing-with-mqtt">用MQTT发布和订阅</h2>
<p>对于基于物联网的实现，MQTT消息发布-订阅(或发布/订阅)模型是传统客户端-服务器模型的替代方案。一个客户端只能发布一个有效负载或消息到一个主题；它不能同时发布到多个主题。但是，如果客户端或应用程序订阅了相同的主题，这可能会被许多群组接收到。</p>
<p>为了实现MQTT发布/订阅，我们在<code>utils</code>文件夹下创建了一个<code>MqttClient</code>服务，并分配了下面的连接配置以及<code>onPublish</code>和<code>onSubscribe</code>方法:</p>
<pre class="language-javascript hljs">/* this.client = new Paho.MQTT.Client('host',PORT, clientId);
*/
this.client = new Paho.MQTT.Client('127.0.0.1', 9001, clientId);
</pre>
<p>在Android中，<code>127.0.0.1</code> (localhost)会抛出一个<code>Socket error</code>。为避免此错误，请使用您的主机系统IP地址:</p>
<p><img data-attachment-id="137346" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/socket-error/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/socket-error.png" data-orig-size="730,472" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Socket error" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/socket-error-300x194.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/socket-error.png" decoding="async" class="aligncenter size-full wp-image-137346 jetpack-lazy-image" src="../Images/5762a9f45eaa49ab425f39bd19f117be.png" alt="Socket Error" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/socket-error.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/socket-error-300x194.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/socket-error.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/socket-error.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137346" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/socket-error/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/socket-error.png" data-orig-size="730,472" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Socket error" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/socket-error-300x194.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/socket-error.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137346" src="../Images/5762a9f45eaa49ab425f39bd19f117be.png" alt="Socket Error" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/socket-error.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/socket-error-300x194.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/socket-error.png"/></noscript>
<pre class="language-javascript hljs">  onPublish = (topic, message) =&gt; {
    this.client.publish(topic, message);
  };
</pre>
<pre class="language-javascript hljs">onSubscribe = (topic, callback) =&gt; {
    this.callbacks[topic] = callback;
    this.client.subscribe(topic);
  };
</pre>
<p>发布MQTT消息或有效负载的流程取决于服务质量(QoS ),或者消息将被正确传递的保证。</p>
<p>MQTT支持三种QoS级别:</p>
<ul>
<li>QoS-0:此默认级别不确保发布有效负载的交付</li>
<li>QoS-1和QoS-2:这些级别确保即使在设备离线或没有连接到MQTT时也能发送消息</li>
</ul>
<p>当clean session标志为false时，所有消息都将保留在队列中，直到它们被发送到订阅的主题并得到确认。一旦重新连接到MQTT，设备就会将所有排队的消息发送到订阅的主题。</p>
<p>在下面的例子中，主题<code>fromClient</code>在从React本地应用程序订阅后，从MQTTBox发布，并带有有效负载消息。有效负载信息显示在iOS应用程序中:</p>
<p><img data-attachment-id="137348" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/payload-message-in-ios/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-ios.png" data-orig-size="730,412" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Payload message in iOS" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-ios-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-ios.png" decoding="async" class="aligncenter size-full wp-image-137348 jetpack-lazy-image" src="../Images/7eb1a6cf626f516fb728f0a5a8bb844e.png" alt="Payload Message in iOS" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-ios.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-ios-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-ios.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-ios.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137348" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/payload-message-in-ios/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-ios.png" data-orig-size="730,412" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Payload message in iOS" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-ios-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-ios.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137348" src="../Images/7eb1a6cf626f516fb728f0a5a8bb844e.png" alt="Payload Message in iOS" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-ios.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-ios-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-ios.png"/></noscript>
<p>接下来，我们使用<code>fromRNAPP</code>主题发布来自React本地应用程序的消息，并使用MQTTBox订阅它。负载消息在MQTTBox中，如下所示:</p>
<p><img data-attachment-id="137350" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/payload-message-in-mqttbox/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-mqttbox.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Payload message in MQTTBox" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-mqttbox-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-mqttbox.png" decoding="async" class="aligncenter size-full wp-image-137350 jetpack-lazy-image" src="../Images/ae8e1c579422eddd823e5da42e9e3342.png" alt="Payload Message in MQTTBox" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-mqttbox.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-mqttbox-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-mqttbox.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-mqttbox.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137350" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/payload-message-in-mqttbox/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-mqttbox.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Payload message in MQTTBox" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-mqttbox-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-mqttbox.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137350" src="../Images/ae8e1c579422eddd823e5da42e9e3342.png" alt="Payload Message in MQTTBox" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-mqttbox.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-mqttbox-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-mqttbox.png"/></noscript>
<p>现在，我们在React本机应用程序中发布和订阅相同的主题，一旦发布，我们就会获得有效负载消息并在应用程序中显示它:</p>
<p><img data-attachment-id="137352" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/payload-message-in-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-app.png" data-orig-size="730,456" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Payload message in app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-app-300x187.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-app.png" decoding="async" class="aligncenter size-full wp-image-137352 jetpack-lazy-image" src="../Images/b3ee0558aa1a46d164d92342b428a50d.png" alt="Payload Message in App" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-app-300x187.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-app.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-app.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137352" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/payload-message-in-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-app.png" data-orig-size="730,456" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Payload message in app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-app-300x187.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-app.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137352" src="../Images/b3ee0558aa1a46d164d92342b428a50d.png" alt="Payload Message in App" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-app-300x187.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/payload-message-in-app.png"/></noscript>
<h2 id="handling-failed-messages">在React Native中处理失败的消息</h2>
<p>如果React本机应用程序与MQTT代理断开连接，发布的消息将无法传递。在这种情况下，应用程序将根据<code>keepaliveInterval</code>重试连接到代理，以接收订阅主题的排队消息。</p>
<p>如果应用程序没有连接或者没有接收到来自代理的ping消息，<code>keepaliveInterval</code>将有一个非零值。这将提示应用程序尝试连接到代理，如下所示:</p>
<pre class="language-javascript hljs">onError = ({errorMessage}) =&gt; {
    this.isConnected = false;
    Alert.alert('Failed', 'Failed to connect to MQTT', [
      {
        text: 'Cancel',
        onPress: () =&gt; console.log('Cancel Pressed'),
        style: 'cancel',
      },
      {
        text: 'Try Again',
        onPress: () =&gt;
          this.onConnect(this.onSuccessHandler, this.onConnectionLostHandler),
      },
    ]);
  };
</pre>
<p><img data-attachment-id="137354" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/failed-to-connect-mqtt/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/failed-to-connect-mqtt.png" data-orig-size="730,457" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Failed to connect MQTT" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/failed-to-connect-mqtt-300x188.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/failed-to-connect-mqtt.png" decoding="async" class="aligncenter size-full wp-image-137354 jetpack-lazy-image" src="../Images/02d69a695297b428ae0bf592567352b9.png" alt="Failed to Connect MQTT" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/failed-to-connect-mqtt.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/failed-to-connect-mqtt-300x188.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/failed-to-connect-mqtt.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/failed-to-connect-mqtt.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="137354" data-permalink="https://blog.logrocket.com/guide-building-react-native-mqtt-messaging-app/attachment/failed-to-connect-mqtt/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/failed-to-connect-mqtt.png" data-orig-size="730,457" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Failed to connect MQTT" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/failed-to-connect-mqtt-300x188.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/failed-to-connect-mqtt.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-137354" src="../Images/02d69a695297b428ae0bf592567352b9.png" alt="Failed to Connect MQTT" srcset="https://blog.logrocket.com/wp-content/uploads/2022/10/failed-to-connect-mqtt.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/10/failed-to-connect-mqtt-300x188.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/failed-to-connect-mqtt.png"/></noscript>
<h2 id="conclusion">结论</h2>
<p>在本文中，我们讨论了使用Eclipse Mosquitto MQTT代理进行开发的MQTT消息传递协议设置和配置。</p>
<p>我们还使用Eclipse Paho JavaScript客户端库开发了一个React原生MQTT应用程序，并使用这个应用程序来演示订阅主题、发布消息和从服务器接收消息。</p>
<p>我希望你喜欢这篇文章。本文中使用的React原生MQTT应用程序的源代码可以在<a href="https://github.com/mukeshmandiwal/recatNativeMqtt" target="_blank" rel="noopener"> my GitHub </a>上获得。</p><div class="code-block code-block-18">
<div class="blog-plug inline-plug react-native-plug"><h2><a href="https://lp.logrocket.com/blg/react-native-signup"> LogRocket </a>:即时重现React原生应用中的问题。</h2><a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/110055665562c1e02069b3698e6cc671.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/110055665562c1e02069b3698e6cc671.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/></noscript></a><p><a href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一款React原生监控解决方案，可帮助您即时重现问题、确定bug的优先级并了解React原生应用的性能。</p><p>LogRocket还可以向你展示用户是如何与你的应用程序互动的，从而帮助你提高转化率和产品使用率。LogRocket的产品分析功能揭示了用户不完成特定流程或不采用新功能的原因。</p><p>开始主动监控您的React原生应用— <a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer">免费试用LogRocket】。</a></p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>