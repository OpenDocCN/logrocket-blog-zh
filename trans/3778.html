<html>
<head>
<title>Privacy-friendly data tracking in React with walker.js </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>React with walker.js中的隐私友好数据跟踪</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/data-tracking-react-walker-js/#0001-01-01">https://blog.logrocket.com/data-tracking-react-walker-js/#0001-01-01</a></blockquote><div><article class="article-post">
<p>在本文中，我们将了解第一方事件跟踪的主题。谷歌今年早些时候宣布，Chrome将不再支持第三方cookies，因此，这个话题变得更加重要。</p>
<p>在这种情况下，我们将研究第一方跟踪实际上是什么，以及如何使用名为<a href="https://www.elbwalker.com"> walker.js </a>的库来实现隐私友好的跟踪。为此，我们将从头开始用Next.js和walker.js创建一个示例应用程序。本教程将不涉及管理同意和用户身份等主题。</p>
<p><em>向前跳转:</em></p>

<h2 id="what-is-first-party-data">什么是第一方数据？</h2>
<p>在深入实际代码和walker.js库之前，让我们先了解什么是第一方数据。这对于理解walker.js等工具的好处和价值至关重要。</p>
<p>最后，很简单:第一方数据是一个公司或网站自己收集和拥有的信息。使用公司或网站自己的工具收集数据；相比之下，第三方数据来自外部的公司，其商业模式是收集数据并出售。</p>
<h2 id="introduction-walker-js">walker.js简介</h2>
<p>walker.js是一个<a href="https://github.com/elbwalker/walker.js">开源库</a>和第一方跟踪解决方案，这意味着您使用该库捕获的数据完全归您所有。</p>
<p>walker.js还以其他一些方式处理隐私问题。使用walker.js，您可以自由地将数据直接发送到您自己的端点，就像使用Google Tag Manager或Google Analytics一样，这使得拥有整个收集过程成为可能，从在浏览器中捕获数据到摄取并最终分析数据。不需要第三方供应商！</p>
<p>GDPR迫使你意识到哪些工具从你的用户那里接收什么类型的数据，并记录下来。如果在数据到达任何第三方工具之前，您拥有数据收集过程，这将容易得多。</p>
<p>除此之外，walker.js由于其同意功能，使您的网站、同意管理平台(又名CMP或<a href="https://blog.logrocket.com/ui-ux-best-practices-cookie-notifications/"> cookie通知横幅</a>)和第三方工具之间的通信更加容易。通过一个简单的函数，walker.js处理初始化和任何进一步的通信，包括您需要用户同意的功能、统计和营销工具的适当竞争条件。这样，没有你的用户的同意，任何工具都不会因为技术问题或者糟糕的实现而被加载。</p>
<p>如果您希望通过捕获匿名会话id或进行基于活动的归因而不收集任何个人身份信息来实现无cookie跟踪，也可以使用walker . js(PII)。无Cookie跟踪使您能够衡量基本的营销活动绩效，而无需将这些数据与单个用户联系起来。</p>
<p>如果您在walker.js中使用第一方数据收集器和显式跟踪方法，也不太可能意外捕获敏感数据，从而降低丢失重要信息的风险，并增加对您真正需要关注的用户事件的关注。</p>
<p>walker.js的另一个很酷的地方是，您不一定需要JavaScript来跟踪事件。相反，使用HTML属性是为了跟踪用户事件，并用必要的信息丰富它们。这使得您的代码和跟踪系统更具可读性和可维护性。</p>
<p>下面，你可以从他们的<a href="https://docs.elbwalker.com/tagging/basics">文档</a>中找到一个用walker.js标记页面的例子:</p>
<pre class="language-html hljs">&lt;!-- Generic usage --&gt;
&lt;div
  data-elb="ENTITY"
  data-elb-ENTITY="KEY:VALUE"
  data-elbaction="TRIGGER:ACTION"
  data-elbcontext="KEY:VALUE"
  data-elbglobals="KEY:VALUE"
/&gt;

&lt;!-- Example usage --&gt;
&lt;div data-elbglobals="language:en"&gt;
  &lt;div data-elbcontext="test:engagement"&gt;
    &lt;div data-elb="promotion" data-elbaction="visible:view"&gt;
      &lt;h1 data-elb-promotion="name:Setting up tracking easily"&gt;
        Setting up tracking easily
      &lt;/h1&gt;
      &lt;p data-elb-promotion="category:analytics"&gt;Analytics&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;</pre>
<p>如您所见，walker.js基于实体-动作模型。为了理解某个事件发生的上下文，我们可以用<code>data-elb</code>属性定义一个实体范围。您甚至可以扩展上下文，用<code>data-elbglobals</code>和<code>data-elbcontext</code>属性包含更多的一般信息。</p>
<p>通过设置<code>data-elbaction</code>属性，您可以定义触发动作的触发器，并最终使用<code>data-elb-ENTITY</code>来设置实体属性。</p>
<p>上面的例子将导致下面的数据结构，一旦<code>div</code>容器在视窗中可见，该数据结构将存储在浏览器的数据层中:</p>
<pre class="language-javascript hljs">{
  event: 'promotion view', // combination of entity and action
  data: {
    // arbitrary set properties with the data-elb-promotion attribute
    name: 'Setting up tracking easily',
    category: 'analytics',
  },
  context: {
    // Related properties defined with the data-elbcontext attribute
    test: 'engagement'
  },
  globals: {
    // General Properties defined with the data-elbglobals attribute
    language: 'en'
  },
  user: {
    // stored user ids (manually added once)
    id: 'userid',
    device: 'cookieid',
    hash: 'sessionid',
  },
  nested: [], // all nested entities within the promotion
  id: '1647968113641-01b5e2-5', // timestamp, group &amp; count of the event
  trigger: 'visible', // name of the trigger that fired
  entity: 'promotion', // entity name
  action: 'view', // entity action
  timestamp: 1647968113641, // time when the event fired
  timing: 3.14, // how long it took from the page load to trigger the event
  group: '01b5e2', // random group id for all events on a page
  count: 2, // incremental counter of the events on a page
  version: {
    // Helpful when working with raw data
    walker: 1.5, // used walker.js version
    config: 42, // a custom configuration version number
  },
  walker: true, // flag to filter events
}</pre>
<h2 id="getting-started-next-js-walker-js">Next.js和walker.js入门</h2>
<p>如果你对Next.js之外的其他标记示例感兴趣，可以查看<code>elbwalker</code>包中的<a href="https://github.com/elbwalker/walker.js/tree/main/examples">示例目录</a>。在这种情况下，我建立了一个简单的电子商务演示网站，包括主页、产品详情和登录页面。</p>
<p>我不打算在这篇博文中解释如何<a href="https://blog.logrocket.com/build-server-rendered-react-app-next-express/">设置Next.js项目</a>；如果你需要帮助，请访问他们的<a href="https://nextjs.org/docs/getting-started">医生</a>。为了将walker.js集成到现有的Next.js项目中，请运行以下命令:</p>
<pre class="language-bash hljs">npm i --save @elbwalker/walker.js</pre>
<p>接下来我们需要做的是初始化<code>walker</code>:</p>
<pre class="language-typescript hljs">// ./data/index.ts
import Elbwalker, { elb, WebDestination } from "@elbwalker/walker.js";

export default function setupAnalytics() {
 window.elbLayer = [];
 window.elbwalker = Elbwalker();
 window.elb = elb;

 elb("walker destination", {
   push: console.log,
 } as WebDestination.Function);

 elb("walker run");
}</pre>
<p>作为第一步，我们接受<code>setupAnalytics()</code>函数，然后创建<code>elblayer</code>数组，在那里我们将存储我们所有的信息。随着<code>Elbwalker()</code>函数的创建，我们也可以将其他选项传递给<code>elbLayer</code>。</p>
<p>我们还导入了将事件推送到<code>elbLayer</code>的<code>elb</code>辅助函数。此时，它将帮助我们定义一个目的地，并调用<code>elb("walker run")</code>来实际启动沃克。</p>
<p>为了简单起见，在本教程中，我们将只把控制台定义为我们的目的地。walker.js默认支持以下目的地(以后还会有更多):</p>
<ul>
<li>GA 4</li>
<li>地面试验导弹(Ground Testing Missile)</li>
<li>可信的分析</li>
<li>谷歌广告</li>
<li>元像素</li>
</ul>
<p>通常，您可以将任何目的地添加到walker中。查看关于目的地的<a href="https://docs.elbwalker.com/destinations/basics">文档，了解如何添加您的自定义目的地。</a></p>
<p>我们将使用<code>pages/_app.tsx</code>组件中的<code>setupAnalytics()</code>函数来实际设置walker:</p>
<pre class="language-typescript hljs">// pages/_app.tsx
...
import "../styles/globals.css";
import type { AppProps } from "next/app";
import { useEffect } from "react";

export default function App({ Component, pageProps }: AppProps) {
 useEffect(() =&gt; {
   const initTracking = async () =&gt; {
     const setupAnalytics = (await import("../data/index")).default;
     setupAnalytics();
   };
   initTracking();
 }, []);

 return (
   &lt;&gt;
    ...   
   &lt;/&gt;
 );
}</pre>
<p>您会注意到，我将导入和对<code>setupAnalytics()</code>函数的调用外包到了一个<code>useEffect</code>钩子中。因为Next.js在服务器端创建了这个页面，所以我们需要等待设置，直到页面加载到浏览器中。原因是walker.js需要访问<code>document </code>接口，这个接口只在客户端可用。如果我们在<code>useEffect</code>钩子之外调用<code>setupAnalytics()</code>函数，我们会得到一个<code>ReferenceError</code>，表示文档没有被定义。</p>
<h2 id="tag-pages-walker-js">如何用walker.js标记页面</h2>
<p>现在我们已经成功地设置了walker，我们可以继续标记页面了。第一步，我们将使用walker.js附带的一些预定义触发器。下面是一个列出所有可用触发器的<a href="https://docs.elbwalker.com/tagging/available-triggers">表:</a></p>
<table>
<tbody>
<tr>
<td><strong>事件</strong></td>
<td><strong>定义</strong></td>
</tr>
<tr>
<td><code>load</code></td>
<td>当DOM准备好加载页面后</td>
</tr>
<tr>
<td><code>click</code></td>
<td>当单击元素或子元素时</td>
</tr>
<tr>
<td><code>visible</code></td>
<td>当元素在视口中至少停留50%一秒钟后</td>
</tr>
<tr>
<td><code>hover</code></td>
<td>每当鼠标进入相应的元素时</td>
</tr>
<tr>
<td><code>submit</code></td>
<td>在有效的表单提交上</td>
</tr>
<tr>
<td><code>wait(ms)</code></td>
<td>等待<em>毫秒</em>秒(默认为15秒)直到触发</td>
</tr>
<tr>
<td><code>pulse(ms)</code></td>
<td>如果页面未隐藏，每<em>毫秒</em>秒(默认为15秒)重复触发一次</td>
</tr>
<tr>
<td><code>custom</code></td>
<td>使用JavaScript调用<code>elbLayer.push()</code>，查看<a href="https://docs.elbwalker.com/tagging/using-javascript"/></td>
</tr>
<tr>
<td><code>scroll(y)</code></td>
<td>最小时触发。<code>y</code>元素高度的百分比高于窗口底部，例如，<code>scroll(80)</code>表示80%的阈值</td>
</tr>
</tbody>
</table>
<p>在接下来的部分中，我们将添加页面视图、<code>hover</code>和<code>click</code>事件。</p>
<h3 id="adding-page-view-events">添加页面视图事件</h3>
<p>在代表我们主页的<code>pages/index.tsx</code>文件中，我们将首先添加<code>load </code>和<code>wait </code>触发器。感谢我们如何设置我们的walker，我们不必显式地添加一个<code>load</code>触发器来为我们的示例生成一个页面视图事件；这将在每次步行机运行时自动抛出。</p>
<p>如果我们访问演示网页的主页，控制台中将生成以下输出:</p>
<p id="gdcalert1"><img data-attachment-id="153949" data-permalink="https://blog.logrocket.com/data-tracking-react-walker-js/attachment/console-output-homepage/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/console-output-homepage.png" data-orig-size="730,900" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="console-output-homepage" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/console-output-homepage-243x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/console-output-homepage.png" decoding="async" class="aligncenter size-full wp-image-153949 jetpack-lazy-image" src="../Images/c9add882532774498397bd633f7c8a1e.png" alt="The output of our homepage in the console" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/console-output-homepage.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/console-output-homepage-243x300.png 243w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/console-output-homepage.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/console-output-homepage.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="153949" data-permalink="https://blog.logrocket.com/data-tracking-react-walker-js/attachment/console-output-homepage/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/console-output-homepage.png" data-orig-size="730,900" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="console-output-homepage" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/console-output-homepage-243x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/console-output-homepage.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-153949" src="../Images/c9add882532774498397bd633f7c8a1e.png" alt="The output of our homepage in the console" srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/console-output-homepage.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/console-output-homepage-243x300.png 243w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/console-output-homepage.png"/></noscript>
<p><code>login</code>路线将生成此事件:</p>
<p id="gdcalert2"><span> <img data-attachment-id="153951" data-permalink="https://blog.logrocket.com/data-tracking-react-walker-js/attachment/login-route-output-console/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/login-route-output-console.png" data-orig-size="730,873" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="login-route-output-console" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/login-route-output-console-251x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/login-route-output-console.png" decoding="async" class="aligncenter size-full wp-image-153951 jetpack-lazy-image" src="../Images/b4c2e38c553aff11e2e25dff119afcce.png" alt="The login route output in the console" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/login-route-output-console.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/login-route-output-console-251x300.png 251w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/login-route-output-console.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/login-route-output-console.png"/> <noscript> <img data-lazy-fallback="1" data-attachment-id="153951" data-permalink="https://blog.logrocket.com/data-tracking-react-walker-js/attachment/login-route-output-console/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/login-route-output-console.png" data-orig-size="730,873" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="login-route-output-console" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/login-route-output-console-251x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/login-route-output-console.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-153951" src="../Images/b4c2e38c553aff11e2e25dff119afcce.png" alt="The login route output in the console" srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/login-route-output-console.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/login-route-output-console-251x300.png 251w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/login-route-output-console.png"/> </noscript>但是，我们必须显式地添加其余的触发器。</span></p>
<h3 id="adding-wait-trigger-homepage">将<code>wait</code>触发器添加到我们的主页</h3>
<p>接下来，我们想将<code>wait </code>触发器添加到我们的主页。这个触发器可以用来确定用户是否对我们的站点感兴趣(例如，测量跳出率)。walker将等待指定的毫秒数，直到触发。</p>
<pre class="language-typescript hljs">// pages/index.tsx
export default function Home() {
 ...

 return (
   &lt;div
     className="relative bg-gray-800 overflow-hidden"
     data-elbcontext="test:home_engagement"
   &gt;
     &lt;div className="relative pt-6 pb-16 sm:pb-24"&gt;
       &lt;main className="mt-16 sm:mt-24"&gt;
         &lt;div className="mx-auto max-w-7xl" data-elb="home"&gt;
           &lt;div
             className="lg:grid lg:grid-cols-12 lg:gap-8"
             data-elbaction="wait(10000):interested"
           &gt;
        ...    
         );
}</pre>
<p>在这种情况下，我们等待<code>10</code>秒，直到触发器被触发。对于<code>data-elbcontext="test:home_engagement"</code>，我们说我们通常在测试主页上的用户参与度；用<code> data-elb="home"</code>设置实体和范围，最后用<code>data-elbaction="wait(10000):interested"</code>设置触发器和相应的动作。</p>
<h3 id="adding-click-hover-events">添加<code>click</code>和<code>hover</code>事件</h3>
<p>接下来，让我们为产品概述实现<code>click</code>和<code>hover</code>事件:</p>
<p id="gdcalert3"><img data-attachment-id="153953" data-permalink="https://blog.logrocket.com/data-tracking-react-walker-js/attachment/click-hover-events-products-overview/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/click-hover-events-products-overview.png" data-orig-size="730,384" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="click-hover-events-products-overview" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/click-hover-events-products-overview-300x158.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/click-hover-events-products-overview.png" decoding="async" class="aligncenter size-full wp-image-153953 jetpack-lazy-image" src="../Images/14f28d37a0257f5af60eed6c6bf1924c.png" alt="Console output for our click and hover events on the products overview page" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/click-hover-events-products-overview.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/click-hover-events-products-overview-300x158.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/click-hover-events-products-overview.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/click-hover-events-products-overview.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="153953" data-permalink="https://blog.logrocket.com/data-tracking-react-walker-js/attachment/click-hover-events-products-overview/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/click-hover-events-products-overview.png" data-orig-size="730,384" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="click-hover-events-products-overview" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/click-hover-events-products-overview-300x158.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/click-hover-events-products-overview.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-153953" src="../Images/14f28d37a0257f5af60eed6c6bf1924c.png" alt="Console output for our click and hover events on the products overview page" srcset="https://blog.logrocket.com/wp-content/uploads/2023/01/click-hover-events-products-overview.png 730w, https://blog.logrocket.com/wp-content/uploads/2023/01/click-hover-events-products-overview-300x158.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/click-hover-events-products-overview.png"/></noscript>
<p id="gdcalert4"><img data-attachment-id="153955" data-permalink="https://blog.logrocket.com/data-tracking-react-walker-js/attachment/products-overview-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/products-overview-page.gif" data-orig-size="640,480" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="products-overview-page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/products-overview-page-300x225.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/products-overview-page.gif" decoding="async" class="aligncenter size-full wp-image-153955 jetpack-lazy-image" src="../Images/f05197b0902528ada79b6a059c58cbd2.png" alt="Demo of our click and hover events on the products overview page" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/products-overview-page.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/products-overview-page.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="153955" data-permalink="https://blog.logrocket.com/data-tracking-react-walker-js/attachment/products-overview-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/products-overview-page.gif" data-orig-size="640,480" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="products-overview-page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/products-overview-page-300x225.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/products-overview-page.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-153955" src="../Images/f05197b0902528ada79b6a059c58cbd2.png" alt="Demo of our click and hover events on the products overview page" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/products-overview-page.gif"/></noscript>
<p>对应的代码是这样的，可以在<code>components/organisms/products.tsx</code>中找到:</p>
<pre class="language-typescript hljs">import { products } from "../../utils/mockProducts";

export default function Products() {
 return (
   &lt;div className="bg-white" data-elbcontext="test:products_engagement"&gt;
     &lt;div className="mx-auto max-w-2xl py-16 px-4 sm:py-24 sm:px-6 lg:max-w-7xl lg:px-8"&gt;
       &lt;h2 className="text-3xl font-extrabold tracking-tight text-gray-900 sm:text-4xl mb-10"&gt;
         Trending products
       &lt;/h2&gt;

       &lt;div className="grid grid-cols-1 gap-y-10 gap-x-6 sm:grid-cols-2 lg:grid-cols-3     xl:grid-cols-4 xl:gap-x-8"&gt;
         {products.map((product) =&gt; (
           &lt;a
             key={product.id}
             href={product.href}
             className="group"
             target="_blank"
             data-elb="product"
             data-elbaction="click"
             data-elb-product={`id: ${product.id}`}
           &gt;
          &lt;div data-elbaction="visible" className="aspect-w-1 aspect-h-1 w-full overflow-hidden rounded-lg bg-gray-200 xl:aspect-w-7 xl:aspect-h-8"&gt;
            …             
           &lt;/div&gt;
  
       );
}</pre>
<p>这个片段中最重要的信息可以在<code>map-method</code>中找到，在这里我们迭代了<code>products</code>数组中的所有条目。通过<code>data-elb="product"</code>，我们将我们的实体设定为一个产品。我们可以使用<code>data-elbaction="click; hover"</code>来跟踪用户在产品上的点击和悬停。</p>
<p>如果您仔细看看显示来自<code>hover</code>和<code>click</code>事件的控制台日志的截图，您会注意到<code>data</code>属性保存了悬停/点击产品的产品ID。我们可以通过在代码中添加<code> data-elb-product={`id: ${product.id}`}</code>来动态地将产品ID添加到事件中。您可以向您的实体添加任何属性，但是在这种情况下，我们还可以添加名称、价格等。</p>
<h2 id="add-custom-events-javascript">如何用JavaScript添加自定义事件</h2>
<p>到目前为止，我们已经了解了如何使用预构建的触发器轻松标记页面。但是Walker.js也允许我们实现自定义触发器，我们可以使用JavaScript自己将它们推送到<code>elbLayer</code>。</p>
<p>为此，我们将实现一个触发器来检测用户是否输入了无效密码(密码长度少于8个字符),以及另一个触发器来跟踪用户是否关注特定的输入字段。</p>
<p>您可以在walker.js文档中找到关于如何使用JavaScript跟踪事件的更多信息。通常，工作流程如下所示:</p>
<pre class="language-javascript hljs">import { elb } from '@elbwalker/walker.js';

elb('entity action', data, trigger, nested, context);</pre>
<p>首先，让我们实现密码验证事件。类似于上面的代码片段，我们可以定义一个名为<code>checkPassword</code>的新事件:</p>
<pre class="language-typescript hljs">// utils/customEvents.ts
export const checkPassword = async (entity: string) =&gt; {
 const { elb } = await import('@elbwalker/walker.js');
 elb(`${entity} shortPassword`, { domain: 'localhost' }, 'validation', {
   test: 'password validation',
 });
};</pre>
<p>第二步，我们需要在我们想要验证密码输入的位置导入<code>checkPassword</code>函数。下面的<code>handleSubmit</code>函数将在每次点击<strong>创建您的账户</strong>按钮时被调用。</p>
<pre class="language-typescript hljs">// components/organisms/account.tsx
const handleSubmit = (e: MouseEvent&lt;HTMLButtonElement&gt;) =&gt; {
   if (password.length &lt; 8) {
     e.preventDefault();
     checkPassword('account');
   }
 };</pre>
<p>对于第二个自定义事件，我们再次需要一个将事件推送到<code>elbLayer</code>的函数:</p>
<pre class="language-typescript hljs">// utils/customEvents.ts
export const trackInput = async (
 e: React.ChangeEvent&lt;HTMLInputElement&gt;,
 entityAction: string
) =&gt; {
 const { elb } = await import("@elbwalker/walker.js");

 elb(entityAction, { domain: "localhost", inputField: e.target.id }, "focus", {
   test: "input field engagement",
 });
};</pre>
<p>我们将<code>inputField: e.target.id</code>传递给我们的数据对象，这样我们就可以在几个输入字段之间区分我们的焦点。此事件现在可以添加到应用程序中的任何输入字段。在我们的例子中，我们将把它添加到主页上的<code>signup</code>组件中。</p>
<pre class="language-typescript hljs">// components/organisms/account.tsx/AccountSignUp
&lt;div&gt;
     &lt;label htmlFor="name" className="sr-only"&gt;
       Full name
     &lt;/label&gt;
     &lt;input
       onFocus={(e) =&gt; {
          trackInput(e, "account focus");
       }}
       type="text"
       name="name"
       id="name"
       autoComplete="name"
       placeholder="Full name"
      /&gt;
…
&lt;/div&gt;</pre>
<p>正如您所看到的，我们只是将<code>trackInput</code>函数添加到input元素的<code>onFocus</code>属性中。您可以在下面找到这一实现的结果:</p>
<p id="gdcalert5"><img data-attachment-id="153962" data-permalink="https://blog.logrocket.com/data-tracking-react-walker-js/attachment/trackinput-function-onfocus-property/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/trackinput-function-onfocus-property.gif" data-orig-size="454,592" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="trackinput-function-onfocus-property" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/trackinput-function-onfocus-property-230x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/trackinput-function-onfocus-property.gif" decoding="async" class="aligncenter size-full wp-image-153962 jetpack-lazy-image" src="../Images/87b0e3185ff4caa5f674e10fa682c219.png" alt="Applying the trackInput function on the onFocus property" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2023/01/trackinput-function-onfocus-property.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/trackinput-function-onfocus-property.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="153962" data-permalink="https://blog.logrocket.com/data-tracking-react-walker-js/attachment/trackinput-function-onfocus-property/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2023/01/trackinput-function-onfocus-property.gif" data-orig-size="454,592" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="trackinput-function-onfocus-property" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2023/01/trackinput-function-onfocus-property-230x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2023/01/trackinput-function-onfocus-property.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-153962" src="../Images/87b0e3185ff4caa5f674e10fa682c219.png" alt="Applying the trackInput function on the onFocus property" data-original-src="https://blog.logrocket.com/wp-content/uploads/2023/01/trackinput-function-onfocus-property.gif"/></noscript>
<h2>结论</h2>
<p>在这篇博文中，我们讨论了隐私友好数据跟踪的主题，并详细介绍了<a href="https://www.elbwalker.com"> walker.js库</a>，它允许您在应用程序中轻松实现第一方数据跟踪。</p>
<p>如果您对使用walker.js库感兴趣，请随意查看<a href="https://github.com/elbwalker/walker.js"> GitHub repo </a>！</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720"><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener"> LogRocket </a>:全面了解您的生产React应用</h2><p>调试React应用程序可能很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪Redux状态、自动显示JavaScript错误以及跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" vwo-el-id="19356441070">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<p vwo-el-id="28675660440" class="">LogRocket 结合了会话回放、产品分析和错误跟踪，使软件团队能够创建理想的web和移动产品体验。这对你来说意味着什么？</p>
<p>LogRocket不是猜测错误发生的原因，也不是要求用户提供截图和日志转储，而是让您回放问题，就像它们发生在您自己的浏览器中一样，以快速了解哪里出错了。</p>
<p>不再有嘈杂的警报。智能错误跟踪允许您对问题进行分类，然后从中学习。获得有影响的用户问题的通知，而不是误报。警报越少，有用的信号越多。</p>
<p vwo-el-id="28675660750">LogRocket Redux中间件包为您的用户会话增加了一层额外的可见性。LogRocket记录Redux存储中的所有操作和状态。</p>
<p vwo-el-id="28675661060">现代化您调试React应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">开始免费监控</a>。</p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>