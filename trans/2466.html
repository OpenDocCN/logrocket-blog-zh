<html>
<head>
<title>React Native Contacts: How to access a device's contact list - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>React 本机联系人:如何访问设备的联系人列表</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/react-native-contacts-how-to-access-a-devices-contact-list/#0001-01-01">https://blog.logrocket.com/react-native-contacts-how-to-access-a-devices-contact-list/#0001-01-01</a></blockquote><div><article class="article-post">
<p>从打电话到在社交媒体平台上寻找朋友，联系人在数字世界中占有重要地位。昔日庞大的电话号码簿现在变成了智能手机上的压缩列表。每个人都有自己独特的联系方式，包括电话号码、电子邮件等。</p>
<p>在本指南中，我们将探索 React 本机联系人，这是一个强大的联系人组件，可以使用 React 本机应用程序获取、更新和添加新的联系人。我们还将学习 Expo 的类似模块。</p>
<p>为了跟上进度，你应该熟悉 React Native 和<a href="https://docs.expo.dev/" target="_blank" rel="noopener"> Expo </a>的<a href="https://blog.logrocket.com/how-to-build-ios-apps-using-react-native/" target="_blank" rel="noopener">基础知识，包括</a><a href="https://blog.logrocket.com/diving-into-the-new-jsx-transform/" target="_blank" rel="noopener"> JSX </a>、<a href="https://blog.logrocket.com/a-complete-guide-to-default-props-in-react-984ea8e6972d/" target="_blank" rel="noopener">组件</a>(类别和功能)以及造型。</p>
<p>您可以简单地复制并粘贴本指南中的代码块，但是我建议您通读整个教程以获得完整的理解。本指南假设您已经完成了应用程序的基本设置。</p>

<p><a href="https://github.com/morenoh149/react-native-contacts" target="_blank" rel="noopener"> React Native Contacts </a>是一个模块，提供在 iOS 和 Android 的 React Native 应用程序中创建、获取、更新和删除联系人的功能。它使用各种承诺来完成上面提到的所有任务。这有助于它完成所有需要的任务，而不会给应用程序的 UI 线程带来太大的压力。</p>

<p>这个模块不需要太多的设置，因为自动链接处理大部分工作。但是对于联系人所需的权限，我们需要在链接后做一些小小的添加。</p>
<p>首先，我们需要将模块添加到 React 本地项目中。</p>
<pre class="language-javascript hljs">$ yarn add react-native-contacts
</pre>
<p>在 Android 的情况下，自动链接处理所有的工作。我们可能需要检查的一件事是为<code>AndroidManifest.xml</code>中的联系人添加了<code>&lt;uses-permission</code>标记:</p>
<pre class="language-javascript hljs">&lt;uses-permission android:name="android.permission.WRITE_CONTACTS" /&gt;
</pre>
<p>对于 iOS，首先我们需要在<code>iOS/</code>目录中安装 pods:</p>
<pre class="language-javascript hljs">$ pod install
</pre>
<p>下一步是给<code>info.plist</code>添加一个键:</p>
<pre class="language-javascript hljs">Privacy - Contacts Usage Description
</pre>
<p>您可以添加一个字符串，这是一条应该在 iOS 的权限弹出窗口中显示的消息。</p>
<p><img decoding="async" src="../Images/29b9d93cbb9fa6dbb55ddf6cc4ec2667.png" alt="You can add the key in xcode" data-lazy-src="https://paper-attachments.dropbox.com/s_2DF83310A836311EF5E613CCA2096B2021F9866C88C30349F937801E7A85D735_1638860591969_Screenshot+2021-12-07+at+12.33.08+PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://paper-attachments.dropbox.com/s_2DF83310A836311EF5E613CCA2096B2021F9866C88C30349F937801E7A85D735_1638860591969_Screenshot+2021-12-07+at+12.33.08+PM.png"/></p><noscript><img data-lazy-fallback="1" decoding="async" src="../Images/29b9d93cbb9fa6dbb55ddf6cc4ec2667.png" alt="You can add the key in xcode" data-original-src="https://paper-attachments.dropbox.com/s_2DF83310A836311EF5E613CCA2096B2021F9866C88C30349F937801E7A85D735_1638860591969_Screenshot+2021-12-07+at+12.33.08+PM.png"/></noscript>

<p>要访问联系人，首先我们需要导入联系人模块。</p>
<pre class="language-javascript hljs">import Contacts from 'react-native-contacts';
</pre>
<p>要从手机访问联系人，我们将使用模块的<code>getAll</code> promise。</p>
<pre class="language-javascript hljs">Contacts.getAll().then(contacts =&gt; {
      // setContacts(contacts);
});
</pre>
<p>我们将在 JSON 数组的<code>for</code>中接收数据，每个对象的结构如下:</p>
<pre class="language-javascript hljs">{
      "birthday":{
         "day":20,
         "month":1,
         "year":1978
      },
      "company":"Creative Consulting",
      "emailAddresses":[
         [
            "Object"
         ]
      ],
      "familyName":"Bell",
      "givenName":"Kate",
      "hasThumbnail":false,
      "imAddresses":[

      ],
      "jobTitle":"Producer",
      "middleName":"",
      "phoneNumbers":[
         [
            "Object"
         ],
         [
            "Object"
         ]
      ],
      "postalAddresses":[
         [
            "Object"
         ]
      ],
      "recordID":"177C371E-701D-42F8-A03B-C61CA31627F6",
      "thumbnailPath":"",
      "urlAddresses":[
         [
            "Object"
         ]
      ]
   },
</pre>
<p>上面是一个从<code>getAll</code>承诺收到的联系示例。</p>
<p>为了在列表中显示数据，我们将使用 React Native 中的<code>FlatList</code>组件。请随意使用您喜欢的任何列表组件。</p>
<p>下面是列表的示例代码。</p>
<p><strong> <code>ContactsList.js</code> </strong>:</p>
<pre class="language-javascript hljs">import React, {useEffect, useState} from 'react';
import {FlatList, View, Text, StyleSheet} from 'react-native';
import Contacts from 'react-native-contacts';
import {Contact} from '.';
const ContactsList = () =&gt; {
  const [contacts, setContacts] = useState([]);
  useEffect(() =&gt; {
    Contacts.getAll().then(contacts =&gt; {
      setContacts(contacts);
    });
  }, []);
  const keyExtractor = (item, idx) =&gt; {
    return item?.recordID?.toString() || idx.toString();
  };
  const renderItem = ({item, index}) =&gt; {
    return &lt;Contact contact={item} /&gt;;
  };
  return (
    &lt;FlatList
      data={contacts}
      renderItem={renderItem}
      keyExtractor={keyExtractor}
      style={styles.list}
    /&gt;
  );
};
const styles = StyleSheet.create({
  list: {
    flex: 1,
  },
});
export default ContactsList;
</pre>
<p><strong> <code>Contact.js</code> </strong>:</p>
<pre class="language-javascript hljs">import React from 'react';
import {View, Text, StyleSheet} from 'react-native';
const Contact = ({contact}) =&gt; {
  return (
    &lt;View style={styles.contactCon}&gt;
      &lt;View style={styles.imgCon}&gt;
        &lt;View style={styles.placeholder}&gt;
          &lt;Text style={styles.txt}&gt;{contact?.givenName[0]}&lt;/Text&gt;
        &lt;/View&gt;
      &lt;/View&gt;
      &lt;View style={styles.contactDat}&gt;
        &lt;Text style={styles.name}&gt;
          {contact?.givenName} {contact?.middleName &amp;&amp; contact.middleName + ' '}
          {contact?.familyName}
        &lt;/Text&gt;
        &lt;Text style={styles.phoneNumber}&gt;
          {contact?.phoneNumbers[0]?.number}
        &lt;/Text&gt;
      &lt;/View&gt;
    &lt;/View&gt;
  );
};
const styles = StyleSheet.create({
  contactCon: {
    flex: 1,
    flexDirection: 'row',
    padding: 5,
    borderBottomWidth: 0.5,
    borderBottomColor: '#d9d9d9',
  },
  imgCon: {},
  placeholder: {
    width: 55,
    height: 55,
    borderRadius: 30,
    overflow: 'hidden',
    backgroundColor: '#d9d9d9',
    alignItems: 'center',
    justifyContent: 'center',
  },
  contactDat: {
    flex: 1,
    justifyContent: 'center',
    paddingLeft: 5,
  },
  txt: {
    fontSize: 18,
  },
  name: {
    fontSize: 16,
  },
  phoneNumber: {
    color: '#888',
  },
});
export default Contact;
</pre>
<p><strong> <code>index.js</code> </strong>:</p>
<pre class="language-javascript hljs">import ContactsList from './contactsList';
import Contact from './contact';
export default ContactsList;
export {Contact};
</pre>
<p>输出应该如下所示:</p>
<p><img decoding="async" src="../Images/37e611696270a02e7c016b034da40d3e.png" alt="Dummy contacts from the simulator" data-lazy-src="https://paper-attachments.dropbox.com/s_2DF83310A836311EF5E613CCA2096B2021F9866C88C30349F937801E7A85D735_1638862035545_Simulator+Screen+Shot+-+iPhone+12+-+2021-12-07+at+12.56.57.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://paper-attachments.dropbox.com/s_2DF83310A836311EF5E613CCA2096B2021F9866C88C30349F937801E7A85D735_1638862035545_Simulator+Screen+Shot+-+iPhone+12+-+2021-12-07+at+12.56.57.png"/></p><noscript><img data-lazy-fallback="1" decoding="async" src="../Images/37e611696270a02e7c016b034da40d3e.png" alt="Dummy contacts from the simulator" data-original-src="https://paper-attachments.dropbox.com/s_2DF83310A836311EF5E613CCA2096B2021F9866C88C30349F937801E7A85D735_1638862035545_Simulator+Screen+Shot+-+iPhone+12+-+2021-12-07+at+12.56.57.png"/></noscript>

<p>Expo 中获取联系人的概念与上面的相同，只是在接收的数据结构上略有变化。</p>
<p>同样，首先我们需要导入模块:</p>
<pre class="language-javascript hljs">import * as Contacts from "expo-contacts";
</pre>
<p>要从手机访问联系人，我们将使用该模块的<code>getAll</code> promise。</p>
<pre class="language-javascript hljs">const { data } = await Contacts.getContactsAsync({
          fields: [Contacts.PHONE_NUMBERS],
});
</pre>
<p>我们将在 JSON 数组的<code>for</code>中接收数据，每个对象的结构如下:</p>
<pre class="language-javascript hljs">{
  "company": "Creative Consulting",
  "contactType": "person",
  "firstName": "Kate",
  "id": "177C371E-701D-42F8-A03B-C61CA31627F6",
  "imageAvailable": false,
  "jobTitle": "Producer",
  "lastName": "Bell",
  "name": "Kate Bell",
  "phoneNumbers": Array [
    Object {
      "countryCode": "us",
      "digits": "5555648583",
      "id": "EF48385D-28C2-48DE-AAB3-A81BC5F16981",
      "label": "mobile",
      "number": "(555) 564-8583",
    },
    Object {
      "countryCode": "us",
      "digits": "4155553695",
      "id": "3CD5F927-B150-4104-918B-C26DD6AC811B",
      "label": "main",
      "number": "(415) 555-3695",
    },
  ],
}
</pre>
<p>以上是从<code>getAll</code>承诺处收到的联系示例。</p>
<p>为了在列表中显示数据，我们将使用<code>FlatList</code>组件。同样，您可以使用任何清单组件。</p>
<p>虚拟组件的文件和结构与裸露的 React 本地示例保持一致。</p>
<p>以下是列表的示例代码:</p>
<p><strong> <code>ContactsList.js</code> </strong>:</p>
<pre class="language-javascript hljs">import React, { useEffect, useState } from "react";
import { FlatList, View, Text, StyleSheet } from "react-native";
import Contact from "./contact";
import * as Contacts from "expo-contacts";
const ContactsList = () =&gt; {
  const [contacts, setContacts] = useState([]);
  useEffect(() =&gt; {
    (async () =&gt; {
      const { status } = await Contacts.requestPermissionsAsync();
      if (status === "granted") {
        const { data } = await Contacts.getContactsAsync({
          fields: [Contacts.PHONE_NUMBERS],
        });
        if (data.length &gt; 0) {
          setContacts(data);
          console.log(data[0]);
        }
      }
    })();
  }, []);
  const keyExtractor = (item, idx) =&gt; {
    return item?.id?.toString() || idx.toString();
  };
  const renderItem = ({ item, index }) =&gt; {
    return &lt;Contact contact={item} /&gt;;
  };
  return (
    &lt;FlatList
      data={contacts}
      renderItem={renderItem}
      keyExtractor={keyExtractor}
      style={styles.list}
    /&gt;
  );
};
const styles = StyleSheet.create({
  list: {
    flex: 1,
  },
});
export default ContactsList;
</pre>
<p><strong> <code>Contact.js</code> </strong>:</p>
<pre class="language-javascript hljs">import React from "react";
import { View, Text, StyleSheet } from "react-native";
const Contact = ({ contact }) =&gt; {
  return (
    &lt;View style={styles.contactCon}&gt;
      &lt;View style={styles.imgCon}&gt;
        &lt;View style={styles.placeholder}&gt;
          &lt;Text style={styles.txt}&gt;{contact?.name[0]}&lt;/Text&gt;
        &lt;/View&gt;
      &lt;/View&gt;
      &lt;View style={styles.contactDat}&gt;
        &lt;Text style={styles.name}&gt;{contact?.name}&lt;/Text&gt;
        &lt;Text style={styles.phoneNumber}&gt;
          {contact?.phoneNumbers[0]?.number}
        &lt;/Text&gt;
      &lt;/View&gt;
    &lt;/View&gt;
  );
};
const styles = StyleSheet.create({
  contactCon: {
    flex: 1,
    flexDirection: "row",
    padding: 5,
    borderBottomWidth: 0.5,
    borderBottomColor: "#d9d9d9",
  },
  imgCon: {},
  placeholder: {
    width: 55,
    height: 55,
    borderRadius: 30,
    overflow: "hidden",
    backgroundColor: "#d9d9d9",
    alignItems: "center",
    justifyContent: "center",
  },
  contactDat: {
    flex: 1,
    justifyContent: "center",
    paddingLeft: 5,
  },
  txt: {
    fontSize: 18,
  },
  name: {
    fontSize: 16,
  },
  phoneNumber: {
    color: "#888",
  },
});
export default Contact;
</pre>
<p><code><strong>index.js</strong></code>:</p>
<pre class="language-javascript hljs">import ContactsList from './contactsList';
import Contact from './contact';
export default ContactsList;
export {Contact};
</pre>
<p>下面是上面代码的输出:</p>
<p><img decoding="async" src="../Images/0db9f03241e34efd2d53c219d35d888f.png" alt="Contacts from simulator (expo app)" data-lazy-src="https://paper-attachments.dropbox.com/s_2DF83310A836311EF5E613CCA2096B2021F9866C88C30349F937801E7A85D735_1638863089113_Simulator+Screen+Shot+-+iPhone+12+-+2021-12-07+at+13.14.43.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://paper-attachments.dropbox.com/s_2DF83310A836311EF5E613CCA2096B2021F9866C88C30349F937801E7A85D735_1638863089113_Simulator+Screen+Shot+-+iPhone+12+-+2021-12-07+at+13.14.43.png"/></p><noscript><img data-lazy-fallback="1" decoding="async" src="../Images/0db9f03241e34efd2d53c219d35d888f.png" alt="Contacts from simulator (expo app)" data-original-src="https://paper-attachments.dropbox.com/s_2DF83310A836311EF5E613CCA2096B2021F9866C88C30349F937801E7A85D735_1638863089113_Simulator+Screen+Shot+-+iPhone+12+-+2021-12-07+at+13.14.43.png"/></noscript>
<h2 id="conclusion">结论</h2>
<p>React Native Contacts 和<a href="https://docs.expo.dev/versions/latest/sdk/contacts/"> Expo Contacts </a>都是在用户设备上获取和操作联系人的优秀工具。</p>
<p>在本教程中，我们讨论了如何在 bare 和 Expo React 本地应用程序中获取联系人。如果你想探索更多的选项，我建议你试试<a href="https://docs.expo.dev/bare/installing-expo-modules/" target="_blank" rel="noopener"> Expo modules </a>的<a href="https://docs.expo.dev/versions/latest/sdk/contacts/" target="_blank" rel="noopener"> expo-contacts </a>模块，在你裸露的 React 原生应用中玩联系人游戏。</p><div class="code-block code-block-18">
<div class="blog-plug inline-plug react-native-plug"><h2><a href="https://lp.logrocket.com/blg/react-native-signup"> LogRocket </a>:即时重现 React 原生应用中的问题。</h2><a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/110055665562c1e02069b3698e6cc671.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/110055665562c1e02069b3698e6cc671.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/></noscript></a><p><a href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一款 React 原生监控解决方案，可帮助您即时重现问题、确定 bug 的优先级并了解 React 原生应用的性能。</p><p>LogRocket 还可以向你展示用户是如何与你的应用程序互动的，从而帮助你提高转化率和产品使用率。LogRocket 的产品分析功能揭示了用户不完成特定流程或不采用新功能的原因。</p><p>开始主动监控您的 React 原生应用— <a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer">免费试用 LogRocket】。</a></p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>