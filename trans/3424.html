<html>
<head>
<title>Build a chrome extension in Plasmo with React - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用React - LogRocket博客在Plasmo中构建一个chrome扩展</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/build-chrome-extension-plasmo-react/#0001-01-01">https://blog.logrocket.com/build-chrome-extension-plasmo-react/#0001-01-01</a></blockquote><div><article class="article-post">
<p>Chrome扩展包含了一些非常方便的特性，可以让你的工作变得更加简单。等离子体，一个相对较新的框架，有助于使用<a href="https://blog.logrocket.com/tag/react/"> React </a>轻松构建chrome扩展！</p>
<p>是的，这意味着你可以使用React的基于组件的开发来高效快速地构建Chrome扩展！听起来不错，对吧？</p>
<p>在本文中，我们将了解如何使用Plasmo通过React构建Chrome扩展。</p>
<p>以下是我们将要介绍的内容:</p>
<ol>
<li><a href="#initialize-new-plasmo-project">初始化新的等离子体项目</a></li>
<li><a href="#setting-up-tailwind-css">设置顺风CSS </a></li>
<li><a href="#building-out-frontend">构建前端</a></li>
<li><a href="#writing-logic">编写逻辑</a></li>
<li><a href="#adding-local-storage-support">添加本地存储支持</a></li>
</ol>
<p>如需跟进，请参考<a href="https://github.com/GeoBrodas/plasmo-next" target="_blank" rel="noopener">本报告</a>，并访问<a href="https://docs.plasmo.com/" target="_blank" rel="noopener">等离子体文档</a>以获取更多集成指南。</p>
<h2 id="initialize-new-plasmo-project">初始化新的等离子体项目</h2>
<p>旋转终端，移至项目文件夹，通过执行以下操作初始化新的等离子体项目:</p>
<pre class="language-bash hljs">npm x plasmo init
</pre>
<p>或者使用<a href="https://github.com/PlasmoHQ/examples/tree/main/with-nextjs" target="_blank" rel="noopener"> this repo </a>简单地用Next.js设置Plasmo。</p>
<p>我是Next.js的超级粉丝，因此我将在本教程中使用它。继续安装以下依赖项:</p>
<pre class="language-bash hljs">npm install <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="4d232835390d212c39283e39">[email protected]</a>
</pre>
<p>现在，您将拥有与下图类似的设置:</p>
<p><img data-attachment-id="135055" data-permalink="https://blog.logrocket.com/build-chrome-extension-plasmo-react/attachment/installing-dependencies-plasmo-next-js/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/installing-dependencies-plasmo-next-js.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="installing-dependencies-plasmo-next-js" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/installing-dependencies-plasmo-next-js-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/installing-dependencies-plasmo-next-js.png" decoding="async" class="wp-image-135055 size-full aligncenter jetpack-lazy-image" src="../Images/bca22eff04350caa99a5b084cd2314e2.png" alt="Installing dependencies on Plasmo with Next.js" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/installing-dependencies-plasmo-next-js.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/installing-dependencies-plasmo-next-js-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/installing-dependencies-plasmo-next-js.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/installing-dependencies-plasmo-next-js.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="135055" data-permalink="https://blog.logrocket.com/build-chrome-extension-plasmo-react/attachment/installing-dependencies-plasmo-next-js/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/installing-dependencies-plasmo-next-js.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="installing-dependencies-plasmo-next-js" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/installing-dependencies-plasmo-next-js-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/installing-dependencies-plasmo-next-js.png" decoding="async" loading="lazy" class="wp-image-135055 size-full aligncenter" src="../Images/bca22eff04350caa99a5b084cd2314e2.png" alt="Installing dependencies on Plasmo with Next.js" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/installing-dependencies-plasmo-next-js.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/installing-dependencies-plasmo-next-js-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/installing-dependencies-plasmo-next-js.png"/></noscript>
<p>使用等离子体时要记住的一些事情:</p>
<ul>
<li>你正在构建一个Chrome扩展，而不是一个网页。静态网站再生是出了方程，在这里</li>
<li>一切都是在客户端获取的。</li>
<li>所有基本的React功能都应该像预期的那样工作</li>
<li>等离子体仍处于发展阶段，因此，可能会有一些小错误</li>
<li>Next.js路由在Plasmo中不起作用。(事实上，这是不必要的，因为Next.js中的routing以静态呈现页面的方式著称)</li>
<li>您的源代码驻留在<code>src</code>目录中</li>
</ul>
<p>接下来，让我们在项目中设置Tailwind CSS。</p>
<h2 id="setting-up-tailwind-css">设置顺风-CSS</h2>
<p>安装顺风CSS所需的下列开发依赖项:</p>
<pre class="language-bash hljs">npm install autoprefixer postcss tailwindcss --save-dev
</pre>
<p>接下来，运行<code>init</code>命令来生成<code>tailwind.config.js</code>和<code>postcss.config.js</code>文件。</p>
<pre class="language-bash hljs">npx tailwindcss init -p
</pre>
<p>在<code>tailwind.config.js</code>文件中，将以下路径添加到<code>content</code>属性中:</p>
<pre class="language-js hljs">module.exports = {
  content: ["./**/*.{ts,tsx}"],
  theme: {
    extend: {}
  },
  plugins: []
}
</pre>
<p>然后，创建一个新的<code>styles.css</code>文件，并向其中添加<code>@tailwind</code>指令。</p>
<pre class="language-css hljs">@tailwind base;
@tailwind components;
@tailwind utilities;
</pre>
<p>完成后，将<code>import</code>添加到这个文件的<code>./src/components/main.tsx</code>文件中。</p>
<pre class="language-javascript hljs">import "../../style.css"

export function Main ({ name = "Extension" }) {...
}
</pre>
<p>(注意:如果你遇到了困难，你可以点击这里阅读Next.js的Tailwind CSS集成指南)</p>
<h2 id="building-out-frontend">构建前端</h2>
<p>在Tailwind CSS的帮助下，让我们构建Chrome扩展的前端。</p>
<p>让我们首先为Chrome扩展做一个布局，它将围绕<code>Main</code>组件。</p>
<p>在<code>./src/components/layouts/Container.tsx</code>中创建一个新文件:</p>
<pre class="language-javascript hljs">function Container ({ children }) {
  return (
    &lt;div&gt;{chidlren}&lt;/div&gt;
  );
}

export default Container;
</pre>
<p>让我们在用户旋转分机时问候他们:</p>
<pre class="language-javascript hljs">function greeting() {
  const time = new Date().getHours()
  if (time &lt; 12) {
    return "Good Morning!"
  }
  if (time &lt; 18) {
    return "Good Afternoon!"
  }
  return "Good Evening!"
}
</pre>
<p>如下所示，将其添加到<code>Container</code>组件中…</p>
<pre class="language-javascript hljs">return (
  &lt;div&gt;
    &lt;div&gt;
      &lt;p&gt;{greeting()}&lt;/p&gt;
    &lt;/div&gt;
    {children}
  &lt;/div&gt;
)
</pre>
<p>…和一小撮CSS✨</p>
<pre class="language-javascript hljs">return (
  &lt;div
    style={{
      padding: "40px 20px",
      // add gradient
      background: "linear-gradient(to top, #BADBFB , #FFFFFF )"
    }}
  &gt;
    // body
  &lt;/div&gt;
);
</pre>
<p>现在，把这个<code>Container</code>包裹在<code>main.tsx</code>上。</p>
<p>完成这些后，现在让我们为Plasmo设置开发环境，这样您就可以实时看到您的更改，就像您在开发过程中如何对网站进行更改一样。</p>
<p>首先，前往<code>chrome://extensions</code>并切换到开发者模式。</p>
<p><img data-attachment-id="135063" data-permalink="https://blog.logrocket.com/build-chrome-extension-plasmo-react/attachment/developer-mode-chrome/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/developer-mode-chrome.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="developer-mode-chrome" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/developer-mode-chrome-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/developer-mode-chrome.png" decoding="async" class="wp-image-135063 size-full aligncenter jetpack-lazy-image" src="../Images/6a93c5793cc7b52da8d7aaa4b76cbbda.png" alt="Developer mode in chrome" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/developer-mode-chrome.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/developer-mode-chrome-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/developer-mode-chrome.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/developer-mode-chrome.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="135063" data-permalink="https://blog.logrocket.com/build-chrome-extension-plasmo-react/attachment/developer-mode-chrome/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/developer-mode-chrome.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="developer-mode-chrome" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/developer-mode-chrome-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/developer-mode-chrome.png" decoding="async" loading="lazy" class="wp-image-135063 size-full aligncenter" src="../Images/6a93c5793cc7b52da8d7aaa4b76cbbda.png" alt="Developer mode in chrome" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/developer-mode-chrome.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/developer-mode-chrome-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/developer-mode-chrome.png"/></noscript>
<p>(注意:我在这里使用的是勇敢的浏览器，它使用的是Chromium网络浏览器，所以正常的Chrome浏览器的过程也是一样的。</p>
<p>点击Load unpacked并转到您的项目目录，然后选择<code>build/chrome-mv3-dev</code>文件夹。要查看扩展，点击你的扩展部分附近的拼图标志，并选择等离子体项目。</p>
<p>(注意:如果你卡住了，查看等离子体文件<a href="https://docs.plasmo.com/#loading-the-extension-in-chrome" target="_blank" rel="noopener">这里</a></p>
<p>您的扩展现在应该看起来像这样:</p>
<p><img data-attachment-id="135069" data-permalink="https://blog.logrocket.com/build-chrome-extension-plasmo-react/attachment/viewing-extension-plasmo-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/viewing-extension-plasmo-1.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="viewing-extension-plasmo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/viewing-extension-plasmo-1-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/viewing-extension-plasmo-1.png" decoding="async" class="wp-image-135069 size-full aligncenter jetpack-lazy-image" src="../Images/3531fde243aadd01e6a5e912a397dfd3.png" alt="Viewing the extension on Plasmo" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/viewing-extension-plasmo-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/viewing-extension-plasmo-1-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/viewing-extension-plasmo-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/viewing-extension-plasmo-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="135069" data-permalink="https://blog.logrocket.com/build-chrome-extension-plasmo-react/attachment/viewing-extension-plasmo-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/viewing-extension-plasmo-1.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="viewing-extension-plasmo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/viewing-extension-plasmo-1-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/viewing-extension-plasmo-1.png" decoding="async" loading="lazy" class="wp-image-135069 size-full aligncenter" src="../Images/3531fde243aadd01e6a5e912a397dfd3.png" alt="Viewing the extension on Plasmo" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/viewing-extension-plasmo-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/viewing-extension-plasmo-1-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/viewing-extension-plasmo-1.png"/></noscript>
<p>完成后，让我们设置输入任务和显示任务的部分。在<code>main.tsx</code>中，让我们添加一个用于输入任务的<code>input</code>字段和一个用于添加任务的按钮。</p>
<p>首先，添加两个状态—一个用于从文本框中捕获输入，另一个用于跟踪任务。</p>
<pre class="language-javascript hljs">import { useState } from "react";

export function Main ( ) {
  const [data, setData] = useState("");

  const [tasks, setTasks] = useState([]);

  return (
    &lt;Container&gt;
      {...stuff}
    &lt;/Container&gt;
  )
}
</pre>
<p>现在，在<code>Container</code>中，添加以下内容:</p>
<pre class="language-javascript hljs">return (
  &lt;Container&gt;
    &lt;div&gt;
      &lt;input 
        className="rounded-md my-3 p-2 border-2 border-gray-300" 
        onChange={(e) =&gt; setData(e.target.value)} 
        value={data} 
        placeholder="Add new task" 
      /&gt;
    &lt;/div&gt;
  &lt;Container/&gt;
);
</pre>
<p>如果您现在登录<code>data</code>到控制台，您应该能够看到输入数据。</p>
<p>要在Chrome DevTools上检查应用程序，右键单击所需的扩展:</p>
<p><img data-attachment-id="135417" data-permalink="https://blog.logrocket.com/build-chrome-extension-plasmo-react/attachment/inspect-app-chrome-dev-tools/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/inspect-app-chrome-dev-tools.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="inspect-app-chrome-dev-tools" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/inspect-app-chrome-dev-tools-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/inspect-app-chrome-dev-tools.png" decoding="async" class="aligncenter wp-image-135417 size-full jetpack-lazy-image" src="../Images/e0c424797ef1eff15493959b7c93a97b.png" alt="Inspect App Chrome Dev Tools" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/inspect-app-chrome-dev-tools.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/inspect-app-chrome-dev-tools-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/inspect-app-chrome-dev-tools.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/inspect-app-chrome-dev-tools.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="135417" data-permalink="https://blog.logrocket.com/build-chrome-extension-plasmo-react/attachment/inspect-app-chrome-dev-tools/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/inspect-app-chrome-dev-tools.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="inspect-app-chrome-dev-tools" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/inspect-app-chrome-dev-tools-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/inspect-app-chrome-dev-tools.png" decoding="async" loading="lazy" class="aligncenter wp-image-135417 size-full" src="../Images/e0c424797ef1eff15493959b7c93a97b.png" alt="Inspect App Chrome Dev Tools" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/inspect-app-chrome-dev-tools.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/inspect-app-chrome-dev-tools-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/inspect-app-chrome-dev-tools.png"/></noscript>
<p>完成后，让我们添加一个按钮来保存当前任务的状态。</p>
<pre class="language-javascript hljs">&lt;button type="submit" onClick={submitHandler} className="button-blue"&gt;
  Add task
&lt;/button&gt;
</pre>
<p>为<code>onClick</code>事件创建一个新函数:</p>
<pre class="language-javascript hljs">function submitHandler () {
  // ...stuff
  console.log(data);
}
</pre>
<p>现在，我们将简单地将数据的当前值记录到控制台上。</p>
<p>接下来，让我们构建组件来显示任务。制作一个名为<code>Tasks.tsx</code>的新组件。作为道具，传递<code>data</code>和<code>setData</code>——这在显示任务和移除任务时会很有用。</p>
<p>在<code>Tasks.tsx</code>中，现在，让我们只显示一个随机的任务列表。</p>
<pre class="language-javascript hljs">{data?.length !== 0 ? (
  data?.map((task, index) =&gt; (
    &lt;div
      className={...styles}
      key={index}
    &gt;
      &lt;p&gt;{task}&lt;/p&gt;

      &lt;button
        aria-label="Remove task"
        type="button"
        &lt;TrashIcon className="w-10 h-10 pr-1" /&gt;
      &lt;/button&gt;
    &lt;/div&gt;
  ))
  ) : (
  &lt;p className="mx-auto w-fit my-8"&gt;No tasks yet!&lt;/p&gt;
)}
</pre>
<p>(注:要了解风格，请访问GitHub 的<a href="https://github.com/GeoBrodas/plasmo-next" target="_blank" rel="noopener">回购。这里使用的图标来自<code>react-icons</code></a></p>
<p>您可以为任务添加一些虚拟数据，并查看组件是否按预期工作。</p>
<h2 id="writing-logic">编写逻辑</h2>
<p>现在，让我们添加添加和删除任务的基本功能。</p>
<p>首先，让我们研究一下我们之前在按钮上定义的<code>submitHandler</code>。每当用户添加任务时，我们希望保留之前的任务，并清除输入字段。</p>
<pre class="language-javascript hljs">async function submitHandler() {
  setTasks([...tasks, data]);
  setData("");
}
</pre>
<p>现在，在<code>Tasks.tsx</code>中，我们已经传递了两个道具(即<code>data</code>和<code>setTasks</code>函数)。现在，每当您添加任何新任务时，都应该显示这些任务。</p>
<p><img data-attachment-id="135071" data-permalink="https://blog.logrocket.com/build-chrome-extension-plasmo-react/attachment/data-settasks-function-display/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/data-settasks-function-display.gif" data-orig-size="730,400" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="data-settasks-functions-display" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/data-settasks-function-display-300x164.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/data-settasks-function-display.gif" decoding="async" class="wp-image-135071 size-full aligncenter jetpack-lazy-image" src="../Images/467a0926232faacf728180ca86b51508.png" alt="Data and settasks functions display." data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/data-settasks-function-display.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/data-settasks-function-display.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="135071" data-permalink="https://blog.logrocket.com/build-chrome-extension-plasmo-react/attachment/data-settasks-function-display/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/data-settasks-function-display.gif" data-orig-size="730,400" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="data-settasks-functions-display" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/data-settasks-function-display-300x164.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/data-settasks-function-display.gif" decoding="async" loading="lazy" class="wp-image-135071 size-full aligncenter" src="../Images/467a0926232faacf728180ca86b51508.png" alt="Data and settasks functions display." data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/data-settasks-function-display.gif"/></noscript>
<p>剩下的是<code>removeTask</code>函数，它被绑定到每个任务中的垃圾桶图标。</p>
<p>在<code>removeTask</code>功能内:</p>
<pre class="language-javascript hljs">function removeTask () {
  setTasks(
    data.filter(
      (task: string, i: number) =&gt; i !== index
    )
  );
}
</pre>
<p>这段代码主要做的是过滤包含任务的<code>data</code>数组，只返回与要删除的任务的索引不匹配的任务；然后使用<code>setTasks</code>功能设置电流<code>tasks</code>。</p>
<h2 id="adding-local-storage-support">添加本地存储支持</h2>
<p>到目前为止，我们能够输入新任务并查看它们，但是如果您关闭扩展或者热重新加载开发服务器，任务就会消失。最好的解决方案是在扩展中添加本地存储支持。</p>
<p>等离子体为此提供了一个内置的解决方案，称为<code>@plasmohq/storage</code>。使用以下内容安装它:</p>
<pre class="language-bash hljs">npm install @plasmohq/storage
</pre>
<p>如果有任务的话，我们会从<code>localStorage</code>那里取任务。</p>
<pre class="language-javascript hljs">import { Storage } from "@plasmohq/storage";
import { useEffect } from "react";

const storage = new Storage();

export function Main () {
  // ...code

  useEffect(() =&gt; {
     // fetch tasks from the local storage
      storage.get("tasks").then(
        (tasks) =&gt; setTasks(tasks || []),
        // if there are no tasks, set an empty array
        // this usually gets triggered if the method fails or returns an error
        () =&gt; setTasks([])
      )},
    // run once on mount
    []
  );
}
</pre>
<p>在<code>useEffect</code>中，我们使用<code>storage.get()</code>方法检查任何保存的字段，字段为<code>tasks</code>。如果<code>tasks</code>出现，我们设置<code>tasks</code>状态。如果承诺被拒绝，我们甚至可以在这里触发另一个回调，从而将<code>tasks</code>数组设置为空。</p>
<p>完成后，现在我们将在用户单击提交按钮时向本地存储添加一个任务。</p>
<p><code>submitHanlder</code>里面:</p>
<pre class="language-javascript hljs">async function submitHanlder () {
  setTasks([...tasks, data]);
  setData("");

  // save to local storage
  await storage.set("tasks", [...tasks, data]);
}
</pre>
<p>这里，使用<code>storage.set()</code>方法，当前的任务列表被输入到键<code>tasks</code>下的<code>localStorage</code>中。</p>
<p>完成后，扩展现在应该能够持久化任务，即使扩展在开发期间热重新加载，或者扩展被关闭并重新打开。</p>
<p>同样，我们可以使用<code>storage.set()</code>方法来删除特定的任务。</p>
<p>在<code>removeTask()</code>功能中，进行以下更改:</p>
<pre><code>function removeTask(index: number) {
  setTasks(data.filter((task: string, i: number) =&gt; i !== index));

  // remove from local storage
  storage.set(
    "tasks",
    data.filter((task: string, i: number) =&gt; i !== index)
  )
}
</code></pre>
<p>当从<code>localStorage</code>中删除特定任务时，应用我们之前使用的相同逻辑。</p>
<p>(注:要了解更多关于<code>@plasmohq/storage</code>的信息，请访问<a href="https://docs.plasmo.com/framework-api/storage" target="_blank" rel="noopener">等离子体文档</a>)</p>
<p>最后，我们使用React和Plasmo成功构建了一个扩展，可以跟踪您的任务。您可以添加更多自己的新功能，并尝试在Chrome商店发布一个！</p>
<h2 id="conclusion">结论</h2>
<p>Plasmo是一个构建扩展的好框架；尤其是如果您刚刚开始使用React，并且有一些使用React的经验。</p>
<p>我在本文中链接的文档是初学者友好的，包含了开始使用Plasmo所需的几乎所有东西。</p>
<p>Plasmo仍在积极开发中，因此请注意，您可能会遇到bug和其他问题。如果你被困在任何地方，或者对即将到来的版本有任何建议，请确保加入Plasmo的官方<a href="https://www.plasmo.com/s/d" target="_blank" rel="noopener"> Discord </a>服务器，当然也可以在下面的评论区留下你的想法。</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用LogRocket消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款React analytics解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket告诉您React应用程序中实际影响用户的最具影响力的bug和UX问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS异常、前端性能指标和用户交互。然后，LogRocket使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试LogRocket】。</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>