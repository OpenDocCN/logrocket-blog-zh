<html>
<head>
<title>Create a GraphQL API with React and Phoenix 2 </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用React和Phoenix 2创建一个GraphQL API</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/create-graphql-api-react-phoenix-2/#0001-01-01">https://blog.logrocket.com/create-graphql-api-react-phoenix-2/#0001-01-01</a></blockquote><div><article class="article-post">
<p>自21世纪初以来，软件工程师一直使用REST APIs来查询和变异数据。毫无疑问，REST是一种很好的访问资源的方式，但是当涉及到特定性时，REST模型效率不高。</p>
<p>GraphQL是一种新的工具，它使开发人员能够根据特殊性访问资源，从而有效地消耗资源。由于GraphQL提供的灵活性，社区已经开始构建实用程序，以便在他们喜欢的语言中使用GraphQL。</p>
<p>一个这样的例子是Absinthe，它是用Elixir开发的库，Elixir是一种基于Erlang的函数式编程语言。苦艾酒与凤凰网服务器一起使用，凤凰网服务器是用长生不老药构建的，并且越来越受欢迎。</p>
<p>在这篇文章中，我们将使用Phoenix构建我们的第一个GraphQL API，并将其与React应用程序连接。</p>
<h2>先决条件</h2>
<p>要充分利用本教程，您需要:</p>
<ul>
<li>对JavaScript、React和Docker有基本的了解</li>
<li>熟悉Elixir语法</li>
<li>客户端和服务器交互的知识</li>
</ul>
<p>我们将涵盖:</p>

<h2 id="environment-setup">环境设置</h2>
<p>要设置我们的环境，我们需要安装:</p>

<h3 id="installing-elixir">安装药剂</h3>
<p>打开您的终端并运行以下命令:</p>
<pre class="language-bash hljs">$ wget https://packages.erlang-solutions.com/erlang-solutions_2.0_all.deb &amp;&amp; sudo dpkg -i erlang-solutions_2.0_all.deb</pre>
<pre class="language-bash hljs">$ sudo apt-get update</pre>
<pre class="language-bash hljs">$ sudo apt-get install esl-erlang</pre>
<pre class="language-bash hljs">$ sudo apt-get install elixir</pre>
<h3>安装六角头</h3>
<p>运行以下命令:</p>
<pre class="language-bash hljs">$ mix local.hex</pre>
<p>要检查Elixir和Erlang的版本，请运行:</p>
<pre class="language-bash hljs">$ elixir -v
Erlang/OTP 25 [erts-13.0.4] [source] [64-bit] [smp:8:8] [ds:8:8:10] [async-threads:1] [jit:ns]

Elixir 1.13.4 (compiled with Erlang/OTP 25)</pre>
<h3>安装Phoenix应用生成器</h3>
<p>运行以下命令:</p>
<pre class="language-bash hljs">$ mix archive.install hex phx_new</pre>
<h3 id="installing-node-js">安装Node.js</h3>
<p>运行这些命令:</p>
<pre class="language-bash hljs">$ curl -fsSL https://deb.nodesource.com/setup_19.x | sudo -E bash - &amp;&amp;\</pre>
<pre class="language-bash hljs">$ sudo apt-get install -y nodejs</pre>
<p>检查Node.js的版本:</p>
<pre class="language-bash hljs">$ node -v</pre>
<h3 id="installing-docker-docker-compose">安装Docker和Docker合成</h3>
<p>运行以下命令来安装Docker:</p>
<pre class="language-bash hljs">$ sudo apt-get update</pre>
<pre class="language-bash hljs">$ sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg \
    lsb-release</pre>
<pre class="language-bash hljs">$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</pre>
<pre class="language-bash hljs">$ echo \
  "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</pre>
<pre class="language-bash hljs">$ sudo apt-get update</pre>
<pre class="language-bash hljs">$ sudo apt-get install docker-ce docker-ce-cli containerd.io</pre>
<p>运行以下命令安装Docker Compose:</p>
<pre class="language-bash hljs">$ sudo apt install docker-compose</pre>
<h2 id="phoenix-application-setup">Phoenix应用程序设置</h2>
<p>现在，让我们设置Phoenix服务器，并创建可供GraphQL工作区和React应用程序使用的资源。</p>
<p>运行以下命令创建服务器:</p>
<p>$ mix phx.new booklist -no-html</p>
<p>当提示获取和安装依赖项时，输入“Y”。</p>
<p>输出:</p>
<pre class="language-bash hljs">We are almost there! The following steps are missing:

    $ cd booklist

Then configure your database in config/dev.exs and run:

    $ mix ecto.create

Start your Phoenix app with:

    $ mix phx.server

You can also run your app inside IEx (Interactive Elixir) as:

    $ iex -S mix phx.server</pre>
<h3 id="installing-absinthe-absinthe-plug-dependencies">安装苦艾酒和<code>absinthe_plug</code>依赖项</h3>
<p>苦艾酒是为Elixir编写的GraphQL库，用于编写查询和变异。帮助我们使用GraphQL。</p>
<p>在Phoenix中，依赖项必须手动写入mix.ex文件，然后使用deps.get命令安装添加的依赖项。它不像npm或Yarn那样工作。</p>
<p>要安装absincet和absinthe _ plug，请在您喜欢的代码编辑器中打开您的项目，并在项目目录的根目录中，更新mix.ex文件，如下所示:</p>
<pre class="language-elixir hljs"># mix.ex
Defp deps do
[
...
{:absinthe, "~&gt; 1.7"}
{:absinthe_plug, "~&gt; 1.5"}
]
end</pre>
<p>现在，运行以下命令来安装依赖项:</p>
<pre class="language-bash hljs">$ mix deps.get</pre>
<p>这就是我们的终端现在的样子:</p>
<pre class="language-plaintext hljs">Resolving Hex dependencies...
Dependency resolution completed:
Unchanged:
  castore 0.1.18
  connection 1.1.0
  cowboy 2.9.0
  cowboy_telemetry 0.4.0
  cowlib 2.11.0
  db_connection 2.4.2
  decimal 2.0.0
  ecto 3.9.1
  ecto_sql 3.9.0
  esbuild 0.5.0
  gettext 0.20.0
  jason 1.4.0
  mime 2.0.3
  phoenix 1.6.14
  phoenix_ecto 4.4.0
  phoenix_html 3.2.0
  phoenix_live_dashboard 0.7.1
  phoenix_live_view 0.18.2
  phoenix_pubsub 2.1.1
  phoenix_view 1.1.2
  plug 1.13.6
  plug_cowboy 2.5.2
  plug_crypto 1.2.3
  postgrex 0.16.5
  ranch 1.8.0
  swoosh 1.8.1
  telemetry 1.1.0
  telemetry_metrics 0.6.1
  telemetry_poller 1.0.0
New:
  absinthe 1.7.0
  absinthe_plug 1.5.8
  nimble_parsec 1.2.3
* Getting absinthe (Hex package)
* Getting absinthe_plug (Hex package)
* Getting nimble_parsec (Hex package)</pre>
<h3 id="adminer-postgresql-docker-compose">使用docker-compose启动Adminer和PostgreSQL</h3>
<p>现在我们将旋转两个码头集装箱。一个将运行我们的PostgreSQL数据库，一个可以与Phoenix一起使用的关系数据库，另一个将运行Adminer，一个全功能的数据库管理工具。</p>
<p>在项目的根目录中，使用以下命令创建一个文件:</p>
<pre class="language-bash hljs">$ touch docker-compose.yaml</pre>
<p>您也可以使用代码编辑器的用户界面来创建它。你的选择！</p>
<p>现在，将这段代码粘贴到您的<code>docker-compose</code>文件中:</p>
<pre class="language-docker hljs">version: "3"
services:
  postgres:
    build: ./postgres-dev
    container_name: postgres
    ports:
      - 5432:5432
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB_LIST: booklist_dev

  adminer:
    image: adminer
    container_name: adminer
    restart: always
    ports:
      - 8090:8080
    environment:
      ADMINER_DEFAULT_SERVER: postgres</pre>
<p>在根目录下创建一个名为<code>postgres-dev</code>的文件夹，并创建一个Dockerfile和一个Bash文件，如下所示:</p>
<pre class="language-bash hljs">$ mkdir postgres-dev</pre>
<pre class="language-bash hljs">$ cd postgres-dev</pre>
<pre class="language-bash hljs">$ touch Dockerfile</pre>
<p>在docker文件中，粘贴以下代码:</p>
<pre class="language-docker hljs">FROM postgres:latest
COPY setup-databases.sh /docker-entrypoint-initdb.d/</pre>
<p>现在，在同一文件夹中创建一个新文件:</p>
<pre class="language-bash hljs">$ touch setup-databases.sh</pre>
<p>在Bash文件中，粘贴以下代码:</p>
<pre class="language-bash hljs">#!/bin/bash

set -e
set -u

function create_user_and_database() {
    local DB=$1
    echo "  Creating user and database '$DB'"
    psql -v --username "$POSTGRES_USER" &lt;&lt;-EOSQL
        CREATE DATABASE $DB;
        GRANT ALL PRIVILEGES ON DATABASE $DB TO $POSTGRES_USER;
EOSQL
}

if [ -n "$POSTGRES_DB_LIST" ]; then
    echo "Multiple database creation requested: $POSTGRES_DB_LIST"
    for DB in $(echo $POSTGRES_DB_LIST | tr ',' ' '); do
        create_user_and_database $DB
    done
    echo "Multiple databases created"
fi</pre>
<p>现在，从终端返回到您的根目录并运行以下代码:</p>
<pre class="language-bash hljs">$ docker-compose up -d -build</pre>
<p>要检查我们的容器是否运行，请编写以下代码:</p>
<pre class="language-bash hljs">$ docker ps</pre>
<p>我们的输出应该是:</p>
<pre class="language-bash hljs">CONTAINER ID   IMAGE      COMMAND                  CREATED          STATUS          PORTS                                       NAMES
d6831a68a985   adminer    "entrypoint.sh docke..."   13 seconds ago   Up 12 seconds   0.0.0.0:8090-&gt;8080/tcp, :::8090-&gt;8080/tcp   adminer
dca9812e757a   postgres   "docker-entrypoint.s..."   13 seconds ago   Up 12 seconds   0.0.0.0:5432-&gt;5432/tcp, :::5432-&gt;5432/tcp   postgres</pre>
<h3 id="schema-absinthe">为苦艾酒创建模式</h3>
<p>模式是用执行查询的相同过程构建的蓝图。</p>
<p>GraphQL Workspace是一个与GraphQL打包在一起的工具，用于查询和变异数据。该工具是一个用户界面，可以从浏览器访问。</p>
<p>现在，我们将使用在我们的模式中硬编码的测试数据，这将帮助我们理解GraphQL是如何工作的。成功查询样本数据后，我们将使用PostgreSQL。</p>
<p>在lib/booklist_web/中创建一个名为schema.ex的文件。将以下代码复制并粘贴到文件中。</p>
<pre class="language-elixir hljs">defmodule BooklistWeb.Schema do
  use Absinthe.Schema

  @desc "A Book"
    object :book do
      field :name, :string
      field :author, :string
 
    end

  # Example data
  @book_information %{
    "book1" =&gt; %{id: 1, name: "Harry Potter", author: "JK Rowling"},
    "book2" =&gt; %{id: 2, name: "Charlie Factory", author: "Bernard"},
    "book3" =&gt; %{id: 3, name: "Sherlock Holmes", author: "Sheikhu"}
  }

  query do
    field :book_info, :book do
      arg :id, non_null(:id)
      resolve fn %{id: book_id}, _ -&gt;
        {:ok, @book_information[book_id]}
      end
    end
  end
 end</pre>
<p>以下是我们上面使用的代码的一些重要定义:</p>
<ul>
<li><code>query</code>:是根查询对象宏，其中不同的查询作为字段被拒绝</li>
<li><code>field</code>:封装对象中的字段，这里是查询和对象</li>
<li><code>arg</code>:封闭字段的参数</li>
<li><code>resolve</code>:执行我们的查询逻辑的函数我们创建了一个对象<code>book</code>的结构和包含图书信息的测试数据。查询块是一个GraphQL查询，它将在我们的GraphQL工作区中获取这些数据。</li>
</ul>
<h3 id="context-book-information">为<code>Book</code>信息创建上下文</h3>
<p>上下文是具有业务逻辑并封装数据访问及其验证的模块。它通常与数据库或API对话。<br/>要为我们的图书模式创建上下文，打开您的终端并运行以下命令:</p>
<pre class="language-bash hljs">$ mix phx.gen.context Book Info information name:string author:string</pre>
<p>输出应该是:</p>
<pre class="language-bash hljs">==&gt; nimble_parsec
Compiling 4 files (.ex)
Generated nimble_parsec app
==&gt; absinthe
Compiling 1 file (.erl)
Compiling 256 files (.ex)
Generated absinthe app
==&gt; absinthe_plug
Compiling 18 files (.ex)
Generated absinthe_plug app
==&gt; booklist
* creating lib/booklist/book/info.ex
* creating priv/repo/migrations/20221022130430_create_information.exs
* creating lib/booklist/book.ex
* injecting lib/booklist/book.ex
* creating test/booklist/book_test.exs
* injecting test/booklist/book_test.exs
* creating test/support/fixtures/book_fixtures.ex
* injecting test/support/fixtures/book_fixtures.ex

Remember to update your repository by running migrations:

    $ mix ecto.migrate</pre>
<h3 id="running-migrations">运行迁移</h3>
<p>迁移是填充到关系数据库中的数据库模式/结构。在本节中，我们将运行一个迁移，在我们的<code>booklist_dev</code>数据库中创建一个名为<code>information</code>的表。我们将从管理员那里查看它。</p>
<p>我们还将使用官方的Elixir项目<a href="https://hexdocs.pm/ecto/Ecto.html"> Ecto </a>，它是一种集成的查询语言，提供了数据库包装器。</p>
<p>运行以下命令:</p>
<pre class="language-bash hljs">$ mix ecto.migrate</pre>
<p>我们的输出应该是:</p>
<pre class="language-plaintext hljs">warning: the :gettext compiler is no longer required in your mix.exs.

Please find the following line in your mix.exs and remove the :gettext entry:

    compilers: [..., :gettext, ...] ++ Mix.compilers(),

  (gettext 0.20.0) lib/mix/tasks/compile.gettext.ex:5: Mix.Tasks.Compile.Gettext.run/1
  (mix 1.13.4) lib/mix/task.ex:397: anonymous fn/3 in Mix.Task.run_task/3
  (mix 1.13.4) lib/mix/tasks/compile.all.ex:92: Mix.Tasks.Compile.All.run_compiler/2
  (mix 1.13.4) lib/mix/tasks/compile.all.ex:72: Mix.Tasks.Compile.All.compile/4
  (mix 1.13.4) lib/mix/tasks/compile.all.ex:59: Mix.Tasks.Compile.All.with_logger_app/2
  (mix 1.13.4) lib/mix/tasks/compile.all.ex:36: Mix.Tasks.Compile.All.run/1


18:10:08.705 [info]  == Running 20221022130430 Booklist.Repo.Migrations.CreateInformation.change/0 forward

18:10:08.708 [info]  create table information

18:10:08.713 [info]  == Migrated 20221022130430 in 0.0s</pre>
<p>下面，您可以在管理员用户界面中看到这个输出:</p>
<p><img data-attachment-id="140780" data-permalink="https://blog.logrocket.com/create-graphql-api-react-phoenix-2/attachment/adminer-ui-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/adminer-ui-output.png" data-orig-size="730,350" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="adminer-ui-output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/adminer-ui-output-300x144.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/adminer-ui-output.png" decoding="async" class="aligncenter wp-image-140780 size-full jetpack-lazy-image" src="../Images/78fda8e8c5fc4f4ddb19b4e340c970b6.png" alt="Adminer UI output " data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/adminer-ui-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/adminer-ui-output-300x144.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/adminer-ui-output.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/adminer-ui-output.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="140780" data-permalink="https://blog.logrocket.com/create-graphql-api-react-phoenix-2/attachment/adminer-ui-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/adminer-ui-output.png" data-orig-size="730,350" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="adminer-ui-output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/adminer-ui-output-300x144.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/adminer-ui-output.png" decoding="async" loading="lazy" class="aligncenter wp-image-140780 size-full" src="../Images/78fda8e8c5fc4f4ddb19b4e340c970b6.png" alt="Adminer UI output " srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/adminer-ui-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/adminer-ui-output-300x144.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/adminer-ui-output.png"/></noscript>
<p>有一个名为<code>information</code>的表，它是由我们在上一步中运行的迁移创建的。要访问Adminer界面，请在浏览器中输入以下地址，并使用我们在Docker合成文件中使用的凭据:</p>

<p>运行以下命令启动您的服务器:</p>
<pre class="language-bash hljs">$ mix phx.server</pre>
<p>在服务器启动后，我们可以点击端口4000上的<code>localhost</code>来使用GraphQL工作空间。</p>
<p><img data-attachment-id="140782" data-permalink="https://blog.logrocket.com/create-graphql-api-react-phoenix-2/attachment/phoenix-endpoints/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/phoenix-endpoints.png" data-orig-size="730,375" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="phoenix-endpoints" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/phoenix-endpoints-300x154.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/phoenix-endpoints.png" decoding="async" class="aligncenter wp-image-140782 size-full jetpack-lazy-image" src="../Images/d14c6ed76ce1c0f6a98b75958b361e49.png" alt="Phoenix endpoints" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/phoenix-endpoints.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/phoenix-endpoints-300x154.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/phoenix-endpoints.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/phoenix-endpoints.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="140782" data-permalink="https://blog.logrocket.com/create-graphql-api-react-phoenix-2/attachment/phoenix-endpoints/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/phoenix-endpoints.png" data-orig-size="730,375" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="phoenix-endpoints" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/phoenix-endpoints-300x154.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/phoenix-endpoints.png" decoding="async" loading="lazy" class="aligncenter wp-image-140782 size-full" src="../Images/d14c6ed76ce1c0f6a98b75958b361e49.png" alt="Phoenix endpoints" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/phoenix-endpoints.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/phoenix-endpoints-300x154.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/phoenix-endpoints.png"/></noscript>
<p>Phoenix将向您展示一些您可以点击的端点，并通过用户界面探索各种可用的功能。</p>
<h2 id="route-configuration-graphql-testing">路由配置和GraphQL测试</h2>
<p>要从GraphQL的用户界面和API访问它，我们必须配置适当的路由。本节将告诉您如何正确配置路由。</p>
<h3 id="configuring-routes-access-graphiql-ui-api">配置路由以访问图形用户界面和API</h3>
<p>为了进行查询和改变数据，我们需要在/lib/booklist_web/中的router.ex文件中添加路由。</p>
<p>打开router.ex文件，添加以下代码行:</p>
<pre class="language-elixir hljs">scope "/api" do
    pipe_through :api
    forward("/",Absinthe.Plug, schema: MenuxcardWeb.Schema)
  end


scope "/gql" do
    forward "/GraphiQL", Absinthe.Plug.GraphiQL, schema: MenuxcardWeb.Schema
  end</pre>
<p>我们现在可以使用第二条路线访问GraphQL web界面。在您的地址栏中输入以下URL:<br/><code><a href="http://localhost:4000/gql/GraphiQL" rel="nofollow">http://localhost:4000/gql/GraphiQL</a></code><br/>您现在应该会看到:</p>
<p><img data-attachment-id="140786" data-permalink="https://blog.logrocket.com/create-graphql-api-react-phoenix-2/attachment/graph-ql-second-route/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/graph-ql-second-route.png" data-orig-size="730,374" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graph-ql-second-route" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/graph-ql-second-route-300x154.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/graph-ql-second-route.png" decoding="async" class="aligncenter wp-image-140786 size-full jetpack-lazy-image" src="../Images/5dedd8fa0403d6a8352a9bf36ba5177c.png" alt="GraphQL second route" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/graph-ql-second-route.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/graph-ql-second-route-300x154.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/graph-ql-second-route.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/graph-ql-second-route.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="140786" data-permalink="https://blog.logrocket.com/create-graphql-api-react-phoenix-2/attachment/graph-ql-second-route/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/graph-ql-second-route.png" data-orig-size="730,374" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graph-ql-second-route" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/graph-ql-second-route-300x154.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/graph-ql-second-route.png" decoding="async" loading="lazy" class="aligncenter wp-image-140786 size-full" src="../Images/5dedd8fa0403d6a8352a9bf36ba5177c.png" alt="GraphQL second route" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/graph-ql-second-route.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/graph-ql-second-route-300x154.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/graph-ql-second-route.png"/></noscript>
<p>这是GraphQL工作区，它为GraphQL提取和变更数据，就像Postman为REST APIs所做的那样。首先，我们将查询我们在前面的步骤中在模式中硬编码的虚拟数据。</p>
<h3 id="testing-graphiql-ui-querying-sample-data">测试使用示例数据进行查询的GraphiQL UI</h3>
<p>我们将从虚拟数据中查询<code>book1</code>,并从服务器中获取它的名称和作者。</p>
<p>在GraphQL界面的左侧面板中运行以下查询:</p>
<pre class="language-graphql hljs">query{
  bookInfo(id: "book1"){
    name
    author
  }
}</pre>
<p>您将收到以下数据作为回报:</p>
<pre class="language-graphql hljs">{
  "data": {
    "bookInfo": {
      "author": "JK Rowling",
      "name": "Harry Potter"
    }
  }
}</pre>
<p>以下是GraphiQL中的输出:</p>
<p><img data-attachment-id="140788" data-permalink="https://blog.logrocket.com/create-graphql-api-react-phoenix-2/attachment/graphiql-query-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/graphiql-query-output.png" data-orig-size="730,353" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphiql-query-output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/graphiql-query-output-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/graphiql-query-output.png" decoding="async" class="aligncenter wp-image-140788 size-full jetpack-lazy-image" src="../Images/a675fab76406560fd8e7b714550852e1.png" alt="Query output on GraphiQL" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/graphiql-query-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/graphiql-query-output-300x145.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/graphiql-query-output.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/graphiql-query-output.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="140788" data-permalink="https://blog.logrocket.com/create-graphql-api-react-phoenix-2/attachment/graphiql-query-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/graphiql-query-output.png" data-orig-size="730,353" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="graphiql-query-output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/graphiql-query-output-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/graphiql-query-output.png" decoding="async" loading="lazy" class="aligncenter wp-image-140788 size-full" src="../Images/a675fab76406560fd8e7b714550852e1.png" alt="Query output on GraphiQL" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/graphiql-query-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/graphiql-query-output-300x145.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/graphiql-query-output.png"/></noscript>
<h3 id="data-querying-mutation-postgresql-graphiql-ui">使用图形用户界面使用PostgreSQL进行数据查询和变异</h3>
<p>到目前为止，我们一直在玩虚拟数据。现在真正的乐趣开始了！</p>
<p>我们将直接从PostgreSQL数据库中查询数据并对其进行变异，并检查即时变化。</p>
<p><img data-attachment-id="140791" data-permalink="https://blog.logrocket.com/create-graphql-api-react-phoenix-2/attachment/postgresql-database/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/postgresql-database.png" data-orig-size="730,406" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="postgresql-database" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/postgresql-database-300x167.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/postgresql-database.png" decoding="async" class="aligncenter wp-image-140791 size-full jetpack-lazy-image" src="../Images/c4b95fbed06d3900a3dbc70a434d3a40.png" alt="PostgreSQL database" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/postgresql-database.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/postgresql-database-300x167.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/postgresql-database.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/postgresql-database.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="140791" data-permalink="https://blog.logrocket.com/create-graphql-api-react-phoenix-2/attachment/postgresql-database/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/postgresql-database.png" data-orig-size="730,406" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="postgresql-database" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/postgresql-database-300x167.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/postgresql-database.png" decoding="async" loading="lazy" class="aligncenter wp-image-140791 size-full" src="../Images/c4b95fbed06d3900a3dbc70a434d3a40.png" alt="PostgreSQL database" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/postgresql-database.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/postgresql-database-300x167.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/postgresql-database.png"/></noscript>
<p>信息表是空的。让我们通过变异来填充它。首先，我们将在schema.ex文件中创建一个变异和查询。</p>
<p>清除我们在模式文件中编写的查询，并粘贴以下代码:</p>
<pre class="language-elixir hljs">query do
    field :get_book, :book do
      arg(:id, non_null(:id))
      resolve(fn args, _ -&gt;
        {:ok, Booklist.Book.get_info!(args)}
      end)
    end
  end

  mutation do
    field :create_book, :book do
      arg(:name, non_null(:string))
      arg(:author, non_null(:string))
      resolve(fn args, _ -&gt;
        {:ok, Booklist.Book.create_info(args)}
      end)
    end
  end</pre>
<p>将这种变化粘贴到GraphiQL接口中，并运行它来看看神奇之处。</p>
<pre class="language-graphql hljs">mutation{
  createBook(name: "The Sunshine", author: "Nofel"){
   name
   author
  }
}</pre>
<p>检查数据库是否有更改:</p>
<p><img data-attachment-id="140793" data-permalink="https://blog.logrocket.com/create-graphql-api-react-phoenix-2/attachment/database-changes/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/database-changes.png" data-orig-size="730,520" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="database-changes" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/database-changes-300x214.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/database-changes.png" decoding="async" class="aligncenter wp-image-140793 size-full jetpack-lazy-image" src="../Images/9741edcb13b16ff92f0019e40b2a719f.png" alt="Database changes" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/database-changes.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/database-changes-300x214.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/database-changes.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/database-changes.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="140793" data-permalink="https://blog.logrocket.com/create-graphql-api-react-phoenix-2/attachment/database-changes/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/database-changes.png" data-orig-size="730,520" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="database-changes" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/database-changes-300x214.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/database-changes.png" decoding="async" loading="lazy" class="aligncenter wp-image-140793 size-full" src="../Images/9741edcb13b16ff92f0019e40b2a719f.png" alt="Database changes" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/database-changes.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/database-changes-300x214.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/database-changes.png"/></noscript>
<p>我们的更改已经插入到我们的数据库表中。万岁！</p>
<p>现在，为了查询这些数据，我们将在浏览器界面中使用以下查询。</p>
<pre class="language-graphql hljs">query{
  getBook(name: "The Sunshine"){
    author
  }
}</pre>
<p>以下是输出:</p>
<p><img data-attachment-id="140795" data-permalink="https://blog.logrocket.com/create-graphql-api-react-phoenix-2/attachment/database-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/database-output.png" data-orig-size="730,257" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="database-output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/database-output-300x106.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/database-output.png" decoding="async" class="aligncenter wp-image-140795 size-full jetpack-lazy-image" src="../Images/97afe66c8f9c23b64cbbc6be85aa989e.png" alt="Database output" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/database-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/database-output-300x106.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/database-output.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/database-output.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="140795" data-permalink="https://blog.logrocket.com/create-graphql-api-react-phoenix-2/attachment/database-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/database-output.png" data-orig-size="730,257" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="database-output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/database-output-300x106.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/database-output.png" decoding="async" loading="lazy" class="aligncenter wp-image-140795 size-full" src="../Images/97afe66c8f9c23b64cbbc6be85aa989e.png" alt="Database output" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/database-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/database-output-300x106.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/database-output.png"/></noscript>
<p>到目前为止，我们已经配置了我们的环境，设置了一个Phoenix web服务器，并使用样本数据和PostgreSQL数据进行了几次查询和修改。</p>
<p>在下一节中，我们将创建我们的React前端，并将其连接到我们的GraphQL服务器。</p>
<h3 id="creating-react-project">创建React项目</h3>
<p>在本节中，我们将创建一个带有图书列表组件的React应用程序，该应用程序将使用React的GraphQL库<a href="https://blog.logrocket.com/graphql-local-state-management-apollo/"> Apollo </a>从PostgreSQL获取数据。</p>
<p>要创建React项目，请打开您的终端并运行以下命令:</p>
<pre class="language-bash hljs">$ npx create-react-app my-gql-project</pre>
<p>我已经将我的项目命名为<code>my-gql-project</code>。你可以随意命名。</p>
<h3 id="installing-dependencies">安装依赖项</h3>
<p>使用Apollo客户端的应用程序需要两个依赖项:</p>
<ol>
<li>这个包包含了我们的应用程序设置Apollo客户端的access GraphQL API所需的一切，比如本地状态管理、错误处理、内存缓存和一个React视图层</li>
<li>GraphQL:这个包处理查询解析逻辑</li>
</ol>
<p>运行此命令安装这些软件包:</p>
<pre class="language-bash hljs">$ yarn install @apollo/client GraphQL</pre>
<h3 id="apollo-connect-graphql-api-server">使用Apollo连接到我们的GraphQL API服务器</h3>
<p>我们现在可以初始化阿波罗客户端。转到<code>src/index.js</code>并导入以下内容，或者复制并粘贴以下代码:</p>
<pre class="language-javascript hljs">import { ApolloClient, InMemoryCache, ApolloProvider, gql } from '@apollo/client';</pre>
<p>导入必要的符号后，我们将初始化我们的Apollo客户机，将一组配置传递给它的构造函数对象。</p>
<pre class="language-javascript hljs">const client = new ApolloClient({
  uri: 'http://localhost:4000/api/GraphiQL',
  cache: new InMemoryCache(),});</pre>
<p>万岁！我们的客户机已经准备好连接我们在Phoenix服务器上配置的GraphQL API。</p>
<h2>连接您的客户以做出反应</h2>
<p>为了将React应用程序连接到Apollo客户端，我们需要用一个<code>&lt;ApolloProvider&gt;</code>组件包装React应用程序。该组件将Apollo客户机放在允许从组件树中的任何位置访问它的上下文中。</p>
<pre class="language-javascript hljs">import React from 'react';
import * as ReactDOM from 'react-dom/client';
import { ApolloClient, InMemoryCache, ApolloProvider } from '@apollo/client';
import App from './App';

const client = new ApolloClient({
  uri: 'http://localhost:4000/api/GraphiQL',
  cache: new InMemoryCache(),
});

// Supported in React 18+
const root = ReactDOM.createRoot(document.getElementById('root'));

root.render(
  &lt;ApolloProvider client={client}&gt;
    &lt;App /&gt;
  &lt;/ApolloProvider&gt;
);</pre>
<h2>使用<code>useQuery</code>进行数据查询</h2>
<p>既然ApolloProvider被钩住了，我们可以开始使用<code>useQuery</code>请求数据。<code>useQuery</code>是一个与前端和UI共享GraphQL数据的React钩子。</p>
<p>切换到<code>App.js</code>，用以下代码替换现有代码:</p>
<pre class="language-javascript hljs">import { useQuery, gql } from "@apollo/client";

const GET_BOOKS = gql`
  query {
    getBook(name: "The Sunshine") {
      name
      author
    }
  }
`;</pre>
<p>我们已经在一个<code>gql</code>模板文本中定义了查询。这将获取我们需要在我们的前端应用程序的每个页面重新加载查询的数据。</p>
<p>接下来，我们将定义一个名为<code>DisplayBookList</code>的组件，它将使用<code>useQuery</code>钩子执行我们的<code>GET_BOOKS</code>查询。</p>
<pre class="language-javascript hljs">  const { loading, error, data } = useQuery(GET_BOOKS);
  if (loading) return &lt;p&gt;Loading...&lt;/p&gt;;
  if (error) return &lt;p&gt;Error :(&lt;/p&gt;;
  return data.locations.map(({ name, author }) =&gt; (
    &lt;div key={name}&gt;
      &lt;h3&gt;{name}&lt;/h3&gt;
      &lt;br /&gt;
      &lt;b&gt;About this Book:&lt;/b&gt;
      &lt;p&gt;Author: {author}&lt;/p&gt;
      &lt;br /&gt;
    &lt;/div&gt;
  ));</pre>
<p>最后，我们将把<code>DisplayBookList</code>组件添加到我们现有的组件树中:</p>
<pre class="language-javascript hljs">export default function App() {
  return (
    &lt;div&gt;
      &lt;h2&gt;My first Apollo app 🚀&lt;/h2&gt;
      &lt;DisplayBookList /&gt;
    &lt;/div&gt;
  );
}</pre>
<p>我们最终的<code>App.js</code>看起来会像这样:</p>
<pre class="language-javascript">import logo from "./logo.svg";
import "./App.css";
// Import everything needed to use the `useQuery` hook
import { useQuery, gql } from "@apollo/client";

const GET_BOOKS = gql`
  query {
    getBook(id: "1") {
      name
      author
    }
  }
`;

function DisplayBookList() {
  const { loading, error, data } = useQuery(GET_BOOKS);
  if (loading) return &lt;p&gt;Loading...&lt;/p&gt;;
  if (error) return &lt;p&gt;Error :(&lt;/p&gt;;
  return data.locations.map(({ name, author }) =&gt; (
    &lt;div key={name}&gt;
      &lt;h3&gt;{name}&lt;/h3&gt;
      &lt;br /&gt;
      &lt;b&gt;About this Book:&lt;/b&gt;
      &lt;p&gt;{author}&lt;/p&gt;
      &lt;br /&gt;
    &lt;/div&gt;
  ));
  
  export default function App() {
  return (
    &lt;div&gt;
      &lt;h2&gt;My first Apollo app 🚀&lt;/h2&gt;
      &lt;DisplayBookList /&gt;
    &lt;/div&gt;
  );
}</pre>
<p>现在我们的代码已经准备好了，让我们启动React应用程序，看看神奇的事情发生了。</p>
<p>运行:</p>
<pre class="language-bash hljs">$ yarn start</pre>
<p>打开浏览器，转到<code><a href="http://localhost:3000">http://localhost:3000</a></code>查看输出。</p>
<p><img data-attachment-id="140798" data-permalink="https://blog.logrocket.com/create-graphql-api-react-phoenix-2/attachment/react-app-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/react-app-output.png" data-orig-size="730,649" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="react-app-output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/react-app-output-300x267.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/react-app-output.png" decoding="async" class="aligncenter wp-image-140798 size-full jetpack-lazy-image" src="../Images/0f1736c8d69732026c7948ac3355110d.png" alt="React app output" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/react-app-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/react-app-output-300x267.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/react-app-output.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/react-app-output.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="140798" data-permalink="https://blog.logrocket.com/create-graphql-api-react-phoenix-2/attachment/react-app-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/react-app-output.png" data-orig-size="730,649" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="react-app-output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/react-app-output-300x267.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/react-app-output.png" decoding="async" loading="lazy" class="aligncenter wp-image-140798 size-full" src="../Images/0f1736c8d69732026c7948ac3355110d.png" alt="React app output" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/react-app-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/react-app-output-300x267.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/react-app-output.png"/></noscript>
<p>如您所见，我们的React应用程序成功地从设置了GraphQL的Phoenix服务器上查询了数据。</p>
<h2>结论</h2>
<p>在本教程中，我们学习了如何使用React和Phoenix创建一个GraphQL API，使用模式和上下文来构建我们的业务逻辑。我们还学习了如何使用Docker来立即启动PostgreSQL和Adminer，而无需在我们的操作系统上安装除Docker之外的任何东西。最后，我们使用Apollo客户机连接到托管GraphQL的Phoenix服务器并从中获取数据。</p>
<p>要进一步探索灵药，请访问<a href="https://elixir-lang.org/">灵药主页</a>或访问他们的<a href="https://elixir-lang.org/docs.html">文档页面</a>。</p>
<p>祝你学习顺利！😇</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720"><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener"> LogRocket </a>:全面了解您的生产React应用</h2><p>调试React应用程序可能很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪Redux状态、自动显示JavaScript错误以及跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" vwo-el-id="19356441070">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<p vwo-el-id="28675660440" class="">LogRocket 结合了会话回放、产品分析和错误跟踪，使软件团队能够创建理想的web和移动产品体验。这对你来说意味着什么？</p>
<p>LogRocket不是猜测错误发生的原因，也不是要求用户提供截图和日志转储，而是让您回放问题，就像它们发生在您自己的浏览器中一样，以快速了解哪里出错了。</p>
<p>不再有嘈杂的警报。智能错误跟踪允许您对问题进行分类，然后从中学习。获得有影响的用户问题的通知，而不是误报。警报越少，有用的信号越多。</p>
<p vwo-el-id="28675660750">LogRocket Redux中间件包为您的用户会话增加了一层额外的可见性。LogRocket记录Redux存储中的所有操作和状态。</p>
<p vwo-el-id="28675661060">现代化您调试React应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">开始免费监控</a>。</p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>