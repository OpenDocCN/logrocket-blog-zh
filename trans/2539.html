<html>
<head>
<title>react-tracking: Declarative tracking for React apps - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>React-tracking:React 应用程序的声明式跟踪</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/react-tracking-declarative-tracking-react-apps/#0001-01-01">https://blog.logrocket.com/react-tracking-declarative-tracking-react-apps/#0001-01-01</a></blockquote><div><article class="article-post">
<p>在你的网页上追踪用户有很多好处。例如，跟踪提供了对用户如何与您的网页交互的洞察，指示您的 UI 的哪些组件是最常用的和最不常用的。</p>
<p>声明性跟踪是一种跟踪用户在网页上的交互的方法。传统上，我们使用 DOM 来跟踪所有的用户交互，然而，基于组件的框架的发展使我们能够在应用程序中使用基于组件的跟踪。</p>
<p>React 中用于声明性跟踪的一个库是<a href="https://github.com/NYTimes/react-tracking"> react-tracking </a>，它实现了对页面每个组件的跟踪。您可以使用钩子和装饰器来声明对像点击事件、状态、功能组件、类组件等<a href="https://blog.logrocket.com/react-pure-components-functional/#functionalcomponentsvsclasscomponents">事件的跟踪。此外，您可以将跟踪问题划分到单个组件，避免在整个应用程序中泄漏。</a></p>
<p>在本文中，我们将使用 react-tracking 库来研究声明性跟踪。要阅读本文，您应该熟悉 React 和 React 挂钩。我们开始吧！</p>
<h2>反应追踪是如何工作的？</h2>
<p>我们可以把反应跟踪分解成三个主要部分。例如，<code>trigger</code>启动跟踪过程，并且可以是<code>click</code>事件、<code>loading</code>事件等。本质上，<code>trigger</code>是用户与应用中元素的交互。</p>
<p><code>component</code>是我们正在跟踪的组件。通常情况下，<code>component</code>指表格、卡片等。您可以跟踪功能组件和基于类的组件。所有的跟踪数据都将被包装在<code>dispatch</code>组件中，并在被触发时显示在控制台中。如果不定义<code>dispatch</code>组件，跟踪数据将被推送到<code>window.dataLayer[]</code>，这对 Google Analytics 来说非常理想。</p>
<p>有了这三个组件，我们可以使用反应跟踪来跟踪应用程序中的任何组件。让我们通过一个例子来看看它是如何工作的。</p>
<h2>反应跟踪示例:跟踪<code>click</code>按钮</h2>
<p>作为一个例子，我们将使用一个<code>click</code>按钮来跟踪一个功能组件和一个类组件。</p>
<p>首先，让我们设置开始使用反应跟踪所需的环境。我们将使用 VS Code 作为我们的代码编辑器，它功能强大，包含帮助您编写更好代码的扩展。如果您熟悉不同的代码编辑器，请随意使用它。</p>
<h3>设置 React</h3>
<p>要安装 react-tracking，我们首先需要安装 react。我们将创建一个小程序来跟踪函数和类组件中的<code>button click</code>事件。<code>class</code>按钮还会跟踪点击次数。</p>
<p>首先，我们将按如下方式安装 React:</p>
<pre class="language-bash hljs">npm init react-app my-app
</pre>
<p>安装了 react 之后，我们可以安装 React 跟踪库。运行下面的命令:</p>
<pre class="language-bash hljs">npm install --save react-tracking
</pre>
<p>安装了 React 和 react-tracking 之后，我们将开始编写代码。</p>
<h3>react-跟踪进口</h3>
<p>我们需要从 react-tracking 导入以下元素:</p>
<ul>
<li><code>React</code></li>
<li><code>useTracking</code>:用作钩子来跟踪任何事件</li>
<li><code>track</code>:用<code>@</code>装饰器跟踪<code>class</code>和<code>member</code>功能，并将所有跟踪数据发送到控制台</li>
</ul>
<p>使用下面的命令导入上面的项目:</p>
<pre class="language-react hljs">import track, { useTracking } from "react-tracking";
import React from "react";
</pre>
<h2>功能成分</h2>
<p>该功能组件将包含<code>useTracking()</code>钩子，用于跟踪<code>click</code> <code>button</code>事件。<code>useTracking()</code>然后将按钮点击数据调度到控制台。</p>
<p>下面，我们有一个包含<code>trackEvent</code>的按钮的<code>onClick</code>事件函数。在这里，您可以传递希望在控制台中显示的消息，我们将在稍后添加:</p>
<pre class="language-javascript hljs">const HookButton = () =&gt; {
  const {trackEvent} = useTracking()
  return (
    &lt;div&gt;
      &lt;h2&gt;Click for HookButton&lt;/h2&gt;
      &lt;button onClick={()=&gt; trackEvent({funComponent:'HookButton', event: "HookButton-Clicked"})}&gt;Click Me!&lt;/button&gt;
    &lt;/div&gt;
  );
}
</pre>
<h2><code>class</code>组件</h2>
<p>在<code>class</code>组件中，我们将跟踪<code>button click</code>事件以及点击次数。为了跟踪<code>class</code>组件，我们将使用<code>track</code>，后跟我们将设置的消息。</p>
<p>在<code>class</code>中，我们有一个统计点击次数的状态。作为回报，我们用链接到<code>handleClick</code>函数的<code>click</code>事件呈现了一个按钮。</p>
<p>我们还用<code>track</code>跟踪了这个类的成员函数。我们有一个以状态为道具的箭头函数来传递<code>numClicked</code>的值。在<code>handleClick</code>功能中，每次点击按钮时，我们都会将<code>numClicked</code>的状态值增加<code>1</code>:</p>
<pre class="language-javascript hljs">@track({class:'ClassButton'})
class ClassButton extends React.Component{
  state = {
    numClicked : 1
  };

  @track((props, state) =&gt;({event:'ClassButton-Clicked', clickCount:state.numClicked}))
  handleClick = () =&gt; {
    this.setState({
      numClicked: this.state.numClicked + 1
    })
  }
  render(){
    return(
      &lt;div&gt;
        &lt;h2&gt;Click for ClassButton&lt;/h2&gt;
        &lt;button onClick={this.handleClick}&gt;Click Me!&lt;/button&gt;
      &lt;/div&gt;
    )
  }
}
</pre>
<h2><code>App</code>组件</h2>
<p>现在，我们将把<code>HookButton</code>功能组件和<code>ClassButton</code>类组件包装在<code>App</code>组件中:</p>
<pre class="language-javascript hljs">const App = () =&gt;{
  return(
    &lt;div className="App"&gt;
      &lt;h1&gt;React-Tracking&lt;/h1&gt;
      &lt;HookButton /&gt;
      &lt;ClassButton /&gt;
    &lt;/div&gt;
  )
}
</pre>
<h2><code>dispatch</code>组件</h2>
<p><code>dispatch</code>组件是一个功能性组件，当被触发时将在控制台中呈现。你可以像<code>Component: "Apps"</code>一样给<code>dispatch</code>添加自己的消息。<code>dispatch</code>使用<code>track</code>来显示我们在控制台中定义的内容。</p>
<p>我们还将使用<code>dispatch</code>将我们收集的所有数据发送到控制台，然后是您想要在页面上呈现的组件。接下来，我们只需要导出包含跟踪日志的功能组件:</p>
<pre class="language-javascript hljs">const TrackedApp = track(
  { Component: "Apps" },
  {
    dispatch: data =&gt; {
      console.log(data);
    }
  }
)(App);

export default TrackedApp
</pre>
<p>上面代码的输出如下:</p>
<p><img data-attachment-id="85312" data-permalink="https://blog.logrocket.com/react-tracking-declarative-tracking-react-apps/react-tracking-hook-button-class-button-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/react-tracking-hook-button-class-button-output.png" data-orig-size="509,325" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="react-tracking-hook-button-class-button-output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/react-tracking-hook-button-class-button-output-300x192.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/react-tracking-hook-button-class-button-output.png" decoding="async" class="aligncenter wp-image-85312 size-full jetpack-lazy-image" src="../Images/810ab30c582aa3ac1bf5e0f9e18f2e38.png" alt="React Tracking Hook Button Class Button Output" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/react-tracking-hook-button-class-button-output.png 509w, https://blog.logrocket.com/wp-content/uploads/2022/01/react-tracking-hook-button-class-button-output-300x192.png 300w" data-lazy-sizes="(max-width: 509px) 100vw, 509px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/react-tracking-hook-button-class-button-output.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/react-tracking-hook-button-class-button-output.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="85312" data-permalink="https://blog.logrocket.com/react-tracking-declarative-tracking-react-apps/react-tracking-hook-button-class-button-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/react-tracking-hook-button-class-button-output.png" data-orig-size="509,325" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="react-tracking-hook-button-class-button-output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/react-tracking-hook-button-class-button-output-300x192.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/react-tracking-hook-button-class-button-output.png" decoding="async" loading="lazy" class="aligncenter wp-image-85312 size-full" src="../Images/810ab30c582aa3ac1bf5e0f9e18f2e38.png" alt="React Tracking Hook Button Class Button Output" srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/react-tracking-hook-button-class-button-output.png 509w, https://blog.logrocket.com/wp-content/uploads/2022/01/react-tracking-hook-button-class-button-output-300x192.png 300w" sizes="(max-width: 509px) 100vw, 509px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/react-tracking-hook-button-class-button-output.png"/></noscript>
<p>当您单击按钮时，可以在控制台中找到跟踪详细信息。</p>
<p><code>HookButton</code>点击输出:</p>
<pre class="language-javascript hljs">{app: "my-app", funComponent: "HookButton", event: "HookButton-Clicked"}
</pre>
<p><code>ClassButton</code>点击输出:</p>
<pre class="language-javascript hljs">{app: "my-app", class: "ClassButton", event: "ClassButton-Clicked", clickCount: 1}
</pre>
<p><code>clickCount</code>将随着您继续点击该按钮而增加。你可以找到代码并在代码沙箱中进行试验:</p>
<p>结论</p>
<h2>在本教程中，我们探索了 react-tracking，它很好地跟踪了所有事件，并在控制台中提供了重要的细节。我们创建了一个程序来跟踪<code>click button</code>事件，并显示每次点击的跟踪数据。<code>@</code>装饰器和<code>track</code>可以跟踪 React 中的大部分数据，包括道具和状态中的数据。</h2>
<p>您可以使用本教程中的步骤来跟踪应用程序中的不同组件和类。我希望你在下一个项目中考虑反应追踪。感谢您的阅读，如果您有任何问题，请务必留下评论。</p>
<p><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener"> LogRocket </a>:全面了解您的生产 React 应用</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">调试 React 应用程序可能很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪 Redux 状态、自动显示 JavaScript 错误以及跟踪缓慢的网络请求和组件加载时间感兴趣，</h2><p>. </p><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" vwo-el-id="19356441070">try LogRocket</a><p>LogRocket 结合了会话回放、产品分析和错误跟踪，使软件团队能够创建理想的 web 和移动产品体验。这对你来说意味着什么？</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<p vwo-el-id="28675660440" class="">LogRocket 不是猜测错误发生的原因，也不是要求用户提供截图和日志转储，而是让您回放问题，就像它们发生在您自己的浏览器中一样，以快速了解哪里出错了。</p>
<p>不再有嘈杂的警报。智能错误跟踪允许您对问题进行分类，然后从中学习。获得有影响的用户问题的通知，而不是误报。警报越少，有用的信号越多。</p>
<p>LogRocket Redux 中间件包为您的用户会话增加了一层额外的可见性。LogRocket 记录 Redux 存储中的所有操作和状态。</p>
<p vwo-el-id="28675660750">现代化您调试 React 应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">开始免费监控</a>。</p>
<p vwo-el-id="28675661060">Modernize how you debug your React apps —
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">start monitoring for free</a>.
</p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>


</div>    
</body>
</html>