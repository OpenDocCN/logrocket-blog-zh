<html>
<head>
<title>How to add audio waveforms to your Flutter app </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何将音频波形添加到您的Flutter应用程序中</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/audio-waveforms-flutter-app/#0001-01-01">https://blog.logrocket.com/audio-waveforms-flutter-app/#0001-01-01</a></blockquote><div><article class="article-post">
<p>当在你的应用程序中添加录音功能时，向用户展示某种音频正在被录制的视觉表现通常是一个好主意。例如，您可以在UI中添加一个计时器，通知用户音频已经录制了多长时间。但是，如果你真的想给你的用户一个干净的视觉体验，波形可以改变游戏规则。</p>
<p>在这篇文章中，我们将学习当你在Flutter 中录制音频或播放音频文件时，如何创建简单的波形。我们开始吧！</p>
<p><em>向前跳转:</em></p>

<h2 id="what-audio-waveforms-why-need-them">什么是音频波形，我们为什么需要它们？</h2>
<p>简而言之，音频波形是表示音频不同部分音量的图形。x轴代表时间，y轴代表振幅。所以，浪越高，声音越大。类似地，较低的波或较平坦的波代表音频中较柔和的区域。</p>
<p>波形让用户知道他们是轻声说话还是大声说话，这样他们就可以相应地调整音量。例如，用户可能试图轻声说话，但声音太轻，麦克风无法拾取。通过查看图表，他们可以很容易地决定提高麦克风的音量。</p>
<p>当您想要播放或流化音频文件时，波形也很方便。例如，当医生听听诊器传递的声音时，在屏幕上看到显示声音模式的图形只会使体验更好。</p>
<p>在本教程中，我们将为Flutter应用程序构建如下图所示的功能:</p>
<figure id="attachment_138142" aria-describedby="caption-attachment-138142" class="wp-caption aligncenter"><img data-attachment-id="138142" data-permalink="https://blog.logrocket.com/audio-waveforms-flutter-app/attachment/flutter-wave-forms-recorder/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/flutter-wave-forms-recorder.gif" data-orig-size="572,158" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="flutter-wave-forms-recorder" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/flutter-wave-forms-recorder-300x83.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/flutter-wave-forms-recorder.gif" decoding="async" class="wp-image-138142 size-full jetpack-lazy-image" src="../Images/5d5e6865cfd8bc53f19019277d774478.png" alt="Flutter Waveforms Recorder" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/flutter-wave-forms-recorder.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/flutter-wave-forms-recorder.gif"/><noscript><img data-lazy-fallback="1" data-attachment-id="138142" data-permalink="https://blog.logrocket.com/audio-waveforms-flutter-app/attachment/flutter-wave-forms-recorder/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/flutter-wave-forms-recorder.gif" data-orig-size="572,158" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="flutter-wave-forms-recorder" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/flutter-wave-forms-recorder-300x83.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/flutter-wave-forms-recorder.gif" decoding="async" loading="lazy" class="wp-image-138142 size-full" src="../Images/5d5e6865cfd8bc53f19019277d774478.png" alt="Flutter Waveforms Recorder" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/flutter-wave-forms-recorder.gif"/></noscript><figcaption id="caption-attachment-138142" class="wp-caption-text">Waveforms in recorder</figcaption></figure>
<figure id="attachment_138146" aria-describedby="caption-attachment-138146" class="wp-caption aligncenter"><img data-attachment-id="138146" data-permalink="https://blog.logrocket.com/audio-waveforms-flutter-app/attachment/wave-forms-player/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/wave-forms-player.gif" data-orig-size="406,146" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="wave-forms-player" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/wave-forms-player-300x108.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/wave-forms-player.gif" decoding="async" class="wp-image-138146 size-full jetpack-lazy-image" src="../Images/cc0d739958d34eee8241120914579051.png" alt="Wave Forms Player" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/10/wave-forms-player.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/wave-forms-player.gif"/><noscript><img data-lazy-fallback="1" data-attachment-id="138146" data-permalink="https://blog.logrocket.com/audio-waveforms-flutter-app/attachment/wave-forms-player/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/10/wave-forms-player.gif" data-orig-size="406,146" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="wave-forms-player" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/10/wave-forms-player-300x108.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/10/wave-forms-player.gif" decoding="async" loading="lazy" class="wp-image-138146 size-full" src="../Images/cc0d739958d34eee8241120914579051.png" alt="Wave Forms Player" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/10/wave-forms-player.gif"/></noscript><figcaption id="caption-attachment-138146" class="wp-caption-text">Waveforms in player</figcaption></figure>
<h2 id="setting-up">设置我们的Flutter应用</h2>
<p>我们将从添加所需的依赖项和权限开始，包括<a href="https://pub.dev/packages/audio_waveforms">音频波形</a>包:</p>
<pre class="language-dart hljs">flutter pub add audio_waveforms
</pre>
<p>将包导入我们的<code>main.dart</code>文件:</p>
<pre class="language-dart hljs">import 'package:audio_waveforms/audio_waveforms.dart';
</pre>
<p>现在，将记录权限添加到Android清单中:</p>
<pre class="language-dart hljs">&lt;uses-permission android:name="android.permission.RECORD_AUDIO" /&gt;
</pre>
<h2 id="creating-waveforms">创建波形</h2>
<p><code>AudioWaveforms</code>小工具将创建我们的波形。但是，在我们继续之前，我们需要创建一个将被传递给我们的<code>AudioWaveforms</code>小部件的<code>recorderController</code>。让我们用下面的代码在我们的状态中声明一个<code>RecordController</code>:</p>
<pre class="language-dart hljs">late final RecorderController recorderController;
</pre>
<p>然后，要初始化控制器，请输入下面的代码:</p>
<pre class="language-dart hljs">void _initialiseController() {
 recorderController = RecorderController()
      ..androidEncoder = AndroidEncoder.aac
      ..androidOutputFormat = AndroidOutputFormat.mpeg4
      ..iosEncoder = IosEncoder.kAudioFormatMPEG4AAC
      ..sampleRate = 16000;
}
</pre>
<p>我们可以根据需要改变采样率和编码器。我们将在<code>initState</code>中调用这个方法:</p>
<pre class="language-dart hljs">void initState() {
  super.initState();
  _initialiseController();
}
</pre>
<p>现在，使用控制器来记录音频和显示波形就像将<code>AudioWaveform</code>小部件添加到我们的小部件树一样简单，如下所示:</p>
<pre class="language-dart hljs">AudioWaveforms(
  size: Size(MediaQuery.of(context).size.width, 200.0),
  recorderController: recorderController,
),


void _startRecording() async {
  await recorderController.record(path);
  // update state here to, for eample, change the button's state
}
</pre>
<p>为了开始记录，我们将通过单击一个按钮来调用上面的方法:</p>
<pre class="language-dart hljs">IconButton(
          icon: Icon(Icons.mic),
          tooltip: 'Start recording',
          onPressed: _startRecording
)
</pre>
<p>我们将使用以下代码停止记录:</p>
<pre class="language-dart hljs">final path = await recorderController.stop();
</pre>
<p>停止记录器将返回保存记录的文件的路径。</p>
<h2 id="customizing-waveforms">定制波形</h2>
<p>我们已经看到我们可以控制<code>RecordController</code>中的采样率和编码。<br/> <code>AudioWaveforms</code>也允许我们改变波浪的风格，包括<code>size</code>、<code>waveStyle</code>、<code>color</code>、<code>padding</code>和<code>margin</code>等方面:</p>
<pre class="language-dart hljs">AudioWaveforms(
              enableGesture: true,
              size: Size(MediaQuery.of(context).size.width / 2, 50),
              recorderCAudioWaveforms(
              enableGesture: true,
              size: Size(MediaQuery.of(context).size.width / 2, 50),
              recorderController: recorderController,
              waveStyle: const WaveStyle(
                waveColor: Colors.white,
                extendWaveform: true,
                showMiddleLine: false,
              ),
              decoration: BoxDecoration(
                borderRadius: BorderRadius.circular(12.0),
                color: const Color(0xFF1E1B26),
              ),
              padding: const EdgeInsets.only(left: 18),
              margin: const EdgeInsets.symmetric(horizontal: 15),
            )
</pre>
<p>我们也可以对波浪应用颜色渐变:</p>
<pre class="language-dart hljs">waveStyle: WaveStyle(
   gradient: ui.Gradient.linear(
    const Offset(70, 50),
    Offset(MediaQuery.of(context).size.width / 2, 0),
    [Colors.red, Colors.green],
   ),
  )
</pre>
<h2 id="playing-audio">播放音频</h2>
<p>现在，我们将学习如何播放音频文件并为它们生成波形。此处与前一个录音示例的主要区别在于:</p>
<ol>
<li>我们将创建一个<code>PlayerController</code>而不是一个<code>RecordController</code></li>
<li>我们将使用<code>AudioFileWaveforms</code>而不是<code>AudioWaveforms</code></li>
</ol>
<p>首先，我们将运行与之前相同的代码，用<code>PlayerController</code>替换<code>RecordController</code>:</p>
<pre class="language-dart hljs">late final PlayerController playerController;</pre>
<p>但是，这一次，我们做了以下更改:</p>
<pre class="language-dart hljs">void _initialiseController() {
 playerController = PlayerController();
}
</pre>
<p>将此<code>playerController</code>传递给小部件树中的<code>AudioFileWaveforms</code>小部件:</p>
<pre class="language-dart hljs">AudioFileWaveforms(
 size: Size(MediaQuery.of(context).size.width, 100.0),
 playerController: playerController,
)
</pre>
<p>我们需要向控制器提供音频文件的路径。你可以随意抓取文件的路径。我们将使用<code>path_provider</code>来完成这个任务。将<code>path_provider</code>添加到您的<code>pubspec.yaml</code>中，然后在您的<code>main.dart</code>顶部添加以下代码:</p>
<pre class="language-dart hljs">import 'package:path_provider/path_provider.dart';
</pre>
<p>您可以将路径存储在一个名为<code>path</code>的变量中:</p>
<pre class="language-dart hljs">String? path;
late Directory directory;

void initState() {
  super.initState();
  _initialiseController();
  directory = await getApplicationDocumentsDirectory();
  path = "${directory.path}/test_audio.aac";
  playerController.preparePlayer(path);
}
</pre>
<p>注意，我们还通过提供音频文件的路径来调用控制器上的<code>preparePlayer</code>方法。我们可以像使用<code>recordController</code>一样启动和停止播放器:</p>
<pre class="language-dart hljs">await playerController.startPlayer();
await playerController.stopPlayer();


void _playandPause() async {
  playerController.playerState == PlayerState.playing
  ? await playerController.pausePlayer()
  : await playerController.startPlayer(finishMode: FinishMode.loop);
}
</pre>
<p>现在，我们可以在点击按钮时调用<code>_playandPause</code>方法。我们还为<code>startPlayer</code>方法提供了一个<code>finishMode</code>，以便在结束时循环音频和波形。您还可以添加其他选项，分别用<code>FinishMode.pause</code>和<code>FinishMode.stop</code>暂停波形或停止波形。</p>
<p>我们还可以添加使用波形上的手势搜索音频的功能:</p>
<pre class="language-dart hljs">AudioFileWaveforms(
 enableSeekGesture: true,
)
</pre>
<p>我们将波形设计如下:</p>
<pre class="language-dart hljs">AudioFileWaveforms(
 size: Size(MediaQuery.of(context).size.width / 2, 70),
              playerController: playerController,
              density: 1.5,
              playerWaveStyle: const PlayerWaveStyle(
                scaleFactor: 0.8,
                fixedWaveColor: Colors.white30,
                liveWaveColor: Colors.white,
                waveCap: StrokeCap.butt,
              ),
)
</pre>
<p>注意，我们使用<code>PlayerWaveStyle</code>而不是<code>WaveStyle</code>来提供样式，后者更适合记录器。</p>
<h2 id="disposing-controllers">布置控制器</h2>
<p>在结束之前，处理掉我们用来录制和播放音频的控制器是很重要的。在<code>dispose</code>方法中，我们将添加以下代码:</p>
<pre class="language-dart hljs"> @override
void dispose() {
  super.dispose();
  recorderController.dispose();
  playerController.dispose();
}
</pre>
<h2 id="conclusion">结论</h2>
<p>我们刚刚看到使用音频波形包在Flutter中创建音频播放器和显示波形是多么容易。波形是音量的动态视觉表示；它们向用户提供麦克风捕捉他们所说的话的反馈，以便他们可以相应地提高或降低音量。</p>
<p>我们学习了如何对波形进行定制，使它们符合我们的视觉偏好，开始和停止记录，最后，处理用于记录和播放音频的控制器。我希望你喜欢这个教程；如果你有任何问题，一定要留下评论。</p><div class="code-block code-block-4">
<div class="blog-plug base-cta"><h2>使用<a class="signup" href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>消除传统错误报告的干扰</h2>
<a href="https://lp.logrocket.com/blg/signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p><a href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一个数字体验分析解决方案，它可以保护您免受数百个假阳性错误警报的影响，只针对几个真正重要的项目。LogRocket会告诉您应用程序中实际影响用户的最具影响力的bug和UX问题。</p>
<p>然后，使用具有深层技术遥测的会话重放来确切地查看用户看到了什么以及是什么导致了问题，就像你在他们身后看一样。</p>
<p>LogRocket自动聚合客户端错误、JS异常、前端性能指标和用户交互。然后LogRocket使用机器学习来告诉你哪些问题正在影响大多数用户，并提供你需要修复它的上下文。</p>
<p>关注重要的bug—<a class="signup" href="https://lp.logrocket.com/blg/signup-issue-free" target="_blank" rel="noopener noreferrer">今天就试试LogRocket】。</a></p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>
 
</div>    
</body>
</html>