<html>
<head>
<title>Content management in Next.js with Sanity CMS - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Next.js 中的内容管理与 Sanity CMS - LogRocket 博客</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/content-management-in-next-js-with-sanity-cms/#0001-01-01">https://blog.logrocket.com/content-management-in-next-js-with-sanity-cms/#0001-01-01</a></blockquote><div><article class="article-post">
<p>Next.js 是一个 React 框架，旨在通过内置功能扩展 React 的功能，如路由、类型脚本支持以及网站和应用程序的混合静态和服务器呈现。</p>
<p>虽然 Next.js 应用程序中的内容可以硬编码、从 JSON 文件中读取或从数据库中使用，但从内容管理系统(CMS)如 Sanity CMS 中获取内容可以为开发人员提供更灵活的创作。</p>
<p>在这篇文章中，我们将看看如何使用 Next.js 和 Sanity CMS，一个 headless CMS，在一个基于 Jamstack 的 web 应用程序或网站中提供更好的内容管理。</p>
<h2>什么是神智 CMS？</h2>
<p><a href="https://blog.logrocket.com/sanity-cms-for-content-management-in-gatsby/"> Sanity CMS </a>是一个 headless CMS，它是一个与表示层或客户端分离的内容创作后端系统。它通过 API 将存储的内容公开为数据，供网站、移动应用程序和物联网等不同平台使用，与 WordPress 等传统内容管理系统截然不同。</p>
<p>Sanity CMS 采用结构化的方法进行内容创作，通过其<a href="https://www.sanity.io/docs/asset-pipeline">图像管道</a>，通过<a href="https://www.sanity.io/guides/introduction-to-portable-text">可移植文本</a>和设计，提供了一些简洁的功能来管理图像。它还提供了<a href="https://sanity.io/studio"> Sanity Studio </a>，一个用 React 构建的全功能、可定制、可扩展的编辑器。</p>
<h3>无头 CMS 的好处</h3>
<p>Headless CMS 忠实地体现了 Jamstack 架构的解耦方法，具有如下优点:</p>
<h4>安全性</h4>
<p>因为后端系统与表示层分离，所以暴露于安全威胁的区域较小。</p>
<h4>数据可重用性</h4>
<p>无头内容通过 API 作为数据公开，因此是平台不可知的。</p>
<h4 id="structured-content">结构化内容</h4>
<p><a href="https://www.sanity.io/docs/content-modelling">内容建模</a>是 headless CMS 的核心，要求内容描述是一等公民，这意味着它们可以针对任何应用程序的特定需求进行构建。</p>
<h4>更容易编辑</h4>
<p>内容和代码的分离使得内容编辑者更容易专注于内容编辑，开发者更容易专注于代码。</p>
<h4>开发者体验</h4>
<p>在无头 CMS 生态系统中，被称为头部的是头部中消费内容的地方。它与主体无关，内容是在主体中创作和存储的，可以由开发人员自行选择。</p>
<h4>缩短构建时间</h4>
<p>众所周知，当 Jamstack 站点包含大量内容时，构建时间会很长。虽然有像<a href="https://blog.logrocket.com/incremental-static-regeneration-with-next-js/">增量静态再生(ISR) </a>、<a href="https://blog.logrocket.com/gatsby-incremental-builds/">增量构建</a>和<a href="https://github.com/jamstack/jamstack.org/discussions/549">分布式持久渲染(DPR) </a>这样的解决方案，但是将内容从头中分离出来解决了无头 CMS 中构建时间长的问题。</p>
<h2>使用 Sanity CMS 管理内容</h2>
<p>为了说明如何在 Jamstack 架构中将<a href="https://blog.logrocket.com/whats-new-in-next-js-10-1/"> Next.js </a>与 Sanity CMS 一起使用，我们将构建一个简单的登录页面来理解 Sanity 的基本内容管理流程，包括在 Next.js 中使用其命令行界面(CLI)和操纵其模式。</p>
<p>跟随<a href="https://github.com/adebiyial/next-with-sanity-demo/commit/e55bdcebe27b61f9924db0fdd1db5865645d74ec">一起提交</a>,其中包括硬编码的样式和默认登录页面内容。我们的最终产品将如下图所示:</p>
<p><img data-attachment-id="52677" data-permalink="https://blog.logrocket.com/content-management-in-next-js-with-sanity-cms/next-js-sanity-cms-final-project-page-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Next-js-sanity-CMS-final-project-page-1.png" data-orig-size="730,570" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Next.js Sanity CMS final project page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Next-js-sanity-CMS-final-project-page-1-300x234.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Next-js-sanity-CMS-final-project-page-1.png" decoding="async" class="aligncenter wp-image-52677 size-full jetpack-lazy-image" src="../Images/65eb3c8b90941c614f7dc195a4043007.png" alt="Next.js And Sanity CMS Final Project Page" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/Next-js-sanity-CMS-final-project-page-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/Next-js-sanity-CMS-final-project-page-1-300x234.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/06/Next-js-sanity-CMS-final-project-page-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/Next-js-sanity-CMS-final-project-page-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="52677" data-permalink="https://blog.logrocket.com/content-management-in-next-js-with-sanity-cms/next-js-sanity-cms-final-project-page-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Next-js-sanity-CMS-final-project-page-1.png" data-orig-size="730,570" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Next.js Sanity CMS final project page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Next-js-sanity-CMS-final-project-page-1-300x234.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Next-js-sanity-CMS-final-project-page-1.png" decoding="async" loading="lazy" class="aligncenter wp-image-52677 size-full" src="../Images/65eb3c8b90941c614f7dc195a4043007.png" alt="Next.js And Sanity CMS Final Project Page" srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/Next-js-sanity-CMS-final-project-page-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/Next-js-sanity-CMS-final-project-page-1-300x234.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/Next-js-sanity-CMS-final-project-page-1.png"/></noscript>
<p>我们疯狂的方法是:</p>
<ol>
<li>在 Sanity Studio 上创建和发布内容</li>
<li>在我们的 Next.js 应用程序中获取无头内容作为动态内容的数据</li>
</ol>
<h2>创建并运行 Next.js 应用程序</h2>
<p>首先，创建一个内容硬编码的 Next.js 应用程序。</p>
<p>首先用<code>create-next-app</code>创建一个 Next.js 应用程序，然后运行这个命令:</p>
<pre>yarn create next-app client
</pre>
<p>接下来，使用以下命令运行 Next.js 应用程序:</p>
<pre>cd client
yarn dev
</pre>
<p>在<a href="http://localhost:3000" rel="nofollow"> http://localhost:3000 </a>访问 Next.js app。</p>
<figure id="attachment_52678" aria-describedby="caption-attachment-52678" class="wp-caption aligncenter"><img data-attachment-id="52678" data-permalink="https://blog.logrocket.com/content-management-in-next-js-with-sanity-cms/default-next-js-app-running-localhost-3000-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Default-Next-js-app-running-localhost-3000.-1.png" data-orig-size="730,527" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Default Next.js app running localhost-3000" data-image-description="" data-image-caption="&lt;p&gt;Default Next.js App running On http://localhost:3000&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Default-Next-js-app-running-localhost-3000.-1-300x217.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Default-Next-js-app-running-localhost-3000.-1.png" decoding="async" class="wp-image-52678 size-full jetpack-lazy-image" src="../Images/75f6fee2484cb235b9fa61db1a4954fc.png" alt="Default Next.js App running On http://localhost:3000" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/Default-Next-js-app-running-localhost-3000.-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/Default-Next-js-app-running-localhost-3000.-1-300x217.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/06/Default-Next-js-app-running-localhost-3000.-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/Default-Next-js-app-running-localhost-3000.-1.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="52678" data-permalink="https://blog.logrocket.com/content-management-in-next-js-with-sanity-cms/default-next-js-app-running-localhost-3000-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Default-Next-js-app-running-localhost-3000.-1.png" data-orig-size="730,527" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Default Next.js app running localhost-3000" data-image-description="" data-image-caption="&lt;p&gt;Default Next.js App running On http://localhost:3000&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Default-Next-js-app-running-localhost-3000.-1-300x217.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Default-Next-js-app-running-localhost-3000.-1.png" decoding="async" loading="lazy" class="wp-image-52678 size-full" src="../Images/75f6fee2484cb235b9fa61db1a4954fc.png" alt="Default Next.js App running On http://localhost:3000" srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/Default-Next-js-app-running-localhost-3000.-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/Default-Next-js-app-running-localhost-3000.-1-300x217.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/Default-Next-js-app-running-localhost-3000.-1.png"/></noscript><figcaption id="caption-attachment-52678" class="wp-caption-text">Default Next.js App running on <a href="http://localhost:3000" rel="nofollow">http://localhost:3000</a>.</figcaption></figure>
<p>既然我们已经成功地创建了一个包含硬编码内容的 Next.js 应用程序，那么是时候在 Sanity Studio 中创建并运行一个项目了。</p>
<h2>创建并运行一个 Sanity Studio 项目</h2>
<p>在进行下一步之前，请确保您有一个<a href="https://manage.sanity.io/">健全性帐户</a>，如果没有，请创建一个。</p>
<p>接下来，使用以下命令全局安装<a href="https://www.sanity.io/docs/cli"> Sanity CLI </a>:</p>
<pre>yarn add @sanity/cli --global
</pre>
<p>这将为通过 CLI 正常工作安装必要的工具。</p>
<p>安装 Sanity CLI 后，使用以下内容创建一个新的 Sanity 项目:</p>
<pre>sanity init
</pre>
<p>当这个命令运行时，会出现一个交互式问答会话，用于创建一个 Sanity Studio 项目。我们可以为该项目的相应问题输入以下答案:</p>
<ul>
<li>对于<code>Select project to use</code>输入<code>Create new project</code></li>
<li>对于<code>Your project name:</code>输入<code>cms</code></li>
<li>对于<code>Use the default dataset configuration?</code>输入<code>Yes</code></li>
<li>对于<code>Select project template</code>输入<code>Clean project with no predefined schemas</code></li>
</ul>
<figure id="attachment_52662" aria-describedby="caption-attachment-52662" class="wp-caption aligncenter"><img data-attachment-id="52662" data-permalink="https://blog.logrocket.com/content-management-in-next-js-with-sanity-cms/question-answer-prompt-setting-up-sanity-studio-project/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/question-answer-prompt-setting-up-Sanity-Studio-project.png" data-orig-size="730,340" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Question answer prompt setting up Sanity Studio project" data-image-description="" data-image-caption="&lt;p&gt;Answers to the question and answer prompt when setting up a Sanity Studio project&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/question-answer-prompt-setting-up-Sanity-Studio-project-300x140.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/question-answer-prompt-setting-up-Sanity-Studio-project.png" decoding="async" class="size-full wp-image-52662 jetpack-lazy-image" src="../Images/1461ec284854a40578e7c16f1195357b.png" alt="Answers to the question and answer prompt when setting up a Sanity Studio project" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/question-answer-prompt-setting-up-Sanity-Studio-project.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/question-answer-prompt-setting-up-Sanity-Studio-project-300x140.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/06/question-answer-prompt-setting-up-Sanity-Studio-project.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/question-answer-prompt-setting-up-Sanity-Studio-project.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="52662" data-permalink="https://blog.logrocket.com/content-management-in-next-js-with-sanity-cms/question-answer-prompt-setting-up-sanity-studio-project/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/question-answer-prompt-setting-up-Sanity-Studio-project.png" data-orig-size="730,340" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Question answer prompt setting up Sanity Studio project" data-image-description="" data-image-caption="&lt;p&gt;Answers to the question and answer prompt when setting up a Sanity Studio project&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/question-answer-prompt-setting-up-Sanity-Studio-project-300x140.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/question-answer-prompt-setting-up-Sanity-Studio-project.png" decoding="async" loading="lazy" class="size-full wp-image-52662" src="../Images/1461ec284854a40578e7c16f1195357b.png" alt="Answers to the question and answer prompt when setting up a Sanity Studio project" srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/question-answer-prompt-setting-up-Sanity-Studio-project.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/question-answer-prompt-setting-up-Sanity-Studio-project-300x140.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/question-answer-prompt-setting-up-Sanity-Studio-project.png"/></noscript><figcaption id="caption-attachment-52662" class="wp-caption-text">Answers to the question and answer prompt when setting up a Sanity Studio project</figcaption></figure>
<p>虽然我们用 Sanity CLI 创建了一个 Sanity Studio 项目，但是我们也可以使用其中一个<a href="https://www.sanity.io/create">启动器</a>。</p>
<p>要运行 Sanity 项目，请使用以下命令在端口 3333 上启动 Sanity Studio:</p>
<pre>cd cms
sanity start -p 3333
</pre>
<p>然后在<code><a href="http://localhost:3333" rel="nofollow">http://localhost:3333</a></code>访问 Next.js 应用程序，并在提示时登录 Sanity.io。</p>
<p><img data-attachment-id="52666" data-permalink="https://blog.logrocket.com/content-management-in-next-js-with-sanity-cms/visit-next-js-app-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/visit-next-js-app-page.png" data-orig-size="730,570" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Visit Next.js app page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/visit-next-js-app-page-300x234.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/visit-next-js-app-page.png" decoding="async" class="aligncenter size-full wp-image-52666 jetpack-lazy-image" src="../Images/2a2f7d2ae999754826449eb11b04cb3b.png" alt="Visiting the Next.js app page" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/visit-next-js-app-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/visit-next-js-app-page-300x234.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/06/visit-next-js-app-page.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/visit-next-js-app-page.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="52666" data-permalink="https://blog.logrocket.com/content-management-in-next-js-with-sanity-cms/visit-next-js-app-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/visit-next-js-app-page.png" data-orig-size="730,570" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Visit Next.js app page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/visit-next-js-app-page-300x234.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/visit-next-js-app-page.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-52666" src="../Images/2a2f7d2ae999754826449eb11b04cb3b.png" alt="Visiting the Next.js app page" srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/visit-next-js-app-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/visit-next-js-app-page-300x234.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/visit-next-js-app-page.png"/></noscript>
<p>我们目前有一个空的模式，它必须更新。</p>
<h2>编辑 Sanity.io 模式</h2>
<p><a href="https://www.sanity.io/docs/schema-types">模式</a>是 Sanity.io 中结构化内容建模的核心，指的是组成文档的字段类型，如<a href="https://www.sanity.io/docs/document-type">文档</a>、<a href="https://www.sanity.io/docs/image-type">图像</a>、<a href="https://www.sanity.io/docs/object-type">对象</a>或<a href="https://www.sanity.io/docs/reference-type">引用</a>。这些类型使用元数据属性如<code>name</code>、<code>type</code>和<code>description</code>来设计 Sanity.io 上的内容。</p>
<p>我们可以跟随这个提交来添加所需的模式。</p>
<p>登录页面需要两个模式，所以我们将在 Sanity.io 项目的根目录下的<code>schemas</code>目录中创建模式<code>homepage.js</code>和<code>siteheader.js</code>。</p>
<p>用以下内容更新<code>schemas/homepage.js</code>:</p>
<pre>// sanity/schemas/homepage.js
export default {
  name: 'homepage',
  title: 'Homepage',
  type: 'document',
  fields: [
    {
      name: 'title',
      title: 'Homepage title',
      type: 'string',
      description: "What's the title of the homepage hero?",
    },
    {
      name: 'subtitle',
      title: 'Homepage subtitle',
      type: 'string',
      description: "What's the subtitle of the homepage hero?",
    },
    {
      name: 'image',
      title: 'Homepage image',
      type: 'image',
    },
    {
      name: 'cta',
      description: "What's URL for the homepage CTA?",
      title: 'CTA',
      type: 'slug',
      options: {
        maxLength: 200,
      },
      validation: (Rule) =&gt; [Rule.required().error('Field cannot be empty')],
    },
  ],
};
</pre>
<p>我们现在已经创建了一个包含字段<code>title</code>、<code>subtitle</code>、<code>image</code>和行动号召(<code>CTA</code>)的<code>document</code>模式。<code>CTA</code>字段还包括一个<code>validation</code>功能，确保该字段不能为空<strong>。</strong></p>
<p>我们可以看到<code>name</code>、<code>title</code>、<code>type</code>的重复模式来描述内容。<code>type</code>决定了在 Sanity Studio 编辑器中会生成什么样的字段，如下所示:</p>
<p><img data-attachment-id="52667" data-permalink="https://blog.logrocket.com/content-management-in-next-js-with-sanity-cms/generating-fields-sanity-studio-editor/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/generating-fields-sanity-studio-editor.png" data-orig-size="730,595" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Generating fields Sanity Studio editor" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/generating-fields-sanity-studio-editor-300x245.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/generating-fields-sanity-studio-editor.png" decoding="async" class="aligncenter size-full wp-image-52667 jetpack-lazy-image" src="../Images/f94b19763102504dbf3f9425bcc49301.png" alt="Generating Fields in Sanity Studio Editor" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/generating-fields-sanity-studio-editor.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/generating-fields-sanity-studio-editor-300x245.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/06/generating-fields-sanity-studio-editor.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/generating-fields-sanity-studio-editor.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="52667" data-permalink="https://blog.logrocket.com/content-management-in-next-js-with-sanity-cms/generating-fields-sanity-studio-editor/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/generating-fields-sanity-studio-editor.png" data-orig-size="730,595" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Generating fields Sanity Studio editor" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/generating-fields-sanity-studio-editor-300x245.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/generating-fields-sanity-studio-editor.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-52667" src="../Images/f94b19763102504dbf3f9425bcc49301.png" alt="Generating Fields in Sanity Studio Editor" srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/generating-fields-sanity-studio-editor.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/generating-fields-sanity-studio-editor-300x245.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/generating-fields-sanity-studio-editor.png"/></noscript>
<p>另外，更新<code>schemas/siteheader.js</code>:</p>
<pre>// schemas/siteheader.js
export default {
  name: 'siteheader',
  title: 'Site Header',
  type: 'document',
  fields: [
    {
      name: 'title',
      title: 'Site header title',
      type: 'string',
    },
    {
      name: 'repoURL',
      title: 'Repo URL',
      type: 'slug',
    },
  ],
};
</pre>
<p>接下来，将<code>homepage</code>和<code>siteheader</code>模式导入并添加到<code>schema.js</code>中的模式列表中:</p>
<pre>// schemas/schema.js
import createSchema from 'part:@sanity/base/schema-creator';
import schemaTypes from 'all:part:@sanity/base/schema-type';

// Import both schemas
import homepage from './homepage';
import siteheader from './siteheader';

export default createSchema({
  // We name our schema
  name: 'default',
  types: schemaTypes.concat([
    /* Append to the list of schemas */
    homepage,
    siteheader,
  ]),
});
</pre>
<p>Sanity.io 项目应该更新以反映模式，此时可以为<code>homepage</code>和<code>siteheader</code>模式创建和发布内容。</p>
<p><img data-attachment-id="52673" data-permalink="https://blog.logrocket.com/content-management-in-next-js-with-sanity-cms/create-publish-homepage-siteheader-schemas/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/create-publish-homepage-siteheader-schemas.png" data-orig-size="730,595" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Create publish homepage siteheader schemas" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/create-publish-homepage-siteheader-schemas-300x245.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/create-publish-homepage-siteheader-schemas.png" decoding="async" class="aligncenter size-full wp-image-52673 jetpack-lazy-image" src="../Images/1cc78cf434e3b7ebd769488c0bd2f9f3.png" alt="Create and Publish The Homepage and Siteheader Schemas" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/create-publish-homepage-siteheader-schemas.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/create-publish-homepage-siteheader-schemas-300x245.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/06/create-publish-homepage-siteheader-schemas.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/create-publish-homepage-siteheader-schemas.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="52673" data-permalink="https://blog.logrocket.com/content-management-in-next-js-with-sanity-cms/create-publish-homepage-siteheader-schemas/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/create-publish-homepage-siteheader-schemas.png" data-orig-size="730,595" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Create publish homepage siteheader schemas" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/create-publish-homepage-siteheader-schemas-300x245.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/create-publish-homepage-siteheader-schemas.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-52673" src="../Images/1cc78cf434e3b7ebd769488c0bd2f9f3.png" alt="Create and Publish The Homepage and Siteheader Schemas" srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/create-publish-homepage-siteheader-schemas.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/create-publish-homepage-siteheader-schemas-300x245.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/create-publish-homepage-siteheader-schemas.png"/></noscript>
<p>现在我们已经在 Sanity Studio 上创建并发布了内容，是时候使用 Next.js 中的数据了。</p>
<h2>从 Next.js 中的 Sanity CMS 获取数据</h2>
<p>这就是我们在无头内容和表示层(也分别称为头和体)之间架起的桥梁<strong>。</strong></p>
<p>通过从 Sanity.io 获取作为 API 上的数据公开的创作内容，我们可以使用它来动态填充登录页面上的相关部分。我们可以跟随<a href="https://github.com/adebiyial/next-with-sanity-demo/commit/5eaafdfb7e26b69be85a28868a86d9ff554ad9aa">这个提交</a>。</p>
<p>通过<a href="https://yarnpkg.com/package/@sanity/client"> @sanity/client </a>包连接 Next.js 应用程序，我们可以获取 Sanity.io 上发布的数据。</p>
<pre>yarn add @sanity/client
</pre>
<p>有了这个包，我们可以与 Next.js 中的 Sanity.io 接口。</p>
<p>在 Next.js 项目中，用新文件<code>sanity.js</code>创建一个新的<code>lib</code>文件夹:</p>
<pre>// /lib/sanity.js
import sanityClient from '@sanity/client';

// See the image above on how to get your projectId and add a new API token
// I added one called "landing page"
const client = sanityClient({
  projectId: 'your-project-id',
  dataset: 'production',
  token: 'api-token', // or leave blank to be anonymous user
  useCdn: false, // `false` if you want to ensure fresh data
  ignoreBrowserTokenWarning: true,
});

export default client;
</pre>
<p>这些配置值应作为<a href="https://nextjs.org/docs/basic-features/environment-variables">环境变量</a>存储和访问:</p>
<p><img data-attachment-id="52674" data-permalink="https://blog.logrocket.com/content-management-in-next-js-with-sanity-cms/configuration-values-environmental-variables/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/configuration-values-environmental-variables.png" data-orig-size="730,619" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Configuration values environmental variables" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/configuration-values-environmental-variables-300x254.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/configuration-values-environmental-variables.png" decoding="async" class="aligncenter size-full wp-image-52674 jetpack-lazy-image" src="../Images/47f724682f55896aea18a28396d8011c.png" alt="Configuration Values Of Environmental Variables" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/configuration-values-environmental-variables.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/configuration-values-environmental-variables-300x254.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/06/configuration-values-environmental-variables.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/configuration-values-environmental-variables.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="52674" data-permalink="https://blog.logrocket.com/content-management-in-next-js-with-sanity-cms/configuration-values-environmental-variables/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/configuration-values-environmental-variables.png" data-orig-size="730,619" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Configuration values environmental variables" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/configuration-values-environmental-variables-300x254.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/configuration-values-environmental-variables.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-52674" src="../Images/47f724682f55896aea18a28396d8011c.png" alt="Configuration Values Of Environmental Variables" srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/configuration-values-environmental-variables.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/configuration-values-environmental-variables-300x254.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/configuration-values-environmental-variables.png"/></noscript>
<h2>用 GROQ 获取 Next.js 中的 Sanity.io 数据</h2>
<p>现在我们必须用<code>@sanity/client</code>到<code><a href="https://nextjs.org/docs/basic-features/data-fetching#getstaticprops-static-generation">getStaticProps</a></code>用<a href="https://www.sanity.io/docs/overview-groq">图-关系对象查询(GROQ) </a>获取数据，这是 Sanity 的开源查询语言。我们可以跟随<a href="https://github.com/adebiyial/next-with-sanity-demo/commit/c2f1631943fe46c06e773bad97fc9028d2b04af3">这个 commit </a>。</p>
<p>为了继续，我们必须在<code>pages/index.js</code>中做两个更新。</p>
<p>首先，在<code>lib/sanity.js</code>中导入<code>sanityClient</code>返回的<code>client</code>对象:</p>
<pre>import client from '../lib/sanity';
</pre>
<p>接下来，将下面的代码添加到<code>pages/index.js</code>:</p>
<pre>// Create a query called siteHeaderQuery
const siteHeaderQuery = `*\[_type == "siteheader"\][0] {
  title,
  repoURL {
    current
  }
}`;

// Create a query called homepageQuery
const homepageQuery = `*\[_type == "homepage"\][0] {
  title,
  subtitle,
  "ctaUrl": cta {
    current
        },
  image {
    ...asset-&gt;
  }
}`;

export async function getStaticProps() {
  const homepageData = await client.fetch(homepageQuery);
  const siteHeaderData = await client.fetch(siteHeaderQuery);

  const data = { homepageData, siteHeaderData };

  return {
    props: {
      data,
    },
    revalidate: 1,
  };
}
</pre>
<p>从<code>getStaticProps</code>返回的<code>data</code>将作为道具出现在<code>Home</code>组件上:</p>
<pre>export default function Home({ data }) {
  const { siteHeaderData, homepageData } = data;

  // Check your browser console for output
  console.log({siteHeaderData, homepageData});

  // rest of component
}
</pre>
<p>如果一切顺利，我们应该准备好动态更新<code>Home</code>组件中的登录页面内容。</p>
<p>登录页面图像最初来源于<code>public</code>文件夹中的<a href="https://nextjs.org/docs/basic-features/static-file-serving">静态资产</a>:</p>
<pre>&lt;img className="homepage-img" src="/glass-building-at-the-end-of-a-shadowed-street.jpg" alt="" /&gt;
</pre>
<p>但现在它已经更新为从 Sanity.io 获取数据:</p>
<pre>&lt;img className="homepage-img" src={homepageData.image.url} alt={homepageData.subtitle} /&gt;
</pre>
<h2>通过 Sanity.io 和 Next.js 向前发展</h2>
<p>这篇文章中分享的主题和想法是使用 Sanity.io 进行结构化内容管理以及它如何与 Next.js 集成的基础。在这篇文章中，完整的存储库被分成单独的提交，但是您可以在 GitHub 上查看<a href="https://github.com/adebiyial/next-with-sanity-demo">完整的最终演示存储库。</a></p>
<p>Sanity.io 还提供了比本文更多的特性和功能，官方文档是开始了解更多的好地方。</p><div class="code-block code-block-30">
<div class="blog-plug inline-plug next-plug"><h2><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank"> LogRocket </a>:全面了解生产 Next.js 应用</h2><p>调试下一个应用程序可能会很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪状态、自动显示 JavaScript 错误、跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-lazy-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/></noscript></a><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><p>LogRocket 就像是网络和移动应用的 DVR，记录下你的 Next.js 应用上发生的一切。您可以汇总并报告问题发生时应用程序的状态，而不是猜测问题发生的原因。LogRocket 还可以监控应用程序的性能，报告客户端 CPU 负载、客户端内存使用等指标。</p><p>LogRocket Redux 中间件包为您的用户会话增加了一层额外的可见性。LogRocket 记录 Redux 存储中的所有操作和状态。</p><p>让您调试 Next.js 应用的方式现代化— <a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div></div>

<p class="clearfix"/>
 <p class="clearfix"/>
</article>

</div>    
</body>
</html>