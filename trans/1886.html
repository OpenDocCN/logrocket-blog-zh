<html>
<head>
<title>Exploring the new Stripe React Native SDK - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>探索新的 Stripe React Native SDK - LogRocket 博客</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/exploring-the-new-stripe-react-native-sdk/#0001-01-01">https://blog.logrocket.com/exploring-the-new-stripe-react-native-sdk/#0001-01-01</a></blockquote><div><article class="article-post">
 <h2>介绍</h2>
<p>尽管 Stripe 只是第二大最受欢迎的支付网关(PayPal 仍然是第一)，但它正受到全球新老公司的稳步增长的使用。据报道，Stripe 已经处理了价值超过 2000 亿美元的交易。</p>
<p>尽管有很多其他支付处理器，Stripe 可以轻松处理国际交易，尤其是当您希望接受美元、英镑、欧元或任何其他国际货币的支付时。</p>
<p>随着官方<a href="https://github.com/stripe/stripe-react-native" target="_blank" rel="noopener"> Stripe React Native SDK </a>的发布，在 React Native 应用中通过 Stripe 接受支付或设置订阅变得更加容易。虽然 SDK 仍处于测试阶段，但深入研究该 SDK 所提供的功能以及它如何减少集成时间和增强 UI/UX 是很有意义的。</p>
<p>在本教程中，我将向您展示如何使用新发布的官方 Stripe React Native SDK 接受付款。</p>
<p>以下是我们将要介绍的内容:</p>
<ul>
<li>什么是条纹？</li>
<li>条带反应原生 SDK</li>
<li>设置条带帐户</li>
<li>构建 React 原生条纹应用</li>
<li>构建支付屏幕</li>
</ul>
<p>要跟随 React 原生样式教程，您应该具备:</p>
<ul>
<li>熟悉 CSS、HTML 和 Javascript (ES6)</li>
<li>Node.js 和 Watchman 安装在您的开发机器上</li>
<li>用于测试的 iOS 模拟器或 Android 模拟器</li>
<li>安装在开发机器上的代码编辑器(例如 VS Code)</li>
<li>对 React 的基本理解</li>
</ul>
<h2>什么是条纹？</h2>
<p>Stripe 是一项金融和软件服务，帮助软件开发商和电子商务公司通过其 API 实现无缝支付。你可以称 Stripe 为软件即服务(SaaS)公司。</p>
<p>随着金融科技不断获得全球新老 SaaS 公司的青睐，<a href="https://trends.builtwith.com/payment/Stripe" target="_blank" rel="noopener">在线发布的三分之一付费服务</a>使用 Stripe 作为支付选项。深入了解如何在 React 原生应用中集成 Stripe 将是减少 iOS 和 Android 应用中支付集成麻烦的最佳方式。</p>
<h2>条带反应原生 SDK</h2>
<p>既然您已经了解了 Stripe 是什么，那么开始使用 Stripe API 的最佳方式就是通读这里的官方<a href="https://stripe.com/docs" target="_blank" rel="noopener"> Stripe 文档</a>。</p>
<p>但是你猜怎么着？Stripe React Native SDK 可以减少大约 60%进程。</p>
<p>让我们探索 Stripe React Native SDK，看看它能提供什么。下面是 v0.1.2 版本附带的特性列表。</p>
<h3>安全性</h3>
<p>Stripe React Native SDK 可以帮助您收集信用卡号码等敏感数据，并通过将数据发送到 Stripe 的 API 而不是通过后端服务器来安全地接受支付。</p>
<h3>Apple Pay 和其他支付方式</h3>
<p>SDK 支持多种支付方式，如银行转账、借记和重定向；信用卡；现在购买，以后付款；凭证；和数字钱包。它还支持 Apple Pay。你可以在这里阅读 Stripe 关于<a href="https://stripe.com/docs/apple-pay" target="_blank" rel="noopener">整合 Apple pay 的官方文档，以及</a><a href="https://stripe.com/docs/payments/payment-methods/overview" target="_blank" rel="noopener">如何在这里</a>整合其他支付方式。</p>
<h3>SCA 就绪</h3>
<p>默认情况下，SDK 根据 Stripe 提供的强客户身份认证执行 3D 身份认证。点击阅读更多关于<a href="https://stripe.com/docs/payments/3d-secure" target="_blank" rel="noopener">卡认证和条带 3D 安全的信息。</a></p>
<h3>本机用户界面</h3>
<p>Stripe React Native SDK 附带了原生屏幕和元素，可以在 Android 和 iOS 中安全地接受支付。</p>
<h3>预建支付用户界面(测试版)</h3>
<p>SDK 支持 Stripe 提供的预建支付 ui。该功能处于测试阶段，支持 Apple Pay、Google Pay 和卡支付 ui。然而，有计划在未来建立对更多支付选项的支持。你可以在这里阅读<a href="https://stripe.com/docs/payments/accept-a-payment" target="_blank" rel="noopener">条纹支付 ui。</a></p>
<p>在这些教程中，我们将通过在 React 本地应用程序中构建和测试支付屏幕来探索上面列出的一些功能。让我们开始下一部分。</p>
<h2>设置条带帐户</h2>
<p>每个 SDK 都需要个人访问密钥，Stripe 也不例外。要继续学习 React Native 教程，我们必须创建一个 Stripe 帐户，并获取我们的个人密钥，以便接受付款。</p>
<p>第一步是访问<a href="https://dashboard.stripe.com/register" target="_blank" rel="noopener">https://dashboard.stripe.com/register</a>，创建一个帐户，或者登录到您现有的帐户。</p>
<p>接下来，获取您的公钥。请确保您的密钥是私有的；这是您的 Stripe 帐户的访问密钥。</p>
<p>下面的屏幕截图显示了您可以在 Stripe 帐户中找到您的公钥的位置:</p>
<p><img data-attachment-id="55261" data-permalink="https://blog.logrocket.com/exploring-the-new-stripe-react-native-sdk/stripe-access-key-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Stripe-access-key-page.png" data-orig-size="1272,592" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Stripe-access-key-page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Stripe-access-key-page-300x140.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Stripe-access-key-page-1024x477.png" decoding="async" class="size-full wp-image-55261 aligncenter jetpack-lazy-image" src="../Images/bc5320bc7b2f02343b4e8178ad7ff0d3.png" alt="Screenshot of Stripe website where one can find their access key" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/Stripe-access-key-page.png 1272w, https://blog.logrocket.com/wp-content/uploads/2021/06/Stripe-access-key-page-300x140.png 300w, https://blog.logrocket.com/wp-content/uploads/2021/06/Stripe-access-key-page-1024x477.png 1024w, https://blog.logrocket.com/wp-content/uploads/2021/06/Stripe-access-key-page-768x357.png 768w" data-lazy-sizes="(max-width: 1272px) 100vw, 1272px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/06/Stripe-access-key-page.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/Stripe-access-key-page.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="55261" data-permalink="https://blog.logrocket.com/exploring-the-new-stripe-react-native-sdk/stripe-access-key-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Stripe-access-key-page.png" data-orig-size="1272,592" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Stripe-access-key-page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Stripe-access-key-page-300x140.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Stripe-access-key-page-1024x477.png" decoding="async" loading="lazy" class="size-full wp-image-55261 aligncenter" src="../Images/bc5320bc7b2f02343b4e8178ad7ff0d3.png" alt="Screenshot of Stripe website where one can find their access key" srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/Stripe-access-key-page.png 1272w, https://blog.logrocket.com/wp-content/uploads/2021/06/Stripe-access-key-page-300x140.png 300w, https://blog.logrocket.com/wp-content/uploads/2021/06/Stripe-access-key-page-1024x477.png 1024w, https://blog.logrocket.com/wp-content/uploads/2021/06/Stripe-access-key-page-768x357.png 768w" sizes="(max-width: 1272px) 100vw, 1272px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/Stripe-access-key-page.png"/></noscript>
<h2>React 原生条纹应用</h2>
<p>现在您已经创建了您的 Stripe 帐户并获得了您的公钥，让我们初始化一个新的 React Native 应用程序并安装 Stripe React Native SDK。</p>
<p>导航到您的开发目录并粘贴下面的命令，以安装一个全新的 React 本机应用程序:</p>
<pre>npx react-native StripeReactNative
</pre>
<p>安装完成后，通过终端导航到<code>StripeReactNative</code>，粘贴下面的代码，在你的应用中安装 Stripe React Native SDK 包:</p>
<pre>yarn add @stripe/stripe-react-native
or
npm install @stripe/stripe-react-native
</pre>
<p>Stripe React Native SDK 对 Android 和 iOS 上的支持有一些要求。您可以在此处参考它们:</p>
<p>机器人</p>
<ul>
<li>Android 5.0 (API 等级 21)及以上</li>
<li>Android Gradle 插件 4.x 及以上版本</li>
</ul>
<p>ios</p>
<ul>
<li>兼容以 iOS 11 或以上版本为目标的应用。</li>
</ul>
<h2>使用 iOS 安装</h2>
<p>在 iOS 中安装 Stripe React Native SDK 比在 Android 中要复杂一些。</p>
<p>为了避免通过 npm 安装软件包后出现错误，请在<code>XCode</code>中打开您的<code>StripeReactNative.xcworkspace</code>,并将您的部署目标设置为<code>iOS 11.0.</code>。参见下面的截图示例:</p>
<p><img data-attachment-id="55265" data-permalink="https://blog.logrocket.com/exploring-the-new-stripe-react-native-sdk/ios-deployment-target-xcode/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/ios-deployment-target-xcode.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="ios-deployment-target-xcode" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/ios-deployment-target-xcode-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/ios-deployment-target-xcode.png" decoding="async" class="size-full wp-image-55265 aligncenter jetpack-lazy-image" src="../Images/d22fe16ee04af1e536277fac8fd974f1.png" alt="Screenshot of iOS deployment target folder in XCode" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/ios-deployment-target-xcode.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/ios-deployment-target-xcode-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/06/ios-deployment-target-xcode.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/ios-deployment-target-xcode.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="55265" data-permalink="https://blog.logrocket.com/exploring-the-new-stripe-react-native-sdk/ios-deployment-target-xcode/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/ios-deployment-target-xcode.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="ios-deployment-target-xcode" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/ios-deployment-target-xcode-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/ios-deployment-target-xcode.png" decoding="async" loading="lazy" class="size-full wp-image-55265 aligncenter" src="../Images/d22fe16ee04af1e536277fac8fd974f1.png" alt="Screenshot of iOS deployment target folder in XCode" srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/ios-deployment-target-xcode.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/ios-deployment-target-xcode-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/ios-deployment-target-xcode.png"/></noscript>
<p>从 Xcode 运行您的项目以确保所有更改都已应用，然后导航到 iOS 文件夹。打开<code>podfile</code>，更新<code>platform :ios, '10.0'</code>为<code>platform :ios, '11.0'</code>，运行<code>pod install</code>。这将为 iOS 安装条带本机依赖项。</p>
<p>接下来，让我们从<code>App.js</code>中去掉默认的 React 原生代码。用下面的代码更新<code>App.js</code>文件:</p>
<pre>/**
 * Sample React Native App
 * https://github.com/facebook/react-native
 *
 * @format
 * @flow strict-local
 */
import React from 'react';
import {
  SafeAreaView,
  StyleSheet,
} from 'react-native';


const App = ()  =&gt; {
  return (
    &lt;SafeAreaView&gt;
    &lt;/SafeAreaView&gt;
  );
};
const styles = StyleSheet.create({
});
export default App;
</pre>
<p>如果您运行该应用程序，您应该会看到一个类似于下图的空白屏幕:</p>
<p><img data-attachment-id="55268" data-permalink="https://blog.logrocket.com/exploring-the-new-stripe-react-native-sdk/xcode-blank-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/xcode-blank-app.png" data-orig-size="1270,707" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="xcode-blank-app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/xcode-blank-app-300x167.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/xcode-blank-app-1024x570.png" decoding="async" class="size-full wp-image-55268 aligncenter jetpack-lazy-image" src="../Images/b916b9bf09696b5c9616eaf5585a24c4.png" alt="Screenshot of blank white app screen in xcode" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/xcode-blank-app.png 1270w, https://blog.logrocket.com/wp-content/uploads/2021/06/xcode-blank-app-300x167.png 300w, https://blog.logrocket.com/wp-content/uploads/2021/06/xcode-blank-app-1024x570.png 1024w, https://blog.logrocket.com/wp-content/uploads/2021/06/xcode-blank-app-768x428.png 768w" data-lazy-sizes="(max-width: 1270px) 100vw, 1270px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/06/xcode-blank-app.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/xcode-blank-app.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="55268" data-permalink="https://blog.logrocket.com/exploring-the-new-stripe-react-native-sdk/xcode-blank-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/xcode-blank-app.png" data-orig-size="1270,707" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="xcode-blank-app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/xcode-blank-app-300x167.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/xcode-blank-app-1024x570.png" decoding="async" loading="lazy" class="size-full wp-image-55268 aligncenter" src="../Images/b916b9bf09696b5c9616eaf5585a24c4.png" alt="Screenshot of blank white app screen in xcode" srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/xcode-blank-app.png 1270w, https://blog.logrocket.com/wp-content/uploads/2021/06/xcode-blank-app-300x167.png 300w, https://blog.logrocket.com/wp-content/uploads/2021/06/xcode-blank-app-1024x570.png 1024w, https://blog.logrocket.com/wp-content/uploads/2021/06/xcode-blank-app-768x428.png 768w" sizes="(max-width: 1270px) 100vw, 1270px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/xcode-blank-app.png"/></noscript>
<h2>构建支付屏幕</h2>
<p>现在我们已经成功安装了 SDK，让我们继续构建我们的第一个支付屏幕。</p>
<h3>构建卡组件</h3>
<p>首先，在 React 本地应用程序的根目录下创建一个名为<code>screens</code>的新文件夹。</p>
<p>导航到该文件夹并创建一个名为<code>paymentScreen.js</code>的新文件，然后粘贴以下代码:</p>
<pre>import React, {useState} from "react";
import {
    CardField,
    CardFieldInput,
    useStripe,
  } from '@stripe/stripe-react-native';

  export default PaymentScreen = () =&gt; {
    const [card, setCard] = useState(CardFieldInput.Details | null);
    const {confirmPayment, handleCardAction} = useStripe()
    return(
        &lt;CardField
      postalCodeEnabled={true}
      placeholder={{
        number: '4242 4242 4242 4242',
      }}
      cardStyle={{
        backgroundColor: '#FFFFFF',
        textColor: '#000000',
      }}
      style={{
        width: '100%',
        height: 50,
        marginVertical: 30,
      }}
      onCardChange={(cardDetails) =&gt; {
        setCard(cardDetails);
      }}
      onFocus={(focusedField) =&gt; {
        console.log('focusField', focusedField);
      }}
    /&gt;
    )
  }
</pre>
<p>接下来，让我们将<code>paymentScreen.js</code>导入到我们项目的根中。</p>
<p>打开<code>App.js</code>并更新其代码，如下所示:</p>
<pre>/**
 * Sample React Native App
 * https://github.com/facebook/react-native
 *
 * @format
 * @flow strict-local
 */
import React from 'react';
import {
  SafeAreaView,
  StyleSheet,
} from 'react-native';
import { StripeProvider } from '@stripe/stripe-react-native';
import PaymentScreen from "./screens/paymentScreen";
const App = ()  =&gt; {
  const publishableKey = "pk_test_AtN3VLAFhzbLNqf3Y9z50iNQ";
  return (
    &lt;StripeProvider
      publishableKey={publishableKey}
    &gt;
      &lt;PaymentScreen /&gt;
    &lt;/StripeProvider&gt;
  );
};
const styles = StyleSheet.create({
});
export default App;
</pre>
<p>让我们运行我们的应用程序来测试我们到目前为止已经构建了什么。运行<code>npx react-native run-ios</code>来运行 iOS 的构建。</p>
<p>您可能会遇到一个<code>undefined symbols for architecture x86_64</code>错误，但是不要惊慌！要修复错误，请按照以下步骤操作:</p>
<pre>LIBRARY_SEARCH_PATHS = (
remove: "\"$(TOOLCHAIN_DIR)/usr/lib/swift/$(PLATFORM_NAME)\"",
remove: "\"$(TOOLCHAIN_DIR)/usr/lib/swift-5.0/$(PLATFORM_NAME)\"",
"\"$(inherited)\"",
);
</pre>
<p>在<code>Xcode</code>中打开你的项目，新建一个 Swift 文件(<strong>文件</strong> &gt; <strong>新建</strong> &gt; <strong>文件</strong> &gt; <strong> Swift </strong>)。将文件命名为任意名称(如<code>Fix.swift</code>)，并在 Xcode 提示时选择<strong>创建桥接头</strong>。</p>
<p>再次运行<code>npx react-native run-ios</code>，错误将被修复。如果成功，您的应用程序在加载后应该看起来像下面的屏幕截图:</p>
<p><img data-attachment-id="55269" data-permalink="https://blog.logrocket.com/exploring-the-new-stripe-react-native-sdk/credit-card-info-entry-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-entry-app.png" data-orig-size="730,409" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Credit-card-info-entry-app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-entry-app-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-entry-app.png" decoding="async" class="size-full wp-image-55269 aligncenter jetpack-lazy-image" src="../Images/4ae0ac30db9595cb9f5242d214746659.png" alt="Screenshot of an app with blank white screen and single credit card info entry form in Xcode" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-entry-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-entry-app-300x168.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-entry-app.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-entry-app.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="55269" data-permalink="https://blog.logrocket.com/exploring-the-new-stripe-react-native-sdk/credit-card-info-entry-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-entry-app.png" data-orig-size="730,409" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Credit-card-info-entry-app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-entry-app-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-entry-app.png" decoding="async" loading="lazy" class="size-full wp-image-55269 aligncenter" src="../Images/4ae0ac30db9595cb9f5242d214746659.png" alt="Screenshot of an app with blank white screen and single credit card info entry form in Xcode" srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-entry-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-entry-app-300x168.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-entry-app.png"/></noscript>
<p>我们刚刚创建了一个简单的卡组件，它将卡的详细信息直接发送到 Stripe 服务器进行实时验证，并随后存储组件的状态。</p>
<h2>预构建的用户界面(单步)</h2>
<p>该功能结合了使用信用卡详细信息接受 Stripe 付款的所有步骤。这种集成需要一个端点从您的服务器与 Stripe API 进行通信。</p>
<h3>创建端点</h3>
<p>要设置服务器与 React Native 中的 Stripe 通信，我们需要用<code>install express body-parser</code>和<code>dotenv</code>初始化一个新的<code>node.js</code>应用。</p>
<p>创建一个名为<code>server</code>的新文件夹，导航到该文件夹，运行<code>npm init -y</code>，并按照说明创建一个新的节点应用程序。然后，运行<code>npm i express body-parser dotenv</code>。</p>
<p>最后，在服务器文件夹的根级别创建一个<code>server.js</code>文件，并将下面的代码粘贴到该文件中:</p>
<pre>require("dotenv").config();
const express = require("express");
const app = express();
const { resolve } = require("path");
const stripe = require("stripe")(process.env.secret_key); // https://stripe.com/docs/keys#obtain-api-keys
app.use(express.static("."));
app.use(express.json());
// An endpoint for your checkout 
app.post("/checkout", async (req, res) =&gt; { 
  // Create or retrieve the Stripe Customer object associated with your user.
  let customer = await stripe.customers.create(); // This example just creates a new Customer every time

  // Create an ephemeral key for the Customer; this allows the app to display saved payment methods and save new ones
  const ephemeralKey = await stripe.ephemeralKeys.create(
    {customer: customer.id},
    {apiVersion: '2020-08-27'}
  );  

  // Create a PaymentIntent with the payment amount, currency, and customer
  const paymentIntent = await stripe.paymentIntents.create({
    amount: 973,
    currency: "usd",
    customer: customer.id
  });

  // Send the object keys to the client
  res.send({
    publishableKey: process.env.publishable_key, // https://stripe.com/docs/keys#obtain-api-keys
    paymentIntent: paymentIntent.client_secret,
    customer: customer.id,
    ephemeralKey: ephemeralKey.secret
  });
});

app.listen(process.env.PORT, () =&gt;
  console.log(`Node server listening on port ${process.env.PORT}!`)
);
</pre>
<p>不要忘记用下面的代码创建一个<code>.env</code>文件:</p>
<pre>secret_key=Your_Secret_Key
PORT=8000
</pre>
<p>接下来，用下面的代码更新<code>paymentScreen.js</code>,向应用程序添加一个结帐按钮:</p>
<pre>import React, { useState, useEffect } from "react";
import { StyleSheet, Button, View} from 'react-native';
import {
  CardField,
  CardFieldInput,
  useStripe,
} from '@stripe/stripe-react-native';

export default PaymentScreen = () =&gt; {
  const [card, setCard] = useState(CardFieldInput.Details | null);
  const { confirmPayment, handleCardAction } = useStripe()
  const API_URL = "http://localhost:8000";
  const { initPaymentSheet, presentPaymentSheet } = useStripe();
  const [loading, setLoading] = useState(false);

  const fetchPaymentSheetParams = async () =&gt; {
    const response = await fetch(`${API_URL}/checkout`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
    });
    const { paymentIntent, ephemeralKey, customer } = await response.json();
    return {
      paymentIntent,
      ephemeralKey,
      customer,
    };
  };
  const initializePaymentSheet = async () =&gt; {
    const {
      paymentIntent,
      ephemeralKey,
      customer,
    } = await fetchPaymentSheetParams();
    const { error } = await initPaymentSheet({
      customerId: customer,
      customerEphemeralKeySecret: ephemeralKey,
      paymentIntentClientSecret: paymentIntent,
    });
    if (!error) {
      setLoading(true);
    }
  };
  const openPaymentSheet = async () =&gt; {
    const { error } = await presentPaymentSheet({ clientSecret });
    if (error) {
      Alert.alert(`Error code: ${error.code}`, error.message);
    } else {
      Alert.alert('Success', 'Your order is confirmed!');
    }
  };
  useEffect(() =&gt; {
    initializePaymentSheet();
  }, []);
  return (
    &lt;View style={styles.container}&gt;
      &lt;CardField
        postalCodeEnabled={false}
        placeholder={{
          number: '4242 4242 4242 4242',
        }}
        cardStyle={{
          backgroundColor: '#FFFFFF',
          textColor: '#000000',
        }}
        style={{
          width: '100%',
          height: 50,
          marginVertical: 30,
        }}
        onCardChange={(cardDetails) =&gt; {
          setCard(cardDetails);
        }}
        onFocus={(focusedField) =&gt; {
          console.log('focusField', focusedField);
        }}
      /&gt;
        &lt;Button
          style={styles.button}
          disabled={!loading}
          title="Checkout"
          color="#841584"
          onPress={openPaymentSheet}
        /&gt;
        &lt;/View&gt;
  )
}
const styles = StyleSheet.create({
  container: {
     flex: 1,
     padding: 20,
     marginHorizontal: 10,
     marginVertical: 10,
  },
  button: {
     backgroundColor: '#00aeef',
     borderColor: 'red',
     borderWidth: 5,
     borderRadius: 15       
  }
})
</pre>
<p>如上所示，创建一个单独的<code>node.js</code>项目，并用端口 8000 设置服务器。从 React Native 向服务器上的<code>/checkout</code>端点发送一个请求。一旦请求成功，将使用<code>useEffect</code>钩子调用<code>initializePaymentSheet</code>。</p>
<p>在此过程中，按钮保持禁用状态，直到从后端收到响应。请注意，只要您打算与后端服务器通信，您的后端服务器就必须启动并运行。</p>
<p>此时，您的应用程序应该类似于下面的屏幕截图:</p>
<p><img data-attachment-id="55270" data-permalink="https://blog.logrocket.com/exploring-the-new-stripe-react-native-sdk/credit-card-info-checkout-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-checkout-app.png" data-orig-size="1251,710" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Credit-card-info-checkout-app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-checkout-app-300x170.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-checkout-app-1024x581.png" decoding="async" class="size-full wp-image-55270 aligncenter jetpack-lazy-image" src="../Images/f993a7c1f0832919386850e199336a63.png" alt="Screenshot of app with credit card info input and checkout button" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-checkout-app.png 1251w, https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-checkout-app-300x170.png 300w, https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-checkout-app-1024x581.png 1024w, https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-checkout-app-768x436.png 768w" data-lazy-sizes="(max-width: 1251px) 100vw, 1251px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-checkout-app.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-checkout-app.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="55270" data-permalink="https://blog.logrocket.com/exploring-the-new-stripe-react-native-sdk/credit-card-info-checkout-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-checkout-app.png" data-orig-size="1251,710" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Credit-card-info-checkout-app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-checkout-app-300x170.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-checkout-app-1024x581.png" decoding="async" loading="lazy" class="size-full wp-image-55270 aligncenter" src="../Images/f993a7c1f0832919386850e199336a63.png" alt="Screenshot of app with credit card info input and checkout button" srcset="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-checkout-app.png 1251w, https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-checkout-app-300x170.png 300w, https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-checkout-app-1024x581.png 1024w, https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-checkout-app-768x436.png 768w" sizes="(max-width: 1251px) 100vw, 1251px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/06/Credit-card-info-checkout-app.png"/></noscript>
<h2>结论</h2>
<p>按条带反应本机 SDK 非常容易实现。随着对预构建用户界面的支持(包括未来支持更多预构建用户界面的计划)和支付选择，它正成为开发者的最爱。</p><div class="code-block code-block-18">
<div class="blog-plug inline-plug react-native-plug"><h2><a href="https://lp.logrocket.com/blg/react-native-signup"> LogRocket </a>:即时重现 React 原生应用中的问题。</h2><a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/110055665562c1e02069b3698e6cc671.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/110055665562c1e02069b3698e6cc671.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/></noscript></a><p><a href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一款 React 原生监控解决方案，可帮助您即时重现问题、确定 bug 的优先级并了解 React 原生应用的性能。</p><p>LogRocket 还可以向你展示用户是如何与你的应用程序互动的，从而帮助你提高转化率和产品使用率。LogRocket 的产品分析功能揭示了用户不完成特定流程或不采用新功能的原因。</p><p>开始主动监控您的 React 原生应用— <a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer">免费试用 LogRocket】。</a></p><div class="code-block code-block-22">
<div class="blog-plug inline-plug ecomm-plug"><h2><a href="https://lp.logrocket.com/blg/ecommerce-signup"> LogRocket </a>:看看用户为什么不完成你的电子商务流程中的一个步骤的技术和 UX 原因。</h2><a class="signup" href="https://lp.logrocket.com/blg/ecommerce-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d60d88871d85e76e0dcca90f4bbaf78c.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/12/insights-step-2-lg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/12/insights-step-2-lg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d60d88871d85e76e0dcca90f4bbaf78c.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/12/insights-step-2-lg.png"/></noscript></a><p>LogRocket 就像是一个网络和移动应用程序和网站的 DVR，记录你的电子商务应用程序上发生的一切。LogRocket 没有猜测用户不转化的原因，而是主动揭示了阻止你转化的根本原因，比如 JavaScript 错误或死点击。LogRocket 还可以监控应用的性能，报告客户端 CPU 负载、客户端内存使用等指标。</p><p>开始主动监控您的电子商务应用程序— <a class="signup" href="https://lp.logrocket.com/blg/ecommerce-signup" target="_blank" rel="noopener noreferrer">免费试用</a>。</p></div></div>
</div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>