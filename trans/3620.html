<html>
<head>
<title>Advanced page transitions with Next.js and Framer Motion </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用Next.js和Framer Motion实现高级页面过渡</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/advanced-page-transitions-next-js-framer-motion/#0001-01-01">https://blog.logrocket.com/advanced-page-transitions-next-js-framer-motion/#0001-01-01</a></blockquote><div><article class="article-post">
<p>网络变得越来越互动。用户已经开始期望更高水平的交互性来抓住他们的注意力，并诱导他们与页面上的信息互动。吸引注意力的一个关键方法是使用移动和页面转换。这可能听起来像一个内置剪贴画类型页面过渡的PowerPoint幻灯片，但我可以向你保证，这不是我指的！</p>
<p>本文将演示如何使用Next.js和Framer Motion来应用微妙、优雅的页面过渡，为您的站点添加个性和风格。</p>
<p><em>向前跳转:</em></p>

<h2 id="indicating-loading-state">指示装载状态</h2>
<p>页面过渡只是前端开发人员工具箱中的几个工具之一。如果使用得当，页面过渡可以增加用户参与度，甚至在页面加载过程中吸引用户的注意力。</p>
<p>一般来说，网页内容加载速度很快，但是如果你依赖于从服务器上获取数据，应用合适的运动水平的页面过渡可以帮助保持用户参与。</p>
<p>一种选择是添加一个快速加载栏；这为用户提供了反馈，当内容需要额外的几秒钟来加载时，通知他们留在原地，不要离开。</p>
<p>任何超过200毫秒的时间都会被大脑感知为瞬间。然而，让一个页面加载那么快真的很难。通过添加0.5-2秒的页面过渡，您实际上是在为自己争取时间来加载数据并做好准备，这样当下一页出现时，您就可以交付用户请求的内容。</p>
<h2 id="determining-when-to-use-page-transitions">确定何时使用页面过渡</h2>
<p>为了提供最好的UX网站，你需要把用户放在体验的中心，从他们的角度考虑问题。当访问你的网站时，考虑用户需求的背景，并使用这些信息来评估什么级别的页面过渡是可接受的。</p>
<p>前面提到的加载栏几乎可以用于任何类型的网站。加载栏的架构可以是全页面体验，也可以是仅在网页顶部可见的细长组件。但是，不管加载栏的外观如何，它的目的是在加载下一页时指示系统状态。</p>
<p>当用户访问一个信息丰富的网站来消费内容时，他们不希望由于页面转换而变慢。对于用户浏览多个页面的网站来说尤其如此。所以，不要太兴奋，给你的公司网站添加页面过渡！更华丽的页面过渡应该留给本质上更有创造力的网站，因为他们的网站访问者可能期望更多的娱乐。</p>
<h3 id="considering-user-experience">我添加了一些页面过渡，完成了吗？</h3>
<p>一般来说，当动画很微妙，感觉很自然，并且与整个用户体验很好地融合时，它们是最成功的。简单地添加页面过渡可能会感觉不合适，你需要考虑整个页面体验。您可能希望为进入页面的元素添加一些移动效果、交互式悬停效果等等，以便让用户在访问您的网站时保持专注。</p>
<h2 id="building-page-transitions">构建页面过渡</h2>
<p>页面过渡几乎可以构建在任何前端框架或技术中，但是在这个演示中，我们将使用<a href="https://nextjs.org/"> Next.js </a>来提供页面过渡触发动画的提示，并使用<a href="https://www.framer.com/motion/">成帧器动作</a>来实际执行页面过渡。</p>
<p>Framer Motion将自己称为“React的生产就绪运动库”，使用起来很不错。我最喜欢这个库的一点是它实现动画的声明方式。使用“成帧器运动”,您可以声明想要的开始和结束外观，然后库会填充间隙。</p>
<p>从头开始创作动画真的很难。如果你曾经尝试过使用CSS，或者几乎任何其他语言，在React中制作动画，这将变得非常棘手。React会立即卸载正在退出DOM的元素，并且由于该元素已被删除，因此不能在“退出”的过程中对其进行动画处理。当页面改变时，如果有突然的跳跃，页面转换会感觉不正确。这是Framer Motion自动为我们处理的魔法的一部分，尽管有一个实现它的技巧，我将在下面介绍。</p>
<p>好了，让我们投入使用吧！</p>
<h2 id="page-transitions-demo">页面过渡演示</h2>
<p>为了演示如何创建页面过渡，我们将使用Framer Motion构建一个Next.js站点。我们将使用我喜欢的方法来设计站点的样式:Tailwind CSS。</p>
<p>这是我们最终会得到的结果。在Next.js中，每个照片页面都是一个新的(动态)页面，当我们在列表和详细信息页面之间导航时，您可以看到页面转换:</p>
<p><img data-attachment-id="142809" data-permalink="https://blog.logrocket.com/advanced-page-transitions-next-js-framer-motion/attachment/dynamic-pages/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-pages.gif" data-orig-size="730,600" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Dynamic pages" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-pages-300x247.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-pages.gif" decoding="async" class="aligncenter wp-image-142809 size-full jetpack-lazy-image" src="../Images/67cb3482bf65be34b9daa27661382747.png" alt="Dynamic Page Transitions Example in Next.js" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-pages.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-pages.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="142809" data-permalink="https://blog.logrocket.com/advanced-page-transitions-next-js-framer-motion/attachment/dynamic-pages/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-pages.gif" data-orig-size="730,600" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Dynamic pages" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-pages-300x247.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-pages.gif" decoding="async" loading="lazy" class="aligncenter wp-image-142809 size-full" src="../Images/67cb3482bf65be34b9daa27661382747.png" alt="Dynamic Page Transitions Example in Next.js" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/dynamic-pages.gif"/></noscript>
<p>如果您愿意，您也可以获取上面示例的<a href="https://github.com/fbrill/react-page-transitions">源代码</a>来浏览和跟随。</p>
<h3 id="setting-the-scene">设置场景</h3>
<p>为了设置我们的页面转换演示，我们需要理解Next.js的内部工作原理:</p>
<ul>
<li>首先，在页面加载之间有一个持久化的<code>_app.js</code>文件</li>
<li>其次，我们需要使用Next.js <code>&lt;Link&gt;</code>组件来链接页面。这样，Next.js执行了一个浅层呈现，并在卸载之前的组件时装载了新的页面组件，给我们一种类似SPA的感觉，并且能够在页面之间切换，而无需重新加载页面。我们需要这个功能来实现页面转换</li>
<li>如前所述，试图动画化离开DOM的React组件最困难的部分是它们就这样消失了，使得它们几乎不可能被动画化。Framer Motion用一个<code>&lt;AnimatePresence&gt;</code>组件解决了这个问题，这个组件变了一些魔术，使得声明一个可以被动画化的<code>exit</code>状态成为可能</li>
</ul>
<h3 id="starting-a-new-nextjs-site">开始新的Next.js站点</h3>
<p>为了展示我们如何实现动画页面过渡，让我们用Tailwind CSS starter创建一个<a href="https://tailwindcss.com/docs/guides/nextjs"> quick Next.js站点</a>来处理我们的样式。</p>
<p>接下来，我们需要安装帧运动，就像这样:</p>
<pre class="language-javascript hljs">yarn add framer-motion
</pre>
<h3 id="adding-animatepresence">添加<code>AnimatePresence</code></h3>
<p>现在，我们将设置页面过渡。首先，我们将动画演示添加到<code>_app.js</code>:</p>
<pre class="language-javascript hljs">// _app.js

import { AnimatePresence } from 'framer-motion'

function MyApp({ Component, pageProps, router }) {
  return (
    &lt;AnimatePresence mode="wait" initial={false}&gt;
      &lt;Component {...pageProps} key={router.asPath} /&gt;
    &lt;/AnimatePresence&gt;
  );
}
</pre>
<p>接下来，我们需要用<code>&lt;AnimatePresence&gt;</code>包装我们的<code>&lt;Component&gt;</code>。</p>
<p>这里是我在这个演示中启用的另外两个可选设置:</p>
<ol>
<li><code>mode="wait"</code>:这只是告诉Framer Motion在新组件上开始新动画(新页面)之前完成任何退出动画(退出页面)。</li>
<li><code>initial</code>:设置为<code>false</code>意味着在第一次页面加载时不会播放动画，这样感觉更好。</li>
</ol>
<p>这里的一个关键点是确保你的动画元素是<code>AnimatePresence</code>的直接子元素，这样在从React树中移除元素之前，它可以接管并动画化任何退出事件。</p>
<p>因为我们在<code>_app.js</code>中声明了<code>AnimatePresence</code>并且<code>AnimatePresence</code>激活了直接子元素，所以我们需要提供我们要返回唯一键的<code>&lt;Component&gt;</code>。最初，这让我犯了一个错误。我通过添加页面路径作为键来解决这个问题，以确保它总是唯一的。这样，React会将每个页面注册为一个不同的组件，并且可以在动画显示新组件的入口之前动画显示出口。</p>
<h3 id="creating-a-shared-layout-component">创建共享布局组件</h3>
<p>一旦包装器在<code>_app.js</code>中就位，我们将需要创建实际上是动画的子页面元素。我们可以创建一个共享的<code>&lt;Layout&gt;</code>组件来包装我们想要制作动画的所有页面，而不是在每个页面上都这样做:</p>
<pre class="language-javascript hljs">// components/Layout/index.js

import { motion } from "framer-motion";

const Layout = ({ children }) =&gt; (
  &lt;motion.div
    initial={{ x: 300, opacity: 0 }}
    animate={{ x: 0, opacity: 1 }}
    exit={{ x: 300, opacity: 0 }}
    transition={{
      type: "spring",
      stiffness: 260,
      damping: 20,
    }}
  &gt;
    {children}
  &lt;/motion.div&gt;
);
export default Layout;
</pre>
<p>这些是很好的默认设置，但是你也可以<a href="https://www.framer.com/docs/component/">探索</a>其他的声明性属性。例如，您可以使用<code>initial</code>来指定一个过渡起点，元素应该“来自”那里，而<code>animate</code>将指定您希望事情结束的“结束状态”，<code>exit</code>用于指定动画组件应该结束的目标位置。</p>
<p>这些属性可以用来微调任何页面过渡，以及<code>transition</code>属性本身。如果这些名字听起来令人困惑，您也可以定义自己的<code><a href="https://www.framer.com/docs/component/###variants">variants</a></code>以便更容易理解。</p>
<h3 id="using-the-layout-component">使用布局组件</h3>
<p>接下来，我们需要在所有想要制作动画的页面上使用布局组件；这些可以是静态页面，也可以是动态路径——这真的无关紧要。</p>
<p>Make this是包装任何子组件的第一个组件，以确保它是<code>&lt;AnimatePresence&gt;</code>的直接后代:</p>
<pre class="language-javascript hljs">// pages/index.js

import Layout from "../components/Layout";

export default function Home() {
  return (
    &lt;Layout&gt;
        // ....
        // Page content goes here
        // ....
    &lt;/Layout&gt;
  );
}
</pre>
<p>有了上面的主页的简化标记，我只是向你展示了让页面过渡工作所需的东西。在多个页面上执行此操作并链接到它们将导致页面转换，并且实际组件中的任何内容都将随着页面转换而动画化。</p>

<p>在我的例子中，很难看出过渡在开始时是否有效，因为页面没有那么长。但是看看移动体验，很清楚发生了什么。一旦我们向下滚动并转换到新页面，Next.js就保持这个位置，并且我们到达新页面的中间。这显然不是很好的用户体验:</p>
<p><img data-attachment-id="142811" data-permalink="https://blog.logrocket.com/advanced-page-transitions-next-js-framer-motion/attachment/scrolling-through-pages/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/scrolling-through-pages.gif" data-orig-size="410,794" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Scrolling through pages" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/scrolling-through-pages-155x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/scrolling-through-pages.gif" decoding="async" class="aligncenter wp-image-142811 size-full jetpack-lazy-image" src="../Images/992b90a2fe6aaf151b45b994dae452fb.png" alt="Next.js Page Transitions on Mobile" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/scrolling-through-pages.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/scrolling-through-pages.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="142811" data-permalink="https://blog.logrocket.com/advanced-page-transitions-next-js-framer-motion/attachment/scrolling-through-pages/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/scrolling-through-pages.gif" data-orig-size="410,794" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Scrolling through pages" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/scrolling-through-pages-155x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/scrolling-through-pages.gif" decoding="async" loading="lazy" class="aligncenter wp-image-142811 size-full" src="../Images/992b90a2fe6aaf151b45b994dae452fb.png" alt="Next.js Page Transitions on Mobile" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/scrolling-through-pages.gif"/></noscript>
<p>修复这个问题很容易，因为我们可以在根<code>&lt;AnimatePresence&gt;</code>上添加任何<code>onExitComplete</code>函数。我们只需在退出动画完成后将窗口滚动回顶部，无论页面长度如何，新页面都将从顶部开始:</p>
<pre class="language-javascript hljs">// _app.js

&lt;AnimatePresence
  mode="wait"
  initial={false}
  onExitComplete={() =&gt; window.scrollTo(0, 0)}
&gt;
</pre>
<h2 id="bonus-tip-loading-page-transitions">额外提示:加载页面过渡</h2>
<p>正如我在本指南开头提到的，页面转换也可以作为页面加载器，有助于在获取数据时保持用户的注意力。</p>
<p>Next.js为我们提供了一些<code>Router</code>事件，我们可以使用这些事件来创建这个:</p>
<pre class="language-javascript hljs">// _app.js

import { useState, useEffect } from "react"
import Router from "next/router"
import PageLoader from "../components/PageLoader"

const App = ({ Component, pageProps }) =&gt; {
  const [loading, setLoading] = useState(false)
  useEffect(() =&gt; {
    // Used for page transition
    const start = () =&gt; {
      setLoading(true)
    }
    const end = () =&gt; {
      setLoading(false)
    }
    Router.events.on("routeChangeStart", start)
    Router.events.on("routeChangeComplete", end)
    Router.events.on("routeChangeError", end)
    return () =&gt; {
      Router.events.off("routeChangeStart", start)
      Router.events.off("routeChangeComplete", end)
      Router.events.off("routeChangeError", end)
    }
  }, [])

  return loading ? &lt;PageLoader /&gt; : &lt;Component {...pageProps} /&gt;
}
export default App
</pre>
<p>我们使用Next.js <code>Router</code>事件来设置一个本地状态变量，以指示加载状态。从那里，我们可以决定如何处理该指标。在这个例子中，有一个不同的组件将被呈现为一个完整的页面加载器，它可以被分别设置样式和动画。</p>
<h2 id="conclusion">结论</h2>
<p>在这篇文章中，我们研究了何时以及为什么你会考虑在你的站点上添加页面过渡。我们演示了如何使用Next.js和Framer Motion创建和添加页面过渡。我们还研究了一种不同的方法，使用页面加载器作为间隙加载状态，作为页面转换。如果你尝试这种方法，用下面的评论让我知道你是如何找到它的！</p><div class="code-block code-block-30">
<div class="blog-plug inline-plug next-plug"><h2><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank"> LogRocket </a>:全面了解生产Next.js应用</h2><p>调试下一个应用程序可能会很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪状态、自动显示JavaScript错误、跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-lazy-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/></noscript></a><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><p>LogRocket 就像是网络和移动应用的DVR，记录下你的Next.js应用上发生的一切。您可以汇总并报告问题发生时应用程序的状态，而不是猜测问题发生的原因。LogRocket还可以监控应用程序的性能，报告客户端CPU负载、客户端内存使用等指标。</p><p>LogRocket Redux中间件包为您的用户会话增加了一层额外的可见性。LogRocket记录Redux存储中的所有操作和状态。</p><p>让您调试Next.js应用的方式现代化— <a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>