<html>
<head>
<title>Developing and deploying Tezos smart contracts - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>开发和部署Tezos智能合约- LogRocket博客</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/developing-deploying-tezos-smart-contracts/#0001-01-01">https://blog.logrocket.com/developing-deploying-tezos-smart-contracts/#0001-01-01</a></blockquote><div><article class="article-post">
<p>Tezos是最古老的智能合同区块链之一，以太坊是第一个。</p>
<p>虽然以太坊是开发人员开发和部署智能合约的热门选择，但由于高费用和缓慢的交易，其应用程序的可扩展性不是很好。相比之下，Tezos应用程序非常高效，安装成本也很低。</p>
<p>在本指南中，您将了解如何使用SmartPy CLI在Tezos中开发和部署智能合同。我们将涵盖:</p>

<p>你可以在<a href="https://github.com/TheGhoulRe/tezos-smart-contract" target="_blank" rel="noreferrer noopener">这个GitHub repo </a>中获得最终项目的代码。</p>
<h2 id="prerequisites">先决条件</h2>
<p>要阅读本文，您需要熟悉Tezos区块链。你的知识不一定要深入。</p>
<p>以太坊区块链的知识不是必需的，但它很有帮助。</p>
<h2 id="what-tezos">Tezos是什么？</h2>
<p>Tezos是一个区块链网络和一个智能合同平台，通过其治理模式和自我升级能力来适应。</p>
<p>虽然Tezos和以太坊类似于支持智能合约和DApp开发的区块链，但它们在几个方面有所不同。下面的Tezos vs. Ethereum表显示了这两个网络之间的一些差异。</p>
<h3 id="tezos-vs-ethereum-comparison-chart">Tezos vs .以太坊:对比图</h3>
<table>
<tbody>
<tr>
<td><strong>泰佐斯</strong></td>
<td><strong>以太坊</strong></td>
</tr>
<tr>
<td>开发人员提议升级网络上的区块链协议</td>
<td>开发者使用硬盘来升级区块链协议</td>
</tr>
<tr>
<td>利益攸关方通过投票接受或拒绝提案来控制对《区块链议定书》的升级</td>
<td>区块链网络的创建者负责管理区块链协议的升级</td>
</tr>
<tr>
<td>使用正式验证来执行智能合同</td>
<td>使用EVM在网络上存储和执行智能合同</td>
</tr>
<tr>
<td>参与者(节点)可以选择提供计算资源或委托他们的令牌来参与验证事务</td>
<td>所有参与者(节点)必须提供计算资源并投入他们的硬币来参与交易验证</td>
</tr>
<tr>
<td>汽油费很低，这使得它非常具有可扩展性</td>
<td>汽油费真的很高，这使得它无法扩展</td>
</tr>
</tbody>
</table>
<h2 id="what-smartpy">什么是SmartPy？</h2>
<p>SmartPy是一个工具，可以让您在Tezos区块链上轻松建立智能合同。</p>
<p>使用Python在SmartPy中编写合同。如果你已经熟悉Python，你就不必学习新的<a href="https://blog.logrocket.com/smart-contract-programming-languages/" target="_blank" rel="noreferrer noopener">智能契约编程语言</a>。</p>
<p>SmartPy还有另外两种使用其他语法的变体:SmartTS使用TypeScript，SmartML使用OCaml。</p>
<p>SmartPy将Python脚本编译成迈克尔逊。Michelson是Tezos中智能合约的低级编程语言。SmartTS和SmartML也可以使用SmartPy工具进行编译。</p>
<h2 id="what-smart-contracts">什么是智能合约？</h2>
<p>智能合同是你可以在区块链网络上构建、部署和执行的程序。在部署智能合约之前，您不需要在网络上拥有一个节点。</p>
<p>借助智能合约，您可以构建所有设备都可以访问的应用程序，而无需拥有或维护服务器。这些完全分散的应用程序几乎不需要维护。</p>
<p>智能合约充分利用了区块链的潜力，允许你在链上执行程序，并与链本身进行交互。您可以持有或转让代币，并通过智能合约访问区块链上的专业功能。</p>
<h2 id="getting-started-smartpy-cli">smarty cli入门</h2>
<p>要安装SmartPy CLI，请运行以下命令:</p>
<pre class="language-bash hljs">$ bash &lt;(curl -s https://smartpy.io/cli/install.sh)
</pre>
<p>该命令在<code>home</code>中创建一个<code>smartpy-cli</code>目录，树形结构如下:</p>
<pre class="language-python hljs">smartpy-cli
├── browser.py
├── node_modules/
├── originator.js
├── package.json
├── package-lock.json
├── __pycache__/
├── smart.css
├── smart.js
├── smartpyc.js
├── smartpyc.py
├── smartpyio.py
├── smartpy.py
├── SmartPy.sh
├── smarttop/
├── smart-ts-cli.js
├── templates/
├── theme.js
└── typography.css
</pre>
<p>要确认安装，请运行以下命令:</p>
<pre class="language-bash hljs">$ ~/smartpy-cli/SmartPy.sh --version
</pre>
<p>作为使<code>SmartPy.sh</code>易于访问的一个额外步骤，通过将以下内容复制到您的<code>.bashrc</code>文件或相关配置文件中来创建一个别名:</p>
<pre class="language-bash hljs">$ alias smartpy="$HOME/smartpy-cli/SmartPy.sh"
</pre>
<p>现在您可以使用:</p>
<pre class="language-bash hljs">$ smartpy --version
</pre>
<p>而不是:</p>
<pre class="language-bash hljs">$ ~/smartpy-cli/SmartPy.sh --version
</pre>
<h2 id="setting-up-tezos-client">设置<code>tezos-client</code></h2>
<p>本指南使用<code>tezos-client</code>与已部署的智能合同进行交互。要安装<code>tezos-client,</code>,请运行以下命令之一，具体取决于您使用的是Mac还是Linux操作系统:</p>
<pre class="language-bash hljs"># Mac
$ brew tap serokell/tezos-packaging-stable https://github.com/serokell/tezos-packaging-stable.git
$ brew install tezos-client

# Linux
$ wget https://github.com/serokell/tezos-packaging/releases/latest/download/tezos-client
$ chmod +x tezos-client
$ mkdir -p $HOME/.local/bin
$ mv tezos-client $HOME/.local/bin
$ echo 'export PATH="$HOME/.local/bin:$PATH"' &gt;&gt; $HOME/.bashrc
$ source $HOME/.bashrc
</pre>
<p>注意，如果您使用的是Windows，您需要<a href="https://docs.microsoft.com/en-us/windows/wsl/about" target="_blank" rel="noreferrer noopener">安装一个带有wsl </a>的Linux发行版并运行Linux安装。</p>
<p>安装<code>tezos-client</code>后，需要进行设置。通过运行以下命令开始:</p>
<pre class="language-bash hljs">$ tezos-client --endpoint https://jakartanet.ecadinfra.com config update
</pre>
<p>本指南使用Jarkatanet testnet来部署智能合约并与之交互。上面的命令通过网络上的节点<code><a href="https://jakartanet.ecadinfra.com" rel="nofollow">https://jakartanet.ecadinfra.com</a></code>将<code>tezos-client</code>连接到Jakartanet testnet。</p>
<p>在使用<code>tezos-client</code>进行任何操作之前，您需要连接一个帐户。Tezos提供水龙头账户，让你免费与网络互动。</p>
<p>你需要访问<a href="https://teztnets.xyz/jakartanet-faucet" target="_blank" rel="noreferrer noopener"> Jakartanet水龙头网站</a>并下载水龙头文件。完成后，打开终端中的下载文件夹并运行以下命令:</p>
<pre class="language-bash hljs">$ tezos-client activate account faucet with ./jakartanet.json
</pre>
<p>该命令激活您的<code>tezos-client</code>中的水龙头帐户，并给它一个别名<code>faucet</code>。要检查该帐户的余额，请打开<code>jakartanet.json</code>文件，复制<code>pkh</code>的值，然后运行以下命令:</p>
<pre class="language-bash hljs">$ tezos-client get balance for &lt;address&gt;
</pre>
<p>用您复制的<code>pkh</code>值替换<code>&lt;address&gt;</code>。</p>
<p>注意，Tezos水龙头账户对所有人都是公开的，并且有限量的Tez令牌，所以你必须规范你的使用。</p>
<h2 id="developing-tezos-smart-contract-smartpy">与SmartPy开发Tezos智能合约</h2>
<p>要开始创建我们的示例智能合同，请创建一个新的<code>store_text.py</code>文件，并将以下内容复制到其中:</p>
<pre class="language-python hljs">import smartpy as sp

class StoreText(sp.Contract):
    def __init__(self, value):
        self.init(text = value)

    @sp.entry_point
    def replace(self, params):
        self.data.text = params.text

    @sp.entry_point    # Note: the spaces before "@"
    def append(self, params):
        self.data.text += params.text
</pre>
<p>下面是上述合同的工作原理，一点一点来说:</p>
<p>首先，我们导入了<code>smartpy</code>库:</p>
<pre class="language-python hljs">import smartpy as sp
</pre>
<p>然后，我们定义了一个扩展<code>sp.Contract</code>的类:</p>
<pre class="language-python hljs">class StoreText(sp.Contract):
</pre>
<p>最后，我们在智能合约中定义了一些项目；首先，一个构造函数来初始化<code>text</code>:</p>
<pre class="language-python hljs">    def __init__(self, value):    # Note: the spaces before "def"
        self.init(text = value)
</pre>
<p>第二，替换<code>text</code>值的入口点:</p>
<pre class="language-python hljs">    @sp.entry_point    # Note: the spaces before "@"
    def replace(self, params):
        self.data.text = params.text
</pre>
<p>第三，向<code>text</code>追加字符串的入口点:</p>
<pre class="language-python hljs">    @sp.entry_point    # Note: the spaces before "@"
    def append(self, params):
        self.data.text += params.text
</pre>
<p>接下来，我们来看看如何测试智能合约。</p>
<h2 id="testing-tezos-smart-contract">测试Tezos智能合约</h2>
<p>部署到Tezos的智能合约不能更改或删除。这可能是一个问题，因为合同中可能会有错误，而错误可能会导致代价高昂的错误和资金损失。</p>
<p>SmartPy使您能够在部署之前轻松测试您的合同。测试合同不需要任何令牌或钱包帐户来运行。你所需要做的就是打开<code>store_text.py</code>文件并复制下面的内容:</p>
<pre class="language-python hljs">@sp.add_test(name = "StoreText")
def test():
  scenario = sp.test_scenario()
  contract = StoreText("Hello")
  scenario += contract

  scenario.verify(contract.data.text == "Hello")

  contract.replace(text = "Hi")
  contract.append(text = ", there!")
  scenario.verify(contract.data.text == "Hi, there!")
</pre>
<p>下面是代码片段的工作方式。首先，我们注册了一个<code>test</code>函数作为测试脚本:</p>
<pre class="language-python hljs">@sp.add_test(name = "StoreText")
</pre>
<p>然后，我们定义了<code>test</code>函数:</p>
<pre class="language-python hljs">def test():
</pre>
<p>在剩下的几行中，我们创建了一个测试场景:</p>
<pre class="language-python hljs">  scenario = sp.test_scenario()
</pre>
<p>初始化与<code>"Hello"</code>的合同:</p>
<pre class="language-python hljs">  contract = StoreText("Hello")
</pre>
<p>将合同实例添加到场景中:</p>
<pre class="language-python hljs">  scenario += contract
</pre>
<p>已验证合同的<code>text</code>值为<code>"Hello"</code>:</p>
<pre><code>  scenario.verify(contract.data.text == "Hello")
</code></pre>
<p>称为<code>replace</code>和<code>append</code>入口点:</p>
<pre class="language-python hljs">  contract.replace(text = "Hi")
  contract.append(text = ", there!")
</pre>
<p>最后，验证合同的<code>text</code>值现在是<code>"Hi, there"</code>:</p>
<pre class="language-python hljs">  scenario.verify(contract.data.text == "Hi, there!")
</pre>
<p>添加测试后，保存文件并运行以下命令:</p>
<pre class="language-python hljs">$ ~/smartpy-cli/SmartPy.sh test store_text.py ./test-output
</pre>
<p>如果测试成功，编译器不会抛出错误信息。</p>
<h2 id="compiling-smart-contract-michelson">将智能合同编译给迈克尔逊</h2>
<p>在部署您的智能合约之前，您需要将其编译到Michelson。如前所述，Michelson是一种低级编程语言，用于Tezos区块链上的智能合约。</p>
<p>要编译<code>store_text.py</code>，运行以下命令:</p>
<pre class="language-bash hljs">$ ~/smartpy-cli/SmartPy.sh compile message.py ./output
</pre>
<p>如果编译成功，您应该会看到如下所示的<code>output</code>文件夹:</p>
<pre class="language-bash hljs">output/
├── scenario.json
├── script_init.py
├── script_pure.py
└── storeMessage/
    ├── log.txt
    ├── step_000_cont_0_contract.json
    ├── step_000_cont_0_contract.py
    ├── step_000_cont_0_contract.tz
    ├── step_000_cont_0_sizes.csv
    ├── step_000_cont_0_storage.json
    ├── step_000_cont_0_storage.py
    ├── step_000_cont_0_storage.tz
    └── step_000_cont_0_types.py
</pre>
<p><code>output</code>目录包含部署智能合同所需的所有文件。</p><div class="code-block code-block-54">
<hr/>
<h3>更多来自LogRocket的精彩文章:</h3>

<hr/></div>
<h2 id="deploying-tezos-smart-contract">部署Tezos智能合约</h2>
<p>要部署<code>store_text.py</code>，请在终端中打开<code>output/storeMessage</code>文件夹并运行以下命令:</p>
<pre class="language-bash hljs">$ ~/smartpy-cli/SmartPy.sh originate-contract --code step_000_cont_0_contract.json --storage step_000_cont_0_storage.json --rpc https://jakartanet.ecadinfra.com

[INFO] - Using RPC https://jakartanet.ecadinfra.com/...
[INFO] - Contract KT1………………CAjjW originated!!!
</pre>
<p>下面是该命令的工作方式:</p>
<ul>
<li><code>originate-contract</code>告诉<code>tezos-client</code>部署(“发起”)合同</li>
<li><code>--code step_000_cont_0_contract.json</code>指向已编译的合同文件</li>
<li><code>--storage step_000_cont_0_storage.json</code>指向编译后的存储文件</li>
<li><code>--rpc <a href="https://jakartanet.ecadinfra.com" rel="nofollow">https://jakartanet.ecadinfra.com</a></code>指向您要部署到的网络上的RPC节点</li>
</ul>
<p>Tezos智能合同通常包括两个部分:存储和合同。存储保存协定存储的数据，协定保存智能协定的逻辑。</p>
<p>请注意，您可以使用任何协定或存储编译来部署协定。当您使用该命令时，它们必须是相同的文件扩展名。</p>
<p>默认情况下，如果您在testnet上部署，编译器将使用水龙头帐户。如果您正在部署到mainnet或者想要使用您的钱包帐户，请添加<code>--private-key</code>标志，后跟帐户的私钥。</p>
<h2 id="interacting-deployed-smart-contract">与部署的智能合约交互</h2>
<p>在与已部署的智能合约进行交互之前，您需要了解合约当前的样子。为此，<a href="https://smartpy.io/explorer.html" target="_blank" rel="noreferrer noopener">在浏览器</a>中打开SmartPy Explorer，并遵循以下步骤:</p>
<ol>
<li>导航到“备用节点”</li>
<li>将合同的地址粘贴在“合同”输入中</li>
<li>在“浏览特定节点”下，从<code>mainnet</code>切换到<code>jakartanet</code></li>
<li>将RPC URL <code><a href="https://jakartanet.ecadinfra.com" rel="nofollow">https://jakartanet.ecadinfra.com</a></code>粘贴到文本框中</li>
<li>单击“在特定节点上浏览”</li>
</ol>
<p>当合同数据出现时，文本存储器应该显示为“你好，这里！”</p>
<p>现在你知道了合同的文本，你可以把它改成“嗨，你好！”通过用这个命令调用<code>replace</code>入口点:</p>
<pre class="language-bash hljs">$ tezos-client transfer 0 from faucet to &lt;contract-address&gt; --entrypoint replace --arg '"Hi, There!"'
</pre>
<p>如果命令成功，当您刷新资源管理器时，存储现在应该显示“Hi，There！”</p>
<p>注意，在运行该命令之前，必须用已部署契约的地址替换<code>&lt;contract-address&gt;</code>。</p>
<h2 id="conclusion">结论</h2>
<p>本文介绍了使用SmartPy在Tezos上构建智能合约的过程。构建智能合同允许您充分利用区块链网络来构建分散的应用程序和组织。</p>
<p>我希望这篇文章能帮助您理解在Tezos上构建智能合约的过程。如果你想了解更多关于智能合同的信息，看看这篇关于避免的<a href="https://blog.logrocket.com/smart-contract-development-common-mistakes-avoid/" target="_blank" rel="noreferrer noopener">智能合同错误的文章。</a></p>
<p>感谢阅读！祝你愉快。开发和部署Tezos智能合约</p><div class="code-block code-block-26">
<div class="blog-plug inline-plug blockchain-plug"><h2>加入像Bitso和Coinsquare这样的组织，他们使用LogRocket主动监控他们的Web3应用</h2><p>影响用户在您的应用中激活和交易的能力的客户端问题会极大地影响您的底线。如果您对监控UX问题、自动显示JavaScript错误、跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a target="_blank" href="https://lp.logrocket.com/blg/web3-signup">try LogRocket</a><p>.</p><a class="signup" href="https://lp.logrocket.com/blg/web3-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/dacb06c713aec161ffeaffae5bd048cd.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/dacb06c713aec161ffeaffae5bd048cd.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png"/></noscript></a><a href="https://lp.logrocket.com/blg/web3-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用的DVR，记录你的网络应用或网站上发生的一切。您可以汇总和报告关键的前端性能指标，重放用户会话和应用程序状态，记录网络请求，并自动显示所有错误，而不是猜测问题发生的原因。</p><p>现代化您调试web和移动应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/web3-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>