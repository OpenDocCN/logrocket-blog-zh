<html>
<head>
<title>Build an API with Serverless Functions in Next.js - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在Next.js - LogRocket博客中构建一个具有无服务器功能的API</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/build-api-serverless-functions-next-js/#0001-01-01">https://blog.logrocket.com/build-api-serverless-functions-next-js/#0001-01-01</a></blockquote><div><article class="article-post">
<p>Next.js是一个React框架，用于创建预渲染的React网站。这都是通过服务器端呈现或静态站点生成来完成的。</p>
<p>在服务器端呈现(SSR)中，在来自浏览器的页面请求之后，Next.js在服务器上将React组件呈现为HTML页面。在静态站点生成或SSG中，Next.js在构建时将React组件呈现到HTML页面中。我们只需将网页和JavaScript包部署到服务器上。</p>
<p>无论您在Next.js中使用的是SSR还是SSG，React组件在到达浏览器时都已经呈现在HTML页面中了。因此，所有路由都在浏览器中处理，应用程序的行为就像一个单页应用程序(SPA)。与此相反，React通过客户端呈现在浏览器中呈现组件。</p>
<p>有了Next.js，我们得到了SSG和SSR的好处，比如改进的性能和更好的SEO。</p>
<p>在本文中，我们将了解Next.js的另一个伟大特性——无服务器函数。我们将学习如何在专为Next应用设计的平台Vercel上运行无服务器功能。我们将从讨论Next.js页面路由和动态路由开始，稍后在我们的知识基础上学习Next.js API和动态API路由。</p>

<h2 id="introduction-serverless-functions-next-js">Next.js中的无服务器函数介绍</h2>
<p>术语“无服务器功能”只是一种命名约定。AWS称它们为Lambda函数，但Vercel称它们为无服务器函数——它们是一回事。</p>
<p>无服务器函数不是Next.js API的直接组成部分。但是，Next.js为开发者提供了<a href="https://blog.logrocket.com/serverless-deployments-vercel-node-js/" target="_blank" rel="noopener"> API路由，可以部署为Vercel无服务器函数</a>。而这正是本文的症结所在。</p>
<h3 id="prerequisites">先决条件</h3>
<p>要从本文中获得最大收益，需要满足以下先决条件:</p>
<ul>
<li>对JavaScript的基本理解</li>
<li>对Next.js的基本了解</li>
<li>对API设计的基本理解</li>
<li>系统上安装的最新Node.js版本</li>
</ul>
<h2 id="setting-up-application">设置我们的应用程序</h2>
<p>我们将从引导Next.js应用程序开始，并使用<code>create-next-app</code>自动设置一切。要创建Next.js项目，请运行以下命令:</p>
<pre class="language-bash hljs">yarn create next-app
</pre>
<p>安装完成后，运行<code>yarn dev</code>启动你的应用。当您访问<code>localhost:3000</code>时，您将获得:</p>
<p><img data-attachment-id="132900" data-permalink="https://blog.logrocket.com/build-api-serverless-functions-next-js/attachment/next-welcome-screen/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/next-welcome-screen.png" data-orig-size="730,382" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="next-welcome-screen" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/next-welcome-screen-300x157.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/next-welcome-screen.png" decoding="async" class="aligncenter size-full wp-image-132900 jetpack-lazy-image" src="../Images/83e68e7658c23540581489d8222cb9da.png" alt="Next.js Welcome Screen" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/next-welcome-screen.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/next-welcome-screen-300x157.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/next-welcome-screen.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/next-welcome-screen.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="132900" data-permalink="https://blog.logrocket.com/build-api-serverless-functions-next-js/attachment/next-welcome-screen/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/next-welcome-screen.png" data-orig-size="730,382" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="next-welcome-screen" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/next-welcome-screen-300x157.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/next-welcome-screen.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-132900" src="../Images/83e68e7658c23540581489d8222cb9da.png" alt="Next.js Welcome Screen" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/next-welcome-screen.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/next-welcome-screen-300x157.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/next-welcome-screen.png"/></noscript>
<h2 id="page-routes-next-js">Next.js中的页面路线</h2>
<p>在说API路由之前，<a href="https://blog.logrocket.com/what-you-need-know-new-next-js-router/" target="_blank" rel="noopener">我们先来了解一下页面路由</a>。</p>
<p>在Next.js中，每个页面都由一个组件驱动。例如，“关于”页面将有一个<code>About</code>组件，而“联系人”页面将有一个<code>Contact</code>组件。每个页面组件在<code>pages</code>文件夹中都有一个文件，因此，每个页面组件的文件名和位置都与特定页面的路径相关联。</p>
<p>要详细说明这一点，请将您的浏览器导航至<code>localhost:3000/about</code>，您将看到:</p>
<p><img data-attachment-id="132902" data-permalink="https://blog.logrocket.com/build-api-serverless-functions-next-js/attachment/about-page-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page.png" data-orig-size="730,383" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="about-page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page-300x157.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page.png" decoding="async" class="aligncenter size-full wp-image-132902 jetpack-lazy-image" src="../Images/bdfb51518e264b7375929f7476810034.png" alt="About Page With Error" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/about-page-300x157.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="132902" data-permalink="https://blog.logrocket.com/build-api-serverless-functions-next-js/attachment/about-page-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page.png" data-orig-size="730,383" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="about-page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page-300x157.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-132902" src="../Images/bdfb51518e264b7375929f7476810034.png" alt="About Page With Error" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/about-page-300x157.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page.png"/></noscript>
<p>上面显示的<code>404</code>页面仅仅意味着Next.js在<code>page</code>文件夹中找不到名为<code>about</code>的组件。这是因为我们没有在<code>pages</code>文件夹中创建一个<code>about</code>组件。</p>
<p>要解决这个问题，在<code>pages</code>目录中创建一个<code>about.js</code>文件，并添加以下代码:</p>
<pre class="language-javascript hljs">const About = () =&gt; {
    return (
        &lt;div&gt;
            &lt;h1&gt;Hello World!&lt;/h1&gt;
        &lt;/div&gt;
    )
};
export default About;
</pre>
<p>现在，重温<code>localhost:3000/about</code>，你会得到:</p>
<p><img data-attachment-id="132904" data-permalink="https://blog.logrocket.com/build-api-serverless-functions-next-js/attachment/about-page-working/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page-working.png" data-orig-size="730,382" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="about-page-working" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page-working-300x157.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page-working.png" decoding="async" class="aligncenter size-full wp-image-132904 jetpack-lazy-image" src="../Images/cb62c03175de865e8a102cf360240d7e.png" alt="About Page Working" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page-working.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/about-page-working-300x157.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page-working.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page-working.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="132904" data-permalink="https://blog.logrocket.com/build-api-serverless-functions-next-js/attachment/about-page-working/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page-working.png" data-orig-size="730,382" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="about-page-working" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page-working-300x157.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page-working.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-132904" src="../Images/cb62c03175de865e8a102cf360240d7e.png" alt="About Page Working" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page-working.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/about-page-working-300x157.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/about-page-working.png"/></noscript>
<p>当我们在<code>pages</code>文件夹中创建<code>About</code>组件时，Next.js自动创建了一个路由来服务于<code>About</code>组件。因此，路径名与文件名联系在一起。</p>
<h2 id="dynamic-routes-next-js">Next.js中的动态路线</h2>
<p>Next.js页面支持<a href="https://nextjs.org/docs/routing/dynamic-routes" target="_blank" rel="noopener">动态路由</a>。这很有用，因为复杂的应用程序不仅仅需要使用预定义的路径来定义路由。</p>
<p>在Next.js中，您可以在页面组件名<code>[param].js</code>中添加括号，以创建动态路由。页面可以通过其动态路径<code>pages/users/[param].js</code>访问。在这里，<code>[param]</code>是页面的id、slug、漂亮的URL等。任何像<code>/users/1</code>或者<code>/users/abcdef</code>这样的路线都可以匹配。</p>
<p>Next.js会将匹配的路径参数作为查询参数发送到页面。如果有其他查询参数，Next.js会将匹配的路径参数与它们链接起来。</p>
<p>具体来说，动态路线<code>pages/users/[param].js</code>的匹配路线<code>/users/abcdef</code>将具有查询对象:</p>
<pre class="language-javascript hljs">{ "param": "abcdef" }
</pre>
<p>类似地，动态路线<code>pages/users/[param].js</code>的匹配路线<code>/users/abcdef?foo=bar</code>将具有以下<code>query</code>对象:</p>
<pre class="language-javascript hljs">{ "foo": "bar", "pid": "abc" } 
</pre>
<p>在您的应用程序中，创建一个<code>user</code>文件夹，并在其中创建一个名为<code>[username.js</code>的组件。将以下代码添加到组件中:</p>
<pre class="language-javascript hljs">import { useRouter } from "next/router";
const User = () =&gt; {
    const router = useRouter();
    const username = router.query["username"];
    return (
        &lt;div&gt;
            &lt;h1&gt;Hello! Welcome {username} &lt;/h1&gt;
        &lt;/div&gt;
    );
};
export default User;
</pre>
<p>现在，当你访问<code><a href="http://localhost:3000/users/lawrenceagles" rel="nofollow">http://localhost:3000/users/lawrenceagles</a></code>，你会得到:</p>
<p><img data-attachment-id="132908" data-permalink="https://blog.logrocket.com/build-api-serverless-functions-next-js/attachment/users-lawrenceeagles-screen/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/users-lawrenceeagles-screen.png" data-orig-size="730,385" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Users lawrenceeagles screen" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/users-lawrenceeagles-screen-300x158.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/users-lawrenceeagles-screen.png" decoding="async" class="aligncenter size-full wp-image-132908 jetpack-lazy-image" src="../Images/6fd02301dcecedc7e9625652818aa85e.png" alt="Users Lawrence Eagles Screen" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/users-lawrenceeagles-screen.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/users-lawrenceeagles-screen-300x158.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/users-lawrenceeagles-screen.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/users-lawrenceeagles-screen.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="132908" data-permalink="https://blog.logrocket.com/build-api-serverless-functions-next-js/attachment/users-lawrenceeagles-screen/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/users-lawrenceeagles-screen.png" data-orig-size="730,385" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Users lawrenceeagles screen" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/users-lawrenceeagles-screen-300x158.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/users-lawrenceeagles-screen.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-132908" src="../Images/6fd02301dcecedc7e9625652818aa85e.png" alt="Users Lawrence Eagles Screen" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/users-lawrenceeagles-screen.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/users-lawrenceeagles-screen-300x158.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/users-lawrenceeagles-screen.png"/></noscript>
<p>从上面的演示中，您可以看到Next自动将<code>/users/lawrenceagles</code>与动态路由<code>pages/users/[username].js</code>相匹配。因此，无论<code>username</code>在路线中经过什么，都会显示在页面上。您可以尝试不同的用户名。</p>
<p>除了使用页面路由创建和服务页面之外，Next.js还可以使用API路由创建API。基于我们目前的知识，让我们在下一节学习Next.js API路由。</p>
<h2 id="api-routing-next-js-serverless-functions">使用Next.js无服务器函数的API路由</h2>
<p><a href="https://nextjs.org/blog/next-9" target="_blank" rel="noopener">在Next.js v9 </a>中引入了API路由。它们使我们能够构建后端应用程序端点，在此过程中利用热重装和统一的构建管道。</p>
<p>这意味着Next ≥v9封装了前端和后端。我们可以快速开发可轻松扩展的全栈React和Node.js应用程序。</p>
<p>页面路由将Next.js页面作为网页，而Next.js API路由被视为端点。API路由位于<code>/pages/api</code>文件夹中，Next.js将该文件夹中的任何文件映射到<code>/api/*</code>作为端点。</p>
<p>这项功能非常有趣，因为它使Next.js能够在前端呈现存储在Next.js应用程序中的数据，或者呈现使用Next.js API路由获取的数据。</p>
<p>通过用<code>create-next-app</code>引导您的应用程序，Next.js自动为您创建一个示例API路径，即<code>/pages/api/hello.js</code>文件。在<code>/pages/api/hello.js</code>内部，Next.js创建并导出一个名为<code>handler</code>的函数，该函数返回一个JSON对象。</p>
<p>您可以通过浏览器导航到<code><a href="http://localhost:3000/api/hello" rel="nofollow">http://localhost:3000/api/hello</a></code>来访问该端点，并返回以下JSON:</p>
<pre class="language-javascript hljs">{
  "name": "John Doe"
}
</pre>
<h3 id="request-handler-function">请求处理器功能</h3>
<p>如上所述，要创建Next.js API路由，您需要导出一个默认的请求处理函数。请求处理器函数接收两个参数:</p>

<p>要使用API路径构建API，在根目录中创建一个名为<code>data</code>的文件夹。用下面的代码在<code>data</code>文件夹中创建一个<code>post.json</code>文件:</p>
<pre class="language-javascript hljs">[
    {
        "Title": "I am title 1",
        "Body": "Hello from post 1"
    },
    {
        "Title": "I am title 2",
        "Body": "Hello from post 2"
    },
    {
        "Title": "I am title 3",
        "Body": "Hello from post 3"
    },
    {
        "Title": "I am title 4",
        "Body": "Hello from post 4"
    },
    {
        "Title": "I am title 5",
        "Body": "Hello from post 5"
    }
]
</pre>
<p>现在，在<code>pages/api/</code>文件夹中，用以下代码创建一个名为<code>posts.js</code>的新文件:</p>
<pre class="language-javascript hljs">// Next.js API route support: https://nextjs.org/docs/api-routes/introduction
import posts from "../../data/posts.json"
export default function handler(req, res) {
    res.status(200).json(posts)
}
</pre>
<p>在上面的API路径中，处理函数导入JSON数据<code>posts</code>，并将其作为对<code>GET</code>请求的响应返回。当您通过从浏览器访问<code><a href="http://localhost:3000/api/posts" rel="nofollow">http://localhost:3000/api/posts</a></code>来查询这些数据时，您会得到:</p>
<p><img data-attachment-id="132910" data-permalink="https://blog.logrocket.com/build-api-serverless-functions-next-js/attachment/posts-results-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-results-page.png" data-orig-size="730,381" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Posts results page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-results-page-300x157.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-results-page.png" decoding="async" class="aligncenter size-full wp-image-132910 jetpack-lazy-image" src="../Images/c854bbff50c396a561484c2bb6521e00.png" alt="Posts Results Page" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-results-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/posts-results-page-300x157.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-results-page.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-results-page.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="132910" data-permalink="https://blog.logrocket.com/build-api-serverless-functions-next-js/attachment/posts-results-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-results-page.png" data-orig-size="730,381" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Posts results page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-results-page-300x157.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-results-page.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-132910" src="../Images/c854bbff50c396a561484c2bb6521e00.png" alt="Posts Results Page" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-results-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/posts-results-page-300x157.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-results-page.png"/></noscript>
<p>您可以使用如下所示的<code>request.method</code>对象来处理其他HTTP请求:</p>
<pre class="language-javascript hljs">export default (req, res) =&gt; {
  switch (req.method) {
    case 'GET':
      //...
      break
    case 'POST':
      //...
      break
    case 'PUT':
      //...
      break
    case 'DELETE':
      //...
      break
    default:
      res.status(405).end() // Method not allowed
      break
  }
}
</pre>
<h2 id="dynamic-api-routes">动态API路由</h2>
<p>和页面路由一样，Next API路由支持<a href="https://nextjs.org/docs/routing/dynamic-routes" target="_blank" rel="noopener">动态路由</a>。和<a href="https://nextjs.org/docs/api-routes/dynamic-api-routes" target="_blank" rel="noopener">动态API路由</a>遵循用于页面路由的相同文件命名规则。</p>
<p>为了详细说明这一点，在<code>pages/api/</code>文件夹中创建一个<code>posts</code>文件夹。在<code>posts</code>文件夹中创建一个名为<code>[postid.js]</code>的文件，并在其中写入以下代码:</p>
<pre class="language-javascript hljs">// Next.js API route support: https://nextjs.org/docs/api-routes/introduction
import posts from "../../../data/posts.json"
export default function handler(req, res) {
    const { postid } = req.query;
    const post = posts.find((post =&gt; post.id === parseInt(postid)));
    res.status(200).json(post)
}
</pre>
<p>在上面的代码中，Next自动将<code>/posts/1</code>路径与动态路由<code>pages/posts/[postid].js</code>匹配。无论哪个岗位<code>id</code>都传递到路线<code>/posts/[postid]</code> : <code>/post/2</code>、<code>/post/3</code>、<code>/post/4</code>等。将在<code>req.query</code>对象中可用。</p>
<p>上面的请求处理函数从<code>req.query</code>对象中检索传递的帖子<code>id</code>，在<code>posts</code>数组中找到帖子，并将其发送给客户端。</p>
<p>因此，要获得一个<code>id</code>为<code>1</code>的帖子，请在浏览器中导航到<code><a href="http://localhost:3000/api/posts/1" rel="nofollow">http://localhost:3000/api/posts/1</a></code>。您将获得:</p>
<p><img data-attachment-id="132913" data-permalink="https://blog.logrocket.com/build-api-serverless-functions-next-js/attachment/posts-1-results/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-1-results.png" data-orig-size="730,382" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Posts 1 results" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-1-results-300x157.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-1-results.png" decoding="async" class="aligncenter size-full wp-image-132913 jetpack-lazy-image" src="../Images/a7605af7b23041f6083f773df6633edd.png" alt="Posts With Id 1 Results" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-1-results.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/posts-1-results-300x157.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-1-results.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-1-results.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="132913" data-permalink="https://blog.logrocket.com/build-api-serverless-functions-next-js/attachment/posts-1-results/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-1-results.png" data-orig-size="730,382" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Posts 1 results" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-1-results-300x157.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-1-results.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-132913" src="../Images/a7605af7b23041f6083f773df6633edd.png" alt="Posts With Id 1 Results" srcset="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-1-results.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/09/posts-1-results-300x157.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/09/posts-1-results.png"/></noscript>
<h2 id="advantages-api-routes">API路线的优势</h2>
<p>在Vercel中，Next.js API路由被部署为无服务器函数。这意味着它们可以部署到世界上的许多地区，以改善延迟和可用性。</p>
<p>此外，作为无服务器功能，它们是有成本效益的，使您能够按需运行您的代码。这消除了管理基础架构、配置服务器或升级硬件的需要。</p>
<p>API路由的另一个好处是它们的伸缩性非常好。最后，默认情况下它们没有指定CORS，因为它们是<code>same-origin</code>，但是，您可以通过使用<a href="https://github.com/vercel/next.js/blob/canary/examples/api-routes-cors/pages/api/cors.ts" target="_blank" rel="noopener"> CORS请求助手</a>定制这个行为。</p>
<h2 id="conclusion">结论</h2>
<p>在本文中，我们了解了一个有趣而强大的Next.js特性——API routes。我们从了解Next.js页面路径开始，并深入研究了API路径。我们还学习了如何使用Next API routes构建API，部署为Vercel的无服务器功能。</p>
<p>我真的希望在本文结束时，您可以使用Next.js APIs Route构建API！</p><div class="code-block code-block-30">
<div class="blog-plug inline-plug next-plug"><h2><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank"> LogRocket </a>:全面了解生产Next.js应用</h2><p>调试下一个应用程序可能会很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪状态、自动显示JavaScript错误、跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-lazy-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/></noscript></a><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><p>LogRocket 就像是网络和移动应用的DVR，记录下你的Next.js应用上发生的一切。您可以汇总并报告问题发生时应用程序的状态，而不是猜测问题发生的原因。LogRocket还可以监控应用程序的性能，报告客户端CPU负载、客户端内存使用等指标。</p><p>LogRocket Redux中间件包为您的用户会话增加了一层额外的可见性。LogRocket记录Redux存储中的所有操作和状态。</p><p>让您调试Next.js应用的方式现代化— <a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>