<html>
<head>
<title>Next.js 13: Working with the new app directory </title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Next.js 13:使用新的应用程序目录</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/next-js-13-new-app-directory/#0001-01-01">https://blog.logrocket.com/next-js-13-new-app-directory/#0001-01-01</a></blockquote><div><article class="article-post">
<p>Next.js以其基于文件系统的路由而闻名。然而，Next.js v13在撰写本文时是新的，它改变了以前通过其<a href="https://beta.nextjs.org/docs/app-directory-roadmap">新<code>app</code>目录</a>执行许多任务的方式。</p>
<p>虽然仍然支持相同的基于文件系统的路由，即使用<code>pages</code>目录，但新的<code>app</code>目录引入了布局、错误组件和加载组件的概念，同时还利用React的服务器组件来构建UI。在本文中，我们将通过构建一个简单的应用程序来探索这些新特性。我们开始吧！</p>
<h2 id="tableofcontents">目录</h2>

<h2 id="concepts">Next.js 13中的新特性</h2>
<p>在开始使用Next.js 13进行项目之前，我们将回顾Next.js 13引入的新特性和概念。</p>
<h3 id="page-directory-vs-app-directory">页面目录与应用程序目录</h3>
<p>如果你使用过以前版本的<a href="https://blog.logrocket.com/implementing-ssr-next-js-dynamic-routing-prefetching/#creating-next-js-routes"> Next.js，你可能已经熟悉了<code>pages</code>目录</a>。在<code>pages</code>目录中创建的任何文件都将作为UI中的一个路径。例如，<code>pages/home.jsx</code>会负责<code>/home</code>路线:</p>
<p><img data-attachment-id="141693" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/pages-home-jsx-route/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/pages-home-jsx-route.png" data-orig-size="730,433" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="pages-home-jsx-route" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/pages-home-jsx-route-300x178.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/pages-home-jsx-route.png" decoding="async" class="aligncenter wp-image-141693 size-full jetpack-lazy-image" src="../Images/fb18cfbd3e91fd81a6ff3c1987687843.png" alt="Pages Home JSX Route" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/pages-home-jsx-route.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/pages-home-jsx-route-300x178.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/pages-home-jsx-route.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/pages-home-jsx-route.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="141693" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/pages-home-jsx-route/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/pages-home-jsx-route.png" data-orig-size="730,433" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="pages-home-jsx-route" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/pages-home-jsx-route-300x178.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/pages-home-jsx-route.png" decoding="async" loading="lazy" class="aligncenter wp-image-141693 size-full" src="../Images/fb18cfbd3e91fd81a6ff3c1987687843.png" alt="Pages Home JSX Route" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/pages-home-jsx-route.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/pages-home-jsx-route-300x178.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/pages-home-jsx-route.png"/></noscript>
<p> </p>
<p>新的<code>app</code>目录与<code>pages</code>目录一起工作，以<a href="https://beta.nextjs.org/docs/app-directory-roadmap#supported-features">支持增量采用</a>，并提供其他新功能，如服务器端渲染和静态站点生成。</p>
<h3 id="routing-app-directory">用<code>app</code>目录路由</h3>
<p>就像<code>pages</code>目录中的文件一样，通过<code>app</code>目录中的文件夹来控制路由。特定路线的用户界面由文件夹内的<code>page.jsx</code>文件定义。</p>
<p>因此，看起来像<code>app/profile/settings/page.jsx</code>的文件夹结构将负责呈现<code>/profile/settings</code>路线:</p>
<p><img data-attachment-id="141113" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/next-js-app-directory-routing/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-app-directory-routing.png" data-orig-size="730,323" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="next-js-app-directory-routing" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-app-directory-routing-300x133.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-app-directory-routing.png" decoding="async" class="aligncenter wp-image-141113 size-full jetpack-lazy-image" src="../Images/d2d42e3c73f3b136a1b6a42520eb9007.png" alt="Nextjs App Directory Routing" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-app-directory-routing.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-app-directory-routing-300x133.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-app-directory-routing.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-app-directory-routing.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="141113" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/next-js-app-directory-routing/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-app-directory-routing.png" data-orig-size="730,323" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="next-js-app-directory-routing" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-app-directory-routing-300x133.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-app-directory-routing.png" decoding="async" loading="lazy" class="aligncenter wp-image-141113 size-full" src="../Images/d2d42e3c73f3b136a1b6a42520eb9007.png" alt="Nextjs App Directory Routing" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-app-directory-routing.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-app-directory-routing-300x133.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-app-directory-routing.png"/></noscript>
<h3 id="loading-tsx-file"><code>loading.tsx</code>文件</h3>
<p><code>loading.tsx</code>是一个可选文件，您可以在<code>app</code>文件夹内的任何目录中创建它。它自动将页面包裹在一个<a href="https://beta.reactjs.org/apis/react/Suspense#suspense">反应悬念边界</a>内。该组件将在第一次装载时立即显示，当您在同级路线之间导航时也会显示。</p>
<h3 id="error-tsx"><code>error.tsx</code>文件</h3>
<p><code>error.tsx</code>是一个可选文件，将错误隔离到应用程序的最小可能子部分。创建<code>error.tsx</code>文件会自动将页面包装在<a href="https://reactjs.org/docs/error-boundaries.html"> React错误边界</a>内。每当该文件所在的文件夹中出现任何错误时，该组件将被替换为该组件的内容。</p>
<h3><code>layout.tsx</code>文件</h3>
<p>您可以使用<code>layout.tsx</code>文件来定义一个跨多个位置共享的UI。一个布局可以呈现另一个布局或其中的一个页面。每当路由更改到布局内的任何组件时，其状态都会保留，因为布局组件不会被卸载。</p>
<h3 id="template-tsx"><code>template.tsx</code>文件</h3>
<p><code>template.tsx</code>类似于<code>layout.tsx</code>文件，但是在导航时，组件的一个新实例被挂载并且状态不被保留。</p>
<p>使用布局和模板允许我们利用部分渲染的概念。在同一文件夹内的路线之间移动时，仅提取和渲染该文件夹内的布局和页面:</p>
<p><img data-attachment-id="141115" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/template-tsx-partial-rendering/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/template-tsx-partial-rendering.png" data-orig-size="730,323" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="template-tsx-partial-rendering" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/template-tsx-partial-rendering-300x133.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/template-tsx-partial-rendering.png" decoding="async" class="aligncenter wp-image-141115 size-full jetpack-lazy-image" src="../Images/70fd11dab913cd9beceaa5ef2b74e374.png" alt="Template Tsx Partial Rendering" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/template-tsx-partial-rendering.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/template-tsx-partial-rendering-300x133.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/template-tsx-partial-rendering.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/template-tsx-partial-rendering.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="141115" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/template-tsx-partial-rendering/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/template-tsx-partial-rendering.png" data-orig-size="730,323" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="template-tsx-partial-rendering" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/template-tsx-partial-rendering-300x133.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/template-tsx-partial-rendering.png" decoding="async" loading="lazy" class="aligncenter wp-image-141115 size-full" src="../Images/70fd11dab913cd9beceaa5ef2b74e374.png" alt="Template Tsx Partial Rendering" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/template-tsx-partial-rendering.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/template-tsx-partial-rendering-300x133.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/template-tsx-partial-rendering.png"/></noscript>
<h2 id="caveats">使用<code>app</code>目录的注意事项</h2>
<p>Next.js 13引入了这么多变化，当从<code>pages</code>目录转移到<code>app</code>目录时，我们需要记住一些事情。</p>
<h3 id="mandatory-root-layout">强制根布局</h3>
<p>必须有一个文件定义应用程序目录顶层的根布局。这种布局适用于应用程序中的所有路线。此外，根布局必须定义<code>&lt;html&gt;</code>和<code>&lt;body&gt;</code>标记，因为Next.js不会自动添加它们。</p>
<h3 id="head-tag">头部标签</h3>
<p>在<code>app</code>目录中的任何文件夹内，我们将创建一个<code>head.js</code>文件，该文件将为该文件夹定义<code>&lt;head&gt;</code>标签的内容。从这个<code>head.js</code>文件返回的组件只能返回某些有限的标签，如<code>&lt;title&gt;</code>、<code>&lt;meta&gt;</code>、<code>&lt;link&gt;</code>、<code>&lt;script&gt;</code>。</p>
<h3 id="route-group">路由组</h3>
<p><code>app</code>目录中的每个文件夹都是URL路径的一部分。但是，可以通过将文件夹名括在括号内来选择不使用它。这个特殊文件夹中的所有文件和文件夹都是该路由组的一部分:</p>
<p><img data-attachment-id="141118" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/next-js-partial-rendering-route-groups/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-partial-rendering-route-groups.png" data-orig-size="730,323" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="next-js-partial-rendering-route-groups" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-partial-rendering-route-groups-300x133.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-partial-rendering-route-groups.png" decoding="async" class="aligncenter wp-image-141118 size-full jetpack-lazy-image" src="../Images/453e56d51158a374669ebc81485ff62f.png" alt="Nextjs Partial Rendering Route Groups" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-partial-rendering-route-groups.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-partial-rendering-route-groups-300x133.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-partial-rendering-route-groups.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-partial-rendering-route-groups.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="141118" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/next-js-partial-rendering-route-groups/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-partial-rendering-route-groups.png" data-orig-size="730,323" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="next-js-partial-rendering-route-groups" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-partial-rendering-route-groups-300x133.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-partial-rendering-route-groups.png" decoding="async" loading="lazy" class="aligncenter wp-image-141118 size-full" src="../Images/453e56d51158a374669ebc81485ff62f.png" alt="Nextjs Partial Rendering Route Groups" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-partial-rendering-route-groups.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-partial-rendering-route-groups-300x133.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-partial-rendering-route-groups.png"/></noscript>
<h3>服务器组件</h3>
<p>默认情况下，在<code>app</code>目录中创建的所有组件都是React服务器组件，由于包的大小更小，所以性能更好。但是，如果我们想切换到客户端组件，我们需要用文件顶部的<a href="https://beta.nextjs.org/docs/rendering/server-and-client-components#convention"> <code>use client</code>指令</a>来指定。</p>
<h2 id="hands-on">动手操作Next.js 13</h2>
<p>让我们通过运行一个示例来试验Next.js 13中的所有新特性。</p>
<h3 id="project-creation">项目创建</h3>
<p>首先，我们使用<a href="https://blog.logrocket.com/introducing-the-new-create-next-app/"> Create Next App </a>创建一个新的Next.js项目:</p>
<pre class="language-bash hljs">npx create-next-app next-13
cd next-13
</pre>
<p>让我们按原样运行引导代码:</p>
<pre class="language-bash hljs">npm run dev
</pre>
<p>迎接我们的是熟悉的主页:</p>
<p><img data-attachment-id="141120" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/next-js-homepage-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-homepage.png" data-orig-size="730,447" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="next-js-homepage" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-homepage-300x184.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-homepage.png" decoding="async" class="aligncenter wp-image-141120 size-full jetpack-lazy-image" src="../Images/a93b2b58f8bd784a8760987ed2505a05.png" alt="Nextjs Homepage" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-homepage.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-homepage-300x184.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-homepage.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-homepage.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="141120" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/next-js-homepage-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-homepage.png" data-orig-size="730,447" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="next-js-homepage" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-homepage-300x184.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-homepage.png" decoding="async" loading="lazy" class="aligncenter wp-image-141120 size-full" src="../Images/a93b2b58f8bd784a8760987ed2505a05.png" alt="Nextjs Homepage" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-homepage.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-homepage-300x184.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-homepage.png"/></noscript>
<h3 id="page-layout-file">页面和布局文件</h3>
<p>让我们创建一个与<code>pages</code>目录平行的文件夹，并将其命名为<code>app</code>。用下面的代码在<code>app</code>中创建一个<code>layout.js</code>文件:</p>
<pre class="language-javascript hljs">export default function Layout({ children }) {
  return (
    &lt;html lang="en"&gt;
      &lt;head&gt;
        &lt;title&gt;Next.js&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        {children}
      &lt;/body&gt;
    &lt;/html&gt;)
}
</pre>
<p>用以下代码创建一个<code>page.js</code>文件:</p>
<pre class="language-javascript hljs">import '../styles/globals.css'
export default function Page() {
  return &lt;h1&gt;Hello, Next.js!&lt;/h1&gt;;
}
</pre>
<p>我们还导入了<code>global.css</code>文件，以利用已经定义的全局样式。<code>app</code>目录仍然是一个实验性的特性，所以我们需要在<code>next.config.js</code>文件中设置一个标志来使用它:</p>
<pre class="language-javascript hljs">module.exports = {
  reactStrictMode: true,
  experimental:{appDir: true}
}
</pre>
<p>最后我们需要删除<code>pages/index.js</code>文件，这个文件会和<code>app</code>目录下的文件冲突。准备就绪后，我们现在可以运行开发服务器了:</p>
<pre class="language-bash hljs">npm run dev
</pre>
<p>我们看到根路由<code>/</code>现在显示了对应于<code>app/page.js</code>文件的UI:</p>
<p><img data-attachment-id="141123" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/page-js-route-ui/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/page-js-route-ui.png" data-orig-size="730,323" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="page-js-route-ui" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/page-js-route-ui-300x133.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/page-js-route-ui.png" decoding="async" class="aligncenter wp-image-141123 size-full jetpack-lazy-image" src="../Images/fabd34cc8493d1beb0af2d20839464c9.png" alt="Page-js Route UI" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/page-js-route-ui.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/page-js-route-ui-300x133.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/page-js-route-ui.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/page-js-route-ui.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="141123" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/page-js-route-ui/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/page-js-route-ui.png" data-orig-size="730,323" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="page-js-route-ui" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/page-js-route-ui-300x133.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/page-js-route-ui.png" decoding="async" loading="lazy" class="aligncenter wp-image-141123 size-full" src="../Images/fabd34cc8493d1beb0af2d20839464c9.png" alt="Page-js Route UI" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/page-js-route-ui.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/page-js-route-ui-300x133.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/page-js-route-ui.png"/></noscript>
<h3 id="&quot;testing-layout">测试布局</h3>
<p>准备好之后，让我们测试一下布局文件如何影响整个UI。首先，我们将在同一目录下的一个<code>layout.module.css</code>文件中编写一些CSS样式:</p>
<pre class="language-css hljs">.header {
  width: 100%;
  height: 50vh;
  background-color: cyan;
  text-align: center;
  font-size: 2rem;
}
</pre>
<p>接下来，我们将这些样式导入到<code>layout.js</code>文件中，并将它们添加到主体内部的一个<code>div</code>中，就在子元素的上方:</p>
<pre class="language-css hljs">import styles from './layout.module.css'

export default function Layout({ children }) {
  return (
    &lt;html lang="en"&gt;
      &lt;head&gt;
        &lt;title&gt;Next.js&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;div
          className={styles.header}
        &gt;From layout&lt;/div&gt;
        &lt;div&gt;
          {children}
        &lt;/div&gt;
      &lt;/body&gt;
    &lt;/html&gt;)
}
</pre>
<p>用户界面现在看起来如下所示:</p>
<p><img data-attachment-id="141125" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/import-styles-layout-js-ui/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/import-styles-layout-js-ui.png" data-orig-size="730,439" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="import-styles-layout-js-ui" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/import-styles-layout-js-ui-300x180.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/import-styles-layout-js-ui.png" decoding="async" class="aligncenter wp-image-141125 size-full jetpack-lazy-image" src="../Images/3b1e30fce5f6c72d039bd8be267e2543.png" alt="Import Styles Layout JS UI" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/import-styles-layout-js-ui.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/import-styles-layout-js-ui-300x180.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/import-styles-layout-js-ui.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/import-styles-layout-js-ui.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="141125" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/import-styles-layout-js-ui/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/import-styles-layout-js-ui.png" data-orig-size="730,439" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="import-styles-layout-js-ui" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/import-styles-layout-js-ui-300x180.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/import-styles-layout-js-ui.png" decoding="async" loading="lazy" class="aligncenter wp-image-141125 size-full" src="../Images/3b1e30fce5f6c72d039bd8be267e2543.png" alt="Import Styles Layout JS UI" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/import-styles-layout-js-ui.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/import-styles-layout-js-ui-300x180.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/import-styles-layout-js-ui.png"/></noscript>
<p>让我们在<code>app</code>目录中添加一个名为<code>second</code>的新文件夹。用下面的代码在里面创建一个名为<code>page.js</code>的文件:</p>
<pre class="language-javascript hljs">import '../../styles/globals.css'

export default function Page() {
  return &lt;h1&gt;Second route!&lt;/h1&gt;;
}
</pre>
<p>导航到第二条路线<code><a href="http://localhost:3000/second" rel="nofollow">http://localhost:3000/second</a></code>加载以下UI:</p>
<p><img data-attachment-id="141127" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/next-js-secound-route-ui/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-secound-route-ui.png" data-orig-size="730,520" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="next-js-secound-route-ui" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-secound-route-ui-300x214.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-secound-route-ui.png" decoding="async" class="aligncenter wp-image-141127 size-full jetpack-lazy-image" src="../Images/65f1a295fa4d9f6568899f453a8b9a3b.png" alt="NextJs Secound Route UI" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-secound-route-ui.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-secound-route-ui-300x214.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-secound-route-ui.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-secound-route-ui.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="141127" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/next-js-secound-route-ui/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-secound-route-ui.png" data-orig-size="730,520" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="next-js-secound-route-ui" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-secound-route-ui-300x214.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-secound-route-ui.png" decoding="async" loading="lazy" class="aligncenter wp-image-141127 size-full" src="../Images/65f1a295fa4d9f6568899f453a8b9a3b.png" alt="NextJs Secound Route UI" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-secound-route-ui.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-secound-route-ui-300x214.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-secound-route-ui.png"/></noscript>
<p>放置在<code>app</code>目录中的布局文件被同一目录中的<code>page.js</code>和<code>second</code>文件夹中的<code>page.js</code>共享。您可以通过布局文件完成任何与布局相关的常见更改。</p>
<h3 id="testing-error-file">测试错误文件</h3>
<p>接下来，让我们检查一下<code>error.js</code>文件。我们将在<code>app</code>文件夹中创建一个文件夹；我们将文件夹命名为<code>breaking</code>，并创建单独的<code>page.js</code>和<code>breaking.module.css</code>文件:</p>
<pre class="language-css hljs">'use client';

import '../../styles/globals.css'
import styles from './breaking.module.css';

export default function Page() {
  return (
    &lt;div className={styles.component}&gt;
      &lt;div&gt;BREAKING&lt;/div&gt;
      &lt;div&gt;
        &lt;button onClick={(e) =&gt; console.log(e.b.c)}&gt;
          break this
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}
</pre>
<p>在页面顶部，<code>use client</code>告诉Next.js将该组件呈现为客户端组件，而不是默认的服务器组件。我们通过下面的按钮组件处理用户输入:</p>
<pre class="language-javascript hljs">.component {
  width: 200px;
  height: 200px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid black;
  flex-direction: column;
}

.error {
  background-color: tomato;
  color: white;
}
</pre>
<p>有了这个CSS，组件看起来就像下图:</p>
<p><img data-attachment-id="141129" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/next-js-render-client-component/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-render-client-component.png" data-orig-size="730,463" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="next-js-render-client-component" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-render-client-component-300x190.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-render-client-component.png" decoding="async" class="aligncenter wp-image-141129 size-full jetpack-lazy-image" src="../Images/42e0efffd880ec90056f043bc0c2186b.png" alt="Nextjs Render Client Component" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-render-client-component.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-render-client-component-300x190.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-render-client-component.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-render-client-component.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="141129" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/next-js-render-client-component/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-render-client-component.png" data-orig-size="730,463" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="next-js-render-client-component" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-render-client-component-300x190.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-render-client-component.png" decoding="async" loading="lazy" class="aligncenter wp-image-141129 size-full" src="../Images/42e0efffd880ec90056f043bc0c2186b.png" alt="Nextjs Render Client Component" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-render-client-component.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-render-client-component-300x190.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/next-js-render-client-component.png"/></noscript>
<p>现在，让我们在<code>breaking</code>文件夹中创建一个<code>error.js</code>文件。<code>error.js</code>将在该组件内部或其子树中的任何组件出现错误时充当错误边界:</p>
<pre class="language-javascript hljs">'use client';

import '../../styles/globals.css'
import { useEffect } from 'react';
import styles from './breaking.module.css';

export default function Error({
  error,
  reset,
}) {
  useEffect(() =&gt; {
    // Log the error to an error reporting service
    console.error(error);
  }, [error]);

  return (
    &lt;div className={styles.error}&gt;
      &lt;div&gt;ERROR&lt;/div&gt;
      &lt;p&gt;Something went wrong!&lt;/p&gt;
      &lt;button onClick={() =&gt; reset()}&gt;Reset error boundary&lt;/button&gt;
    &lt;/div&gt;
  );
}
</pre>
<p>请注意，这也是一个客户端组件。向该组件传递了两个属性:<code>error</code>属性提供了关于错误的更多细节，而<code>reset</code>函数重置了错误边界。这应该足以将错误仅包含在组件中，并保留UI以及应用程序其余部分的状态。</p>
<h3 id="testing-loading-file">测试加载文件</h3>
<p>接下来，我们将测试<code>loading.js</code>文件的功能。让我们用下面的代码在同一个文件夹中创建一个:</p>
<pre class="language-javascript hljs">export default function Loading() {
  return &lt;h1&gt;Loading...&lt;/h1&gt;
}
</pre>
<p>有了这些，我们需要设置一些导航。在<code>second/page.js</code>中，我们放置了一个链接来导航到<code>/breaking</code>路线:</p>
<pre class="language-javascript hljs">export default function Page() {
  return (&lt;Link href="/breaking"&gt;navigate to breaking&lt;/Link&gt;);
}
</pre>
<p>点击这个链接，我们会看到在安装中断组件之前，来自<code>loading.js</code>文件的UI会出现一瞬间:</p>
<p><img data-attachment-id="141132" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/loading-js-file-ui-display/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/loading-js-file-ui-display.gif" data-orig-size="730,436" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="loading-js-file-ui-display" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/loading-js-file-ui-display-300x179.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/loading-js-file-ui-display.gif" decoding="async" class="aligncenter wp-image-141132 size-full jetpack-lazy-image" src="../Images/720bb2267b08bc790c808333e2c9f380.png" alt="Loadingjs File UI Display" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/loading-js-file-ui-display.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/loading-js-file-ui-display.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="141132" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/loading-js-file-ui-display/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/loading-js-file-ui-display.gif" data-orig-size="730,436" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="loading-js-file-ui-display" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/loading-js-file-ui-display-300x179.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/loading-js-file-ui-display.gif" decoding="async" loading="lazy" class="aligncenter wp-image-141132 size-full" src="../Images/720bb2267b08bc790c808333e2c9f380.png" alt="Loadingjs File UI Display" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/loading-js-file-ui-display.gif"/></noscript>
<h2 id="data-fetching">数据提取</h2>
<p>最后，我们将探讨Next.js 13中的数据获取与早期版本有何不同。默认情况下，<code>app</code>文件夹中的所有组件都是服务器组件。</p>
<p>让我们修改一下<code>second.js</code>组件，从<a href="https://dukengn.github.io/Dog-facts-API/">狗事实API </a>中获取随机的狗事实:</p>
<pre class="language-javascript hljs">async function getData() {
  const index = Math.floor(Math.random()*10)
  const res = await fetch(https://dog-facts-api.herokuapp.com/api/v1/resources/dogs?index=${index}`);
  return res.json();
}
</pre>
<p>我们将在React组件中直接调用这个函数，方法是使它异步:</p>
<pre class="language-javascript hljs">export default async function Page() {
  const data = await getData();
  return (
    &lt;p&gt;
      {data[0].fact}
    &lt;/p&gt;
  );
}
</pre>
<p>上面的代码获取服务器端的dog事实，并将其显示在我们的组件中:</p>
<p><img data-attachment-id="141134" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/dog-fact-fetched-server-side/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/dog-fact-fetched-server-side.png" data-orig-size="730,446" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="dog-fact-fetched-server-side" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/dog-fact-fetched-server-side-300x183.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/dog-fact-fetched-server-side.png" decoding="async" class="aligncenter wp-image-141134 size-full jetpack-lazy-image" src="../Images/280c874b23d73d52a10c200594b5a712.png" alt="Dog Fact Fetched Server Side" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/dog-fact-fetched-server-side.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/dog-fact-fetched-server-side-300x183.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/11/dog-fact-fetched-server-side.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/dog-fact-fetched-server-side.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="141134" data-permalink="https://blog.logrocket.com/next-js-13-new-app-directory/attachment/dog-fact-fetched-server-side/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/11/dog-fact-fetched-server-side.png" data-orig-size="730,446" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="dog-fact-fetched-server-side" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/11/dog-fact-fetched-server-side-300x183.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/11/dog-fact-fetched-server-side.png" decoding="async" loading="lazy" class="aligncenter wp-image-141134 size-full" src="../Images/280c874b23d73d52a10c200594b5a712.png" alt="Dog Fact Fetched Server Side" srcset="https://blog.logrocket.com/wp-content/uploads/2022/11/dog-fact-fetched-server-side.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/11/dog-fact-fetched-server-side-300x183.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/11/dog-fact-fetched-server-side.png"/></noscript>
<h3 id="client-server-side-rendering">客户端和服务器端呈现</h3>
<p>在组件内部本地使用Fetch API为我们提供了根据需求缓存和重新验证请求的能力。因此，前面的实用程序如<code>getStaticProps</code>和<code>getServerSideProps</code>可以通过一个API实现，如下所示:</p>
<pre class="language-javascript hljs">// Generates statically like getStaticProps.
fetch(URL, { cache: 'force-cache' });

// Generates server-side upon every request like getServerSideProps.
fetch(URL, { cache: 'no-store' });

// Generates statically but revalidates every 20 seconds
fetch(URL, { next: { revalidate: 20 } });
</pre>
<h2 id="conclusion">结论</h2>
<p>这几乎囊括了Next.js 13中由<code>app</code>目录引入的所有变化。</p>
<p>虽然在撰写本文时，这些新功能还处于测试阶段，在正式发布之前肯定会有一些小的变化，但我们可以同意，它们通过加载、错误和布局组件提供了更大的灵活性来配置我们的UI。服务器组件上本地Fetch API的简单性也是一个很好的补充。</p>
<p>这是我们使用的<a href="https://github.com/kokanek/nextjs-13">代码</a>的链接。随意探索！</p><div class="code-block code-block-30">
<div class="blog-plug inline-plug next-plug"><h2><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank"> LogRocket </a>:全面了解生产Next.js应用</h2><p>调试下一个应用程序可能会很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪状态、自动显示JavaScript错误、跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-lazy-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/></noscript></a><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><p>LogRocket 就像是网络和移动应用的DVR，记录下你的Next.js应用上发生的一切。您可以汇总并报告问题发生时应用程序的状态，而不是猜测问题发生的原因。LogRocket还可以监控应用程序的性能，报告客户端CPU负载、客户端内存使用等指标。</p><p>LogRocket Redux中间件包为您的用户会话增加了一层额外的可见性。LogRocket记录Redux存储中的所有操作和状态。</p><p>让您调试Next.js应用的方式现代化— <a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>