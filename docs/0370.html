<html>
<head>
<title>JWT authentication: Best practices and when to use it - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>JWT认证:最佳实践和何时使用它</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/jwt-authentication-best-practices/#0001-01-01">https://blog.logrocket.com/jwt-authentication-best-practices/#0001-01-01</a></blockquote><div><article class="article-post">
<p><em> <strong>编者按</strong>:本JWT认证教程最后更新于2021年7月1日。它可能仍然包含过时的信息。</em></p>
<p>在这个JWT认证教程中，您将学习什么时候使用JWT，为什么不应该在会话中使用JWT，以及如何在cookies中存储jwt以防止安全问题。我们还将回顾一些通用的JWT最佳实践。</p>
<p>以下是我们将要介绍的内容:</p>

<p>JSON Web令牌(JWT)是一个或多个声明的JSON编码表示，可以在双方之间传输。</p>
<p>尽管JWT认证是一项非常流行的技术，但它也伴随着争议。有人说<a href="https://scotch.io/bar-talk/why-jwts-suck-as-session-tokens" target="_blank" rel="noopener">你永远不应该使用它</a>。还有人说<a href="https://twitter.com/Ocramius/status/719949307898699776" target="_blank" rel="noopener">的JWT认证很神奇</a>。</p>
<p>事实介于两者之间:使用JWT的价值取决于您的用例以及项目需求。</p>
<p>在我们深入探讨之前，让我们简单回顾一下什么是JWT认证。</p>
<p><iframe loading="lazy" title="YouTube video player" src="https://www.youtube.com/embed/R7ZkUWe52-c" frameborder="0" allowfullscreen="allowfullscreen">视频</iframe></p>
<h2 id="brief-introduction-to-jwt">什么是JWT？</h2>
<p>JWT是一种验证某些JSON数据所有者的机制。它是一个编码的、URL安全的字符串，可以包含无限量的数据(不像cookie ),并且是加密签名的。</p>
<p>当服务器收到JWT时，它可以保证其中包含的数据是可信的，因为它是由源签名的。JWT一经发出，任何中间人都无法修改。</p>
<p>需要注意的是，JWT保证数据所有权，但不保证加密。任何拦截令牌的人都可以看到您存储在JWT中的JSON数据，因为它只是序列化，而不是加密。</p>
<p>出于这个原因，强烈建议将HTTPS与jwt一起使用(顺便说一下，一般情况下是HTTPS)。</p>
<p>我们不打算详细讨论jwt是如何生成的。要深入了解JWT认证如何工作的最新信息，请使用Vue.js和Node.js 从头开始查看“<a href="https://blog.logrocket.com/jwt-authentication-from-scratch-vue-js-node-js/" target="_blank" rel="noopener"> JWT认证”</a></p>
<h2 id="tl-dr-what-are-they-good-for">何时使用JWT身份验证</h2>
<p>对于API认证和服务器到服务器授权，JWT是一项特别有用的技术。</p>
<p>有关使用JWT技术认证API的全面指南，请查看“<a href="https://blog.logrocket.com/how-to-secure-a-rest-api-using-jwt-7efd83e71432/" target="_blank" rel="noopener">如何使用JWT保护REST API。</a></p>
<h2 id="whyyoushouldnt">为什么不应该使用jwt作为会话令牌</h2>
<p>另一方面，<a href="https://evertpot.com/jwt-is-a-bad-default/" target="_blank" rel="noopener">默认情况下，你不应该使用jwt作为会话令牌</a>。首先，JWT的特性范围很广，范围很大，这增加了库作者或用户出错的可能性。</p>
<p>另一个问题是，您不能在会话结束时删除JWT，因为它是独立的，并且没有中央权威机构来使它们无效。</p>
<p>最后，简单来说，jwt都比较大。当与cookies一起使用时，每个请求的开销会增加很多。</p>
<p>将jwt用于会话令牌起初看起来是个好主意，因为:</p>
<ul>
<li>您可以在客户端存储任何类型的用户详细信息</li>
<li>服务器可以信任客户端，因为JWT是签名的，不需要调用数据库来检索您已经存储在JWT中的信息</li>
<li>当您最终遇到水平伸缩的问题时，您不需要在一个集中的数据库中协调会话</li>
</ul>
<p>最后，如果您的应用程序已经有了一个数据库，只需使用一个sessions表，并使用服务器端框架提供的常规会话。</p>
<p>为什么？使用jwt是有代价的:每个请求都要向服务器发送jwt，与服务器端会话相比，这总是一个很高的代价。</p>
<p>此外，虽然使用HTTPS发送jwt的安全风险被降到了最低，但它总是有可能被拦截，数据被破译，从而暴露用户的数据。</p>
<h2 id="using-jwt-for-api-authentication">使用JWT进行API认证</h2>
<p>JWT的一个非常常见的用途——也许是唯一好的用途——是作为一种API认证机制。</p>
<p>JWT技术是如此受欢迎和广泛使用，以至于谷歌用它来让你认证其API。</p>
<p>这个想法很简单:当您设置API时，您从服务中获得一个秘密令牌:</p>
<p><img data-attachment-id="57376" data-permalink="https://blog.logrocket.com/jwt-authentication-best-practices/attachment/jwt-authentication-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-diagram.png" data-orig-size="720,316" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="JWT authentication diagram" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-diagram-300x132.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-diagram.png" decoding="async" class="aligncenter size-full wp-image-57376 jetpack-lazy-image" src="../Images/57cddbda34080a12a5acb7ed930df67a.png" alt="JWT Authentication Diagram" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-diagram.png 720w, https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-diagram-300x132.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-diagram.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-diagram.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="57376" data-permalink="https://blog.logrocket.com/jwt-authentication-best-practices/attachment/jwt-authentication-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-diagram.png" data-orig-size="720,316" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="JWT authentication diagram" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-diagram-300x132.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-diagram.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-57376" src="../Images/57cddbda34080a12a5acb7ed930df67a.png" alt="JWT Authentication Diagram" srcset="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-diagram.png 720w, https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-diagram-300x132.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-diagram.png"/></noscript>
<p>在客户端，您使用秘密令牌创建令牌(有许多这样的库)并对其进行签名。</p>
<p>当您将它作为API请求的一部分传递时，服务器将知道它是那个特定的客户机，因为请求是用它的唯一标识符签名的:</p>
<p><img data-attachment-id="57377" data-permalink="https://blog.logrocket.com/jwt-authentication-best-practices/attachment/jwt-authentication-api-request/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-api-request.png" data-orig-size="720,448" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="JWT authentication API request" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-api-request-300x187.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-api-request.png" decoding="async" class="aligncenter size-full wp-image-57377 jetpack-lazy-image" src="../Images/04c556fb6e9ab3dba14aed8dfc8d093d.png" alt="JWT Authentication API Request" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-api-request.png 720w, https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-api-request-300x187.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-api-request.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-api-request.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="57377" data-permalink="https://blog.logrocket.com/jwt-authentication-best-practices/attachment/jwt-authentication-api-request/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-api-request.png" data-orig-size="720,448" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="JWT authentication API request" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-api-request-300x187.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-api-request.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-57377" src="../Images/04c556fb6e9ab3dba14aed8dfc8d093d.png" alt="JWT Authentication API Request" srcset="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-api-request.png 720w, https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-api-request-300x187.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-authentication-api-request.png"/></noscript>
<h2 id="how-to-expire-a-single-token">如何使单个JWT令牌过期</h2>
<p>如何使单个令牌失效？一个简单的解决方案是更改服务器密钥，这会使所有令牌失效。然而，这对用户来说并不理想，他们的令牌可能会无缘无故过期。</p>
<p>一种方法是向服务器数据库中的用户对象添加一个属性，以引用创建令牌的日期和时间。</p>
<p>令牌自动将该值存储在<code>iat</code>属性中。每次检查令牌时，都可以将它的<code>iat</code>值与服务器端的<code>user</code>属性进行比较。</p>
<p>要使令牌无效，只需更新服务器端的值。如果<code>iat</code>比这个旧，可以拒绝令牌。</p>
<p>实现这一点的另一种方法是在缓存在内存中的数据库中建立一个阻止列表(或者更好，一个允许列表)。</p>
<h2 id="store-jwts-securely">如何在cookie中安全地存储jwt</h2>
<p>JWT需要存储在用户浏览器中的安全位置。如果将它存储在localStorage中，页面中的任何脚本都可以访问它。这听起来很糟糕；XSS攻击可能会让外部攻击者访问令牌。</p>
<p>再次重申，无论您做什么，不要在本地存储(或会话存储)中存储JWT。如果您的页面中包含的任何第三方脚本遭到破坏，它可以访问您的所有用户的令牌。</p>
<p>为了保证它们的安全，您应该总是将jwt存储在httpOnly cookie中。这是一种特殊的cookie，只在HTTP请求中发送给服务器。从浏览器中运行的JavaScript永远无法访问它(无论是读还是写)。</p>
<h2 id="using-jwt-for-spa-authentication">使用JWT进行SPA身份验证</h2>
<p>JWTs可以用作不需要数据库的认证机制。服务器可以避免使用数据库，因为发送到客户端的JWT中的数据存储是安全的。</p>
<h2 id="using-jwt-to-authorize-operations-across-servers">使用JWT授权跨服务器的操作</h2>
<p>假设您有一个登录的服务器SERVER1，它将您重定向到另一个服务器SERVER2来执行某种操作。</p>
<p>服务器1可以向您颁发授权您访问服务器2的JWT。这两台服务器不需要共享会话或任何东西来验证您的身份。这个令牌非常适合这个用例。</p>
<h2 id="how-to-choose-the-perfect-jwt-library">如何选择最好的JWT图书馆</h2>
<p>你如何决定在你的项目中使用哪个JWT图书馆？一个好的起点是这个用于令牌签名和验证的<a href="https://jwt.io/" target="_blank" rel="noopener"> JWT库列表</a>。</p>
<p>该网站包含了实现JWT的最流行的库的列表，包括用于<a href="https://blog.logrocket.com/jwt-authentication-from-scratch-vue-js-node-js/" target="_blank" rel="noopener"> Node.js </a>、Python、<a href="https://blog.logrocket.com/jwt-authentication-in-rust/" target="_blank" rel="noopener"> Rust </a>、Go、JavaScript等等的库。</p>
<p>选择您所选择的语言，并挑选您喜欢的库——理想情况下，是绿色检查次数最多的库。</p>
<p><img data-attachment-id="57385" data-permalink="https://blog.logrocket.com/jwt-authentication-best-practices/attachment/jwt-libraries-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-libraries-1.png" data-orig-size="720,513" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="List of JWT libraries" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-libraries-1-300x214.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-libraries-1.png" decoding="async" class="aligncenter size-full wp-image-57385 jetpack-lazy-image" src="../Images/977f6d387f153dd46564eb33205a8a17.png" alt="List of JWT Authentication Libraries" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-libraries-1.png 720w, https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-libraries-1-300x214.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-libraries-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-libraries-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="57385" data-permalink="https://blog.logrocket.com/jwt-authentication-best-practices/attachment/jwt-libraries-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-libraries-1.png" data-orig-size="720,513" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="List of JWT libraries" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-libraries-1-300x214.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-libraries-1.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-57385" src="../Images/977f6d387f153dd46564eb33205a8a17.png" alt="List of JWT Authentication Libraries" srcset="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-libraries-1.png 720w, https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-libraries-1-300x214.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/10/jwt-libraries-1.png"/></noscript>
<h2 id="conclusion">结论</h2>
<p>JWT是一个非常流行的标准，您可以使用它通过签名来信任请求，并在各方之间交换信息。确保你知道什么时候最好用，什么时候最好用别的，以及如何预防最基本的安全问题。</p><div class="code-block code-block-2">
<div class="blog-plug base-cta"><h2>使用<a class="signup" href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>消除传统错误报告的干扰</h2>
<a href="https://lp.logrocket.com/blg/signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p><a href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一个数字体验分析解决方案，它可以保护您免受数百个假阳性错误警报的影响，只针对几个真正重要的项目。LogRocket会告诉您应用程序中实际影响用户的最具影响力的bug和UX问题。</p>
<p>然后，使用具有深层技术遥测的会话重放来确切地查看用户看到了什么以及是什么导致了问题，就像你在他们身后看一样。</p>
<p>LogRocket自动聚合客户端错误、JS异常、前端性能指标和用户交互。然后LogRocket使用机器学习来告诉你哪些问题正在影响大多数用户，并提供你需要修复它的上下文。</p>
<p>关注重要的bug—<a class="signup" href="https://lp.logrocket.com/blg/signup-issue-free" target="_blank" rel="noopener noreferrer">今天就试试LogRocket】。</a></p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>