<html>
<head>
<title>How to build a progressive web app (PWA) with Node.js - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何用Node.js - LogRocket Blog构建渐进式web app (PWA)</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/#0001-01-01">https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/#0001-01-01</a></blockquote><div><article class="article-post">
<p>形象化渐进式web应用程序(PWA)的一种方法是将其与行为和感觉像移动应用程序的web技术进行比较。例如，大多数移动应用程序都有闪屏来通知用户它正在加载，离线时保持某种功能，并快速工作，因为用户需要的大部分资源在他们下载应用程序时已经在手机上了。</p>
<p>在本教程中，我们将演示如何构建一个具有离线功能并符合所有Google Lighthouse检查的PWA。</p>
<h2 id="projectsetup">项目设置</h2>
<p>在我们开始之前，让我们概述一些要求。请注意，这些要求只是为了本教程的目的；您可以混合、搭配和交换它们中的任何一种，以满足您的需求和目标。</p>
<p>对于这个项目，您需要:<br/>–node . js来运行服务器<br/>–Express来运行HTTP服务器<br/>–node mon来调试服务器<br/>–Chrome来检查网站并调试您的PWA<br/>–OpenSSL来生成自签名证书(稍后将详细介绍)</p>
<h3>文件夹</h3>
<pre>project-folder
  |_certs
  |_public
    |_images
    |_js</pre>
<h3>文件</h3>
<pre>project-folder
  |_certs
  |_public
    |_images
    |_js
      |_pwa.js
    |_index.html
  |_package.json
  |_server.js
</pre>
<h3><code>package.json</code></h3>
<p>用<code>npm init</code>生成<code>package.json</code>并填空题。把包裹拿走，然后前往<code>npm install express nodemon</code>。在<code>package.json</code>中，添加剧本<code>"server-debug": "nodemon --inspect server.js"</code>。</p>
<h3><code>server.js</code></h3>
<p>创建一个基本的HTTP服务器，以便在浏览器中连接到本地主机后生成您的<code>index.html</code>。</p>
<pre>const express = require('express')
const path = require('path')

const httpPort = 80

const app = express()

app.use(express.static(path.join(__dirname, 'public')))

app.get('/', function(req, res) {
  res.sendFile(path.join(__dirname, 'public/index.html'))
})

app.listen(httpPort, function () {
  console.log(`Listening on port ${httpPort}!`)
})
</pre>
<h3><code>public/index.html</code></h3>
<pre>&lt;html&gt;
  &lt;body&gt;
    &lt;span&gt;This example is for the article of progressive web apps written for LogRocket&lt;/span&gt;
    &lt;br&gt;
    &lt;span&gt;You are now&lt;/span&gt; &lt;span&gt;&lt;b class="page-status"&gt;online&lt;/b&gt;&lt;/span&gt;
    &lt;script src="/js/pwa.js"&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<h3><code>public/js/pwa.js</code></h3>
<pre>document.addEventListener('DOMContentLoaded', init, false);
function init() {
  console.log('empty for now')
}
</pre>
<p>在浏览器中，访问<code><a href="http://localhost" rel="nofollow">http://localhost</a></code>以查看仅包含初始信息的页面。<code>Right-click→inspect</code>在控制台上查看您的日志。</p>
<h2 id="buildingapwa">建设公共工程部</h2>
<p>现在你已经建立了一个基本的页面，你如何让谷歌把它识别为一个功能齐全的PWA？</p>
<p>再次检查并选择审计选项卡，然后选择渐进式Web应用程序，并运行审计。您应该会得到这样的结果:</p>
<p><img data-attachment-id="16486" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/lighthouse-audit-pwa/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa.png" data-orig-size="720,720" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Lighthouse audit of a PWA" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-300x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa.png" decoding="async" class="aligncenter size-full wp-image-16486 jetpack-lazy-image" src="../Images/620f108d940636c643d3df66512f8bc3.png" alt="Lighthouse Audit of a PWA" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-300x300.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-150x150.png 150w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="16486" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/lighthouse-audit-pwa/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa.png" data-orig-size="720,720" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Lighthouse audit of a PWA" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-300x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-16486" src="../Images/620f108d940636c643d3df66512f8bc3.png" alt="Lighthouse Audit of a PWA" srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-300x300.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-150x150.png 150w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa.png"/></noscript>
<p>如你所见，大部分结果是红色的。我们将继续努力，直到每一个都变成绿色。</p>
<p>有些已经是绿色的了，因为:</p>
<ul>
<li>加载页面不到10秒钟</li>
<li>即使JavaScript不可用，页面也会显示一些文本</li>
<li>因为我们使用的是本地主机，所以即使没有HTTPS，页面也会被检查</li>
</ul>
<h2 id="addingamanifest">添加清单</h2>
<p>添加清单将解决可安装性标准以及缺少闪屏的问题。</p>
<h3><code>public/js/pwa.webmanifest</code></h3>
<pre>{
  "name": "Progressive Web App example",
  "short_name": "pwa-tutorial",
  "description": "Progressive Web App example to be used in conjuction with the article in LogRocket",
  "icons": [
    {
      "src": "/../images/splash-screen.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ],
  "start_url": "/",
  "display": "fullscreen",
  "theme_color": "#764ABC",
  "background_color": "#764ABC"
}
</pre>
<h3><code>public/index.html</code></h3>
<pre>&lt;html&gt;
  &lt;head&gt;
    &lt;link rel="manifest" href="/js/pwa.webmanifest"&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;span&gt;This example is for the article of progressive web apps written for LogRocket&lt;/span&gt;
    &lt;br&gt;
    &lt;span&gt;You are now&lt;/span&gt; &lt;span&gt;&lt;b class="page-status"&gt;online&lt;/b&gt;&lt;/span&gt;
    &lt;script src="/js/pwa.js"&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<h3><code>public/images/splash-screen.png</code></h3>
<p>您还需要在images文件夹中添加一个512×512的图像。称之为<code>splash-screen.png</code>。</p>
<p><img data-attachment-id="16478" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/spash-screen-image-512x512-pwa/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/spash-screen-image-512x512-pwa.png" data-orig-size="512,512" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Spash screen image, 512×512" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/spash-screen-image-512x512-pwa-300x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/spash-screen-image-512x512-pwa.png" decoding="async" class="aligncenter size-full wp-image-16478 jetpack-lazy-image" src="../Images/0cbd99663ef8186805cc094ad58ab86d.png" alt="Splash Screen Image, 512x512" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/spash-screen-image-512x512-pwa.png 512w, https://blog.logrocket.com/wp-content/uploads/2020/04/spash-screen-image-512x512-pwa-300x300.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/04/spash-screen-image-512x512-pwa-150x150.png 150w" data-lazy-sizes="(max-width: 512px) 100vw, 512px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/04/spash-screen-image-512x512-pwa.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/spash-screen-image-512x512-pwa.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="16478" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/spash-screen-image-512x512-pwa/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/spash-screen-image-512x512-pwa.png" data-orig-size="512,512" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Spash screen image, 512×512" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/spash-screen-image-512x512-pwa-300x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/spash-screen-image-512x512-pwa.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-16478" src="../Images/0cbd99663ef8186805cc094ad58ab86d.png" alt="Splash Screen Image, 512x512" srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/spash-screen-image-512x512-pwa.png 512w, https://blog.logrocket.com/wp-content/uploads/2020/04/spash-screen-image-512x512-pwa-300x300.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/04/spash-screen-image-512x512-pwa-150x150.png 150w" sizes="(max-width: 512px) 100vw, 512px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/spash-screen-image-512x512-pwa.png"/></noscript>
<p>现在，与清单和闪屏相关联的红色复选标记应该是绿色的。</p>
<p>当用户在他们的手机上打开PWA，按下“添加到主屏幕”，并使用下载到他们手机上的应用程序打开PWA时，这个闪屏开始播放。</p>
<h2 id="optimizingyourpwa">优化您的PWA</h2>
<p>让我们继续进行简单的检查，例如主题颜色、显示应用程序何时在iOS设备上使用的图标，以及确保应用程序响应的视口。</p>
<h3><code>public/index.html</code></h3>
<pre>&lt;html&gt;
  &lt;head&gt;
    &lt;link rel="manifest" href="/js/pwa.webmanifest"&gt;
    &lt;link rel="apple-touch-icon" href="/images/apple-touch.png"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
    &lt;meta name="theme-color" content="#764ABC"/&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;span&gt;This example is for the article of progressive web apps written for LogRocket&lt;/span&gt;
    &lt;br&gt;
    &lt;span&gt;You are now&lt;/span&gt; &lt;span&gt;&lt;b class="page-status"&gt;online&lt;/b&gt;&lt;/span&gt;
    &lt;script src="/js/pwa.js"&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<h3><code>public/images/apple-touch.png</code></h3>
<p>下面是iOS设备上显示的图标。应该是192×192。</p>
<p><img data-attachment-id="16474" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/pwa-icon-ios/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-icon-ios.png" data-orig-size="192,192" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="PWA iOS icon" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-icon-ios.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-icon-ios.png" decoding="async" class="aligncenter size-full wp-image-16474 jetpack-lazy-image" src="../Images/155959aaf6d88ebe1764991ccc94d7ee.png" alt="PWA iOS Icon" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-icon-ios.png 192w, https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-icon-ios-150x150.png 150w" data-lazy-sizes="(max-width: 192px) 100vw, 192px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-icon-ios.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-icon-ios.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="16474" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/pwa-icon-ios/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-icon-ios.png" data-orig-size="192,192" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="PWA iOS icon" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-icon-ios.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-icon-ios.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-16474" src="../Images/155959aaf6d88ebe1764991ccc94d7ee.png" alt="PWA iOS Icon" srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-icon-ios.png 192w, https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-icon-ios-150x150.png 150w" sizes="(max-width: 192px) 100vw, 192px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-icon-ios.png"/></noscript>
<p>完成这些更改后，再次运行Lighthouse。你应该会看到更多的绿色标记。</p>
<p><img data-attachment-id="16488" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/lighthouse-audit-pwa-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-2.png" data-orig-size="720,665" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Lighthouse audit of a PWA" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-2-300x277.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-2.png" decoding="async" class="aligncenter size-full wp-image-16488 jetpack-lazy-image" src="../Images/a57dbcba875fcb0e8155ac5c0c6f5b86.png" alt="Lighthouse Audit of a PWA" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-2.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-2-300x277.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-2.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="16488" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/lighthouse-audit-pwa-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-2.png" data-orig-size="720,665" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Lighthouse audit of a PWA" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-2-300x277.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-2.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-16488" src="../Images/a57dbcba875fcb0e8155ac5c0c6f5b86.png" alt="Lighthouse Audit of a PWA" srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-2.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-2-300x277.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-2.png"/></noscript>
<p>在PWA优化下仍有一个红色标记:所有PWA必须与HTTPS一起使用。这个需求要求使用诸如服务人员之类的技术来确保页面是本地主机还是HTTPS。</p>
<p>我通常通过在反向代理上添加SSL来消除这个错误。这意味着我总是在本地将该标准标记为红色，但出于本教程的目的——只是为了满足看到所有绿色检查——我们将生成一个自签名证书，并将服务器更改为重定向到HTTPS。</p>
<p>要生成自签名证书，请转到<code>certs</code>文件夹，并在命令行上运行以下命令。</p>
<pre>openssl req -x509 -out localhost.crt -keyout localhost.key \
  -newkey rsa:2048 -nodes -sha256 \
  -subj '/CN=localhost' -extensions EXT -config &lt;( \
   printf "[dn]\nCN=localhost\n[req]\ndistinguished_name = dn\n[EXT]\nsubjectAltName=DNS:localhost\nkeyUsage=digitalSignature\nextendedKeyUsage=serverAuth")
</pre>
<p>这将创建您丢失的文件。现在你可以更新你的服务器了。</p>
<h3><code>server.js</code></h3>
<pre>const express = require('express')
const path = require('path')
const fs = require('fs')
const https = require('https')

const httpPort = 80
const httpsPort = 443
const key = fs.readFileSync('./certs/localhost.key');
const cert = fs.readFileSync('./certs/localhost.crt');

const app = express()
const server = https.createServer({key: key, cert: cert }, app);

app.use((req, res, next) =&gt; {
  if (!req.secure) {
    return res.redirect('https://' + req.headers.host + req.url);
  }
  next();
})

app.use(express.static(path.join(__dirname, 'public')))

app.get('/', function(req, res) {
  res.sendFile(path.join(__dirname, 'public/index.html'))
})

app.listen(httpPort, function () {
  console.log(`Listening on port ${httpPort}!`)
})

server.listen(httpsPort, function () {
  console.log(`Listening on port ${httpsPort}!`)
})
</pre>
<p>我们正在做的是在端口80 (HTTP)上创建一个服务器，在端口443 (HTTPS)上创建一个服务器。每当您尝试使用<a href="http://localhost" rel="nofollow"> http://localhost </a>访问localhost时，http就会被触发，中间件会检查连接(HTTPS)是否安全。如果不是，那么它会按照预期进行重定向。</p>
<p>下一步是让应用程序即使在失去连接的情况下也能工作。为此，我们将使用服务人员。</p>
<h2 id="serviceworkers">服务人员</h2>
<p>一个<a href="https://blog.logrocket.com/every-website-deserves-a-service-worker/" target="_blank" rel="noopener noreferrer">服务工作器</a>是一段JavaScript代码，它处理您选择保存以备将来请求的资产和数据的缓存。</p>
<p>要让服务人员正常工作，您必须遵守一些规则:</p>
<pre>- It only works with valid HTTPS or http://localhost
- It only grabs requests within its scope
- It only has access to the files on its folder or “below”
</pre>
<p>为了扩大范围，想象下面的结构。</p>
<pre>/public
  |_drinks
    |_drinks-service-worker.js
    |_drinks.js
    |_coffee
      |_coffee.js
      |_coffee-service-worker.js
    |_tea
      |_tea.js
      |_tea-service-worker.js
</pre>
<p>对于这个例子，茶和咖啡服务人员只有在调用他们各自文件夹中的文件时才会触发，例如<code>tea.js</code>或<code>coffee.js</code>。另一方面，不管你叫什么，饮料服务人员都会被触发；它的范围是它的文件夹和“下面”中的所有内容</p>
<p>因为它是一个工作者，所以它不能访问DOM——这意味着，在一个服务工作者文件中，你不能访问任何东西，比如说，<code>document.querySelector</code>。</p>
<p>要注册您的员工，首先检查浏览器是否兼容。如果是，添加注册和错误函数。</p>
<h3><code>public/js/pwa.js</code></h3>
<pre>document.addEventListener('DOMContentLoaded', init, false);
function init() {
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js')
      .then((reg) =&gt; {
        console.log('Service worker registered --&gt;', reg);
      }, (err) =&gt; {
        console.error('Service worker not registered --&gt;', err);
      });
  }
}
</pre>
<h3><code>public/service-worker.js</code></h3>
<pre>self.addEventListener('install', function(event) {
  console.log('used to register the service worker')
})

self.addEventListener('fetch', function(event) {
  console.log('used to intercept requests so we can check for the file or data in the cache')
})

self.addEventListener('activate', function(event) {
  console.log('this event triggers when the service worker activates')
})
</pre>
<p>对于您的服务人员，您不需要其他事件，但是为了方便起见，它们是<code>message</code>、<code>sync</code>和<code>push</code>。</p>
<p>因为安装是当您尝试注册一个软件时触发的第一件事，所以将您的事件更改为以下内容，并指定您想要保存在缓存中的文件。</p>
<pre>const CACHE_NAME = 'sw-cache-example';
const toCache = [
  '/',
  '/index.html',
];

self.addEventListener('install', function(event) {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(function(cache) {
        return cache.addAll(toCache)
      })
      .then(self.skipWaiting())
  )
})
</pre>
<p>添加<code>skipWaiting</code>用于更新软件时，以避免用户离开页面。</p>
<p>要查看您的服务人员，请再次检查页面。在Chrome DevTools中，在应用程序选项卡中，您可以看到您的服务人员的当前状态，将页面设置为离线以进行测试(剧透:它还不会做任何事情)。检查当前缓存，如果要重新启动，请清除所有内容。</p>
<p>您可能还记得，服务人员需要有效的HTTPS证书。因此，您可能会发现以下错误。</p>
<p><img data-attachment-id="16482" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/service-worker-https-certificate-error/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-https-certificate-error.png" data-orig-size="720,26" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Service worker registration error" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-https-certificate-error-300x11.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-https-certificate-error.png" decoding="async" class="aligncenter size-full wp-image-16482 jetpack-lazy-image" src="../Images/5624a1444472a59241a82036e19f4c6b.png" alt="Service Worker Registration Error" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-https-certificate-error.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-https-certificate-error-300x11.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-https-certificate-error.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-https-certificate-error.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="16482" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/service-worker-https-certificate-error/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-https-certificate-error.png" data-orig-size="720,26" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Service worker registration error" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-https-certificate-error-300x11.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-https-certificate-error.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-16482" src="../Images/5624a1444472a59241a82036e19f4c6b.png" alt="Service Worker Registration Error" srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-https-certificate-error.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-https-certificate-error-300x11.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-https-certificate-error.png"/></noscript>
<p>避免这种情况的一种方法是通过命令行运行Chrome，并为<a href="https://localhost" rel="nofollow"> https://localhost </a>添加一个标志。</p>
<pre>/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --user-data-dir=/tmp/foo --ignore-certificate-errors --unsafely-treat-insecure-origin-as-secure=https://localhost
</pre>
<p>这应该会产生一个更令人愉快的记录。</p>
<p><img data-attachment-id="16481" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/service-worker-registered/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-registered.png" data-orig-size="720,38" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Service worker registered" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-registered-300x16.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-registered.png" decoding="async" class="aligncenter size-full wp-image-16481 jetpack-lazy-image" src="../Images/2f62f626309ece8a2282acd2f4a03bd7.png" alt="Service Worker Registered" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-registered.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-registered-300x16.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-registered.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-registered.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="16481" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/service-worker-registered/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-registered.png" data-orig-size="720,38" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Service worker registered" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-registered-300x16.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-registered.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-16481" src="../Images/2f62f626309ece8a2282acd2f4a03bd7.png" alt="Service Worker Registered" srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-registered.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-registered-300x16.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/service-worker-registered.png"/></noscript>
<p>每当我们更新我们的服务人员时，我们都希望旧的服务人员被删除，而不是将他们留在客户端的浏览器中。转到您的<code>activate</code>事件，将其更改为以下内容。</p>
<pre>self.addEventListener('activate', function(event) {
  event.waitUntil(
    caches.keys()
      .then((keyList) =&gt; {
        return Promise.all(keyList.map((key) =&gt; {
          if (key !== CACHE_NAME) {
            console.log('[ServiceWorker] Removing old cache', key)
            return caches.delete(key)
          }
        }))
      })
      .then(() =&gt; self.clients.claim())
  )
})
</pre>
<p>这样可以确保旧的服务人员被删除，并要求您新安装的软件从现在开始使用。</p>
<p>那就剩下我们去取了。我们还没有使用我们的缓存文件，所以是时候更新我们的fetch事件了。</p>
<pre>self.addEventListener('fetch', function(event) {
  event.respondWith(
    fetch(event.request)
      .catch(() =&gt; {
        return caches.open(CACHE_NAME)
          .then((cache) =&gt; {
            return cache.match(event.request)
          })
      })
  )
})
</pre>
<p>这将检查页面上发出的每个请求。如果在缓存中找到了匹配项——以<code>localhost/</code>为例，因为我们已经缓存了它——它将使用缓存的版本。</p>
<p>在这种情况下，<code>/</code>就是<code>index.html</code>文件，它将包含其他资源，比如<code>/js/pwa.js</code>。这不在您的缓存中，因此将向服务器发出一个普通请求来获取该文件的依赖项。</p>
<p>我们可以在缓存中存储尽可能多的内容，但是请记住，每个浏览器都有一个很大的限制。以我的经验来看，安全值不超过50MB，这在web上，是相当多的。</p>
<p>这三个事件都完成后，就应该创建一个文件，以便在客户端失去连接并使用纯服务人员时，将页面状态从online更改为offline。</p>
<h3><code>public/js/status.js</code></h3>
<pre>document.addEventListener('DOMContentLoaded', init, false);

function init() {
  if (!navigator.onLine) {
    const statusElem = document.querySelector('.page-status')
    statusElem.innerHTML = 'offline'
  }
}
</pre>
<h3><code>public/index.html</code></h3>
<pre>&lt;html&gt;
  &lt;head&gt;
    &lt;link rel="manifest" href="/js/pwa.webmanifest"&gt;
    &lt;link rel="apple-touch-icon" href="/images/apple-touch.png"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
    &lt;meta name="theme-color" content="#764ABC"/&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;span&gt;This in an examples for here article of progressive web apps that can be found in LogRocket&lt;/span&gt;
    &lt;br&gt;
    &lt;span&gt;You are now&lt;/span&gt; &lt;span&gt;&lt;b class="page-status"&gt;online&lt;/b&gt;&lt;/span&gt;
    &lt;script src="/js/pwa.js"&gt;&lt;/script&gt;
    &lt;script src="/js/status.js"&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>
<h3><code>public/service-worker.js</code></h3>
<pre>const CACHE_NAME = 'sw-cache-example';
const toCache = [
  '/',
  '/index.html',
  '/js/status.js',
];

self.addEventListener('install', function(event) {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(function(cache) {
        return cache.addAll(toCache)
      })
      .then(self.skipWaiting())
  )
})

self.addEventListener('fetch', function(event) {
  event.respondWith(
    fetch(event.request)
      .catch(() =&gt; {
        return caches.open(CACHE_NAME)
          .then((cache) =&gt; {
            return cache.match(event.request)
          })
      })
  )
})

self.addEventListener('activate', function(event) {
  event.waitUntil(
    caches.keys()
      .then((keyList) =&gt; {
        return Promise.all(keyList.map((key) =&gt; {
          if (key !== CACHE_NAME) {
            console.log('[ServiceWorker] Removing old cache', key)
            return caches.delete(key)
          }
        }))
      })
      .then(() =&gt; self.clients.claim())
  )
})
</pre>
<p>上面的代码添加了一个状态文件来检查浏览器是否在线，如果不在线，就改为离线。我们在软件的<code>index.html</code>和缓存中都包含了这个文件，所以它可以离线使用。</p>
<p>要全部尝试，重新加载页面，在DevTools应用程序选项卡上，查看缓存中的文件。</p>
<p><img data-attachment-id="16489" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/pwa-devtools-application-tab/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-devtools-application-tab.png" data-orig-size="720,432" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Viewing a PWA in Google DevTools" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-devtools-application-tab-300x180.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-devtools-application-tab.png" decoding="async" class="aligncenter size-full wp-image-16489 jetpack-lazy-image" src="../Images/1e41e84182f191cafa8e28b13366ce88.png" alt="Viewing a PWA in Google DevTools" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-devtools-application-tab.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-devtools-application-tab-300x180.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-devtools-application-tab.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-devtools-application-tab.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="16489" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/pwa-devtools-application-tab/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-devtools-application-tab.png" data-orig-size="720,432" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Viewing a PWA in Google DevTools" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-devtools-application-tab-300x180.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-devtools-application-tab.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-16489" src="../Images/1e41e84182f191cafa8e28b13366ce88.png" alt="Viewing a PWA in Google DevTools" srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-devtools-application-tab.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-devtools-application-tab-300x180.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-devtools-application-tab.png"/></noscript>
<p>如果连接正常，您应该会看到以下内容:</p>
<p><img data-attachment-id="16483" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/pwa-test-connection-working/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-test-connection-working.png" data-orig-size="720,90" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Testing the connection in a PWA" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-test-connection-working-300x38.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-test-connection-working.png" decoding="async" class="aligncenter size-full wp-image-16483 jetpack-lazy-image" src="../Images/5849206bde9c11836705227c3eeec63d.png" alt="Testing the Connection in a PWA" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-test-connection-working.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-test-connection-working-300x38.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-test-connection-working.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-test-connection-working.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="16483" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/pwa-test-connection-working/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-test-connection-working.png" data-orig-size="720,90" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Testing the connection in a PWA" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-test-connection-working-300x38.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-test-connection-working.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-16483" src="../Images/5849206bde9c11836705227c3eeec63d.png" alt="Testing the Connection in a PWA" srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-test-connection-working.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-test-connection-working-300x38.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/pwa-test-connection-working.png"/></noscript>
<p>如果选择脱机选项，您应该会看到状态发生变化。</p>
<p><img data-attachment-id="16485" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/offline-status-change/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/offline-status-change.png" data-orig-size="720,40" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Changing to offline status in PWA" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/offline-status-change-300x17.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/offline-status-change.png" decoding="async" class="aligncenter size-full wp-image-16485 jetpack-lazy-image" src="../Images/d4a048cc2c6b6324012084241c532e78.png" alt="Changing to Offline Status in PWA" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/offline-status-change.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/offline-status-change-300x17.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/04/offline-status-change.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/offline-status-change.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="16485" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/offline-status-change/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/offline-status-change.png" data-orig-size="720,40" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Changing to offline status in PWA" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/offline-status-change-300x17.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/offline-status-change.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-16485" src="../Images/d4a048cc2c6b6324012084241c532e78.png" alt="Changing to Offline Status in PWA" srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/offline-status-change.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/offline-status-change-300x17.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/offline-status-change.png"/></noscript>
<p>您应该会在控制台上看到一些错误，因为我们没有添加清单和其他<code>index.html</code>需要的文件——这不会影响离线模式下的任何事情，但如果这很麻烦，您需要做的就是将它们添加到缓存中。</p>
<p>最后，为了确保Lighthouse中的一切都是绿色的，在没有离线检查的情况下运行应用程序。您应该会得到类似如下的结果:</p>
<p><img data-attachment-id="16487" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/lighthouse-audit-pwa-100-percent/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-100-percent.png" data-orig-size="720,702" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Lighthouse PWA score of 100" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-100-percent-300x293.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-100-percent.png" decoding="async" class="aligncenter size-full wp-image-16487 jetpack-lazy-image" src="../Images/79fbcb1c305aecc188c5c6234d40f22e.png" alt="Lighthouse PWA Score of 100" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-100-percent.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-100-percent-300x293.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-100-percent.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-100-percent.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="16487" data-permalink="https://blog.logrocket.com/how-to-build-a-progressive-web-app-pwa-with-node-js/lighthouse-audit-pwa-100-percent/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-100-percent.png" data-orig-size="720,702" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Lighthouse PWA score of 100" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-100-percent-300x293.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-100-percent.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-16487" src="../Images/79fbcb1c305aecc188c5c6234d40f22e.png" alt="Lighthouse PWA Score of 100" srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-100-percent.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-100-percent-300x293.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/lighthouse-audit-pwa-100-percent.png"/></noscript>
<p>祝贺您——您刚刚构建了您的第一个PWA，所有标准都在Lighthouse中检查过了！</p>
<h2 id="compatibility">和睦相处</h2>
<p>PWAs的兼容性无处不在，因为我们谈论的不仅仅是一种技术，而是一个元素生态系统，如服务人员、web应用清单、通知、推送和添加到主屏幕，其中每一项都有完全不同的兼容性。</p>
<p>也就是说，服务人员通常会得到很好的支持。另一方面，web app manifest的兼容性要差得多，在本文撰写之时，它还不适用于Firefox或Safari。</p>
<p>总是检查聚合填充，如果没有，确保在浏览器没有实现该技术时有一个后备。</p>
<h2 id="prosandconsofpwas">公共福利援助的利与弊</h2>
<p>Twitter和阿里巴巴等公司通过<a href="https://pwa.rocks/" target="_blank" rel="noopener noreferrer">转向PWAs</a>提高了参与度，其他许多公司也进行了转换。</p>
<p>根据我的经验和个人阅读，以下是与PWAs相关的优点和缺点的简短列表。</p>
<p>在优点方面，PWAs:</p>
<ul>
<li>在第一次访问网站后速度很快，因为很多资产都被缓存了</li>
<li>易于在现有网站上逐步实现</li>
<li>使用更少的数据，因为许多资产被缓存</li>
<li>是独立的技术，这意味着当你只需要一两种技术时，你不会被10种技术的库所束缚。例如，您可以在不使用通知的情况下使用服务人员</li>
</ul>
<p>一些缺点:</p>
<ul>
<li>第一次访问页面会很慢，因为它必须将文件和数据下载到缓存中</li>
<li>添加到主屏幕功能很少使用，至少据我所知是这样</li>
<li>不同浏览器之间的支持差异很大，这取决于您使用的技术。例如，服务人员有很好的支持，但web应用程序清单没有，因此从一开始就很难确定哪些是可以安全使用的，哪些是需要多填充的</li>
</ul>
<h2 id="conclusion">结论</h2>
<p>实现PWA技术值得吗？我会说是的。一个网站，即使离线，也应该有可访问的信息。例如，如果您运行一个新闻网站，您可以让您的用户选择离线查看他们喜爱的新闻，或者在感兴趣的事情发生时通知他们，比如对他们购物车中的商品进行促销。</p>
<p>你对PWAs有什么看法？你喜欢更自然的方法吗？你用它造过什么东西吗？</p>
<p>可以在<a href="https://github.com/daspinola/pwa-101" target="_blank" rel="noopener noreferrer"> GitHub </a>上参考本教程使用的代码。</p><div class="code-block code-block-23">
<div class="blog-plug inline-plug node-plug"><h2>200只<img src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> <noscript> <img data-lazy-fallback="1" src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> </noscript>显示器出现故障，生产中网络请求缓慢</h2><p>部署基于节点的web应用程序或网站是容易的部分。确保您的节点实例继续为您的应用程序提供资源是事情变得更加困难的地方。如果您对确保对后端或第三方服务的请求成功感兴趣，</p><a href="https://lp.logrocket.com/blg/node-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer"><img src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/><noscript><img data-lazy-fallback="1" src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/></noscript></a><a href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用程序的DVR，记录下用户与你的应用程序交互时发生的一切。您可以汇总并报告有问题的网络请求，以快速了解根本原因，而不是猜测问题发生的原因。</p><p>LogRocket检测您的应用程序以记录基线性能计时，如页面加载时间、到达第一个字节的时间、慢速网络请求，还记录Redux、NgRx和Vuex操作/状态。</p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">Start monitoring for free</a><p>. </p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>