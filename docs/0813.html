<html>
<head>
<title>Create a movie rating app with Keystone.js - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用Keystone.js - LogRocket博客创建电影分级应用程序</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/create-a-movie-rating-app-with-keystone-js/#0001-01-01">https://blog.logrocket.com/create-a-movie-rating-app-with-keystone-js/#0001-01-01</a></blockquote><div><article class="article-post">
<p>WordPress的一个有趣的替代品是一个用Node.js构建的内容管理系统(CMS ),它使用T2 express . js作为后端，使用MongoDB或PostgreSQL数据库作为存储层。它很灵活，使你能够在保持轻量级代码库的同时定制你的CMS，除非WordPress。</p>
<p>Keystone.js提供了非常强大的GraphQL支持。您可以快速定义模式，GraphQL引擎将负责与PostgreSQL或MongoDB的集成。</p>
<p>此外，Keystone.js允许您选择想要使用的底层数据库。它本身支持PostgreSQL和MongoDB，这使您能够在关系数据库和非关系数据库之间进行选择。GraphQL将生成一组与CRUD操作相关的有用查询，因此您不必编写这些查询的代码。这是一个很棒的功能，可以节省你很多时间。</p>
<p>此外，Keystone Admin UI会根据您定义的模式自动更改。所有数据都可以通过管理员用户界面创建、更新和删除。例如，如果您添加一个关于书籍的模式，Keystone.js将生成一个完整的管理面板来管理您的书籍。另一个强大的功能，使开发人员的生活更容易。</p>
<p>在本教程中，我们将演示如何使用Keystone.js构建一个电影分级应用程序。您可以从这个<a href="https://github.com/michielmulders/keystonejs-movie-rating-app" target="_blank" rel="noopener noreferrer"> GitHub资源库</a>下载该项目的完整代码。</p>
<h2>要求</h2>
<p>在你<a href="https://www.keystonejs.com/quick-start/#requirements" target="_blank" rel="noopener noreferrer">开始使用Keystone.js </a>之前，你需要以下内容。(注意:对于本教程，我们将使用MongoDB)。</p>

<p>接下来，确保您的MongoDB实例正在运行。一旦你有了所有的依赖，是时候开始了。</p>
<p>您可以从一个Keystone.js模板开始，比如一个示例待办事项应用程序或一个身份验证示例。然而，出于本教程的目的，我们将从头开始。</p>
<h2>步骤1:项目设置</h2>
<p>首先，使用<code>keystone-app</code>命令创建一个新的Keystone应用程序。您可以在CLI中直接使用这个命令和Yarn。</p>
<pre>yarn create keystone-app movie-rating
</pre>
<p>系统会提示您回答三个问题:</p>
<ol>
<li>项目名称是什么？输入<code>movie-rating</code></li>
<li>您希望使用哪个初学者模板？选择<code>blank</code>生成一个空模板</li>
<li>您想使用哪个适配器？选择<code>Mongoose</code>。</li>
</ol>
<p><img data-attachment-id="17476" data-permalink="https://blog.logrocket.com/create-a-movie-rating-app-with-keystone-js/create-new-app-keystone-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/create-new-app-keystone-1.png" data-orig-size="720,256" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Create a new app with Keystone.js" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/create-new-app-keystone-1-300x107.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/create-new-app-keystone-1.png" decoding="async" class="aligncenter size-full wp-image-17476 jetpack-lazy-image" src="../Images/6c113b9df5a2bcb4c49ee6bcb266bc4a.png" alt="Create a New App With Keystone.js" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/create-new-app-keystone-1.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/create-new-app-keystone-1-300x107.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/04/create-new-app-keystone-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/create-new-app-keystone-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="17476" data-permalink="https://blog.logrocket.com/create-a-movie-rating-app-with-keystone-js/create-new-app-keystone-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/create-new-app-keystone-1.png" data-orig-size="720,256" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Create a new app with Keystone.js" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/create-new-app-keystone-1-300x107.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/create-new-app-keystone-1.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-17476" src="../Images/6c113b9df5a2bcb4c49ee6bcb266bc4a.png" alt="Create a New App With Keystone.js" srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/create-new-app-keystone-1.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/create-new-app-keystone-1-300x107.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/create-new-app-keystone-1.png"/></noscript>
<p>该命令会将正确的项目文件复制到一个名为<code>movie-rating</code>的新文件夹中。您将得到下面的应用程序结构。</p>
<pre>/movie-rating
- /node_modules
- index.js
- package.json
- README.md
</pre>
<p>现在让我们创建存储电影评级的数据模型。</p>
<h2>步骤2:创建数据模型</h2>
<p>在这一步，我们将创建我们的数据模式。目前，我们的<code>index.js</code>文件看起来像下面的代码片段。既然已经连接了<code>MongooseAdapter</code>,我们可以专注于编写我们的模式。</p>
<pre>const { Keystone } = require('@keystonejs/keystone');
const { GraphQLApp } = require('@keystonejs/app-graphql');
const { AdminUIApp } = require('@keystonejs/app-admin-ui');
const { MongooseAdapter: Adapter } = require('@keystonejs/adapter-mongoose');

const PROJECT_NAME = "movie-rating";

const keystone = new Keystone({
  name: PROJECT_NAME,
  adapter: new Adapter(),
});

module.exports = {
  keystone,
  apps: [new GraphQLApp(), new AdminUIApp({ enableDefaultRoute: true })],
};
</pre>
<p>查看<a href="https://gist.github.com/michielmulders/00853641fb7fb56aab51cf8d77351bae" target="_blank" rel="noopener noreferrer">要点</a>上的源代码。</p>
<p>首先，我们需要安装<code>@keystonejs/fields</code>依赖项，它包含我们在模式中定义新字段所需的所有支持的字段类型。</p>
<p>通过Yarn安装此依赖关系:</p>
<pre>yarn add @keystonejs/fields
</pre>
<p>现在我们已经将这个依赖项添加到了我们的项目中，我们可以导入所需的类型，<code>Text</code>和<code>Integer</code>。</p>
<pre>const { Text, Integer } = require('@keystonejs/fields');
</pre>
<p>现在我们可以创建电影分级模式。模式将由两个属性组成:<code>title</code>，它接受一个<code>Text</code>类型，和<code>rating</code>，它接受一个<code>Integer</code>类型。</p>
<pre>keystone.createList('Movie', {
  fields: {
    title: { 
      type: Text,
      isRequired: true,
      isUnique: true
    },
    rating: { 
      type: Integer,
      isRequired: true,
      defaultValue: 10
    }
  },
});
</pre>
<p>您可以为每个<a href="https://www.keystonejs.com/keystonejs/fields/" target="_blank" rel="noopener noreferrer">字段</a>添加额外的属性。例如，您可以将<code>Integer</code>类型与<code>defaultValue </code>属性结合起来。您还可以使用<code>isUnique</code>属性，该属性强制输入是唯一的。</p>
<p>对于这一步，您的代码应该如下所示。</p>
<p/>
<h2>第三步:开始你的项目并探索</h2>
<p>使用以下命令启动项目。</p>
<pre>yarn run dev
</pre>
<p>这将旋转以下元素:</p>

<p>首先，在<a href="http://localhost:3000/admin" rel="nofollow">打开管理UI http://localhost:3000/admin</a>。您将看到新创建的电影列表。</p>
<p><img data-attachment-id="17478" data-permalink="https://blog.logrocket.com/create-a-movie-rating-app-with-keystone-js/movie-rating-app-dashboard-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-1.png" data-orig-size="720,250" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Keystone.js movie rating app dashboard" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-1-300x104.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-1.png" decoding="async" class="aligncenter size-full wp-image-17478 jetpack-lazy-image" src="../Images/bf35eace21f0ab0a8f78d9cc94bef996.png" alt="Keystone.js Movie Rating App Dashboard" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-1.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-1-300x104.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="17478" data-permalink="https://blog.logrocket.com/create-a-movie-rating-app-with-keystone-js/movie-rating-app-dashboard-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-1.png" data-orig-size="720,250" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Keystone.js movie rating app dashboard" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-1-300x104.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-1.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-17478" src="../Images/bf35eace21f0ab0a8f78d9cc94bef996.png" alt="Keystone.js Movie Rating App Dashboard" srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-1.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-1-300x104.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-1.png"/></noscript>
<p>如果您点按“电影”卡片上的加号图标，您可以将新电影添加到列表中。例如，让我们添加“星际”，并将其评级为8。</p>
<p><img data-attachment-id="17477" data-permalink="https://blog.logrocket.com/create-a-movie-rating-app-with-keystone-js/movie-rating-app-dashboard-add-movie-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-add-movie-1.png" data-orig-size="720,319" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Add movie to Keystone.js movie rating app dashboard" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-add-movie-1-300x133.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-add-movie-1.png" decoding="async" class="aligncenter size-full wp-image-17477 jetpack-lazy-image" src="../Images/708dde2576d48e5a0b083e1c8d9c5c24.png" alt="Add Movie to Keystone.js Movie Rating App Dashboard" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-add-movie-1.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-add-movie-1-300x133.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-add-movie-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-add-movie-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="17477" data-permalink="https://blog.logrocket.com/create-a-movie-rating-app-with-keystone-js/movie-rating-app-dashboard-add-movie-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-add-movie-1.png" data-orig-size="720,319" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Add movie to Keystone.js movie rating app dashboard" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-add-movie-1-300x133.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-add-movie-1.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-17477" src="../Images/708dde2576d48e5a0b083e1c8d9c5c24.png" alt="Add Movie to Keystone.js Movie Rating App Dashboard" srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-add-movie-1.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-add-movie-1-300x133.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-dashboard-add-movie-1.png"/></noscript>
<p>点击create按钮，将记录存储在MongoDB实例中。您将看到新创建记录的概述。</p>
<p><img data-attachment-id="17479" data-permalink="https://blog.logrocket.com/create-a-movie-rating-app-with-keystone-js/movie-rating-app-edit-new-record-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-edit-new-record-1.png" data-orig-size="720,240" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Edit new record in Keystone.js movie rating app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-edit-new-record-1-300x100.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-edit-new-record-1.png" decoding="async" class="aligncenter size-full wp-image-17479 jetpack-lazy-image" src="../Images/0f918f455ec39b26cd21211ee9176c06.png" alt="Edit New Record in Keystone.js Movie Rating App" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-edit-new-record-1.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-edit-new-record-1-300x100.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-edit-new-record-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-edit-new-record-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="17479" data-permalink="https://blog.logrocket.com/create-a-movie-rating-app-with-keystone-js/movie-rating-app-edit-new-record-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-edit-new-record-1.png" data-orig-size="720,240" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Edit new record in Keystone.js movie rating app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-edit-new-record-1-300x100.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-edit-new-record-1.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-17479" src="../Images/0f918f455ec39b26cd21211ee9176c06.png" alt="Edit New Record in Keystone.js Movie Rating App" srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-edit-new-record-1.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-edit-new-record-1-300x100.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-edit-new-record-1.png"/></noscript>
<p>让我们再次尝试添加相同的记录。如果已经正确配置了<code>isUnique</code>属性，admin UI应该会抛出一个错误。</p>
<p><img data-attachment-id="17480" data-permalink="https://blog.logrocket.com/create-a-movie-rating-app-with-keystone-js/movie-rating-app-graphql-error-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-graphql-error-1.png" data-orig-size="720,240" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="GraphQL error in Keystone.js movie rating app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-graphql-error-1-300x100.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-graphql-error-1.png" decoding="async" class="aligncenter size-full wp-image-17480 jetpack-lazy-image" src="../Images/c486a01c6102e74a813d07772a7e61d3.png" alt="GraphQL Error in Keystone.js Movie Rating App" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-graphql-error-1.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-graphql-error-1-300x100.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-graphql-error-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-graphql-error-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="17480" data-permalink="https://blog.logrocket.com/create-a-movie-rating-app-with-keystone-js/movie-rating-app-graphql-error-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-graphql-error-1.png" data-orig-size="720,240" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="GraphQL error in Keystone.js movie rating app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-graphql-error-1-300x100.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-graphql-error-1.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-17480" src="../Images/c486a01c6102e74a813d07772a7e61d3.png" alt="GraphQL Error in Keystone.js Movie Rating App" srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-graphql-error-1.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-graphql-error-1-300x100.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-graphql-error-1.png"/></noscript>
<h3>图的力量</h3>
<p>Keystone.js将处理每个已定义的模式，例如电影模式。对于每个模式，它创建<a href="https://www.keystonejs.com/guides/schema#lists" target="_blank" rel="noopener noreferrer"> GraphQL CRUD操作</a>和相关的查询。我们可以使用所有这些查询来更改或访问MongoDB中的数据。</p>
<p>下面是为电影模式生成的操作的概述。</p>
<pre>type Mutation {
  createMovie(..): Movie
  updateMovie(..): Movie
  deleteMovie(..): Movie
}

type Query {
  allMovies(..): [Movie]
  Movie(..): Movie // query single movie
  GetMovies(..): [Movie]
}

type Movie {
  id: ID
  title: String
  rating: Integer
}
</pre>
<p>关于<a href="https://graphql.org/learn/schema/" target="_blank" rel="noopener noreferrer"> GraphQL模式定义语言(SDL) </a>的更多内容，请看官网。</p>
<p>后端部分完成后，下一步是创建一个与电影分级模式交互的接口。</p>
<h2>步骤4:创建接口</h2>
<p>下一步是构建一个简单的静态HTML网站，允许您通过位于<a href="http://localhost:3000/admin/api" rel="nofollow">http://localhost:3000/admin/API</a>的GraphQL API端点与数据进行交互。</p>
<p>要连接到静态页面，添加<code>@keystonejs/app-static</code>依赖项。</p>
<pre>yarn add @keystonejs/app-static 
</pre>
<p>不要忘记在<code>index.js</code>文件的顶部导入依赖关系。</p>
<pre>const { StaticApp } = require('@keystonejs/app-static');
</pre>
<p>可以看到，Keystone.js将静态页面依赖定义为一个应用程序。这意味着我们可以将<code>StaticApp</code>对象添加到apps数组中，该数组在<code>index.js</code>文件的底部导出。</p>
<p>注意我们是如何配置<code>StaticApp</code>对象的:我们告诉该对象在<code>public</code>文件夹中寻找我们的静态页面，我们将在下一步中创建这个文件夹。这个文件夹存放我们将要创建的HTML文件。</p>
<pre>module.exports = {
  keystone,
  apps: [
    new GraphQLApp(), 
    new StaticApp({ path: '/', src: 'public' }),
    new AdminUIApp({ enableDefaultRoute: true })
  ],
};
</pre>
<p>现在让我们在项目的根目录下创建<code>public</code>文件夹。</p>
<pre>mkdir public
</pre>
<p>接下来，创建以下三个文件。</p>
<ol>
<li><code>index.html</code> —保存所有的HTML代码</li>
<li><code>styles.css</code> —静态网站的基本样式</li>
<li><code>script.js</code> —保存与GraphQL端点交互和加载数据的逻辑</li>
</ol>
<p>您的项目文件夹应该如下所示:</p>
<pre>/movie-rating
- /node_modules
- /public
- index.html
- styles.css
- script.js
- index.js
- package.json
- README.md
</pre>
<h3>添加样式</h3>
<p>这不是绝对必要的一步，但是有一个漂亮的界面总是好的。你所要做的就是用下面的内容创建一个<code>styles.css</code>文件。</p>
<p>添加HTML</p>
<h3>将HTML添加到<code>index.html</code>文件中。一定要看一下<code>body</code>标签，在这里我们定义了我们的<code>script</code>元素。这个脚本充当了我们动态加载数据和获取静态HTML所需的所有逻辑的钩子。</h3>
<p>接下来，将以下HTML内容复制到您的<code>index.html</code>文件中。</p>
<pre>&lt;body&gt;
    &lt;script type="text/javascript" id="movie-app" src="/script.js"&gt;&lt;/script&gt;
 &lt;/body&gt;
</pre>
<p>添加脚本逻辑</p>
<p>最重要的一步是添加逻辑。确保将全部内容复制到您的<code>script.js</code>文件中。</p>
<h3>Add script logic</h3>
<p>步骤5:理解script.js的逻辑</p>
<p>让我们从<code>script.js</code>文件的底部开始，试着理解上面的逻辑是如何工作的。这个逻辑替换了我们在<code>index.html</code>文件中定义的脚本标签的内容。下面的代码片段创建了一个简单的网站，该网站带有一个允许用户创建新的电影评级并显示所有提交的评级的表单。</p>
<h2>呈现的界面将如下所示:</h2>
<p><img data-attachment-id="17481" data-permalink="https://blog.logrocket.com/create-a-movie-rating-app-with-keystone-js/movie-rating-app-rendered-interface-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-rendered-interface-1.png" data-orig-size="720,727" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Rendered interface for Keystone.js movie rating app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-rendered-interface-1-297x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-rendered-interface-1.png" decoding="async" class="aligncenter size-full wp-image-17481 jetpack-lazy-image" src="../Images/3b35521dfe000816ee4e41518b7cec89.png" alt="Rendered Interface for Keystone.js Movie Rating App" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-rendered-interface-1.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-rendered-interface-1-297x300.png 297w, https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-rendered-interface-1-150x150.png 150w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-rendered-interface-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-rendered-interface-1.png"/></p>
<pre>document.getElementById('movie-app').parentNode.innerHTML = `
  &lt;div class="app"&gt;
    &lt;h1 class="main-heading"&gt;Welcome to Keystone 5!&lt;/h1&gt;
    &lt;p class="intro-text"&gt;
      Here's a simple demo app that lets you add/remove movie ratings. Create a few entries, then go
      check them out from your &lt;a href="/admin"&gt;Keystone 5 Admin UI&lt;/a&gt;!
    &lt;/p&gt;
    &lt;hr class="divider" /&gt;
    &lt;div class="form-wrapper"&gt;
      &lt;h2 class="app-heading"&gt;Add Movie&lt;/h2&gt;
      &lt;div&gt;
        &lt;form class="js-add-movie-form"&gt;
          &lt;input required name="add-item-movie" placeholder="Add new movie" class="form-input add-item" /&gt;
          &lt;input required name="add-item-rating" placeholder="Add rating" class="form-input add-item" /&gt;
          &lt;input type="submit" value="Submit"&gt;
        &lt;/form&gt;
      &lt;/div&gt;
      &lt;h2 class="app-heading"&gt;Movie List&lt;/h2&gt;
      &lt;div class="results"&gt;
        &lt;p&gt;Loading...&lt;/p&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;`;
</pre>
<p>用户可以通过表单提交电影。当您单击提交按钮时，将触发以下代码。</p>
<p>代码试图通过id<code>add-item-movie</code>和<code>add-item-rating</code>访问表单输入字段中输入的数据。如果已经输入了电影标题和分级，我们将使用正确的数据调用我们的GraphQL端点。</p><noscript><img data-lazy-fallback="1" data-attachment-id="17481" data-permalink="https://blog.logrocket.com/create-a-movie-rating-app-with-keystone-js/movie-rating-app-rendered-interface-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-rendered-interface-1.png" data-orig-size="720,727" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Rendered interface for Keystone.js movie rating app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-rendered-interface-1-297x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-rendered-interface-1.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-17481" src="../Images/3b35521dfe000816ee4e41518b7cec89.png" alt="Rendered Interface for Keystone.js Movie Rating App" srcset="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-rendered-interface-1.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-rendered-interface-1-297x300.png 297w, https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-rendered-interface-1-150x150.png 150w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/04/movie-rating-app-rendered-interface-1.png"/></noscript>
<p>注意，我们将<code>ADD_MOVIE</code>作为第一个参数传递。该常量表示使用GraphQL SDL开发的查询。该查询接受标题和评级。因为它以突变关键字为前缀，所以它可以向数据库添加新数据。</p>
<pre>function addMovie(event) {
    event.preventDefault();
    const form = event.target;

    // Find inputted data via 'add-item-movie' and 'add-item-rating' input elements
    const movie = form.elements['add-item-movie'];
    const rating = form.elements['add-item-rating'];

    if (movie &amp;&amp; rating) {
        graphql(ADD_MOVIE, { title: movie.value, rating: Number(rating.value) }).then(fetchData);
    }

    // Clear the form
    form.reset();
}
</pre>
<p><code>GET_MOVIES</code>查询有助于检索所有电影。当我们读取数据时，我们使用查询关键字而不是突变关键字。该查询显示静态网站上的所有电影。</p>
<p>最后，<code>REMOVE_MOVIE</code>常量保存一个删除电影分级的查询。</p>
<pre>const ADD_MOVIE = `
    mutation AddMovie($title: String!, $rating: Int!) {
      createMovie(data: { title: $title, rating: $rating }) {
        title
        rating
        id
      }
    }
  `;
</pre>
<p>但是我们实际上如何访问GraphQL端点呢？<code>script.js </code>文件包含一个helper函数，用于向我们的GraphQL端点发送POST请求。</p>
<pre>const GET_MOVIES = `
    query GetMovies {
      allMovies {
        title
        rating
        id
      }
    }
  `;
</pre>
<p>第六步:最终测试</p>
<pre>const REMOVE_MOVIE = `
    mutation RemoveMovie($id: ID!) {
      deleteMovie(id: $id) {
        title
        rating
        id
      }
    }
  `;
</pre>
<p>为了验证一切工作正常，让我们开始我们的应用程序。如果应用程序仍在运行，请按CTRL+C (Windows)或CMD+C (Linux/Mac)退出。接下来，重启应用程序，访问位于<a href="http://localhost:3000" rel="nofollow"> http://localhost:3000 </a>的界面。</p>
<pre>function graphql(query, variables = {}) {
    return fetch('/admin/api', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            variables,
            query,
        }),
    }).then(function (result) {
        return result.json();
    }).catch(console.error)
}
</pre>
<h2>尝试添加新电影，并验证它们是否被添加到输入表单下方的电影分级列表中。接下来，尝试通过单击电影分级上的垃圾箱图标来删除电影。评级应该会消失。</h2>
<p>如果一切正常，您就用Kestone.js构建了您的第一个电影分级应用程序。祝贺您！</p>
<pre>yarn run dev
</pre>
<p>监控生产中失败和缓慢的GraphQL请求</p>
<p>虽然GraphQL有一些调试请求和响应的特性，但确保GraphQL可靠地为您的生产应用程序提供资源是一件比较困难的事情。如果您对确保对后端或第三方服务的网络请求成功感兴趣，</p><div class="code-block code-block-24">
<div class="blog-plug inline-plug graphql-plug"><h2>.</h2><p>LogRocket 就像是网络和移动应用的DVR，记录下你网站上发生的每一件事。您可以汇总并报告有问题的GraphQL请求，以快速了解根本原因，而不是猜测问题发生的原因。此外，您可以跟踪Apollo客户机状态并检查GraphQL查询的键值对。</p><a href="https://lp.logrocket.com/blg/graphql-signup" target="_blank">try LogRocket</a><p>LogRocket检测您的应用程序以记录基线性能计时，如页面加载时间、到达第一个字节的时间、慢速网络请求，还记录Redux、NgRx和Vuex操作/状态。</p><a class="signup" href="https://lp.logrocket.com/blg/graphql-signup" target="_blank" rel="noopener noreferrer"><img src="../Images/432a3823c85b3fb72a206e6236a29f48.png" data-lazy-src="https://files.readme.io/69aa835-Image_2019-11-09_at_1.28.05_PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://files.readme.io/69aa835-Image_2019-11-09_at_1.28.05_PM.png"/><noscript><img data-lazy-fallback="1" src="../Images/432a3823c85b3fb72a206e6236a29f48.png" data-original-src="https://files.readme.io/69aa835-Image_2019-11-09_at_1.28.05_PM.png"/></noscript><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><a href="https://lp.logrocket.com/blg/graphql-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>.</p><p>LogRocket instruments your app to record baseline performance timings such as page load time, time to first byte, slow network requests, and also logs Redux, NgRx, and Vuex actions/state. </p><a class="signup" href="https://lp.logrocket.com/blg/graphql-signup" target="_blank" rel="noopener noreferrer">Start monitoring for free</a><p>.</p></div>


</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>