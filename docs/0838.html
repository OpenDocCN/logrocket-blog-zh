<html>
<head>
<title>An in-depth guide to performance optimization with webpack - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用webpack - LogRocket博客进行性能优化的深入指南</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/guide-performance-optimization-webpack/#0001-01-01">https://blog.logrocket.com/guide-performance-optimization-webpack/#0001-01-01</a></blockquote><div><article class="article-post">
<p>如今，您必须使用像<a href="https://webpack.js.org/"> webpack </a>这样的模块捆绑器，才能从利用最先进的性能优化概念的开发工作流中受益。模块捆扎机是由才华横溢的人建造的，只是为了帮助你完成这些困难的任务。</p>
<p>此外，我建议使用一个<a href="https://webpack.js.org/starter-kits/">初学者工具包</a>或者一个已经有webpack配置最佳实践的现代样板项目。在此基础上，您可以进行特定于项目的调整。我喜欢<a href="https://github.com/esausilva/react-starter-boilerplate-hmr">这个React + webpack 4样板项目</a>，这也是这个博客附带演示项目的基础。</p>
<p>webpack 4带有适当的预设。然而，您必须理解相当多的概念才能获得它们的性能优势。此外，调整webpack配置的可能性是无穷无尽的，您需要大量的专业知识来为您的项目找到正确的方法。</p>
<p>你可以跟随我的演示项目的例子。只要切换到上面提到的分支，你就可以亲眼看到调整的效果。<code>master</code>分支代表演示应用程序，以及它的初始webpack配置。只需执行<code>npm run dev</code>来查看项目(应用程序在<code><a href="http://localhost:3000" rel="nofollow">http://localhost:3000</a></code>上打开)。</p>
<pre>// package.json
"scripts": {
  "dev": "webpack-dev-server --env.env=dev",
  "build": "webpack --env.env=prod"
}</pre>
<h2>使用生产模式进行内置优化</h2>
<p>webpack 4引入了<a href="https://webpack.js.org/configuration/mode/">开发和生产模式</a>。您应该始终向您的用户发布产品版本。我想强调这一点，因为你会自动获得许多内置的优化，比如<a href="https://webpack.js.org/guides/tree-shaking/">树摇动</a>、<a href="https://webpack.js.org/configuration/performance/#performancehints">性能提示</a>，或者在生产模式下用<code><a href="https://webpack.js.org/plugins/terser-webpack-plugin/">TerserWebpackPlugin</a></code>缩小。</p>
<p>webpack 4采用了软件工程范式<a href="https://en.wikipedia.org/wiki/Convention_over_configuration">对配置</a>的约定，这基本上意味着你只需将模式设置为<code>"production"</code>就可以获得有意义的配置。但是，您可以通过覆盖默认值来调整配置。在本文中，我们解释了一些与性能相关的配置选项，您可以根据自己的需要为项目定义这些选项。</p>
<p>如果您运行<code>npm run build</code>(在<code><a href="https://github.com/doppelmutzi/react-performance-strategies">master</a></code>分支上)，您会得到以下输出:</p>
<p><img data-attachment-id="18060" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-master/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-master.png" data-orig-size="730,147" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Build output for the master branch" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-master-300x60.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-master.png" decoding="async" class="aligncenter size-full wp-image-18060 jetpack-lazy-image" src="../Images/49f43acccd12eddc8283e3f88223f3dd.png" alt="Build Output For Master Branch" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-master.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-master-300x60.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-master.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-master.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18060" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-master/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-master.png" data-orig-size="730,147" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Build output for the master branch" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-master-300x60.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-master.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18060" src="../Images/49f43acccd12eddc8283e3f88223f3dd.png" alt="Build Output For Master Branch" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-master.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-master-300x60.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-master.png"/></noscript>
<p>打开<code>dist/static/app.js</code>你可以自己看到webpack丑化了我们的捆绑包。</p>
<p>如果您检查分支<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/use-production-mode">use-production-mode</a></code>，您可以看到当您将模式设置为<code>"development"</code>时，<code>app</code>包的大小是如何增加的，因为没有执行一些优化。</p>
<pre>// webpack.prod.js
const config = {
+  mode: "development",
-  mode: "production",
  // ...
}</pre>
<p>结果看起来像这样:</p>
<p><img data-attachment-id="18061" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/development-mode-output-master/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/development-mode-output-master.png" data-orig-size="730,152" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Build output in development mode" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/development-mode-output-master-300x62.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/development-mode-output-master.png" decoding="async" class="aligncenter size-full wp-image-18061 jetpack-lazy-image" src="../Images/7b54bcf75c09c338e22b1a687821f6f2.png" alt="Build Output In Development Mode" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/development-mode-output-master.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/development-mode-output-master-300x62.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/development-mode-output-master.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/development-mode-output-master.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18061" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/development-mode-output-master/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/development-mode-output-master.png" data-orig-size="730,152" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Build output in development mode" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/development-mode-output-master-300x62.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/development-mode-output-master.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18061" src="../Images/7b54bcf75c09c338e22b1a687821f6f2.png" alt="Build Output In Development Mode" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/development-mode-output-master.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/development-mode-output-master-300x62.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/development-mode-output-master.png"/></noscript>
<h2>定期使用webpack-bundle-analyzer</h2>
<p>你应该定期使用awesome<a href="https://github.com/webpack-contrib/webpack-bundle-analyzer">web pack-bundle-analyzer</a>插件来了解你的包由什么组成。在这样做的过程中，您会意识到哪些组件真正驻留在您的包中，并找出哪些组件和依赖项构成了它们的大部分——并且您可能会发现错误到达那里的模块。</p>
<p>以下两个npm脚本运行webpack构建(开发或生产)并打开bundle analyzer:</p>
<pre>// package.json
"scripts": {
  "dev:analyze": "npm run dev -- --env.addons=bundleanalyzer",
  "build:analyze": "npm run build -- --env.addons=bundleanalyzer"
}</pre>
<p>当您调用<code>npm run build:analyze</code>时，会在<code><a href="http://localhost:8888" rel="nofollow">http://localhost:8888</a></code>上打开一个交互式视图。</p>
<p><img data-attachment-id="18062" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/bundle-analyzer-interactive-view/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-interactive-view.png" data-orig-size="730,342" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="webpack-bundle-analyzer interactive view" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-interactive-view-300x141.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-interactive-view.png" decoding="async" class="aligncenter size-full wp-image-18062 jetpack-lazy-image" src="../Images/e1b0bce77574523b38d1ad12c7d4824f.png" alt="Bundle Analyzer Interactive View In The Browser" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-interactive-view.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-interactive-view-300x141.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-interactive-view.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-interactive-view.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18062" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/bundle-analyzer-interactive-view/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-interactive-view.png" data-orig-size="730,342" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="webpack-bundle-analyzer interactive view" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-interactive-view-300x141.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-interactive-view.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18062" src="../Images/e1b0bce77574523b38d1ad12c7d4824f.png" alt="Bundle Analyzer Interactive View In The Browser" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-interactive-view.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-interactive-view-300x141.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-interactive-view.png"/></noscript>
<p>我们演示项目的初始版本只包含一个名为<code>app.js</code>的包，因为我们只定义了一个<a href="https://webpack.js.org/concepts/entry-points/">入口点</a>。</p>
<pre>// webpack.prod.js
const config = {
  mode: "production",
  entry: {
    app: [`${commonPaths.appEntry}/index.js`]
  },
  output: {
    filename: "static/[name].js",
  },
  // ...
}</pre>
<h2 id="reactproductionbuild">反应生产构建</h2>
<p>你应该把<a href="https://reactjs.org/docs/optimizing-performance.html#use-the-production-build">缩小的React生产版本</a>发给你的用户。捆绑的React代码要小得多，因为它不包括真正只在开发期间有用的东西，比如警告。</p>
<p>如果您在生产模式下使用webpack，您会得到一个React生产构建，正如您在最后一个截图(<code>react-dom.production.min.js</code>)中看到的。</p>
<p>下面的截图显示了更多关于捆绑React代码的信息。</p>
<p><img data-attachment-id="18063" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/bundled-react-code-interactive-view/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view.png" data-orig-size="730,777" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Interactive view of our bundled React code" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view-282x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view.png" decoding="async" class="aligncenter wp-image-18063 size-full jetpack-lazy-image" src="../Images/73776d096648af590680f2dd6bb4255a.png" alt="Interactive View Of The Bundled React Code In Production Mode" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view-282x300.png 282w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18063" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/bundled-react-code-interactive-view/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view.png" data-orig-size="730,777" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Interactive view of our bundled React code" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view-282x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view.png" decoding="async" loading="lazy" class="aligncenter wp-image-18063 size-full" src="../Images/73776d096648af590680f2dd6bb4255a.png" alt="Interactive View Of The Bundled React Code In Production Mode" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view-282x300.png 282w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view.png"/></noscript>
<p>如果您仔细观察，您会发现仍然有一些代码不属于生产版本(例如，react-hot-loader)。这是一个很好的例子，说明为什么频繁分析我们生成的包是寻找进一步优化机会的重要部分。在这种情况下，webpack/React设置<a href="https://github.com/gaearon/react-hot-loader/issues/602#issuecomment-575741927">需要改进以排除react-hot-loader </a>。</p>
<p>如果您有一个“不足的生产配置”并设置了<code>mode: "development"</code>，那么您会得到一个更大的React块(切换到分支<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/use-production-mode">use-production-mode</a></code>并执行<code>npm run build:analyze</code>)。</p>
<p><img data-attachment-id="18064" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/bundled-react-code-interactive-view-development-mode/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view-development-mode.png" data-orig-size="730,775" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Interactive view of the bundled React code in development mode" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view-development-mode-283x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view-development-mode.png" decoding="async" class="aligncenter size-full wp-image-18064 jetpack-lazy-image" src="../Images/23790bfea37d190c9cc8402d15191227.png" alt="Interactive View Of The Bundled React Code In Development Mode" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view-development-mode.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view-development-mode-283x300.png 283w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view-development-mode.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view-development-mode.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18064" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/bundled-react-code-interactive-view-development-mode/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view-development-mode.png" data-orig-size="730,775" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Interactive view of the bundled React code in development mode" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view-development-mode-283x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view-development-mode.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18064" src="../Images/23790bfea37d190c9cc8402d15191227.png" alt="Interactive View Of The Bundled React Code In Development Mode" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view-development-mode.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view-development-mode-283x300.png 283w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundled-react-code-interactive-view-development-mode.png"/></noscript>
<h2>为束分裂添加多个入口点</h2>
<p>作为前端开发人员，我们的目标应该是提供尽可能少的代码，而不是将我们所有的代码打包发送给我们的用户。这就是代码分割发挥作用的地方。</p>
<p>假设我们的用户通过路线<code>/profile</code>直接导航到个人资料页面。我们应该只提供这个概要文件组件的代码。这里，我们将添加另一个入口点，该入口点通向一个新的包(查看<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/entry-point-splitting">entry-point-splitting</a></code>分支)。</p>
<pre>// webpack.prod.js
const config = {
  mode: "production",
  entry: {
    app: [`${commonPaths.appEntry}/index.js`],
+   profile: [`${commonPaths.appEntry}/profile/Profile.js`],
  },
  // ...
}</pre>
<p>当然，其结果是，根据项目的不同，无论是单页应用程序(SPA)还是多页应用程序(MPA)，您都必须确保这些包包含在一个或多个HTML页面中。这个演示项目构成了一个SPA。</p>
<p>好的一面是，您可以在<code><a href="https://github.com/jantimon/html-webpack-plugin">HtmlWebpackPlugin</a></code>的帮助下自动完成这一合成步骤。</p>
<pre>// webpack.prod.js
plugins: [
  // ...
  new HtmlWebpackPlugin({
    template: `public/index.html`,
    favicon: `public/favicon.ico`,
  }),
],</pre>
<p>运行构建，生成的<code>index.html</code>由正确顺序的正确链接和脚本标签组成。</p>
<pre>&lt;!-- dist/index.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;meta name="viewport" content="width=device-width,initial-scale=1" /&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="ie=edge" /&gt;
    &lt;title&gt;react performance demo&lt;/title&gt;
    &lt;link rel="shortcut icon" href="favicon.ico" /&gt;
    &lt;link href="styles/app.css" rel="stylesheet" /&gt;
    &lt;link href="styles/profile.css" rel="stylesheet" /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id="root"&gt;&lt;/div&gt;
    &lt;script src="static/app.js"&gt;&lt;/script&gt;
    &lt;script src="static/profile.js"&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
<p>为了演示如何生成多个HTML文件(对于MPA用例)，请查看分支<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/entry-point-splitting-multiple-html">entry-point-splitting-multiple-html</a></code>。以下设置生成一个<code>index.html</code>和一个<code>profile.html</code>。</p>
<pre>// webpack.prod.js
plugins: [
-  new HtmlWebpackPlugin({
-    template: `public/index.html`,
-    favicon: `public/favicon.ico`,
-  }),
+  new HtmlWebpackPlugin({
+    template: `public/index.html`,
+    favicon: `public/favicon.ico`,
+    chunks: ["profile"],
+    filename: `${commonPaths.outputPath}/profile.html`,
+  }),
+  new HtmlWebpackPlugin({
+    template: `public/index.html`,
+    favicon: `public/favicon.ico`,
+    chunks: ["app"],
+  }),
],</pre>
<p>还有更多<a href="https://github.com/jantimon/html-webpack-plugin#options">配置选项</a>。例如，您可以用<code>chunksSortMode</code>提供一个定制的块排序函数，如这里的中的<a href="https://medium.com/@jaketripp/cool-things-with-webpack-9a8019bdbd4a">所示。</a></p>
<p>webpack只在生成的<code>dist/profile.html</code>文件中包含概要包的脚本，以及到相应<code>profile.css</code>的链接。<code>index.html</code>看起来差不多，只包括app捆绑包和<code>app.css</code>。</p>
<pre>&lt;!-- dist/profile.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;meta name="viewport" content="width=device-width,initial-scale=1" /&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="ie=edge" /&gt;
    &lt;title&gt;react performance demo&lt;/title&gt;
    &lt;link rel="shortcut icon" href="favicon.ico" /&gt;
    &lt;link href="styles/profile.css" rel="stylesheet" /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id="root"&gt;&lt;/div&gt;
    &lt;script src="static/profile.js"&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
<h2>独立的应用程序代码和第三方库</h2>
<p>查看<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/vendor-splitting">vendor-splitting</a></code>分支。让我们分析一下我们产品构建的当前状态。</p>
<p><img data-attachment-id="18065" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/vendor-splitting-interactive-view/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/vendor-splitting-interactive-view.png" data-orig-size="730,370" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Analyzing third-party libs in the production build of the vendor-splitting branch" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/vendor-splitting-interactive-view-300x152.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/vendor-splitting-interactive-view.png" decoding="async" class="aligncenter size-full wp-image-18065 jetpack-lazy-image" src="../Images/fa44033ae54c73121037f0ed68b2997f.png" alt="Analyzing Third-party Libraries In The Production Build Of The vendor-splitting Branch" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/vendor-splitting-interactive-view.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/vendor-splitting-interactive-view-300x152.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/vendor-splitting-interactive-view.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/vendor-splitting-interactive-view.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18065" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/vendor-splitting-interactive-view/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/vendor-splitting-interactive-view.png" data-orig-size="730,370" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Analyzing third-party libs in the production build of the vendor-splitting branch" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/vendor-splitting-interactive-view-300x152.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/vendor-splitting-interactive-view.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18065" src="../Images/fa44033ae54c73121037f0ed68b2997f.png" alt="Analyzing Third-party Libraries In The Production Build Of The vendor-splitting Branch" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/vendor-splitting-interactive-view.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/vendor-splitting-interactive-view-300x152.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/vendor-splitting-interactive-view.png"/></noscript>
<p><code>react.production.min.js</code>和<code>lodash.js</code>在两个束中都是冗余的。</p>
<p>这是个问题吗？是的，因为对于任何类型的应用程序，出于缓存的目的，你都应该将供应商块与你的应用程序块分开。您的应用程序代码只是比供应商代码更改得更频繁，因为您调整依赖项版本的频率更低。</p>
<p>因此，供应商捆绑包可以缓存更长时间，这有利于回访用户。供应商拆分意味着为您的应用程序代码和第三方库创建单独的包。</p>
<p>您可以使用<code><a href="https://webpack.js.org/plugins/split-chunks-plugin/">SplitChunksPlugin</a></code>来实现这一点——以及其他代码拆分技术，我们马上就会看到。在我们添加供应商分割之前，让我们先看看当前的生产构建输出。</p>
<p><img data-attachment-id="18067" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/production-build-output-vendor-splitting/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-vendor-splitting-e1588690991281.png" data-orig-size="730,173" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Production build output of the vendor-splitting branch" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-vendor-splitting-300x71.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-vendor-splitting-e1588690991281.png" decoding="async" class="aligncenter size-full wp-image-18067 jetpack-lazy-image" src="../Images/907c6ae0acb642fc980bc856f911c50d.png" alt="Production Build Output Of The vendor-splitting Branch" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-vendor-splitting-e1588690991281.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-vendor-splitting-e1588690991281.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18067" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/production-build-output-vendor-splitting/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-vendor-splitting-e1588690991281.png" data-orig-size="730,173" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Production build output of the vendor-splitting branch" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-vendor-splitting-300x71.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-vendor-splitting-e1588690991281.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18067" src="../Images/907c6ae0acb642fc980bc856f911c50d.png" alt="Production Build Output Of The vendor-splitting Branch" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-vendor-splitting-e1588690991281.png"/></noscript>
<p>为了使用前述的<code>SplitChunksPlugin</code>，我们将<code><a href="https://webpack.js.org/plugins/split-chunks-plugin/#optimizationsplitchunks">optimization.splitChunks</a></code>添加到我们的配置中。</p>
<pre>// webpack.prod.js
const config = {
  // ...
+ optimization: {
+   splitChunks: {
+     chunks: "all",
+   },
+ },
}</pre>
<p>这一次，我们使用bundle analyzer选项(<code>npm run build:analyze</code>)运行构建。构建的结果如下所示:</p>
<p><img data-attachment-id="18069" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-splitchunksplugin/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-splitchunksplugin.png" data-orig-size="730,182" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Build output using the SplitChunksPlugin" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-splitchunksplugin-300x75.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-splitchunksplugin.png" decoding="async" class="aligncenter size-full wp-image-18069 jetpack-lazy-image" src="../Images/baa6c45c56326a373779139d1d5b2951.png" alt="Build Output Using The SplitChunksPlugin" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-splitchunksplugin.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-splitchunksplugin-300x75.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-splitchunksplugin.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-splitchunksplugin.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18069" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-splitchunksplugin/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-splitchunksplugin.png" data-orig-size="730,182" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Build output using the SplitChunksPlugin" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-splitchunksplugin-300x75.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-splitchunksplugin.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18069" src="../Images/baa6c45c56326a373779139d1d5b2951.png" alt="Build Output Using The SplitChunksPlugin" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-splitchunksplugin.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-splitchunksplugin-300x75.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-splitchunksplugin.png"/></noscript>
<p><code>app.js</code>和<code>profile.js</code>现在小多了。但是等等——两个新的捆绑包，<code>vendors~app.js</code>和<code>vendors~app~profile.js</code>，已经出现了。正如您所看到的，通过bundle analyzer，我们成功地将来自<code>node_modules</code>(即React、Lodash)的依赖项提取到单独的bundle中。右下角的绿色小盒子是我们的<code>app</code>和<code>profile</code>包。</p>
<p><img data-attachment-id="18070" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/bundle-analyzer-splitchunksplugin/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-splitchunksplugin.png" data-orig-size="730,389" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Bundle analyzer interactive view of the build output with SplitChunksPlugin" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-splitchunksplugin-300x160.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-splitchunksplugin.png" decoding="async" class="aligncenter size-full wp-image-18070 jetpack-lazy-image" src="../Images/bd708dc28ca96b77af316cefdb4bb6b1.png" alt="Bundle Analyzer Interactive View Of The Build Output With SplitChunksPlugin" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-splitchunksplugin.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-splitchunksplugin-300x160.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-splitchunksplugin.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-splitchunksplugin.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18070" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/bundle-analyzer-splitchunksplugin/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-splitchunksplugin.png" data-orig-size="730,389" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Bundle analyzer interactive view of the build output with SplitChunksPlugin" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-splitchunksplugin-300x160.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-splitchunksplugin.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18070" src="../Images/bd708dc28ca96b77af316cefdb4bb6b1.png" alt="Bundle Analyzer Interactive View Of The Build Output With SplitChunksPlugin" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-splitchunksplugin.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-splitchunksplugin-300x160.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-splitchunksplugin.png"/></noscript>
<p>供应商包的名称表明依赖项是从哪个应用程序块中提取的。因为React DOM只在<code>app.js</code>包的<code>index.js</code>文件中使用，所以依赖关系只在<code>vendors~app.js</code>内部是有意义的。但是如果Lodash只被<code>profile.js</code>包使用，为什么它会在<code>vendors~app~profile.js</code>包中？</p>
<p>再一次，这是webpack的魔法:<a href="https://webpack.js.org/plugins/split-chunks-plugin/#optimizationsplitchunks">约定/默认值</a>，加上一些巧妙的东西。我非常推荐阅读webpack核心成员Tobias Koppers关于这个话题的文章<a href="https://medium.com/webpack/webpack-4-code-splitting-chunk-graph-and-the-splitchunks-optimization-be739a861366">。重要的要点是:</a></p>
<ul>
<li>代码分割是基于试探法的，试探法根据模块重复计数和模块类别来寻找分割的候选对象</li>
<li>默认行为是只挑选≥30KB的依赖项作为供应商捆绑包的候选项</li>
<li>有时，webpack有意在包中复制代码，以尽量减少对附加包的请求</li>
</ul>
<p>但是默认行为可以通过<code><a href="https://webpack.js.org/plugins/split-chunks-plugin/#optimizationsplitchunks">splitChunks</a></code>选项来改变。我们可以将<a href="https://webpack.js.org/plugins/split-chunks-plugin/#splitchunksminsize"> <code>minSize</code>选项</a>设置为600KB的值，从而告诉webpack，如果它提取的依赖项超过这个值，就先创建一个新的供应商包(查看<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/vendor-splitting-tweaking">vendor-splitting-tweaking</a></code>分支)。</p>
<pre>// webpack.prod.js
const config = {
  // ...
  optimization: {
   splitChunks: {
     chunks: "all",
+    minSize: 1000 * 600
   },
 },
}</pre>
<p>现在，webpack只推出了一个名为<code>vendors~app.js</code>的供应商包。</p>
<p><img data-attachment-id="18072" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/bundle-analyzer-vendor-bundle/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle.png" data-orig-size="730,645" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Bundle analyzer interactive view of the vendor bundle" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle-300x265.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle.png" decoding="async" class="aligncenter size-full wp-image-18072 jetpack-lazy-image" src="../Images/2b4b84ec363f2b56f2dc2e9c41682393.png" alt="Bundle Analyzer Interactive View Of The Vendor Bundle" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle-300x265.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18072" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/bundle-analyzer-vendor-bundle/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle.png" data-orig-size="730,645" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Bundle analyzer interactive view of the vendor bundle" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle-300x265.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18072" src="../Images/2b4b84ec363f2b56f2dc2e9c41682393.png" alt="Bundle Analyzer Interactive View Of The Vendor Bundle" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle-300x265.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle.png"/></noscript>
<p>为什么？如果您检查<code>Stat</code>的大小，750KB，新的供应商捆绑包大于600KB的最小大小。由于我们的新配置，webpack无法为另一个供应商捆绑包创建另一个候选块。</p>
<p>如您所见，Lodash在<code>profile.js</code>包中也被复制了(记住，webpack故意复制代码)。如果您将<code>minSize</code>的值调整为800KB，那么webpack无法为我们的演示项目提供一个单一的供应商包。我让你来试试这个。</p>
<p>当然，如果你愿意，你可以有更多的控制权。让我们指定一个自定义名称:<code>node_vendors</code>。我们为我们的供应商定义了一个<code><a href="https://webpack.js.org/plugins/split-chunks-plugin/#splitchunkscachegroups">cacheGroups</a></code>属性，我们从带有<code>test</code>属性的<code>node_modules</code>文件夹中取出这个属性(查看<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/vendor-splitting-cache-groups">vendor-splitting-cache-groups</a></code>分支)。在前面的例子中，<code>splitChunks</code>的默认值包含开箱即用的<code>cacheGroups</code>。</p>
<pre>// webpack.prod.js
const config = {
  // ...
- optimization: {
-   splitChunks: {
-     chunks: "all",
-    minSize: 1000 * 600
-   },
- },
+ optimization: {
+   splitChunks: {
+     cacheGroups: {
+      vendor: {
+       name: "node_vendors", // part of the bundle name and
+         // can be used in chunks array of HtmlWebpackPlugin
+         test: /[\\/]node_modules[\\/]/,
+         chunks: "all",
+       },
+     },
+   },
+ },
  // ...
}</pre>
<p>这一次，webpack向我们展示了一个供应商捆绑包，其中组合了我们的自定义名称和来自<code>node_modules</code>的所有依赖项。</p>
<p><img data-attachment-id="18074" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/bundle-analyzer-vendor-bundle-node-modules/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle-node-modules.png" data-orig-size="730,816" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Bundle analyzer view of the vendor bundle with node_modules" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle-node-modules-268x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle-node-modules.png" decoding="async" class="aligncenter size-full wp-image-18074 jetpack-lazy-image" src="../Images/0ff3552e4b6ea0f1ca7a151a39170367.png" alt="Bundle Analyzer View Of The Vendor Bundle With node_modules" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle-node-modules.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle-node-modules-268x300.png 268w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle-node-modules.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle-node-modules.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18074" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/bundle-analyzer-vendor-bundle-node-modules/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle-node-modules.png" data-orig-size="730,816" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Bundle analyzer view of the vendor bundle with node_modules" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle-node-modules-268x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle-node-modules.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18074" src="../Images/0ff3552e4b6ea0f1ca7a151a39170367.png" alt="Bundle Analyzer View Of The Vendor Bundle With node_modules" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle-node-modules.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle-node-modules-268x300.png 268w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-vendor-bundle-node-modules.png"/></noscript>
<p>在上面的<code>splitChunks</code>属性中，我们添加了一个值为<code>all</code>的<code><a href="https://webpack.js.org/plugins/split-chunks-plugin/#splitchunkschunks">chunks</a></code>属性。大多数情况下，这个值对于您的项目来说应该是合适的。但是，如果您只想提取惰性或者异步加载的包，那么您可以使用值<code>async</code>。当我们在下一节中查看常见的代码分割时，我们将再次讨论这个方面。</p>
<h2>将共享代码整合到公共包中</h2>
<p>通用代码分割旨在将共享代码组合成单独的包，以实现更小的包大小和更高效的缓存。这类似于供应商代码分割，但不同之处在于，您将共享组件和库作为自己代码库中的目标。</p>
<p>在我们的例子中，我们将供应商代码分割与公共代码分割结合起来(查看分支<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/common-splitting">common-splitting</a></code>)。我们在<code>Blog</code>和<code>Profile</code>组件中导入并使用<code>util.js</code>的<code>add</code>函数，它们是两个不同入口点的一部分。</p>
<p>我们用关键字<code>common</code>向<code>cacheGroups</code>对象添加了一个新对象，用正则表达式仅指向我们的<code>components</code>文件夹中的模块。由于这个演示项目的组件非常小，我们需要覆盖webpack的默认值<code>minSize</code>。以防万一，我们将它设置为0KB。</p>
<pre>// webpack.prod.js
const config = {
  // ...
  optimization: {
    splitChunks: {
      cacheGroups: {
        vendor: {
          name: "node_vendors", // part of the bundle name and
          // can be used in chunks array of HtmlWebpackPlugin
          test: /[\\/]node_modules[\\/]/,
          chunks: "all",
        },
+       common: {
+         test: /[\\/]src[\\/]components[\\/]/,
+         chunks: "all",
+         minSize: 0,
+       },
      },
    },
  },</pre>
<p>运行webpack会生成一个新的包<code>common~app~profile.js</code>，除了两个入口点包和我们的供应商包。</p>
<p><img data-attachment-id="18078" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-common-splitting/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-common-splitting.png" data-orig-size="730,257" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Build output of the common-splitting branch" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-common-splitting-300x106.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-common-splitting.png" decoding="async" class="aligncenter size-full wp-image-18078 jetpack-lazy-image" src="../Images/3b40395bbf6e400e84e77c97536f29d7.png" alt="Build Output Of The common-splitting Branch" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-common-splitting.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-common-splitting-300x106.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-common-splitting.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-common-splitting.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18078" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-common-splitting/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-common-splitting.png" data-orig-size="730,257" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Build output of the common-splitting branch" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-common-splitting-300x106.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-common-splitting.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18078" src="../Images/3b40395bbf6e400e84e77c97536f29d7.png" alt="Build Output Of The common-splitting Branch" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-common-splitting.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-common-splitting-300x106.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-common-splitting.png"/></noscript>
<p>在<code>dist/static/common~app~profile.js</code>中搜索<code>console.log("add")</code>，你会找到你要找的东西。</p>
<h2>路由级的延迟加载</h2>
<p>我们已经看到了如何在<code>entry-point-splitting</code>分支中将<a href="https://reacttraining.com/react-router/web"> react-router </a>与入口代码分割结合使用。我们可以通过让用户在浏览我们的应用程序时按需加载不同的组件来进一步推动代码拆分。这个用例可以通过<a href="https://webpack.js.org/guides/code-splitting/#dynamic-imports">动态导入</a>和路由代码分割来实现。</p>
<p>在我们的演示项目的上下文中，这一点可以从以下事实中得到证明:只有当用户导航到相应的路径(切换到分支<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/code-splitting-routes">code-splitting-routes</a></code>)时，才会加载<code>profile.js</code>包。我们利用了<a href="https://github.com/gregberge/loadable-components"> @loadable/components </a>库，它在幕后完成代码拆分和动态加载的艰苦工作。</p>
<pre>// package.json
{
  // ...
  "dependencies": {
    "@loadable/component": "^5.12.0",
    // ...
  }
  // ...
}</pre>
<p>为了使用<a href="https://github.com/tc39/proposal-dynamic-import"> ES6动态导入语法</a>，我们必须使用一个<a href="https://babeljs.io/docs/en/babel-plugin-syntax-dynamic-import">巴别塔插件</a>。</p>
<pre>// .babelrc
{
  // ...
  "plugins": [
    "@babel/plugin-syntax-dynamic-import",
    // ...
  ]
}</pre>
<p>实现非常简单。首先，我们需要一个微小的包装器来包装我们想要延迟加载的组件。</p>
<pre>// ProfileLazy.js
import loadable from "@loadable/component";
export default loadable(() =&gt;
  import(/* webpackChunkName: "profile" */ "./Profile")
);</pre>
<p>我们在<code>loadable</code>回调中使用动态导入，并添加一个webpack理解的注释(给代码分割块一个自定义名称)。</p>
<p>在我们的<code>Blog</code>组件中，我们只需要调整<code>Router</code>组件的导入。</p>
<pre>// Blog.js
import React from "react";
import { BrowserRouter as Router, Switch, Route, Link } from "react-router-dom";
- import Profile from "../profile/Profile";
+ import Profile from "../profile/ProfileLazy";
import "./Blog.css";
import Headline from "../components/Headline";

export default function Blog() {
  return (
    &lt;Router&gt;
      &lt;div&gt;
        &lt;ul&gt;
          &lt;li&gt;
            &lt;Link to="/"&gt;Blog&lt;/Link&gt;
          &lt;/li&gt;
          &lt;li&gt;
            &lt;Link to="/profile"&gt;Profile&lt;/Link&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
        &lt;hr /&gt;
        &lt;Switch&gt;
          &lt;Route exact path="/"&gt;
            &lt;Articles /&gt;
          &lt;/Route&gt;
          &lt;Route path="/profile"&gt;
            &lt;Profile /&gt;
          &lt;/Route&gt;
        &lt;/Switch&gt;
      &lt;/div&gt;
    &lt;/Router&gt;
  );
}

// ...</pre>
<p>最后一步是从生产和开发webpack配置中删除用于入口点代码分割的<code>profile</code>入口点。</p>
<pre>// webpack.prod.js and webpack.dev.js
const config = {
  // ...
  entry: {
    app: [`${commonPaths.appEntry}/index.js`],
-  profile: [`${commonPaths.appEntry}/profile/Profile.js`],
  },
  // ...
}</pre>
<p>运行生产构建，您将在输出中看到webpack由于动态导入而创建了一个<code>profile.js</code>包。</p>
<p><img data-attachment-id="18082" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/production-build-output-code-splitting-routes/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-code-splitting-routes.png" data-orig-size="730,185" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Production build output for the code-splitting-routes branch" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-code-splitting-routes-300x76.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-code-splitting-routes.png" decoding="async" class="aligncenter size-full wp-image-18082 jetpack-lazy-image" src="../Images/a01292cb91eeb570d1ce489ec171483a.png" alt="Production Build Output For The code-splitting-routes Branch" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-code-splitting-routes.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-code-splitting-routes-300x76.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-code-splitting-routes.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-code-splitting-routes.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18082" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/production-build-output-code-splitting-routes/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-code-splitting-routes.png" data-orig-size="730,185" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Production build output for the code-splitting-routes branch" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-code-splitting-routes-300x76.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-code-splitting-routes.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18082" src="../Images/a01292cb91eeb570d1ce489ec171483a.png" alt="Production Build Output For The code-splitting-routes Branch" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-code-splitting-routes.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-code-splitting-routes-300x76.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-code-splitting-routes.png"/></noscript>
<p>生成的HTML文档不包含指向<code>profile.js</code>包的脚本。</p>
<pre>// diest/index.html
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;meta name="viewport" content="width=device-width,initial-scale=1" /&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="ie=edge" /&gt;
    &lt;title&gt;react performance demo&lt;/title&gt;
    &lt;link rel="shortcut icon" href="favicon.ico" /&gt;
    &lt;link href="styles/app.css" rel="stylesheet" /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id="root"&gt;&lt;/div&gt;
    &lt;script src="static/node_vendors.js"&gt;&lt;/script&gt;
    &lt;script src="static/app.js"&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
<p>太棒了——做了正确的工作。</p>
<p>用<code>development</code>构建(<code>npm run dev</code>)来测试更容易。</p>
<p><img data-attachment-id="18083" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/devtools-development-build-homepage/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-homepage.png" data-orig-size="730,797" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Examining the development build homepage in DevTools" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-homepage-275x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-homepage.png" decoding="async" class="aligncenter wp-image-18083 size-full jetpack-lazy-image" src="../Images/7465f14fd440a40a5e25fe2c714c54f6.png" alt="Examining The Development Build For The Homepage In DevTools" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-homepage.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-homepage-275x300.png 275w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-homepage.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-homepage.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18083" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/devtools-development-build-homepage/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-homepage.png" data-orig-size="730,797" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Examining the development build homepage in DevTools" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-homepage-275x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-homepage.png" decoding="async" loading="lazy" class="aligncenter wp-image-18083 size-full" src="../Images/7465f14fd440a40a5e25fe2c714c54f6.png" alt="Examining The Development Build For The Homepage In DevTools" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-homepage.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-homepage-275x300.png 275w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-homepage.png"/></noscript>
<p>DevTools显示最初没有加载<code>profile.js</code>包。但是，当您导航到<code>/profile</code>路径时，这个包会被延迟加载。</p>
<p><img data-attachment-id="18084" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/devtools-development-build-profile-route/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-profile-route.png" data-orig-size="730,725" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Examining the development build profile route in DevTools" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-profile-route-300x298.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-profile-route.png" decoding="async" class="aligncenter wp-image-18084 size-full jetpack-lazy-image" src="../Images/8d557fc23e40af32bf54931ce7137ba9.png" alt="Examining The Development Build For The Profile Route In DevTools" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-profile-route.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-profile-route-300x298.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-profile-route-150x150.png 150w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-profile-route.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-profile-route.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18084" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/devtools-development-build-profile-route/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-profile-route.png" data-orig-size="730,725" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Examining the development build profile route in DevTools" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-profile-route-300x298.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-profile-route.png" decoding="async" loading="lazy" class="aligncenter wp-image-18084 size-full" src="../Images/8d557fc23e40af32bf54931ce7137ba9.png" alt="Examining The Development Build For The Profile Route In DevTools" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-profile-route.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-profile-route-300x298.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-profile-route-150x150.png 150w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/devtools-development-build-profile-route.png"/></noscript>
<h2>组件级的延迟加载</h2>
<p>代码拆分也可以在细粒度级别上进行。看看branch <code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/code-splitting-component-level">code-splitting-component-level</a></code>，你会发现基于路由的延迟加载技术可以用来加载基于事件的更小的组件。</p>
<p>在演示项目中，我们只需在profile页面上添加一个按钮，通过单击来加载和呈现一个简单的React组件<code>Paragraph</code>。</p>
<pre>// Profile.js
- import React from "react";
+ import React, { useState } from "react";
// some more boring imports
+ import LazyParagraph from "./LazyParagraph";
const Profile = () =&gt; {
+ const [showOnDemand, setShowOnDemand] = useState(false);
  const array = [1, 2, 3];
  _.fill(array, "a");
  console.log(array);
  console.log("add", add(2, 2));
  return (
    &lt;div className="profile"&gt;
      &lt;Headline&gt;Profile&lt;/Headline&gt;
      &lt;p&gt;Lorem Ipsum&lt;/p&gt;
+      {showOnDemand &amp;&amp; &lt;LazyParagraph /&gt;}
+      &lt;button onClick={() =&gt; setShowOnDemand(true)}&gt;click me&lt;/button&gt;
    &lt;/div&gt;
  );
};
export default Profile;</pre>
<p><code>ProfileLazy.js</code>看着眼熟。我们想将新的包称为<code>paragraph.js</code>。</p>
<pre>// LazyParagraph.js
import loadable from "@loadable/component";
export default loadable(() =&gt;
  import(/* webpackChunkName: "paragraph" */ "./Paragraph")
);</pre>
<p>我跳过了<code>Paragraph</code>,因为它只是一个简单的React组件，用于在屏幕上呈现一些东西。</p>
<p>生产构建的输出如下所示。</p>
<p><img data-attachment-id="18086" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/production-build-output-component-level-splitting/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-component-level-splitting.png" data-orig-size="730,207" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Production build output of component level splitting" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-component-level-splitting-300x85.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-component-level-splitting.png" decoding="async" class="aligncenter size-full wp-image-18086 jetpack-lazy-image" src="../Images/1a84e7feb8789bba56a6141f9c29e326.png" alt="Production Build Output Of Component Level Splitting" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-component-level-splitting.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-component-level-splitting-300x85.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-component-level-splitting.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-component-level-splitting.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18086" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/production-build-output-component-level-splitting/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-component-level-splitting.png" data-orig-size="730,207" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Production build output of component level splitting" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-component-level-splitting-300x85.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-component-level-splitting.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18086" src="../Images/1a84e7feb8789bba56a6141f9c29e326.png" alt="Production Build Output Of Component Level Splitting" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-component-level-splitting.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-component-level-splitting-300x85.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-component-level-splitting.png"/></noscript>
<p>开发构建表明，加载和呈现捆绑到<code>paragraph.js</code>中的虚拟组件只发生在单击按钮时。</p>
<p><img data-attachment-id="18115" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/paragraph-component-development-build-devtools/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/paragraph-component-development-build-devtools.png" data-orig-size="706,868" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Examining the component level development build in DevTools" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/paragraph-component-development-build-devtools-244x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/paragraph-component-development-build-devtools.png" decoding="async" class="aligncenter size-full wp-image-18115 jetpack-lazy-image" src="../Images/e549ba9cda81b7e971ffd0d425be44e9.png" alt="Examining The Component Level Development Build In DevTools" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/paragraph-component-development-build-devtools.png 706w, https://blog.logrocket.com/wp-content/uploads/2020/05/paragraph-component-development-build-devtools-244x300.png 244w" data-lazy-sizes="(max-width: 706px) 100vw, 706px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/paragraph-component-development-build-devtools.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/paragraph-component-development-build-devtools.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18115" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/paragraph-component-development-build-devtools/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/paragraph-component-development-build-devtools.png" data-orig-size="706,868" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Examining the component level development build in DevTools" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/paragraph-component-development-build-devtools-244x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/paragraph-component-development-build-devtools.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18115" src="../Images/e549ba9cda81b7e971ffd0d425be44e9.png" alt="Examining The Component Level Development Build In DevTools" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/paragraph-component-development-build-devtools.png 706w, https://blog.logrocket.com/wp-content/uploads/2020/05/paragraph-component-development-build-devtools-244x300.png 244w" sizes="(max-width: 706px) 100vw, 706px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/paragraph-component-development-build-devtools.png"/></noscript>
<h2>将webpack的清单提取到一个单独的包中</h2>
<p>这到底是什么意思？用webpack构建的每个应用程序或站点都包括一个<a href="https://webpack.js.org/concepts/manifest/">运行时和清单</a>。神奇的是样板代码。清单将我们的代码和供应商的代码连接在一起。它并不是特别大，但是它对于每个入口点都是重复的，除非你对它做些什么。</p>
<p>同样，如果您想要优化浏览器缓存，那么将清单提取到一个单独的包中可能会很有用。这可以让你的用户不必重新下载文件。但是，我不确定清单多久更改一次——在webpack版本更新之后？</p>
<p>无论如何，看看这个分支<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/manifest-splitting">manifest-splitting</a></code>。基础是我们的生产配置，它有两个入口点，现在，供应商/公共代码已经分离。为了提取清单，我们必须添加<code><a href="https://webpack.js.org/guides/caching/#extracting-boilerplate">runtimeChunk</a></code>属性。</p>
<pre>// webpack.prod.js
const config = {
  mode: "production",
  entry: {
    app: [`${commonPaths.appEntry}/index.js`],
    profile: [`${commonPaths.appEntry}/profile/Profile.js`],
  },
  output: {
    filename: "static/[name].js",
  },
+  optimization: {
+    runtimeChunk: {
+      name: "manifest",
+    },    
+  },
  // ...
}</pre>
<p>一个生产构建展示了一个新的<code>manifest.js</code>包。两个入口点包稍微小一点。</p>
<p><img data-attachment-id="18121" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/production-build-runtimechunk/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-runtimechunk.png" data-orig-size="730,215" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Production build with the runtimeChunk optimization" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-runtimechunk-300x88.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-runtimechunk.png" decoding="async" class="aligncenter size-full wp-image-18121 jetpack-lazy-image" src="../Images/17e5acb0760252b6fd7b07e259e73477.png" alt="Production Build With The RuntimeChunk Optimization" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-runtimechunk.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-runtimechunk-300x88.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-runtimechunk.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-runtimechunk.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18121" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/production-build-runtimechunk/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-runtimechunk.png" data-orig-size="730,215" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Production build with the runtimeChunk optimization" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-runtimechunk-300x88.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-runtimechunk.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18121" src="../Images/17e5acb0760252b6fd7b07e259e73477.png" alt="Production Build With The RuntimeChunk Optimization" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-runtimechunk.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-runtimechunk-300x88.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-runtimechunk.png"/></noscript>
<p>相比之下，这里您可以看到没有经过<code>runtimeChunk</code>优化的包的大小。</p>
<p><img data-attachment-id="18122" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/production-build-without-runtimechunk/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-without-runtimechunk.png" data-orig-size="730,236" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Production build without the runtimeChunk optimization" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-without-runtimechunk-300x97.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-without-runtimechunk.png" decoding="async" class="aligncenter size-full wp-image-18122 jetpack-lazy-image" src="../Images/fb9b68532c8e668fe62a8b6a3a6430a8.png" alt="Production Build Without The RuntimeChunk Optimization" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-without-runtimechunk.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-without-runtimechunk-300x97.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-without-runtimechunk.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-without-runtimechunk.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18122" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/production-build-without-runtimechunk/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-without-runtimechunk.png" data-orig-size="730,236" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Production build without the runtimeChunk optimization" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-without-runtimechunk-300x97.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-without-runtimechunk.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18122" src="../Images/fb9b68532c8e668fe62a8b6a3a6430a8.png" alt="Production Build Without The RuntimeChunk Optimization" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-without-runtimechunk.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-without-runtimechunk-300x97.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-without-runtimechunk.png"/></noscript>
<p>这两个HTML文档是用清单的额外脚本标记生成的。作为一个例子，这里你可以看到<code>profile.html</code>文件(我跳过了<code>index.html</code>)。</p>
<pre>&lt;!-- dist/profile.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;meta name="viewport" content="width=device-width,initial-scale=1" /&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="ie=edge" /&gt;
    &lt;title&gt;react performance demo&lt;/title&gt;
    &lt;link rel="shortcut icon" href="favicon.ico" /&gt;
    &lt;link href="styles/profile.css" rel="stylesheet" /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id="root"&gt;&lt;/div&gt;
    &lt;script src="static/manifest.js"&gt;&lt;/script&gt;
    &lt;script src="static/profile.js"&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
<h2>从捆绑包中排除依赖关系</h2>
<p>使用webpack的<code><a href="https://webpack.js.org/configuration/externals/">externals</a></code>配置选项，可以从捆绑中排除依赖关系。如果环境在其他地方提供了依赖关系，这是很有用的。</p>
<p>例如，如果您在基于React的MPA上与不同的团队合作，您可以在一个专用的包中提供React，这个包包含在每个团队包前面的标记中。这允许每个团队将这种依赖性保留在它的包之外。</p>
<p>这是起点(再次在分支<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/manifest-splitting">manifest-splitting</a></code>)。我们有两个入口点包，一个依赖React，另一个依赖更大的react-dom。</p>
<p><img data-attachment-id="18156" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/bundle-analyzer-entry-point-bundle/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-entry-point-bundle.png" data-orig-size="730,783" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Bundle analyzer view of our entry point" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-entry-point-bundle-280x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-entry-point-bundle.png" decoding="async" class="aligncenter size-full wp-image-18156 jetpack-lazy-image" src="../Images/cd340addcb6e9a3840ace261ca53f65f.png" alt="Bundle Analyzer View Of Our Entry Point With React And ReactDOM" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-entry-point-bundle.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-entry-point-bundle-280x300.png 280w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-entry-point-bundle.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-entry-point-bundle.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18156" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/bundle-analyzer-entry-point-bundle/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-entry-point-bundle.png" data-orig-size="730,783" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Bundle analyzer view of our entry point" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-entry-point-bundle-280x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-entry-point-bundle.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18156" src="../Images/cd340addcb6e9a3840ace261ca53f65f.png" alt="Bundle Analyzer View Of Our Entry Point With React And ReactDOM" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-entry-point-bundle.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-entry-point-bundle-280x300.png 280w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-entry-point-bundle.png"/></noscript>
<p><img data-attachment-id="18157" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/manifest-splitting-branch-bundle/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-bundle.png" data-orig-size="730,210" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="manifest-splitting branch build output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-bundle-300x86.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-bundle.png" decoding="async" class="aligncenter wp-image-18157 size-full jetpack-lazy-image" src="../Images/a74cc7577be6a684fc668ba7a8057bf4.png" alt="The manifest-splitting Branch Development Build Output" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-bundle.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-bundle-300x86.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-bundle.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-bundle.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18157" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/manifest-splitting-branch-bundle/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-bundle.png" data-orig-size="730,210" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="manifest-splitting branch build output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-bundle-300x86.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-bundle.png" decoding="async" loading="lazy" class="aligncenter wp-image-18157 size-full" src="../Images/a74cc7577be6a684fc668ba7a8057bf4.png" alt="The manifest-splitting Branch Development Build Output" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-bundle.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-bundle-300x86.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-bundle.png"/></noscript>
<p>如果我们想将它们从产品包中排除，我们必须将下面的<code>externals</code>对象添加到我们的产品配置中(检出分支<code>externals</code>)。</p>
<pre>// webpack.prod.js
const config = {
  // ...  
+  externals: {
+    react: "React",
+    "react-dom": "ReactDOM",
+  },
  // ...
}</pre>
<p>当您创建一个产品包时，文件大小要小得多。</p>
<p><img data-attachment-id="18158" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/manifest-splitting-branch-production-build-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-production-build-output.png" data-orig-size="730,365" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Production build output of the manifest-splitting branch" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-production-build-output-300x150.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-production-build-output.png" decoding="async" class="aligncenter size-full wp-image-18158 jetpack-lazy-image" src="../Images/8bba5a233a833e4000d528036d8ff8ba.png" alt="Production Build Output Of The manifest-splitting Branch" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-production-build-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-production-build-output-300x150.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-production-build-output.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-production-build-output.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18158" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/manifest-splitting-branch-production-build-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-production-build-output.png" data-orig-size="730,365" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Production build output of the manifest-splitting branch" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-production-build-output-300x150.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-production-build-output.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18158" src="../Images/8bba5a233a833e4000d528036d8ff8ba.png" alt="Production Build Output Of The manifest-splitting Branch" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-production-build-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-production-build-output-300x150.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/manifest-splitting-branch-production-build-output.png"/></noscript>
<p><code>app.js</code>的大小从223KB缩减到96.4KB，因为react-dom被忽略了。<code>profile.js</code>的文件大小从78.9KB减少到71.7KB。</p>
<p>现在我们必须在上下文中提供React和react-dom。在我们的示例中，<a href="https://reactjs.org/docs/cdn-links.html">我们通过向HTML模板文件添加脚本标签来提供React over CDN </a>。</p>
<pre>&lt;!-- public/index.html --&gt;
&lt;body&gt;
  &lt;div id="root"&gt;&lt;/div&gt;
  &lt;script crossorigin 
    src="https://unpkg.com/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="dba9bebab8af9beaed">[email protected]</a>/umd/react.production.min.js"&gt;&lt;/script&gt;
  &lt;script crossorigin 
    src="https://unpkg.com/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="cfbdaaaeacbbe2aba0a28ffef9">[email protected]</a>/umd/react-dom.production.min.js"&gt;&lt;/script&gt;
&lt;/body&gt;</pre>
<p>这就是生成的<code>index.html</code>的样子(我将跳过<code>profile.html</code>文件)。</p>
<pre>&lt;!-- dist/index.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;meta name="viewport" content="width=device-width,initial-scale=1" /&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="ie=edge" /&gt;
    &lt;title&gt;react performance demo&lt;/title&gt;
    &lt;link rel="shortcut icon" href="favicon.ico" /&gt;
    &lt;link href="styles/app.css" rel="stylesheet" /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id="root"&gt;&lt;/div&gt;
    &lt;script
      crossorigin
      src="https://unpkg.com/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a5d7c0c4c6d1e59493">[email protected]</a>/umd/react.production.min.js"
    &gt;&lt;/script&gt;
    &lt;script
      crossorigin
      src="https://unpkg.com/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ccbea9adafb8e1a8a3a18cfdfa">[email protected]</a>/umd/react-dom.production.min.js"
    &gt;&lt;/script&gt;
    &lt;script src="static/manifest.js"&gt;&lt;/script&gt;
    &lt;script src="static/app.js"&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
<h2>通过树抖动从包中移除死代码</h2>
<p>假设您的代码库中有一个组件，它具有默认和/或命名的导出，但在您的应用程序中任何地方都没有使用。将JavaScript包中的代码交付给用户完全是一种浪费。<a href="https://webpack.js.org/guides/tree-shaking/">树抖动</a>是一种死代码消除技术，它可以从您的包中找到并剥离未使用的代码。</p>
<p>webpack 4的好处是您很可能不需要做任何事情来执行树抖动。除非您正在使用CommonJS模块系统处理遗留项目，否则当您使用生产模式时，您会在webpack中自动获得它(尽管您必须使用ES6模块语法)。</p>
<p>由于不需要指定模式就可以使用webpack，或者将其设置为<code>"development"</code>，因此必须满足一组附加要求，这里<a href="https://webpack.js.org/guides/tree-shaking/#conclusion"/>对此进行了详细说明。此外，如webpack的树摇动文档中所述，您必须确保没有编译器将ES6模块语法转换为CommonJS版本。</p>
<p>由于我们在演示项目中使用了<a href="https://babeljs.io/docs/en/babel-preset-env#modules"> @babel/preset-env </a>，为了安全起见，我们最好将<code>modules: false</code>设置为禁止将ES6模块语法转换为另一种模块类型。</p>
<pre>// .babelrc
{
    "presets": [
      ["@babel/preset-env", { "modules": false }],
      "@babel/preset-react"
    ],
    "plugins": [
      // ...
    ]
  }</pre>
<p>这是因为ES6模块可以由webpack进行静态分析，而这在其他变体中是不可能的，比如CommonJS的<code>require</code>。可以动态改变出口，做各种<a href="https://stackoverflow.com/a/42883538">猴子打补丁</a>。您还可以在这个项目中看到一个例子，其中<code>require</code>语句是在一个循环中动态创建的:</p>
<pre>// webpack.config.js

// ...
const addons = (/* string | string[] */ addonsArg) =&gt; {
  // ...
  return addons.map((addonName) =&gt;
    require(`./build-utils/addons/webpack.${addonName}.js`)
  );
};
// ...</pre>
<p>如果你想看看没有树晃动时的样子，你可以禁用<code><a href="https://webpack.js.org/plugins/uglifyjs-webpack-plugin/">UglifyjsWebpackPlugin</a></code>，它在生产模式下默认使用。</p>
<p>在我们禁用树抖动之前，我首先想证明产品构建确实删除了未使用的代码。切换到<code>master</code>分支，看看下面的文件:</p>
<pre>// util.js
export function add(a, b) { // imported and used in Profile.js
  console.log("add");
  return a + b;
}
export function subtract(a, b) { // nowhere used
  console.log("subtract");
  return a - b;
}</pre>
<p>在<code>Profile.js</code>中只使用第一个函数。再次执行<code>npm run build</code>，打开<code>dist/static/app.js</code>。您可以搜索并找到两个出现的字符串<code>console.log("add")</code>，但没有出现<code>console.log("subtract")</code>。这就是它有效的证明。</p>
<p>现在切换到分支<code>disable-uglify</code>，这里<code>minimize: false</code>被添加到配置中。</p>
<pre>// webpack.prod.js
const config = {
  mode: "production",  
+ optimization: {
+   minimize: false, // disable uglify + tree shaking
+ },
  entry: {
    app: [`${commonPaths.appEntry}/index.js`],
  },
  // ...
}</pre>
<p>如果您执行另一个生产构建，您会得到一个警告，提示您的包大小超过了标准阈值。</p>
<p><img data-attachment-id="18159" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-warnings/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-warnings.png" data-orig-size="730,606" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Production build output with warnings" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-warnings-300x249.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-warnings.png" decoding="async" class="aligncenter size-full wp-image-18159 jetpack-lazy-image" src="../Images/9fff73dccd25be8930e7584fb36eb41a.png" alt="Production Build Output With Warnings" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-warnings.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-warnings-300x249.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-warnings.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-warnings.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18159" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-warnings/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-warnings.png" data-orig-size="730,606" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Production build output with warnings" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-warnings-300x249.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-warnings.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18159" src="../Images/9fff73dccd25be8930e7584fb36eb41a.png" alt="Production Build Output With Warnings" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-warnings.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-warnings-300x249.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-warnings.png"/></noscript>
<p>在未损坏的<code>dist/static/app.js</code>文件中，您还会发现两次出现<code>console.log("subtract")</code>。</p>
<p>但是为什么丑陋插件会被牵扯进来呢？嗯，术语树抖动有点<a href="https://medium.com/@Rich_Harris/tree-shaking-versus-dead-code-elimination-d3765df85c80">误导</a>:在这个步骤中，依赖图的枯叶(例如，未使用的函数)没有被移除。取而代之的是，丑陋插件在第二步中这样做。在第一步中，一个实时代码包含发生，以一种丑陋的插件能够“摇动语法树”的方式标记源代码</p>
<h2>定义绩效预算</h2>
<p>监控项目的包大小至关重要。随着应用程序的不断增长，了解捆绑包何时变得过大并开始影响UX非常重要。</p>
<p>正如您在最后一个截图中看到的，webpack内置了对资产的<a href="https://webpack.js.org/configuration/performance/">性能测量</a>的支持。在上面的例子中，我们用747KB极大地放大了244KB的最大阈值。在生产模式下，默认行为是警告您违反阈值。</p>
<p>我们可以为产出资产定义自己的<a href="https://addyosmani.com/blog/performance-budgets/">绩效预算</a>。我们不关心<code>development</code>，但我们希望关注它的生产(检查分支<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/performance-budget">performance-budget</a></code>)。</p>
<pre>// webpack.prod.js
const config = {
  mode: "production",
  entry: {
    app: [`${commonPaths.appEntry}/index.js`],
  },
  output: {
    filename: "static/[name].js",
  },
+ performance: {
+   hints: "error",
+   maxAssetSize: 100 * 1024, // 100 KiB 
+   maxEntrypointSize: 100 * 1024, // 100 KiB
+ },
  // ...
}</pre>
<p>我们将100KB定义为资产(例如，CSS文件)和入口点(例如，生成的JS包)的阈值。与前面的截图(<code>warning</code>)不同，这里我们将<code>hints</code>定义为类型<code>error</code>。</p>
<p>正如我们在输出中看到的，这意味着构建将会失败。然而，使用<code>warning</code>，构建仍然会成功。</p>
<p><img data-attachment-id="18160" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-errors/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-errors.png" data-orig-size="730,750" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Failed build output with errors" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-errors-292x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-errors.png" decoding="async" class="aligncenter size-full wp-image-18160 jetpack-lazy-image" src="../Images/30c80e0b5bed852cbf773d7b081082f0.png" alt="Failed Build Output With Errors" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-errors.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-errors-292x300.png 292w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-errors.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-errors.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18160" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-errors/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-errors.png" data-orig-size="730,750" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Failed build output with errors" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-errors-292x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-errors.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18160" src="../Images/30c80e0b5bed852cbf773d7b081082f0.png" alt="Failed Build Output With Errors" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-errors.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-errors-292x300.png 292w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-errors.png"/></noscript>
<p>webpack提供了如何处理这些问题的建议。</p>
<p>我喜欢为构建设置<code>hints: "error"</code>。这将导致您的CI渠道失败，如果您仍然将其推至VCS。在我看来，这促进了一种关注捆绑包/资产大小的文化，并最终在早期关注用户体验。</p>
<h2>使用可树摇动的第三方库</h2>
<p>让我们检查一下我们的包，看看与其他组件相比，我们流行的Lodash依赖项消耗了多少空间。检查出分支<code>master</code>并运行<code>npm run build:analyze</code>。</p>
<p><img data-attachment-id="18162" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/bundle-analyzer-lodash/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash.png" data-orig-size="730,733" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Examining the size of Lodash in the bundle analyzer" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-300x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash.png" decoding="async" class="aligncenter size-full wp-image-18162 jetpack-lazy-image" src="../Images/572207505a5ec7ce1b18e7fb33b5d5bd.png" alt="Examining The Size Of Lodash In The Bundle Analyer" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-300x300.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-150x150.png 150w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18162" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/bundle-analyzer-lodash/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash.png" data-orig-size="730,733" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Examining the size of Lodash in the bundle analyzer" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-300x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18162" src="../Images/572207505a5ec7ce1b18e7fb33b5d5bd.png" alt="Examining The Size Of Lodash In The Bundle Analyer" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-300x300.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-150x150.png 150w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash.png"/></noscript>
<p>这不仅在绝对意义上，而且相对于其他组成部分来说，都是相当大的一块。这是我们使用它的方式。</p>
<pre>// Profile.js
import _ from "lodash";
// ...
const Profile = () =&gt; {
  const array = [1, 2, 3];
  _.fill(array, "a");
  console.log(array);
  // ...
}</pre>
<p>问题是，即使我们只使用了<code>fill</code>函数，我们也要拉进整个库。幸运的是，Lodash有一个模块化的架构，也支持树摇动。</p>
<p>我们只需要改变导入，只引入数组函数(检查分支<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/lodash-modular">lodash-modular</a></code>)。</p>
<pre>// Profile.js
- import _ from "lodash";
+ import _ from "lodash/array";

// ...</pre>
<p>构建输出现在看起来好多了。</p>
<p><img data-attachment-id="18163" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/bundle-analyzer-lodash-modular/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-modular.png" data-orig-size="730,731" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Lodash array functions in the bundle analyzer" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-modular-300x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-modular.png" decoding="async" class="aligncenter size-full wp-image-18163 jetpack-lazy-image" src="../Images/113bcb7324b1c95bec1743b2f95edee1.png" alt="Lodash Array Functions In The Bundle Analyzer" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-modular.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-modular-300x300.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-modular-150x150.png 150w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-modular.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-modular.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18163" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/bundle-analyzer-lodash-modular/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-modular.png" data-orig-size="730,731" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Lodash array functions in the bundle analyzer" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-modular-300x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-modular.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18163" src="../Images/113bcb7324b1c95bec1743b2f95edee1.png" alt="Lodash Array Functions In The Bundle Analyzer" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-modular.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-modular-300x300.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-modular-150x150.png 150w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/bundle-analyzer-lodash-modular.png"/></noscript>
<p>底线是当您检查您的包时，您应该特别注意您的库。如果您只使用了整个库范围的一小部分，那就有问题了。查看库的文档，看是否可以导入单个功能。否则，寻找模块化的替代方案或推出自己的解决方案。</p>
<p>我们现在已经了解了除了一个必须满足的要求之外的所有要求，即外部库需要告诉webpack它们没有副作用。</p>
<p>从webpack的角度来看，所有的库都有副作用，除非他们另有说明。图书馆所有者必须将他们的项目或部分项目标记为无<a href="https://webpack.js.org/guides/tree-shaking/#mark-the-file-as-side-effect-free">副作用的</a>。Lodash也用它的<code><a href="https://github.com/lodash/lodash/blob/master/package.json">package.json</a></code>中的<code>sideEffects: false</code>属性来做这件事。</p>
<h2>将正确版本的源地图交付生产</h2>
<p>由你和你的团队来决定你是否想要<a href="https://css-tricks.com/should-i-use-source-maps-in-production/">发布源码图到产品</a>，无论是出于调试的原因还是为了让其他人向你学习。</p>
<p>如果您根本不想要生产包的源映射，您需要确保没有为生产模式设置<a href="https://webpack.js.org/configuration/devtool/"> devtool配置选项</a>。但是，如果您确实想拥有用于生产的源地图，请注意使用正确的<code>devtool</code>变体，因为它会影响webpack的构建速度，最重要的是，会影响包的大小。</p>
<p>对于生产来说，<code>devtool: "source-map"</code>是一个很好的选择，因为JS包中只生成一个注释。如果您的用户没有打开浏览器的devtools，他们不会加载由webpack生成的相应的源映射文件。</p>
<p>为了添加源地图，我们只需要向产品配置添加一个属性(检查分支<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/sourcemaps">sourcemaps</a></code>)。</p>
<pre>// webpack.prod.js
const config = {
  mode: "production",
+ devtool: "source-map",
  // ...
}</pre>
<p>下面的屏幕截图显示了生产版本的结果。</p>
<p><img data-attachment-id="18164" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/production-build-output-source-maps/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-source-maps.png" data-orig-size="730,407" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Production build output with source maps" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-source-maps-300x167.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-source-maps.png" decoding="async" class="aligncenter size-full wp-image-18164 jetpack-lazy-image" src="../Images/b946245f410c2dad77f5f6c31cdc6019.png" alt="Production Build Output With Source Maps" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-source-maps.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-source-maps-300x167.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-source-maps.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-source-maps.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18164" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/production-build-output-source-maps/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-source-maps.png" data-orig-size="730,407" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Production build output with source maps" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-source-maps-300x167.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-source-maps.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18164" src="../Images/b946245f410c2dad77f5f6c31cdc6019.png" alt="Production Build Output With Source Maps" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-source-maps.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-source-maps-300x167.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-source-maps.png"/></noscript>
<p>webpack只在每个资产中添加了一行注释。</p>
<p><img data-attachment-id="18165" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/source-map-comment/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/source-map-comment.png" data-orig-size="730,139" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Source map comment example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/source-map-comment-300x57.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/source-map-comment.png" decoding="async" class="aligncenter size-full wp-image-18165 jetpack-lazy-image" src="../Images/9fa18082be2dd64738062fad43a072ce.png" alt="Source Map Comment Example" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/source-map-comment.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/source-map-comment-300x57.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/source-map-comment.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/source-map-comment.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18165" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/source-map-comment/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/source-map-comment.png" data-orig-size="730,139" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Source map comment example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/source-map-comment-300x57.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/source-map-comment.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18165" src="../Images/9fa18082be2dd64738062fad43a072ce.png" alt="Source Map Comment Example" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/source-map-comment.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/source-map-comment-300x57.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/source-map-comment.png"/></noscript>
<p>相比之下，当您使用<code>devtool: "inline-source-map"</code>运行开发构建时，您可以清楚地看到为什么将这种配置用于生产不是一个好主意。</p>
<p><img data-attachment-id="18166" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-inline-source-map/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-inline-source-map.png" data-orig-size="730,162" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Build output with inline-source-map" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-inline-source-map-300x67.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-inline-source-map.png" decoding="async" class="aligncenter size-full wp-image-18166 jetpack-lazy-image" src="../Images/4fa8f44d8ea48fd44a6483844c49366d.png" alt="Build Output With inline-source-map Specified" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-inline-source-map.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-inline-source-map-300x67.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-inline-source-map.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-inline-source-map.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18166" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-inline-source-map/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-inline-source-map.png" data-orig-size="730,162" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Build output with inline-source-map" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-inline-source-map-300x67.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-inline-source-map.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18166" src="../Images/4fa8f44d8ea48fd44a6483844c49366d.png" alt="Build Output With inline-source-map Specified" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-inline-source-map.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-inline-source-map-300x67.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-inline-source-map.png"/></noscript>
<h2>准备长期缓存</h2>
<p>检查分支<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/caching-no-optimization">caching-no-optimization</a></code>并运行生产构建来查看起点。</p>
<p><img data-attachment-id="18167" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/production-build-output-caching-no-optimization/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-caching-no-optimization.png" data-orig-size="730,185" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Production build output of caching-no-optimization" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-caching-no-optimization-300x76.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-caching-no-optimization.png" decoding="async" class="aligncenter size-full wp-image-18167 jetpack-lazy-image" src="../Images/5ca3d6ece6e8e5cfd5a51950f686cf23.png" alt="Production Build Output Of The caching-no-optimization Branch" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-caching-no-optimization.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-caching-no-optimization-300x76.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-caching-no-optimization.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-caching-no-optimization.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18167" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/production-build-output-caching-no-optimization/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-caching-no-optimization.png" data-orig-size="730,185" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Production build output of caching-no-optimization" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-caching-no-optimization-300x76.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-caching-no-optimization.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18167" src="../Images/5ca3d6ece6e8e5cfd5a51950f686cf23.png" alt="Production Build Output Of The caching-no-optimization Branch" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-caching-no-optimization.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-caching-no-optimization-300x76.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/production-build-output-caching-no-optimization.png"/></noscript>
<p>为什么这个结果有问题？从缓存的角度来看，资产名称不是最佳的。我们应该配置我们的web服务器来响应设置适当大的<code>max-age</code>值的<code><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control">Cache-Control</a></code>头，以支持长期的浏览器缓存。</p>
<p>然而，使用这些文件名，我们不能在webpack由于开发人员的活动(如错误修复、新功能等)而生成新版本后，使浏览器缓存的资产无效。因此，即使我们已经提供了更新的版本，我们的用户也可能最终使用陈旧和有问题的JavaScript包。</p>
<p>我们可以做得更好。我们可以在webpack配置的不同位置使用占位符字符串——例如在<code>filename</code>值中。每当我们对相应的源文件做出改变时，我们使用<code>[hash]</code>为资产创建一个唯一的文件名(检查分支<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/caching-hash">caching-hash</a></code>)。我们也不应该忽视我们的CSS资产。</p>
<pre>// webpack.prod.js
const config = {
  // ...
  output: {
-    filename: "static/[name].js",
+    filename: "static/[name].[hash].js",
  },
  // ...
  plugins: [
    new MiniCssExtractPlugin({
-      filename: "styles/[name].css",
+      filename: "styles/[name].[hash].css",
    }),
    // ...
  ],
}</pre>
<p><img data-attachment-id="18169" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-hash-values/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-hash-values.png" data-orig-size="730,163" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Build output with hash values in filenames" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-hash-values-300x67.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-hash-values.png" decoding="async" class="aligncenter size-full wp-image-18169 jetpack-lazy-image" src="../Images/6fb9e50eba7c6725f9987c126531f963.png" alt="Build Output With Hash Values In Filenames" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-hash-values.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-hash-values-300x67.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-hash-values.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-hash-values.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18169" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-hash-values/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-hash-values.png" data-orig-size="730,163" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Build output with hash values in filenames" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-hash-values-300x67.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-hash-values.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18169" src="../Images/6fb9e50eba7c6725f9987c126531f963.png" alt="Build Output With Hash Values In Filenames" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-hash-values.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-hash-values-300x67.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-hash-values.png"/></noscript>
<p>太酷了，我们在文件名中加入了有趣的哈希值。但是不要这么快——我们还没有完成。结果显示所有资产都具有相同的哈希值。这一点帮助都没有，因为每当我们改变一个文件时，所有其他的资产都会收到相同的哈希值。</p>
<p>让我们通过添加一个<code>console.log</code>语句来更改<code>Profile.js</code>，并再次运行构建。</p>
<pre>// Profile.js
const Profile = () =&gt; {
+ console.log("hello world");
  // ...
};
export default Profile;</pre>
<p>正如所料，所有资产都获得了相同的新哈希值。</p>
<p><img data-attachment-id="18170" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-same-hash-values/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-same-hash-values.png" data-orig-size="730,160" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="All assets have the same hash value" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-same-hash-values-300x66.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-same-hash-values.png" decoding="async" class="aligncenter size-full wp-image-18170 jetpack-lazy-image" src="../Images/7fdfd533027b1deae06f8195aa929248.png" alt="All Assets Have The Same Hash Value" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-same-hash-values.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-same-hash-values-300x66.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-same-hash-values.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-same-hash-values.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18170" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-same-hash-values/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-same-hash-values.png" data-orig-size="730,160" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="All assets have the same hash value" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-same-hash-values-300x66.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-same-hash-values.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18170" src="../Images/7fdfd533027b1deae06f8195aa929248.png" alt="All Assets Have The Same Hash Value" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-same-hash-values.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-same-hash-values-300x66.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-same-hash-values.png"/></noscript>
<p>那是因为我们必须使用不同的文件名<a href="https://webpack.js.org/guides/caching/#output-filenames">替换占位符</a>。除了<code>[name]</code>之外，我们还有三个关于缓存的占位符字符串:</p>
<ul>
<li><code>[hash]</code>–如果至少有一个块发生变化，将为整个构建生成一个新的哈希值</li>
<li><code>[chunkhash]</code>–对于每个变化的块，都会生成一个新的哈希值</li>
<li><code>[contenthash]</code>–对于每个更改的资产，都会生成一个基于资产内容的新散列</li>
</ul>
<p>起初，不太清楚<code>[chunkhash]</code>和<code>[contenthash]</code>的区别。让我们试试<code>[chunkhash]</code>(检查分支<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/caching-chunkhash">caching-chunkhash</a></code>)。</p>
<pre>// webpack.prod.js
const config = {
  // ...
  output: {
-    filename: "static/[name].[hash].js",
+    filename: "static/[name].[chunkhash].js",
  },
  // ...
  plugins: [
    new MiniCssExtractPlugin({
-      filename: "styles/[name].[hash].css",
+      filename: "styles/[name].[chunkhash].css",
    }),
    // ...
  ],
}</pre>
<p>试一试，然后再次运行生产版本！</p>
<p><img data-attachment-id="18171" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/css-js-assets-matching-hashes/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/css-js-assets-matching-hashes.png" data-orig-size="730,160" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Corresponding CSS and JS assets have matching hashes" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/css-js-assets-matching-hashes-300x66.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/css-js-assets-matching-hashes.png" decoding="async" class="aligncenter size-full wp-image-18171 jetpack-lazy-image" src="../Images/77d09fabbadabbd3b525ee27dcf201eb.png" alt="Corresponding CSS And JS Assets Have Matching Hashes" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/css-js-assets-matching-hashes.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/css-js-assets-matching-hashes-300x66.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/css-js-assets-matching-hashes.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/css-js-assets-matching-hashes.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18171" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/css-js-assets-matching-hashes/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/css-js-assets-matching-hashes.png" data-orig-size="730,160" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Corresponding CSS and JS assets have matching hashes" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/css-js-assets-matching-hashes-300x66.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/css-js-assets-matching-hashes.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18171" src="../Images/77d09fabbadabbd3b525ee27dcf201eb.png" alt="Corresponding CSS And JS Assets Have Matching Hashes" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/css-js-assets-matching-hashes.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/css-js-assets-matching-hashes-300x66.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/css-js-assets-matching-hashes.png"/></noscript>
<p>这看起来稍微好一点，但是CSS资产的散列与它们对应的JS资产匹配。让我们改变<code>Profile.js</code>，希望相应的CSS文件名不会被更新。</p>
<pre>// Profile.js
const Profile = () =&gt; {
+  console.log("hello world again");
  // ...
};</pre>
<p>这样的结果更糟糕。正如你在下面的截图中看到的，不仅<code>Profile.css</code>文件名包含与新的<code>Profile.js</code>相同的新哈希值，而且<code>App.js</code>和<code>App.css</code>也被更新为另一个新的哈希值。</p>
<p><img data-attachment-id="18173" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/change-profile-js-same-hashes/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/change-profile-js-same-hashes.png" data-orig-size="730,160" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Changing Profile.js results in new hashes for other assets" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/change-profile-js-same-hashes-300x66.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/change-profile-js-same-hashes.png" decoding="async" class="aligncenter size-full wp-image-18173 jetpack-lazy-image" src="../Images/2378d0e23bf31ae8d3d4f2f49d7cc895.png" alt="Changing Profile.js Results In New Hashes For Other Assets" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/change-profile-js-same-hashes.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/change-profile-js-same-hashes-300x66.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/change-profile-js-same-hashes.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/change-profile-js-same-hashes.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18173" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/change-profile-js-same-hashes/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/change-profile-js-same-hashes.png" data-orig-size="730,160" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Changing Profile.js results in new hashes for other assets" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/change-profile-js-same-hashes-300x66.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/change-profile-js-same-hashes.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18173" src="../Images/2378d0e23bf31ae8d3d4f2f49d7cc895.png" alt="Changing Profile.js Results In New Hashes For Other Assets" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/change-profile-js-same-hashes.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/change-profile-js-same-hashes-300x66.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/change-profile-js-same-hashes.png"/></noscript>
<p>也许<code>[contenthash]</code>有帮助？我们来了解一下(检出分支<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/caching-contenthash">caching-contenthash</a></code>)。</p>
<pre>// webpack.prod.js
const config = {
  // ...
  output: {
-    filename: "static/[name].[chunkhash].js",
+    filename: "static/[name].[contenthash].js",
  },
  // ...
  plugins: [
    new MiniCssExtractPlugin({
-      filename: "styles/[name].[chunkhash].css",
+      filename: "styles/[name].[contenthash].css",
    }),
    // ...
  ],
}</pre>
<p>每个资产都被赋予了一个新的但是独立的散列值。</p>
<p><img data-attachment-id="18184" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/caching-contenthash-build-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-contenthash-build-output.png" data-orig-size="730,160" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Branch caching-contenthash build output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-contenthash-build-output-300x66.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-contenthash-build-output.png" decoding="async" class="aligncenter size-full wp-image-18184 jetpack-lazy-image" src="../Images/f48353041922b7a09592d8fde18aee55.png" alt="Branch caching-contenthash Build Output" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-contenthash-build-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/caching-contenthash-build-output-300x66.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-contenthash-build-output.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-contenthash-build-output.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18184" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/caching-contenthash-build-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-contenthash-build-output.png" data-orig-size="730,160" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Branch caching-contenthash build output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-contenthash-build-output-300x66.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-contenthash-build-output.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18184" src="../Images/f48353041922b7a09592d8fde18aee55.png" alt="Branch caching-contenthash Build Output" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-contenthash-build-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/caching-contenthash-build-output-300x66.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-contenthash-build-output.png"/></noscript>
<p>我们成功了吗？我们再换个<code>Profile.js</code>里的东西，一探究竟。</p>
<pre>// Profile.js
const Profile = () =&gt; {
+  console.log("Let's go");
  // ...
};</pre>
<p>CSS资产名称没有改变，所以我们将它们从关联的JS资产中分离出来。</p>
<p><img data-attachment-id="18185" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-decoupled-css-js/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-decoupled-css-js.png" data-orig-size="730,160" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Build output with CSS and JS assets decoupled" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-decoupled-css-js-300x66.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-decoupled-css-js.png" decoding="async" class="aligncenter size-full wp-image-18185 jetpack-lazy-image" src="../Images/eedcf9506a373a34d22950321b900eec.png" alt="Build Output With Decoupled CSS And JS Assets" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-decoupled-css-js.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-decoupled-css-js-300x66.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-decoupled-css-js.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-decoupled-css-js.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18185" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-decoupled-css-js/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-decoupled-css-js.png" data-orig-size="730,160" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Build output with CSS and JS assets decoupled" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-decoupled-css-js-300x66.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-decoupled-css-js.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18185" src="../Images/eedcf9506a373a34d22950321b900eec.png" alt="Build Output With Decoupled CSS And JS Assets" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-decoupled-css-js.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-decoupled-css-js-300x66.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-decoupled-css-js.png"/></noscript>
<p>供应商捆绑包仍具有相同的名称。因为<code>Profile</code> React组件被导入到了<code>Blog</code> React组件中，所以两个JS包的两个文件名都改变了也没关系。</p>
<p>然而，<code>Blog.js</code>中的变化只会导致<code>app</code>包名的变化，而不会导致<code>profile</code>包名的变化，因为后者不会从前者导入任何东西。</p>
<pre>// Blog.js
export default function Blog() {
+  console.log("What's up?");
  // ...
}</pre>
<p>这一次，概要包名称没有改变——太好了！</p>
<p><img data-attachment-id="18194" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/profile-bundle-name-unchanged/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/profile-bundle-name-unchanged.png" data-orig-size="730,159" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The profile bundle name is now unchanged" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/profile-bundle-name-unchanged-300x65.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/profile-bundle-name-unchanged.png" decoding="async" class="aligncenter size-full wp-image-18194 jetpack-lazy-image" src="../Images/67552ebbcd35b0a4413540dce8187cdf.png" alt="The Profile Bundle Name Is Now Unchanged" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/profile-bundle-name-unchanged.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/profile-bundle-name-unchanged-300x65.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/profile-bundle-name-unchanged.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/profile-bundle-name-unchanged.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18194" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/profile-bundle-name-unchanged/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/profile-bundle-name-unchanged.png" data-orig-size="730,159" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The profile bundle name is now unchanged" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/profile-bundle-name-unchanged-300x65.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/profile-bundle-name-unchanged.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18194" src="../Images/67552ebbcd35b0a4413540dce8187cdf.png" alt="The Profile Bundle Name Is Now Unchanged" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/profile-bundle-name-unchanged.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/profile-bundle-name-unchanged-300x65.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/profile-bundle-name-unchanged.png"/></noscript>
<p>另外，<a href="https://webpack.js.org/guides/caching/">官方webpack doc </a> <a href="https://webpack.js.org/guides/caching/"> s </a>还推荐你做以下几点:</p>
<ul>
<li>在单独的包中提取清单</li>
<li>使用<code><a href="https://webpack.js.org/configuration/optimization/#optimizationmoduleids">moduleIds</a></code></li>
</ul>
<p>查看分支<code><a href="https://github.com/doppelmutzi/react-performance-strategies/tree/caching-moduleids">caching-moduleids</a></code>以获得我们配置的最终版本。</p>
<pre>// webpack.prod.js
const config = {
  // ...
  optimization: {
+   moduleIds: "hashed",
+   runtimeChunk: {
+     name: "manifest",
+   },
    splitChunks: {
      // ...
    }
  }
  // ...
}</pre>
<p>现在所有的JS包都发生了变化，因为清单被提取到一个单独的包中。结果，它们的尺寸缩小了一点点。</p>
<p><img data-attachment-id="18198" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/caching-moduleids-build-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-moduleids-build-output.png" data-orig-size="730,191" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Build output for the caching-moduleids branch" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-moduleids-build-output-300x78.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-moduleids-build-output.png" decoding="async" class="aligncenter size-full wp-image-18198 jetpack-lazy-image" src="../Images/4867a01087bef1c6f3c887b77b8b3af8.png" alt="Build Output For The caching-moduleids Branch" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-moduleids-build-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/caching-moduleids-build-output-300x78.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-moduleids-build-output.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-moduleids-build-output.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18198" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/caching-moduleids-build-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-moduleids-build-output.png" data-orig-size="730,191" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Build output for the caching-moduleids branch" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-moduleids-build-output-300x78.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-moduleids-build-output.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18198" src="../Images/4867a01087bef1c6f3c887b77b8b3af8.png" alt="Build Output For The caching-moduleids Branch" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-moduleids-build-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/caching-moduleids-build-output-300x78.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/caching-moduleids-build-output.png"/></noscript>
<p>我不确定清单何时会发生变化——可能是在webpack版本更新之后？但是我们可以验证最后一步。如果我们更新其中一个供应商依赖项，<code>node_vendors</code>包应该得到一个新的散列名称，但是其余的资产应该保持不变。让我们在<code>package.json</code>中改变一个随机的依赖关系，然后运行<code>npm i &amp;&amp; npm run build</code>。</p>
<p><img data-attachment-id="18201" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-updated-vendors-bundle/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-updated-vendors-bundle.png" data-orig-size="730,188" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Build output after updating node_vendors" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-updated-vendors-bundle-300x77.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-updated-vendors-bundle.png" decoding="async" class="aligncenter size-full wp-image-18201 jetpack-lazy-image" src="../Images/d6121153aa9916c2e3532a90d53ae1b6.png" alt="The Build Output After Updating The node_vendors Bundle" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-updated-vendors-bundle.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-updated-vendors-bundle-300x77.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-updated-vendors-bundle.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-updated-vendors-bundle.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="18201" data-permalink="https://blog.logrocket.com/guide-performance-optimization-webpack/build-output-updated-vendors-bundle/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-updated-vendors-bundle.png" data-orig-size="730,188" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Build output after updating node_vendors" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-updated-vendors-bundle-300x77.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-updated-vendors-bundle.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-18201" src="../Images/d6121153aa9916c2e3532a90d53ae1b6.png" alt="The Build Output After Updating The node_vendors Bundle" srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-updated-vendors-bundle.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-updated-vendors-bundle-300x77.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/build-output-updated-vendors-bundle.png"/></noscript>
<p>这是艰苦的工作，但是值得的。现在我们对缓存破坏有了更好的准备。</p>
<h2>结论</h2>
<p>性能优化是一件复杂的事情，webpack让它变得不那么复杂了。</p>
<p>将性能优化集成到您的项目中的关键是理解一些基本概念，例如树抖动、代码分割和缓存破坏。当然，webpack是一个固执己见的模块捆绑器，但是如果很好地理解了基本原理，使用webpack文档并实现您想要的性能目标会更容易。</p>
<p>本指南主要关注JavaScript的性能优化技术。一些HTML也包含在<code>HtmlWebpackPlugin</code>中。还可以涵盖更多领域，例如优化样式(例如，CSS-in-JS、critical CSS)或资产(例如，brotli压缩)，但这将是另一篇文章的主题。</p>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>