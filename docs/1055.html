<html>
<head>
<title>Common bugs in React Native ScrollView and how to fix them - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>React Native ScrollView中的常见bug及修复方法- LogRocket博客</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/common-bugs-react-native-scrollview/#0001-01-01">https://blog.logrocket.com/common-bugs-react-native-scrollview/#0001-01-01</a></blockquote><div><article class="article-post">
<h2>介绍</h2>
<p>React Native的ScrollView组件是一个通用容器，它可以包含多个元素——视图、文本、可按对象，甚至另一个ScrollView。将所有这些元素放入ScrollView组件后，您可以使用它来垂直(默认)或水平(通过将其添加为道具)滚动它们。</p>
<p>我们可以在App Store和Google Play上的几乎所有应用程序中看到滚动组件。今天，我将解释在React Native中使用ScrollView时的一些常见错误以及如何避免它们，并提供一些提示和技巧来帮助提供最佳的用户体验。</p>
<h2>何时使用滚动视图</h2>
<p>使用ScrollView的第一个也是最常见的错误是不知道何时使用它。React Native中有两个常见的列表组件:ScrollView和FlatList。</p>
<p>要确定使用哪一个，我们只需记住一件事:ScrollView最适合显示少量有限大小的元素，因为ScrollView的所有子组件都是一次呈现的，即使它们当前在屏幕上不可见。</p>
<p>这就是为什么如果你的ScrollView中有很多元素，其中一些是，例如，较高的，纵向风格的图片，ScrollView的性能可能会有点滞后，让用户不愉快。</p>
<p>例如，每当您以列表的形式从API获取数据时，在应用程序中显示它们的最佳方式是使用FlatList组件，它的实现方式不同。因为FlatList只呈现当前显示在屏幕上的元素——而不是一次呈现所有元素——所以它能够以更高效的方式显示长列表。</p>
<p>FlatList向我们展示了一长串道具，这些道具是为呈现长数据列表的最佳UX和性能而设计的，包括:</p>
<ul>
<li><code>removeClippedSubviews</code>–一个布尔值，当启用时(默认情况下为<code>false</code>)，将视口之外的视图从本地视图层次结构中分离出来，这减少了花费在主线程上的时间，从而降低了丢帧的风险</li>
<li><code>initialNumToRender</code>–这是要呈现到平面列表中的项目的初始数量。最佳实践是为每个设备定义覆盖视口的项目的精确数量，这可以提高组件初始渲染的性能。将该数值设置得太低可能会导致空白区域</li>
</ul>
<p>关于如何提高FlatList的性能，还有一些更好的技巧，在这里的文档<a href="https://reactnative.dev/docs/optimizing-flatlist-configuration#props">中有很好的解释。我希望通过阅读上面的段落，我能帮助你理解什么时候使用哪个组件。</a></p>
<h2>样式滚动条查看正确的方式</h2>
<p>现在我们知道了<em>何时</em>使用ScrollView组件，让我们看看<em>如何</em>使用它。初学者通常会浪费大量时间来弄清楚如何正确地设计ScrollView的样式，因为它有两个样式道具:<code>style</code>和<code>contentContainerStyle</code>。以下是对这些道具的简短解释:</p>
<ul>
<li>属性用于ScrollView父元素的样式，我们可以把它看作一个简单的、不可滚动的视图。我们将设置窗口视口中ScrollView元素的大小及其相对于同级元素的位置。此父容器不能超过视口的高度或宽度</li>
<li><code>contentContainerStyle</code> prop是我上面描述的父ScrollView中的一个可滚动容器。这是ScrollView的移动部分，我们在这里应用样式，允许我们在里面对齐项目，添加填充等等。</li>
</ul>
<p>这里有一个活生生的例子，你可以在<a href="https://snack.expo.io/@karniej/bd5446"> snack.expo.io </a>上测试:</p>
<p data-snack-id="@karniej/bd5446" data-snack-platform="web" data-snack-preview="true" data-snack-theme="dark"/>
<p/>
<p>所以现在我们知道了什么时候使用ScrollView以及如何设置它的样式，我将解释一些可能引起一些混乱并导致bug的常见道具。</p>
<h2>跟踪滚动位置</h2>
<p>使用ScrollView时，我们经常需要跟踪滚动位置。要正确做到这一点，我们应该使用<code>onScroll</code>道具。滚动期间，该事件每帧最多触发一次。单个滚动事件是这样一个对象:</p>
<pre>{
  nativeEvent: {
    contentInset: {bottom, left, right, top},
    contentOffset: {x, y},
    contentSize: {height, width},
    layoutMeasurement: {height, width},
    zoomScale
  }
}</pre>
<p>为了正确使用这些值，我们必须知道这些属性的作用:</p>
<ul>
<li><code>contentInset</code>–这是从ScrollView的边缘到其内容的距离的边距；默认的对象值是<code>{top: 0, left: 0, bottom: 0, right: 0}</code></li>
<li><code>contentOffset</code>–该值是用户已经从开始滚动的距离，当我们想要跟踪滚动的值时最常用。如果是水平ScrollView组件，我们用的是<code>contentOffset.x</code>；如果是垂直的，我们用<code>contentOffset.y</code></li>
<li><code>contentSize</code>–我们使用这个道具来获取ScrollView中内容的<code>height</code>和<code>width</code>。它通常与<code>layoutMeasurement</code>和<code>contentOffset</code>一起使用——例如，确定用户是否已经滚动到内容的末尾。我们在使用这个道具时必须特别小心，因为出于性能原因，它在Android上是<em>而不是</em>可用的</li>
<li><code>layoutMeasurement</code>–这是视口的<code>height</code>和<code>width</code></li>
<li><code>zoomScale</code>–滚动视图内容的当前比例值。当ScrollView只包含一个图像组件时，我们可以将它与<code>maximumZoomScale</code>和<code>minimumZoomScale</code>道具一起使用来放大图像</li>
</ul>
<p>由于性能原因，正确使用<code>onScroll</code>和跟踪滚动位置可能是一项棘手的任务。这就是为什么记住我们用一个滚动事件调用多少必要的操作总是很重要。</p>
<p>为了更好地控制滚动事件，我们使用了一个<code>scrollEventThrottle</code> prop，它控制用户滚动时滚动事件的触发频率(以毫秒为单位的时间间隔)。较低的数量可以提高跟踪滚动值位置(<code>contentOffset</code>)的准确性，但这通常会导致性能问题。</p>
<p>数值1-16之间的差异肉眼看不出来，因为JS运行循环与屏幕刷新率同步(在大多数情况下，16是推荐的数值)。设置较高的数字会导致通过React本机桥发送较少的代码，从而提高性能。</p>
<h2>嵌套滚动视图</h2>
<p>最后但同样重要的是，我想谈谈在另一个ScrollView组件中嵌套一个ScrollView组件。例如，当实现水平和垂直元素的混合时，我们有时可能需要这种组合。</p>
<p>默认情况下，嵌套ScrollViews在iOS上是自动启用的，但为了在Android上使用它，我们必须将<code>nestedScrollEnabled</code> props设置为<code>true</code>，并且还要记住我们的Android API必须在21+级(React Native v0.63中的默认为24)。</p>
<h2>摘要</h2>
<p>尽管ScrollView组件中有许多有趣的道具，允许我们创建大量有趣的用户体验，但我认为我已经根据我的经验强调了ScrollView组件最常见的错误和重要的用例。</p>
<p>我希望我已经用一种帮助你更容易使用这个组件的方式解释了它们。如果您在使用ScrollView组件时有任何其他问题，请随时在评论部分提出——我会关注它，并回答您可能有的所有问题。</p><div class="code-block code-block-18">
<div class="blog-plug inline-plug react-native-plug"><h2><a href="https://lp.logrocket.com/blg/react-native-signup"> LogRocket </a>:即时重现React原生应用中的问题。</h2><a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/110055665562c1e02069b3698e6cc671.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/110055665562c1e02069b3698e6cc671.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/></noscript></a><p><a href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一款React原生监控解决方案，可帮助您即时重现问题、确定bug的优先级并了解React原生应用的性能。</p><p>LogRocket还可以向你展示用户是如何与你的应用程序互动的，从而帮助你提高转化率和产品使用率。LogRocket的产品分析功能揭示了用户不完成特定流程或不采用新功能的原因。</p><p>开始主动监控您的React原生应用— <a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer">免费试用LogRocket】。</a></p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>