<html>
<head>
<title>How to simplify component testing with React Storybook - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何用React Storybook简化组件测试</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/how-to-simplify-component-testing-react-storybook/#0001-01-01">https://blog.logrocket.com/how-to-simplify-component-testing-react-storybook/#0001-01-01</a></blockquote><div><article class="article-post">
<p>编者按:这篇文章最后一次更新是在2022年6月6日，它包含了Storybook的新特性，比如可访问性测试。</p>
<p>每个开发人员的目标都是构建有效的软件。我们可以通过隔离它并在测试中显示它的行为来确保我们的软件代码完美地工作。然而，我们不能对我们的组件说同样的话，这些组件是在我们的应用程序环境中测试的。</p>
<p>Storybook允许我们以隔离的方式查看组件并与之交互。这就像单元测试一样，只是针对UI组件。</p>
<p>根据<a href="https://storybook.js.org/docs/basics/introduction/"> Storybook的文档</a>，Storybook是一个用户界面开发环境，也是UI组件的游乐场。Storybook使开发人员能够独立地创建组件，并在一个隔离的开发环境中交互地展示组件。</p>
<p>在本文中，我们将探索Storybook如何帮助我们创建UI组件并改进我们的组件测试。</p>
<p>如果您想研究代码或跟随代码，您可以在GitHub 上查看<a href="https://github.com/fullstackmafia/react-storybook-app">源代码。我们开始吧！</a></p>

<h2 id="getting-started-storybook">故事书入门</h2>
<p>首先，我们将<a href="https://blog.logrocket.com/using-storybook-to-develop-react-components-faster/">引导一个新的React项目</a>。在这里，我们将通过CLI安装Storybook:</p>
<pre class="language-bash">#create a react app
npx create-react-app my-storybook-app

#navigate to the newly created app
cd my-storybook-app

#install storybook
npx sb init

#run via npm
npm run storybook

#running via yarn
yarn storybook
</pre>
<p>Storybook的测试页面应该从我们浏览器中的本地地址<code><a href="http://localhost:6006/" rel="nofollow">http://localhost:6006/</a></code>开始:</p>
<p><img data-attachment-id="110940" data-permalink="https://blog.logrocket.com/storybook-testing-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/05/storybook-testing-page.png" data-orig-size="730,465" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="storybook-testing-page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/05/storybook-testing-page-300x191.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/05/storybook-testing-page.png" decoding="async" class="aligncenter wp-image-110940 size-full jetpack-lazy-image" src="../Images/2be66dd61340e6fb21866b38e98bf24d.png" alt="Storybook Testing Page" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/05/storybook-testing-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/05/storybook-testing-page-300x191.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/05/storybook-testing-page.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/05/storybook-testing-page.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="110940" data-permalink="https://blog.logrocket.com/storybook-testing-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/05/storybook-testing-page.png" data-orig-size="730,465" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="storybook-testing-page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/05/storybook-testing-page-300x191.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/05/storybook-testing-page.png" decoding="async" loading="lazy" class="aligncenter wp-image-110940 size-full" src="../Images/2be66dd61340e6fb21866b38e98bf24d.png" alt="Storybook Testing Page" srcset="https://blog.logrocket.com/wp-content/uploads/2022/05/storybook-testing-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/05/storybook-testing-page-300x191.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/05/storybook-testing-page.png"/></noscript>
<p>我们将创建一个用于测试的组件，一个名为<code>Button.jsx</code>的按钮，它将显示要供应的咖啡杯数。这个基本组件由<a href="https://storybook.js.org/docs/react/writing-stories/introduction#default-export"> Storybook的默认导出元数据</a>控制，它控制故事如何被列出:</p>
<pre class="language-javascript">// /src/components/Button.jsx

import React from "react";
import PropTypes from "prop-types";
import "./button.css";
export const Button = ({ backgroundColor, size, label, ...props }) =&gt; {
  return (
    &lt;div&gt;
      &lt;button
        type="button"
        className={["storybook-button", `storybook-button--${size}`].join(" ")}
        id="button"
        style={backgroundColor &amp;&amp; { backgroundColor }}
        {...props}
      &gt;
        {label}
      &lt;/button&gt;
    &lt;/div&gt;
  );
};
Button.propTypes = {
  backgroundColor: PropTypes.string,
  size: PropTypes.oneOf(["small", "medium", "large"]),
  label: PropTypes.string.isRequired,
  onClick: PropTypes.func,
};
Button.defaultProps = {
  backgroundColor: null,
  size: "medium",
  onClick: undefined,
};
</pre>
<p>故事书作品使用故事；story是一个函数，它包含一个组件的单一状态，并将该组件呈现到屏幕上以供测试。让我们为我们的<code>Button.jsx</code>组件写一个故事。在<code>src/stories</code>中，创建一个名为<code>Button.stories.jsx</code>的文件:</p>
<pre class="language-javascript">import React from "react";
import { Button } from "../components/Button";

export default {
  title: "Components/Button",
  component: Button,
  argTypes: {
    backgroundColor: { control: "color" },
    onClick: { action: "clicked" },
  },
};
const Template = (args) =&gt; &lt;Button {...args} /&gt;;
export const Primary = Template.bind({});
Primary.args = {
  label: "Button",
};
</pre>
<p>在Storybook中，我们的组件如下所示:</p>
<p><img data-attachment-id="110937" data-permalink="https://blog.logrocket.com/component-storybook-visual/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/05/component-storybook-visual.png" data-orig-size="730,354" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="component-storybook-visual" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/05/component-storybook-visual-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/05/component-storybook-visual.png" decoding="async" class="aligncenter wp-image-110937 size-full jetpack-lazy-image" src="../Images/fd7f984c0abf566e1963c3c3168066b9.png" alt="Component Storybook Visual" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/05/component-storybook-visual.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/05/component-storybook-visual-300x145.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/05/component-storybook-visual.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/05/component-storybook-visual.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="110937" data-permalink="https://blog.logrocket.com/component-storybook-visual/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/05/component-storybook-visual.png" data-orig-size="730,354" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="component-storybook-visual" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/05/component-storybook-visual-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/05/component-storybook-visual.png" decoding="async" loading="lazy" class="aligncenter wp-image-110937 size-full" src="../Images/fd7f984c0abf566e1963c3c3168066b9.png" alt="Component Storybook Visual" srcset="https://blog.logrocket.com/wp-content/uploads/2022/05/component-storybook-visual.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/05/component-storybook-visual-300x145.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/05/component-storybook-visual.png"/></noscript>
<h2 id="ui-testing">用户界面测试</h2>
<p>Storybook提供了几种不同的测试UI组件的技术。出于各种原因，组件需要接受测试，其中一些原因包括检测bug、防止代码在新的提交过程中被破坏，以及为从事该项目的其他开发人员提供指导。</p>
<p>让我们研究一下Storybook可以无缝进行组件测试的一些方法。</p>
<h2 id="accessibility-testing">可访问性测试</h2>
<p>可访问性测试根据一组基于<a href="https://www.w3.org/WAI/standards-guidelines/wcag/"> WCAG </a>规则和其他行业公认的最佳实践的启发式规则来审核呈现的DOM。这些作为质量保证的第一道防线来捕捉明显的可访问性违规。</p>
<p>Storybook的accessibility在活动故事上运行<a href="https://github.com/dequelabs/axe-core"> Axe </a>，在面板中可视化测试结果，并列出所有违反规则的DOM节点。Axe库在团队中很受欢迎，因为它集成了大多数现有的测试环境。平均来说，Axe可以自动检测57%的WCAG违规。</p>
<p>要安装附加组件，请运行以下代码:</p>
<pre class="language-bash">npm i -D @storybook/addon-a11y
</pre>
<p>然后，将<code>@storybook/addon-a11y</code>添加到<code>.storybook/main.js</code>中的<code>addons</code>数组中:</p>
<pre class="language-javascript">module.exports = {
 stories: ['../src/**/*.stories.mdx', '../src/**/*<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f3dd80879c819a9680ddb3">[email protected]</a>(js|jsx|ts|tsx)'],
 addons: [
   '@storybook/addon-links',
   '@storybook/addon-essentials',
   '@storybook/preset-create-react-app',
+  '@storybook/addon-a11y',
 ],
};
</pre>
<p>让我们看看我们的组件:</p>
<p><img data-attachment-id="114973" data-permalink="https://blog.logrocket.com/storybook-button-component-3/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/06/storybook-button-component.png" data-orig-size="730,354" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="storybook-button-component" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/06/storybook-button-component-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/06/storybook-button-component.png" decoding="async" class="aligncenter wp-image-114973 size-full jetpack-lazy-image" src="../Images/28c9b272e1f4c10ebd1b01080ce55d07.png" alt="Storybook Button Component" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/06/storybook-button-component.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/06/storybook-button-component-300x145.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/06/storybook-button-component.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/06/storybook-button-component.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="114973" data-permalink="https://blog.logrocket.com/storybook-button-component-3/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/06/storybook-button-component.png" data-orig-size="730,354" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="storybook-button-component" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/06/storybook-button-component-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/06/storybook-button-component.png" decoding="async" loading="lazy" class="aligncenter wp-image-114973 size-full" src="../Images/28c9b272e1f4c10ebd1b01080ce55d07.png" alt="Storybook Button Component" srcset="https://blog.logrocket.com/wp-content/uploads/2022/06/storybook-button-component.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/06/storybook-button-component-300x145.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/06/storybook-button-component.png"/></noscript>
<p>乍一看，该组件似乎已准备好发货。但是，当我们打开accessibility选项卡时，测试揭示了一些不同的东西。</p>
<p><img decoding="async" src="../Images/2d15d29d8b23e01314df1c54cac9f5d9.png" alt="" data-lazy-src="/static/img/pixel.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/static/img/pixel.gif"/></p><noscript><img data-lazy-fallback="1" decoding="async" src="../Images/2d15d29d8b23e01314df1c54cac9f5d9.png" alt="" data-original-src="https://blog.logrocket.com/static/img/pixel.gif"/></noscript>The accessibility add-on has a <code>Highlight results</code> checkbox, which aids in identifying the components that are failing. This comes in handy, especially when working with larger components, preventing us from executing tests individually in each component.
<p>注意这个附加组件是如何发现一个写着<code>Ensures the contrast between foreground and background colors meets WCAG 2 AA contrast thresholds</code>的违例的。本质上，文本和背景之间没有足够的对比度。我们可以通过将文本颜色从<code>gray.400</code>改成<code>gray.600</code>稍微深一点的灰色来解决这个问题。</p>
<h2 id="automated-visual-testing">自动化视觉测试</h2>
<p>自动化视觉测试自动验证我们的用户界面的视觉效果是否符合预期。在跨浏览器测试中，自动化视觉测试可以检测出开发人员没有注意到的失误。</p>
<p>有许多用于视觉测试的工具，但是我推荐故事书维护者创造的T2彩色工具，在闪电般的云浏览器环境中运行视觉测试。</p>
<h2 id="chromatic-add-on">设置彩色附加组件</h2>
<p>Chromatic是为Storybook构建的云服务，允许您在零配置的情况下运行可视化测试。要开始，注册GitHub、GitLab、Bitbucket或你的电子邮件地址，为故事书项目生成一个唯一的<code>&lt;project-token&gt;</code>。</p>
<p>接下来，从npm安装<a href="https://www.npmjs.com/package/chromatic"> Chromatic CLI包</a>:</p>
<pre class="language-bash"># With npm
npm install chromatic --save-dev

# With yarn
yarn add --dev chromatic
</pre>
<p>软件包安装完成后，运行以下命令:</p>
<pre class="language-bash">npx chromatic --project-token &lt;your-project-token&gt;
</pre>
<p>别忘了把<code>your-project-token</code>换成Chromatic提供的。</p>
<p>当Chromatic完成时，它应该已经成功地部署了Storybook项目并建立了基线，这是所有组件故事的起点。此外，Chromatic为我们提供了已出版故事书的链接，我们可以与我们的团队分享以收集反馈:</p>
<p><img data-attachment-id="110933" data-permalink="https://blog.logrocket.com/chromatic-link-published-storybook/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/05/chromatic-link-published-storybook.png" data-orig-size="730,359" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="chromatic-link-published-storybook" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/05/chromatic-link-published-storybook-300x148.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/05/chromatic-link-published-storybook.png" decoding="async" class="aligncenter wp-image-110933 size-full jetpack-lazy-image" src="../Images/1f8be3bf5a8f57c0a648d91858a73de6.png" alt="Chromatic Link Published Storybook" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/05/chromatic-link-published-storybook.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/05/chromatic-link-published-storybook-300x148.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/05/chromatic-link-published-storybook.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/05/chromatic-link-published-storybook.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="110933" data-permalink="https://blog.logrocket.com/chromatic-link-published-storybook/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/05/chromatic-link-published-storybook.png" data-orig-size="730,359" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="chromatic-link-published-storybook" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/05/chromatic-link-published-storybook-300x148.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/05/chromatic-link-published-storybook.png" decoding="async" loading="lazy" class="aligncenter wp-image-110933 size-full" src="../Images/1f8be3bf5a8f57c0a648d91858a73de6.png" alt="Chromatic Link Published Storybook" srcset="https://blog.logrocket.com/wp-content/uploads/2022/05/chromatic-link-published-storybook.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/05/chromatic-link-published-storybook-300x148.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/05/chromatic-link-published-storybook.png"/></noscript>
<h2 id="catching-ui-changes">捕捉用户界面更改</h2>
<p>每次我们运行Chromatic时，它都会生成新的快照，并将它们与现有的基线进行比较，这对于检测UI更改和防止潜在的UI退化是非常理想的:</p>
<p><img data-attachment-id="110931" data-permalink="https://blog.logrocket.com/run-chromatic-detect-ui-changes/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/05/run-chromatic-detect-ui-changes.png" data-orig-size="730,359" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="run-chromatic-detect-ui-changes" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/05/run-chromatic-detect-ui-changes-300x148.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/05/run-chromatic-detect-ui-changes.png" decoding="async" class="aligncenter wp-image-110931 size-full jetpack-lazy-image" src="../Images/720420872c1257aa6ef82b0de854375f.png" alt="Run chromatic Detect UI Changes" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/05/run-chromatic-detect-ui-changes.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/05/run-chromatic-detect-ui-changes-300x148.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/05/run-chromatic-detect-ui-changes.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/05/run-chromatic-detect-ui-changes.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="110931" data-permalink="https://blog.logrocket.com/run-chromatic-detect-ui-changes/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/05/run-chromatic-detect-ui-changes.png" data-orig-size="730,359" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="run-chromatic-detect-ui-changes" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/05/run-chromatic-detect-ui-changes-300x148.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/05/run-chromatic-detect-ui-changes.png" decoding="async" loading="lazy" class="aligncenter wp-image-110931 size-full" src="../Images/720420872c1257aa6ef82b0de854375f.png" alt="Run chromatic Detect UI Changes" srcset="https://blog.logrocket.com/wp-content/uploads/2022/05/run-chromatic-detect-ui-changes.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/05/run-chromatic-detect-ui-changes-300x148.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/05/run-chromatic-detect-ui-changes.png"/></noscript>
<p>如果变更是有意的，接受它们作为基线。否则，拒绝它们以防止UI退化。</p>
<h2 id="interaction-testing">交互测试</h2>
<p>故事书允许我们用交互测试来验证用户界面的功能。随着我们构建更复杂的UI，比如页面，组件变得不仅仅负责呈现UI。它们还获取数据并管理状态。</p>
<h2 id="set-up-interactions-add-on">设置互动插件</h2>
<p>我们可以使用<code>play</code>函数和<code><a href="https://storybook.js.org/addons/@storybook/addon-interactions/">@storybook/addon-interactions</a></code>在Storybook中设置交互测试。</p>
<p><code>play</code>函数是一小段代码，在故事渲染完成后运行。我们可以使用<code>play</code>函数来测试用户工作流。</p>
<p>Storybook会自动安装和配置<code>@storybook/addon-interactions</code>附加组件。它包括辅助工具和一个回放界面，模拟用户在浏览器中的行为。</p>
<p>更新<code>Button.stories.jsx</code>文件，用<code>play</code>函数在Storybook中设置交互测试:</p>
<pre class="language-javascript">import React from "react";
import { Button } from "../components/Button";

export default {
  title: "Components/Button",
  component: Button,
  argTypes: {
    backgroundColor: { control: "color" },
    onClick: { action: "clicked" },
  },
};
const Template = (args) =&gt; &lt;Button {...args} /&gt;;
export const Primary = Template.bind({});

+ Primary.play = async ({ args, canvasElement }) =&gt; {
+  const canvas = within(canvasElement);
+  await userEvent.click(canvas.getByRole("button"));
+  await expect(args.onClick).toHaveBeenCalled();
+ };

Primary.args = {
  label: "Button",
};
</pre>
<p>一旦故事加载到UI中，它就模拟了组件的行为。</p>
<p><img data-attachment-id="110929" data-permalink="https://blog.logrocket.com/story-stimulate-component-behavior/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/05/story-stimulate-component-behavior.png" data-orig-size="730,354" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="story-stimulate-component-behavior" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/05/story-stimulate-component-behavior-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/05/story-stimulate-component-behavior.png" decoding="async" class="aligncenter wp-image-110929 size-full jetpack-lazy-image" src="../Images/83134dab04b60633330ce5acb780d94c.png" alt="Story Stimulate Component Behavior" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/05/story-stimulate-component-behavior.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/05/story-stimulate-component-behavior-300x145.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/05/story-stimulate-component-behavior.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/05/story-stimulate-component-behavior.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="110929" data-permalink="https://blog.logrocket.com/story-stimulate-component-behavior/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/05/story-stimulate-component-behavior.png" data-orig-size="730,354" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="story-stimulate-component-behavior" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/05/story-stimulate-component-behavior-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/05/story-stimulate-component-behavior.png" decoding="async" loading="lazy" class="aligncenter wp-image-110929 size-full" src="../Images/83134dab04b60633330ce5acb780d94c.png" alt="Story Stimulate Component Behavior" srcset="https://blog.logrocket.com/wp-content/uploads/2022/05/story-stimulate-component-behavior.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/05/story-stimulate-component-behavior-300x145.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/05/story-stimulate-component-behavior.png"/></noscript>
<h2 id="conclusion">结论</h2>
<p>Storybook提供了一个测试UI组件的好方法。似乎我们正在抛弃单元测试，但事实并非如此。单元测试旨在找出代码中的错误；在这种情况下，我们测试React组件。如果我们的UI出了问题，我们仍然会调查我们必须修复的标记，这意味着集成和快照测试在这种情况下与单元测试一样好。</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用LogRocket消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款React analytics解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket告诉您React应用程序中实际影响用户的最具影响力的bug和UX问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS异常、前端性能指标和用户交互。然后，LogRocket使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试LogRocket】。</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>