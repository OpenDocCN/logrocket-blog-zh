<html>
<head>
<title>Data visualization in Angular using D3.js - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用D3.js - LogRocket Blog在Angular中实现数据可视化</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/data-visualization-angular-d3-js/#0001-01-01">https://blog.logrocket.com/data-visualization-angular-d3-js/#0001-01-01</a></blockquote><div><article class="article-post">
<p><em> <strong>编者按</strong>:这个Angular和D3.js教程最后一次更新是在2022年11月22日，修复了代码中的错误，并包含了一个关于如何在一个页面上加载多个组件的部分。关于用D3进行数据可视化的更多文章，请查看这些文章:“<a href="https://blog.logrocket.com/creating-visualizations-d3-typescript/">用D3和TypeScript创建可视化</a>”和“<a href="https://blog.logrocket.com/data-visualization-vue-js-d3/">用Vue.js和D3进行数据可视化</a>”</em></p>
<p>随着越来越多的组织关注收集和分析数据，产品团队面临的挑战之一是以一种有用的方式呈现数据。虽然许多软件开发人员默认使用列表和表格视图，但这些表示格式往往会让用户不知所措。</p>
<p>数据可视化通过以图形格式描绘数据，帮助您更好地传达数据的含义。这通常意味着条形图、散点图或饼图。因为web上的大多数数据可视化都是在前端生成的，所以JavaScript是数据可视化库的首选语言。</p>
<p>在可用的库中，<a href="https://d3js.org/"> D3.js </a>是最受欢迎的库之一。它允许您通过基于动态数据操作DOM来创建数据可视化。D3是反应式的，这意味着它不是在服务器上生成静态图像并提供给客户端，而是使用JavaScript将HTML元素“绘制”到您的网页上。这使得D3功能强大，但也比其他一些图表库更难使用。</p>
<p><a href="https://angular.io/"> Angular </a>由Google维护，是最流行的开源前端web框架之一。在本教程中，您将看到如何使用D3将数据可视化添加到Angular应用程序中。您将设置Angular和D3，添加三种常见的图表类型，重构图表组件以使其更加可重用，并从第三方API或本地CSV文件导入数据。最后，您应该有了使用D3和Angular创建自己的数据可视化的起点。</p>
<p>向前跳:</p>

<h2 id="setting-up-angular-d3">设置角度和D3</h2>
<p>Angular使用命令行界面来帮助您生成新的应用程序和组件。Angular CLI <a href="https://blog.logrocket.com/6-useful-features-in-angular-cli-eb502bd95874/">提供了丰富的特性集</a>，使开发人员的生活更加轻松。你只需要安装<a href="https://nodejs.org/en/"> Node.js </a>和<a href="https://www.npmjs.com/"> npm </a>就可以继续了。如果你是使用Angular的新手，你可以阅读<a href="https://angular.io/guide/setup-local">本地安装指南</a>以了解更多关于这个过程的信息，或者如果你想跳过这个演练并下载最终的应用程序，你可以<a href="https://github.com/sunnyy02/angular_d3">从GitHub </a>获得代码。如果你想经历整个过程，请继续阅读！</p>
<p>首先，安装<a href="https://cli.angular.io/">角度指示器</a>。命令行工具提供了一种快速启动新角度项目的方法:</p>
<pre>npm install -g @angular/cli
</pre>
<p>接下来，创建一个新的Angular应用程序。你可以随便叫它什么，但我会用这个名字:</p>
<pre>ng new angular-d3
</pre>
<p>最后，导航到新项目:</p>
<pre>cd angular-d3/
</pre>
<p>接下来，从npm安装<a href="https://www.npmjs.com/package/d3"> D3 </a>和<a href="https://www.npmjs.com/package/@types/d3"> D3类型定义</a>。类型定义将允许TypeScript对外部D3代码应用类型提示:</p>
<pre>npm install d3 &amp;&amp; npm install @types/d3 --save-dev
</pre>
<p>接下来，使用Angular CLI创建三个新组件。在接下来的步骤中，您将使用D3在每个页面中生成数据可视化。</p>
<p>首先，<code>bar</code>组件:</p>
<pre>ng g component bar
</pre>
<p>接下来，<code>pie</code>组件:</p>
<pre>ng g component pie
</pre>
<p>和<code>scatter</code>组件:</p>
<pre>ng g component scatter
</pre>
<p>这些组件现在在<code>src/app/</code>目录中可用，Angular将它们添加到了您的<code>app.module.ts</code>文件中，但是您仍然需要使用它们的选择器来插入组件。打开你的<code>src/app/app.component.html</code>文件，用下面的内容替换它:</p>
<pre>&lt;header&gt;
  &lt;h1&gt;Angular + D3&lt;/h1&gt;
&lt;/header&gt;
&lt;app-bar&gt;&lt;/app-bar&gt;
&lt;app-pie&gt;&lt;/app-pie&gt;
&lt;app-scatter&gt;&lt;/app-scatter&gt;
</pre>
<p>最后，你可以将<a href="https://newcss.net/"> new.css </a>添加到你的<code>&lt;head&gt;</code>中，让网站看起来更漂亮一点。打开<code>src/index.html</code>文件，在<code>&lt;head&gt;&lt;/head&gt;</code>标签之间添加以下几行:</p>
<pre>&lt;link rel="stylesheet" href="https://fonts.xz.style/serve/inter.css"&gt;
&lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@exampledev/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="2f414a58014c5c5c6f1e011e011d">[email protected]</a>/new.min.css"&gt;
</pre>
<p>您已经准备好测试它了。从您的终端运行<code>ng serve --open</code>。您的浏览器应该会打开<code><a href="http://localhost:4200" rel="nofollow">http://localhost:4200</a></code>，您会看到类似这样的内容:</p>
<p><img data-attachment-id="145363" data-permalink="https://blog.logrocket.com/data-visualization-angular-d3-js/attachment/new-angular-app-using-d3-js/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/new-angular-app-using-d3-js.png" data-orig-size="730,272" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="New Angular App Using D3.js" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/new-angular-app-using-d3-js-300x112.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/new-angular-app-using-d3-js.png" decoding="async" class="aligncenter size-full wp-image-145363 jetpack-lazy-image" src="../Images/e7b1d411f886f31d9e5c69cc8b664372.png" alt="New Angular App Using D3.js" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/new-angular-app-using-d3-js.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/07/new-angular-app-using-d3-js-300x112.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/new-angular-app-using-d3-js.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/new-angular-app-using-d3-js.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="145363" data-permalink="https://blog.logrocket.com/data-visualization-angular-d3-js/attachment/new-angular-app-using-d3-js/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/new-angular-app-using-d3-js.png" data-orig-size="730,272" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="New Angular App Using D3.js" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/new-angular-app-using-d3-js-300x112.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/new-angular-app-using-d3-js.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-145363" src="../Images/e7b1d411f886f31d9e5c69cc8b664372.png" alt="New Angular App Using D3.js" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/new-angular-app-using-d3-js.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/07/new-angular-app-using-d3-js-300x112.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/new-angular-app-using-d3-js.png"/></noscript>
<p>现在你的Angular应用程序已经准备好了，让我们添加三个图表:条形图、饼图和散点图。</p>
<h2 id="creating-bar-chart">创建条形图</h2>
<p>您将添加的第一个数据可视化是条形图。条形图通常用于显示不同类别数据的相对值。我们将使用的数据是每个流行的前端web开发框架的星级数:</p>
<pre>[
    {"Framework": "Vue", "Stars": "166443", "Released": "2014"},
    {"Framework": "React", "Stars": "150793", "Released": "2013"},
    {"Framework": "Angular", "Stars": "62342", "Released": "2016"},
    {"Framework": "Backbone", "Stars": "27647", "Released": "2010"},
    {"Framework": "Ember", "Stars": "21471", "Released": "2011"}
]
</pre>
<p>Angular组件通常由四个文件组成:HTML模板文件、CSS或SCSS样式表、规范(测试)文件和类型脚本组件文件。打开模板文件(<code>bar.component.html</code>)，添加以下标题和图形:</p>
<pre>&lt;h2&gt;Bar Chart&lt;/h2&gt;
&lt;figure id="bar"&gt;&lt;/figure&gt;
</pre>
<p>您将使用D3通过CSS选择器在图中添加图表。接下来，打开TypeScript组件文件(<code>bar.component.ts</code>)并添加以下属性:</p>
<pre>import { Component, OnInit } from '@angular/core';
import * as d3 from 'd3';

export class BarComponent implements OnInit {
  private data = [
    {"Framework": "Vue", "Stars": "166443", "Released": "2014"},
    {"Framework": "React", "Stars": "150793", "Released": "2013"},
    {"Framework": "Angular", "Stars": "62342", "Released": "2016"},
    {"Framework": "Backbone", "Stars": "27647", "Released": "2010"},
    {"Framework": "Ember", "Stars": "21471", "Released": "2011"},
  ];
  private svg: any;
  private margin = 50;
  private width = 750 - (this.margin * 2);
  private height = 400 - (this.margin * 2);
...
</pre>
<p>首先，我们将<code>d3</code>包导入到这个组件中，这样以后就可以引用它了。第一个私有属性<code>data</code>硬编码了生成图表所需的数据。稍后您将看到如何使用来自文件或API的数据，但这将让您开始。</p>
<p>在类中将使用<code>svg</code>属性来存储D3绘制到DOM上的SVG图像。其他属性设置图表的高度、宽度和边距。虽然可以用D3 创建<a href="https://medium.com/@louisemoxy/a-simple-way-to-make-d3-js-charts-svgs-responsive-7afb04bc2e4b">响应式图表，但我不会在本教程中探究它们。</a></p>
<p>接下来，在<code>BarComponent</code>中创建一个名为<code>createSvg()</code>的方法。这将选择DOM中的元素，并插入一个新的<a href="http://tutorials.jenkov.com/svg/g-element.html"> SVG和一个</a> <code>[&lt;g&gt;](<a href="http://tutorials.jenkov.com/svg/g-element.html" rel="nofollow">http://tutorials.jenkov.com/svg/g-element.html</a>)</code> <a href="http://tutorials.jenkov.com/svg/g-element.html">元素</a>:</p>
<pre>private createSvg(): void {
    this.svg = d3.select("figure#bar")
    .append("svg")
    .attr("width", this.width + (this.margin * 2))
    .attr("height", this.height + (this.margin * 2))
    .append("g")
    .attr("transform", "translate(" + this.margin + "," + this.margin + ")");
}
</pre>
<p>现在创建一个名为<code>drawBars()</code>的方法，该方法将使用<code>svg</code>属性添加条形:</p>
<pre>private drawBars(data: any[]): void {
  // Create the X-axis band scale
  const x = d3.scaleBand()
  .range([0, this.width])
  .domain(data.map(d =&gt; d.Framework))
  .padding(0.2);

  // Draw the X-axis on the DOM
  this.svg.append("g")
  .attr("transform", "translate(0," + this.height + ")")
  .call(d3.axisBottom(x))
  .selectAll("text")
  .attr("transform", "translate(-10,0)rotate(-45)")
  .style("text-anchor", "end");

  // Create the Y-axis band scale
  const y = d3.scaleLinear()
  .domain([0, 200000])
  .range([this.height, 0]);

  // Draw the Y-axis on the DOM
  this.svg.append("g")
  .call(d3.axisLeft(y));

  // Create and fill the bars
  this.svg.selectAll("bars")
  .data(data)
  .enter()
  .append("rect")
  .attr("x", (d: any) =&gt; x(d.Framework))
  .attr("y", (d: any) =&gt; y(d.Stars))
  .attr("width", x.bandwidth())
  .attr("height", (d: any) =&gt; this.height - y(d.Stars))
  .attr("fill", "#d04a35");
}
</pre>
<p>最后，在您的<code>BarComponent</code>的<code>ngOnInit()</code>方法中调用这两个方法:</p>
<pre>ngOnInit(): void {
    this.createSvg();
    this.drawBars(this.data);
}
</pre>
<p>如果您在上一步中停止了Angular服务器，重启它(<code>ng serve</code>)并在浏览器中访问<code>localhost:4200</code>。您应该会看到新的条形图:</p>
<p><img data-attachment-id="145365" data-permalink="https://blog.logrocket.com/data-visualization-angular-d3-js/attachment/d3-bar-chart-angular-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-bar-chart-angular-1.png" data-orig-size="730,436" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A D3 Bar Chart In Angular" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-bar-chart-angular-1-300x179.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-bar-chart-angular-1.png" decoding="async" class="aligncenter size-full wp-image-145365 jetpack-lazy-image" src="../Images/ee945f8026a64a5aaa3f856846200a7b.png" alt="A D3 Bar Chart In Angular" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-bar-chart-angular-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/07/d3-bar-chart-angular-1-300x179.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-bar-chart-angular-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-bar-chart-angular-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="145365" data-permalink="https://blog.logrocket.com/data-visualization-angular-d3-js/attachment/d3-bar-chart-angular-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-bar-chart-angular-1.png" data-orig-size="730,436" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A D3 Bar Chart In Angular" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-bar-chart-angular-1-300x179.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-bar-chart-angular-1.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-145365" src="../Images/ee945f8026a64a5aaa3f856846200a7b.png" alt="A D3 Bar Chart In Angular" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-bar-chart-angular-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/07/d3-bar-chart-angular-1-300x179.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-bar-chart-angular-1.png"/></noscript>
<h2 id="creating-pie-chart">创建饼图</h2>
<p>饼图是显示不同数据的相对值的好方法。在这种情况下，您将使用它来可视化基于GitHub stars的不同前端框架的市场份额。</p>
<p>第一步是用新的图形和标题更新组件的HTML文件(<code>pie.component.html</code>):</p>
<pre>&lt;h2&gt;Pie Chart&lt;/h2&gt;
&lt;figure id="pie"&gt;&lt;/figure&gt;
</pre>
<p>因为这个图表使用与条形图相同的数据集，所以组件的类看起来很相似。用您的数据和以下私有属性更新<code>pie.component.ts</code>文件:</p>
<pre>import { Component, OnInit } from '@angular/core';
import * as d3 from 'd3';
export class PieComponent implements OnInit {
  private data = [
    {"Framework": "Vue", "Stars": "166443", "Released": "2014"},
    {"Framework": "React", "Stars": "150793", "Released": "2013"},
    {"Framework": "Angular", "Stars": "62342", "Released": "2016"},
    {"Framework": "Backbone", "Stars": "27647", "Released": "2010"},
    {"Framework": "Ember", "Stars": "21471", "Released": "2011"},
  ];
  private svg: any;
  private margin = 50;
  private width = 750;
  private height = 600;
  // The radius of the pie chart is half the smallest side
  private radius = Math.min(this.width, this.height) / 2 - this.margin;
  private colors;
...
</pre>
<p>这里最大的不同是添加了<code>radius</code>和<code>colors</code>属性。因为饼图使用圆形而不是矩形来显示数据，所以<code>radius</code>属性确保图表符合定义的图形边界。在接下来的步骤中，您将使用<code>colors</code>属性来定义饼图的颜色。</p>
<p>接下来，创建一个名为<code>createSvg</code>的私有方法。这将选择DOM上的<code>figure</code>元素并添加<code>&lt;g&gt;</code>元素，D3将在这里绘制您的饼图:</p>
<pre>private createSvg(): void {
    this.svg = d3.select("figure#pie")
    .append("svg")
    .attr("width", this.width)
    .attr("height", this.height)
    .append("g")
    .attr(
      "transform",
      "translate(" + this.width / 2 + "," + this.height / 2 + ")"
    );
}
</pre>
<p>在这个饼图中，您将使用一个<a href="http://using-d3js.com/04_07_ordinal_scales.html">序数刻度</a>为图表的每个部分创建一个离散的颜色。你可以将每种颜色定义为框架的主色，但我认为单色方案看起来更好:</p>
<pre>private createColors(): void {
    this.colors = d3.scaleOrdinal()
    .domain(this.data.map(d =&gt; d.Stars.toString()))
    .range(["#c7d3ec", "#a5b8db", "#879cc4", "#677795", "#5a6782"]);
}
</pre>
<p>创建一个绘制图表和添加标签的方法。该方法使用<code>&lt;path&gt;</code>元素为每个框架创建弧线，并用上述<code>createColors</code>方法中定义的颜色填充它们:</p>
<pre>private drawChart(): void {
  // Compute the position of each group on the pie:
  const pie = d3.pie&lt;any&gt;().value((d: any) =&gt; Number(d.Stars));

  // Build the pie chart
  this.svg
  .selectAll('pieces')
  .data(pie(this.data))
  .enter()
  .append('path')
  .attr('d', d3.arc()
    .innerRadius(0)
    .outerRadius(this.radius)
  )
  .attr('fill', (d: any, i: any) =&gt; (this.colors(i)))
  .attr("stroke", "#121926")
  .style("stroke-width", "1px");

  // Add labels
  const labelLocation = d3.arc()
  .innerRadius(100)
  .outerRadius(this.radius);

  this.svg
  .selectAll('pieces')
  .data(pie(this.data))
  .enter()
  .append('text')
  .text((d: any)=&gt; d.data.Framework)
  .attr("transform", (d: any) =&gt; "translate(" + labelLocation.centroid(d) + ")")
  .style("text-anchor", "middle")
  .style("font-size", 15);
}
</pre>
<p>D3的<a href="https://www.d3indepth.com/shapes/#centroid"> <code>centroid</code> </a> <a href="https://www.d3indepth.com/shapes/#centroid">函数</a>允许你将标签放入饼图每一片的计算质心。在这种情况下，通过设置<code>innerRadius(100)</code>，标签将稍微偏离真正的质心。您可以调整这些数字，将它们重新放置在您认为最佳的位置。</p>
<p>最后，在<code>ngOnInit()</code>方法中调用所有这三个方法:</p>
<pre>ngOnInit(): void {
    this.createSvg();
    this.createColors();
    this.drawChart();
}
</pre>
<p>回到您的浏览器，查看Angular应用程序中的新饼图:</p>
<p><img data-attachment-id="145373" data-permalink="https://blog.logrocket.com/data-visualization-angular-d3-js/attachment/d3-pie-chart-angular-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-pie-chart-angular-1.png" data-orig-size="730,552" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A D3 Pie Chart In Angular" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-pie-chart-angular-1-300x227.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-pie-chart-angular-1.png" decoding="async" class="aligncenter size-full wp-image-145373 jetpack-lazy-image" src="../Images/a7f1d57f193509f3723c08c61d56b689.png" alt="A D3 Pie Chart In Angular" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-pie-chart-angular-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/07/d3-pie-chart-angular-1-300x227.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-pie-chart-angular-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-pie-chart-angular-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="145373" data-permalink="https://blog.logrocket.com/data-visualization-angular-d3-js/attachment/d3-pie-chart-angular-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-pie-chart-angular-1.png" data-orig-size="730,552" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A D3 Pie Chart In Angular" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-pie-chart-angular-1-300x227.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-pie-chart-angular-1.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-145373" src="../Images/a7f1d57f193509f3723c08c61d56b689.png" alt="A D3 Pie Chart In Angular" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-pie-chart-angular-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/07/d3-pie-chart-angular-1-300x227.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-pie-chart-angular-1.png"/></noscript>
<h2 id="creating-scatter-plot">创建散点图</h2>
<p>在本教程中，您将创建的最后一种数据可视化是散点图。<a href="https://www.mathsisfun.com/data/scatter-xy-plots.html">散点图</a>让我们能够显示图表中每个点的两条数据之间的关系。在这种情况下，您将查看每个框架发布的年份和它当前拥有的星级数之间的关系。</p>
<p>首先，以与上面相同的方式更新HTML模板文件(<code>scatter.component.html</code>):</p>
<pre>&lt;h2&gt;Scatter Plot&lt;/h2&gt;
&lt;figure id="scatter"&gt;&lt;/figure&gt;
</pre>
<p>因为此散点图使用相同的数据和图形大小，所以它从与条形图相同的属性开始:</p>
<pre>import { Component, OnInit } from '@angular/core';
import * as d3 from 'd3';
export class ScatterComponent implements OnInit {
  private data = [
    {"Framework": "Vue", "Stars": "166443", "Released": "2014"},
    {"Framework": "React", "Stars": "150793", "Released": "2013"},
    {"Framework": "Angular", "Stars": "62342", "Released": "2016"},
    {"Framework": "Backbone", "Stars": "27647", "Released": "2010"},
    {"Framework": "Ember", "Stars": "21471", "Released": "2011"},
  ];
  private svg;
  private margin = 50;
  private width = 750 - (this.margin * 2);
  private height = 400 - (this.margin * 2);
...
</pre>
<p>事实上，<code>createSvg</code>方法也和条形图一样:</p>
<pre>private createSvg(): void {
    this.svg = d3.select("figure#scatter")
    .append("svg")
    .attr("width", this.width + (this.margin * 2))
    .attr("height", this.height + (this.margin * 2))
    .append("g")
    .attr("transform", "translate(" + this.margin + "," + this.margin + ")");
}
</pre>
<p>如果您的应用程序有许多使用相似属性的条形图和散点图，您可能想要尝试使用继承来减少重复代码的数量。</p>
<p>接下来，创建一个新的<code>drawPlot()</code>方法来创建绘图的x轴和y轴，并将点添加到画布上。此方法使点半透明，并添加每个框架的名称作为标签:</p>
<pre>private drawPlot(): void {
    // Add X axis
    const x = d3.scaleLinear()
    .domain([2009, 2017])
    .range([ 0, this.width ]);
    this.svg.append("g")
    .attr("transform", "translate(0," + this.height + ")")
    .call(d3.axisBottom(x).tickFormat(d3.format("d")));

    // Add Y axis
    const y = d3.scaleLinear()
    .domain([0, 200000])
    .range([ this.height, 0]);
    this.svg.append("g")
    .call(d3.axisLeft(y));

    // Add dots
    const dots = this.svg.append('g');
    dots.selectAll("dot")
    .data(this.data)
    .enter()
    .append("circle")
    .attr("cx", (d: any) =&gt; x(d.Released))
    .attr("cy",  (d: any) =&gt; y(d.Stars))
    .attr("r", 7)
    .style("opacity", .5)
    .style("fill", "#69b3a2");

    // Add labels
    dots.selectAll("text")
    .data(this.data)
    .enter()
    .append("text")
    .text( (d: any) =&gt; d.Framework)
    .attr("x", (d: any) =&gt; x(d.Released))
    .attr("y", (d: any)  =&gt; y(d.Stars))
}
</pre>
<p>散点图中的另一个重要区别是，您的x轴使用日期而不是字符串(就像您在条形图中所做的那样)，因此您必须调用<code>.tickFormat(d3.format("d"))</code>来正确格式化它们。</p>
<p>最后，从您的<code>ngOnInit()</code>方法中调用这两个方法:</p>
<pre>ngOnInit(): void {
    this.createSvg();
    this.drawPlot();
}
</pre>
<p>回到您的浏览器，查看在您的Angular应用程序中渲染的最终图形:</p>
<p><img data-attachment-id="145379" data-permalink="https://blog.logrocket.com/data-visualization-angular-d3-js/attachment/d3-scatter-plot-angular-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-scatter-plot-angular-1.png" data-orig-size="730,425" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="D3 Scatter Plot In Angular" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-scatter-plot-angular-1-300x175.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-scatter-plot-angular-1.png" decoding="async" class="aligncenter size-full wp-image-145379 jetpack-lazy-image" src="../Images/1fdd43f6883b0e6e4fc0a62da8739057.png" alt="D3 Scatter Plot In Angular" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-scatter-plot-angular-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/07/d3-scatter-plot-angular-1-300x175.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-scatter-plot-angular-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-scatter-plot-angular-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="145379" data-permalink="https://blog.logrocket.com/data-visualization-angular-d3-js/attachment/d3-scatter-plot-angular-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-scatter-plot-angular-1.png" data-orig-size="730,425" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="D3 Scatter Plot In Angular" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-scatter-plot-angular-1-300x175.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-scatter-plot-angular-1.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-145379" src="../Images/1fdd43f6883b0e6e4fc0a62da8739057.png" alt="D3 Scatter Plot In Angular" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-scatter-plot-angular-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/07/d3-scatter-plot-angular-1-300x175.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/d3-scatter-plot-angular-1.png"/></noscript>
<h2 id="load-multiple-components-page">在一个页面上加载多个组件</h2>
<p>在前面的示例中，条形图/饼图/散点图组件保存源数据，并根据这些数据绘制图表。如果我们想在同一个页面上显示具有不同数据源的多个组件，那么我们必须复制这些组件。在Angular中，<a href="https://blog.logrocket.com/inject-dynamic-content-angular-components-with-portals/">最佳实践</a>是将这些组件构建为一个哑组件，因此它只关注基于注入数据的图表。</p>
<p>让我们重构条形图组件，使其更具可重用性。</p>
<p>首先，让我们创建一个新版本的<code>BarComponent</code>:</p>
<pre>ng g component bar2
</pre>
<p>上面的命令将在<code>src/app/</code>目录中为新的<code>Bar2Component</code>创建框架文件。在构建组件之前，我们需要为图表数据创建以下接口:</p>
<pre>export interface LineData {
    label: string;
    value: number;
}
export interface ChartData {
    yrange: number,
    lineData: LineData[]
}
</pre>
<p><code>ChartData</code>接口定义了由<code>Bar2Component</code>使用的数据的形状。打开App.component.ts文件，添加<code>chartData_2D_1</code>变量，这样我们就可以将数据从<code>Bar2Component</code>中分离出来:</p>
<pre>  chartData_2D_1: ChartData = {
    yrange: 200000,
    lineData: [
      { label: 'Vue', value: 166443 },
      { label: 'React', value: 150793 },
      { label: 'Angular', value: 62342 },
      { label: 'Backbone', value: 27647 },
      { label: 'Ember', value: 21471 },
    ],
  };
</pre>
<p>现在，我们可以将以下<code>Input</code>属性和其他私有属性添加到<code>Bar2Component</code>中:</p>
<pre>import * as d3 from 'd3';
import { ChartData, LineData } from '../chartData';
...
export class Bar2Component implements AfterViewInit {
  @Input()
  chartName:string = 'bar';
  @Input()
  data: ChartData = {} as ChartData;

  private svg: any;
  private margin = 50;
  private width = 750 - this.margin * 2;
  private height = 400 - this.margin * 2;
</pre>
<p>引入了两个<code>Input</code>属性:</p>
<ul>
<li><code>chartName</code>:定义组件的唯一名称。它被绑定到图元素的<code>Id</code>，并且<code>d3</code>可以使用它来获得对HTML元素的引用</li>
<li><code>data</code>:组件的源数据。</li>
</ul>
<p>与前面的<code>BarComponent</code>类似，下面我们创建一个<code>createSvg</code>方法。但是我们在<code>select</code>方法中使用了一个动态选择器:</p>
<pre>private createSvg(): void {
    this.svg = d3
      .select(`figure#${this.chartName}`)
      .append('svg')
      .attr('width', this.width + this.margin * 2)
      .attr('height', this.height + this.margin * 2)
      .append('g')
      .attr('transform', 'translate(' + this.margin + ',' + this.margin + ')');
  }
</pre>
<p>然后我们可以创建<code>drawBars</code>方法。同样，它类似于BarComponent中的<code>drawBars</code>方法。与前面的方法相比，我们使用<code>label</code>和<code>value</code>属性来代替<code>Framework</code>和<code>Stars</code>属性。新创建的<code>ChartData</code>和<code>LineData</code>接口也应用在方法中，因此我们可以获得编辑器智能支持和强类型:</p>
<pre>private drawBars(data: ChartData): void {
    // Create the X-axis band scale
    const x = d3
      .scaleBand()
      .range([0, this.width])
      .domain(data.lineData.map((d: LineData) =&gt; d.label))
      .padding(0.2);

    // Draw the X-axis on the DOM
    this.svg
      .append('g')
      .attr('transform', 'translate(0,' + this.height + ')')
      .call(d3.axisBottom(x))
      .selectAll('text')
      .attr('transform', 'translate(-10,0)rotate(-45)')
      .style('text-anchor', 'end');

    // Create the Y-axis band scale
    const y = d3.scaleLinear().domain([0, data.yrange]).range([this.height, 0]);

    // Draw the Y-axis on the DOM
    this.svg.append('g').call(d3.axisLeft(y));

    // Create and fill the bars
    this.svg
      .selectAll('bars')
      .data(data.lineData)
      .enter()
      .append('rect')
      .attr('x', (d: LineData) =&gt; x(d.label))
      .attr('y', (d: LineData) =&gt; y(d.value))
      .attr('width', x.bandwidth())
      .attr('height', (d: any) =&gt; this.height - y(d.value))
      .attr('fill', '#d04a35');
  }
</pre>
<p>现在，我们可以创建<code>ngAfterViewInit</code>方法并调用上面的方法:</p>
<pre>  ngAfterViewInit(): void {
    this.createSvg();
    this.drawBars(this.data);
  }
</pre>
<p>请注意，我们使用了<code>AfterViewInit</code> <a href="https://blog.logrocket.com/angular-lifecycle-hooks/">生命周期钩子</a>而不是<code>OnInit</code>，因为我们希望确保在视图呈现后调用该方法。</p>
<p>最后，让我通过将以下内容添加到HTML模板文件(<code>bar2.component.html</code>)来完成<code>Bar2Component</code>:</p>
<pre>&lt;h2&gt;Bar Chart&lt;/h2&gt;
&lt;figure id="{{chartName}}"&gt;&lt;/figure&gt;
</pre>
<p><code>Bar2Component</code>准备好了！</p>
<p>如果将以下内容添加到App.Component.html，并启动角度开发服务器(<code>ng serve</code>或<code>npm run start</code>)，将显示条形图:</p>
<pre> &lt;app-bar2 chartName="barA" [data]="chartData_2D_1"&gt;&lt;/app-bar2&gt;
</pre>
<p>使用新组件，您可以向同一页面添加多个实例，并分配不同的名称和源数据。在Git  <a href="https://github.com/sunnyy02/angular_d3"> H </a> <a href="https://github.com/sunnyy02/angular_d3"> ub </a>中提供的<a href="https://github.com/sunnyy02/angular_d3">示例代码中，我添加了两个<code>Bar2Component</code>的实例供大家参考。在示例项目中，您还可以找到新版本的饼图组件和散点图组件。</a></p>
<h2 id="loading-data-external-sources">从外部源加载数据</h2>
<p>到目前为止，您已经将数据硬编码到角度组件中，但这可能不现实。有几种方法可以从外部数据源加载数据，所以让我们看看在D3中最常用的两种模式。</p>
<h3 id="loading-csv-file">加载CSV文件</h3>
<p>大多数电子表格可以导出为<a href="https://en.wikipedia.org/wiki/Comma-separated_values"> CSV文件</a>。CSV是一种基于文本的数据存储格式，它使用逗号和换行符来分隔文件中的值。因为CSV是一种如此常见的数据格式，D3为加载公开可用的CSV文件提供了本机支持。</p>
<p>为了演示如何使用CSV文件，在Angular应用程序的<code>src/assets/</code>目录中创建一个名为<code>frameworks.csv</code>的新文件。将以下文本添加到文件中:</p>
<pre>Framework,Stars,Released
Vue,166443,2014
React,150793,2013
Angular,62342,2016
Backbone,27647,2010
Ember,21471,2011
</pre>
<p>接下来，打开条形图组件(<code>bar.component.ts</code>)并更新<code>ngOnInit()</code>方法以调用D3的<code>csv()</code>方法:</p>
<pre>ngOnInit(): void {
    this.createSvg();
    // Parse data from a CSV
    d3.csv("/assets/frameworks.csv").then(data =&gt; this.drawBars(data));
}
</pre>
<p>D3可以从您的Angular应用程序或第三方URL加载CSV，并使数据作为结果promise中的一个对象数组可用。如果你回到浏览器，你会看到和以前一样的条形图，但是这次它使用的是来自<code>frameworks.csv</code>文件的数据，而不是角度分量。</p>
<h3 id="getting-data-json-api">从JSON API获取数据</h3>
<p>web APIs中使用的另一种常见数据格式是<a href="https://www.json.org/json-en.html"> JSON </a>。JSON是JavaScript对象的字符串表示，通常由<a href="https://blog.logrocket.com/making-rest-more-human-with-graphql/"> REST和graph QL API</a>返回。D3本身支持JSON数据，因此它使得与Angular应用程序的集成变得非常容易。</p>
<p>首先，您需要一个JSON API端点或文件。我将本教程通篇使用的框架数据上传到了免费的JSON文件托管平台<a href="https://jsonbin.io/"> JSONbin </a>。你可以<a href="https://api.jsonbin.io/b/5eee6a5397cb753b4d149343">在这里</a>访问这些数据。</p>
<p>要使用这个端点，再次打开<code>bar.component.ts</code>文件，用下面的代码更新<code>ngOnInit()</code>方法:</p>
<pre>ngOnInit(): void {
    this.createSvg();
    // Fetch JSON from an external endpoint
    type ChartDataType ={
      Framework: string,
      Stars: number,
      Released: number
    }
     d3.json('https://api.jsonbin.io/b/5eee6a5397cb753b4d149343').then(data=&gt; {
      const chartData = data as ChartDataType[];
      this.drawBars(chartData);
  });
}
</pre>
<p>正如在CSV示例中，D3的<code>json</code>方法返回一个承诺，将您的数据解析为一个对象数组。通过传递它，您的条形图现在可以使用JSON API端点作为它的数据源。<br/>请注意，我们创建了一个<code>ChartDataType</code>类型来进行类型断言，因为来自API的数据默认为<code>unknown</code>类型，如果没有类型断言，将会抛出一个错误。</p>
<h2 id="conclusion">结论</h2>
<p>当您需要在Angular应用程序中创建丰富的数据可视化时，D3是一个很好的选择。虽然可能需要一些时间来掌握，但D3非常强大，可以用来创建几乎任何您可以想象的数据可视化。它还使得从CSV或JSON APIs访问数据集变得非常容易。你可以在这里找到这个项目的<a href="https://github.com/sunnyy02/angular_d3"> GitHub库</a>。</p>
<p>如果你想了解更多定制条形图的方法，我建议你查看官方文档或<a href="https://www.d3-graph-gallery.com/index.html"> D3图片库</a>中的更多例子。</p><div class="code-block code-block-19">
<div class="blog-plug inline-plug angular-plug"><h2>像用户一样体验Angular应用程序</h2><p>调试Angular应用程序可能很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪生产中所有用户的角度状态和动作感兴趣，</p><a href="https://lp.logrocket.com/blg/angular-signup">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/angular-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/2794ac39244976f37c4941d9a910be23.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://files.readme.io/610d6a7-687474703a2f2f692e696d6775722e636f6d2f696147547837412e706e67.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/610d6a7-687474703a2f2f692e696d6775722e636f6d2f696147547837412e706e67.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/2794ac39244976f37c4941d9a910be23.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://files.readme.io/610d6a7-687474703a2f2f692e696d6775722e636f6d2f696147547837412e706e67.png"/></noscript></a><a href="https://lp.logrocket.com/blg/angular-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用程序的DVR，记录你网站上发生的一切，包括网络请求、JavaScript错误等等。您可以汇总并报告问题发生时应用程序的状态，而不是猜测问题发生的原因。</p><p>LogRocket NgRx插件将角度状态和动作记录到LogRocket控制台，为您提供导致错误的环境，以及出现问题时应用程序的状态。</p><p>现代化调试Angular应用的方式- <a class="signup" href="https://lp.logrocket.com/blg/angular-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>