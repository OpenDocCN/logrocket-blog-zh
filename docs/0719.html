<html>
<head>
<title>How to build a type-safe React Redux app - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何构建一个类型安全的React Redux应用程序</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/build-type-safe-react-redux-app/#0001-01-01">https://blog.logrocket.com/build-type-safe-react-redux-app/#0001-01-01</a></blockquote><div><article class="article-post">
<p><em> <strong>编者按</strong> </em> <em>:这篇文章更新于2021年12月8日，以反映Redux的更新并提高教程的整体清晰度。</em></p>
<p>向React应用程序添加类型检查功能可以帮助您在编译时捕获大量错误。在本教程中，我们将通过研究一个真实世界的例子来演示如何构建一个类型安全的React Redux应用程序。</p>
<p>为了说明这些概念，我们将创建一个示例电子商务应用程序，如下所示。</p>
<p><img data-attachment-id="85285" data-permalink="https://blog.logrocket.com/build-type-safe-react-redux-app/sample-ecommerce-app-1/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-1.png" data-orig-size="730,625" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sample-ecommerce-app-1" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-1-300x257.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-1.png" decoding="async" class="aligncenter size-full wp-image-85285 jetpack-lazy-image" src="../Images/51657829b9427da317b72c2d74519d25.png" alt="The first view of our sample ecommerce app" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-1-300x257.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="85285" data-permalink="https://blog.logrocket.com/build-type-safe-react-redux-app/sample-ecommerce-app-1/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-1.png" data-orig-size="730,625" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sample-ecommerce-app-1" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-1-300x257.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-1.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-85285" src="../Images/51657829b9427da317b72c2d74519d25.png" alt="The first view of our sample ecommerce app" srcset="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-1-300x257.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-1.png"/></noscript>
<p><img data-attachment-id="85287" data-permalink="https://blog.logrocket.com/build-type-safe-react-redux-app/sample-ecommerce-app-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-2.png" data-orig-size="730,384" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sample-ecommerce-app-2" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-2-300x158.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-2.png" decoding="async" class="aligncenter size-full wp-image-85287 jetpack-lazy-image" src="../Images/96005da92ccb452f5d274ce0acb22f16.png" alt="The second view of our sample ecommerce app" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-2.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-2-300x158.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-2.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="85287" data-permalink="https://blog.logrocket.com/build-type-safe-react-redux-app/sample-ecommerce-app-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-2.png" data-orig-size="730,384" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sample-ecommerce-app-2" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-2-300x158.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-2.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-85287" src="../Images/96005da92ccb452f5d274ce0acb22f16.png" alt="The second view of our sample ecommerce app" srcset="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-2.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-2-300x158.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-2.png"/></noscript>
<p><img data-attachment-id="85289" data-permalink="https://blog.logrocket.com/build-type-safe-react-redux-app/sample-ecommerce-app-3/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-3.gif" data-orig-size="730,457" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sample-ecommerce-app-3" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-3-300x188.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-3.gif" decoding="async" class="aligncenter size-full wp-image-85289 jetpack-lazy-image" src="../Images/a969455a92316d76783d6b946e438e2d.png" alt="The third view of our sample ecommerce app" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-3.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-3.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="85289" data-permalink="https://blog.logrocket.com/build-type-safe-react-redux-app/sample-ecommerce-app-3/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-3.gif" data-orig-size="730,457" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sample-ecommerce-app-3" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-3-300x188.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-3.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-85289" src="../Images/a969455a92316d76783d6b946e438e2d.png" alt="The third view of our sample ecommerce app" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/03/sample-ecommerce-app-3.gif"/></noscript>
<p>我们还将讨论以下几点:</p>

<p>事不宜迟，我们开始吧！</p>
<h2 id="building-type-safe-redux-app">构建类型安全的Redux应用程序</h2>
<p>React是一个组件库，我们用它来构建应用程序的现代前端。随着应用程序的扩展，管理数据变得越来越困难。</p>
<p>这就是<a href="https://redux.js.org/" target="_blank" rel="noopener"> Redux </a>的用武之地。Redux是一个状态管理库，在React生态系统中很流行。如果你不熟悉React Redux的概念，我建议在继续本教程之前阅读<a href="https://redux.js.org/basics/example/" target="_blank" rel="noopener">官方文档</a>。</p>
<p>让我们从构建一个电子商务应用程序工作流开始。这里，我们在线框图中有两个重要的域:库存和购物车。</p>
<p><img data-attachment-id="85295" data-permalink="https://blog.logrocket.com/build-type-safe-react-redux-app/inventory-cart-domains-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/03/inventory-cart-domains-1.png" data-orig-size="730,282" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="inventory-cart-domains" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/03/inventory-cart-domains-1-300x116.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/03/inventory-cart-domains-1.png" decoding="async" class="aligncenter size-full wp-image-85295 jetpack-lazy-image" src="../Images/25124895f672f6251027d86129c136da.png" alt="A diagram of our inventory and cart domains" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/03/inventory-cart-domains-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/03/inventory-cart-domains-1-300x116.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/03/inventory-cart-domains-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/03/inventory-cart-domains-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="85295" data-permalink="https://blog.logrocket.com/build-type-safe-react-redux-app/inventory-cart-domains-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/03/inventory-cart-domains-1.png" data-orig-size="730,282" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="inventory-cart-domains" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/03/inventory-cart-domains-1-300x116.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/03/inventory-cart-domains-1.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-85295" src="../Images/25124895f672f6251027d86129c136da.png" alt="A diagram of our inventory and cart domains" srcset="https://blog.logrocket.com/wp-content/uploads/2020/03/inventory-cart-domains-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/03/inventory-cart-domains-1-300x116.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/03/inventory-cart-domains-1.png"/></noscript>
<p>首先，我们将创建基本的Redux构建块——即动作创建器、缩减器和存储。如果您不熟悉这些构建块，Redux将应用程序的状态保存在一个名为store的全局JS对象中。在整个应用程序中，商店中进行的所有更改都是通过操作生成的，并通过reducers执行。你可以在<a href="https://redux.js.org/tutorials/fundamentals/part-3-state-actions-reducers" target="_blank" rel="noopener">官方文件</a>中了解更多信息。</p>
<p>因为我们知道应用领域，我们将基于它来构建我们的应用。使用以下命令创建一个React应用程序:</p>
<pre class="language-bash hljs">npx create-react-app react-redux-example --template typescript
</pre>
<p>这将创建一个带有类型脚本文件的React应用程序样板。接下来，安装React Redux及其类型的依赖项。</p>
<pre class="language-bash hljs">npm i react-redux redux redux-thunk
npm i --save-dev @types/react-redux 
</pre>
<p>上面的命令应该安装<code>redux</code>和<code>react-redux</code>库，它们处理React和Redux连接。接下来，安装<a href="https://github.com/reduxjs/redux-thunk" target="_blank" rel="noopener"> redux-thunk </a>，这是一个中间件，用于处理动作创建器中的异步数据获取。</p>
<h2 id="creating-react-redux-typescript-folder-structure">创建React Redux类型脚本文件夹结构</h2>
<p>现在是时候为我们的Redux存储创建文件结构了。</p>
<p><img data-attachment-id="85298" data-permalink="https://blog.logrocket.com/build-type-safe-react-redux-app/redux-store-file-structure-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-file-structure-1.png" data-orig-size="730,1083" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="redux-store-file-structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-file-structure-1-202x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-file-structure-1-690x1024.png" decoding="async" class="aligncenter size-full wp-image-85298 jetpack-lazy-image" src="../Images/0a627faaa0a243f362d0eafea6805d46.png" alt="Redux store file structure" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-file-structure-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-file-structure-1-202x300.png 202w, https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-file-structure-1-690x1024.png 690w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-file-structure-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-file-structure-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="85298" data-permalink="https://blog.logrocket.com/build-type-safe-react-redux-app/redux-store-file-structure-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-file-structure-1.png" data-orig-size="730,1083" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="redux-store-file-structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-file-structure-1-202x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-file-structure-1-690x1024.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-85298" src="../Images/0a627faaa0a243f362d0eafea6805d46.png" alt="Redux store file structure" srcset="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-file-structure-1.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-file-structure-1-202x300.png 202w, https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-file-structure-1-690x1024.png 690w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-file-structure-1.png"/></noscript>
<p>应用程序商店是基于域构建的。您可以看到inventory域的所有操作、缩减器和类型都保存在一个文件夹中，而cart域的操作、缩减器和类型保存在另一个文件夹中。</p>
<p>这种模式通常被称为“功能文件夹”，它使应用程序更具可扩展性，因为与每个功能相关的商店更新彼此之间更接近。使用feature folder，可以更容易地将与特定功能相关的单元和集成测试保存在具有Redux构件的同一个目录中。</p>
<p>如果管理如此多的文件让你感到力不从心，Redux ToolKit引入了<code>dux pattern</code>，允许你在单个文件中保持完整的特性实现。<a href="https://blog.logrocket.com/using-typescript-with-redux-toolkit/" target="_blank" rel="noopener"> Redux ToolKit拥有惊人的类型脚本支持</a>，可以提高你的开发速度。</p>
<h2 id="using-store-inventory-domain">将商店用于我们的库存域</h2>
<p>让我们从库存域开始。我们需要为库存域创建操作、减少器和类型。我总是从域类型开始，因为这样，我可以在早期定义指定域的结构。</p>
<p>该类型将包含Redux状态、动作类型和域。</p>
<pre class="language-jsx hljs"> export interface Inventory {
  id: string;
  name: string;
  price: string;
  image: string;
  description: string;
  brand?: string;
  currentInventory: number;
}
export enum InventoryActionTypes {
  FETCH_REQUEST = "@@inventory/FETCH_REQUEST",
  FETCH_SUCCESS = "@@inventory/FETCH_SUCCESS",
  FETCH_ERROR = "@@inventory/FETCH_ERROR"
}
export interface InventoryState {
  readonly loading: boolean;
  readonly data: Inventory[];
  readonly errors?: string;
}
</pre>
<p>关于上述代码的几点注意事项:</p>
<ul>
<li><code>Inventory</code>接口确定指定的域数据</li>
<li><code>InventoryActionTypes</code>枚举决定了动作类型</li>
<li><code>Inventory</code>状态处理域状态的类型</li>
</ul>
<p>现在，该为库存商店创建一个动作了。</p>
<h2 id="using-typescript-redux-thunk">将TypeScript与Redux Thunk一起使用</h2>
<p>我们将使用Redux Thunk作为中间件来进行API调用。</p>
<p>到底什么是Redux Thunk？基本上，动作创建者返回一个具有动作类型和有效负载的对象。<code>redux-thunk</code>将动作转换成一个函数，在中间进行API调用，并通过调度动作返回数据。</p>
<pre class="language-javascript hljs">import { InventoryActionTypes } from "./types";
import { ActionCreator, Action, Dispatch } from "redux";
import { ThunkAction } from "redux-thunk";
import { ApplicationState } from "../index";
import inventory from "../../mockdata";

export type AppThunk = ActionCreator&lt;
  ThunkAction&lt;void, ApplicationState, null, Action&lt;string&gt;&gt;
&gt;;

export const fetchRequest: AppThunk = () =&gt; {
  return (dispatch: Dispatch): Action =&gt; {
    try {
      return dispatch({
        type: InventoryActionTypes.FETCH_SUCCESS,
        payload: inventory
      });
    } catch (e) {
      return dispatch({
        type: InventoryActionTypes.FETCH_ERROR
      });
    }
  };
};
</pre>
<p>这里，我们有一个动作<code>fetchRequest</code>，它返回一个函数。该函数进行API调用(这里，我们模拟库存数据，而不是API调用)。之后，它会分派一个动作。</p>
<p>我们还应该简单提一下动作的类型检查。每个动作的类型都应该是<code>ActionCreator</code> <strong>。</strong>因为我们使用了Redux Thunk，所以每个<code>ActionCreator</code>返回一个类型为<code>ThunkAction</code>的函数。</p>
<p>如果您是Redux Thunk的新手，请查看优秀的<a href="https://github.com/reduxjs/redux-thunk" target="_blank" rel="noopener">文档</a>进行深入了解。或者，如果您正在寻找一个更强大的工具作为Redux中间件，请查看Redux Saga，它使用生成器函数，允许开发人员轻松管理应用程序的复杂异步操作。</p>
<p>库存商店的最后一部分是减速器。让我们创建该文件。</p>
<pre class="language-jsx hljs">import { Reducer } from "redux";
import { InventoryActionTypes, InventoryState } from "./types";
export const initialState: InventoryState = {
  data: [],
  errors: undefined,
  loading: false
};
const reducer: Reducer&lt;InventoryState&gt; = (state = initialState, action) =&gt; {
  switch (action.type) {
    case InventoryActionTypes.FETCH_REQUEST: {
      return { ...state, loading: true };
    }
    case InventoryActionTypes.FETCH_SUCCESS: {
      console.log("action payload", action.payload);
      return { ...state, loading: false, data: action.payload };
    }
    case InventoryActionTypes.FETCH_ERROR: {
      return { ...state, loading: false, errors: action.payload };
    }
    default: {
      return state;
    }
  }
};
export { reducer as InventoryReducer };
</pre>
<p>首先，定义一个类型为<code>InventoryState</code>的初始状态。</p><div class="code-block code-block-54">
<hr/>
<h3>更多来自LogRocket的精彩文章:</h3>

<hr/></div>
<pre class="language-jsx hljs">export const initialState: InventoryState = {
  data: [],
  errors: undefined,
  loading: false
};
</pre>
<p>之后，创建一个状态类型为<code>InventoryState</code>的reducer。定义每个缩减器的类型非常重要，因为您希望在编译时而不是运行时识别问题。</p>
<pre class="language-jsx hljs">const reducer: Reducer&lt;InventoryState&gt; = (state = initialState, action) =&gt; {
  switch (action.type) {
    case InventoryActionTypes.FETCH_REQUEST: {
      return { ...state, loading: true };
    }
    case InventoryActionTypes.FETCH_SUCCESS: {
      console.log("action payload", action.payload);
      return { ...state, loading: false, data: action.payload };
    }
    case InventoryActionTypes.FETCH_ERROR: {
      return { ...state, loading: false, errors: action.payload };
    }
    default: {
      return state;
    }
  }
};
</pre>
<p>在这里，我们处理库存域的所有操作并更新状态。</p>

<p>是时候为购物车实现Redux功能了。cart域的功能类似于inventory域的功能。</p>
<p>首先，创建一个名为<code>types.ts</code>的文件，并添加以下代码。</p>
<pre class="language-typescript hljs">import { Inventory } from "../inventory/types";
export interface Cart {
  id: number;
  items: Inventory[];
}
export enum CartActionTypes {
  ADD_TO_CART = "@@cart/ADD_TO_CART",
  REMOVE_FROM_CART = "@@cart/REMOVE_FROM_CART",
  FETCH_CART_REQUEST = "@@cart/FETCH_CART_REQUEST",
  FETCH_CART_SUCCESS = "@@cart/FETCH_CART_SUCCESS",
  FETCH_CART_ERROR = "@@cart/FETCH_CART_ERROR"
}
export interface cartState {
  readonly loading: boolean;
  readonly data: Cart;
  readonly errors?: string;
}
</pre>
<p>这表示Redux的购物车域属性、购物车动作类型和购物车状态。<br/>接下来，为购物车域创建<code>action.ts</code>。</p>
<pre class="language-typescript hljs">import { CartActionTypes, Cart, cartState } from "./types";
import { Inventory } from "../inventory/types";
import { ActionCreator, Action, Dispatch } from "redux";
import { ThunkAction } from "redux-thunk";
import { ApplicationState } from "../index";
export type AppThunk = ThunkAction&lt;
  void,
  ApplicationState,
  null,
  Action&lt;string&gt;
&gt;;
export const fetchCartRequest: AppThunk = () =&gt; {
  return (dispatch: Dispatch, state: ApplicationState): Action =&gt; {
    try {
      return dispatch({
        type: CartActionTypes.FETCH_CART_SUCCESS,
        payload: state.cart
      });
    } catch (e) {
      return dispatch({
        type: CartActionTypes.FETCH_CART_ERROR
      });
    }
  };
};
export const addToCart: ActionCreator&lt;ThunkAction&lt;
  void,
  ApplicationState,
  Inventory,
  Action&lt;string&gt;
&gt;&gt; = item =&gt; {
  return (dispatch: Dispatch): Action =&gt; {
    try {
      return dispatch({
        type: CartActionTypes.ADD_TO_CART,
        payload: item
      });
    } catch (e) {
      return dispatch({
        type: CartActionTypes.ADD_TO_CART_FAILURE,
        payload: null
      });
    }
  };
};
action.ts contains all the actions that handle the cart domain functionalities.
</pre>
<p>这里，我们使用<code>redux-thunk</code>进行API获取调用。出于本教程的目的，我们嘲笑了它，但是在生产中，您可以在动作创建器中获取API。</p>
<p>最后，编写cart域缩减器的代码。创建一个文件，将其命名为<code>reducer.ts</code>，并添加以下代码。</p>
<pre class="language-typescript hljs">import { Reducer } from "redux";
import { CartActionTypes, cartState } from "./types";
export const initialState: cartState = {
  data: {
    id: 0,
    items: []
  },
  errors: undefined,
  loading: false
};
const reducer: Reducer&lt;cartState&gt; = (state = initialState, action) =&gt; {
  switch (action.type) {
    case CartActionTypes.FETCH_CART_REQUEST: {
      return { ...state, loading: true };
    }
    case CartActionTypes.FETCH_CART_SUCCESS: {
      return { ...state, loading: false, data: action.payload };
    }
    case CartActionTypes.FETCH_CART_ERROR: {
      return { ...state, loading: false, errors: action.payload };
    }
    case CartActionTypes.ADD_TO_CART: {
      return {
        errors: state.errors,
        loading: state.loading,
        data: {
          ...state.data,
          id: state.data.id,
          items: [...state.data.items, action.payload]
        }
      };
    }
    case CartActionTypes.REMOVE_FROM_CART: {
      return {
        errors: state.errors,
        loading: state.loading,
        data: {
          ...state.data,
          id: state.data.id,
          items: state.data.items.filter(item =&gt; item !== action.payload.id)
        }
      };
    }
    default: {
      return state;
    }
  }
};
export { reducer as cartReducer };
</pre>
<p>现在是时候为我们的应用程序配置商店了。</p>
<h2><strong>配置商店</strong></h2>
<p>在根目录下创建一个名为<code>configureStore.ts</code>的文件，并添加以下代码。</p>
<pre class="language-typescript hljs">import { Store, createStore, applyMiddleware } from "redux";
import thunk from "redux-thunk";
import { routerMiddleware } from "connected-react-router";
import { History } from "history";
import { ApplicationState, createRootReducer } from "./store";
export default function configureStore(
  history: History,
  initialState: ApplicationState
): Store&lt;ApplicationState&gt; {
  const store = createStore(
    createRootReducer(history),
    initialState,
    applyMiddleware(routerMiddleware(history), thunk)
  );
  return store;
}
</pre>
<p>我们创建了一个名为<code>configureStore</code>的函数，它将<code>history</code>和<code>initialState</code>作为参数。</p>
<p>我们需要定义参数的类型，比如<code>history</code>和<code>initialState</code>。<code>initialState</code>要有<code>ApplicationStore</code>的类型，店内定义。<code>configureStore</code>函数返回包含<code>ApplicationState</code>的类型<code>Store</code>。</p>
<p>之后创建一个商店，里面有root reducer、<code>initialStore</code>和中间件，这里是<code>routerMiddleware</code>和<code>redux-thunk</code>。</p>
<p>我们终于完成了冗余部分。接下来，我们将演示如何实现它的组件。</p>
<h2>组件结构</h2>
<p>让我们放大我们的组件。</p>
<p><img data-attachment-id="85300" data-permalink="https://blog.logrocket.com/build-type-safe-react-redux-app/redux-store-component-structure/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-component-structure.png" data-orig-size="730,822" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="redux-store-component-structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-component-structure-266x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-component-structure.png" decoding="async" class="aligncenter size-full wp-image-85300 jetpack-lazy-image" src="../Images/25debd2a45701288394119b9a72a1146.png" alt="Redux store component structure" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-component-structure.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-component-structure-266x300.png 266w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-component-structure.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-component-structure.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="85300" data-permalink="https://blog.logrocket.com/build-type-safe-react-redux-app/redux-store-component-structure/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-component-structure.png" data-orig-size="730,822" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="redux-store-component-structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-component-structure-266x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-component-structure.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-85300" src="../Images/25debd2a45701288394119b9a72a1146.png" alt="Redux store component structure" srcset="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-component-structure.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-component-structure-266x300.png 266w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/03/redux-store-component-structure.png"/></noscript>
<ul>
<li><code>HomePage</code>处理主页面，呈现<code>ProductItem</code>组件</li>
<li><code>Navbar</code>显示导航栏和购物车中的商品数量</li>
<li><code>Cart</code>包含添加到购物车的列表项目</li>
</ul>
<p>一旦你知道如何构造一个类型安全的Redux应用程序，实现组件就相当简单了。将组件部分作为一个练习，并在下面留下你的GitHub链接评论。</p>
<p>你可以在<a href="https://github.com/ganeshmani/react-redux-typescript-example" target="_blank" rel="noopener"> GitHub </a>上找到完整的源代码供参考。</p>
<h2>下一步是什么？</h2>
<p>现在您已经知道了如何使用React Redux、Redux和Redux Thunk构建一个类型安全的Redux应用程序，您可能会注意到仅仅是在应用程序中设置Redux就需要大量的代码。幸运的是，这个问题有一个解决方案:<a href="https://redux-toolkit.js.org/introduction/quick-start" target="_blank" rel="noopener"> Redux Toolkit </a>。这个包旨在简化Redux的实现过程。</p>
<p>以下是Redux Toolkit的简要概述:</p>
<ul>
<li><code><a href="https://redux-toolkit.js.org/api/configurestore/" target="_blank" rel="noopener">configureStore()</a></code>就像Redux中的<code>creatorStore()</code>的包装器，附带一些现成的Redux开发工具，消除了设置它的需要</li>
<li><code><a href="https://redux-toolkit.js.org/api/createreducer/" target="_blank" rel="noopener">createReducer()</a></code>是一个实用函数，它取代了Redux应用程序中传统的reducers样板文件</li>
<li><code><a href="https://redux-toolkit.js.org/api/createaction/" target="_blank" rel="noopener">createAction()</a></code>基本上是一个帮助器函数，用于定义Redux动作类型和创建者</li>
<li><code><a href="https://redux-toolkit.js.org/api/createslice/" target="_blank" rel="noopener">createSlice()</a></code>是基于<code>initialState</code>和reducer函数自动生成动作创建者和动作类型的函数</li>
</ul>
<h2 id="summary">摘要</h2>
<p>添加类型检查可以帮助您创建愉快的开发人员体验。它可以让你避免编译时的错误，并随着从事项目及其功能的开发人员数量的增加，保持你的应用程序的可伸缩性。</p>
<p>状态管理是应用程序架构的核心部分之一，让ts与您的状态管理保持一致可以提高生产率和代码的可读性。对于进一步的阅读，理解这些概念将有助于您进行类型检查。</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720"><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener"> LogRocket </a>:全面了解您的生产React应用</h2><p>调试React应用程序可能很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪Redux状态、自动显示JavaScript错误以及跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" vwo-el-id="19356441070">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<p vwo-el-id="28675660440" class="">LogRocket 结合了会话回放、产品分析和错误跟踪，使软件团队能够创建理想的web和移动产品体验。这对你来说意味着什么？</p>
<p>LogRocket不是猜测错误发生的原因，也不是要求用户提供截图和日志转储，而是让您回放问题，就像它们发生在您自己的浏览器中一样，以快速了解哪里出错了。</p>
<p>不再有嘈杂的警报。智能错误跟踪允许您对问题进行分类，然后从中学习。获得有影响的用户问题的通知，而不是误报。警报越少，有用的信号越多。</p>
<p vwo-el-id="28675660750">LogRocket Redux中间件包为您的用户会话增加了一层额外的可见性。LogRocket记录Redux存储中的所有操作和状态。</p>
<p vwo-el-id="28675661060">现代化您调试React应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">开始免费监控</a>。</p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>