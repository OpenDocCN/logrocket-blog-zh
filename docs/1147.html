<html>
<head>
<title>Building an interactive map with Vue and Leaflet - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用Vue和传单构建交互式地图</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/building-an-interactive-map-with-vue-and-leaflet/#0001-01-01">https://blog.logrocket.com/building-an-interactive-map-with-vue-and-leaflet/#0001-01-01</a></blockquote><div><article class="article-post">
<h2>介绍</h2>
<p>布丁最近出版了一本奇妙的当地旅游指南。以那篇文章为灵感，今天我们将制作一张地图，标出旧金山的景点。</p>
<p>在本教程中，我们将使用以下工具:</p>
<ul>
<li>传单:交互式地图的JavaScript库</li>
<li>Vue:一个渐进的JavaScript框架</li>
<li><a href="https://developer.foursquare.com/" target="_blank" rel="noopener noreferrer"> FourSquare API </a>:一家位置数据&amp;情报公司</li>
</ul>
<p>几年前，我上了一门叫做数据新闻学的课。这门课程是为新闻专业的学生设计的，主要是向我介绍HTML、CSS、JavaScript和传单。</p>
<p>在一个学期里，我不仅学会了编程的基础，还构建了一个展示旧金山县学校的web应用程序。</p>
<p>我为什么要提这个？因为如果你了解HTML、CSS和JavaScript的基础知识，你可以拿起传单。</p>
<h2>什么是传单？</h2>
<p>传单是一个JavaScript库，用于创建移动友好的交互式地图。这是一个广泛使用的JS库，你可能在NPR、WaPo或SFChronicle上看到过传单。</p>
<p>当使用一个新的库或框架时，一个记录良好的API总是很有帮助的。幸运的是，fleet是拥有易于理解的文档的库之一。</p>
<p>我最近开始大量使用地图，使用不同的工具(D3、传单和Mapbox)，我想知道我们需要什么数据来创建一个地图。我将在这里谈论其中的一些。</p>
<p>这三种工具的一个共同之处是地图的占位符。我们需要一个<code>&lt;div&gt;</code>，通常带有一个<code>id</code>，在它上面我们将安装我们的地图。</p>
<p>我们还需要将中心(地图的地理中心和缩放级别)定义为初始地图缩放级别。</p>
<pre>&lt;div id="mapContainer"&gt;&lt;/div&gt;

L.map("mapContainer").setView([37.7749, -122.4194], 13); //places the map in San Francisco.</pre>
<p>如果你想绘制巴黎地图，但你只看到了水，那么很有可能你已经转换了中心坐标。总是仔细检查它们。</p>
<p>我们还需要创建一个层。</p>
<p>什么是层？如果您使用过谷歌地图，您可能会使用交通图层或卫星图层。您可以使用地形图层或默认图层。这些是可以放在地图上的不同种类的图层。</p>
<p>在我们的示例中，我们将使用地图框街道切片图层。要使用Mapbox，我们需要请求一个访问令牌。在这里获取一个访问令牌<a href="https://account.mapbox.com/access-tokens/" target="_blank" rel="noopener noreferrer">。</a></p>
<p>有了令牌后，我们可以像这样将图层添加到地图中:</p>
<pre>L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', { 
attribution: 'Map data (c) &lt;a href="https://www.openstreetmap.org/"&gt;OpenStreetMap&lt;/a&gt; contributors, &lt;a href="https://creativecommons.org/licenses/by-sa/2.0/"&gt;CC-BY-SA&lt;/a&gt;, Imagery (c) &lt;a href="https://www.mapbox.com/"&gt;Mapbox&lt;/a&gt;',
maxZoom: 18, 
id: 'mapbox/streets-v11', 
accessToken: 'myaccessToken' }).addTo(mapContainer);</pre>
<p>这就是我们所需要的基本地图。</p>
<p>让我们看看如何使用Vue创建这个地图。</p>
<h2>Vue和传单</h2>
<p>Vue.js，在<a href="https://github.com/vuejs/vue" target="_blank" rel="noopener noreferrer"> GitHub </a>上有168K颗星，是一个基于JavaScript的前端框架，用于构建用户界面。</p>
<p>本文将假设您已经掌握了Vue的工作知识。如果你需要复习，<a href="https://vuejs.org/v2/guide/" target="_blank" rel="noopener noreferrer">官方文档</a>维护得很好，很容易理解。</p>
<p>在我们开始编码地图之前，让我们安装一些依赖项。</p>
<p>让我们也安装传单。</p>
<p>按照这里的指示<a href="https://www.npmjs.com/package/leaflet" target="_blank" rel="noopener noreferrer">，我们可以在终端中执行以下命令:</a></p>
<pre>npm install leaflet</pre>
<p>如果你还记得，我们在开始的时候说过我们需要一个<code>div</code>来安装我们的地图。让我们在模板中添加一个<code>div</code>，并给它一个<code>mapContainer</code>的<code>id</code>。</p>
<pre>&lt;template&gt;
 &lt;div id="container"&gt;
   &lt;div id="mapContainer"&gt;&lt;/div&gt;
 &lt;/div&gt;
&lt;/template&gt;</pre>
<p>在我们脚本中，我们将首先导入这样的传单:</p>
<pre>import "leaflet/dist/leaflet.css";
import L from "leaflet";</pre>
<p>确保导入CSS。没有它，地图将无法正常工作。</p><div class="code-block code-block-54">
<hr/>
<h3>更多来自LogRocket的精彩文章:</h3>

<hr/></div>
<pre>&lt;script&gt;
import "leaflet/dist/leaflet.css";
import L from "leaflet";

export default {
 name: "Map",
 data() {
   return{
     center: [37,7749, -122,4194]
   }}
 methods: {
   setupLeafletMap: function () {
     const mapDiv = L.map("mapContainer").setView(this.center, 13);
     L.tileLayer(
       "https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",
       {
         attribution:
           'Map data (c) &lt;a href="https://www.openstreetmap.org/"&gt;OpenStreetMap&lt;/a&gt; contributors, &lt;a href="https://creativecommons.org/licenses/by-sa/2.0/"&gt;CC-BY-SA&lt;/a&gt;, Imagery (c) &lt;a href="https://www.mapbox.com/"&gt;Mapbox&lt;/a&gt;',
         maxZoom: 18,
         id: "mapbox/streets-v11",
         accessToken:”XXX",
       }
     ).addTo(mapDiv);
   },
 },
 mounted() {
   this.setupLeafletMap();
 },
};
&lt;/script&gt;

&lt;style scoped&gt;
#mapContainer {
 width: 80vw;
 height: 100vh;
}
&lt;/style&gt;</pre>
<p>一旦我们有了导入，我们将为组件命名。我们把它命名为地图。你可以给你的组件起任何你喜欢的名字。</p>
<p>我们需要一条信息来让这个应用程序工作——我们地图的中心。我们在数据项目中添加了一个中心属性。</p>
<p>然后我们将在我们的方法对象中创建一个函数<code>setupLeafletMap</code>。顾名思义，这个函数将在组件挂载时设置我们的地图。</p>
<p>我们使用了与之前相同的代码来初始化地图。</p>
<p>我们可以直接在挂载的函数中添加代码，但是为了保持代码有条理，我们创建了一个单独的函数，我们将在挂载的函数中调用它。</p>
<p>确保给你的<code>mapContainer</code>一些宽度和高度。运行<code>yarn serve</code>，应该会看到同样的地图。</p>
<h2>数据</h2>
<p>让我们在应用程序中添加一些数据，使其更具互动性。为了在地图上显示任何东西，我们需要该位置的坐标。幸运的是，我们可以从旧金山开放数据中心获得数据。</p>
<p>让我们在门户中搜索历史地标，然后单击查看数据。如我们所见，第一列定义了所有位置的几何图形。</p>
<p>其他列包含名称、街道名称、街道类型和地址以及其他详细信息。</p>
<p>通常，如果你点击每列顶部的三个点，它们会提供描述。</p>
<p>对于此数据集，缺少描述。</p>
<p>我们可以使用API端点，但是在本教程中，我们将下载GEOJSON数据。GeoJSON基于JSON，是一种用于编码各种地理数据结构的格式。</p>
<p>如果你想使用API，点击导出，然后点击SODA API。要使用API，您需要一个访问令牌。获取访问密钥很简单。在这里创建一个账户<a href="https://datasf.org/opendata/" target="_blank" rel="noopener noreferrer">，点击右下方的管理链接。</a></p>
<p>在那里，按照步骤，复制您的密钥ID和密钥秘密。</p>
<p>让我们将下载的文件保存为JSON，并将其导入到组件中:</p>
<pre>import data from "./Historic-Landmarks.json";</pre>
<p>我们需要的传单API叫做<code>L.geoJSON()</code>。</p>
<p>根据文档记载，“<a href="https://leafletjs.com/reference-1.6.0.html#geojson" target="_blank" rel="noopener noreferrer"> L.geoJSON() </a>允许您解析geoJSON数据并将其显示在地图上。”</p>
<p>让我们将数据传递给函数，并使用<code>addTo()</code>将其添加到地图中。</p>
<pre> L.geoJSON(data).addTo(mapDiv);</pre>
<p>如果我们刷新页面，我们应该在地图上看到蓝色的多边形。每个多边形代表城市中的一个景点。</p>
<p>让我们来玩一些<code>geoJSON()</code>选项。我们没有每个位置的大量数据，所以只是为了看看样式选项如何工作，我们将使用列出的起息日来样式化我们的多边形。</p>
<p>我们将传递一个函数，该函数将2000年后列出的所有位置的样式设置为红色，其余的为蓝色。由于列出的日期是一个字符串，我们需要做一些转换和切片来获得年份。</p>
<p>让我们创建一个名为<code>styleMap</code>的函数。</p>
<pre>styleMap(feature){
      const year = feature.properties.datelisted
            ? parseInt(feature.properties.datelisted.slice(0, 4))
            : 0;
          const color = year &gt; 2000 ? "red" : "blue";
          return { color: color };
    },</pre>
<p>如果我们想过滤数据，我们可以使用一个过滤选项。</p>
<p>最后，让我们添加一些交互。当用户点击多边形时，会出现一个弹出窗口。传单为我们提供了一个叫做<code>onEachFeature</code>的功能。</p>
<p>根据文件:</p>
<p>“<code>onEachFeature</code>选项是在将每个要素添加到GeoJSON图层之前对其进行调用的函数。使用此选项的一个常见原因是，单击要素时会将弹出窗口附加到要素上。</p>
<p>我们将创建另一个名为<code>onEachFeature</code>的函数。我们只想在弹出窗口中显示该名称，所以我们将查看它是否存在。如果是，我们将使用<code>layer.bindPopup()</code>并传入名称。</p>
<pre>onEachFeature(feature, layer) {
      if (feature.properties &amp;&amp; feature.properties.name) {
        layer.bindPopup(feature.properties.name);
    layer.on('mouseover', () =&gt; { layer.openPopup(); });
        layer.on('mouseout', () =&gt; { layer.closePopup(); });
      }
   },</pre>
<p>如果我们刷新我们的应用程序，点击金门大桥，会出现一个弹出窗口，上面有这个名字。</p>
<div>
<p>让我们像这样传递我们的两个函数:</p>
</div>
<div>
<pre>L.geoJSON(data , {onEachFeature: this.onEachFeature,style: this.styleMap,})</pre>
</div>
<p>我们可以更新我们的弹出窗口，使其不仅仅是一个名字。最后，如果你想让你的地图做更多的事情，你可以添加点击事件。</p>
<h2>结论</h2>
<p>现在你应该对fleet如何与Vue协同工作有了一个基本的了解。传单可以让你在地图上做更多的事情。您可以将它与其他API结合起来，显示位置的详细信息，例如评论和图片。</p>
<p>Yelp、Foursquare或Google是少数几个你可以使用的API。如果你想开始使用Foursquare API，在这里查看代码<a href="https://github.com/abidishajia/vue-and-leaflet" target="_blank" rel="noopener noreferrer"/>。</p>
<p>另一个想法是在你的地图上添加奇特的标记。看看《旧金山纪事报》的<a href="https://www.sfchronicle.com/projects/california-fire-map/" target="_blank" rel="noopener noreferrer">火灾追踪器</a>。也许你可以尝试一下<a href="https://leafletjs.com/examples/choropleth/" target="_blank" rel="noopener noreferrer">交互式Choropleth地图</a>。</p>
<p>一定要看看传单的灵感和更多的API教程。</p><div class="code-block code-block-20">
<div class="blog-plug inline-plug vue-inline"><h2>像用户一样体验您的Vue应用</h2><p>调试Vue.js应用程序可能会很困难，尤其是当用户会话期间有几十个(如果不是几百个)突变时。如果您对监视和跟踪生产中所有用户的Vue突变感兴趣，</p><a href="https://lp.logrocket.com/blg/vue-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/0d269845910c723dd7df26adab9289cb.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/0d269845910c723dd7df26adab9289cb.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png"/></noscript></a><a href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用程序的DVR，记录你的Vue应用程序中发生的一切，包括网络请求、JavaScript错误、性能问题等等。您可以汇总并报告问题发生时应用程序的状态，而不是猜测问题发生的原因。</p><p>LogRocket Vuex插件将Vuex突变记录到LogRocket控制台，为您提供导致错误的环境，以及出现问题时应用程序的状态。</p><p>现代化您调试Vue应用的方式- <a class="signup" href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div>


</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>