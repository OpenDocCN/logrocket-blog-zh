<html>
<head>
<title>Build an event keeper app with Ionic and AWS - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用Ionic和AWS - LogRocket博客构建一个事件管理器应用程序</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/#0001-01-01">https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/#0001-01-01</a></blockquote><div><article class="article-post">
<p>Ionic framework是一个开源UI工具包，用于使用web技术(HTML、CSS和JavaScript)构建高性能、高质量的移动和桌面应用程序，并集成了Angular、Vue和React等流行框架。</p>
<p>亚马逊网络服务(AWS)以按需付费的方式提供按需云平台。</p>
<p>在本教程中，我们将使用名为S3的AWS服务构建一个事件管理器应用程序来保存我们的图像。所有上传到我们平台的图像将被存储在AWS S3桶中，我们的图像的URL将被返回。</p>
<h2 id="prerequisites">先决条件</h2>
<p>要跟随本教程，您需要:</p>
<ul>
<li>对HTML、CSS和JavaScript (ES6+)有基本的了解</li>
<li>安装了代码编辑器，如VS代码</li>
<li>邮递员已安装</li>
<li>MongoDB设置</li>
<li><a href="https://blog.logrocket.com/angular-10-is-now-available-heres-what-you-need-to-know/" target="_blank" rel="noopener noreferrer">角度</a>和Express.js的基础知识</li>
</ul>
<h2 id="buildingthebackend">构建后端</h2>
<p>要构建后端，请完成以下步骤。</p>
<ol>
<li>初始化新的节点项目</li>
<li>安装所有必需的依赖项</li>
<li>创建Express服务器并配置依赖关系</li>
<li>创建和配置MongoDB</li>
<li>创建事件管理器模型</li>
<li>设置AWS和Multer</li>
<li>创建必要的路线和控制器</li>
<li>使用邮递员测试路线</li>
</ol>
<h2 id="initialiseanewnodejsproject">初始化新的节点项目</h2>
<p>让我们首先在桌面上为我们的应用程序创建一个文件夹。打开您的终端，键入以下内容。</p>
<pre>cd desktop
mkdir event-app &amp;&amp; cd event-app
mkdir server &amp;&amp; cd server
code
</pre>
<p>这里我们在桌面上创建一个<code>event-app</code>目录。在<code>event-app</code>目录中，我们将创建一个<code>server</code>目录。这是我们设置后端应用程序的地方。</p>
<p>命令将在VS代码中设置我们的应用程序。VS代码被重新定义和优化，用于构建和调试现代web和云应用程序。请随意使用您选择的任何文本编辑器。出于本教程的目的，我们将使用VS代码集成终端。</p>
<p>要设置Node.js应用程序，我们需要一个<code>package.json</code>文件来管理我们所有的项目依赖项。要创建它，在终端上运行<code>npm init -y</code>。</p>
<pre>npm init -y
</pre>
<p>这将创建一个<code>package.json</code>文件。</p>
<h2 id="installalltherequireddependenciesforourapplication">安装所需的依赖项</h2>
<p>我们的应用程序将需要以下npm包进行开发。</p>
<ul>
<li><code>Expressjs</code> —一个node.js框架，可以轻松构建web应用。</li>
<li><code>mongoose</code> —一个用于异步查询MongoDB的对象建模工具，它提供了一个简单的、基于模式的解决方案来为您的应用程序数据建模</li>
<li><code>body-parser</code> —允许Express读取请求主体，然后将其解析成可以理解的JSON对象的包</li>
<li><code>cors</code> —一种中间件，可用于支持具有各种选项的CORS</li>
<li><code>morgan</code> —记录所有路由和请求的日志工具</li>
<li><code>aws-sdk</code> —官方AWS SDK for JavaScript，可用于浏览器、移动设备和Node.js后端</li>
<li><code>multer</code> —用于处理多部分表单数据的Node.js中间件，主要用于上传文件</li>
<li><code>dotenv</code> —一个零依赖模块，将环境变量从<code>.env</code>文件加载到<code>process.env</code>中。这是我们为应用程序存储所有外部环境变量的地方，比如AWS secret、ID等。</li>
<li><code>multer-s3</code> —用于流式传输AWS S3 Multer存储引擎的包</li>
<li>每次我们修改代码时，这个包都会重新运行Express服务器</li>
</ul>
<p>从全局安装Nodemon开始，这样就可以在本地机器上的任何地方访问它。</p>
<pre>npm install -g nodemon
</pre>
<p>接下来，安装所有其他依赖项。</p>
<pre>npm i --save express body-parser cors morgan aws-sdk multer multer-s3 mongoose dotenv
</pre>
<p>这个命令将安装所有这些包，并将它们添加到我们在<code>package.js file</code>中的依赖项中。它还创建了一个<code>node-modules</code>目录，这是我们所有包存储的地方。</p>
<p>记住，在将项目推送到git时，不要添加这个包。为了避免这种情况，创建一个<code>.gitignore</code>文件</p>
<pre>touch .gitignore
</pre>
<p>该命令将创建一个<code>.gitignore</code>文件。打开文件并在其中键入<code>node-modules</code>。</p>
<h2 id="createanexpressserverandconfigurealldependencies">创建express服务器并配置所有依赖项。</h2>
<p><span>要设置Express服务器，创建一个</span> <code>src</code> <span>目录，并在其中放置一个</span> <code>index.js</code> <span>文件。这是我们应用程序的基本文件。我们将在这里定义我们的第一个路由并配置一些包。</span></p>
<p><span>将下面的代码添加到</span> <code>index.js</code> <span>文件中。</span></p>
<pre>require('dotenv').config()
const express = require("express");
const PORT = process.env.PORT || 4000;
const morgan = require("morgan");
const cors = require("cors");
const bodyParser = require("body-parser");
const app = express();
//--------------registering cors -----------------
app.use(cors());
//----------------configure body parser --------------
app.use(bodyParser.urlencoded({
    extended: false
}));
app.use(bodyParser.json());
//---------------configure morgan  --------
app.use(morgan("dev"));

// define first route
app.get("/", (req, res) =&gt; {
    res.json({
        data: "Hello MEIN developers...The `I` stands for Ionic😎😎"
    });
});
app.listen(PORT, () =&gt; {
    console.log(`App is running on ${PORT}`);
});
</pre>
<p>打开<code>package.json</code>文件并添加以下内容。运行<code>npm run dev:start</code>将引导我们的应用程序。</p>
<pre>"scripts": {
    "start:dev":"nodemon src"
  },
</pre>
<p>如果您在浏览器上打开应用程序，您应该会看到以下内容:</p>
<p><img data-attachment-id="22042" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/open-app-in-browser/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/open-app-in-browser.png" data-orig-size="720,216" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Open app in browser" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/open-app-in-browser-300x90.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/open-app-in-browser.png" decoding="async" class="aligncenter size-full wp-image-22042 jetpack-lazy-image" src="../Images/28b3c4f45b6541960ab227a272752c67.png" alt="Open App in Browser" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/open-app-in-browser.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/open-app-in-browser-300x90.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/open-app-in-browser.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/open-app-in-browser.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22042" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/open-app-in-browser/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/open-app-in-browser.png" data-orig-size="720,216" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Open app in browser" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/open-app-in-browser-300x90.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/open-app-in-browser.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22042" src="../Images/28b3c4f45b6541960ab227a272752c67.png" alt="Open App in Browser" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/open-app-in-browser.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/open-app-in-browser-300x90.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/open-app-in-browser.png"/></noscript>
<h2 id="createandconfiguremongodbdatabase">创建和配置MongoDB数据库</h2>
<p>创建一个<code>config</code>目录。在<code>config</code>目录中，创建一个<code>mongoose.js</code>文件，并将以下代码添加到该文件中。</p>
<pre>const mongoose = require("mongoose");
module.exports = function (app) {
    mongoose.connect("mongodb://localhost:27017/ionic-app", {
        useUnifiedTopology: true,
        useNewUrlParser: true,
        useFindAndModify: false
    }).then(res =&gt; console.log("Database conneceted")).catch(err =&gt; console.log(err))
    mongoose.Promise = global.Promise;
    process.on("SIGINT", cleanup);
    process.on("SIGTERM", cleanup);
    process.on("SIGHUP", cleanup);
    if (app) {
        app.set("mongoose", mongoose);
    }
};
function cleanup() {
    mongoose.connection.close(function () {
        process.exit(0);
    });
}
</pre>
<p>我们需要在我们的根文件中注册它，然后传递<code>express()</code>的实例。为此，我们需要在我们的<code>index.js</code>文件中要求这个模块。</p>
<pre>require("./config/mongoose")(app);
</pre>
<p>一旦你这样做了，如果你的应用程序正在运行，你会在控制台上看到<code>Database conneceted</code>。</p>
<h2 id="createtheeventkeepermodel">创建事件管理器模型</h2>
<p>现在我们的数据库已经准备好了，我们需要创建我们的Mongoose模式，它接受一个定义事件模式属性的对象。</p>
<p>创建一个目录来保存模式、路由和控制器。</p>
<pre>cd src
mkdir api &amp;&amp; cd api
mkdir events &amp;&amp; cd events
touch model.js &amp;&amp; touch controller.js &amp;&amp; touch routes.js
</pre>
<p>让我们通过在<code>events/model.js</code>文件中添加这些代码来定义我们的事件模式:</p>
<pre>const mongoose = require("mongoose");
const eventSchema = mongoose.Schema({
    name: {
        type: String,
        required: true
    },
    image: {
        type: String,
        required: true
    },
    description: {
        type: String,
        required: true
    }
}, {
    timestamps: true,
});
const Event = mongoose.model("Event", eventSchema);
module.exports = Event;
</pre>
<p>Mongoose将模式转换成数据库中的文档。这些属性然后被转换成文档中的字段。</p>
<h2 id="setupawsandmulter">设置AWS和Multer</h2>
<p><span>首先，你需要注册一个<a href="https://aws.amazon.com" target="_blank" rel="noopener noreferrer"> AWS账户</a>。</span></p>
<p><span>登录后，您会在导航栏上看到</span> <code>services</code> <span>链接。点击它并在搜索框中输入“s3”。</span></p>
<p><img data-attachment-id="22040" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/aws-services-search-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-search-page.png" data-orig-size="720,390" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="AWS Services search page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-search-page-300x163.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-search-page.png" decoding="async" class="aligncenter size-full wp-image-22040 jetpack-lazy-image" src="../Images/c33945719baacb2c77f52e690eaccbb0.png" alt="AWS Services Search Page" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-search-page.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-search-page-300x163.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-search-page.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-search-page.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22040" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/aws-services-search-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-search-page.png" data-orig-size="720,390" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="AWS Services search page" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-search-page-300x163.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-search-page.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22040" src="../Images/c33945719baacb2c77f52e690eaccbb0.png" alt="AWS Services Search Page" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-search-page.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-search-page-300x163.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-search-page.png"/></noscript>
<p>点击S3。这是我们将用于云存储的内容。</p>
<p>通过单击“创建存储桶”，为您的应用程序创建新的存储桶将弹出一个模式，要求您指定您的bucket的名称。调用您的存储桶<code>eventskeeper</code>并选择<code>US West (N. California)</code>作为您的区域。</p>
<p>转到“权限”部分，取消选中复选框以阻止所有公共访问，然后保存您的更改。</p>
<p><img data-attachment-id="22039" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/aws-services-permissions-tab/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-permissions-tab.png" data-orig-size="720,341" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="AWS Services Permissions tab" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-permissions-tab-300x142.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-permissions-tab.png" decoding="async" class="aligncenter size-full wp-image-22039 jetpack-lazy-image" src="../Images/641f80245c4c2dcd6531f22df95fcce2.png" alt="AWS Services Permissions Tab" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-permissions-tab.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-permissions-tab-300x142.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-permissions-tab.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-permissions-tab.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22039" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/aws-services-permissions-tab/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-permissions-tab.png" data-orig-size="720,341" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="AWS Services Permissions tab" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-permissions-tab-300x142.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-permissions-tab.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22039" src="../Images/641f80245c4c2dcd6531f22df95fcce2.png" alt="AWS Services Permissions Tab" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-permissions-tab.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-permissions-tab-300x142.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-services-permissions-tab.png"/></noscript>
<p>Nex，我们需要拿到所有的安全证书。单击页面顶部的登录用户名，然后单击“我的安全凭证”</p>
<p><img data-attachment-id="22038" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/aws-management-console/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-management-console.png" data-orig-size="720,312" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="AWS management console" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-management-console-300x130.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-management-console.png" decoding="async" class="aligncenter size-full wp-image-22038 jetpack-lazy-image" src="../Images/c9fe23c734649ea3e65e8090ead478eb.png" alt="AWS Management Console" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-management-console.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/aws-management-console-300x130.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-management-console.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-management-console.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22038" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/aws-management-console/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-management-console.png" data-orig-size="720,312" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="AWS management console" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-management-console-300x130.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-management-console.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22038" src="../Images/c9fe23c734649ea3e65e8090ead478eb.png" alt="AWS Management Console" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-management-console.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/aws-management-console-300x130.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/aws-management-console.png"/></noscript>
<p>这将带您到一个页面，您可以在这里设置您的安全凭证。点按“访问密钥”，然后点按“创建新的访问密钥”您将看到一个包含您的安全细节的模型。复制这些细节，以便您可以将它们存储在一个<code>.env</code>文件中。</p>
<p>创建<code>.env</code>文件。</p>
<pre>touch .env
</pre>
<p>在<code>.env</code>文件中，添加以下内容。</p>
<pre>ACCESS_KEY=****************ZZN7SQDUJUPQ
ACEESS_SECRET=**********************ifn30**
</pre>
<p>用您从该网站获得的安全详细信息替换这些值。不要忘记将这个文件添加到<code>.gitignore</code>文件中。</p>
<p>在config目录中创建一个<code>aws.js</code>文件，并添加以下内容。</p>
<pre>const aws = require('aws-sdk')
const multer = require('multer')
const multerS3 = require('multer-s3')


aws.config.update({
    secretAccessKey: process.env.ACEESS_SECRET,
    accessKeyId: process.env.ACCESS_KEY,
    region: 'eu-west-3'
})
const s3 = new aws.S3();
const fileFilter = (req, file, cb) =&gt; {
    if (file.mimetype.startsWith('image')) {
        cb(null, true);
    } else {
        cb(new Error('Not an image! Please upload an image.', 400), false);
    }
};
const upload = multer({
    fileFilter,
    storage: multerS3({
        s3,
        bucket: 'eventskeeper',
        acl: 'public-read',
        metadata: function (req, file, cb) {
            cb(null, {
                fieldName: "TESTING_META_DATA"
            });
        },
        key: function (req, file, cb) {
            cb(null, Date.now().toString())
        }
    })
})
module.exports = {
    upload,
    s3
}
</pre>
<p>首先将<code>aws-sdk</code>、<code>multer</code>和<code>multer-s3</code>导入该文件。接下来，使用存储在环境变量中的凭证来配置您的<code>aws-sdk</code>包。用配置对象中的区域替换您的区域。</p>
<p>下一步是为您的文件上传创建一个简单的过滤器，它只接受从<code>image</code>开始的<code>mimetype</code>文件类型。</p>
<p>在定义了这个过滤器之后，创建一个Multer实例来接收过滤器和我们将向其发送文件的bucket配置。在<code>multerS3</code>实例中，指定将保存您的文件的存储桶的名称，然后将<code>alc</code>设置为<code>public read</code>，以便您可以随时添加文件。</p>
<p>要使用这些方法，我们需要导出函数，以便任何JS模块都可以访问它。</p>
<h2 id="createthenecessaryroutesandcontrollers">创建必要的路线和控制器。</h2>
<p>我们基本上有两条路线:一条获取所有事件，另一条添加新事件。</p>
<p>在<code>api/events/routes.js</code>文件中，添加以下路线。</p>
<pre>const eventController = require("./controller");
const router = require("express").Router();

router.post("/", eventController.addEvent)
router.get("/", eventController.getAllEvents)


module.exports = router;
</pre>
<p>我们必须在控制器文件中创建<code>addEvent</code>和<code>getAllEvents</code>方法。首先在<code>api/events/controller.js</code>文件中创建<code>addEvent</code>方法。</p>
<pre>let Event = require('./model');
const {
    upload,
    s3
} = require('../../config/aws')

const singleUpload = upload.single('image');
exports.addEvent = async (req, res) =&gt; {
    try {
        await singleUpload(req, res, err =&gt; {
            if (err) {
                return res.status(422).json({
                    title: "File Upload Error",
                    desription: err.message
                })
            }
            const event = new Event({
                name: req.body.name,
                description: req.body.description,
                image: req.file.location
            })
            event.save();
            res.status(200).json({
                status: "Success",
                mes: "New Event Created"
            })
        })
    } catch (err) {
        res.status(500).json({
            status: "error",
            error: err
        })
    }
}
</pre>
<p>我们还需要引入事件模块和AWS配置模块。首先检查在尝试上传图像时是否有任何错误，并为任何不可处理的实体抛出一个<code>422</code>错误。如果没有错误，使用<code>req.body</code>访问请求中发送的JSON数据，并使用<code>req.file.location</code>获取图像的URL。</p>
<p>接下来，创建<code>getAllEvents</code>函数。这将基本上获得存储在MongoDB中的所有事件。</p>
<pre>exports.getAllEvents = async (req, res) =&gt; {
    try {
        let events = await Event.find();
        res.status(200).json({
            status: "Success",
            data: events
        })
    } catch (err) {
        res.status(500).json({
            status: "error",
            error: err
        })
    }
}
</pre>
<p>使用<code>find()</code>方法获取数据库中存储的所有数据。</p>
<p>现在我们需要为我们的事件注册一个全局路由处理器。在<code>api</code>目录中创建一个<code>routeHandler.js</code>文件，并添加以下代码。</p>
<pre>const EventRoutes = require("./events/routes");
module.exports = (app) =&gt; {
    app.use("/event", EventRoutes);
}
</pre>
<p>接下来，将其注册到<code>index.js</code>文件中。</p>
<pre>require("./api/routehandler")(app);
</pre>
<p>是时候在POSTMAN上测试我们的应用程序了。</p>
<h3>发布活动</h3>
<p><img data-attachment-id="22044" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/post-event/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/post-event.png" data-orig-size="720,467" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Post an event" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/post-event-300x195.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/post-event.png" decoding="async" class="aligncenter size-full wp-image-22044 jetpack-lazy-image" src="../Images/ef6393a43c6046164eaa9cc2ca489313.png" alt="Post an Event" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/post-event.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/post-event-300x195.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/post-event.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/post-event.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22044" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/post-event/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/post-event.png" data-orig-size="720,467" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Post an event" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/post-event-300x195.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/post-event.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22044" src="../Images/ef6393a43c6046164eaa9cc2ca489313.png" alt="Post an Event" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/post-event.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/post-event-300x195.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/post-event.png"/></noscript>
<h3>获取所有事件</h3>
<p><img data-attachment-id="22043" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/get-all-events/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/get-all-events.png" data-orig-size="720,473" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Get all events" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/get-all-events-300x197.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/get-all-events.png" decoding="async" class="aligncenter size-full wp-image-22043 jetpack-lazy-image" src="../Images/d9286946cdc062d3b4f26a7f257572ea.png" alt="Get All Events" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/get-all-events.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/get-all-events-300x197.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/get-all-events.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/get-all-events.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22043" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/get-all-events/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/get-all-events.png" data-orig-size="720,473" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Get all events" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/get-all-events-300x197.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/get-all-events.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22043" src="../Images/d9286946cdc062d3b4f26a7f257572ea.png" alt="Get All Events" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/get-all-events.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/get-all-events-300x197.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/get-all-events.png"/></noscript>
<h2 id="settingupthemobileapp">设置移动应用程序</h2>
<p>在全球范围内安装离子和其他离子工具。</p>
<pre>npm install -g @ionic/cli native-run cordova-res
</pre>
<p>在桌面上创建一个名为<code>events</code>的新目录。初始化一个新的离子应用程序和角度目录内。</p>
<pre>cd desktop
cd event-app &amp;&amp; mkdir events &amp;&amp; cd events
ionic start events tabs --type=angular --capacitor
</pre>
<p>这个Ionic Angular应用程序使用Tabs starter模板，并为原生功能添加了电容器。</p>
<p>现在，我们可以通过运行以下命令进入我们的应用程序:</p>
<pre>cd events
</pre>
<p>Ionic PWA元素库将在我们的应用程序中提供基于web的功能。要安装它，请在应用程序目录中运行以下命令。</p>
<pre>npm install @ionic/pwa-elements
</pre>
<p>要使用这个包，我们需要将它导入到我们的<code>src/main.ts</code>文件中。</p>
<pre>import { defineCustomElements } from '@ionic/pwa-elements/loader';

// Call the element loader after the platform has been bootstrapped
defineCustomElements(window);
</pre>
<p>如果你的应用程序上没有安装Ionic lab，你可以在你的终端上运行<code>npm i -D -E @ionic/lab</code>来安装它。</p>
<pre>ionic serve --lab
</pre>
<p>这将在浏览器中打开我们的应用程序端口8100。</p>
<p><img data-attachment-id="22045" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/app-open-on-port-8100/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/app-open-on-port-8100.png" data-orig-size="720,387" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="App open on port 8100" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/app-open-on-port-8100-300x161.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/app-open-on-port-8100.png" decoding="async" class="aligncenter size-full wp-image-22045 jetpack-lazy-image" src="../Images/b6c19f691df6b19a99b417ecc2485f89.png" alt="App Open on Port 8100" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/app-open-on-port-8100.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/app-open-on-port-8100-300x161.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/app-open-on-port-8100.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/app-open-on-port-8100.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22045" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/app-open-on-port-8100/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/app-open-on-port-8100.png" data-orig-size="720,387" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="App open on port 8100" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/app-open-on-port-8100-300x161.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/app-open-on-port-8100.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22045" src="../Images/b6c19f691df6b19a99b417ecc2485f89.png" alt="App Open on Port 8100" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/app-open-on-port-8100.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/app-open-on-port-8100-300x161.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/app-open-on-port-8100.png"/></noscript>
<h2 id="settinguptheuserinterface">设置用户界面</h2>
<p>是时候设置用户界面了。我们将从定制选项卡开始。</p>
<p>转到<code>src/app/tabs/tabs.page</code>并修改代码，如下所示:</p>
<pre>&lt;ion-tabs&gt;
  &lt;ion-tab-bar slot="bottom"&gt;
    &lt;ion-tab-button tab="tab1"&gt;
      &lt;ion-icon name="home-outline"&gt;&lt;/ion-icon&gt;
      &lt;ion-label&gt;Events&lt;/ion-label&gt;
    &lt;/ion-tab-button&gt;
    &lt;ion-tab-button tab="tab2"&gt;
      &lt;ion-icon name="add-outline"&gt;&lt;/ion-icon&gt;
      &lt;ion-label&gt;Add Event&lt;/ion-label&gt;
    &lt;/ion-tab-button&gt;
  &lt;/ion-tab-bar&gt;
&lt;/ion-tabs&gt;
</pre>
<p>我们将使用卡片来表示我们的事件，所以现在转到<code>src/app/tab1/tab1.page.html</code>并用下面的代码修改那里的代码。</p>
<pre>&lt;ion-header [translucent]="true"&gt;
  &lt;ion-toolbar&gt;
    &lt;ion-title&gt;
      Events
    &lt;/ion-title&gt;
  &lt;/ion-toolbar&gt;
&lt;/ion-header&gt;
&lt;ion-content [fullscreen]="true"&gt;
  &lt;ion-card&gt;
    &lt;img style="width:100%;height:250px;object-fit: cover;"
      src="https://images.pexels.com/photos/3323208/pexels-photo-3323208.jpeg?cs=srgb&amp;dl=woman-leaning-on-sinalco-cola-can-3323208.jpg&amp;fm=jpg"
      alt=""&gt;
    &lt;ion-card-header&gt;
      &lt;ion-card-subtitle&gt;Card Subtitle&lt;/ion-card-subtitle&gt;
      &lt;ion-card-title&gt;Card Title&lt;/ion-card-title&gt;
    &lt;/ion-card-header&gt;
    &lt;ion-card-content&gt;
      Keep close to Nature's heart... and break clear away, once in awhile,
      and climb a mountain or spend a week in the woods. Wash your spirit clean.
    &lt;/ion-card-content&gt;
  &lt;/ion-card&gt;
&lt;/ion-content&gt;
</pre>
<p>修改的结果应该如下所示:</p>
<p><img data-attachment-id="22041" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/modified-code-result/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/modified-code-result.png" data-orig-size="720,431" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Modified code result" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/modified-code-result-300x180.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/modified-code-result.png" decoding="async" class="aligncenter size-full wp-image-22041 jetpack-lazy-image" src="../Images/e44ea36b1ac863aa6402eca5f93bfd0f.png" alt="Modified Code Result" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/modified-code-result.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/modified-code-result-300x180.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/modified-code-result.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/modified-code-result.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22041" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/modified-code-result/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/modified-code-result.png" data-orig-size="720,431" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Modified code result" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/modified-code-result-300x180.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/modified-code-result.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22041" src="../Images/e44ea36b1ac863aa6402eca5f93bfd0f.png" alt="Modified Code Result" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/modified-code-result.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/modified-code-result-300x180.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/modified-code-result.png"/></noscript>
<p>在<code>tabs2</code>组件中创建一个表单，用于添加新事件。将以下内容添加到<code>src/app/tab2/tab2.page.html</code>。</p>
<pre>&lt;ion-header [translucent]="true"&gt;
  &lt;ion-toolbar&gt;
    &lt;ion-title&gt;
      Add Event
    &lt;/ion-title&gt;
  &lt;/ion-toolbar&gt;
&lt;/ion-header&gt;
&lt;ion-content [fullscreen]="true" class="ion-padding"&gt;
  &lt;div id="container"&gt;
    &lt;form&gt;
      &lt;ion-item id="rounded"&gt;
        &lt;ion-label position="stacked"&gt;Name&lt;/ion-label&gt;
        &lt;ion-input id="input"&gt;&lt;/ion-input&gt;
      &lt;/ion-item&gt;
      &lt;ion-item id="rounded"&gt;
        &lt;ion-input id="photo" name="file" type="file" accept="image/*" (change)="handleFileInput($event.target.files)"&gt;
        &lt;/ion-input&gt;
      &lt;/ion-item&gt;
      &lt;ion-item&gt;
        &lt;ion-label position="stacked"&gt;Description&lt;/ion-label&gt;
        &lt;ion-textarea rows="6" cols="20"&gt;&lt;/ion-textarea&gt;
      &lt;/ion-item&gt;
      &lt;div class="ion-padding"&gt;
        &lt;ion-button expand="block" type="submit" class="ion-no-margin"&gt;Add An Event&lt;/ion-button&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  &lt;/div&gt;


&lt;/ion-content&gt;
</pre>
<p>接下来，给<code>src/app/tab2/tab2.page.scss</code>添加一些样式。</p>
<pre>#rounded {
    width: 100%;
    margin-top: 30px;
    -moz-border-radius: 50px;
    -webkit-border-radius: 50px;
    border-radius: 10px;
    margin-bottom: 10px;
}
</pre>
<p><img data-attachment-id="22036" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/add-styles/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/add-styles.png" data-orig-size="720,438" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Add styles to events" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/add-styles-300x183.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/add-styles.png" decoding="async" class="aligncenter size-full wp-image-22036 jetpack-lazy-image" src="../Images/2acc1223b494bafc7139a214b8e660a1.png" alt="Add Styles to Events" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/add-styles.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/add-styles-300x183.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/add-styles.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/add-styles.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22036" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/add-styles/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/add-styles.png" data-orig-size="720,438" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Add styles to events" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/add-styles-300x183.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/add-styles.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22036" src="../Images/2acc1223b494bafc7139a214b8e660a1.png" alt="Add Styles to Events" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/add-styles.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/add-styles-300x183.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/add-styles.png"/></noscript>
<h2 id="creatingtheeventservice">创建事件服务</h2>
<p>下一步是创建一个服务来处理应用程序的所有HTTP请求。</p>
<pre>ionic generate service api/event
</pre>
<p>运行该命令将生成一个<code>api</code>目录。在<code>api</code>目录中，修改<code>event.service.ts</code>如下:</p>
<pre>import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';

@Injectable({
  providedIn: 'root'
})

export class EventService {
  readonly rootURL: string = 'http://localhost:4000';
  getAllEvents() {
    return this.http.get(`${this.rootURL}/event`);
  }
    addNewEvent(payload) {
      return this.http.post(`${this.rootURL}/event`, payload);
    }
  constructor(private http: HttpClient) {}
}
</pre>
<p>接下来，在你的<code>src/app/app.module.ts</code>中注册Angular的<code>HttpClientModule</code>。</p>
<pre>import { HttpClientModule } from '@angular/common/http';
</pre>
<p>然后，将其添加到<code>imports</code>数组中。</p>
<pre>  imports: [  ...other packages, HttpClientModule ]
</pre>
<h2 id="implementingtheapis">实现API</h2>
<p>我们现在可以将我们的服务引入到我们的<code>tab1</code>和<code>tab2</code>组件中。用下面的代码编辑<code>src/app/tab1/tab1.page.ts</code>中的代码。</p>
<pre>import { Component } from '@angular/core';
import { EventService } from '../../app/api/event.service';
@Component({
  selector: 'app-tab1',
  templateUrl: 'tab1.page.html',
  styleUrls: [ 'tab1.page.scss' ]
})
export class Tab1Page {
  constructor(private Event: EventService) {}
  events = [];
  getEvents() {
    console.log('hello');
    this.Event.getAllEvents().subscribe((data: any) =&gt; {
      this.events = data.data.reverse();
//the reverse method will get from the latest event added
    });
  }
  ngOnInit(): void {
    //Called after the constructor, initializing input properties, and the first call to ngOnChanges.
    //Add 'implements OnInit' to the class.
    this.getEvents();
  }
}
</pre>
<p>基本上，我们在这里做的是引入我们的事件服务，然后创建一个状态来保存所有的事件。我们还创建了一个新方法来查询所有事件，并将其注册到<code>ngOnInit</code>生命周期钩子中。</p>
<p>我们将通过修改代码在模板的卡片上显示我们的事件。</p>
<pre>&lt;ion-header [translucent]="true"&gt;
  &lt;ion-toolbar&gt;
    &lt;ion-title&gt;
      Events
    &lt;/ion-title&gt;
  &lt;/ion-toolbar&gt;
&lt;/ion-header&gt;
&lt;ion-content [fullscreen]="true"&gt;
  &lt;ion-card *ngFor="let event of events"&gt;
    &lt;img style="width:100%;height:250px;object-fit: cover;" [src]="event.image" alt=""&gt;
    &lt;ion-card-header&gt;
      &lt;ion-card-title&gt;{{event.name}}&lt;/ion-card-title&gt;
      &lt;ion-card-subtitle&gt;{{event.createdAt |date}}&lt;/ion-card-subtitle&gt;
    &lt;/ion-card-header&gt;
    &lt;ion-card-content&gt;
      {{event.description}}
    &lt;/ion-card-content&gt;
  &lt;/ion-card&gt;
&lt;/ion-content&gt;
</pre>
<p>这样做将显示我们数据库中的所有事件。</p>
<p><img data-attachment-id="22037" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/all-events-in-database/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/all-events-in-database.png" data-orig-size="720,439" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="All events in the database" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/all-events-in-database-300x183.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/all-events-in-database.png" decoding="async" class="aligncenter size-full wp-image-22037 jetpack-lazy-image" src="../Images/3c0a3af53c5dbe39ad1eee93f062c957.png" alt="All Events in the Database" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/all-events-in-database.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/all-events-in-database-300x183.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/all-events-in-database.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/all-events-in-database.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22037" data-permalink="https://blog.logrocket.com/build-an-event-keeper-app-with-ionic-and-aws/all-events-in-database/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/all-events-in-database.png" data-orig-size="720,439" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="All events in the database" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/all-events-in-database-300x183.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/all-events-in-database.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22037" src="../Images/3c0a3af53c5dbe39ad1eee93f062c957.png" alt="All Events in the Database" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/all-events-in-database.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/all-events-in-database-300x183.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/all-events-in-database.png"/></noscript>
<h2 id="implementingaddevents">实现添加事件</h2>
<p>在javascript中，我们使用<code>formData</code>来处理文件上传。我们将使用角度反应形式来处理文件上传。我们将从导入<code>src/app/tab2/tab2.module.ts</code>文件中的<code>FormsModule</code>和<code>ReactiveFormsModule</code>模块开始:</p>
<pre>import { FormsModule, ReactiveFormsModule } from '@angular/forms';
imports: [... other modules, FormsModule,ReactiveFormsModule, ],
</pre>
<p>我们现在可以在应用程序组件中使用Angular的反应形式。将<code>FormGroup</code>、<code>FormControl</code>和<code>EventService</code>导入到<code>tab2.page.ts</code>文件中，并使用<code>formControl</code>模块定义表单的一个实例。</p>
<pre>import { FormGroup, FormControl } from '@angular/forms';
import { EventService } from '../../app/api/event.service';


//this should be added inside the Tab2Page Class
eventForm = new FormGroup({
    name: new FormControl(''),
    description: new FormControl('')
  });
  constructor(private Event: EventService) {}
</pre>
<p>我们需要定义一个方法来处理文件上传的输入字段。这将是一个更改事件，当选择一个文件时将会观察。您的文件上传输入应该如下所示:</p>
<pre> &lt;ion-input id="photo" name="file" type="file" accept="image/*" (change)="handleFileInput($event.target.files)"&gt;
        &lt;/ion-input&gt;
</pre>
<p>接下来，创建一个保存文件的状态并定义<code>handleFileInput</code>方法。</p>
<pre>  fileToUpload: File = null;
  handleFileInput(files: FileList) {
    this.fileToUpload = files.item(0);
    console.log(this.fileToUpload);
  }
</pre>
<p>现在如果您选择一个图像来上传它，将被记录到控制台。试试吧！</p>
<p>接下来，创建一个添加新事件的方法。将以下方法添加到<code>tab2.page.ts</code>文件中。</p>
<pre>    addEvent() {
        const formData: FormData = new FormData();
        formData.append('image', this.fileToUpload, this.fileToUpload.name);
        formData.append('name', this.eventForm.value.name);
        formData.append('description', this.eventForm.value.description);
        this.Event.addNewEvent(formData).subscribe(
            (data: any) =&gt; {
                console.log(data);
            },
            (err: HttpErrorResponse) =&gt; {
                console.log({ error: err });
            }
        );
    }
</pre>
<p>使用表单数据将数据添加到输入字段中，然后将<code>addNewEvent</code>服务中的<code>formData</code>作为有效载荷传递。</p>
<p>这样做之后，将您的<code>tab2</code>表单修改如下。</p>
<pre>  &lt;form [formGroup]="eventForm" (submit)="addEvent()"&gt;
      &lt;ion-item id="rounded"&gt;
        &lt;ion-label position="stacked"&gt;Name&lt;/ion-label&gt;
        &lt;ion-input formControlName="name" id="input" required&gt;&lt;/ion-input&gt;
      &lt;/ion-item&gt;
      &lt;ion-item id="rounded"&gt;
        &lt;ion-input id="photo" type="file" accept="image/*" (change)="handleFileInput($event.target.files)"&gt;
        &lt;/ion-input&gt;
      &lt;/ion-item&gt;
      &lt;ion-item&gt;
        &lt;ion-label position="stacked"&gt;Description&lt;/ion-label&gt;
        &lt;ion-textarea formControlName="description" rows="6" cols="20" required&gt;&lt;/ion-textarea&gt;
      &lt;/ion-item&gt;
      &lt;div class="ion-padding"&gt;
        &lt;ion-button expand="block" type="submit" class="ion-no-margin"&gt;Add An Event&lt;/ion-button&gt;
      &lt;/div&gt;
    &lt;/form&gt;
</pre>
<p>现在刷新您的应用程序，并尝试添加一个新事件。</p>
<h2 id="addingspinnersandtoast">添加旋转器和吐司</h2>
<p>我们需要添加预加载器和toast，这样我们就可以向用户显示添加事件方法是否成功。toast将记录成功和错误消息。</p>
<p>导入<code>LoadingController</code>和<code>ToastController</code>，然后在构造函数中注册它们。</p>
<pre>import { LoadingController } from '@ionic/angular';
import { ToastController } from '@ionic/angular';

constructor(
        private Event: EventService,
        public loadingController: LoadingController,
        public toastController: ToastController
    ) {}
</pre>
<p>我们必须定义一个方法来显示和隐藏我们的加载器，并显示我们的祝酒词。</p>
<pre>    async presentLoading() {
        const loading = await this.loadingController.create({
            message: 'Please wait...',
            translucent: true
        });
        return await loading.present();
    }
    async presentToast(message) {
        const toast = await this.toastController.create({
            message: message,
            duration: 2000
        });
        return toast.present();
    }
</pre>
<p>我们现在可以修改我们的<code>addEvent</code>方法。</p>
<pre>addEvent() {
        this.presentLoading();
        const formData: FormData = new FormData();
        formData.append('image', this.fileToUpload, this.fileToUpload.name);
        formData.append('name', this.eventForm.value.name);
        formData.append('description', this.eventForm.value.description);
        this.Event.addNewEvent(formData).subscribe(
            (data: any) =&gt; {
                this.loadingController.dismiss();
                this.eventForm.reset();
                this.presentToast('Event Added');
            },
            (err: HttpErrorResponse) =&gt; {
                this.loadingController.dismiss();
                this.presentToast('Something Went Wrong');
                console.log({ error: err });
            }
        );
    }
</pre>
<p>恭喜你！您刚刚构建了一个简单的活动应用程序。</p>
<h2 id="conclusion">结论</h2>
<p>在本教程中，我们演示了如何用Ionic构建一个简单的应用程序。我们可以为我们的应用程序添加更好的功能，例如用户登录和注册。了解后端和移动应用程序如何通信将有助于您构建更大、更复杂、功能更丰富的应用程序。</p>
<p>对于本教程中使用的源代码，请前往<a href="https://github.com/Wisdom132/Ionic-and-AWS-app" target="_blank" rel="noopener noreferrer"> GitHub </a>。</p>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>