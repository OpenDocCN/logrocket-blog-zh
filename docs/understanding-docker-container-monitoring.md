# 了解 Docker 容器监控

> 原文：<https://blog.logrocket.com/understanding-docker-container-monitoring/>

Docker 是一个强大的工具，它使开发人员能够在容器化的环境中打包、部署和运行应用程序。Docker 容器是可移植的和轻量级的，这使它们成为开发人员构建、测试和部署应用程序的一个有吸引力的选择。

Docker 容器还为应用程序的运行提供了一个隔离的环境，这有助于确保应用程序不会相互干扰，并允许开发人员在同一台主机上运行一个应用程序的多个版本。Docker 容器有助于应用程序跨不同机器和环境的轻松分发和可伸缩性。

然而，在 Docker 容器中运行应用程序也带来了新的挑战，比如监控容器的健康和性能。在本文中，我们将深入探讨 Docker 容器监控。我们将讨论监控 Docker 容器的重要性、要跟踪的关键指标，以及用于监控它们的各种工具和技术。最后，我们将讨论 Docker 容器监控的最佳实践。

*向前跳转:*

## 什么是 Docker 容器监控？

Docker 容器监控是跟踪 Docker 容器中运行的应用程序的性能、健康状况和资源利用率的过程。Docker 容器中监控的一些标准指标包括:

1.  **资源利用度量**:指分配给 Docker 容器并由其使用的资源的度量。使用情况可以指示容器的工作负载是过重、最优还是过轻，并有助于解决容器内运行的应用程序的问题。这些指标的一些例子包括:
    *   CPU 使用率:容器使用的 CPU 时间的百分比
    *   内存使用量:正在使用的内存量
    *   磁盘使用量:正在使用的磁盘空间量
    *   网络使用:正在使用的网络带宽量
2.  **容器状态度量**:这些度量指的是 Docker 容器的状态，以帮助跟踪可用性、整体健康状况，并识别与容器相关的问题。这些指标的一些示例如下:
    *   容器运行时间:容器运行的时间。高正常运行时间可以作为容器稳定性和可靠性的指标
    *   容器重启:容器重启的次数。大量重新启动可能表明容器或其中运行的应用程序有问题
    *   容器退出:容器退出的次数。大量的集装箱出口可能是一个问题的指标
    *   状态:此指标是指容器本身的状态(例如，运行、停止、重新启动)
3.  **应用程序性能指标**:指 Docker 容器中运行的应用程序的性能指标。一些例子是:
    *   响应时间:容器化的应用程序响应请求所需的时间。跟踪响应时间有助于识别性能问题，并确保应用程序对最终用户做出响应
    *   请求速率:容器化应用程序每秒处理的请求数
    *   错误率:容器化应用程序遇到的错误数量
4.  **主机指标**:指运行 Docker 的物理或虚拟机的性能指标。这些指标对于监控是必不可少的，因为它们可以帮助识别与主机的整体健康和性能相关的问题，这些问题会影响主机上运行的 Docker 容器的性能和可用性。一些例子是:
    *   CPU 使用率
    *   内存使用
    *   磁盘使用
    *   网络使用
5.  **日志**:日志提供了容器内部活动和事件的详细记录。它指的是跟踪和分析 Docker 容器生成的日志输出
6.  **进程**:在容器内部运行的程序或任务

## 为什么监控码头集装箱很重要？

容器是现代应用程序开发和部署的重要组成部分，能够有效地监控它们对于任何容器化应用程序的成功都是至关重要的。

Docker 容器监控很重要，因为它允许您确保容器的健康和性能，这对应用程序的整体操作至关重要。它确保容器高效运行，并有助于及时识别和解决任何问题。监控码头集装箱很重要，原因有几个:

1.  **资源利用率**:监控 Docker 容器的资源利用率可以帮助确保容器以最佳方式运行，并且有足够的资源来执行它们的任务。这种对容器资源使用情况的可见性还有助于规划未来的容量需求
2.  **安全性**:监控您的 Docker 容器可以帮助您检测和防止安全漏洞，例如未经授权的访问或恶意代码注入
3.  **成本优化**:优化资源的使用可以节省成本。
4.  **合规性**:在某些情况下，监控您的码头集装箱可能需要遵守行业法规或标准
5.  **健康和可用性**:监控 Docker 容器的健康和可用性可以帮助您快速检测和解决问题，确保您的应用程序始终对您的用户可用
6.  **监控**:可以帮助识别瓶颈、优化性能、提醒问题，并为调试提供详细的日志和指标。

## 实时监控码头集装箱

有几种方法可以实时监控 Docker 容器:

1.  `docker logs`:查看正在运行的容器的日志
2.  `docker attach`:连接到正在运行的容器并查看其输出
3.  `docker top`:查看容器的运行过程
4.  `docker events`:从 Docker 守护进程中查看实时事件，比如当一个容器被创建或销毁时
5.  第三方工具:几个第三方工具可以实时监控 Docker 容器。这些工具通常提供更高级的监控和可视化功能，以及与其他 IT 系统和工具的集成

### `docker stats`命令

`docker stats`是 Docker 命令行界面(CLI)中使用的一个简单的内置命令，用于查看所有正在运行的容器的实时性能和资源使用统计数据。要使用该命令，必须首先在主机系统上安装 Docker。

`docker stats`命令的输出包括以下几列:

*   容器 ID:容器的唯一标识符
*   名称:容器的名称
*   CPU %:CPU 使用率的百分比
*   MEM 使用/限制:容器使用的内存量及其内存限制
*   MEM %:内存使用的百分比
*   网络输入输出:网络输入输出
*   块 I/O:块输入和输出
*   PIDS:容器中运行的进程数量

`docker stats`命令将默认显示所有正在运行的容器的统计数据。然而，一个特定的容器可以通过将它的名称或 ID 作为一个参数来指定，比如:`docker stats container-id`。

`docker stats`命令有几个选项允许输出定制，比如`--all`选项显示所有容器，甚至那些已经退出的容器，还有`--no-stream`选项禁用实时流，显示当前资源使用的快照。还有`--format`选项来指定输出的自定义格式。此选项使用 Go 模板语法，该语法允许您通过使用变量和控制结构来定义输出的布局和内容。

使用`docker stats`可以有效地实时监控容器的性能和资源使用情况。它可以方便地识别和排除应用程序的问题。然而，需要注意的是`docker stats`仅提供了资源使用的高级概述，需要更多来进行更详细和全面的监控和分析。

### 普罗米修斯

Prometheus 是一个开源监控和警报系统，非常适合监控 Docker 容器的资源使用和健康状况。要使用 Prometheus 来监视 Docker 容器，必须设置和配置 Prometheus 服务器，以便从容器中获取指标。

Prometheus 查询语言 PromQL 可用于创建警报和图表，使您能够监控容器的性能。有几种方法可以将 Prometheus 与 Docker 集成在一起。不过，一个标准方法是使用 Prometheus Docker Hub exporter，这是一个从 Docker 守护进程收集指标并将它们导出到 Prometheus 的容器。然后，您可以配置 Prometheus 服务器从导出器容器中抓取指标。

Prometheus 的几个关键特性使其非常适合监控码头集装箱:

*   可伸缩性:Prometheus 被设计成可水平伸缩的，这意味着它可以处理大量的 Docker 容器而不会降低性能
*   **警报** : Prometheus 包括一个内置的警报管理器，可以根据定义的规则发送通知。通知取决于特定的规则，例如，当容器的 CPU 使用率超过阈值时
*   **查询语言** : Prometheus 提供了一种强大的查询语言 PromQL，允许您实时过滤、聚集和分析指标。这对于创建警报和生成帮助您了解容器性能的图表非常有用
*   Grafana 集成 : Prometheus 与 Grafana 无缝集成，graf ana 是一种流行的开源工具，用于创建仪表板和可视化数据。这允许您创建定制的仪表板，以易于理解的方式显示您关心的指标。
*   灵活性:Prometheus 不依赖于任何特定的技术或平台，这意味着它可以用来监控运行在各种系统上的 Docker 容器
*   **可定制性:** Prometheus 允许定义收集和处理操作的定制指标和配置。该特征使得能够监控与相应环境相关的容器的特定方面。

总的来说，Prometheus 是一个监控 Docker 容器的强大工具，它是 DevOps 专业人员的热门选择。

### 管理员

cAdvisor，也称为 Container Advisor，是 Google 开发的用于监控和管理容器化应用程序的开源工具。它提供了关于单个容器的资源使用的详细信息，并帮助管理员优化他们的容器化应用程序的资源利用。

cAdvisor 作为 Docker 容器中的独立服务运行，并从同一主机上运行的所有容器中收集资源使用数据。然后，它通过一个简单的 web 界面以图形和表格的形式提供这些信息。cAdvisor 要求您的主机上安装 Docker。在主机上安装了 Docker 之后，从 Docker Hub 中拉出 cAdvisor 映像，并启动 cAdvisor 容器，如下所示:`docker pull google/cadvisor:latest`。

接下来，启动 cAdvisor 容器:

```
docker run --volume=/:/rootfs:ro --volume=/var/run:/var/run:rw --volume=/sys:/sys:ro --volume=/var/lib/docker/:/var/lib/docker:ro --publish=8080:8080 --detach=true --name=cadvisor google/cadvisor:latest

```

该命令将在后台以分离模式启动 cAdvisor 容器。`--publish`标志将容器的端口 8080 映射到主机的端口 8080，因此您可以在 [http://localhost:8080](http://localhost:8080/) 访问 cAdvisor web 界面。

默认情况下，cAdvisor 将收集主机上所有容器的资源使用数据。启动容器时，可以通过使用命令行标志或设置环境变量来自定义 cAdvisor 的行为。有关选项的完整列表，可以参考 cAdvisor 文档。

一旦 cAdvisor 启动并运行，您就可以访问 cAdvisor web 界面来查看各个容器的资源使用数据。该界面提供了几个显示资源使用数据的实时图形和表格。在 web 界面中，容器可以用自定义元数据进行标记，按各种标准进行分组，并在容器的资源使用超过特定阈值时设置警报。

cAdvisor 的几个关键特性使其非常适合监控 Docker 容器:

*   **实时资源使用数据** : cAdvisor 提供各个容器的详细资源使用数据，包括 CPU、内存和网络使用情况。这些数据会实时更新，使管理员能够快速识别和解决资源争用问题
*   **历史资源使用数据** : cAdvisor 存储每个容器的历史资源使用数据，允许管理员查看容器的资源使用如何随时间变化。此功能有助于容量规划和性能分析
*   **容器标记** : cAdvisor 允许管理员用定制元数据标记容器，这对于在 cAdvisor web 界面中分组和过滤容器非常有用
*   **容器分组** : cAdvisor 允许根据各种标准对容器进行分组，比如它们运行的主机或者它们基于的 Docker 映像。这个特性有助于比较不同容器组的资源使用情况
*   **容器警报** : cAdvisor 能够在容器的资源使用超过特定阈值时设置警报。此功能有助于主动识别和解决资源争用问题
*   **与其他工具的集成** : cAdvisor 集成了几个不同的工具，如 Google Cloud Monitoring、Grafana 和 Prometheus，允许管理员在其整体监控和管理策略的上下文中查看和分析资源使用数据。

## 结论

码头集装箱监控是管理和操作集装箱化环境的关键部分。通过监视容器，您可以确保应用程序平稳运行，发现并解决出现的问题，并优化容器的性能。

有几个开源工具可以用来实时监控 Docker 容器。这些工具提供了一系列功能，包括多维数据模型、强大的查询语言、高效的时间序列数据库和灵活的警报系统。

一些流行的开源选项包括 Prometheus、Grafana 和 cAdvisor。最终，监控 Docker 容器的正确工具将取决于您的特定需求和要求。然而，通过利用这些开源工具之一，您可以获得关于容器的性能和行为的有价值的见解，并确保您的应用程序平稳运行。

## 使用 [LogRocket](https://lp.logrocket.com/blg/signup) 消除传统错误报告的干扰

[![LogRocket Dashboard Free Trial Banner](img/d6f5a5dd739296c1dd7aab3d5e77eeb9.png)](https://lp.logrocket.com/blg/signup)

[LogRocket](https://lp.logrocket.com/blg/signup) 是一个数字体验分析解决方案，它可以保护您免受数百个假阳性错误警报的影响，只针对几个真正重要的项目。LogRocket 会告诉您应用程序中实际影响用户的最具影响力的 bug 和 UX 问题。

然后，使用具有深层技术遥测的会话重放来确切地查看用户看到了什么以及是什么导致了问题，就像你在他们身后看一样。

LogRocket 自动聚合客户端错误、JS 异常、前端性能指标和用户交互。然后 LogRocket 使用机器学习来告诉你哪些问题正在影响大多数用户，并提供你需要修复它的上下文。

关注重要的 bug—[今天就试试 LogRocket】。](https://lp.logrocket.com/blg/signup-issue-free)