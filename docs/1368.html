<html>
<head>
<title>Exploring zones in Next.js - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在Next.js - LogRocket博客中探索区域</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/exploring-zones-in-next-js/#0001-01-01">https://blog.logrocket.com/exploring-zones-in-next-js/#0001-01-01</a></blockquote><div><article class="article-post">
<p>Next.js非常棒，它已经成为前端开发人员青睐的工具。Next.js的发展令人惊叹——它有如此多的功能可以帮助我们快速轻松地编写生产就绪的应用程序。</p>
<p>框架期望所有的路线都在<code>pages</code>文件夹中。然而，在现实世界的场景中，我们将有许多团队在单独的页面或组件上工作，我们不能现实地期望他们致力于一个整体。</p>
<p>这个问题的解决方案是区域。根据<a href="https://nextjs.org/docs/advanced-features/multi-zones"> Next.js </a> <a href="https://nextjs.org/docs/advanced-features/multi-zones">文档</a>，区域是Next.js应用的单个部署。</p>
<p>Next.js允许您拥有多个用于部署单个Next.js应用程序的区域，并且可以在一个URL下访问所有区域。这允许不同的团队单独构建和部署应用程序的各个部分，而在用户端，它看起来是一个完整的应用程序。</p>
<h2>Next.js区域是如何工作的？</h2>
<p>区域没有任何来自Next.js的特定APIs它基于HTTP代理。您可以使用Vercel中内置的支持来实现多个区域，或者创建自己的HTTP代理。然而，Vercel试图通过不提供定制代理的例子来推销自己的部署，而是展示它在他们的平台中是多么简单。</p>
<h3>使用Vercel</h3>
<p>如果你用Vercel，那就相当简单了。它们内置了对区域的支持，你只需在<code>vercel.json</code>中列出你个人应用的版本以及为它们服务的路线。</p>
<p><img data-attachment-id="30090" data-permalink="https://blog.logrocket.com/exploring-zones-in-next-js/zones-implementation-vercel/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-vercel.png" data-orig-size="730,561" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Zones implementation using Vercel" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-vercel-300x231.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-vercel.png" decoding="async" class="aligncenter size-full wp-image-30090 jetpack-lazy-image" src="../Images/d81de9abe60fd438262065be5e492cb5.png" alt="Next.js Zones Implementation Using Vercel" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-vercel.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-vercel-300x231.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-vercel.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-vercel.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="30090" data-permalink="https://blog.logrocket.com/exploring-zones-in-next-js/zones-implementation-vercel/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-vercel.png" data-orig-size="730,561" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Zones implementation using Vercel" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-vercel-300x231.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-vercel.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-30090" src="../Images/d81de9abe60fd438262065be5e492cb5.png" alt="Next.js Zones Implementation Using Vercel" srcset="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-vercel.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-vercel-300x231.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-vercel.png"/></noscript>
<h3>使用自定义代理</h3>
<p>在自定义代理中，我们可以创建一个代理服务器，比如Nginx服务器。该服务器将在内部重定向到相应的Next.js应用程序。</p>
<p><img data-attachment-id="30091" data-permalink="https://blog.logrocket.com/exploring-zones-in-next-js/zones-implementation-http-proxy/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-http-proxy.png" data-orig-size="730,552" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Zones implementation using a Next.js proxy" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-http-proxy-300x227.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-http-proxy.png" decoding="async" class="aligncenter size-full wp-image-30091 jetpack-lazy-image" src="../Images/1e4719744f7c316a35271ecf58a71e39.png" alt="Next.js Zones Implementation Using an HTTP Proxy" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-http-proxy.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-http-proxy-300x227.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-http-proxy.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-http-proxy.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="30091" data-permalink="https://blog.logrocket.com/exploring-zones-in-next-js/zones-implementation-http-proxy/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-http-proxy.png" data-orig-size="730,552" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Zones implementation using a Next.js proxy" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-http-proxy-300x227.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-http-proxy.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-30091" src="../Images/1e4719744f7c316a35271ecf58a71e39.png" alt="Next.js Zones Implementation Using an HTTP Proxy" srcset="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-http-proxy.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-http-proxy-300x227.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/12/zones-implementation-http-proxy.png"/></noscript>
<p>使用区域时，有两个主要事项需要考虑:</p>
<ol>
<li>Next.js规定在每个区域中添加多个页面，但是没有两个页面可以在所有区域中具有相同的名称。因此，所有区域中的所有页面都应该有唯一的名称。</li>
<li>静态文件中存在潜在冲突的风险。</li>
</ol>
<p>为了解决静态文件之间的冲突，我们可以利用<code>assetPrefix</code>。这将基于<code>assetPrefix</code>为所有静态文件启用唯一的路径。在这里阅读更多<a href="https://nextjs.org/docs/api-reference/next.config.js/cdn-support-with-asset-prefix"/>。</p>
<pre>module.exports = {
  assetPrefix: "about/",
}</pre>
<h2>使用HTTP代理的示例实现</h2>
<h4 id="createtwonextjsapps">1.创建两个Next.js应用程序</h4>
<p>创建一个名为<code>nextjs-zones</code>的新文件夹，并使用<code>create-next-app</code>引导两个新的Next.js项目:<code>home</code>和<code>about</code>。</p>
<p>让我们在每个项目中创建一个页面。</p>
<pre>// home/pages/home.js
function Home() {
  return (
    &lt;div&gt;
      &lt;h1&gt;Home&lt;/h1&gt;
    &lt;/div&gt;
  );
}
export default Home;</pre>
<pre>// about/pages/about.js
function About() {
  return (
    &lt;div&gt;
      &lt;h1&gt;About&lt;/h1&gt;
    &lt;/div&gt;
  );
}
export default About;</pre>
<h4>2.在不同的端口上独立运行两个应用程序</h4>
<p>首页→ <code>localhost:3000</code></p>
<p>关于→ <code>localhost:3001</code></p>
<h4>3.创建一个Nginx反向代理并运行它</h4>
<pre># Sample nginx config

daemon off;
pid nginx.pid;

http {
    server {
        listen       8000;
        server_name  http://localhost:8000;
        proxy_buffering off;
        proxy_http_version 1.1;

        location / {
            proxy_pass    http://localhost:3000/home;
            proxy_redirect off;
        }
        location /about/ {
            proxy_pass    http://localhost:3001/about;
            proxy_redirect off;
        }
    }
}
events {
}</pre>
<p>现在Nginx服务器在<code>localhost:8000</code>运行，直接指向<code>Home</code>应用。同样，<code>localhost:8000/about</code>指向了<code>About</code>应用程序。虽然<code>Home</code>和<code>About</code>作为不同的应用程序运行，但现在都可以通过<code>localhost:8000</code>访问。</p>
<p>这是一个解释概念的非常幼稚的实现。更健壮的实现将反向代理Docker容器中的构建文件。</p>
<h2>使用Vercel的示例实现</h2>
<h4>1.创建两个Next.js应用程序</h4>
<p>遵循与上述相同的步骤<a href="#createtwonextjsapps">。</a></p>
<h4>2.创建一个<code>vercel.json</code>文件</h4>
<p>如果您使用Vercel作为部署平台，它支持开箱即用的区域。让我们用一些数据创建一个<code>vercel.json</code>文件，我们就可以开始了。</p>
<pre>// A sample vercel.json
{
  "version": 2,
  "build": {
    "env": {
      "BUILDING_FOR_NOW": "true"
    }
  },
  "builds": [
    { "src": "about/package.json", "use": "@now/next" },
    { "src": "home/package.json", "use": "@now/next" }
  ],
  "routes": [
    { "src": "/about(.*)", "dest": "about$1" },
    { "src": "(.*)", "dest": "home$1" }
  ]
}</pre>
<p>在这里，我们可以将不同类型的区域组合在一起，例如，SSG区域和下一个区域可以在同一个URL下工作。在上面的例子中，我们对<code>Home</code>和<code>About</code>都使用了<code>@now/next</code>，并且我们定义了路由来帮助Vercel基于URL决定加载哪个构建。</p>
<p>通过在更大程度上分离应用程序，这种方法有可能为使用Next.js的大型团队解决许多问题。这个特性可以更好地与webpack模块联邦一起使用，它可能真正成为微前端的下一个大事件。</p>
<p>如果你有更好的方法或思想，请在评论中告诉我。</p><div class="code-block code-block-30">
<div class="blog-plug inline-plug next-plug"><h2><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank"> LogRocket </a>:全面了解生产Next.js应用</h2><p>调试下一个应用程序可能会很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪状态、自动显示JavaScript错误、跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-lazy-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/></noscript></a><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><p>LogRocket 就像是网络和移动应用的DVR，记录下你的Next.js应用上发生的一切。您可以汇总并报告问题发生时应用程序的状态，而不是猜测问题发生的原因。LogRocket还可以监控应用程序的性能，报告客户端CPU负载、客户端内存使用等指标。</p><p>LogRocket Redux中间件包为您的用户会话增加了一层额外的可见性。LogRocket记录Redux存储中的所有操作和状态。</p><p>让您调试Next.js应用的方式现代化— <a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>