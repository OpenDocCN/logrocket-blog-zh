<html>
<head>
<title>How to create an avatar feature with React - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何用React - LogRocket博客创建头像功能</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/how-to-create-avatar-feature-react/#0001-01-01">https://blog.logrocket.com/how-to-create-avatar-feature-react/#0001-01-01</a></blockquote><div><article class="article-post">
<p>这些年来，化身已经成为一种提供用户视觉表示的流行方式，尤其是在涉及人与人之间交互的应用中。你有社交媒体应用、聊天应用、GitHub等等的头像。在这种情况下，头像是代表一个用户的图像(大部分是圆形的),使其他用户可以很容易地识别它们。</p>
<p>如果您试图实现一种方法，让您的用户从零开始在React应用程序中上传他们的头像照片，您将不得不担心许多事情，例如接受用户照片，裁剪和调整这些照片的大小，以及可能将它们编码为base64这样的格式，以便下载或发送到服务器进行存储。</p>
<p>这可能很耗时，而且在大多数情况下，最好不要重新发明轮子，最好使用现有的库。一个这样的库是<a href="https://github.com/kirill3333/react-avatar"> react-avatar </a>。</p>
<p>在本文中，我们将看看这个库，它做什么，并在文章结束时，创建一个简单的React应用程序，用户可以在其中从他们的计算机导入图像，用它来制作头像，并将头像下载到他们的计算机。</p>
<h3>先决条件</h3>
<p>为了更好地理解本文，您应该对React和JavaScript有一个基本的了解。</p>
<h2>react-avatar库</h2>
<p>react-avatar是一个基于react的库，允许你实现头像创建，允许用户预览和裁剪他们喜欢的图像来创建头像。它也是可定制的，因此您可以设计React组件的样式以适合应用程序的其余部分。现在我们已经讨论了最基本的内容，让我们来看看一些代码。</p>
<h3><code>Avatar</code>组件</h3>
<p>该库唯一的组件是<code>Avatar</code>组件，我们用它来为我们的虚拟形象选择和裁剪图像。下面是使用中的<code>Avatar</code>组件的一个基本示例:</p>
<pre>function App() {
  const [preview, setPreview] = useState(null);
  function onClose() {
    setPreview(null);
  }
  function onCrop(pv) {
    setPreview(pv);
  }
  function onBeforeFileLoad(elem) {
    if (elem.target.files[0].size &gt; 71680) {
      alert("File is too big!");
      elem.target.value = "";
    }
  }
  return (
    &lt;div&gt;
      &lt;Avatar
        width={300}
        height={300}
        onCrop={onCrop}
        onClose={onClose}
        onBeforeFileLoad={onBeforeFileLoad}
        src={null}
      /&gt;
      {preview &amp;&amp; &lt;img src={preview} alt="Preview" /&gt;}
    &lt;/div&gt;
  );
}
export default App;</pre>
<p>使用上面的代码，浏览器上的结果应该如下所示:</p>
<p><img data-attachment-id="28802" data-permalink="https://blog.logrocket.com/how-to-create-avatar-feature-react/avatar-preview-box/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/11/avatar-preview-box.jpeg" data-orig-size="632,340" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The avatar preview box" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/11/avatar-preview-box-300x161.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/11/avatar-preview-box.jpeg" decoding="async" class="aligncenter size-full wp-image-28802 jetpack-lazy-image" src="../Images/98a2ac357717e5407a3f8722e3ff37f1.png" alt="The Avatar Preview Box" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/11/avatar-preview-box.jpeg 632w, https://blog.logrocket.com/wp-content/uploads/2020/11/avatar-preview-box-300x161.jpeg 300w" data-lazy-sizes="(max-width: 632px) 100vw, 632px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/11/avatar-preview-box.jpeg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/11/avatar-preview-box.jpeg"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="28802" data-permalink="https://blog.logrocket.com/how-to-create-avatar-feature-react/avatar-preview-box/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/11/avatar-preview-box.jpeg" data-orig-size="632,340" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The avatar preview box" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/11/avatar-preview-box-300x161.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/11/avatar-preview-box.jpeg" decoding="async" loading="lazy" class="aligncenter size-full wp-image-28802" src="../Images/98a2ac357717e5407a3f8722e3ff37f1.png" alt="The Avatar Preview Box" srcset="https://blog.logrocket.com/wp-content/uploads/2020/11/avatar-preview-box.jpeg 632w, https://blog.logrocket.com/wp-content/uploads/2020/11/avatar-preview-box-300x161.jpeg 300w" sizes="(max-width: 632px) 100vw, 632px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/11/avatar-preview-box.jpeg"/></noscript>
<p>你现在可以点击这个框，我以后称之为预览框，来选择一张图片作为你的头像。就是这么简单！</p>
<p>在我们继续之前，我想解释一下<code>Avatar</code>组件的不同道具。</p>
<h3><code>height</code>和<code>width</code></h3>
<p>这些属性定义了预览框的高度和宽度。</p>
<h3 id="oncrop"><code>onCrop</code></h3>
<p>您可以将<code>onCrop</code>视为一个事件监听器，每当头像图像被裁剪时就会被触发。由于<code>onCrop</code>是一个函数，它可以带参数；在这种情况下，参数是以base64格式编码的裁剪图像。</p>
<h3><code>onClose</code></h3>
<p>选择图像后，预览框的左上角会出现一个取消图标。</p>
<p><img data-attachment-id="28804" data-permalink="https://blog.logrocket.com/how-to-create-avatar-feature-react/cancel-icon-onclose-event/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/11/cancel-icon-onclose-event.jpeg" data-orig-size="600,300" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="The cancel icon triggers the onClose event" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/11/cancel-icon-onclose-event-300x150.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/11/cancel-icon-onclose-event.jpeg" decoding="async" class="aligncenter size-full wp-image-28804 jetpack-lazy-image" src="../Images/d4485de8ee2f191f2207461adb3f4ac2.png" alt="The Cancel Icon Triggers the onClose Event" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/11/cancel-icon-onclose-event.jpeg 600w, https://blog.logrocket.com/wp-content/uploads/2020/11/cancel-icon-onclose-event-300x150.jpeg 300w" data-lazy-sizes="(max-width: 600px) 100vw, 600px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/11/cancel-icon-onclose-event.jpeg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/11/cancel-icon-onclose-event.jpeg"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="28804" data-permalink="https://blog.logrocket.com/how-to-create-avatar-feature-react/cancel-icon-onclose-event/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/11/cancel-icon-onclose-event.jpeg" data-orig-size="600,300" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="The cancel icon triggers the onClose event" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/11/cancel-icon-onclose-event-300x150.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/11/cancel-icon-onclose-event.jpeg" decoding="async" loading="lazy" class="aligncenter size-full wp-image-28804" src="../Images/d4485de8ee2f191f2207461adb3f4ac2.png" alt="The Cancel Icon Triggers the onClose Event" srcset="https://blog.logrocket.com/wp-content/uploads/2020/11/cancel-icon-onclose-event.jpeg 600w, https://blog.logrocket.com/wp-content/uploads/2020/11/cancel-icon-onclose-event-300x150.jpeg 300w" sizes="(max-width: 600px) 100vw, 600px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/11/cancel-icon-onclose-event.jpeg"/></noscript>
<p>点击该图标将触发<code>onClose</code>事件监听器，传递给<code>onClose</code>道具的函数将运行。在上面的代码中，我们在预览框关闭时将预览状态变量设置为null。</p>
<h3><code>onBeforeFileLoad</code></h3>
<p>在幕后，预览框包含一个<code>&lt;input type="file"&gt;</code>元素，这是它能够从用户的计算机中获取文件进行处理的方式。</p>
<p>当用户选择一个图像作为他们的头像时，就会触发<code>onBeforeFileLoad</code>,传递给它的参数是文件选择事件的事件对象。从这个对象中，我们可以获得关于所选文件的信息，比如它的大小，并使用这些信息来执行其他操作，比如限制用于化身的图像的大小(就像我们的例子一样)。</p>
<p>还要注意，如果文件大小大于指定的大小，我们将目标元素的<code>value</code>属性设置为空字符串。这是因为库检查了<code>value</code>属性，如果它是一个空字符串，就停止头像创建过程(这是我们想要的)。</p>
<h3><code>onFileLoad</code></h3>
<p><code>onFileLoad</code>是另一个事件监听器，它几乎在<code>onBeforeFileLoad</code>函数运行后立即被调用。它还接受事件的事件对象，因此您可以在这里做您在<code>onBeforeFileLoad</code>中会做的任何事情。唯一的区别是，在调用<code>onFileLoad</code>函数之前，库确保事件对象的<code>value</code>属性不为空。</p>
<h3><code>label</code>和<code>labelStyle</code></h3>
<p><code>label</code>定义选择图像前预览框上显示的文本，而<code>labelStyle</code>定义该文本的样式。</p>
<p>现在我们已经介绍了大部分的道具，我们可以构建一个简单的应用程序，它允许用户创建头像并下载到他们的设备上。</p><div class="code-block code-block-54">
<hr/>
<h3>更多来自LogRocket的精彩文章:</h3>

<hr/></div>
<h2>设置React项目</h2>
<p>首先，我们需要建立一个新的React项目。您可以使用create-react-app轻松做到这一点:</p>
<pre>npx create-react-app avatar-project</pre>
<p>一旦我们完成了React项目的创建，我们需要安装react-avatar库作为依赖项。在您的终端中，安装如下:</p>
<pre>npm install react-avatar-edit</pre>
<p>现在我们已经建立了项目，让我们从代码开始。我们可以使用上面第一个代码块中的代码作为起点，因此将其复制到您的代码编辑器中。</p>
<p>既然我们有办法用我们的图像制作头像，我们只需要找到一种方法将头像下载到我们的设备上。我们可以很容易地使用一个锚标签，将<code>download</code>属性设置为下载的虚拟角色的名称(可以是我们想要的任何名称)，将<code>href</code>属性设置为虚拟角色的base64编码格式，这是<code>preview</code>状态变量的值。</p>
<p>我们的简单应用程序的代码应该如下所示:</p>
<pre>import React from "react";
import Avatar from "react-avatar-edit";
import { useState } from "react";

function App() {
  const [preview, setPreview] = useState(null);
  function onClose() {
    setPreview(null);
  }
  function onCrop(pv) {
    setPreview(pv);
  }
  function onBeforeFileLoad(elem) {
    if (elem.target.files[0].size &gt; 2000000) {
      alert("File is too big!");
      elem.target.value = "";
    }
  }
  return (
    &lt;div&gt;
      &lt;Avatar
        width={600}
        height={300}
        onCrop={onCrop}
        onClose={onClose}
        onBeforeFileLoad={onBeforeFileLoad}
        src={null}
      /&gt;
      &lt;br/&gt;
      {preview &amp;&amp; (
        &lt;&gt;
          &lt;img src={preview} alt="Preview" /&gt;
          &lt;a href={preview} download="avatar"&gt;
            Download image
          &lt;/a&gt;
        &lt;/&gt;
      )}
    &lt;/div&gt;
  );
}
export default App;</pre>
<p>现在，用户应该能够根据他们喜欢的图像创建头像，并将这些头像下载到他们的设备上。</p>
<h2>用户化</h2>
<p>您可能会决定自定义预览框，以适应您的应用程序的主题，或者使您的应用程序看起来更有趣。如前所述，在选择图像之前，您可以使用<code>label</code>和<code>labelStyle</code>来自定义显示在预览框中心的文本。</p>
<p>还有其他的定制道具，像<code>borderStyle</code>，我们可以用来定制预览框的边框样式；<code>backgroundColor</code>，设置选中图像时预览框的背景颜色；<code>shadingColor</code>用于定制所选图像要裁剪部分的颜色；和其他人。</p>
<h2>结论</h2>
<p>就这样，我们结束了！现在，您应该能够在React应用程序中实现一个头像创建功能。要了解这个库的更多信息，您可以点击这里查看GitHub上的库。</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720"><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener"> LogRocket </a>:全面了解您的生产React应用</h2><p>调试React应用程序可能很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪Redux状态、自动显示JavaScript错误以及跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" vwo-el-id="19356441070">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<p vwo-el-id="28675660440" class="">LogRocket 结合了会话回放、产品分析和错误跟踪，使软件团队能够创建理想的web和移动产品体验。这对你来说意味着什么？</p>
<p>LogRocket不是猜测错误发生的原因，也不是要求用户提供截图和日志转储，而是让您回放问题，就像它们发生在您自己的浏览器中一样，以快速了解哪里出错了。</p>
<p>不再有嘈杂的警报。智能错误跟踪允许您对问题进行分类，然后从中学习。获得有影响的用户问题的通知，而不是误报。警报越少，有用的信号越多。</p>
<p vwo-el-id="28675660750">LogRocket Redux中间件包为您的用户会话增加了一层额外的可见性。LogRocket记录Redux存储中的所有操作和状态。</p>
<p vwo-el-id="28675661060">现代化您调试React应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">开始免费监控</a>。</p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>