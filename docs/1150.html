<html>
<head>
<title>GraphQL API mocking with json-graphql-server - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用json-graphql-server - LogRocket博客模仿GraphQL API</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/mocking-graphql-api-server-using-json-graphql-server/#0001-01-01">https://blog.logrocket.com/mocking-graphql-api-server-using-json-graphql-server/#0001-01-01</a></blockquote><div><div class="mainheading">


<h1 class="posttitle">用json-graphql-server嘲笑GraphQL应用编程接口</h1>
  <h2 class="post-subtitle"/>
<p><span class="post-date"><time class="post-date">2020年9月16日</time> </span> <span class="dot"/> <span class="readingtime"> 2分钟阅读</span> <span class="wordcount"> 643 </span> <span class="logrocket_editor"/></p>
</div>
<article class="article-post">
<p>API模仿是创建真实API服务器的模拟的实践，这样您就可以对请求提供真实的响应。Mocks模拟真实API的行为，但是以更可控的方式，将模式与数据类型、对象和数组相匹配。</p>
<h2 id="whymock">为什么要嘲笑？</h2>
<p>当实时数据不可用或不可靠时，API mocking是快速原型化和测试前端应用程序的好方法。如果后端和前端开发是并行进行的，那么可以使用模拟API同时对它们进行处理，这样真实API的缺失不会停止前端的开发。</p>
<p>API模拟使前端工程师能够使用与<a href="https://www.quora.com/What-is-an-API-contract-and-who-should-create-it-when-building-a-set-of-APIs"> API合同</a>中规定的最终生产API相同的数据来使用API。通过在开发真正的API之前使用模拟API，后端工程师可以识别不足之处，而无需花费工程时间来开发可能会或可能不会发布到产品中的功能。这种快速反馈循环有助于提高工程团队的效率。</p>
<p>您可以使用API mocking在本地运行测试，而无需连接到真正的后端，这样会更快、更安全。如果您有一个为每个新部署运行测试的持续集成/持续部署(CI/CD)管道，您可能不希望等待对外部API的几次实时调用。模拟API服务器可以返回所需的结果，因此您可以对代码进行单元测试。</p>
<p>您还可以使用模拟API来模拟您无法控制的外部API的行为。例如，当您没有连接到互联网时，API服务器可以用来提供公共API的虚假结果，甚至为他们的提供商要求您购买的服务提供模拟数据响应。</p>

<p>对于编写GraphQL API模拟，有许多开源工具可用。一些流行的解决方案包括:</p>

<p>让我们放大一下GraphQL API模拟中最流行、最有用的工具之一:json-graphql-server。</p>
<h2 id="jsongraphqlserver">json图形SQL服务器</h2>
<p>json-graphql-server是一个测试和模仿graphql的工具，它对你的数据进行json。它在30秒内生成了一个完整的假GraphQL API，零编码。</p>
<p>要安装json-graphql-server，请运行以下命令。</p>
<pre>npm install -g json-graphql-server
</pre>
<p>在项目的根文件夹中创建一个<code>graphql-server.json</code>文件，并在其中添加一个JSON对象。这些值应该是实体的列表——也就是至少有一个<code>id</code>键的值对象的数组。</p>
<pre>{
  "todo": [
    {
      "id": 1,
      "title": "Lorem Ipsum",
      "status":"open"
    },
    {
      "id": 2,
      "title": "Sic Dolor amet",
      "status":"open"
    }
  ],
  "users": [
    {
      "id": 123,
      "name": "John Doe"
    },
    {
      "id": 456,
      "name": "Jane Doe"
    }
  ],
  "done": [
    {
      "id": "foo",
      "name": "Foo",
      "status":"completed"
    },
    {
      "id": "bar",
      "name": "Bar",
      "status":"completed"
    }
  ]
}
</pre>
<p>在本地主机端口5000上启动GraphQL服务器。</p>
<pre>json-graphql-server graphql-server.json --p 5000
</pre>
<p>如果不添加标志<code>--p &lt;port number&gt;</code>，服务器将使用默认端口3000启动。</p>
<p>您现在可以通过<code>http:localhost:5000/graphql</code>访问GraphQL API并执行GraphQL查询。</p>
<pre>{
  Todo(id: 1){
    id
    title
    status
  }
}
</pre>
<p>上面的查询将产生以下响应。</p>
<pre>{
  "data": {
    "Todo": {
      "id": "1",
      "title": "Lorem Ipsum",
      "status": "open"
    }
  }
}
</pre>
<p>JSON GraphQL服务器是支持GraphQL的，这意味着它包括一个可以进行GraphQL查询和变化的平台。</p>
<p><img data-attachment-id="25213" data-permalink="https://blog.logrocket.com/mocking-graphql-api-server-using-json-graphql-server/json-graphql-server-playground/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/09/json-graphql-server-playground.png" data-orig-size="720,365" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="JSON GraphQL server playground" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/09/json-graphql-server-playground-300x152.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/09/json-graphql-server-playground.png" decoding="async" class="aligncenter size-full wp-image-25213 jetpack-lazy-image" src="../Images/e5e0ef1f23f050ec9038d509bd15d80e.png" alt="JSON GraphQL Server Playground" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/09/json-graphql-server-playground.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/09/json-graphql-server-playground-300x152.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/09/json-graphql-server-playground.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/09/json-graphql-server-playground.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="25213" data-permalink="https://blog.logrocket.com/mocking-graphql-api-server-using-json-graphql-server/json-graphql-server-playground/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/09/json-graphql-server-playground.png" data-orig-size="720,365" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="JSON GraphQL server playground" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/09/json-graphql-server-playground-300x152.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/09/json-graphql-server-playground.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-25213" src="../Images/e5e0ef1f23f050ec9038d509bd15d80e.png" alt="JSON GraphQL Server Playground" srcset="https://blog.logrocket.com/wp-content/uploads/2020/09/json-graphql-server-playground.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/09/json-graphql-server-playground-300x152.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/09/json-graphql-server-playground.png"/></noscript>
<h3>在Apollo客户机上使用json-graphql-server</h3>
<pre>import { ApolloClient, InMemoryCache } from '@apollo/client';
import { gql } from '@apollo/client'

// setup Apollo Client
const client = new ApolloClient({
  uri: 'http://localhost:5000/graphql',
  cache: new InMemoryCache()
});

//  make a query
client
  .query({
    query: gql`
      query Todo($id: ID!) {
        Todo(id: $id) {
          id
          title
          status
        }
      }
    `,
  variables: {id: 1}
  })
  .then(result =&gt; console.log(result));
</pre>
<h2 id="conclusion">结论</h2>
<p>在本指南中，我们概述了如何将JSON GraphQL服务器用于Apollo客户端。查看文档，了解如何使用Node、browser fetch、XMLHttpRequest和webpack。也可以使用假数据生成器来填充<code>graphql-server.json</code>，例如<a href="https://www.npmjs.com/package/faker" target="_blank" rel="noopener noreferrer"> faker </a>和<a href="https://chancejs.com/index.html" target="_blank" rel="noopener noreferrer"> Chance </a>。</p><div class="code-block code-block-24">
<div class="blog-plug inline-plug graphql-plug"><h2>监控生产中失败和缓慢的GraphQL请求</h2><p>虽然GraphQL有一些调试请求和响应的特性，但确保GraphQL可靠地为您的生产应用程序提供资源是一件比较困难的事情。如果您对确保对后端或第三方服务的网络请求成功感兴趣，</p><a href="https://lp.logrocket.com/blg/graphql-signup" target="_blank">try LogRocket</a><p>.</p><a class="signup" href="https://lp.logrocket.com/blg/graphql-signup" target="_blank" rel="noopener noreferrer"><img src="../Images/432a3823c85b3fb72a206e6236a29f48.png" data-lazy-src="https://files.readme.io/69aa835-Image_2019-11-09_at_1.28.05_PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://files.readme.io/69aa835-Image_2019-11-09_at_1.28.05_PM.png"/><noscript><img data-lazy-fallback="1" src="../Images/432a3823c85b3fb72a206e6236a29f48.png" data-original-src="https://files.readme.io/69aa835-Image_2019-11-09_at_1.28.05_PM.png"/></noscript><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><a href="https://lp.logrocket.com/blg/graphql-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用的DVR，记录下你网站上发生的每一件事。您可以汇总并报告有问题的GraphQL请求，以快速了解根本原因，而不是猜测问题发生的原因。此外，您可以跟踪Apollo客户机状态并检查GraphQL查询的键值对。</p><p>LogRocket检测您的应用程序以记录基线性能计时，如页面加载时间、到达第一个字节的时间、慢速网络请求，还记录Redux、NgRx和Vuex操作/状态。</p><a class="signup" href="https://lp.logrocket.com/blg/graphql-signup" target="_blank" rel="noopener noreferrer">Start monitoring for free</a><p>.</p></div>


</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>