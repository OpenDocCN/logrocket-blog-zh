<html>
<head>
<title>React custom datepicker: Step-by-step - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>React自定义日期选择器:一步一步日志火箭博客</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/react-custom-datepicker-step-by-step/#0001-01-01">https://blog.logrocket.com/react-custom-datepicker-step-by-step/#0001-01-01</a></blockquote><div><article class="article-post">
<p><strong> <em>编者按</em> </strong>:本帖最后更新于2022年2月1日，以解决React Hooks的更新问题。</p>
<p>在web上看到包含一个或多个日期字段的表单是很常见的。无论是人的出生日期还是航班时刻表，您都希望确保用户提供有效的日期。日期选择器是一个有用的附加功能，可以显示日历和日期输入字段，使应用程序用户可以轻松安排活动或填写注册表单。</p>
<p>HTML5引入了一个<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/date"> <code>date</code>输入类型</a>来改进表单中的日期值。<code>date</code>输入类型向用户呈现了一个日期选择器，但是，这个日期选择器的外观在不同的浏览器中是不一致的。</p>
<p><img data-attachment-id="90544" data-permalink="https://blog.logrocket.com/1html5-date-element-render-browsers/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/1html5-date-element-render-browsers.jpeg" data-orig-size="730,365" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="html5-date-element-render-browsers" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/1html5-date-element-render-browsers-300x150.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/1html5-date-element-render-browsers.jpeg" decoding="async" class="aligncenter wp-image-90544 size-full jetpack-lazy-image" src="../Images/8fb822cd71a84fe3cd1571a501171df8.png" alt="HTML5 Date Element Render Browsers" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/1html5-date-element-render-browsers.jpeg 730w, https://blog.logrocket.com/wp-content/uploads/2022/01/1html5-date-element-render-browsers-300x150.jpeg 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/1html5-date-element-render-browsers.jpeg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/1html5-date-element-render-browsers.jpeg"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="90544" data-permalink="https://blog.logrocket.com/1html5-date-element-render-browsers/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/1html5-date-element-render-browsers.jpeg" data-orig-size="730,365" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="html5-date-element-render-browsers" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/1html5-date-element-render-browsers-300x150.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/1html5-date-element-render-browsers.jpeg" decoding="async" loading="lazy" class="aligncenter wp-image-90544 size-full" src="../Images/8fb822cd71a84fe3cd1571a501171df8.png" alt="HTML5 Date Element Render Browsers" srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/1html5-date-element-render-browsers.jpeg 730w, https://blog.logrocket.com/wp-content/uploads/2022/01/1html5-date-element-render-browsers-300x150.jpeg 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/1html5-date-element-render-browsers.jpeg"/></noscript>
<p>对于用户来说，大多数主流浏览器都将<code>date</code>输入类型贬低为<code>text</code>输入，导致了用户界面的呈现和数据格式的问题。当用户输入基于文本的输入时，日期可能会出现格式问题。例如，对于全球使用的各种日期格式，缺少对用户的说明可能会导致处理数据的困难，从而导致在浏览器中显示错误消息。</p>
<p>在本文中，我们将通过使用原生JavaScript <code>Date</code>对象从头构建一个自定义的React datepicker来解决这个问题。</p>
<p><img data-attachment-id="90546" data-permalink="https://blog.logrocket.com/2final-react-datepicker/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/2final-react-datepicker.gif" data-orig-size="480,480" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="final-react-datepicker" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/2final-react-datepicker-300x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/2final-react-datepicker.gif" decoding="async" class="aligncenter wp-image-90546 size-full jetpack-lazy-image" src="../Images/9a2d3be2fafeb8e4ae9fc75341d2108c.png" alt="Final React Datepicker" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/2final-react-datepicker.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/2final-react-datepicker.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="90546" data-permalink="https://blog.logrocket.com/2final-react-datepicker/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/2final-react-datepicker.gif" data-orig-size="480,480" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="final-react-datepicker" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/2final-react-datepicker-300x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/2final-react-datepicker.gif" decoding="async" loading="lazy" class="aligncenter wp-image-90546 size-full" src="../Images/9a2d3be2fafeb8e4ae9fc75341d2108c.png" alt="Final React Datepicker" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/2final-react-datepicker.gif"/></noscript>
<p>要跟随本教程，您需要以下内容:</p>
<ul>
<li>熟悉JavaScript和React</li>
<li>安装在计算机上的Node.js</li>
<li>机器上安装的纱线卷装管理器</li>
<li>在您的机器上创建全局安装的React应用程序</li>
</ul>
<blockquote><p>注意:如果您使用的是NPM v 5.2以上版本，那么您不需要安装Create React App作为全局依赖项。相反，您可以使用npx命令。</p></blockquote>
<p>如果你在某个地方卡住了，可以随意看看<a href="https://github.com/atharvadeosthale/date-picker-react"> GitHub库</a>。我们开始吧！</p>
<h3>目录</h3>

<h2 id="getting-started">入门指南</h2>
<h3 id="create-new-react-app">创建新的React应用程序</h3>
<p>首先，要创建一个新的React应用程序，运行下面的命令，这是创建自定义React datepicker的快速起点:</p>
<pre class="language-bash hljs">npx create-react-app react-datepicker
cd react-datepicker
npm start
</pre>
<p>或者，如果您使用yarn，您可以运行下面的代码:</p>
<pre class="language-bash hljs">yarn create react-app react-datepicker
</pre>
<p>npx在npm v≥5.2中可用，您可以使用它在您的机器上全局安装Create React App。如果您已经使用下面的命令安装了Create React App，您应该卸载它以确保npx使用的是最新版本:</p>
<pre class="language-bash hljs">npm install -g create-react-app
</pre>
<p>要卸载该软件包，可以使用以下命令之一:</p>
<pre class="language-bash hljs">//npm
npm uninstall -g create-react-app 
//yarn
yarn global remove create-react-app
</pre>
<h3 id="install-dependencies">安装依赖项</h3>
<p>要通过Yarn安装所需的依赖项，请运行以下命令:</p>
<pre class="language-bash hljs">yarn add bootstrap reactstrap styled-components prop-types
</pre>
<p>要通过npm安装依赖项，只需将<code>--use-npm</code>附加到创建命令，如下所示:</p>
<pre class="language-bash hljs">npx create-react-app react-datepicker --use-npm
</pre>
<h3 id="install-bootstrap">安装引导程序</h3>
<p>为了提供默认样式，我们已经将引导包作为依赖项安装了<a href="https://blog.logrocket.com/whats-new-bootstrap-5-1-0/">。要包含Bootstrap v.4样式，请编辑<code>src/index.js</code>文件，并在每隔一个导入语句之前添加以下行:</a></p>
<pre class="language-bash hljs">import "bootstrap/dist/css/bootstrap.min.css";
</pre>
<h2 id="setting-up-the-directory-components">设置目录组件</h2>
<p>我们的应用程序需要以下两个组件:</p>
<ol>
<li><code>calendar</code>:呈现自定义日历，提供日期选择功能</li>
<li><code>datepicker</code>:呈现一个<code>date</code>输入，并为用户提供日历以选择日期</li>
</ol>
<p>我们将用两个文件<code>index.js</code>和<code>styles.js</code>将每个组件存储在它自己的目录中。<code>index.js</code>文件导出组件，而<code>styles.js</code>文件导出样式化组件，这是组件添加样式所需要的。</p>
<p>要创建组件目录和文件，请从项目的根目录运行以下命令:</p>
<pre class="language-javascript hljs"># Create directories
mkdir -p src/components/Calendar src/components/Datepicker

# Create files
cd src/components/Calendar &amp;&amp; touch index.js styles.js
cd src/components/Datepicker &amp;&amp; touch index.js styles.js
</pre>
<p>我们的应用程序不需要任何外部依赖来处理日期。相反，我们将使用助手函数。要为日历<code>helpers</code>模块创建一个文件，运行以下命令:</p>
<pre class="language-javascript hljs">mkdir -p src/helpers
touch src/helpers/calendar.js
</pre>
<h3 id="start-application">启动应用程序</h3>
<p>通过在终端中运行以下命令之一来启动应用程序:</p>
<pre class="language-bash hljs">//yarn
yarn start

//npm
npm start</pre>
<p>现在，我们可以开始开发了。你会注意到，一个新的浏览器标签已经为你打开了实时重载功能，与应用程序中的变化保持同步。</p>
<h2 id="calendar-helpers-module">日历<code>helpers</code>模块</h2>
<p>在我们之前创建的calendar <code>helpers</code>模块中，我们将定义一些助手和常量，我们将把它们导出为命名导出。将以下代码添加到<code>src/helpers/calendar.js</code>文件中:</p>
<pre class="language-javascript hljs">// (int) The current year
export const THIS_YEAR = +(new Date().getFullYear());
// (int) The current month starting from 1 - 12
// 1 =&gt; January, 12 =&gt; December
export const THIS_MONTH = +(new Date().getMonth()) + 1;
// Week days names and shortnames
export const WEEK_DAYS = {
  Sunday: "Sun",
  Monday: "Mon",
  Tuesday: "Tue",
  Wednesday: "Wed",
  Thursday: "Thu",
  Friday: "Fri",
  Saturday: "Sat"
}
// Calendar months names and short names
export const CALENDAR_MONTHS = {
  January: "Jan",
  February: "Feb",
  March: "Mar",
  April: "Apr",
  May: "May",
  June: "Jun",
  July: "Jul",
  August: "Aug",
  September: "Sep",
  October: "Oct",
  November: "Nov",
  December: "Dec"
}
// Weeks displayed on calendar
export const CALENDAR_WEEKS = 6;
// Pads a string value with leading zeroes(0) until length is reached
// For example: zeroPad(5, 2) =&gt; "05"
export const zeroPad = (value, length) =&gt; {
  return `${value}`.padStart(length, '0');
}
// (int) Number days in a month for a given year from 28 - 31
export const getMonthDays = (month = THIS_MONTH, year = THIS_YEAR) =&gt; {
  const months30 = [4, 6, 9, 11];
  const leapYear = year % 4 === 0;
  return month === 2
    ? leapYear
      ? 29
      : 28
    : months30.includes(month)
      ? 30
      : 31;
}
// (int) First day of the month for a given year from 1 - 7
// 1 =&gt; Sunday, 7 =&gt; Saturday
export const getMonthFirstDay = (month = THIS_MONTH, year = THIS_YEAR) =&gt; {
  return +(new Date(`${year}-${zeroPad(month, 2)}-01`).getDay()) + 1;
}
</pre>
<p>像<code>Date.prototype</code>中的<code>getDay()</code>和<code>getMonth()</code>这样的方法通常返回一个从零开始的值。因此，作为一年的第一个月，一月是<code>0</code>，而十二月是<code>11</code>。一周的第一天，周日是<code>0</code>，周六是<code>7</code>。</p>
<p>在上面的代码片段中，您会看到<code>1</code>被添加到这些从零开始的值中。周日成为工作日的<code>1</code>，十二月成为一个月的<code>12</code>。</p>
<p>最后，注意<code>CALENDAR_WEEKS</code>被设置为<code>6</code>；因为一个月通常跨越四周，所以这样做可以让日历适应上个月的最后一周和下个月的第一周。</p>
<h3 id="additional-helpers-verification">用于验证的其他助手</h3>
<p>让我们通过添加一些额外的助手函数来改进我们的<code>calendar</code>组件。首先，我们将通过向<code>src/helpers/calendar.js</code>文件追加以下代码来验证<code>calendar</code>模块中的日期格式:</p>
<pre class="language-javascript hljs">// (bool) Checks if a value is a date - this is just a simple check
export const isDate = date =&amp;gt; {
  const isDate = Object.prototype.toString.call(date) === '[object Date]';
  const isValidDate = date &amp;&amp; !Number.isNaN(date.valueOf());

  return isDate &amp;&amp; isValidDate;
}
// (bool) Checks if two date values are of the same month and year
export const isSameMonth = (date, basedate = new Date()) =&gt; {
  if (!(isDate(date) &amp;&amp; isDate(basedate))) return false;
  const basedateMonth = +(basedate.getMonth()) + 1;
  const basedateYear = basedate.getFullYear();
  const dateMonth = +(date.getMonth()) + 1;
  const dateYear = date.getFullYear();
  return (+basedateMonth === +dateMonth) &amp;&amp; (+basedateYear === +dateYear);

}
// (bool) Checks if two date values are the same day
export const isSameDay = (date, basedate = new Date()) =&gt; {

  if (!(isDate(date) &amp;&amp; isDate(basedate))) return false;
  const basedateDate = basedate.getDate();
  const basedateMonth = +(basedate.getMonth()) + 1;
  const basedateYear = basedate.getFullYear();
  const dateDate = date.getDate();
  const dateMonth = +(date.getMonth()) + 1;
  const dateYear = date.getFullYear();
  return (+basedateDate === +dateDate) &amp;&amp; (+basedateMonth === +dateMonth) &amp;&amp; (+basedateYear === +dateYear);

}
// (string) Formats the given date as YYYY-MM-DD
// Months and Days are zero padded
export const getDateISO = (date = new Date) =&gt; {

  if (!isDate(date)) return null;
  return [
    date.getFullYear(),
    zeroPad(+date.getMonth() + 1, 2),
    zeroPad(+date.getDate(), 2)
  ].join('-');

}
// ({month, year}) Gets the month and year before the given month and year
// For example: getPreviousMonth(1, 2000) =&gt; {month: 12, year: 1999}
// while: getPreviousMonth(12, 2000) =&gt; {month: 11, year: 2000}
export const getPreviousMonth = (month, year) =&gt; {
  const prevMonth = (month &gt; 1) ? month - 1 : 12;
  const prevMonthYear = (month &gt; 1) ? year : year - 1;
  return { month: prevMonth, year: prevMonthYear };
}
// ({month, year}) Gets the month and year after the given month and year
// For example: getNextMonth(1, 2000) =&gt; {month: 2, year: 2000}
// while: getNextMonth(12, 2000) =&gt; {month: 1, year: 2001}
export const getNextMonth = (month, year) =&gt; {
  const nextMonth = (month &lt; 12) ? month + 1 : 1;
  const nextMonthYear = (month &lt; 12) ? year : year + 1;
  return { month: nextMonth, year: nextMonthYear };
}
</pre>
<h3 id="default-export">默认导出</h3>
<p>接下来，我们将添加calendar builder函数，这是calendar <code>helpers</code>模块的默认导出。calendar builder函数将月份和年份作为参数，然后返回一个包含42个元素的数组，每个元素代表一个格式为<code>[YYYY, MM,DD]</code>的日历日期。</p>
<p>将下面的代码片段附加到<code>src/helpers/calendar.js</code>文件中:</p>
<pre class="language-javascript hljs">// Calendar builder for a month in the specified year
// Returns an array of the calendar dates.
// Each calendar date is represented as an array =&gt; [YYYY, MM, DD]
export default (month = THIS_MONTH, year = THIS_YEAR) =&gt; {

  // Get number of days in the month and the month's first day

  const monthDays = getMonthDays(month, year);
  const monthFirstDay = getMonthFirstDay(month, year);
  // Get number of days to be displayed from previous and next months
  // These ensure a total of 42 days (6 weeks) displayed on the calendar

  const daysFromPrevMonth = monthFirstDay - 1;
  const daysFromNextMonth = (CALENDAR_WEEKS * 7) - (daysFromPrevMonth + monthDays);
  // Get the previous and next months and years

  const { month: prevMonth, year: prevMonthYear } = getPreviousMonth(month, year);
  const { month: nextMonth, year: nextMonthYear } = getNextMonth(month, year);
  // Get number of days in previous month
  const prevMonthDays = getMonthDays(prevMonth, prevMonthYear);
  // Builds dates to be displayed from previous month

  const prevMonthDates = [...new Array(daysFromPrevMonth)].map((n, index) =&gt; {
    const day = index + 1 + (prevMonthDays - daysFromPrevMonth);
    return [ prevMonthYear, zeroPad(prevMonth, 2), zeroPad(day, 2) ];
  });
  // Builds dates to be displayed from current month

  const thisMonthDates = [...new Array(monthDays)].map((n, index) =&gt; {
    const day = index + 1;
    return [year, zeroPad(month, 2), zeroPad(day, 2)];
  });
  // Builds dates to be displayed from next month

  const nextMonthDates = [...new Array(daysFromNextMonth)].map((n, index) =&gt; {
    const day = index + 1;
    return [nextMonthYear, zeroPad(nextMonth, 2), zeroPad(day, 2)];
  });
  // Combines all dates from previous, current and next months
  return [ ...prevMonthDates, ...thisMonthDates, ...nextMonthDates ];

}
</pre>
<p>返回的日历日期从上个月的最后一周到下个月的第一周。</p>
<h2 id="building-calendar-component">构建<code>calendar</code>组件</h2>
<p>现在我们有了日历<code>helpers</code>模块，让我们构建我们的React <code>calendar</code>组件。将以下代码片段添加到<code>src/components/Calendar/index.js</code>文件中:</p>
<pre class="language-javascript hljs">import React, { Component, Fragment, useEffect, useState } from "react";
import PropTypes from "prop-types";
import * as Styled from "./styles";
import calendar, {
  isDate,
  isSameDay,
  isSameMonth,
  getDateISO,
  getNextMonth,
  getPreviousMonth,
  WEEK_DAYS,
  CALENDAR_MONTHS,
} from "../../helpers/calendar";
export default function Calendar({ date, onDateChanged }) {
  const [dateState, setDateState] = useState({ current: 0, month: 0, year: 0 });
  const [today, setToday] = useState(new Date());
  useEffect(() =&gt; {
    addDateToState(date);
  }, []);
  const addDateToState = (date) =&gt; {
    const isDateObject = isDate(date);
    const _date = isDateObject ? date : new Date();
    setDateState({
      current: isDateObject ? date : null,
      month: +_date.getMonth() + 1,
      year: _date.getFullYear(),
    });
  };
  const getCalendarDates = () =&gt; {
    const { current, month, year } = dateState;
    const calendarMonth = month || +current.getMonth() + 1;
    const calendarYear = year || current.getFullYear();
    return calendar(calendarMonth, calendarYear);
  };
  return (
    &lt;Styled.CalendarContainer&gt;
      {renderMonthAndYear()}
      &lt;Styled.CalendarGrid&gt;
        &lt;Fragment&gt;{Object.keys(WEEK_DAYS).map(renderDayLabel)}&lt;/Fragment&gt;
        &lt;Fragment&gt;{getCalendarDates().map(renderCalendarDate)}&lt;/Fragment&gt;
      &lt;/Styled.CalendarGrid&gt;
    &lt;/Styled.CalendarContainer&gt;
  );
}
Calendar.propTypes = {
  date: PropTypes.instanceOf(Date),
  onDateChanged: PropTypes.func,
};
</pre>
<p>默认的日历导出，以及其他帮助函数和常量，都是从日历<code>helpers</code>模块导入的。calendar styles模块的所有导出都是用名称空间<code>Styled</code>导入的。</p>
<p>目前，我们还没有创建任何样式，但我们将很快使用样式组件。使用<code>useState</code>钩子从props中部分解析组件状态，该钩子用包含以下内容的对象设置状态:</p>
<ul>
<li><code>current</code>:当前所选日期的<code>Date</code>对象或空</li>
<li><code>month</code>:当前所选日期的月份，如果设置的话。否则，默认为当前日期的月份</li>
<li><code>year</code>:当前所选日期的年份，如果设置的话。否则，默认为当前日期的年份</li>
</ul>
<p>需要使用<code>month</code>和<code>year</code>状态属性来正确呈现日历，如<code>getCalendarDates()</code>方法所示，该方法使用日历构建器函数来构建月份和年份的日历。</p>
<p>最后，用<code>today</code>属性增加状态，这是当前日期的一个<code>Date</code>对象。</p>
<h3 id="rendering-calendar-component">呈现部分<code>calendar</code>组件</h3>
<p>在前面的<code>calendar</code>组件代码片段中，<code>renderer</code>部分引用了呈现月份、年份、工作日和日历日期的方法。我们将这些方法添加到<code>calendar</code>组件中，如下所示:</p>
<pre class="language-javascript hljs">let pressureTimer, pressureTimeout; 

const renderMonthAndYear = () =&gt; {
    const { month, year } = dateState;
    // Resolve the month name from the CALENDAR_MONTHS object map
    const monthname =
      Object.keys(CALENDAR_MONTHS)[Math.max(0, Math.min(month - 1, 11))];
    return (
      &lt;Styled.CalendarHeader&gt;
        &lt;Styled.ArrowLeft
          onMouseDown={handlePrevious}
          onMouseUp={clearPressureTimer}
          title="Previous Month"
        /&gt;
        &lt;Styled.CalendarMonth&gt;
          {monthname} {year}
        &lt;/Styled.CalendarMonth&gt;
        &lt;Styled.ArrowRight
          onMouseDown={handleNext}
          onMouseUp={clearPressureTimer}
          title="Next Month"
        /&gt;
      &lt;/Styled.CalendarHeader&gt;
    );
  };
  // Render the label for day of the week
  // This method is used as a map callback as seen in render()
  const renderDayLabel = (day, index) =&gt; {
    // Resolve the day of the week label from the WEEK_DAYS object map
    const daylabel = WEEK_DAYS[day].toUpperCase();
    return (
      &lt;Styled.CalendarDay key={daylabel} index={index}&gt;
        {daylabel}
      &lt;/Styled.CalendarDay&gt;
    );
  };
  // Render a calendar date as returned from the calendar builder function
  // This method is used as a map callback as seen in render()
  const renderCalendarDate = (date, index) =&gt; {
    const { current, month, year } = dateState;
    const _date = new Date(date.join("-"));
    // Check if calendar date is same day as today
    const isToday = isSameDay(_date, today);
    // Check if calendar date is same day as currently selected date
    const isCurrent = current &amp;&amp; isSameDay(_date, current);
    // Check if calendar date is in the same month as the state month and year
    const inMonth =
      month &amp;&amp; year &amp;&amp; isSameMonth(_date, new Date([year, month, 1].join("-")));
    // The click handler
    const onClick = this.gotoDate(_date);
    const props = { index, inMonth, onClick, title: _date.toDateString() };
    // Conditionally render a styled date component
    const DateComponent = isCurrent
      ? Styled.HighlightedCalendarDate
      : isToday
      ? Styled.TodayCalendarDate
      : Styled.CalendarDate;
    return (
      &lt;DateComponent key={getDateISO(_date)} {...props}&gt;
        {_date.getDate()}
      &lt;/DateComponent&gt;
    );
  };
</pre>
<p>在<code>renderMonthAndYear()</code>方法中，首先从<code>CALENDAR_MONTHS</code>对象中解析出月份的名称。然后，它被呈现在年份旁边，在左侧和右侧有两个用于导航的箭头控件。</p>
<p>每个箭头控件都有针对<code>mousedown</code>和<code>mouseup</code>事件的事件处理程序，我们稍后将它们定义为<code>handlePrevious()</code>、<code>handleNext()</code>和<code>clearPressureTimer()</code>。添加了一些样式后，<code>renderMonthAndYear()</code>方法呈现的DOM看起来像下面的截图:</p>
<p><img data-attachment-id="90562" data-permalink="https://blog.logrocket.com/3arrow-control-handlers-mouse-events/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/3arrow-control-handlers-mouse-events.png" data-orig-size="730,111" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="arrow-control-handlers-mouse-events" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/3arrow-control-handlers-mouse-events-300x46.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/3arrow-control-handlers-mouse-events.png" decoding="async" class="aligncenter wp-image-90562 size-full jetpack-lazy-image" src="../Images/b3469b3814ff5fc20da31046f63e6e73.png" alt="Arrow Control Handlers Mouse Events" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/3arrow-control-handlers-mouse-events.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/01/3arrow-control-handlers-mouse-events-300x46.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/3arrow-control-handlers-mouse-events.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/3arrow-control-handlers-mouse-events.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="90562" data-permalink="https://blog.logrocket.com/3arrow-control-handlers-mouse-events/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/3arrow-control-handlers-mouse-events.png" data-orig-size="730,111" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="arrow-control-handlers-mouse-events" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/3arrow-control-handlers-mouse-events-300x46.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/3arrow-control-handlers-mouse-events.png" decoding="async" loading="lazy" class="aligncenter wp-image-90562 size-full" src="../Images/b3469b3814ff5fc20da31046f63e6e73.png" alt="Arrow Control Handlers Mouse Events" srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/3arrow-control-handlers-mouse-events.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/01/3arrow-control-handlers-mouse-events-300x46.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/3arrow-control-handlers-mouse-events.png"/></noscript>
<p><code>renderDayLabel()</code>方法呈现一周中某一天的标签，这是从<code>WEEK_DAYS</code>对象中解析出来的。它有两个参数，day和index，因为它被用作对<code>.map()</code>的回调函数，正如在<code>render()</code>方法中看到的。</p>
<p>映射后，一周中各天的渲染DOM如下图所示:</p>
<p><img data-attachment-id="90564" data-permalink="https://blog.logrocket.com/4rendered-dom-mapping-weekdays/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/4rendered-dom-mapping-weekdays.png" data-orig-size="730,62" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="rendered-dom-mapping-weekdays" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/4rendered-dom-mapping-weekdays-300x25.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/4rendered-dom-mapping-weekdays.png" decoding="async" class="aligncenter wp-image-90564 size-full jetpack-lazy-image" src="../Images/a8d60a11a07db506f0cfcb5534a4fa77.png" alt="Rendered Dom Mapping Weekdays" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/4rendered-dom-mapping-weekdays.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/01/4rendered-dom-mapping-weekdays-300x25.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/4rendered-dom-mapping-weekdays.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/4rendered-dom-mapping-weekdays.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="90564" data-permalink="https://blog.logrocket.com/4rendered-dom-mapping-weekdays/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/4rendered-dom-mapping-weekdays.png" data-orig-size="730,62" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="rendered-dom-mapping-weekdays" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/4rendered-dom-mapping-weekdays-300x25.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/4rendered-dom-mapping-weekdays.png" decoding="async" loading="lazy" class="aligncenter wp-image-90564 size-full" src="../Images/a8d60a11a07db506f0cfcb5534a4fa77.png" alt="Rendered Dom Mapping Weekdays" srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/4rendered-dom-mapping-weekdays.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/01/4rendered-dom-mapping-weekdays-300x25.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/4rendered-dom-mapping-weekdays.png"/></noscript>
<p><code>renderCalendarDate()</code>方法也被用作<code>.map()</code>回调函数，并呈现日历日期。它作为第一个参数接收的日期的格式是<code>[YYYY, MM, DD]</code>。</p>
<p><code>renderCalendarDate()</code>方法检查日期是否与今天的日期相同，包括当前状态的月份和年份。通过这些检查，它有条件地呈现日历日期单元格的一个变体，<code>HiglightedCalendarDate</code>、<code>TodayCalendarDate</code>或<code>CalendarDate</code>。</p>
<p>对于每个呈现的日历日期，使用<code>gotoDate()</code>方法设置一个<code>onClick</code>处理程序来跳转到该特定日期，我们将在下一节中定义该方法。</p>
<h3 id="basic-additiional-calendar-components">基本附加<code>calendar</code>组件</h3>
<p>让我们为我们的<code>calendar</code>组件添加一些定制。例如，我们将添加一个按钮，如下所示:</p>
<pre class="language-javascript hljs">import DatePicker from "react datepicker";
import Button from "react datepicker/components/button";
export default function Example() {
  return (
    &lt;DatePicker 
      render={&lt;Button/&gt;}
    /&gt;
  )
}
</pre>
<p>我们可以用下面的代码设置一个<code>input</code>图标:</p>
<pre class="language-javascript hljs">import DatePicker from "react datepicker"
import InputIcon from "react datepicker/components/input_icon"
export default function Example() {
  return (
    &lt;DatePicker 
      render={&lt;InputIcon/&gt;}
    /&gt;
  )
}
</pre>
<p>让我们添加一个特性，在<code>date</code>值改变时向用户发出指示。为此，我们将把<code>handleValueChange</code>传递给<code>onChange</code>:</p>
<pre class="language-javascript hljs">import DatePicker from "react datepicker"
export default function Example() {
  return (
    &lt;DatePicker
      render={&lt;CustomInput /&gt;}
    /&gt;
  )
}
function CustomInput({ openCalendar, value, handleValueChange }) {
  return (
    &lt;input
      onFocus={openCalendar}
      value={value}
      onChange={handleValueChange}
    /&gt;
  )
}
</pre>
<p>使用上面的代码，当选定的日期被更改时，用户将看到如下内容:</p>
<p><img data-attachment-id="90570" data-permalink="https://blog.logrocket.com/calendar-customization-visible-date-change/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/calendar-customization-visible-date-change.gif" data-orig-size="260,310" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="calendar-customization-visible-date-change" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/calendar-customization-visible-date-change-252x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/calendar-customization-visible-date-change.gif" decoding="async" class="aligncenter wp-image-90570 size-full jetpack-lazy-image" src="../Images/0f6a3fba97d09cac871f483ea1cc0449.png" alt="Calendar Customization Visible Date Change" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/calendar-customization-visible-date-change.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/calendar-customization-visible-date-change.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="90570" data-permalink="https://blog.logrocket.com/calendar-customization-visible-date-change/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/calendar-customization-visible-date-change.gif" data-orig-size="260,310" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="calendar-customization-visible-date-change" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/calendar-customization-visible-date-change-252x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/calendar-customization-visible-date-change.gif" decoding="async" loading="lazy" class="aligncenter wp-image-90570 size-full" src="../Images/0f6a3fba97d09cac871f483ea1cc0449.png" alt="Calendar Customization Visible Date Change" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/calendar-customization-visible-date-change.gif"/></noscript>
<p>最后，让我们为用户添加在特定范围内选择日期的功能:</p>
<pre class="language-javascript hljs">export default function Example() {
  return (
    &lt;DatePicker
      range
      eachDaysInRange
      render={&lt;CustomRangeInput /&gt;}
    /&gt;

  )
}

function CustomRangeInput({openCalendar, value}) {
  let from = value[0] || ""
  let to = value[1] || ""

  value = from &amp;&amp; to ? "from " + from + ", to " + to : from 
  return (
    &lt;input
      onFocus={openCalendar}
      value={value}
      readOnly /&gt;    
)}
</pre>
<p><img data-attachment-id="90573" data-permalink="https://blog.logrocket.com/select-date-range-calendar/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/select-date-range-calendar.gif" data-orig-size="257,319" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="select-date-range-calendar" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/select-date-range-calendar-242x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/select-date-range-calendar.gif" decoding="async" class="aligncenter wp-image-90573 size-full jetpack-lazy-image" src="../Images/712649491a31819793acd9159f17282c.png" alt="Select Date Range Calendar" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/select-date-range-calendar.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/select-date-range-calendar.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="90573" data-permalink="https://blog.logrocket.com/select-date-range-calendar/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/select-date-range-calendar.gif" data-orig-size="257,319" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="select-date-range-calendar" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/select-date-range-calendar-242x300.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/select-date-range-calendar.gif" decoding="async" loading="lazy" class="aligncenter wp-image-90573 size-full" src="../Images/712649491a31819793acd9159f17282c.png" alt="Select Date Range Calendar" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/select-date-range-calendar.gif"/></noscript>
<p>这些只是一些自定义组件，您可以将它们添加到您的应用程序中，以改进您的整体UI。</p>
<h3 id="event-handlers">事件处理程序</h3>
<p>在前面的章节中，我们已经多次引用了事件处理程序。继续更新<code>calendar</code>组件，为事件处理程序添加以下代码片段:</p>
<pre class="language-javascript hljs">const gotoDate = (date) =&gt; (evt) =&gt; {
    evt &amp;&amp; evt.preventDefault();
    const { current } = dateState;
    !(current &amp;&amp; isSameDay(date, current)) &amp;&amp; addDateToState(date);
    onDateChanged(date);
  };
  const gotoPreviousMonth = () =&gt; {
    const { month, year } = dateState;
    const previousMonth = getPreviousMonth(month, year);
    setDateState({
      month: previousMonth.month,
      year: previousMonth.year,
      current: dateState.current,
    });
  };
  const gotoNextMonth = () =&gt; {
    const { month, year } = dateState;
    const nextMonth = getNextMonth(month, year);
    setDateState({
      month: nextMonth.month,
      year: nextMonth.year,
      current: dateState.current,
    });
  };
  const gotoPreviousYear = () =&gt; {
    const { year } = dateState;
    setDateState({
      month: dateState.month,
      year: year - 1,
      current: dateState.current,
    });
  };
  const gotoNextYear = () =&gt; {
    const { year } = dateState;
    setDateState({
      month: dateState.month,
      year: year + 1,
      current: dateState.current,
    });
  };
  const handlePressure = (fn) =&gt; {
    if (typeof fn === "function") {
      fn();
      pressureTimeout = setTimeout(() =&gt; {
        pressureTimer = setInterval(fn, 100);
      }, 500);
    }
  };
  const clearPressureTimer = () =&gt; {
    pressureTimer &amp;&amp; clearInterval(pressureTimer);
    pressureTimeout &amp;&amp; clearTimeout(pressureTimeout);
  };
  const handlePrevious = (evt) =&gt; {
    evt &amp;&amp; evt.preventDefault();
    const fn = evt.shiftKey ? gotoPreviousYear : gotoPreviousMonth;
    handlePressure(fn);
  };
  const handleNext = (evt) =&gt; {
    evt &amp;&amp; evt.preventDefault();
    const fn = evt.shiftKey ? gotoNextYear : gotoNextMonth;
    handlePressure(fn);
  };
</pre>
<p><code>gotoDate()</code>方法是一个高阶函数，它将一个<code>Date</code>对象作为它的参数。它返回一个事件处理程序，可以触发该事件处理程序来更新状态中当前选定的日期。<code>addStateToDate()</code>用于从日期中解析月和年，并更新状态。</p>
<p>如果一个回调函数被传递给<code>calendar</code>组件的<code>onDateChanged</code>属性，那么这个函数将会被更新的日期调用。如果您想将日期更改传播到父组件，这个特性尤其有用。</p>
<p><code>handlePrevious()</code>和<code>handleNext()</code>事件处理程序有相似的行为。默认情况下，它们在几个月中循环。然而，如果按下<strong> shift键</strong>，事件处理程序将会以年为单位进行循环。</p>
<p>最后，他们将控制权交给了<code>handlePressure()</code>方法。<code>handlePressure()</code>方法简单地使用定时器来模拟快速循环几个月或几年的压力点击，而<code>clearPressureTimer()</code>方法清除这些定时器。</p>
<h3 id="component-lifecycle-hooks">组件生命周期挂钩</h3>
<p>当我们开始包装我们的<code>calendar</code>组件时，让我们添加一些生命周期方法:</p>
<pre class="language-javascript hljs">useEffect(() =&gt; {
    const now = new Date();
    const tomorrow = new Date().setHours(0, 0, 0, 0) + 24 * 60 * 60 * 1000;
    const ms = tomorrow - now;
    dayTimeout = setTimeout(() =&gt; {
      setToday(new Date());
      clearDayTimeout();
    }, ms);
    return () =&gt; {
      clearPressureTimer();
      clearDayTimeout();
    };
  }, []);

const clearDayTimeout = () =&gt; {
    dayTimeout &amp;&amp; clearTimeout(dayTimeout);
  };
</pre>
<p>在<code>useEffect()</code>钩子中，我们有一个<code>day</code>计时器，它被设置为在当天结束后自动将<code>today</code>状态属性更新到第二天。在卸载组件之前，所有计时器都被清除，如return语句所示。</p>
<h2 id="styling-the-calendar">设计日历</h2>
<p>组件完成后，让我们添加样式化组件进行样式化。将以下代码片段添加到<code>src/components/Calendar/styles.js</code>文件中:</p>
<pre class="language-javascript hljs">import styled from 'styled-components';
export const Arrow = styled.button`
  appearance: none;
  user-select: none;
  outline: none !important;
  display: inline-block;
  position: relative;
  cursor: pointer;
  padding: 0;
  border: none;
  border-top: 1.6em solid transparent;
  border-bottom: 1.6em solid transparent;
  transition: all .25s ease-out;
`;
export const ArrowLeft = styled(Arrow)`
  border-right: 2.4em solid #ccc;
  left: 1.5rem;
  :hover {
    border-right-color: #06c;
  }
`;
export const ArrowRight = styled(Arrow)`
  border-left: 2.4em solid #ccc;
  right: 1.5rem;
  :hover {
    border-left-color: #06c;
  }
`;
export const CalendarContainer = styled.div`
  font-size: 5px;
  border: 2px solid #06c;
  border-radius: 5px;
  overflow: hidden;
`;
export const CalendarHeader = styled.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
`;
export const CalendarGrid = styled.div`
  display: grid;
  grid-template: repeat(7, auto) / repeat(7, auto);
`;
export const CalendarMonth = styled.div`
  font-weight: 500;
  font-size: 5em;
  color: #06c;
  text-align: center;
  padding: 0.5em 0.25em;
  word-spacing: 5px;
  user-select: none;
`;
export const CalendarCell = styled.div`
  text-align: center;
  align-self: center;
  letter-spacing: 0.1rem;
  padding: 0.6em 0.25em;
  user-select: none;
  grid-column: ${props =&gt; (props.index % 7) + 1} / span 1;
`;
export const CalendarDay = styled(CalendarCell)`
  font-weight: 600;
  font-size: 2.25em;
  color: #06c;
  border-top: 2px solid #06c;
  border-bottom: 2px solid #06c;
  border-right: ${props =&gt; (props.index % 7) + 1 === 7 ? `none` : `2px solid #06c`};
`;
export const CalendarDate = styled(CalendarCell)`
  font-weight: ${props =&gt; props.inMonth ? 500 : 300};
  font-size: 4em;
  cursor: pointer;
  border-bottom: ${props =&gt; ((props.index + 1) / 7) &lt;= 5 ? `1px solid #ddd` : `none`};
  border-right: ${props =&gt; (props.index % 7) + 1 === 7 ? `none` : `1px solid #ddd`};
  color: ${props =&gt; props.inMonth ? `#333` : `#ddd`};
  grid-row: ${props =&gt; Math.floor(props.index / 7) + 2} / span 1;
  transition: all .4s ease-out;
  :hover {
    color: #06c;
    background: rgba(0, 102, 204, 0.075);
  }
`;
export const HighlightedCalendarDate = styled(CalendarDate)`
  color: #fff !important;
  background: #06c !important;
  position: relative;
  ::before {
    content: '';
    position: absolute;
    top: -1px;
    left: -1px;
    width: calc(100% + 2px);
    height: calc(100% + 2px);
    border: 2px solid #06c;
  }
`;
export const TodayCalendarDate = styled(HighlightedCalendarDate)`
  color: #06c !important;
  background: transparent !important;
  ::after {
    content: '';
    position: absolute;
    right: 0;
    bottom: 0;
    border-bottom: 0.75em solid #06c;
    border-left: 0.75em solid transparent;
    border-top: 0.75em solid transparent;
  }
  :hover {
    color: #06c !important;
    background: rgba(0, 102, 204, 0.075) !important;
  }
`;
</pre>
<p>现在，当您在应用程序中渲染<code>calendar</code>组件时，它将看起来像下面的截图:</p>
<p><img data-attachment-id="90568" data-permalink="https://blog.logrocket.com/7render-caledar-component-render/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/7render-caledar-component-render.png" data-orig-size="730,755" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="render-calendar-component-render" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/7render-caledar-component-render-290x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/7render-caledar-component-render.png" decoding="async" class="aligncenter wp-image-90568 size-full jetpack-lazy-image" src="../Images/4cc36b6c0a9e921644dde37af205e6a8.png" alt="Render Calendar Component Render" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/7render-caledar-component-render.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/01/7render-caledar-component-render-290x300.png 290w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/7render-caledar-component-render.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/7render-caledar-component-render.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="90568" data-permalink="https://blog.logrocket.com/7render-caledar-component-render/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/7render-caledar-component-render.png" data-orig-size="730,755" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="render-calendar-component-render" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/7render-caledar-component-render-290x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/7render-caledar-component-render.png" decoding="async" loading="lazy" class="aligncenter wp-image-90568 size-full" src="../Images/4cc36b6c0a9e921644dde37af205e6a8.png" alt="Render Calendar Component Render" srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/7render-caledar-component-render.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/01/7render-caledar-component-render-290x300.png 290w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/7render-caledar-component-render.png"/></noscript>
<h2 id="custom-react-datepicker-component">自定义反应<code>datepicker</code>组件</h2>
<p>要开始构建我们的<code>datepicker</code>组件，将下面的代码片段添加到<code>src/components/Datepicker/index.js</code>文件中:</p>
<pre class="language-javascript hljs">import React from "react";
import PropTypes from "prop-types";
import Calendar from "../Calendar";
import * as Styled from "./styles";
import { isDate, getDateISO } from "../../helpers/calendar";
import { useEffect } from "react/cjs/react.development";
export default function Datepicker(props) {
  const [dateState, setDateState] = useState(null);
  const [calendarOpen, setCalendarOpen] = useState(false);
const { label } = this.props;
  const toggleCalendar = () =&gt; setCalendarOpen(!calendarOpen);
  const handleChange = (evt) =&gt; evt.preventDefault();
  const handleDateChange = (date) =&gt; {
    const newDate = date ? getDateISO(date) : null;
    dateState !== newDate &amp;&amp;
      setDateState(newDate) &amp;&amp;
      setCalendarOpen(false) &amp;&amp;
      props.onDateChanged(dateState);

  };
  useEffect(() =&gt; {
    const newDate = props.value &amp;&amp; new Date(props.value);
    isDate(newDate) &amp;&amp; setDateState(getDateISO(newDate));
  }, []);
  useEffect(() =&gt; {
    const dateISO = getDateISO(new Date(date));
    setDateState(dateISO);
  }, [props]);
}
Datepicker.propTypes = {
  label: PropTypes.string,
  value: PropTypes.string,
  onDateChanged: PropTypes.func,
};
</pre>
<p>组件状态用两个属性初始化:</p>
<ul>
<li><code>date</code>:当前日期的ISO字符串表示，格式为<code>"YYYY-MM-DD"</code></li>
<li><code>calendarOpen</code>:布尔标志，表示日期选择器日历是否可见</li>
</ul>
<p>当组件挂载时，<code>Date</code>对象从传递给组件的值属性中解析出来，然后更新状态，如在<code>useEffect()</code>函数中看到的。</p>
<p><code>handleDateChange()</code>方法将一个<code>Date</code>对象作为其参数，并更新状态中的日期。如果一个回调函数被传递给<code>datepicker</code>组件的<code>onDateChanged</code>属性，那么这个函数将被更新的ISO日期字符串调用。</p>
<h3 id="rendering-datepicker">呈现日期选择器</h3>
<p>值得一提的是，Bootstrap dropdown组件将用于模拟我们的自定义datepicker的下拉效果，这是在我们的项目中添加<a href="https://reactstrap.github.io/?path=/story/home-installation--page"> Reactstrap </a>包作为依赖项的主要目的。datepicker中呈现的样式化组件是Reactstrap中下拉组件的样式化扩展。</p>
<p>更新<code>datepicker</code>组件以包含<code>render()</code>方法，如下面的代码片段所示:</p>
<pre class="language-javascript hljs">return (
    &lt;Styled.DatePickerContainer&gt;
      &lt;Styled.DatePickerFormGroup&gt;
        &lt;Styled.DatePickerLabel&gt;{label || "Enter Date"}&lt;/Styled.DatePickerLabel&gt;
        &lt;Styled.DatePickerInput
          type="text"
          value={dateState ? dateState.split("-").join(" / ") : ""}
          onChange={handleChange}
          readOnly="readonly"
          placeholder="YYYY / MM / DD"
        /&gt;
      &lt;/Styled.DatePickerFormGroup&gt;
      &lt;Styled.DatePickerDropdown isOpen={calendarOpen} toggle={toggleCalendar}&gt;
        &lt;Styled.DatePickerDropdownToggle color="transparent" /&gt;
        &lt;Styled.DatePickerDropdownMenu&gt;
          {calendarOpen &amp;&amp; (
            &lt;Calendar
              date={dateState &amp;&amp; new Date(dateState)}
              onDateChanged={handleDateChange}
            /&gt;
          )}
        &lt;/Styled.DatePickerDropdownMenu&gt;
      &lt;/Styled.DatePickerDropdown&gt;
    &lt;/Styled.DatePickerContainer&gt;
  );
</pre>
<p><code>Styled.DatePickerFormGroup</code>组件是一个引导程序<code>.form-group</code>，它包装了<code>datepicker</code>标签和<code>input</code>字段。需要注意的是，输入字段是<code>"text"</code>类型，标记为<code>readonly</code>，所以不能直接编辑。另请注意，输入元素上change事件的默认行为已被阻止。</p>
<p><code>Styled.DatePickerDropdown</code>组件及其后代是Reactstrap包中dropdown组件的样式扩展。</p>
<p>最后，<code>calendar</code>组件呈现在下拉菜单中，传递来自状态的日期和作为<code>onDateChanged</code>道具回调函数的<code>handleDateChange()</code>方法。</p>
<p>组件<code>datepicker</code>的最终呈现的DOM应该看起来像下面的截图，并带有一些样式:</p>
<p><img data-attachment-id="90566" data-permalink="https://blog.logrocket.com/8final-dom-datepicker-component/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/8final-DOM-datepicker-component.png" data-orig-size="730,167" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="final-DOM-datepicker-component" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/8final-DOM-datepicker-component-300x69.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/8final-DOM-datepicker-component.png" decoding="async" class="aligncenter wp-image-90566 size-full jetpack-lazy-image" src="../Images/077235235c2a908ce6b48bdbedbbb281.png" alt="Final DOM Datepicker Component" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/8final-DOM-datepicker-component.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/01/8final-DOM-datepicker-component-300x69.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2022/01/8final-DOM-datepicker-component.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/8final-DOM-datepicker-component.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="90566" data-permalink="https://blog.logrocket.com/8final-dom-datepicker-component/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2022/01/8final-DOM-datepicker-component.png" data-orig-size="730,167" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="final-DOM-datepicker-component" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2022/01/8final-DOM-datepicker-component-300x69.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2022/01/8final-DOM-datepicker-component.png" decoding="async" loading="lazy" class="aligncenter wp-image-90566 size-full" src="../Images/077235235c2a908ce6b48bdbedbbb281.png" alt="Final DOM Datepicker Component" srcset="https://blog.logrocket.com/wp-content/uploads/2022/01/8final-DOM-datepicker-component.png 730w, https://blog.logrocket.com/wp-content/uploads/2022/01/8final-DOM-datepicker-component-300x69.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2022/01/8final-DOM-datepicker-component.png"/></noscript>
<h2 id="styling-the-datepicker">设置日期选择器的样式</h2>
<p>将以下代码片段添加到<code>src/components/Datepicker/styles.js</code>文件中，以创建datepicker所需的样式化组件:</p>
<pre class="language-javascript hljs">import styled from 'styled-components';
import { FormGroup, Label, Input, Dropdown, DropdownToggle, DropdownMenu } from 'reactstrap';
export const DatePickerContainer = styled.div`
  position: relative;
`;
export const DatePickerFormGroup = styled(FormGroup)`
  display: flex;
  justify-content: space-between;
  position: relative;
  width: 100%;
  border: 2px solid #06c;
  border-radius: 5px;
  overflow: hidden;
`;
export const DatePickerLabel = styled(Label)`
  margin: 0;
  padding: 0 2rem;
  font-weight: 600;
  font-size: 0.7rem;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: #06c;
  border-right: 2px solid #06c;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 102, 204, 0.05);
`;
export const DatePickerInput = styled(Input)`
  padding: 1rem 2rem;
  font-weight: 500;
  font-size: 1rem;
  color: #333;
  box-shadow: none;
  border: none;
  text-align: center;
  letter-spacing: 1px;
  background: transparent !important;
  display: flex;
  align-items: center;
  ::placeholder {
    color: #999;
    font-size: 0.9rem;
  }
`;
export const DatePickerDropdown = styled(Dropdown)`
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
`;
export const DatePickerDropdownToggle = styled(DropdownToggle)`
  position: relative;
  width: 100%;
  height: 100%;
  background: transparent;
  opacity: 0;
  filter: alpha(opacity=0);
`;
export const DatePickerDropdownMenu = styled(DropdownMenu)`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  border: none;
  padding: 0;
  margin: 0;
  transform: none !important;
`;
</pre>
<h2 id="the-app-component"><code>app</code>组件</h2>
<p>最后，更新<code>src/App.js</code>文件，看起来像下面的代码片段:</p>
<pre class="language-javascript hljs">import logo from "./logo.svg";
import "./App.css";

function App() {
  return (
    &lt;div className="App"&gt;

    &lt;/div&gt;
  );
}
export default App;
</pre>
<p>如果您阅读了本文，那么您应该在React应用程序中呈现了一个可工作的自定义日期选择器。现在，在<code>app</code>组件中渲染它:</p>
<pre class="language-javascript hljs">import "./App.css";
import Datepicker from "./components/Datepicker";
function App() {
  return (
    &lt;div className="App"&gt;
      &lt;Datepicker label="Datepicker advanced" /&gt;
    &lt;/div&gt;
  );
}
export default App;
</pre>
<h2 id="conclusion">结论</h2>
<p>在本教程中，我们介绍了如何在React中设置一个健壮且有吸引力的datepicker，作为原生HTML5 <code>datepicker</code> input元素的替代。使用简单的日期选择器，用户不太可能错误地设置日期输入的格式，从而提高了提供给应用程序的信息的质量。</p>
<p>您可以根据自己的意愿定制和升级本教程中的datepicker，使其最适合您的应用程序。我希望你喜欢这篇文章，快乐编码！</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用LogRocket消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款React analytics解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket告诉您React应用程序中实际影响用户的最具影响力的bug和UX问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS异常、前端性能指标和用户交互。然后，LogRocket使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试LogRocket】。</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>