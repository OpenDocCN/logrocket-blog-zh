<html>
<head>
<title>The complete best practices for minifying CSS - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>缩小CSS - LogRocket博客的最佳实践</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/#0001-01-01">https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/#0001-01-01</a></blockquote><div><article class="article-post">
<p>CSS是让网页看起来和感觉起来如此的东西:漂亮的布局，流畅的响应设计，刺激我们感官的颜色，帮助我们阅读以创造性方式表达的文本的字体，图像，UI元素，以及其他以各种形状和大小显示的内容。它负责传达应用程序状态的直观视觉提示，如网络中断、任务完成、无效的信用卡号码输入或游戏角色在死亡后消失在白烟中。</p>
<p>如果没有CSS，web要么会完全崩溃，要么会非常无聊。</p>
<p>考虑到需要构建在行为和性能上达到或超过本地应用的网络应用(感谢<a href="https://en.wikipedia.org/wiki/Single-page_application" target="_blank" rel="noopener noreferrer">spa</a>和<a href="https://developers.google.com/web/progressive-web-apps/" target="_blank" rel="noopener noreferrer"> PWAs </a>)，我们现在通过网络向应用用户提供更多的功能和代码。</p>
<p>考虑到网络的无处不在，它的低摩擦(通过链接导航，无需安装)，以及它的低准入门槛(在非常便宜的手机上接入互联网)，我们将继续看到更多的人第一次上网，并加入数百万其他现有用户的行列，使用我们今天构建的网络应用。</p>
<p>我们通过网络发布的代码越少，我们为应用程序和用户制造的摩擦就越少。更多的代码可能意味着更多的复杂性、更差的性能和更低的可维护性。</p>
<p>因此，减少JavaScript有效负载的问题一直备受关注，包括如何将它们分割成合理的块并缩小它们。直到最近，web才开始关注由优化不佳的CSS引发的问题。</p>
<p>CSS缩小是一种优化的最佳实践，可以为web应用程序用户带来显著的性能提升——即使它最终被证明主要是可感知的。让我们看看如何！</p>
<h2>什么是CSS缩小？</h2>
<p>缩小有助于删除代码中不必要的部分，减小文件大小。最终，代码意味着由计算机执行，但这是在人类消费之后或同时进行的，人类需要共同创作、审查、维护、记录、测试、调试和部署代码。</p>
<p>像其他形式的代码一样，CSS主要是为人类消费而格式化的。因此，我们添加了间距、缩进、注释、命名约定和插装技巧来提高我们的生产率和CSS代码的可维护性——浏览器或目标平台实际运行时不需要这些。</p>
<p>CSS缩小化允许我们去掉这些额外的东西，并应用一些优化，这样我们就可以在目标设备上运行计算机所需要的东西。</p>
<h2>为什么缩小CSS？</h2>
<p>总的来说，源代码缩减减少了文件大小，并可以加快浏览器下载和执行此类代码的时间。然而，缩小CSS至关重要的是<a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-blocking-css" target="_blank" rel="noopener noreferrer"> <strong> CSS是web </strong> </a>上的渲染阻塞资源。</p>
<p>这意味着用户可能无法看到网页上的任何内容，直到浏览器构建了CSSOM(带有CSS信息的<a href="https://blog.logrocket.com/accessing-the-virtual-dom-using-render-functions-in-vue-js/" target="_blank" rel="noopener noreferrer"> DOM </a>)，这只有在它下载并解析了文档引用的所有样式表之后才会发生。</p>
<p>在本文的后面，我们将探索关键CSS的概念和围绕它的最佳实践，但是这里要确定的一点是，在CSS准备好之前，用户什么也看不到。由于运送未统一或未使用的CSS而产生的不必要的大CSS文件会给用户带来这种不良体验。</p>
<h2>缩小与压缩——有什么区别吗？</h2>
<p>代码缩减和压缩经常互换使用，可能是因为它们都致力于性能优化，从而减少代码量。但它们是不同的东西，我想澄清一下:</p>
<ul>
<li><strong>缩小</strong>改变代码内容。它通过去除不需要的空格、字符和格式来减少代码文件的大小，从而减少代码中的字符。它可以通过安全地重命名变量以使用更少的字符来进一步优化代码。</li>
<li><strong>压缩</strong>不一定会改变代码的内容——除非我们考虑像图像这样的二进制文件，这不在本文的讨论范围之内。它通过压缩文件来减小文件大小，然后在请求时将文件提供给浏览器。</li>
</ul>
<p>这两种技术并不相互排斥，因此它们可以一起使用来向用户交付优化的代码。</p>
<p>了解了所需的背景信息后，让我们来看看如何为您的web项目缩小CSS。我们将探索实现这一点的三种方法，并为我制作的一个示例网站这样做，该网站在一个外部<code>main.css</code>文件中包含以下CSS:</p>
<pre>html,
body {
  height: 100%;
}
body {
  padding: 0;
  margin: 0;
}
body <em>.pull-right</em> {
  float: right !important;
}
body <em>.pull-left</em> {
  float: left !important;
}
body header,
body <em>[data-view]</em> {
  display: none;
  opacity: 0;
  transition: opacity 0.7s ease-in;
}
body <em>[data-view].active</em> {
  display: block;
  opacity: 1;
}
body[<em>data-nav</em>='playground'] header {
  display: block;
  opacity: 1;
}
<em>/* Home */</em>
[data-view='home'] {
  height: 100%;
}
[<em>data-view</em>='home'] button {
  opacity: 0;
  pointer-events: none;
  transition: opacity 1.5s ease-in-out;
}
[<em>data-view</em>='home'] button.live {
  opacity: 1;
  pointer-events: all;
}
[<em>data-view</em>='home'] <em>.mdc-layout-grid__cell--span-4.mdc-elevation--z4</em> {
  padding: 1em;
  background: #fff;
}</pre>
<h2>独立在线工具</h2>
<p>如果你对缩小CSS完全不熟悉，想慢慢来，你可以从这里开始，只有在你更舒服的时候再进行下一步。虽然这种方法可行，但它很麻烦，不适合任何规模的实际项目，尤其是有几个团队成员的项目。</p>
<p>有许多免费简单的在线工具可以快速缩小CSS。它们包括:</p>

<p>这三个工具都提供了一个简单的用户界面，由一个或多个输入字段组成，并要求您将CSS复制并粘贴到输入字段中，然后单击一个按钮来缩小代码。输出也显示在UI上，供您复制并粘贴回项目中。</p>
<p><img data-attachment-id="3721" data-permalink="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/css-minifier-minified-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/css-minifier-minified-output.png" data-orig-size="730,263" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Minified output from CSS Minifier" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/css-minifier-minified-output-300x108.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/css-minifier-minified-output.png" decoding="async" class="alignnone size-full wp-image-3721 jetpack-lazy-image" src="../Images/0d27f0428087ffbe6668d5e24a18fe75.png" alt="Minified Output From CSS Minifier" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/css-minifier-minified-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/css-minifier-minified-output-300x108.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/07/css-minifier-minified-output.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/css-minifier-minified-output.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="3721" data-permalink="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/css-minifier-minified-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/css-minifier-minified-output.png" data-orig-size="730,263" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Minified output from CSS Minifier" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/css-minifier-minified-output-300x108.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/css-minifier-minified-output.png" decoding="async" loading="lazy" class="alignnone size-full wp-image-3721" src="../Images/0d27f0428087ffbe6668d5e24a18fe75.png" alt="Minified Output From CSS Minifier" srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/css-minifier-minified-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/css-minifier-minified-output-300x108.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/css-minifier-minified-output.png"/></noscript>
<p>从上面CSS Minifier的截图中，我们可以看到右边的<strong> Minified Output </strong>部分的CSS代码已经去掉了空格、注释和格式。</p>
<p>Minify做了一些类似的事情，但也可以显示由于缩小过程而节省的文件大小。</p>
<p>在这两种情况下，我们缩小的CSS如下所示:</p>
<pre>body,html{height:100%}body{padding:0;margin:0}body .pull-right{float:right!important}body .pull-left{float:left!important}body [data-view],body header{display:none;opacity:0;transition:opacity .7s ease-in}body [data-view].active{display:block;opacity:1}body[data-nav=playground] header{display:block;opacity:1}[data-view=home]{height:100%}[data-view=home] button{opacity:0;pointer-events:none;transition:opacity 1.5s ease-in-out}[data-view=home] button.live{opacity:1;pointer-events:all}[data-view=home] .mdc-layout-grid__cell--span-4.mdc-elevation--z4{padding:1em;background:#fff}</pre>
<p>以这种方式缩小CSS期望你在线，并假设上述网站的可用性。不太好！</p>
<h2>命令行工具</h2>
<p>许多命令行工具可以实现与上述网站完全相同的功能，但也可以在没有互联网的情况下工作，例如在长途飞行中。</p>
<p>假设您已经在本地机器上安装了<strong> npm </strong>或<strong> yarn </strong>，并且您的项目被设置为npm包(您可以只做<code>npm init -y</code>)，继续使用<code>npm install cssnano --save-dev</code>或<code>yarn add install cssnano -D</code>安装<a href="https://cssnano.co/" target="_blank" rel="noopener noreferrer"> cssnano </a>作为开发依赖项。</p>
<p>由于cssnano是由<a href="https://postcss.org/" target="_blank" rel="noopener noreferrer">PostC</a>T4】SS提供支持的工具生态系统的一部分，您还应该安装postcss-cli作为开发依赖项(再次运行上述命令，但是用<code>postcss-cli</code>替换<code>cssnano</code>)。</p>
<p>接下来，用以下内容创建一个<code>postcss.config.js</code>文件，告诉PostCSS使用cssnano作为插件:</p>
<pre>module.exports = {
    plugins: [
        require('cssnano')({
            preset: 'default',
        }),
    ],
};</pre>
<p>然后，您可以编辑您的<code>package.json</code>文件，并添加一个脚本条目来使用<code>postcss</code>命令缩小CSS，如下所示:</p>
<pre>...
"scripts": {
  "minify-css": "postcss src/css/main.css &gt; src/css/main.min.css"
}
...
"devDependencies": {
  "cssnano": "^4.1.10",
  "postcss-cli": "^6.1.2"
}
...</pre>
<p><code>main.min.css</code>将是<code>main.css</code>的缩小版。</p>
<p>通过上面的设置，您可以在命令行上导航到您的项目，并运行下面的命令来缩小CSS: <code>npm run minify-css</code>(或者，如果您使用yarn，<code>yarn minify-css</code>)。</p>
<p>从HTML文档本地加载并提供两个CSS文件(只是为了在Chrome DevTools中比较它们的大小——您可以使用<a href="https://www.npmjs.com/package/http-server" target="_blank" rel="noopener noreferrer"> http-server </a>从项目的根目录运行一个本地服务器)显示，缩小的版本大约是原始文件的一半大小。</p>
<p><img data-attachment-id="3722" data-permalink="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/css-file-comparison-devtools/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-comparison-devtools.png" data-orig-size="730,372" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="CSS file comparison in Chrome DevTools" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-comparison-devtools-300x153.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-comparison-devtools.png" decoding="async" class="alignnone size-full wp-image-3722 jetpack-lazy-image" src="../Images/5f2c389d714f7d5b9fd7a4e42c304fef.png" alt="CSS File Comparison In Chrome DevTools" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-comparison-devtools.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-comparison-devtools-300x153.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-comparison-devtools.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-comparison-devtools.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="3722" data-permalink="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/css-file-comparison-devtools/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-comparison-devtools.png" data-orig-size="730,372" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="CSS file comparison in Chrome DevTools" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-comparison-devtools-300x153.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-comparison-devtools.png" decoding="async" loading="lazy" class="alignnone size-full wp-image-3722" src="../Images/5f2c389d714f7d5b9fd7a4e42c304fef.png" alt="CSS File Comparison In Chrome DevTools" srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-comparison-devtools.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-comparison-devtools-300x153.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-comparison-devtools.png"/></noscript>
<p>虽然上面的例子是作为概念的证明或者对于非常简单的项目来说，但是对于任何具有超出基本复杂性的项目来说，像这样手动缩小CSS将很快变得繁琐或者毫无成效，因为它将有几个CSS文件，包括那些来自UI库的文件，如<a href="https://getbootstrap.com/" target="_blank" rel="noopener noreferrer"> Bootstrap </a>、<a href="https://materializecss.com/" target="_blank" rel="noopener noreferrer"> Materialize </a>、<a href="https://material.io/develop/web/" target="_blank" rel="noopener noreferrer"> Material Design </a>等。</p>
<p>事实上，这个过程需要您保存缩小的版本，并手动更新所有对缩小文件版本的样式表引用。很有可能，你已经在使用像<a href="https://webpack.js.org/" target="_blank" rel="noopener noreferrer"> w </a> <a href="https://webpack.js.org/" target="_blank" rel="noopener noreferrer"> ebpack </a>、<a href="https://rollupjs.org/guide/en/" target="_blank" rel="noopener noreferrer"> Rollup </a>或<a href="https://parceljs.org/" target="_blank" rel="noopener noreferrer">package</a>这样的构建工具了。这些工具内置了对代码缩减和捆绑的支持，只需要很少或不需要配置就可以利用它们的工作流基础设施。</p>
<h2>自带捆扎机(自带)</h2>
<p>假设Parcel是所有包中配置最少的，让我们来研究一下它是如何工作的。通过运行<code>yarn add parcel-bundler -D</code>或<code>npm install parcel-bundler --save-dev</code>安装捆扎机。</p>
<p>接下来，将以下脚本条目添加到您的<code>package.json</code>文件中:</p>
<pre>"dev": "parcel src/index.html",
"build": "parcel build src/index.html"</pre>
<p>您的<code>package.json</code>文件应该如下所示:</p>
<pre>{
  ...
  "scripts": {
    "dev": "parcel src/index.html",
    "build": "parcel build src/index.html"
  },
  ...
  "devDependencies": {
    "parcel-bundler": "^1.12.3"
  }
  ...
}</pre>
<p><code>dev</code>脚本允许我们在开发模式下对<code>index.html</code>文件(我们应用程序的入口点)运行<code>parcel-bunder</code>，允许我们自由地对链接到HTML文件的所有文件进行修改。我们将直接在浏览器中看到更改，而无需刷新浏览器。</p>
<p>默认情况下，它会在项目中添加一个<code>dist</code>文件夹，将我们的文件动态编译到该文件夹中，并从那里提供给浏览器。所有这些都是通过用<code>yarn dev</code>或<code>npm run dev</code>运行开发脚本，然后在浏览器上访问提供的URL来实现的。</p>
<p><img data-attachment-id="3723" data-permalink="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/running-parcel-bundler/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/running-parcel-bundler.png" data-orig-size="730,176" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Running parcel-bundler" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/running-parcel-bundler-300x72.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/running-parcel-bundler.png" decoding="async" class="alignnone size-full wp-image-3723 jetpack-lazy-image" src="../Images/e6ace62294014cd3698c1f5b38a2b8a0.png" alt="Running Parcel Bundler" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/running-parcel-bundler.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/running-parcel-bundler-300x72.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/07/running-parcel-bundler.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/running-parcel-bundler.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="3723" data-permalink="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/running-parcel-bundler/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/running-parcel-bundler.png" data-orig-size="730,176" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Running parcel-bundler" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/running-parcel-bundler-300x72.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/running-parcel-bundler.png" decoding="async" loading="lazy" class="alignnone size-full wp-image-3723" src="../Images/e6ace62294014cd3698c1f5b38a2b8a0.png" alt="Running Parcel Bundler" srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/running-parcel-bundler.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/running-parcel-bundler-300x72.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/running-parcel-bundler.png"/></noscript>
<p>像我们刚刚看到的<code>dev</code>脚本一样，<code>build</code>脚本在生产模式下运行package bundler。这个过程进行代码编译(例如，从ES6到ES5)和缩小，包括缩小目标<code>index.html</code>文件中引用的CSS文件。然后，它自动将HTML文件中的资源链接更新为输出代码(transpiled、minified和versioned副本)。多甜蜜啊！</p>
<p>默认情况下，这个生产版本放在<code>dist</code>文件夹中，但是您可以在<code>package.json</code>文件的脚本条目中更改它。</p>
<p><img data-attachment-id="3724" data-permalink="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/parcel-bundler-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/parcel-bundler-output.png" data-orig-size="730,236" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="parcel-bundler output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/parcel-bundler-output-300x97.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/parcel-bundler-output.png" decoding="async" class="alignnone size-full wp-image-3724 jetpack-lazy-image" src="../Images/4672b6eca6cbf236f85ae1a5a48b7476.png" alt="Parcel Bundler Output" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/parcel-bundler-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/parcel-bundler-output-300x97.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/07/parcel-bundler-output.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/parcel-bundler-output.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="3724" data-permalink="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/parcel-bundler-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/parcel-bundler-output.png" data-orig-size="730,236" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="parcel-bundler output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/parcel-bundler-output-300x97.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/parcel-bundler-output.png" decoding="async" loading="lazy" class="alignnone size-full wp-image-3724" src="../Images/4672b6eca6cbf236f85ae1a5a48b7476.png" alt="Parcel Bundler Output" srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/parcel-bundler-output.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/parcel-bundler-output-300x97.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/parcel-bundler-output.png"/></noscript>
<p>虽然上面的过程是特定于Parcel.js的，但是使用webpack和Rollup等其他捆绑器也有类似的方法或插件来实现相同的结果。请务必从以下几点开始:</p>

<h2>代码覆盖率和未使用的代码</h2>
<p>缩减CSS本身并不是目标；这只是达到目的的手段，也就是为用户提供他们所关心的体验所需的适量代码。</p>
<p>从CSS中去除不必要的空格、字符和格式是朝着正确方向迈出的一步，但是像不必要的空格一样，我们需要弄清楚CSS代码本身的哪些部分在应用程序中不是完全必要的。</p>
<p>如果应用程序用户不得不下载包含用于构建应用程序的引导库的所有组件的样式的CSS(尽管是缩小的CSS ),而实际上只使用了一小部分引导组件(和CSS ),那么最终目标并没有真正实现。</p>
<p>代码覆盖率工具可以帮助您识别死代码，即当前页面或应用程序没有使用的代码。这样的代码也应该在缩小过程中被删除，Chrome DevTools有一个内置的检查器来检测未使用的代码。</p>
<p>打开DevTools，点击“更多”菜单选项(右上角的三个点)，然后点击<strong>更多工具</strong>，然后点击<strong>覆盖</strong>。</p>
<p><img data-attachment-id="3725" data-permalink="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/chrome-devtools-code-coverage/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/chrome-devtools-code-coverage.png" data-orig-size="730,524" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Chrome DevTools code coverage" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/chrome-devtools-code-coverage-300x215.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/chrome-devtools-code-coverage.png" decoding="async" class="alignnone size-full wp-image-3725 jetpack-lazy-image" src="../Images/5fb11e0b7e141fc697dd362476f5a99e.png" alt="Chrome DevTools Code Coverage" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/chrome-devtools-code-coverage.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/chrome-devtools-code-coverage-300x215.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/07/chrome-devtools-code-coverage.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/chrome-devtools-code-coverage.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="3725" data-permalink="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/chrome-devtools-code-coverage/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/chrome-devtools-code-coverage.png" data-orig-size="730,524" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Chrome DevTools code coverage" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/chrome-devtools-code-coverage-300x215.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/chrome-devtools-code-coverage.png" decoding="async" loading="lazy" class="alignnone size-full wp-image-3725" src="../Images/5fb11e0b7e141fc697dd362476f5a99e.png" alt="Chrome DevTools Code Coverage" srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/chrome-devtools-code-coverage.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/chrome-devtools-code-coverage-300x215.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/chrome-devtools-code-coverage.png"/></noscript>
<p>在那里，点击选项<strong>重新加载并开始捕获覆盖范围</strong>。随意浏览应用程序，如果需要，做一些事情来建立使用。</p>
<p><img data-attachment-id="3726" data-permalink="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/coverage-capturing-options/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-capturing-options.png" data-orig-size="1006,284" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Coverage capturing options in DevTools" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-capturing-options-300x85.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-capturing-options.png" decoding="async" class="alignnone size-full wp-image-3726 jetpack-lazy-image" src="../Images/80113b3a6aa8b62acf6f5d17aa0b9a1a.png" alt="Coverage Capturing Options In DevTools" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-capturing-options.png 1006w, https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-capturing-options-300x85.png 300w, https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-capturing-options-768x217.png 768w" data-lazy-sizes="(max-width: 1006px) 100vw, 1006px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-capturing-options.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-capturing-options.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="3726" data-permalink="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/coverage-capturing-options/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-capturing-options.png" data-orig-size="1006,284" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Coverage capturing options in DevTools" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-capturing-options-300x85.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-capturing-options.png" decoding="async" loading="lazy" class="alignnone size-full wp-image-3726" src="../Images/80113b3a6aa8b62acf6f5d17aa0b9a1a.png" alt="Coverage Capturing Options In DevTools" srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-capturing-options.png 1006w, https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-capturing-options-300x85.png 300w, https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-capturing-options-768x217.png 768w" sizes="(max-width: 1006px) 100vw, 1006px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-capturing-options.png"/></noscript>
<p>尽情使用该应用程序后，在覆盖率工具的监视下，点击<strong>停止检测覆盖率并显示结果</strong>红色按钮。</p>
<p>您将看到该页面或使用会话的已加载资源和覆盖率指标的列表。您可以立即看到使用的资源条目与未使用的资源条目的百分比，并且单击每个条目还会显示使用的代码部分(标记为绿色)与未使用的代码部分(标记为红色)。</p>
<p><img data-attachment-id="3727" data-permalink="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/coverage-results-devtools/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-results-devtools.png" data-orig-size="730,447" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Coverage results in DevTools" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-results-devtools-300x184.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-results-devtools.png" decoding="async" class="alignnone size-full wp-image-3727 jetpack-lazy-image" src="../Images/0f15210eda72457f5e11622a85b501cc.png" alt="Coverage Results In DevTools" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-results-devtools.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-results-devtools-300x184.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-results-devtools.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-results-devtools.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="3727" data-permalink="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/coverage-results-devtools/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-results-devtools.png" data-orig-size="730,447" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Coverage results in DevTools" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-results-devtools-300x184.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-results-devtools.png" decoding="async" loading="lazy" class="alignnone size-full wp-image-3727" src="../Images/0f15210eda72457f5e11622a85b501cc.png" alt="Coverage Results In DevTools" srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-results-devtools.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-results-devtools-300x184.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/coverage-results-devtools.png"/></noscript>
<p>在我们的例子中，Chrome DevTools检测到我的HTML中没有使用<code>.pull-right</code>和<code>.pull-left</code> CSS类，所以它将它们标记为未使用的代码。它还报告了84%的CSS未被使用。这不是一个绝对的事实，你很快就会看到，但它给出了一个明确的指示，在缩小过程中，从哪里开始调查区域来清理CSS。</p>
<h2>确定和移除未使用的CSS</h2>
<p>我必须首先说<a href="https://css-tricks.com/heres-the-thing-about-unused-css-tools/" target="_blank" rel="noopener noreferrer">移除未使用的CSS代码应该仔细地完成并测试</a>，否则你可能最终移除应用程序瞬态所需的CSS——例如，CSS用于显示错误消息，只有当这样的错误发生时才会在UI中出现。对于登录用户和未登录用户的CSS，或者显示订单已经发货的覆盖消息(只有在您成功下订单时才会出现)的CSS，情况如何？</p>
<p>您可以应用以下技术，开始更安全地移除未使用的CSS，从而为您最终精简的CSS代码节省更多资源。</p>
<h3>只添加您需要的CSS不要更多！</h3>
<p>这种技术强调代码分割和捆绑的杠杆作用。就像我们可以通过模块化JavaScript并在文件中导入我们需要的模块、文件或函数来进行代码分割一样，我们应该对CSS做同样的事情。</p>
<p>这意味着不需要为<a href="https://material-components.github.io/material-components-web-catalog/#/" target="_blank" rel="noopener noreferrer">材料设计UI库</a>加载整个CSS(例如，通过CDN)，您应该<code>import</code>只为特定页面或视图所需的<code>BUTTON</code>和<code>DIALOG</code>组件加载CSS。如果您正在构建组件并采用CSS-in-JS方法，我猜您已经有了模块化的CSS，它是由您的bundler以块的形式提供的。</p>
<h3>用于关键渲染的内联CSS预加载其余的！</h3>
<p>遵循消除不必要代码的相同哲学——特别是对于CSS，因为它对用户何时能够看到内容有着巨大的影响——人们可以争辩说，用于<em>订单</em> <em>页面</em>和<em>购物车页面</em>的CSS对于刚刚在主页上但尚未登录的用户来说是未使用的CSS。</p>
<p>我们甚至可以把这个概念推得更远，比如说，主页文件夹下的部分(用户必须向下滚动才能看到的主页部分)的CSS对于这样的用户来说是不必要的CSS。这种额外的CSS可能是2G用户(大多数新兴市场)或慢速3G用户(世界其他地区大多数时间)不得不多等一两秒才能看到你的web应用程序上的任何内容的原因，即使你发布了精简代码！</p>
<blockquote><p>为了获得最佳性能，您可能需要考虑将关键的CSS直接内联到HTML文档中。这消除了关键路径中的额外往返，并且如果做得正确，可以用于提供“一次往返”的关键路径长度，其中只有HTML是阻塞资源。<br/>–<a href="https://addyosmani.com/" target="_blank" rel="noopener noreferrer">阿迪·奥斯马尼</a>上<a href="https://github.com/addyosmani/critical/blob/master/README.md" target="_blank" rel="noopener noreferrer">危急</a></p></blockquote>
<p>一旦你提取并内联了关键的CSS，你就可以用<a href="https://alligator.io/html/preload-prefetch/" target="_blank" rel="noopener noreferrer"> link-preload </a>预加载其余的CSS(例如，应用程序的其他路径)。<a href="https://github.com/addyosmani/critical/blob/master/README.md" target="_blank" rel="noopener noreferrer">Critical</a>(Addy Osmani)是一个你可以尝试提取和内嵌关键CSS的工具。</p>
<p>你也可以将这样的关键路径CSS放在一个特定的文件中，并将其内联到应用程序的入口点HTML中——也就是说，如果你不喜欢在HTML文档的样式标签中直接创作CSS。</p>
<h3>移除未使用的CSS</h3>
<p>就像<a href="https://cssnano.co/" target="_blank" rel="noopener noreferrer"> cssnano </a>插入PostCSS来缩小CSS代码一样，Purgecss可以用来移除死的CSS代码。您可以将它作为独立的npm模块运行，或者将其作为插件添加到您的bundler中。为了在我们的示例项目中试用它，我们将安装它:</p>
<pre>npm install @fullhuman/postcss-purgecss --save-dev</pre>
<p>如果使用纱线，我们将做到:</p>
<pre>yarn add @fullhuman/postcss-purgecss -D</pre>
<p>就像我们对cssnano所做的那样，在前面的<code>postcss.config.js</code>文件中的cssnano的插件条目之后添加一个Purgecss的插件条目，这样配置文件看起来如下:</p>
<pre>module.exports = {
    plugins: [
        require('cssnano')({
            preset: 'default',
        }),
        require('@fullhuman/postcss-purgecss')({
            content: ['./**/*.html']
        }),
    ],
};</pre>
<p>为生产构建我们的项目并使用Chrome DevTools检查它的CSS覆盖率，发现我们清除和缩小的CSS现在比早期版本少了352 b(CSS代码减少了55%)。</p>
<p>检查新的输出文件，我们可以看到,<code>.pull-left</code>和<code>.pull-right</code>样式被删除了，因为在构建时我们在HTML中没有使用它们作为类名。</p>
<p><img data-attachment-id="3728" data-permalink="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/purged-minified-css-devtools/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/purged-minified-css-devtools.png" data-orig-size="730,529" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Purged and minified CSS in DevTools" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/purged-minified-css-devtools-300x217.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/purged-minified-css-devtools.png" decoding="async" class="alignnone size-full wp-image-3728 jetpack-lazy-image" src="../Images/bd344584d5faeae482b5c1ca8e6ccb8d.png" alt="Purged Minified CSS In DevTools" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/purged-minified-css-devtools.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/purged-minified-css-devtools-300x217.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/07/purged-minified-css-devtools.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/purged-minified-css-devtools.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="3728" data-permalink="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/purged-minified-css-devtools/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/purged-minified-css-devtools.png" data-orig-size="730,529" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Purged and minified CSS in DevTools" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/purged-minified-css-devtools-300x217.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/purged-minified-css-devtools.png" decoding="async" loading="lazy" class="alignnone size-full wp-image-3728" src="../Images/bd344584d5faeae482b5c1ca8e6ccb8d.png" alt="Purged Minified CSS In DevTools" srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/purged-minified-css-devtools.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/purged-minified-css-devtools-300x217.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/purged-minified-css-devtools.png"/></noscript>
<p>同样，在删除这些工具标记为未使用的CSS时，要小心谨慎。只有在进一步调查表明它们确实没有必要后，才这样做。</p>
<h3>仔细设计CSS选择器</h3>
<p>在我们的示例项目中，我们可能打算使用<code>.pull-right</code>和<code>pull-left</code>类来样式化应用程序中的瞬态——在屏幕的最左侧或最右侧显示条件错误消息。</p>
<p>正如我们刚刚看到的，Purgecss帮助我们的CSS minifier删除了这些样式，因为它检测到它们没有被使用。也许有一种方法可以有意地设计我们的选择器，使其在抢先的CSS死代码删除中存活下来，并在未来的瞬态应用程序状态中需要它们时保留样式。</p>
<p>事实证明，你可以用<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Attribute_selectors" target="_blank" rel="noopener noreferrer"> CSS属性选择器</a>来实现。错误消息元素的CSS规则在默认情况下是隐藏的，然后在某个时候是可见的，可以像这样创建:</p>
<pre>body [msg-type] {
    width: 350px;
    height: 250px;
    padding: 1em;
    position: absolute;
    left: -999px;
    top: -999px;
    opacity: 0;
    transition: opacity .5s ease-in
}
body [msg-type=error] {
    top: calc(50% - 125px);
    left: calc(50% - 150px);
    opacity: 1
}</pre>
<p>虽然我们目前没有任何与这些选择器匹配的DOM元素，并且知道它们将在未来由应用程序按需创建，但minify进程仍然保留了这些CSS规则，即使它们被标记为未使用——这并不完全正确。</p>
<p>CSS属性选择器帮助我们挥动魔棒，表示保留了在构建时在DOM中不可用的错误消息元素样式规则。</p>
<p><img data-attachment-id="3729" data-permalink="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/css-file-results-attribute-selectors/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-results-attribute-selectors.png" data-orig-size="730,527" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="DevTools results with CSS attribute selectors" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-results-attribute-selectors-300x217.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-results-attribute-selectors.png" decoding="async" class="alignnone size-full wp-image-3729 jetpack-lazy-image" src="../Images/6d9817066eb037185b36d40ffd661fbc.png" alt="DevTools Results With CSS Attribute Selectors" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-results-attribute-selectors.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-results-attribute-selectors-300x217.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-results-attribute-selectors.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-results-attribute-selectors.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="3729" data-permalink="https://blog.logrocket.com/the-complete-best-practices-for-minifying-css/css-file-results-attribute-selectors/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-results-attribute-selectors.png" data-orig-size="730,527" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="DevTools results with CSS attribute selectors" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-results-attribute-selectors-300x217.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-results-attribute-selectors.png" decoding="async" loading="lazy" class="alignnone size-full wp-image-3729" src="../Images/6d9817066eb037185b36d40ffd661fbc.png" alt="DevTools Results With CSS Attribute Selectors" srcset="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-results-attribute-selectors.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-results-attribute-selectors-300x217.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/07/css-file-results-attribute-selectors.png"/></noscript>
<p>这种设计结构可能并不适用于所有的CSS minifiers，所以请试验一下，看看这是否适用于您的构建过程设置。</p>
<h2>总结和结论</h2>
<p>我们今天正在构建更复杂的web应用程序，这通常意味着向我们的最终用户交付更多的代码。代码精简有助于我们减轻交付给应用程序用户的代码量。</p>
<p>就像我们对JavaScript所做的一样，我们需要将CSS视为一等公民，有权为了用户的利益参与代码优化。缩小CSS是我们至少能做的。我们还可以更进一步，从我们的项目中删除死CSS。</p>
<p>意识到CSS对用户何时看到我们应用程序的任何内容有着巨大的影响，有助于我们优先优化其交付。</p>
<p>最后，采用一个构建过程或确保您现有的构建过程正在优化CSS代码就像用Parcel设置cssnano或使用一些插件和webpack或Rollup配置一样简单。</p><div class="code-block code-block-25">
<div class="blog-plug inline-plug css-plug"><h2>你的前端是否占用了用户的CPU？</h2><p>随着web前端变得越来越复杂，资源贪婪的特性对浏览器的要求越来越高。如果您对监控和跟踪生产环境中所有用户的客户端CPU使用情况、内存使用情况等感兴趣，</p><a target="_blank" href="https://lp.logrocket.com/blg/css-signup">try LogRocket</a><p>.</p><a class="signup" href="https://lp.logrocket.com/blg/css-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/dacb06c713aec161ffeaffae5bd048cd.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/dacb06c713aec161ffeaffae5bd048cd.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/cpu-memory-usage.png"/></noscript></a><a href="https://lp.logrocket.com/blg/css-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用的DVR，记录你的网络应用或网站上发生的一切。您可以汇总和报告关键的前端性能指标，重放用户会话和应用程序状态，记录网络请求，并自动显示所有错误，而不是猜测问题发生的原因。</p><p>现代化您调试web和移动应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/css-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>