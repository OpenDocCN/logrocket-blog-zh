<html>
<head>
<title>What's new in Firefox 67: Prefers-color-scheme and more - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>火狐67的新功能:更喜欢配色方案和更多日志</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/whats-new-in-firefox-67-prefers-color-scheme-and-more-195be81df03f/#0001-01-01">https://blog.logrocket.com/whats-new-in-firefox-67-prefers-color-scheme-and-more-195be81df03f/#0001-01-01</a></blockquote><div><article class="article-post">
<p>Mozilla一直在向前推进，Firefox 67的发布为可访问性和定制提供了一个很棒的新功能:<code>prefers-color-scheme</code>查询，它允许我们知道用户是否请求了浅色或深色主题，并相应地调整我们的设计。</p>
<p>对于用户和开发人员来说，还有许多其他的新特性，所以在深入研究这个令人敬畏的媒体查询之前，让我们先来看看这些特性。</p>
<h3>对用户的改进</h3>
<h4>并排轮廓</h4>
<p>用户现在可以同时运行多个版本的Firefox，每个版本都有不同的配置文件。以前，所有安装的版本共享一个单独的概要文件，所以这使得它更加安全可靠。</p>
<p><img decoding="async" class="progressiveMedia-image js-progressiveMedia-image aligncenter jetpack-lazy-image" src="../Images/73c4f9f1fe097416d661759acb3fd317.png" data-src="https://cdn-images-1.medium.com/max/1440/0*EfhJKb88psDnc4LC.png" data-lazy-src="https://cdn-images-1.medium.com/max/1440/0*EfhJKb88psDnc4LC.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://cdn-images-1.medium.com/max/1440/0*EfhJKb88psDnc4LC.png"/></p><noscript><img data-lazy-fallback="1" decoding="async" class="progressiveMedia-image js-progressiveMedia-image aligncenter" src="../Images/73c4f9f1fe097416d661759acb3fd317.png" data-src="https://cdn-images-1.medium.com/max/1440/0*EfhJKb88psDnc4LC.png" data-original-src="https://cdn-images-1.medium.com/max/1440/0*EfhJKb88psDnc4LC.png"/></noscript>
<h4>WebRender的增强性能</h4>
<p>经过多年的努力，Firefox逐渐开始为Windows 10用户提供他们的WebRender引擎，其他平台也将陆续推出。这是一个巨大的性能改进，当它们以影响管道渲染步骤的方式实现时，将允许更快的动画和滚动。</p>
<h4>增强的隐私控制</h4>
<p id="8dd4" class="graf graf--p graf-after--h4">现在，我们将能够阻止密码矿工和指纹。</p>
<p class="graf graf--p graf-after--h4"><img decoding="async" class="progressiveMedia-image js-progressiveMedia-image aligncenter jetpack-lazy-image" src="../Images/96b0beebf9bf9c7a8e40fdf221a18020.png" data-src="https://cdn-images-1.medium.com/max/1440/0*n3-yoDAsFi82VSYh.png" data-lazy-src="https://cdn-images-1.medium.com/max/1440/0*n3-yoDAsFi82VSYh.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://cdn-images-1.medium.com/max/1440/0*n3-yoDAsFi82VSYh.png"/></p><noscript><img data-lazy-fallback="1" decoding="async" class="progressiveMedia-image js-progressiveMedia-image aligncenter" src="../Images/96b0beebf9bf9c7a8e40fdf221a18020.png" data-src="https://cdn-images-1.medium.com/max/1440/0*n3-yoDAsFi82VSYh.png" data-original-src="https://cdn-images-1.medium.com/max/1440/0*n3-yoDAsFi82VSYh.png"/></noscript>
<h4>更好的帐户和密码管理</h4>
<p>Firefox 67包括许多旨在改善<a class="markup--anchor markup--p-anchor" href="https://matthew.noorenberghe.com/blog/2019/05/password-manager-improvements-firefox-67" target="_blank" rel="noopener noreferrer" data-href="https://matthew.noorenberghe.com/blog/2019/05/password-manager-improvements-firefox-67">密码和账户管理</a>的新功能，例如更容易访问已保存的登录信息，在私人窗口上保存密码的能力，以及对<code>autocomplete=”new-password”</code>的支持，它将不再由已保存的登录信息自动填充。</p>
<p><a href="https://logrocket.com/signup/"> <img decoding="async" class="progressiveMedia-image js-progressiveMedia-image aligncenter jetpack-lazy-image" src="../Images/386849f1f7f5e9c679ded10375d9134d.png" data-src="https://cdn-images-1.medium.com/max/2160/1*wV7zU6J05BL3bphzMlB2rA.png" data-lazy-src="https://cdn-images-1.medium.com/max/2160/1*wV7zU6J05BL3bphzMlB2rA.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://cdn-images-1.medium.com/max/2160/1*wV7zU6J05BL3bphzMlB2rA.png"/> <noscript> <img data-lazy-fallback="1" decoding="async" class="progressiveMedia-image js-progressiveMedia-image aligncenter" src="../Images/386849f1f7f5e9c679ded10375d9134d.png" data-src="https://cdn-images-1.medium.com/max/2160/1*wV7zU6J05BL3bphzMlB2rA.png" data-original-src="https://cdn-images-1.medium.com/max/2160/1*wV7zU6J05BL3bphzMlB2rA.png"/> </noscript></a></p>
<h3>开发人员的改进</h3>
<h4>JavaScript string . prototype . match all()</h4>
<p>Firefox现在与Chrome一起支持<a class="markup--anchor markup--p-anchor" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/matchAll" target="_blank" rel="noreferrer nofollow noopener" data-href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/matchAll"> matchAll()方法</a>，该方法返回所有匹配正则表达式字符串的结果的迭代器，包括捕获组。这使得通过避免循环来获得结果变得更加简单。</p>
<h4>CSS revert关键字</h4>
<p>CSS <code>revert</code>关键字允许我们将选择器的任何属性恢复到用户代理样式表中指定的值(即浏览器的默认值)。有一个类似的关键字叫做<code>initial</code>，但是它是基于每个属性的，而不是基于每个选择器的。</p>
<p>这意味着，例如，如果我们出于某种原因将<code>&lt;div&gt;</code>标签设置为<code>display:flex</code>，<code>revert</code>会将其设置回<code>display:block</code>，这是浏览器对<code>&lt;div&gt;</code>元素的<code>display</code>属性的默认值。同样，<code>initial</code>会将其设置为<code>display:inline</code>，即<code>display</code>属性的初始值。</p>
<p>这似乎是一个奇怪的极端情况，当我们需要为某个规则添加一个例外时，它会非常有用。</p>
<h3>首选颜色方案</h3>
<p>现代操作系统允许用户选择他们喜欢的浅色或深色主题。</p>
<p><code>prefers-color-scheme</code>媒体查询是<a class="markup--anchor markup--p-anchor" href="https://drafts.csswg.org/mediaqueries-5/#descdef-media-prefers-color-scheme" target="_blank" rel="noreferrer nofollow noopener" data-href="https://drafts.csswg.org/mediaqueries-5/#descdef-media-prefers-color-scheme"> CSS媒体查询第5级规范</a>的一部分，该规范旨在通过允许浏览器查询用户偏好并相应地调整页面来在web上提供这一功能。</p>
<p>对于患有<a class="markup--anchor markup--p-anchor" href="https://alistapart.com/article/accessibility-for-vestibular/" target="_blank" rel="noopener noreferrer" data-href="https://alistapart.com/article/accessibility-for-vestibular/">畏光症(对光敏感)、前庭障碍</a>的人，以及任何只是喜欢黑暗方案的人来说，这是一个好消息，这些方案在网络上很少见，但奇怪的是，在我们的文本编辑器和ide中却非常流行。</p>
<p>有效值为<code>light</code>(浅色背景上的深色文本)、<code>dark</code>(深色背景上的浅色文本)和<code>no-preference</code>(当用户没有已知偏好时)。</p>
<p>在其更基本的形式中，我们可以如下使用它:</p>
<pre>.element { background: white; color: black; }

@media (prefers-color-scheme: dark) {
  .element { background: black; color:  white; }
}</pre>
<p>这将在白色背景上有一个默认的黑色文本，但当用户指定了深色主题的偏好时，将它们反转。</p>
<p>如果上面的例子看起来非常简单，那是因为它确实如此。每次我们在CSS中设置颜色时都定义一个媒体查询是非常疯狂的。</p>
<h4>CSS变量来拯救！</h4>
<p>我们可以在根级别的CSS变量中定义所有文档的颜色，并在媒体查询中简单地切换它们的值，以立即使一切适应用户的偏好:</p>
<pre>:root{
  --foreground: #001144;
  --background: #CCFFEE;
  color: var(--foreground);
  background: var(--background);
}

@media (prefers-color-scheme: dark) {
  :root{
    --foreground: white;
    --background: black;
  }
}

@media (prefers-color-scheme: light) {
  :root{
    --foreground: black;
    --background: white;
  }
}</pre>
<p>默认情况下，这将在浅蓝色背景上提供深蓝色文本，当用户指定了深色主题的首选项时，这将变成黑色背景上的白色文本，当他们选择了浅色主题时，这将变成白色背景上的黑色文本。</p>
<p>上述方法可以很容易地适应多种颜色，无论主题约定。</p>
<h4>关于浏览器支持的说明</h4>
<p>到目前为止，只有Safari支持这个查询。但是Firefox现在已经加入进来，Chrome正在计划将其用于版本76(计划于7月30日)，所以这是一个在我们的项目中开始实现它的好机会。</p>
<p>也就是说，IE、老Edge和evergreen浏览器的旧版本仍在使用，所以如果项目允许，我们应该考虑它们。那么，使用这个特性的正确方法是渐进增强。</p>
<p>使用上面的例子，不支持<code>prefers-color-scheme</code>媒体查询的浏览器将忽略这个规则，因此，简单地不提供这个特性。这并不坏，但如果可能的话，我们应该允许用户在需要时通过其他方式来调整主题，比如在我们的应用程序或网站配置中的一个选项。</p>
<p>更大的问题是不支持CSS变量的浏览器，比如IE。但是我们可以用处理任何其他CSS变量的方式来处理它:设置一个默认值，该值稍后会被兼容浏览器上的变量覆盖:</p>
<pre>:root{
  /* initial values for the color variables */
  --foreground: #001144;
  --background: #CCFFEE;
  
  /* fallbacks for browsers that don't support variables */
  color: black;
  background: white;

  /* Set colors for browsers that support CSS Variables */
  color: var(--foreground);
  background: var(--background);
}

/* change the theming on browsers that support both variables and prefers-color-scheme*/
@media (prefers-color-scheme: dark) {
  :root{
    --foreground: white;
    --background: black;
  }
}</pre>
<h4>记住不同的媒体</h4>
<p>这很容易忘记，但打印页面仍然是一件事，而且通常情况下，选择了深色主题的用户在打印时仍然喜欢浅色主题。所以我建议将配色方案媒体查询和<code>screen</code>类型一起使用。</p>
<pre>@media screen and (prefers-color-scheme: dark) {
  :root{
    --foreground: white;
    --background: black;
  }
}</pre>
<h4>这不仅仅是关于颜色</h4>
<p>任何选择器的任何CSS属性都可以在这些媒体查询中更改，因此您可以调整从<code>opacity</code>(半透明的东西在切换背景时通常看起来很糟糕)到高级属性(如<code>mix-blend=mode</code>)的任何内容。</p><div class="code-block code-block-2">
<div class="blog-plug base-cta"><h2>使用<a class="signup" href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>消除传统错误报告的干扰</h2>
<a href="https://lp.logrocket.com/blg/signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p><a href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一个数字体验分析解决方案，它可以保护您免受数百个假阳性错误警报的影响，只针对几个真正重要的项目。LogRocket会告诉您应用程序中实际影响用户的最具影响力的bug和UX问题。</p>
<p>然后，使用具有深层技术遥测的会话重放来确切地查看用户看到了什么以及是什么导致了问题，就像你在他们身后看一样。</p>
<p>LogRocket自动聚合客户端错误、JS异常、前端性能指标和用户交互。然后LogRocket使用机器学习来告诉你哪些问题正在影响大多数用户，并提供你需要修复它的上下文。</p>
<p>关注重要的bug—<a class="signup" href="https://lp.logrocket.com/blg/signup-issue-free" target="_blank" rel="noopener noreferrer">今天就试试LogRocket】。</a></p></div></div>
<hr/>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>