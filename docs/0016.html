<html>
<head>
<title>Rendering large lists with React Virtualized - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用React Virtualized - LogRocket博客呈现大型列表</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/rendering-large-lists-react-virtualized/#0001-01-01">https://blog.logrocket.com/rendering-large-lists-react-virtualized/#0001-01-01</a></blockquote><div><article class="article-post">
<p><strong> <em>编者按</em> </strong> : <em>本文最后一次更新于2023年3月1日升级React和其他库版本，在功能组件中重新编写示例，用网格、集合、UI/UX改进示例扩展教程。</em></p>
<p>web应用程序中的一个常见需求是显示数据列表。或者带有标题和滚动条的表格。你可能已经做过几百次了。</p>
<p>但是如果你需要同时显示几千行呢？</p>
<p>如果分页技术不是一个选项(或者可能是，但是您仍然必须显示大量信息)，该怎么办？无限滚动技术仅限制呈现未来的元素，并呈现所有先前的行，这导致了非常大的列表的性能问题。</p>
<p>在本文中，我将向您展示如何使用<a href="https://github.com/bvaughn/react-virtualized"> react-virtualized </a>高效地显示大量数据。</p>
<p>首先，您将看到渲染巨大数据集的问题。然后，您将了解React Virtualized如何解决这些问题，以及如何使用<a href="https://bvaughn.github.io/react-virtualized/#/components/List"> List </a>和<a href="https://bvaughn.github.io/react-virtualized/#/components/AutoSizer"> Autosizer </a>组件高效地呈现第一个示例的列表。</p>
<p>您还将了解另外两个有用的组件:<a href="https://bvaughn.github.io/react-virtualized/#/components/CellMeasurer"> CellMeasurer </a>，用于动态测量行的宽度和高度，以及<a href="https://bvaughn.github.io/react-virtualized/#/components/ScrollSync"> ScrollSync </a>，用于同步两个或更多虚拟化组件之间的滚动。</p>
<p>向前跳:</p>

<h2 id="why-use-react-virtualized">为什么使用react-virtualized？</h2>
<p>React开发人员通常使用<code>map</code>函数并呈现多行列表。如果他们使用这种方法来呈现数千行，web浏览器将总是创建数千个DOM元素，即使滚动条通常隐藏溢出的内容。当DOM元素的位置随着用户事件(如滚动)而改变时，呈现新的DOM元素需要物理内存，并消耗CPU和GPU硬件。因此，如果我们在web应用程序中直接渲染大型列表，浏览器会大量使用计算机内存，并在渲染时增加CPU/GPU的使用量(尤其是在初始渲染阶段)。</p>
<p>因此，应用程序的帧率降低，变得缓慢，不再是不友好的用户。您可以在GitHub库中试验这个场景。查看以下预览，了解直接呈现的大列表如何影响应用程序性能:</p>
<p><img data-attachment-id="162346" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/directly-rendered-large-list-reduces-react-performance-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/directly-rendered-large-list-reduces-react-performance-1.gif" data-orig-size="730,348" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A directly-rendered large list reduces the React app performance" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/directly-rendered-large-list-reduces-react-performance-1-300x143.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/directly-rendered-large-list-reduces-react-performance-1.gif" decoding="async" class="aligncenter size-full wp-image-162346 jetpack-lazy-image" src="../Images/319beb9b56492574811c444793c35a63.png" alt="A Directly-rendered Large List Reduces The React App Performance" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2018/05/directly-rendered-large-list-reduces-react-performance-1.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/directly-rendered-large-list-reduces-react-performance-1.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162346" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/directly-rendered-large-list-reduces-react-performance-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/directly-rendered-large-list-reduces-react-performance-1.gif" data-orig-size="730,348" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A directly-rendered large list reduces the React app performance" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/directly-rendered-large-list-reduces-react-performance-1-300x143.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/directly-rendered-large-list-reduces-react-performance-1.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162346" src="../Images/319beb9b56492574811c444793c35a63.png" alt="A Directly-rendered Large List Reduces The React App Performance" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/directly-rendered-large-list-reduces-react-performance-1.gif"/></noscript>
<p>在功能较弱或布局更复杂的设备中，这可能会冻结用户界面，甚至使浏览器崩溃，影响应用程序的可用性。</p>
<p>那么我们如何高效地显示成千上万的行呢？</p>
<p>一种方法是使用react-virtualized之类的库，它以一种称为虚拟呈现的性能友好的技术来呈现大型列表。这个库通常只呈现大列表中的可见行，并创建较少的DOM元素来降低应用程序的性能开销。换句话说，这个库只显示所需的行，并通过CSS样式显示其他隐藏行的存在。</p>
<p>我们来研究一下它内部是如何工作的！</p>
<h2 id="how-does-react-virtualized-work">react虚拟化是如何工作的？</h2>
<p>虚拟渲染背后的主要概念是只渲染可见的东西。</p>
<p>应用程序中有1000条评论，但它在任何时候都只显示大约10条(适合屏幕的那些)，直到你滚动显示更多。</p>
<p>因此，只加载可见的元素并在它们不可见时卸载它们(用新的元素替换它们)是有意义的。</p>
<p>react-virtualized使用一组组件实现虚拟渲染，这些组件基本上以下列方式工作:</p>
<ul>
<li>它们根据滚动条位置和视区大小来计算列表显示区域(视区)内哪些项目是可见的</li>
<li>他们使用一个带有相对定位的容器(<code>div</code>)，通过控制它的顶部、左侧、宽度和高度样式属性来绝对定位其中的子元素</li>
</ul>
<p>上述实现策略通过仅呈现需要呈现给用户的元素来帮助高效地呈现大型列表。例如，如果您使用react-virtualized呈现10，000部电影的列表，它不会立即创建10，000个DOM节点。相反，当用户滚动时，它会指示您有许多带有小尺寸滚动条的电影，并呈现几个(可能10或20个)可视电影的DOM节点。与无限滚动策略不同，当用户向下滚动时，这种实现不会保留DOM树中过去的DOM元素。</p>
<p>react虚拟化库提供了五个主要组件:</p>
<ul>
<li><a href="https://github.com/bvaughn/react-virtualized/blob/master/docs/Grid.md">网格</a>:沿纵轴和横轴呈现表格数据</li>
<li><a href="https://github.com/bvaughn/react-virtualized/blob/master/docs/List.md"> List </a>:在内部使用<code>Grid</code>组件呈现元素列表</li>
<li><a href="https://github.com/bvaughn/react-virtualized/blob/master/docs/Table.md"> Table </a>:呈现一个具有固定标题和可垂直滚动的主体内容的表格。它还在内部使用了一个<code>Grid</code>组件</li>
<li><a href="https://github.com/bvaughn/react-virtualized/blob/master/docs/Masonry.md"> Masonry </a>:呈现动态大小的、用户定位的单元格，支持垂直滚动</li>
<li><a href="https://github.com/bvaughn/react-virtualized/blob/master/docs/Collection.md">集合</a>:渲染任意位置和重叠的数据</li>
</ul>
<p>这些组件从<a href="https://reactjs.org/docs/react-api.html#reactpurecomponent"> React延伸而来。PureComponent </a>，这意味着在比较对象时，它只比较它们的引用以提高性能。你可以在这里阅读更多关于这个<a href="https://github.com/bvaughn/react-virtualized#pure-components">的内容。</a></p>
<p>另一方面，react-virtualized还包括一些特定的组件:</p>
<ul>
<li><a href="https://github.com/bvaughn/react-virtualized/blob/master/docs/ArrowKeyStepper.md"> ArrowKeyStepper </a>:修饰另一个组件，使其能够响应箭头键事件</li>
<li><a href="https://github.com/bvaughn/react-virtualized/blob/master/docs/AutoSizer.md"> AutoSizer </a>:自动调整另一个组件的宽度和高度</li>
<li><a href="https://github.com/bvaughn/react-virtualized/blob/master/docs/CellMeasurer.md"> CellMeasurer </a>:通过以用户不可见的方式临时呈现来自动测量单元格的内容</li>
<li><a href="https://github.com/bvaughn/react-virtualized/blob/master/docs/ColumnSizer.md"> ColumnSizer </a>:计算网格单元格的列宽</li>
<li><a href="https://github.com/bvaughn/react-virtualized/blob/master/docs/InfiniteLoader.md"> InfiniteLoader </a>:当用户滚动列表、表格或网格时，管理数据的获取</li>
<li><a href="https://github.com/bvaughn/react-virtualized/blob/master/docs/MultiGrid.md">多重网格</a>:修饰一个<code>Grid</code>组件，添加固定的列和/或行</li>
<li><a href="https://github.com/bvaughn/react-virtualized/blob/master/docs/ScrollSync.md"> ScrollSync </a>:同步两个或多个组件之间的滚动</li>
<li><a href="https://github.com/bvaughn/react-virtualized/blob/master/docs/WindowScroller.md"> WindowScroller </a>:根据窗口的滚动位置使<code>Table</code>或<code>List</code>组件滚动</li>
</ul>
<p>现在让我们看看如何使用<code>List</code>组件来虚拟化5000条评论的例子。</p>
<h2 id="virtualizing-list">虚拟化列表</h2>
<p>首先，创建一个新的React项目:</p>
<pre class="language-bash hljs">npx create-react-app react-virtualized-demo
</pre>
<p>按如下方式安装依赖项:</p>
<pre class="language-bash hljs">npm install react-virtualized lorem-ipsum
# --- or ---
yarn add react-virtualized lorem-ipsum
</pre>
<p><em>注意，</em>如果您遇到npm对等依赖解析错误，您可以使用<code>legacy-peer-deps</code>选项来修复它。如果react-virtualized维护者向npm发布<a href="https://github.com/bvaughn/react-virtualized/commit/005be24a608add0344284053dae7633be86053b2">这个提交</a>，这个对等依赖错误将会消失。</p>
<p>接下来，在<code>src/App.js</code>中，从react-virtualized导入<code>List</code>组件，并进行所有必要的设置:</p>
<pre class="language-css hljs">import './App.css';

import { loremIpsum } from 'lorem-ipsum';
import { List } from 'react-virtualized';

const rowCount = 5000;
const listHeight = 400;
const rowHeight = 50;
const rowWidth = 700;

const list = Array(rowCount).fill().map((val, idx) =&gt; {
  return {
    id: idx,
    name: 'John Doe',
    image: 'http://via.placeholder.com/40',
    text: loremIpsum({
      count: 1,
      units: 'sentences',
      sentenceLowerBound: 4,
      sentenceUpperBound: 8
    })
  }
});
</pre>
<p>让我们使用<code>List</code>组件以虚拟化的方式呈现列表。在上述设置后添加以下代码:</p>
<pre class="language-javascript hljs">function renderRow({ index, key, style }) {
  return (
    &lt;div key={key} style={style} className="row"&gt;
      &lt;div className="image"&gt;
        &lt;img src={list[index].image} alt="" /&gt;
      &lt;/div&gt;
      &lt;div className="content"&gt;
        &lt;div&gt;{list[index].name}&lt;/div&gt;
        &lt;div&gt;{list[index].text}&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}

function App() {
  return (
    &lt;div className="App"&gt;
      &lt;div className="list"&gt;
        &lt;List
          width={rowWidth}
          height={listHeight}
          rowHeight={rowHeight}
          rowRenderer={renderRow}
          rowCount={list.length}
          overscanRowCount={3} /&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}

export default App;
</pre>
<p>然后，将以下样式定义添加到<code>src/App.css</code>:</p>
<pre class="language-css hljs">.App {
  text-align: center;
}

.list {
  padding: 10px;
}

.row {
  border-bottom: 1px solid #ebeced;
  text-align: left;
  margin: 5px 0;
  display: flex;
  align-items: center;
}

.image {
  margin-right: 10px;
}

.content {
  padding: 10px;
}
</pre>
<p>注意两件事。</p>
<p>首先，<code>List</code>组件要求您指定列表的宽度和高度。它还需要行的高度，这样它就可以计算哪些行将可见。</p>
<p><code>rowHeight</code>属性接受一个固定的行高或者一个返回给定索引的行的高度的函数。</p>
<p>其次，组件需要行数(列表长度)和一个函数来呈现每一行。它不直接拿单子。</p>
<p>由于这个原因，<code>renderRow</code>方法的实现需要改变。</p>
<p>这个方法不再接受列表中的对象作为参数。相反，<code>List</code>组件将传递给它<a href="https://github.com/bvaughn/react-virtualized/blob/master/docs/List.md#rowrenderer">一个具有以下属性的对象</a>:</p>
<pre class="language-javascript hljs">index.The index of the row.
isScrolling. Indicates if the List is currently being scrolled.
isVisible. Indicates if the row is visible on the list.
key. A unique key for the row.
parent. A reference to the parent List component.
style. The style object to be applied to the row to position it.
</pre>
<p>我们实现了如下的<code>renderRow</code>函数:</p>
<pre class="language-javascript hljs">function renderRow({ index, key, style }) {
  return (
    &lt;div key={key} style={style} className="row"&gt;
      &lt;div className="image"&gt;
        &lt;img src={list[index].image} alt="" /&gt;
      &lt;/div&gt;
      &lt;div className="content"&gt;
        &lt;div&gt;{list[index].name}&lt;/div&gt;
        &lt;div&gt;{list[index].text}&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}
</pre>
<p>请注意如何使用<code>index</code>属性来访问与正在呈现的行相对应的列表元素。此外，确保将传入的样式添加到<code>div</code>元素，以便在滚动期间正确定位行(在这种情况下，库动态应用CSS <code>top</code>属性)。</p>
<p>如果你运行这个应用程序，你会看到这样的内容:</p>
<p><img data-attachment-id="162349" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/using-virtualized-list-rendering-large-list/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/using-virtualized-list-rendering-large-list.gif" data-orig-size="730,382" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Using a virtualized list for rendering a large list in React" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/using-virtualized-list-rendering-large-list-300x157.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/using-virtualized-list-rendering-large-list.gif" decoding="async" class="aligncenter size-full wp-image-162349 jetpack-lazy-image" src="../Images/841548da5f93b498e9ae453eb4b5ba45.png" alt="Using A Virtualized List For Rendering A Large List In React" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2018/05/using-virtualized-list-rendering-large-list.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/using-virtualized-list-rendering-large-list.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162349" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/using-virtualized-list-rendering-large-list/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/using-virtualized-list-rendering-large-list.gif" data-orig-size="730,382" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Using a virtualized list for rendering a large list in React" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/using-virtualized-list-rendering-large-list-300x157.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/using-virtualized-list-rendering-large-list.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162349" src="../Images/841548da5f93b498e9ae453eb4b5ba45.png" alt="Using A Virtualized List For Rendering A Large List In React" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/using-virtualized-list-rendering-large-list.gif"/></noscript>
<p>如果您重复帧速率测试，这一次您将看到59/60 fps的恒定速率、较低的RAM使用率，并且没有CPU/GPU使用率峰值。如果我们在developer tools选项卡中查看页面的元素，您会看到现在这些行被放置在两个附加的<code>div</code>元素中:</p>
<p><img data-attachment-id="162351" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/rows-places-inside-two-div-elements/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/rows-places-inside-two-div-elements.png" data-orig-size="630,256" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The rows are placed inside two additional div elements" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/rows-places-inside-two-div-elements-300x122.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/rows-places-inside-two-div-elements.png" decoding="async" class="aligncenter size-full wp-image-162351 jetpack-lazy-image" src="../Images/087510e1b99767b9a4ee845c8e40b3da.png" alt="The Rows Are Placed Inside Two Additional Div Elements" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2018/05/rows-places-inside-two-div-elements.png 630w, https://blog.logrocket.com/wp-content/uploads/2018/05/rows-places-inside-two-div-elements-300x122.png 300w" data-lazy-sizes="(max-width: 630px) 100vw, 630px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2018/05/rows-places-inside-two-div-elements.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/rows-places-inside-two-div-elements.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162351" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/rows-places-inside-two-div-elements/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/rows-places-inside-two-div-elements.png" data-orig-size="630,256" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The rows are placed inside two additional div elements" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/rows-places-inside-two-div-elements-300x122.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/rows-places-inside-two-div-elements.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162351" src="../Images/087510e1b99767b9a4ee845c8e40b3da.png" alt="The Rows Are Placed Inside Two Additional Div Elements" srcset="https://blog.logrocket.com/wp-content/uploads/2018/05/rows-places-inside-two-div-elements.png 630w, https://blog.logrocket.com/wp-content/uploads/2018/05/rows-places-inside-two-div-elements-300x122.png 300w" sizes="(max-width: 630px) 100vw, 630px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/rows-places-inside-two-div-elements.png"/></noscript>
<p>外部的<code>div</code>元素(具有CSS类<code>ReactVirtualized__GridReactVirtualized__List</code>的元素)具有组件中指定的宽度和高度(分别为700px和400px)，并且具有相对位置和<code>overflow</code>的值<code>auto</code>(用于添加滚动条)。</p>
<p>内部<code>div</code>元素(带有CSS类<code>ReactVirtualized__Grid__innerScrollContainer</code>的元素)的最大宽度为700px，但高度为250，000px，这是行数(5，000)乘以每行高度(50)的结果。它也有一个相对位置，但有一个溢出的隐藏值。</p>
<p>所有的行都是这个<code>div</code>元素的子元素，这一次，没有5000个元素。但是，也不是八九元素；大约还有十个。</p>
<p>这是因为<code>List</code>组件呈现了额外的元素，以减少快速滚动导致的闪烁。</p>
<p>附加元素的数量由<a href="https://github.com/bvaughn/react-virtualized/blob/master/docs/overscanUsage.md"> <code>overscanRowCount</code> </a>属性控制。例如，如果我将<code>3</code>设置为该属性的值:</p>
<pre class="language-javascript hljs">&lt;List
  width={rowWidth}
  height={listHeight}
  rowHeight={rowHeight}
  rowRenderer={renderRow}
  rowCount={list.length}
  overscanRowCount={3} /&gt;
</pre>
<p>我将在<strong> Elements </strong>选项卡中看到的元素数量大约为12个。</p>
<p>另外，看看元素和它们的<code>top</code>样式是如何动态更新的:</p>
<p><img data-attachment-id="162353" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/scrolling-events-change-css-top-attribute/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolling-events-change-css-top-attribute.gif" data-orig-size="730,382" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Scrolling events change the CSS top attribute dynamically" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolling-events-change-css-top-attribute-300x157.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolling-events-change-css-top-attribute.gif" decoding="async" class="aligncenter size-full wp-image-162353 jetpack-lazy-image" src="../Images/61f4e20f70a7232f7d704fb26631175e.png" alt="Scrolling Events Change The CSS Top Attribute Dynamically" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolling-events-change-css-top-attribute.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolling-events-change-css-top-attribute.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162353" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/scrolling-events-change-css-top-attribute/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolling-events-change-css-top-attribute.gif" data-orig-size="730,382" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Scrolling events change the CSS top attribute dynamically" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolling-events-change-css-top-attribute-300x157.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolling-events-change-css-top-attribute.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162353" src="../Images/61f4e20f70a7232f7d704fb26631175e.png" alt="Scrolling Events Change The CSS Top Attribute Dynamically" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolling-events-change-css-top-attribute.gif"/></noscript>
<p>缺点是您必须指定列表的宽度和高度以及行的高度。幸运的是，您可以使用<code>AutoSizer</code>和<code>CellMeasurer</code>组件来解决这个问题。</p>
<p>先说<code>AutoSizer</code>。</p>
<h2 id="autoresizing-virtualized-list">自动调整虚拟列表的大小</h2>
<p>像<code>AutoSizer</code>这样的组件使用名为function的模式作为子组件。</p>
<p>顾名思义，不是将组件作为子组件传递:</p>
<pre class="language-css hljs">&lt;AutoSizer&gt;
  &lt;List
  ...
  /&gt;
&lt;/AutoSizer&gt;
</pre>
<p>你必须传递一个函数。在这种情况下，它接收计算的宽度和高度:</p>
<pre class="language-css hljs">&lt;AutoSizer&gt;
  {
    ({ width, height }) =&gt; {}
  }
&lt;/AutoSizer&gt;
</pre>
<p>这样，该函数将返回配置了宽度和高度的<code>List</code>组件:</p>
<pre class="language-css hljs">&lt;AutoSizer&gt;
  {
    ({ width, height }) =&gt; (&lt;List
        width={width}
        height={height}
        rowHeight={rowHeight}
        rowRenderer={renderRow}
        rowCount={list.length}
        overscanRowCount={3} /&gt;
    )
  }
&lt;/AutoSizer&gt;
</pre>
<p><code>AutoSizer</code>组件将填充其父组件的所有可用空间，因此如果您想要填充标题后的所有空间，在<code>src/App.css</code>中，您可以将下面一行添加到list类中:</p>
<pre class="language-css hljs">.list {
  /*...*/
  height: calc(100vh - 20px);
}
</pre>
<p><code>vh</code>单位对应视口的高度(浏览器窗口大小)，所以100vh相当于视口高度的100%。因为<code>list</code>类添加的填充(10px x 2)，所以减去了20px。</p>
<p>如果尚未导入<code>AutoSizer</code>组件，请导入:</p>
<pre class="language-javascript hljs">import { List, AutoSizer } from 'react-virtualized';
</pre>
<p>当您运行应用程序时，您应该会看到类似这样的内容:</p>
<p><img data-attachment-id="162355" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/running-react-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/running-react-app.png" data-orig-size="730,337" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Running the React app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/running-react-app-300x138.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/running-react-app.png" decoding="async" class="aligncenter size-full wp-image-162355 jetpack-lazy-image" src="../Images/f362cceb2390ef55bdb63ab03a3755c5.png" alt="Running The React App" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2018/05/running-react-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2018/05/running-react-app-300x138.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2018/05/running-react-app.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/running-react-app.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162355" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/running-react-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/running-react-app.png" data-orig-size="730,337" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Running the React app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/running-react-app-300x138.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/running-react-app.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162355" src="../Images/f362cceb2390ef55bdb63ab03a3755c5.png" alt="Running The React App" srcset="https://blog.logrocket.com/wp-content/uploads/2018/05/running-react-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2018/05/running-react-app-300x138.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/running-react-app.png"/></noscript>
<p>如果调整窗口大小，列表的高度和宽度会自动调整:</p>
<p><img data-attachment-id="162358" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/resizing-window-adjusting-height-width/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/resizing-window-adjusting-height-width.gif" data-orig-size="730,391" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Resizing the window and the height and width adjust automatically" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/resizing-window-adjusting-height-width-300x161.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/resizing-window-adjusting-height-width.gif" decoding="async" class="aligncenter size-full wp-image-162358 jetpack-lazy-image" src="../Images/5f360f2b6a934f27381132eda777993b.png" alt="Resizing The Window And The Height And Width Adjust Automatically" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2018/05/resizing-window-adjusting-height-width.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/resizing-window-adjusting-height-width.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162358" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/resizing-window-adjusting-height-width/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/resizing-window-adjusting-height-width.gif" data-orig-size="730,391" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Resizing the window and the height and width adjust automatically" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/resizing-window-adjusting-height-width-300x161.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/resizing-window-adjusting-height-width.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162358" src="../Images/5f360f2b6a934f27381132eda777993b.png" alt="Resizing The Window And The Height And Width Adjust Automatically" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/resizing-window-adjusting-height-width.gif"/></noscript>
<h2 id="calculating-height-row-automatically">自动计算行高</h2>
<p>该应用程序会生成一个适合一行的短句，但是如果您将<code>lorem-ipsum</code>生成器的设置更改为如下所示:</p>
<pre class="language-javascript hljs">text: loremIpsum({
  count: 2,
  units: 'sentences',
  sentenceLowerBound: 2,
  sentenceUpperBound: 100
})
</pre>
<p>一切都变得一团糟:</p>
<p><img data-attachment-id="162360" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/react-app-errors/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/react-app-errors.gif" data-orig-size="730,391" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React app error" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/react-app-errors-300x161.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/react-app-errors.gif" decoding="async" class="aligncenter size-full wp-image-162360 jetpack-lazy-image" src="../Images/6c707e0dfb21824ae7ca8e1b459fd3f3.png" alt="React App Error" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2018/05/react-app-errors.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/react-app-errors.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162360" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/react-app-errors/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/react-app-errors.gif" data-orig-size="730,391" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React app error" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/react-app-errors-300x161.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/react-app-errors.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162360" src="../Images/6c707e0dfb21824ae7ca8e1b459fd3f3.png" alt="React App Error" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/react-app-errors.gif"/></noscript>
<p>这是因为每个单元格的高度都有一个固定值50。如果你想拥有动态高度，你必须使用<code>CellMeasurer</code>组件。</p>
<p>该组件与<a href="https://github.com/bvaughn/react-virtualized/blob/master/docs/CellMeasurer.md#cellmeasurercache"> <code>CellMeasurerCache</code> </a>协同工作，后者存储测量值以避免一直重新计算。</p>
<p>要使用这些组件，请先导入它们:</p>
<pre class="language-javascript hljs">import { List, AutoSizer, CellMeasurer, CellMeasurerCache } from 'react-virtualized';
</pre>
<p>接下来，在constants部分创建一个<code>CellMeasurerCache</code>的实例(在所有导入和<code>const list…</code>之后):</p>
<pre class="language-javascript hljs">const cache = new CellMeasurerCache({
  fixedWidth: true,
  defaultHeight: 100
});
</pre>
<p>因为不需要计算行的宽度，所以将<code>fixedWidth</code>属性设置为<code>true</code>。</p>
<p>接下来，我们需要用<code>CellMeasurer</code>更新<code>renderRow</code>函数，如下所示:</p>
<pre class="language-javascript hljs">function renderRow({ index, key, style, parent }) {
  return (
    &lt;CellMeasurer
      key={key}
      cache={cache}
      parent={parent}
      columnIndex={0}
      rowIndex={index}&gt;
      {({registerChild}) =&gt; (
        &lt;div style={style} className="row" ref={registerChild}&gt;
          &lt;div className="image"&gt;
            &lt;img src={list[index].image} alt="" /&gt;
          &lt;/div&gt;
          &lt;div className="content"&gt;
            &lt;div&gt;{list[index].name}&lt;/div&gt;
            &lt;div&gt;{list[index].text}&lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      )}
    &lt;/CellMeasurer&gt;
  );
}
</pre>
<p>请注意以下关于<code>CellMeasuer</code>的内容:</p>
<ul>
<li>这个组件是用来区分元素的关键</li>
<li>它采用之前配置的缓存</li>
<li>它将父组件(<code>List</code>)带到要渲染的地方，所以您也需要这个参数</li>
<li>使用<code>registerChild</code> ref通过函数将内容部分呈现为组件策略，以避免<a href="https://github.com/bvaughn/react-virtualized/blob/master/docs/CellMeasurer.md#using-registerchild"> <code>findDOMNode</code> </a> <a href="https://github.com/bvaughn/react-virtualized/blob/master/docs/CellMeasurer.md#using-registerchild"> API错误</a></li>
</ul>
<p>最后，您只需要修改<code>List</code>组件，使其使用缓存并从缓存中获取其高度:</p>
<pre class="language-javascript hljs">&lt;AutoSizer&gt;
  {
    ({ width, height }) =&gt; (&lt;List
        width={width}
        height={height}
        deferredMeasurementCache={cache}
        rowHeight={cache.rowHeight}
        rowRenderer={renderRow}
        rowCount={list.length}
        overscanRowCount={3} /&gt;
    )
  }
&lt;/AutoSizer&gt;
</pre>
<p>现在，当您运行应用程序时，一切看起来都很好:</p>
<p><img data-attachment-id="162362" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/modifying-list-component-react-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/modifying-list-component-react-app.gif" data-orig-size="730,391" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Modifying the list component to fix the React app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/modifying-list-component-react-app-300x161.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/modifying-list-component-react-app.gif" decoding="async" class="aligncenter size-full wp-image-162362 jetpack-lazy-image" src="../Images/ec9446f41f86007f7eaaddd8b76d7e8e.png" alt="Modifying The List Component To Fix The React App" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2018/05/modifying-list-component-react-app.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/modifying-list-component-react-app.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162362" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/modifying-list-component-react-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/modifying-list-component-react-app.gif" data-orig-size="730,391" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Modifying the list component to fix the React app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/modifying-list-component-react-app-300x161.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/modifying-list-component-react-app.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162362" src="../Images/ec9446f41f86007f7eaaddd8b76d7e8e.png" alt="Modifying The List Component To Fix The React App" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/modifying-list-component-react-app.gif"/></noscript>

<p>另一个有用的组件是<code>ScrollSync</code>。</p>
<p>对于本例，您需要返回到先前的配置，该配置返回一个简短的句子:</p>
<pre class="language-javascript hljs">text: loremIpsum({
  count: 1,
  units: 'sentences',
  sentenceLowerBound: 4,
  sentenceUpperBound: 8
})
</pre>
<p>原因是您<a href="https://stackoverflow.com/questions/45682063/react-virtualized-share-cellmeasurercache-for-multiple-grids/45684069#45684069">不能在两个组件</a>之间共享一个CellMeausure缓存，所以我接下来要展示的两个列表不能有动态高度，就像前面的例子一样。至少不是以一种简单的方式。</p>
<p>如果你想要动态高度类似于本节的例子，最好使用<a href="https://bvaughn.github.io/react-virtualized/#/components/MultiGrid">多重网格</a>组件。</p>
<p>继续，首先导入<code>ScrollSync</code>，撤销代码并移除动态高度特性。或者，在<code>src/App.js</code>中使用以下代码:</p>
<pre class="language-css hljs">import './App.css';

import { loremIpsum } from 'lorem-ipsum';
import { List, AutoSizer } from 'react-virtualized';

const rowCount = 5000;
const listHeight = 400;
const rowHeight = 50;
const rowWidth = 700;

const list = Array(rowCount).fill().map((val, idx) =&gt; {
  return {
    id: idx,
    name: 'John Doe',
    image: 'http://via.placeholder.com/40',
    text: loremIpsum({
      count: 1,
      units: 'sentences',
      sentenceLowerBound: 4,
      sentenceUpperBound: 8
    })
  }
});

function renderRow({ index, key, style }) {
  return (
    &lt;div key={key} style={style} className="row"&gt;
      &lt;div className="image"&gt;
        &lt;img src={list[index].image} alt="" /&gt;
      &lt;/div&gt;
      &lt;div className="content"&gt;
        &lt;div&gt;{list[index].name}&lt;/div&gt;
        &lt;div&gt;{list[index].text}&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}

function App() {
  return (
    &lt;div className="App"&gt;
      &lt;div className="list"&gt;
        &lt;AutoSizer&gt;
          {
            ({ width, height }) =&gt; (&lt;List
                width={width}
                height={height}
                rowHeight={rowHeight}
                rowRenderer={renderRow}
                rowCount={list.length}
                overscanRowCount={3} /&gt;
            )
          }
        &lt;/AutoSizer&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}

export default App;


import { List, AutoSizer, ScrollSync } from 'react-virtualized';
</pre>
<p>在<code>render</code>语句中，用<code>ScrollSync</code>组件中的<code>list</code>类包装<code>div</code>元素，如下所示:</p>
<pre class="language-javascript hljs">&lt;ScrollSync&gt;
  {({ onScroll, scrollTop, scrollLeft }) =&gt; (
    &lt;div className="list"&gt;
      &lt;AutoSizer&gt;
      {
        ({ width, height }) =&gt; {
          return (
            &lt;List
              width={width}
              height={height}
              rowHeight={rowHeight}
              onScroll={onScroll}
              rowRenderer={renderRow}
              rowCount={list.length}
              overscanRowCount={3} /&gt;
          )
        }
      }
      &lt;/AutoSizer&gt;
    &lt;/div&gt;
  )
}
&lt;/ScrollSync&gt;


`ScrollSync` also takes a function as a child to pass some parameters. Perhaps the ones that you’ll use most of the time are:
onScroll. A function that will trigger updates to the scroll parameters to update the other components, so it should be passed to at least one of the child components.
scrollTop. The current scroll-top offset, updated by the onScroll function.
scrollLeft. The current scroll-left offset, updated by the onScroll function.
</pre>
<p>如果您放置一个span元素来显示<code>scrollTop</code>和<code>scrollLeft</code>参数…</p>
<pre class="language-javascript hljs">...
...
&lt;ScrollSync&gt;
  {({ onScroll, scrollTop, scrollLeft }) =&gt; (
    &lt;div className="list"&gt;
       &lt;span&gt;{scrollTop} - {scrollLeft}&lt;/span&gt;
      &lt;AutoSizer&gt;
      {
...
...
</pre>
<p>…然后运行应用程序，您应该会看到当您滚动列表时,<code>scrollTop</code>参数是如何更新的:</p>
<p><img data-attachment-id="162364" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/scrolltop-parameter-updated-scrolling/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolltop-parameter-updated-scrolling.gif" data-orig-size="730,329" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The scrollTop parameter is updated as you scroll the list" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolltop-parameter-updated-scrolling-300x135.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolltop-parameter-updated-scrolling.gif" decoding="async" class="aligncenter size-full wp-image-162364 jetpack-lazy-image" src="../Images/384283c81e230fa2101866da64a135c6.png" alt="The ScrollTop Parameter Is Updated As You Scroll The List" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolltop-parameter-updated-scrolling.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolltop-parameter-updated-scrolling.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162364" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/scrolltop-parameter-updated-scrolling/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolltop-parameter-updated-scrolling.gif" data-orig-size="730,329" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The scrollTop parameter is updated as you scroll the list" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolltop-parameter-updated-scrolling-300x135.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolltop-parameter-updated-scrolling.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162364" src="../Images/384283c81e230fa2101866da64a135c6.png" alt="The ScrollTop Parameter Is Updated As You Scroll The List" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolltop-parameter-updated-scrolling.gif"/></noscript>
<p>因为列表没有水平滚动，所以<code>scrollLeft</code>参数没有值。</p>
<p>现在，对于这个示例，您将添加另一个列表，该列表将显示每个评论的ID，并且它的滚动将与另一个列表同步。</p>
<p>所以让我们从为这个新列表添加另一个<code>render</code>函数开始:</p>
<pre class="language-javascript hljs">function renderColumn({ index, key, style }) {
  return (
    &lt;div key={key} style={style} className="row"&gt;
      &lt;div className="content"&gt;
        &lt;div&gt;{list[index].id}&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}
</pre>
<p>接下来，在<code>AutoSizer</code>组件中，禁用宽度计算:</p>
<pre class="language-javascript hljs">&lt;AutoSizer disableWidth&gt;
{
   ({ height }) =&gt; {
     ...
   }
}
&lt;/AutoSizer&gt;
</pre>
<p>您不再需要它了，因为您将为两个列表设置一个固定的宽度，并使用绝对位置将它们放在一起。</p>
<p>大概是这样的:</p>
<pre class="language-javascript hljs">&lt;div className="list"&gt;
  &lt;AutoSizer disableWidth&gt;
  {
    ({ height }) =&gt; (
      &lt;div&gt;
        &lt;div
          style={{
            position: 'absolute',
            top: 0,
            left: 0,
          }}&gt;
            &lt;List
              className="leftSide"
              width={40}
              height={height}
              rowHeight={rowHeight}
              scrollTop={scrollTop}
              rowRenderer={renderColumn}
              rowCount={list.length}
              overscanRowCount={3}  /&gt;
        &lt;/div&gt;
        &lt;div
          style={{
            position: 'absolute',
            top: 0,
            left: 50,
          }}&gt;
            &lt;List
              width={700}
              height={height}
              rowHeight={rowHeight}
              onScroll={onScroll}
              rowRenderer={renderRow}
              rowCount={list.length}
              overscanRowCount={3}  /&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      )
  }
  &lt;/AutoSizer&gt;
&lt;/div&gt;
</pre>
<p>注意，<code>scrollTop</code>参数被传递给第一个列表，因此它的滚动可以被自动控制，而<code>onScroll</code>函数被传递给另一个列表来更新<code>scrollTop</code>值。</p>
<p>第一个列表的<code>leftSide</code>类只是隐藏了卷轴(因为你不需要它):</p>
<pre class="language-javascript hljs">.leftSide {
  overflow: hidden !important;
}
</pre>
<p>最后，如果您运行应用程序并滚动右侧列表，您将看到另一个列表也是如何滚动的:</p>
<p><img data-attachment-id="162366" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/scrolling-right-side-list/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolling-right-side-list.gif" data-orig-size="730,391" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Scrolling down the right side list" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolling-right-side-list-300x161.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolling-right-side-list.gif" decoding="async" class="aligncenter size-full wp-image-162366 jetpack-lazy-image" src="../Images/ba342c223e754328e8479078d70e4fac.png" alt="Scrolling Down The Right Side List" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolling-right-side-list.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolling-right-side-list.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162366" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/scrolling-right-side-list/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolling-right-side-list.gif" data-orig-size="730,391" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Scrolling down the right side list" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolling-right-side-list-300x161.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolling-right-side-list.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162366" src="../Images/ba342c223e754328e8479078d70e4fac.png" alt="Scrolling Down The Right Side List" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/scrolling-right-side-list.gif"/></noscript>
<h2 id="improving-ui-ux-large-lists">改进大型列表的用户界面/UX</h2>
<p>实施UI/UX改进有助于我们提高web应用的质量。大型列表通常看起来很复杂，但是我们可以使用几个UI/UX概念来降低复杂性，使它们对用户来说最小化。</p>
<h3 id="adding-clickable-elements-rows">向行中添加可点击的元素(链接和按钮)</h3>
<p>我们可以通过将内容移动到另一个页面、弹出窗口或带有链接或按钮的浏览器窗口来简化复杂的列表或网格。请看下面的示例源:</p>
<pre class="language-css hljs">import './App.css';

import { loremIpsum } from 'lorem-ipsum';
import { List, AutoSizer } from 'react-virtualized';

const rowCount = 5000;
const listHeight = 400;
const rowHeight = 80;
const rowWidth = 700;

const list = Array(rowCount).fill().map((val, idx) =&gt; {
  return {
    id: idx,
    name: 'The book',
    image: 'http://via.placeholder.com/40',
    text: loremIpsum({
      count: 1,
      units: 'sentences',
      sentenceLowerBound: 4,
      sentenceUpperBound: 8
    }),
    description: loremIpsum({
      count: 5,
      units: 'sentences',
      sentenceLowerBound: 4,
      sentenceUpperBound: 8
    })
  }
});

function renderRow({ index, key, style }) {
  return (
    &lt;div key={key} style={style} className="row"&gt;
      &lt;div className="image"&gt;
        &lt;img src={list[index].image} alt="" /&gt;
      &lt;/div&gt;
      &lt;div className="content"&gt;
        &lt;div&gt;{list[index].name}&lt;/div&gt;
        &lt;div&gt;{list[index].text}&lt;/div&gt;
        &lt;button
          style={{marginTop: '8px'}}
          onClick={() =&gt; alert(list[index].name + '\n\n' + list[index].description)}
        &gt;Read more...&lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}

function App() {
  return (
    &lt;div className="App"&gt;
      &lt;div className="list"&gt;
        &lt;AutoSizer&gt;
          {
            ({ width, height }) =&gt; (&lt;List
                width={width}
                height={height}
                rowHeight={rowHeight}
                rowRenderer={renderRow}
                rowCount={list.length}
                overscanRowCount={3} /&gt;
            )
          }
        &lt;/AutoSizer&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}

export default App;
</pre>
<p>上面的代码显示了一个按钮，该按钮显示一行的更多详细信息，如下所示:</p>
<p><img data-attachment-id="162368" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/displaying-row-details-button/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/displaying-row-details-button.gif" data-orig-size="730,391" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Displaying row details with a button" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/displaying-row-details-button-300x161.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/displaying-row-details-button.gif" decoding="async" class="aligncenter size-full wp-image-162368 jetpack-lazy-image" src="../Images/e755a91b3275255394d8eeb2cc57f13d.png" alt="Displaying Row Details With A Button" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2018/05/displaying-row-details-button.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/displaying-row-details-button.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162368" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/displaying-row-details-button/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/displaying-row-details-button.gif" data-orig-size="730,391" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Displaying row details with a button" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/displaying-row-details-button-300x161.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/displaying-row-details-button.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162368" src="../Images/e755a91b3275255394d8eeb2cc57f13d.png" alt="Displaying Row Details With A Button" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/displaying-row-details-button.gif"/></noscript>
<p>同样，您可以添加链接，甚至使整行都可以点击！</p>
<h3 id="creating-virtualized-collapsible-list">创建虚拟化可折叠列表</h3>
<p>使列表行可折叠是隐藏复杂细节的另一种选择，无需使用链接或按钮来打开弹出窗口。这一次我们需要如下使用<code>CellMeasurer</code>,因为可折叠元素会动态改变行高。将以下代码添加到您的<code>src/App.js</code>文件中:</p>
<pre class="language-css hljs">import './App.css';

import React, { useState, useEffect } from 'react';
import { loremIpsum } from 'lorem-ipsum';
import { List, AutoSizer, CellMeasurer, CellMeasurerCache } from 'react-virtualized';

const rowCount = 5000;

const list = Array(rowCount).fill().map((val, idx) =&gt; {
  return {
    id: idx,
    name: 'John Doe',
    image: 'http://via.placeholder.com/40',
    text: loremIpsum({
      count: 10,
      units: 'sentences',
      sentenceLowerBound: 4,
      sentenceUpperBound: 8
    })
  }
});


const cache = new CellMeasurerCache({
  fixedWidth: true,
  defaultHeight: 100
});

function Collapsible({ children, title, onChange }) {
  const [expanded, setExpanded] = useState(false);
  useEffect(() =&gt; {
    onChange &amp;&amp; onChange();
  }, [expanded, onChange]);
  return (
    &lt;&gt;
      &lt;div className="accordHeader" onClick={() =&gt; setExpanded(!expanded)}&gt;{title}&lt;/div&gt;
      { expanded &amp;&amp;
        &lt;&gt;
          {children}
        &lt;/&gt;
      }
    &lt;/&gt;
  );
}

function renderRow({ index, key, style, parent }) {
  return (
    &lt;CellMeasurer
      key={key}
      cache={cache}
      parent={parent}
      columnIndex={0}
      rowIndex={index}&gt;
      {({registerChild, measure}) =&gt; (
        &lt;div style={style} className="row" ref={registerChild}&gt;
          &lt;Collapsible title={list[index].name} onChange={measure}&gt;
            &lt;div className="image"&gt;
              &lt;img src={list[index].image} alt="" /&gt;
            &lt;/div&gt;
            &lt;div className="content"&gt;
              &lt;div&gt;{list[index].name}&lt;/div&gt;
              &lt;div&gt;{list[index].text}&lt;/div&gt;
            &lt;/div&gt;
          &lt;/Collapsible&gt;
        &lt;/div&gt;
      )}
    &lt;/CellMeasurer&gt;
  );
}

function App() {
  return (
    &lt;div className="App"&gt;
      &lt;div className="list"&gt;
        &lt;AutoSizer&gt;
          {
            ({ width, height }) =&gt; (&lt;List
                width={width}
                height={height}
                deferredMeasurementCache={cache}
                rowHeight={cache.rowHeight}
                rowRenderer={renderRow}
                rowCount={list.length}
                overscanRowCount={3} /&gt;
            )
          }
        &lt;/AutoSizer&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}

export default App;
</pre>
<p>注意，这里我们调用<code>measure</code>函数，当可扩展状态改变时，通过<code>CellMeasurer</code>调整单元格大小。接下来，对<code>src/App.css</code>使用以下内容:</p>
<pre class="language-css hljs">.App {
  text-align: center;
}

.list {
  padding: 10px;
  height: calc(100vh - 20px);
}

.row {
  border-bottom: 1px solid #ebeced;
  text-align: left;
  margin: 5px 0;
  display: flex;
  align-items: center;
  flex-wrap: wrap;
}

.image {
  margin-right: 10px;
}

.content {
  padding: 10px;
  flex: 1;
}

.accordHeader {
  background: #ddd;
  width: 100%;
  padding: 8px;
  cursor: pointer;
  margin-bottom: 4px;
}
</pre>
<p>现在，您将看到一个虚拟的可扩展列表，如下所示:</p>
<p><img data-attachment-id="162370" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/virtualized-expandable-list/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/virtualized-expandable-list.gif" data-orig-size="730,391" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A virtualized expendable list" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/virtualized-expandable-list-300x161.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/virtualized-expandable-list.gif" decoding="async" class="aligncenter size-full wp-image-162370 jetpack-lazy-image" src="../Images/d318606c3dbed907d92f14f0db26b645.png" alt="A Virtualized Expendable List" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2018/05/virtualized-expandable-list.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/virtualized-expandable-list.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162370" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/virtualized-expandable-list/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/virtualized-expandable-list.gif" data-orig-size="730,391" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A virtualized expendable list" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/virtualized-expandable-list-300x161.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/virtualized-expandable-list.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162370" src="../Images/d318606c3dbed907d92f14f0db26b645.png" alt="A Virtualized Expendable List" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/virtualized-expandable-list.gif"/></noscript>
<h2 id="virtualizing-grid">虚拟化网格</h2>
<p>在上面的代码示例中，我们主要使用了<code>List</code>组件来呈现一个大列表。在某些场景中，我们需要在应用程序中呈现大型数据网格。例如，您可能需要创建一个大型表格结构来显示具有数百个订单属性和数千个订单记录的产品订单。</p>
<p>提供了一种创建1D数据网格的方法，因为我们只有垂直滚动条。<code>Grid</code>让你创建一个2D网格，你可以有垂直和水平滚动条。因此，您可以使用滚动事件有效地呈现x轴和y轴上的元素。</p>
<p>为了演示这个组件，我们可以在一个网格中列出注释。首先，将以下代码添加到您的<code>src/App.js</code>文件中:</p>
<pre class="language-css hljs">import './App.css';

import { loremIpsum } from 'lorem-ipsum';
import { Grid, AutoSizer } from 'react-virtualized';

const columnCount = 100;
const rowCount = 1000;
const columnWidth = 400;
const rowHeight = 50;

const grid = Array(rowCount).fill().map((val, idx) =&gt; (
    Array(columnCount).fill().map((val, idx) =&gt; ({
      id: idx,
      name: 'John Doe',
      image: 'http://via.placeholder.com/40',
      text: loremIpsum({
        count: 4,
        units: 'word'
      })
    }))
));

function renderCell({ columnIndex, key, rowIndex, style }) {
  return (
    &lt;div key={key} style={style} className="row"&gt;
      &lt;div className="image"&gt;
        &lt;img src={grid\[rowIndex\][columnIndex].image} alt="" /&gt;
      &lt;/div&gt;
      &lt;div className="content"&gt;
        &lt;div&gt;{grid\[rowIndex\][columnIndex].name}&lt;/div&gt;
        &lt;div&gt;{grid\[rowIndex\][columnIndex].text}&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}

function App() {
  return (
    &lt;div className="App"&gt;
      &lt;div className="list"&gt;
        &lt;AutoSizer&gt;
          {
            ({width, height}) =&gt; (
            &lt;Grid
              width={width}
              height={height}
              rowHeight={rowHeight}
              columnWidth={columnWidth}
              cellRenderer={renderCell}
              rowCount={grid.length}
              columnCount={grid[0].length}/&gt;
            )
          }
        &lt;/AutoSizer&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}

export default App;
</pre>
<p>在应用程序中，您现在会看到一个评论网格:</p>
<p><img data-attachment-id="162372" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/grid-comments/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/grid-comments.gif" data-orig-size="730,329" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A grid of comments" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/grid-comments-300x135.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/grid-comments.gif" decoding="async" class="aligncenter size-full wp-image-162372 jetpack-lazy-image" src="../Images/724e43a3ba2949d1412cce4a3e6c4d80.png" alt="A Grid Of Comments" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2018/05/grid-comments.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/grid-comments.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162372" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/grid-comments/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/grid-comments.gif" data-orig-size="730,329" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A grid of comments" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/grid-comments-300x135.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/grid-comments.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162372" src="../Images/724e43a3ba2949d1412cce4a3e6c4d80.png" alt="A Grid Of Comments" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/grid-comments.gif"/></noscript>
<p>窗口调整事件也会更新网格大小，因为我们已经使用了<code>AutoSizer</code>组件。</p>
<h2 id="virtualizing-collection">虚拟化收藏</h2>
<p><code>Grid</code>组件通常显示棋盘式的数据。因此，它需要一个包含所有x轴和y轴数据记录的完美网格。换句话说，我们的输入2D数组应该包含相同大小的内部数组，因为我们同时使用了<code>rowIndex</code>和<code>columnIndex</code>。</p>
<p>组件让你不用一个完美的2D阵列就能渲染出一个类似网格的结构。因此，您可以使用该组件通过1D对象数组来激活两个滚动条。此外，<code>Collection</code>允许您通过回调函数以编程方式定位元素，这与<code>Grid</code>不同。</p>
<p>请看下面的例子:</p>
<pre class="language-css hljs">import './App.css';

import { loremIpsum } from 'lorem-ipsum';
import { Collection, AutoSizer } from 'react-virtualized';

const cellCount = 5000;
const cellWidth = 400;
const cellHeight = 50;

const list = Array(cellCount).fill().map((val, idx) =&gt; ({
  id: idx,
  name: 'John Doe',
  image: 'http://via.placeholder.com/40',
  text: loremIpsum({
    count: 4,
    units: 'word'
  })
}));

function renderCell({ index, key, style }) {
  return (
    &lt;div key={key} style={style} className="row"&gt;
      &lt;div className="image"&gt;
        &lt;img src={list[index].image} alt="" /&gt;
      &lt;/div&gt;
      &lt;div className="content"&gt;
        &lt;div&gt;{list[index].name}&lt;/div&gt;
        &lt;div&gt;{list[index].text}&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}

function App() {
  function cellSizeAndPositionGetter({ index }) {
    return {
      height: cellHeight,
      width: cellWidth,
      y: index * cellHeight,
      x: Math.floor(Math.random() * 10) * cellWidth
    }
  }

  return (
    &lt;div className="App"&gt;
      &lt;div className="list"&gt;
        &lt;AutoSizer&gt;
          {
            ({width, height}) =&gt; (
            &lt;Collection
              width={width}
              height={height}
              cellRenderer={renderCell}
              cellCount={list.length}
              cellSizeAndPositionGetter={cellSizeAndPositionGetter}/&gt;
            )
          }
        &lt;/AutoSizer&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}

export default App;
</pre>
<p>在这里，我们使用了<code>cellSizeAndPositionGetter</code>函数来定义每个带有<code>index</code>和<code>Math.random</code>的单元格的位置。上面的代码呈现了一个带有任意位置数据元素的网格，如下面的预览所示:</p>
<p><img data-attachment-id="162374" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/grid-arbitrary-positioned-data-elements/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/grid-arbitrary-positioned-data-elements.gif" data-orig-size="730,329" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A grid with arbitrary-positioned data elements" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/grid-arbitrary-positioned-data-elements-300x135.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/grid-arbitrary-positioned-data-elements.gif" decoding="async" class="aligncenter size-full wp-image-162374 jetpack-lazy-image" src="../Images/aa0dc644c600e4a7e62d49e9f3411a04.png" alt="A Grid With Arbitary-Positioned Data Elements" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2018/05/grid-arbitrary-positioned-data-elements.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/grid-arbitrary-positioned-data-elements.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="162374" data-permalink="https://blog.logrocket.com/rendering-large-lists-react-virtualized/attachment/grid-arbitrary-positioned-data-elements/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/05/grid-arbitrary-positioned-data-elements.gif" data-orig-size="730,329" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A grid with arbitrary-positioned data elements" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/05/grid-arbitrary-positioned-data-elements-300x135.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/05/grid-arbitrary-positioned-data-elements.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-162374" src="../Images/aa0dc644c600e4a7e62d49e9f3411a04.png" alt="A Grid With Arbitary-Positioned Data Elements" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/05/grid-arbitrary-positioned-data-elements.gif"/></noscript>
<p>试着用这个组件创建一个简单的相册。您可以从这个演示应用程序中得到一个想法(并浏览源代码)。</p>
<h2 id="conclusion">结论</h2>
<p>本文向您展示了如何使用react-virtualized以高效的方式呈现大型列表、网格和数据集合。</p>
<p>当然，也有其他库是为了同样的目的而构建的，但是react-virtualized有很多功能，并且维护得很好。另外，还有一个<a href="https://gitter.im/bvaughn/react-virtualized"> Gitter chat </a>和一个<a href="https://stackoverflow.com/questions/tagged/react-virtualized"> StackOverflow tag </a>来询问社区问题。</p>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>