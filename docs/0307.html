<html>
<head>
<title>Introducing React 16.8, featuring official support for Hooks - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>介绍React 16.8，官方支持Hooks - LogRocket博客</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/introducing-react-16-8-featuring-official-support-for-hooks/#0001-01-01">https://blog.logrocket.com/introducing-react-16-8-featuring-official-support-for-hooks/#0001-01-01</a></blockquote><div><article class="article-post">
<p>React.js是最受欢迎的JavaScript库之一，它发布了16.8.0版本，其中包括对钩子的官方支持。</p>
<p><a href="https://github.com/facebook/react" target="_blank" rel="noopener noreferrer"> React现在有超过100个版本</a>，超过130，000个GitHub stars，200多万个项目，以及许多专门的社区成员，让开发人员构建令人惊叹的用户界面变得更加容易。</p>
<h2>挂钩的稳定支撑</h2>
<p>挂钩是让您从功能组件“挂钩”React状态和生命周期特性的功能。钩子让你不用写类就可以使用状态和其他React特性，因为它们在类内部不起作用。使用状态挂钩的一个简单示例如下:</p>
<pre>import React, { useState } from 'react';

function Example() {
  // Declare a new state variable, which we'll call "count"
  const [count, setCount] = useState(0);

  return (
    &lt;div&gt;
      &lt;p&gt;You clicked {count} times&lt;/p&gt;
      &lt;button onClick={() =&gt; setCount(count + 1)}&gt;
        Click me
      &lt;/button&gt;
    &lt;/div&gt;
  );
}</pre>
<p>在这篇文章中，钩子将不会被认真对待，相反，你将看到钩子背后的动机，解开钩子的神秘，以及它们的优点。</p>
<h2>为什么是钩子？</h2>
<p>React的核心团队暗示了人们在用React构建应用程序时，随着时间的推移容易面临的一些问题。它们中的大多数乍一看似乎没有联系，但都是有效的:</p>
<h3>重用有状态逻辑的困难</h3>
<p>默认情况下，以前没有明确的方法将可重用行为附加到React组件。当然，你有像使用渲染道具和高阶组件这样的模式来尝试和破解它，但是你最终会在任何使用它们的时候改变组件的结构。</p>
<p>这几乎总是导致笨拙的代码表示，并且通过继承，导致代码变得难以辨认。一个典型的React应用程序将包含组件的包装器，这些组件包含提供者、消费者、hoc和许多其他抽象的概念。</p>
<p>DevTools和林挺可以帮助分解大部分内容，但是React需要一种根级别的概念来共享有状态逻辑。钩子非常适合这里，您可以从组件中提取有状态逻辑，这样它就可以被独立测试和重用。你可以在这里了解更多关于<a href="https://reactjs.org/docs/hooks-custom.html" target="_blank" rel="noopener noreferrer">打造自己的钩子的信息。</a></p>
<h3>复杂的组件变得难以理解</h3>
<p>一个很好的例子是生命周期方法的使用:你知道逻辑如何从一个方法传递到另一个方法，或者只有计算可以在一个方法中完成，而在另一个方法中使用。</p>
<p>在使用这些方法的过程中，会引入许多不相关的逻辑，从像<code>console.log</code>消息这样的小事到像事件监听器这样的大事。这使得下一个开发代码的开发人员——甚至是最初的作者——更有可能在某个时候感到困惑。</p>
<p>想象一下，维护组件开始时很简单，但后来却变成了一堆难以管理的有状态逻辑、副作用，当然还有bug。在许多情况下，不可能将这些组件分解成更小的组件，因为有状态逻辑无处不在，使得单元测试变得困难。</p>
<p>Hooks也有助于解决这个问题，因为您可以根据组件之间的关联将一个组件分解成更小的功能。</p>
<h3>班级有时令人困惑</h3>
<p>还记得当你第一次开始使用React时，理解它的类是多么的不直观吗？许多刚刚起步的开发人员仍然没有完全掌握<code>this</code>在JavaScript中是如何工作的；不同的语言有所不同，这并没有什么好处。</p>
<p>其他很好的例子是React中函数和类组件的参数之间的差异以及何时使用这些参数，这进一步显示了类有时会有多么令人困惑。</p>
<p>更糟糕的是:即使是机器(即编译器)也发现类在大多数时候令人困惑。以小型打印机为例。React团队报告说，类不能很好地缩小，有时甚至使热重装变得脆弱和不可靠。Hooks作为一个解决方案提供了一个平台，让您可以使用React特性，但是这次没有类。</p>
<h2>React v16.8入门</h2>
<p>要开始，你必须用你最喜欢的注册表安装新版本16.8。要安装带纱线的React 16，运行:</p>
<pre>yarn add <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d5a7b0b4b6a195">[email protected]</a>^16.8.0 <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="91e3f4f0f2e5bcf5fefcd1">[email protected]</a>^16.8.0</pre>
<p>要使用npm安装React 16，请运行:</p>
<pre>npm install --save <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="80f2e5e1e3f4c0">[email protected]</a>^16.8.0 <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9ceef9fdffe8b1f8f3f1dc">[email protected]</a>^16.8.0</pre>
<p>React的UMD版本也可以通过CDN访问:</p>
<pre>&lt;script crossorigin src="https://unpkg.com/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="047661656770443532">[email protected]</a>/umd/react.production.min.js"&gt;&lt;/script&gt;
&lt;script crossorigin src="https://unpkg.com/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="acdec9cdcfd881c8c3c1ec9d9a">[email protected]</a>/umd/react-dom.production.min.js"&gt;&lt;/script&gt;</pre>
<p>关于详细的安装说明，请参考文件。</p>
<p>既然您已经受到了尝试React挂钩的启发，这里有一些资源可以帮助您开始尝试使用它们:</p>

<h3>需要注意的重要事项</h3>
<ul>
<li>钩子还没有覆盖类的所有用例，尽管React团队最终会朝着这个方向努力。还没有与<code>getSnapshotBeforeUpdate</code>和<code>componentDidCatch</code>生命周期方法等价的钩子。</li>
<li>像redux-connect和react-router这样的流行API将继续工作，但是对于像<code>useRedux()</code>或<code>useRouter()</code>这样不需要包装器组件的定制钩子已经有了计划。</li>
<li>静态类型与钩子一起工作，因为它们在设计时就考虑到了钩子。</li>
</ul>
<h3>林挺钩规则</h3>
<p>React现在有一个<a href="https://www.npmjs.com/package/eslint-plugin-react-hooks" target="_blank" rel="noopener noreferrer"> ESLint插件</a>，它强制执行挂钩的<a href="https://www.npmjs.com/package/eslint-plugin-react-hooks" target="_blank" rel="noopener noreferrer">规则以避免错误，并让你，开发者，遵循惯例。首先，该插件将任何以“use”开头的函数标记为一个钩子，后面跟着一个大写字母。这些规则是:</a></p>
<ul>
<li>不能从常规函数中调用挂钩；仅来自功能组件。</li>
<li>钩子只能在函数组件的顶层使用，不能在嵌套函数甚至条件语句块中使用。</li>
</ul>
<p>流行的create-react-app样板文件已经将这个插件集成到所有用它引导的react应用程序中。</p>
<h3>我能马上使用钩子吗？</h3>
<p>是啊！从16.8.0开始，React包括React DOM、React DOM服务器、React测试渲染器和React浅层渲染器的React挂钩的稳定实现。React Native将在<a href="https://github.com/react-native-community/react-native-releases/issues/79#issuecomment-457735214" target="_blank" rel="noopener noreferrer"> 0.59版本</a>中支持钩子。</p>
<h3>测试挂钩</h3>
<p>React团队在这个版本中添加了一个名为<code>ReactTestUtils.act()</code>的新API。它确保了测试中的行为与浏览器中的行为更加匹配。建议将任何代码呈现和触发组件更新打包到<code>act()</code>调用中。测试库也可以用它包装他们的API。</p>
<p>例如，本页中<a href="https://reactjs.org/docs/hooks-effect.html" target="_blank" rel="noopener noreferrer">的反例可以这样测试:</a></p>
<pre>import React from 'react';
import ReactDOM from 'react-dom';
import { act } from 'react-dom/test-utils';
import Counter from './Counter';
let container;
beforeEach(() =&gt; {
  container = document.createElement('div');
  document.body.appendChild(container);
});
afterEach(() =&gt; {
  document.body.removeChild(container);
  container = null;
});
it('can render and update a counter', () =&gt; {
  // Test first render and effect
  act(() =&gt; {
    ReactDOM.render(&lt;Counter /&gt;, container);
  });
  const button = container.querySelector('button');
  const label = container.querySelector('p');
  expect(label.textContent).toBe('You clicked 0 times');
  expect(document.title).toBe('You clicked 0 times');
  // Test second render and effect
  act(() =&gt; {
    button.dispatchEvent(new MouseEvent('click', {bubbles: true}));
  });
  expect(label.textContent).toBe('You clicked 1 times');
  expect(document.title).toBe('You clicked 1 times');
});</pre>
<p>对<code>act()</code>的调用也将刷新它们内部的效果。如果您需要测试一个定制的钩子，您可以通过在您的测试中创建一个组件并使用您的钩子来完成。</p>
<p>此外，为了减少样板代码，推荐使用<a href="https://git.io/react-testing-library" target="_blank" rel="noopener noreferrer"> <code>react-testing-library</code> </a>，这是为了鼓励编写像最终用户一样使用您的组件的测试。你可以在这里查看这个新版本的<a href="https://reactjs.org/blog/2019/02/06/react-v16.8.0.html#changelog" target="_blank" rel="noopener noreferrer">完整变更日志。</a></p>
<h2>结论</h2>
<p>现在已经向您介绍了React.js的新版本，它附带了对React挂钩的稳定支持。导致采用这种编写React代码的新方法的动机也已经被阐明。今天试试Hooks吧——祝你黑客生涯愉快！</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720"><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener"> LogRocket </a>:全面了解您的生产React应用</h2><p>调试React应用程序可能很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪Redux状态、自动显示JavaScript错误以及跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" vwo-el-id="19356441070">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<p vwo-el-id="28675660440" class="">LogRocket 结合了会话回放、产品分析和错误跟踪，使软件团队能够创建理想的web和移动产品体验。这对你来说意味着什么？</p>
<p>LogRocket不是猜测错误发生的原因，也不是要求用户提供截图和日志转储，而是让您回放问题，就像它们发生在您自己的浏览器中一样，以快速了解哪里出错了。</p>
<p>不再有嘈杂的警报。智能错误跟踪允许您对问题进行分类，然后从中学习。获得有影响的用户问题的通知，而不是误报。警报越少，有用的信号越多。</p>
<p vwo-el-id="28675660750">LogRocket Redux中间件包为您的用户会话增加了一层额外的可见性。LogRocket记录Redux存储中的所有操作和状态。</p>
<p vwo-el-id="28675661060">现代化您调试React应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">开始免费监控</a>。</p>
</div></div>
<hr/>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>