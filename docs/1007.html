<html>
<head>
<title>Receiving emails with Bref PHP and SendGrid - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用Bref PHP和SendGrid - LogRocket博客接收电子邮件</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/#0001-01-01">https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/#0001-01-01</a></blockquote><div><article class="article-post">
<p>Bref是一个composer包，使得在T2的AWS Lambda T3上运行无服务器的PHP应用程序变得容易。它通过提供运行PHP应用程序所需的<a href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html" target="_blank" rel="noopener noreferrer">层</a>来实现这一点，因为Lambda本身并不支持这些层。</p>
<p>在本教程中，我们将构建和部署一个无服务器的PHP应用程序，它使用<a href="https://sendgrid.com/docs/for-developers/parsing-email/inbound-email/" target="_blank" rel="noopener noreferrer"> SendGrid Inbound Parse </a>以编程方式处理传入的电子邮件。</p>
<h2>先决条件</h2>
<p>要跟进，您需要:</p>
<ul>
<li>PHP &gt;= 7.2(使用最新版本的Bref)</li>
<li><a href="https://get-composer.org" target="_blank" rel="noopener noreferrer">作曲</a>，<a href="https://www.npmjs.com/" target="_blank" rel="noopener noreferrer"> npm </a>，安装<a href="https://www.serverless.com/framework/docs/getting-started/" target="_blank" rel="noopener noreferrer">无服务器CLI </a></li>
<li><a href="https://sendgrid.com/docs/for-developers/parsing-email/setting-up-the-inbound-parse-webhook/" target="_blank" rel="noopener noreferrer">为您的域/子域配置的SendGrid入站解析</a>(以便SendGrid可以处理该域的所有传入电子邮件)</li>
<li>安装了Ngrok (在本地开发时公开您的Bref应用程序)</li>
</ul>
<h2>安装Bref和应用程序依赖项</h2>
<p>首先，为您的应用程序创建一个文件夹(我将我的命名为<code>bref-email-watch</code>)，并使用下面的命令进入目录:</p>
<pre>$ mkdir bref-email-watch &amp;&amp; cd bref-email-watch</pre>
<p>安装包含bref CLI、<code>phpdotenv</code>的应用程序依赖项，使我们能够从<code>.env</code>文件加载环境变量，以及<code>nexylan/slack</code>与Slack的API交互:</p>
<pre>$ composer require bref/bref vlucas/phpdotenv nexylan/slack php-http/discovery</pre>
<p>安装完依赖项后，通过在项目目录中运行<code>./vendor/bin/bref</code>来初始化Bref，并从交互菜单中选择HTTP选项。</p>
<figure id="attachment_21860" aria-describedby="caption-attachment-21860" class="wp-caption aligncenter"><img data-attachment-id="21860" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/outputofbrefinputcommand/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/outputofbrefinputcommand.png" data-orig-size="934,534" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="outputofbrefinputcommand" data-image-description="" data-image-caption="&lt;p&gt;Output of “bref init” command&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/outputofbrefinputcommand-300x172.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/outputofbrefinputcommand.png" decoding="async" class="size-full wp-image-21860 jetpack-lazy-image" src="../Images/28253e72dbc7e65231e8bc070505723e.png" alt="Output of “bref init” command" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/outputofbrefinputcommand.png 934w, https://blog.logrocket.com/wp-content/uploads/2020/07/outputofbrefinputcommand-300x172.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/07/outputofbrefinputcommand-768x439.png 768w" data-lazy-sizes="(max-width: 934px) 100vw, 934px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/outputofbrefinputcommand.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/outputofbrefinputcommand.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="21860" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/outputofbrefinputcommand/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/outputofbrefinputcommand.png" data-orig-size="934,534" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="outputofbrefinputcommand" data-image-description="" data-image-caption="&lt;p&gt;Output of “bref init” command&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/outputofbrefinputcommand-300x172.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/outputofbrefinputcommand.png" decoding="async" loading="lazy" class="size-full wp-image-21860" src="../Images/28253e72dbc7e65231e8bc070505723e.png" alt="Output of “bref init” command" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/outputofbrefinputcommand.png 934w, https://blog.logrocket.com/wp-content/uploads/2020/07/outputofbrefinputcommand-300x172.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/07/outputofbrefinputcommand-768x439.png 768w" sizes="(max-width: 934px) 100vw, 934px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/outputofbrefinputcommand.png"/></noscript><figcaption id="caption-attachment-21860" class="wp-caption-text">Output of “bref init” command</figcaption></figure>
<p>该命令将创建一个<code>serverless.yml</code>文件，作为无服务器框架如何部署您的应用程序的清单，以及一个<code>index.php</code>文件，作为应用程序的入口点。</p>
<p>接下来，在项目文件夹中创建一个<code>.env</code>文件，并添加Slack hook URL:</p>
<pre>SLACK_HOOK_URL="HERE_LIVES_YOUR_SLACK_HOOK_URL"</pre>
<h2>解析来自SendGrid的传入电子邮件</h2>
<p>该应用程序的工作方式是，每次在配置的域上有新邮件时，从SendGrid接收JSON有效负载(以HTTP <code>post</code>请求的形式)。我们将修改生成的index.php文件来解析这些有效负载，提取发送方和接收方(使用regex和PHP的<code>preg_match()</code>)，并向包含提取数据的相关通道发送Slack消息。</p>
<p>打开<code>index.php</code>文件，用下面的代码块替换其内容:</p>
<pre>try {
    if (strtoupper($_SERVER['REQUEST_METHOD'] != 'POST')) {
        throw new Exception("Received non-post request on webhook handler");
    }

    if (json_last_error() != JSON_ERROR_NONE) {
        $em = "Error while parsing payload: ".json_last_error_msg();
        throw new Exception($em);
    }

    $from = $_POST['from'];
    $to = $_POST['to'];

    preg_match("#&lt;(.*?)&gt;#", $from, $sender);
    preg_match("#&lt;(.*?)&gt;#", $to, $recipient);
    $senderAddr = $sender[1];
    $recipientAddr = $recipient[1];

    $message = "*You've got mail!*\n";
    $message .= "*To:* ".$recipientAddr."\n";
    $message .= "*From:* ".$senderAddr;

    notifyOnSlack($message, true);

    // send OK back to SendGrid so they stop bothering our webhook
    header("Content-type: application/json; charset=utf-8");
    echo json_encode(["message" =&gt; "OK"]);
    exit(0);
} catch (Exception $e) {
    notifyOnSlack($e-&gt;getMessage());
    header("Content-type: application/json; charset=utf-8");
    http_response_code(400);
    echo json_encode(["message" =&gt; $e-&gt;getMessage()]);
    exit(0);
}</pre>
<h2>发送新电子邮件的延迟通知</h2>
<p>在前面的代码块中，我们引用了一个还不存在的<code>notifyOnSlack</code>函数。这个函数负责将收到的<code>$message</code>参数发送给Slack。要实现它，通过将以下代码添加到<code>index.php</code>文件的顶部(就在try块之前)，将在<code>.env</code>文件中声明的变量加载到您的应用程序中:</p>
<pre>require_once './vendor/autoload.php';
$dotenv = Dotenv\Dotenv::createImmutable(__DIR__);
$dotenv-&gt;load();</pre>
<p>接下来，连接函数实现，如下所示:</p>
<pre>function notifyOnSlack($message, $markdown = false)
{
    $slackHookUrl = $_ENV["SLACK_HOOK_URL"];
    $options = [
        "channel" =&gt; "#general",
        "allow_markdown" =&gt; $markdown,
        "username" =&gt; "bref-email-watch",
    ];
    $client = new Nexy\Slack\Client(
        \Http\Discovery\Psr18ClientDiscovery::find(),
        \Http\Discovery\Psr17FactoryDiscovery::findRequestFactory(),
        \Http\Discovery\Psr17FactoryDiscovery::findStreamFactory(),
        $slackHookUrl,
        $options
    );
    $client-&gt;send($message);
}</pre>
<p>该函数从。env文件，然后设置选项，包括消息要发送到的通道，然后传递给Slack客户机。我们还通过传入HTTPlug发现服务来实例化客户端，这允许它找到并使用任何符合PSR标准的HTTP客户端。</p>
<h2>本地测试无服务器功能</h2>
<p>现在我们的应用程序已经设置好了，在端口3000上启动内置的PHP服务器，并在同一个端口上打开一个<code>ngrok</code>隧道:</p>
<pre>$ php -S localhost:3000
$ ngrok http 3000</pre>
<p><code>ngrok</code>命令生成<em>转发URL，</em>如下<em> : </em></p>
<p><img data-attachment-id="21868" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/ngrok-command-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/ngrok-command-output.png" data-orig-size="934,534" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="ngrok command output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/ngrok-command-output-300x172.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/ngrok-command-output.png" decoding="async" class="aligncenter size-full wp-image-21868 jetpack-lazy-image" src="../Images/72480fc163ee64d03bd30670ad934fa2.png" alt="ngrok command output" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/ngrok-command-output.png 934w, https://blog.logrocket.com/wp-content/uploads/2020/07/ngrok-command-output-300x172.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/07/ngrok-command-output-768x439.png 768w" data-lazy-sizes="(max-width: 934px) 100vw, 934px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/ngrok-command-output.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/ngrok-command-output.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="21868" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/ngrok-command-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/ngrok-command-output.png" data-orig-size="934,534" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="ngrok command output" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/ngrok-command-output-300x172.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/ngrok-command-output.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-21868" src="../Images/72480fc163ee64d03bd30670ad934fa2.png" alt="ngrok command output" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/ngrok-command-output.png 934w, https://blog.logrocket.com/wp-content/uploads/2020/07/ngrok-command-output-300x172.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/07/ngrok-command-output-768x439.png 768w" sizes="(max-width: 934px) 100vw, 934px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/ngrok-command-output.png"/></noscript>
<p>复制URL并访问您的<a href="https://app.sendgrid.com/settings/parse" target="_blank" rel="noopener noreferrer"> SendGrid的入站解析设置页面</a>。现在，点击<em>添加主机&amp; URL </em>按钮，将复制的URL粘贴到<em>目的地URL </em>字段中。</p>
<p><img data-attachment-id="21870" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/inboundparsewebhooksettings/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/Inboundparsewebhooksettings.png" data-orig-size="720,694" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Inboundparsewebhooksettings" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/Inboundparsewebhooksettings-300x289.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/Inboundparsewebhooksettings.png" decoding="async" class="aligncenter size-full wp-image-21870 jetpack-lazy-image" src="../Images/8ebdd56b71b19b1c6ee88c81dac9f9b5.png" alt="Inbound Parse webhook settings" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/Inboundparsewebhooksettings.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/Inboundparsewebhooksettings-300x289.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/Inboundparsewebhooksettings.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/Inboundparsewebhooksettings.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="21870" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/inboundparsewebhooksettings/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/Inboundparsewebhooksettings.png" data-orig-size="720,694" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Inboundparsewebhooksettings" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/Inboundparsewebhooksettings-300x289.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/Inboundparsewebhooksettings.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-21870" src="../Images/8ebdd56b71b19b1c6ee88c81dac9f9b5.png" alt="Inbound Parse webhook settings" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/Inboundparsewebhooksettings.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/Inboundparsewebhooksettings-300x289.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/Inboundparsewebhooksettings.png"/></noscript>
<p>你可能希望<a href="https://sendgrid.com/docs/ui/account-and-settings/how-to-set-up-domain-authentication/#setting-up-domain-authentication" target="_blank" rel="noopener noreferrer">建立一个合适的子域</a>，因为SendGrid会通知你的webhook每封到达该域名的<em>电子邮件(不考虑用户名)。</em></p>
<p>接下来，向您指定的域中的电子邮件地址发送一封电子邮件，通知应该显示在Slack上，如下所示:</p>
<figure id="attachment_21872" aria-describedby="caption-attachment-21872" class="wp-caption aligncenter"><img data-attachment-id="21872" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/sampleslacknotification/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/sampleslacknotification.png" data-orig-size="1102,223" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sampleslacknotification" data-image-description="" data-image-caption="&lt;p&gt;sample slack notification&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/sampleslacknotification-300x61.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/sampleslacknotification-1024x207.png" decoding="async" class="size-full wp-image-21872 jetpack-lazy-image" src="../Images/24d3329f102dafb50627ea96efc9a7c0.png" alt="sample slack notification" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/sampleslacknotification.png 1102w, https://blog.logrocket.com/wp-content/uploads/2020/07/sampleslacknotification-300x61.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/07/sampleslacknotification-1024x207.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/07/sampleslacknotification-768x155.png 768w" data-lazy-sizes="(max-width: 1102px) 100vw, 1102px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/sampleslacknotification.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/sampleslacknotification.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="21872" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/sampleslacknotification/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/sampleslacknotification.png" data-orig-size="1102,223" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="sampleslacknotification" data-image-description="" data-image-caption="&lt;p&gt;sample slack notification&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/sampleslacknotification-300x61.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/sampleslacknotification-1024x207.png" decoding="async" loading="lazy" class="size-full wp-image-21872" src="../Images/24d3329f102dafb50627ea96efc9a7c0.png" alt="sample slack notification" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/sampleslacknotification.png 1102w, https://blog.logrocket.com/wp-content/uploads/2020/07/sampleslacknotification-300x61.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/07/sampleslacknotification-1024x207.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/07/sampleslacknotification-768x155.png 768w" sizes="(max-width: 1102px) 100vw, 1102px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/sampleslacknotification.png"/></noscript><figcaption id="caption-attachment-21872" class="wp-caption-text">sample slack notification</figcaption></figure>
<h2>配置AWS凭据</h2>
<h3>设置IAM角色</h3>
<p>为了成功部署我们的应用程序，Bref和无服务器CLI需要访问以下AWS资源:</p>
<ul>
<li>希腊字母的第11个</li>
<li>InternationalAssociationofMachinists国际机械师协会</li>
<li>APIGateway</li>
<li>S3</li>
<li>云的形成</li>
<li>CloudWatch日志</li>
</ul>
<p>如果您有一个具有这些权限的IAM用户，您可以继续使用他们的AWS访问密钥和密码，否则:</p>

<p><img data-attachment-id="21875" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/aimuserhomepage/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aimuserhomepage.jpg" data-orig-size="730,371" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="aimuserhomepage" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aimuserhomepage-300x152.jpg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aimuserhomepage.jpg" decoding="async" class="aligncenter size-full wp-image-21875 jetpack-lazy-image" src="../Images/e2ba44a1b23d93528066fbc15e93924b.png" alt="Screenshot of IAM users’ home page" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/aimuserhomepage.jpg 730w, https://blog.logrocket.com/wp-content/uploads/2020/07/aimuserhomepage-300x152.jpg 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/aimuserhomepage.jpg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/aimuserhomepage.jpg"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="21875" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/aimuserhomepage/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aimuserhomepage.jpg" data-orig-size="730,371" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="aimuserhomepage" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aimuserhomepage-300x152.jpg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/aimuserhomepage.jpg" decoding="async" loading="lazy" class="aligncenter size-full wp-image-21875" src="../Images/e2ba44a1b23d93528066fbc15e93924b.png" alt="Screenshot of IAM users’ home page" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/aimuserhomepage.jpg 730w, https://blog.logrocket.com/wp-content/uploads/2020/07/aimuserhomepage-300x152.jpg 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/aimuserhomepage.jpg"/></noscript>
<ul>
<li>在新用户页面上，指定一个用户名以帮助您记住用户的用途，例如bref-sendgrid-inbound，然后<em>启用编程访问</em>并点击<em>下一步</em>进入权限页面:</li>
</ul>
<p><img data-attachment-id="21877" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/screenshotofaddinganewiamuser/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/ScreenshotofaddinganewIAMuser.png" data-orig-size="1366,694" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="ScreenshotofaddinganewIAMuser" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/ScreenshotofaddinganewIAMuser-300x152.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/ScreenshotofaddinganewIAMuser-1024x520.png" decoding="async" class="aligncenter size-full wp-image-21877 jetpack-lazy-image" src="../Images/90041ebb5f34e0d01518dbd516f9760d.png" alt="Screenshot of adding a new IAM user" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/ScreenshotofaddinganewIAMuser.png 1366w, https://blog.logrocket.com/wp-content/uploads/2020/07/ScreenshotofaddinganewIAMuser-300x152.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/07/ScreenshotofaddinganewIAMuser-1024x520.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/07/ScreenshotofaddinganewIAMuser-768x390.png 768w" data-lazy-sizes="(max-width: 1366px) 100vw, 1366px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/ScreenshotofaddinganewIAMuser.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/ScreenshotofaddinganewIAMuser.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="21877" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/screenshotofaddinganewiamuser/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/ScreenshotofaddinganewIAMuser.png" data-orig-size="1366,694" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="ScreenshotofaddinganewIAMuser" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/ScreenshotofaddinganewIAMuser-300x152.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/ScreenshotofaddinganewIAMuser-1024x520.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-21877" src="../Images/90041ebb5f34e0d01518dbd516f9760d.png" alt="Screenshot of adding a new IAM user" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/ScreenshotofaddinganewIAMuser.png 1366w, https://blog.logrocket.com/wp-content/uploads/2020/07/ScreenshotofaddinganewIAMuser-300x152.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/07/ScreenshotofaddinganewIAMuser-1024x520.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/07/ScreenshotofaddinganewIAMuser-768x390.png 768w" sizes="(max-width: 1366px) 100vw, 1366px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/ScreenshotofaddinganewIAMuser.png"/></noscript>
<p>选择<em>直接附加现有策略</em>选项卡，点击<em>创建策略</em>按钮。这将打开一个新的浏览器选项卡，让您设置新的权限策略。</p>
<p><img data-attachment-id="21879" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/attachinganexistingpolicytotheiamuser/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/AttachinganexistingpolicytotheIAMuser.jpg" data-orig-size="730,371" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="AttachinganexistingpolicytotheIAMuser" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/AttachinganexistingpolicytotheIAMuser-300x152.jpg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/AttachinganexistingpolicytotheIAMuser.jpg" decoding="async" class="aligncenter size-full wp-image-21879 jetpack-lazy-image" src="../Images/0119cad2da916ab47c5c6f179a0579d4.png" alt="Attaching an existing policy to the IAM user" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/AttachinganexistingpolicytotheIAMuser.jpg 730w, https://blog.logrocket.com/wp-content/uploads/2020/07/AttachinganexistingpolicytotheIAMuser-300x152.jpg 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/AttachinganexistingpolicytotheIAMuser.jpg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/AttachinganexistingpolicytotheIAMuser.jpg"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="21879" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/attachinganexistingpolicytotheiamuser/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/AttachinganexistingpolicytotheIAMuser.jpg" data-orig-size="730,371" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="AttachinganexistingpolicytotheIAMuser" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/AttachinganexistingpolicytotheIAMuser-300x152.jpg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/AttachinganexistingpolicytotheIAMuser.jpg" decoding="async" loading="lazy" class="aligncenter size-full wp-image-21879" src="../Images/0119cad2da916ab47c5c6f179a0579d4.png" alt="Attaching an existing policy to the IAM user" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/AttachinganexistingpolicytotheIAMuser.jpg 730w, https://blog.logrocket.com/wp-content/uploads/2020/07/AttachinganexistingpolicytotheIAMuser-300x152.jpg 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/AttachinganexistingpolicytotheIAMuser.jpg"/></noscript>
<p>在<em>创建策略</em>页面上选择<em> JSON </em>选项卡，并粘贴下面的代码块:</p>
<pre>{
        "Version": "2012-10-17",
        "Statement": [
            {
                "Sid": "VisualEditor0",
                "Effect": "Allow",
                "Action": [
                    "iam:*",
                    "s3:*",
                    "apigateway:*",
                    "lambda:*",
                    "cloudformation:*",
                    "logs:*"
                ],
                "Resource": "*"
            }
        ]
}</pre>
<p>为策略指定一个描述性名称，检查它，并完成策略创建过程。</p>
<p><img data-attachment-id="21881" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/jsonpolicydocument/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/jsonpolicydocument.png" data-orig-size="1366,694" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="jsonpolicydocument" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/jsonpolicydocument-300x152.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/jsonpolicydocument-1024x520.png" decoding="async" class="aligncenter size-full wp-image-21881 jetpack-lazy-image" src="../Images/9dffe75cff7a56b76c53738fdbc56f46.png" alt="Creating a new policy from a JSON policy document" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/jsonpolicydocument.png 1366w, https://blog.logrocket.com/wp-content/uploads/2020/07/jsonpolicydocument-300x152.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/07/jsonpolicydocument-1024x520.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/07/jsonpolicydocument-768x390.png 768w" data-lazy-sizes="(max-width: 1366px) 100vw, 1366px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/jsonpolicydocument.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/jsonpolicydocument.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="21881" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/jsonpolicydocument/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/jsonpolicydocument.png" data-orig-size="1366,694" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="jsonpolicydocument" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/jsonpolicydocument-300x152.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/jsonpolicydocument-1024x520.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-21881" src="../Images/9dffe75cff7a56b76c53738fdbc56f46.png" alt="Creating a new policy from a JSON policy document" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/jsonpolicydocument.png 1366w, https://blog.logrocket.com/wp-content/uploads/2020/07/jsonpolicydocument-300x152.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/07/jsonpolicydocument-1024x520.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/07/jsonpolicydocument-768x390.png 768w" sizes="(max-width: 1366px) 100vw, 1366px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/jsonpolicydocument.png"/></noscript>
<ul>
<li>返回到<em>添加用户</em>页面，通过从列表中选择它来附加新策略。请注意，您可能需要刷新列表才能使您的更改生效。</li>
</ul>
<p><img data-attachment-id="21882" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/attachinganewpolicy/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/attachinganewpolicy.png" data-orig-size="1366,694" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="attachinganewpolicy" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/attachinganewpolicy-300x152.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/attachinganewpolicy-1024x520.png" decoding="async" class="aligncenter size-full wp-image-21882 jetpack-lazy-image" src="../Images/33ce8926628215af76757c44d4c43fb6.png" alt="Attaching the newly created policy to an IAM user" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/attachinganewpolicy.png 1366w, https://blog.logrocket.com/wp-content/uploads/2020/07/attachinganewpolicy-300x152.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/07/attachinganewpolicy-1024x520.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/07/attachinganewpolicy-768x390.png 768w" data-lazy-sizes="(max-width: 1366px) 100vw, 1366px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/attachinganewpolicy.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/attachinganewpolicy.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="21882" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/attachinganewpolicy/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/attachinganewpolicy.png" data-orig-size="1366,694" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="attachinganewpolicy" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/attachinganewpolicy-300x152.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/attachinganewpolicy-1024x520.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-21882" src="../Images/33ce8926628215af76757c44d4c43fb6.png" alt="Attaching the newly created policy to an IAM user" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/attachinganewpolicy.png 1366w, https://blog.logrocket.com/wp-content/uploads/2020/07/attachinganewpolicy-300x152.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/07/attachinganewpolicy-1024x520.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/07/attachinganewpolicy-768x390.png 768w" sizes="(max-width: 1366px) 100vw, 1366px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/attachinganewpolicy.png"/></noscript>
<p>点击页面底部的<em>下一个</em>按钮，完成IAM用户的创建。查看用户的访问密钥ID以及密钥，并将其复制到临时位置。</p>
<p><img data-attachment-id="21884" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/credentialspageofthenewiamuser/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/CredentialspageofthenewIAMuser.jpg" data-orig-size="730,371" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="CredentialspageofthenewIAMuser" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/CredentialspageofthenewIAMuser-300x152.jpg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/CredentialspageofthenewIAMuser.jpg" decoding="async" class="aligncenter size-full wp-image-21884 jetpack-lazy-image" src="../Images/c6ad3176e504c85143c037687a20aef0.png" alt="Credentials page of the new IAM user" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/CredentialspageofthenewIAMuser.jpg 730w, https://blog.logrocket.com/wp-content/uploads/2020/07/CredentialspageofthenewIAMuser-300x152.jpg 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/CredentialspageofthenewIAMuser.jpg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/CredentialspageofthenewIAMuser.jpg"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="21884" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/credentialspageofthenewiamuser/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/CredentialspageofthenewIAMuser.jpg" data-orig-size="730,371" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="CredentialspageofthenewIAMuser" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/CredentialspageofthenewIAMuser-300x152.jpg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/CredentialspageofthenewIAMuser.jpg" decoding="async" loading="lazy" class="aligncenter size-full wp-image-21884" src="../Images/c6ad3176e504c85143c037687a20aef0.png" alt="Credentials page of the new IAM user" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/CredentialspageofthenewIAMuser.jpg 730w, https://blog.logrocket.com/wp-content/uploads/2020/07/CredentialspageofthenewIAMuser-300x152.jpg 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/CredentialspageofthenewIAMuser.jpg"/></noscript>
<h2>使用AWS凭据</h2>
<p>回到您的终端，使用<code>serverless config</code>命令设置复制的凭证:</p>
<pre>$ serverless config credentials --provider aws --key  AWS_ACCESS_KEY_ID  --secret AWS_SECRET --profile bref-sendgrid-inbound</pre>
<p>以上命令将在保存您的AWS凭证的文件中添加一个新条目。记得更新您的<code>serverless.yml</code>文件中的<code>provider</code>部分，以匹配上面指定的配置文件以及您的IAM用户的区域。下面是修改后的<code>serverless.yml</code>配置的例子:</p>
<pre>service: app

provider:
    name: aws
    region: us-west-2
    runtime: provided
    # "profile" should match the profile specified while configuring the serverless CLI
    profile: bref-sendgrid-inbound

plugins:
    - ./vendor/bref/bref

functions:
    api:
        handler: index.php
        description: ''
        timeout: 28 # in seconds (API Gateway has a timeout of 29 seconds)
        layers:
            - ${bref:layer.php-73-fpm}
        events:
            -   http: 'ANY /'
            -   http: 'ANY /{proxy+}'

# Exclude files from deployment
package:
    exclude:
        - 'node_modules/**'
        - 'tests/**'</pre>
<p>部署到Lambda</p>
<h2>我们现在可以通过从项目目录运行下面的命令来部署我们的应用程序。</h2>
<p>该命令在完成部署后会生成一个应用程序URL，例如<code><a href="https://XXXXXXX.execute-api.us-west-2.amazonaws.com/dev" rel="nofollow">https://XXXXXXX.execute-api.us-west-2.amazonaws.com/dev</a></code>。然后，您可以在您的<em>入站解析</em>设置页面上更新<em>目的地URL </em>，以匹配这个生成的URL。</p>
<pre>$ serverless deploy</pre>
<p><img data-attachment-id="21889" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/inboundparsewebhooksettingsusingthelambdafunctionurl/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/InboundparsewebhooksettingsusingtheLambdafunctionURL.png" data-orig-size="720,694" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="InboundparsewebhooksettingsusingtheLambdafunctionURL" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/InboundparsewebhooksettingsusingtheLambdafunctionURL-300x289.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/InboundparsewebhooksettingsusingtheLambdafunctionURL.png" decoding="async" class="aligncenter size-full wp-image-21889 jetpack-lazy-image" src="../Images/980e8b4088d56d8e7b4039dfbc822cbf.png" alt="Inbound Parse webhook settings using the Lambda function URL" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/InboundparsewebhooksettingsusingtheLambdafunctionURL.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/InboundparsewebhooksettingsusingtheLambdafunctionURL-300x289.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/InboundparsewebhooksettingsusingtheLambdafunctionURL.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/InboundparsewebhooksettingsusingtheLambdafunctionURL.png"/></p>
<p>通过向<code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1b6e687e69757a767e5b42544e49">[email protected]</a>_DOMAIN.COM</code>发送一封电子邮件来再次测试应用程序，您应该会得到一个类似于下面的Slack消息:</p><noscript><img data-lazy-fallback="1" data-attachment-id="21889" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/inboundparsewebhooksettingsusingthelambdafunctionurl/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/InboundparsewebhooksettingsusingtheLambdafunctionURL.png" data-orig-size="720,694" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="InboundparsewebhooksettingsusingtheLambdafunctionURL" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/InboundparsewebhooksettingsusingtheLambdafunctionURL-300x289.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/InboundparsewebhooksettingsusingtheLambdafunctionURL.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-21889" src="../Images/980e8b4088d56d8e7b4039dfbc822cbf.png" alt="Inbound Parse webhook settings using the Lambda function URL" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/InboundparsewebhooksettingsusingtheLambdafunctionURL.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/InboundparsewebhooksettingsusingtheLambdafunctionURL-300x289.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/InboundparsewebhooksettingsusingtheLambdafunctionURL.png"/></noscript>
<p><img data-attachment-id="21891" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/sample-slack-message/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/Sample-Slack-Message.png" data-orig-size="1102,223" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Sample Slack Message" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/Sample-Slack-Message-300x61.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/Sample-Slack-Message-1024x207.png" decoding="async" class="aligncenter size-full wp-image-21891 jetpack-lazy-image" src="../Images/cb3936a45c30503f1af57b5827c6a000.png" alt="Sample Slack Message" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/Sample-Slack-Message.png 1102w, https://blog.logrocket.com/wp-content/uploads/2020/07/Sample-Slack-Message-300x61.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/07/Sample-Slack-Message-1024x207.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/07/Sample-Slack-Message-768x155.png 768w" data-lazy-sizes="(max-width: 1102px) 100vw, 1102px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/Sample-Slack-Message.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/Sample-Slack-Message.png"/></p>
<p>结论</p><noscript><img data-lazy-fallback="1" data-attachment-id="21891" data-permalink="https://blog.logrocket.com/receiving-emails-with-bref-php-and-sendgrid/sample-slack-message/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/Sample-Slack-Message.png" data-orig-size="1102,223" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Sample Slack Message" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/Sample-Slack-Message-300x61.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/Sample-Slack-Message-1024x207.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-21891" src="../Images/cb3936a45c30503f1af57b5827c6a000.png" alt="Sample Slack Message" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/Sample-Slack-Message.png 1102w, https://blog.logrocket.com/wp-content/uploads/2020/07/Sample-Slack-Message-300x61.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/07/Sample-Slack-Message-1024x207.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/07/Sample-Slack-Message-768x155.png 768w" sizes="(max-width: 1102px) 100vw, 1102px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/Sample-Slack-Message.png"/></noscript>
<h2>处理电子邮件可能很有趣，虽然重点通常是发送它们，但通过代码接收它们也同样有趣。在本教程中，我们确切地看到了如何做到这一点，并探索了Bref无服务器库。你可以在GitHub 上找到完整的项目。</h2>
<p>如果你想进一步探索，Bref和T2的无服务器框架文档是很好的地方。此外，您可以通过使用像<a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-use-lambda-authorizer.html" target="_blank" rel="noopener noreferrer"> lambda授权器</a>这样的特性来进一步学习限制对Lambda函数的访问。</p>
<p>使用<a class="signup" href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>消除传统错误报告的干扰</p><div class="code-block code-block-2">
<div class="blog-plug base-cta"><h2><a href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一个数字体验分析解决方案，它可以保护您免受数百个假阳性错误警报的影响，只针对几个真正重要的项目。LogRocket会告诉您应用程序中实际影响用户的最具影响力的bug和UX问题。</h2>
<a href="https://lp.logrocket.com/blg/signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p>然后，使用具有深层技术遥测的会话重放来确切地查看用户看到了什么以及是什么导致了问题，就像你在他们身后看一样。</p>
<p>LogRocket自动聚合客户端错误、JS异常、前端性能指标和用户交互。然后LogRocket使用机器学习来告诉你哪些问题正在影响大多数用户，并提供你需要修复它的上下文。</p>
<p>关注重要的bug—<a class="signup" href="https://lp.logrocket.com/blg/signup-issue-free" target="_blank" rel="noopener noreferrer">今天就试试LogRocket】。</a></p>
<p>Focus on the bugs that matter — <a class="signup" href="https://lp.logrocket.com/blg/signup-issue-free" target="_blank" rel="noopener noreferrer">try LogRocket today</a>.</p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>