<html>
<head>
<title>Building a Product Hunt clone app using Hasura and Next.js - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用Hasura和Next.js - LogRocket博客构建产品搜索克隆应用程序</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/#0001-01-01">https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/#0001-01-01</a></blockquote><div><article class="article-post">
<p>本教程将演示如何使用<a href="https://hasura.io/" target="_blank" rel="noopener noreferrer"> Hasura </a>和<a href="https://nextjs.org/" target="_blank" rel="noopener noreferrer"> Next.js </a>创建产品策展应用<a href="https://www.producthunt.com/" target="_blank" rel="noopener noreferrer"> Product Hunt </a>的克隆。我们将向您展示如何使用Hasura进行身份验证和授权，以及如何利用GraphQL从Next.js前端应用程序中读取和写入数据。</p>
<p>我们将在三个应用程序的上下文中讨论这些任务:</p>
<ol>
<li>使用Next.js的前端</li>
<li>使用Hasura的后端(使用Postgres数据库)</li>
<li>使用Node.js进行身份验证</li>
</ol>
<p>整个项目可以在<a href="https://github.com/ghoshnirmalya/product-hunt-clone-using-nextjs-and-hasura" target="_blank" rel="noopener noreferrer"> GitHub </a>上找到。</p>
<h2 id="introduction">Next.js和Hasura是什么？</h2>
<p>我使用<a href="https://blog.logrocket.com/whats-new-in-next-js-9-2/" target="_blank" rel="noopener noreferrer"> Next.js </a>已经一年多了，对整体开发者体验很满意，因为它支持许多令人兴奋的特性，比如开箱即用的<a href="https://nextjs.org/features/server-side-rendering" target="_blank" rel="noopener noreferrer">服务器端渲染</a>。</p>
<p>Hasura是一个引擎，它自动生成GraphQL APIs，以及用于创建、更新和删除Postgres数据库中的表和列的迁移文件。</p>
<h2 id="gettingstartedwithhasura">Hasura入门</h2>
<p>让我们从引导后端应用程序开始。</p>
<p>首先，我们需要安装<a href="https://docs.hasura.io/1.0/graphql/manual/hasura-cli/index.html#installation" target="_blank" rel="noopener noreferrer"> Hasura CLI </a>。安装完成后，我们可以初始化存储Hasura GraphQL迁移的目录。</p>
<pre>hasura init --directory backend --endpoint http://localhost:8080 --admin-secret secret
</pre>
<p>关于旗帜<code>--directory</code>、<code>--endpoint</code>和<code>--admin-secret</code>的更多细节，参见官方<a href="https://docs.hasura.io/1.0/graphql/manual/hasura-cli/hasura_init.html#options" target="_blank" rel="noopener noreferrer">哈苏拉文档</a>。</p>
<p><img data-attachment-id="14237" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/initializing-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-hasura.png" data-orig-size="730,223" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Initializing a Hasura application using Hasura CLI" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-hasura-300x92.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-hasura.png" decoding="async" class="aligncenter size-full wp-image-14237 jetpack-lazy-image" src="../Images/9ebc27c8ef978adf864ec71c15eb2da9.png" alt="Initializing a Hasura Application Using Hasura CLI" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-hasura-300x92.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-hasura.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-hasura.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14237" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/initializing-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-hasura.png" data-orig-size="730,223" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Initializing a Hasura application using Hasura CLI" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-hasura-300x92.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-hasura.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14237" src="../Images/9ebc27c8ef978adf864ec71c15eb2da9.png" alt="Initializing a Hasura Application Using Hasura CLI" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-hasura-300x92.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-hasura.png"/></noscript>
<p>上述命令将创建一个后端目录。</p>
<p><img data-attachment-id="14235" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/initializing-backend-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-backend-app.png" data-orig-size="730,288" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Initializing the backend application" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-backend-app-300x118.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-backend-app.png" decoding="async" class="aligncenter size-full wp-image-14235 jetpack-lazy-image" src="../Images/c2a732f08526a3f0d1dfd55a4ec977ec.png" alt="Initializing the Backend Application" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-backend-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-backend-app-300x118.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-backend-app.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-backend-app.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14235" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/initializing-backend-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-backend-app.png" data-orig-size="730,288" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Initializing the backend application" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-backend-app-300x118.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-backend-app.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14235" src="../Images/c2a732f08526a3f0d1dfd55a4ec977ec.png" alt="Initializing the Backend Application" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-backend-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-backend-app-300x118.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-backend-app.png"/></noscript>
<p><code>config.yam</code>文件将包含以下内容。</p>
<pre>// backend/config.yaml

admin_secret: secret
endpoint: http://localhost:8080
</pre>
<p>我们将使用<a href="https://blog.logrocket.com/docker-for-front-end-developers/" target="_blank" rel="noopener noreferrer"> Docker </a>来安装Hasura。根据<a href="https://docs.docker.com/install/" target="_blank" rel="noopener noreferrer">官方文件</a>，它支持Mac、Windows和Linux。我们需要在后端目录中创建一个名为<code>Dockerfile</code>的新文件。</p>
<pre>// backend/Dockerfile

FROM hasura/graphql-engine:v1.0.0
RUN mkdir /backend-app
WORKDIR /backend-app
COPY . /backend-app/
</pre>
<p>让我们也创建一个<code>.env</code>文件来存储Hasura的所有凭证。</p>
<pre>// backend/.env

HASURA_GRAPHQL_DATABASE_URL=postgres://postgres:@db:5432/postgres
HASURA_GRAPHQL_ENABLE_CONSOLE=false
HASURA_GRAPHQL_MIGRATIONS_DIR=./migrations
ENDPOINT=http://localhost:8080
HASURA_GRAPHQL_ADMIN_SECRET=secret
HASURA_GRAPHQL_JWT_SECRET={"type": "RS256", "key": ""}
</pre>
<p>将凭证存储在环境文件中总是一个好主意。初始化身份验证应用程序后，我们将添加<code>HASURA_GRAPHQL_JWT_SECRET</code>。</p>
<p>这就是我们需要为后端应用程序编写的所有代码。当我们向数据库添加表和列时，迁移文件将自动生成。</p>
<h2 id="gettingstartedwithnextjs">Next.js入门</h2>
<p>我们将在新的<code>frontend</code>目录中创建Next.js应用程序。我们也将对Next.js使用Docker。</p>
<p>Next.js有许多<a href="https://github.com/zeit/next.js/tree/canary/examples/with-docker" target="_blank" rel="noopener noreferrer">例子</a>来引导我们的应用程序。我们将使用<code><a href="https://github.com/zeit/next.js/tree/canary/examples/with-docker" target="_blank" rel="noopener noreferrer">with-docker</a></code>的例子。</p>
<pre>yarn create next-app --example with-docker with-docker-app
</pre>
<p><img data-attachment-id="14238" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/initilializing-nextjs-app-next-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initilializing-nextjs-app-next-app.png" data-orig-size="730,897" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Initializing a Next.js application using next-app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initilializing-nextjs-app-next-app-244x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initilializing-nextjs-app-next-app.png" decoding="async" class="aligncenter size-full wp-image-14238 jetpack-lazy-image" src="../Images/fdee99e3f8e271bd818d7d24c0e02b3b.png" alt="Initializing a Next.js Application Using next-app" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/initilializing-nextjs-app-next-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/initilializing-nextjs-app-next-app-244x300.png 244w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/initilializing-nextjs-app-next-app.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/initilializing-nextjs-app-next-app.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14238" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/initilializing-nextjs-app-next-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initilializing-nextjs-app-next-app.png" data-orig-size="730,897" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Initializing a Next.js application using next-app" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initilializing-nextjs-app-next-app-244x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initilializing-nextjs-app-next-app.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14238" src="../Images/fdee99e3f8e271bd818d7d24c0e02b3b.png" alt="Initializing a Next.js Application Using next-app" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/initilializing-nextjs-app-next-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/initilializing-nextjs-app-next-app-244x300.png 244w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/initilializing-nextjs-app-next-app.png"/></noscript>
<p>上面的命令会生成一个<code>frontend</code>目录。</p>
<p><img data-attachment-id="14236" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/initializing-frontend-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-frontend-app.png" data-orig-size="730,385" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Initializing the frontend application" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-frontend-app-300x158.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-frontend-app.png" decoding="async" class="aligncenter size-full wp-image-14236 jetpack-lazy-image" src="../Images/a225ff746a26526cb2a2d53c73820f82.png" alt="Initializing the Frontend Application" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-frontend-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-frontend-app-300x158.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-frontend-app.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-frontend-app.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14236" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/initializing-frontend-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-frontend-app.png" data-orig-size="730,385" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Initializing the frontend application" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-frontend-app-300x158.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-frontend-app.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14236" src="../Images/a225ff746a26526cb2a2d53c73820f82.png" alt="Initializing the Frontend Application" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-frontend-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-frontend-app-300x158.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-frontend-app.png"/></noscript>
<p>让我们用下面的内容来更新<code>Dockerfile</code>的内容。</p>
<pre>// frontend/Dockerfile

FROM mhart/alpine-node:11.1.0
RUN mkdir /frontend-app
WORKDIR /frontend-app
RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add --no-cache bash git
COPY . /frontend-app/
RUN yarn install
EXPOSE 3000
CMD ["yarn", "dev"]
</pre>
<h2 id="gettingstartedwithourauthenticationapplication">构建认证应用程序</h2>
<p>我们将使用<a href="https://blog.logrocket.com/jwt-authentication-best-practices/" target="_blank" rel="noopener noreferrer"> JWT </a>、Hasura声明和多个角色来设置我们的认证应用程序。我们将根据以下步骤使用<a href="https://github.com/hasura/graphql-engine/tree/master/community/boilerplates/auth-servers/passportjs-jwt-roles" target="_blank" rel="noopener noreferrer">这个库</a>来初始化我们的应用程序。</p>
<ol>
<li>创建一个名为<code>authentication</code>的新目录<pre>mkdir authentication</pre></li>
<li>克隆存储库<pre>git clone https://github.com/hasura/graphql-engine</pre></li>
<li>访问<code>passportjs-jwt-roles</code>目录<pre>cd graphql-engine/community/boilerplates/auth-servers/passportjs-jwt-roles</pre></li>
<li>将该目录移动到我们刚刚创建的<pre>mv * ../../../../../authentication</pre>目录中</li>
<li>在认证目录中创建一个内容为<pre>//authentication/.envDATABASE_URL=postgres://postgres:@db:5432/postgres</pre>的<code>.env</code>文件</li>
<li>安装依赖项<pre>yarn install</pre></li>
<li>生成RSA密钥<pre>openssl genrsa -out private.pem 2048 openssl rsa -in private.pem -pubout &gt; public.pem</pre></li>
<li>以转义格式打印密钥<pre>awk -v ORS='\n' '1' public.pem<img data-attachment-id="14229" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/generating-public-pem/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/generating-public-pem.png" data-orig-size="730,268" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Generating the public.pem file" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/generating-public-pem-300x110.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/generating-public-pem.png" decoding="async" class="aligncenter size-full wp-image-14229 jetpack-lazy-image" src="../Images/f1303d4d3ebdc366ea4cc6235db0ce34.png" alt="Generating the public.pem File" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/generating-public-pem.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/generating-public-pem-300x110.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/generating-public-pem.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/generating-public-pem.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="14229" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/generating-public-pem/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/generating-public-pem.png" data-orig-size="730,268" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Generating the public.pem file" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/generating-public-pem-300x110.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/generating-public-pem.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14229" src="../Images/f1303d4d3ebdc366ea4cc6235db0ce34.png" alt="Generating the public.pem File" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/generating-public-pem.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/generating-public-pem-300x110.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/generating-public-pem.png"/></noscript></pre></li>
<li>将输出添加到后端应用程序的<code>.env</code>文件中的<code>HASURA_GRAPHQL_JWT_SECRET</code>键中。<pre>// backend/.env  ... HASURA_GRAPHQL_JWT_SECRET={"type": "RS256", "key": "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAvdJnVbZrrfYGGrnZTQwq\nlOZGonXh5h6yDqN7Np1KRmz8EyZKulKn186StNt2TZJPyYdAcAH6vnB05LUS47VF\nv9eIaAn8952BnJe0NZ9o+90k03wADORNzzeNqmJWGn2YbBiJHNLDt21Zn9dbOWOE\nKjO7eWOuiKEYEyC/OW9+p+Z05ahCZvmWVzNu9ylnHb8wqlFpwaGIEBn4Cm5/C7Zs\nj6BgggZOKp0GN6XNsc8+4zU1h2CpcCjyDJcNN1mGTMSLQHNOLAI4FY/qLwJcSomf\n8d7vTn+8EsJl+Ur+73qIYKpGoGiJw6Y2qpviRCttR8QF21QlIynz71YZTMl1SBmV\nkwIDAQAB\n-----END PUBLIC KEY-----\n"}</pre></li>
</ol>
<p>我们的身份验证应用程序应该具有以下结构。</p>
<p><img data-attachment-id="14234" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/initializing-authentication-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-authentication-app.png" data-orig-size="730,598" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Initializing our authentication application" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-authentication-app-300x246.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-authentication-app.png" decoding="async" class="aligncenter size-full wp-image-14234 jetpack-lazy-image" src="../Images/d02a3bad314ede250e244fa29fa1a2b4.png" alt="Initializing Our Authentication Application" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-authentication-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-authentication-app-300x246.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-authentication-app.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-authentication-app.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14234" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/initializing-authentication-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-authentication-app.png" data-orig-size="730,598" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Initializing our authentication application" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-authentication-app-300x246.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-authentication-app.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14234" src="../Images/d02a3bad314ede250e244fa29fa1a2b4.png" alt="Initializing Our Authentication Application" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-authentication-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-authentication-app-300x246.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/initializing-authentication-app.png"/></noscript>
<h2 id="restructuringourapplicationtree">重构应用程序树</h2>
<p>如果我们从根开始查看我们的应用程序结构，我们将会看到以下内容。</p>
<p><img data-attachment-id="14255" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/structure-of-apps-product-hunt-clone/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/structure-of-apps-product-hunt-clone.png" data-orig-size="730,308" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Structure of our applications" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/structure-of-apps-product-hunt-clone-300x127.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/structure-of-apps-product-hunt-clone.png" decoding="async" class="aligncenter size-full wp-image-14255 jetpack-lazy-image" src="../Images/eff5d7029d82a60cf07bce8c1d8db764.png" alt="Structure of Our Applications" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/structure-of-apps-product-hunt-clone.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/structure-of-apps-product-hunt-clone-300x127.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/structure-of-apps-product-hunt-clone.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/structure-of-apps-product-hunt-clone.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14255" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/structure-of-apps-product-hunt-clone/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/structure-of-apps-product-hunt-clone.png" data-orig-size="730,308" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Structure of our applications" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/structure-of-apps-product-hunt-clone-300x127.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/structure-of-apps-product-hunt-clone.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14255" src="../Images/eff5d7029d82a60cf07bce8c1d8db764.png" alt="Structure of Our Applications" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/structure-of-apps-product-hunt-clone.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/structure-of-apps-product-hunt-clone-300x127.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/structure-of-apps-product-hunt-clone.png"/></noscript>
<p>让我们从根目录中删除<code>graphql-engine</code>目录，因为我们不再需要它了。</p>
<pre>rm -rf graphql-engine
</pre>
<p>接下来，我们将创建一个新的<code>docker-compose.yml</code>文件，它将负责用以下内容组成我们的应用程序。</p>
<pre>// docker-compose.yml

version: "3"
services:
  backend:
    build:
      context: ./backend
    depends_on:
      - db
    env_file: ./backend/.env
    ports:
      - 8080:8080
    volumes:
      - ./backend:/backend-app
  frontend:
    build:
      context: ./frontend
    command: yarn dev
    depends_on:
      - backend
      - authentication
    volumes:
      - ./frontend:/frontend-app
      - ./frontend/package.json:/frontend-app/package.json
      - ./frontend/yarn.lock:/frontend-app/yarn.lock
    ports:
      - "3000:3000"
  authentication:
    build:
      context: ./authentication
    command: yarn start
    env_file: ./authentication/.env
    depends_on:
      - db
    ports:
      - "3030:3030"
    volumes:
      - ./authentication:/authentication-app
      - ./authentication/package.json:/authentication-app/package.json
      - ./authentication/yarn.lock:/authentication-app/yarn.lock
  db:
    image: postgres:11.3-alpine
    volumes:
      - db_data:/var/lib/postgresql/data
volumes:
  db_data:
</pre>
<p>我们的应用程序树应该如下所示:</p>
<p><img data-attachment-id="14256" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/tree-structure-off-apps/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/tree-structure-off-apps.png" data-orig-size="730,308" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Tree structure of our applications" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/tree-structure-off-apps-300x127.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/tree-structure-off-apps.png" decoding="async" class="aligncenter size-full wp-image-14256 jetpack-lazy-image" src="../Images/d041f83b6f9f4fd5d324b03bd7c65d54.png" alt="Tree Structure of Our Applications" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/tree-structure-off-apps.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/tree-structure-off-apps-300x127.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/tree-structure-off-apps.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/tree-structure-off-apps.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14256" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/tree-structure-off-apps/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/tree-structure-off-apps.png" data-orig-size="730,308" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Tree structure of our applications" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/tree-structure-off-apps-300x127.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/tree-structure-off-apps.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14256" src="../Images/d041f83b6f9f4fd5d324b03bd7c65d54.png" alt="Tree Structure of Our Applications" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/tree-structure-off-apps.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/tree-structure-off-apps-300x127.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/tree-structure-off-apps.png"/></noscript>
<h2 id="startingourapplicationsusingdocker">使用Docker启动我们的应用程序</h2>
<p>一旦Docker安装并运行在我们的系统上，我们就可以运行下面的命令来启动我们的应用程序。</p>
<pre>docker-compose up
</pre>
<p>有关上述命令的更多信息，请参见<a href="https://docs.docker.com/compose/reference/up/" target="_blank" rel="noopener noreferrer"> Docker文档</a>。</p>
<p>我们可以使用<code><a href="https://docs.docker.com/compose/reference/ps/" target="_blank" rel="noopener noreferrer">docker-compose ps</a></code>命令检查是否所有的容器都启动并运行了。</p>
<p><img data-attachment-id="14249" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/running-docker-containers/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers.png" data-orig-size="730,253" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="View running Docker containers" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers-300x104.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers.png" decoding="async" class="aligncenter size-full wp-image-14249 jetpack-lazy-image" src="../Images/1af7435694e4acc1f48e48b568cabc42.png" alt="View Running Docker Containers" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers-300x104.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14249" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/running-docker-containers/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers.png" data-orig-size="730,253" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="View running Docker containers" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers-300x104.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14249" src="../Images/1af7435694e4acc1f48e48b568cabc42.png" alt="View Running Docker Containers" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers-300x104.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers.png"/></noscript>
<p>请注意，容器的名称可以不同。</p>
<h2 id="runningmigrationstocreateuserdatainourdatabase">运行迁移以在我们的数据库中创建用户数据</h2>
<p>在我们的身份验证应用程序中，迁移目录中有三个迁移:</p>
<p><img data-attachment-id="14241" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/migrations-for-authentication-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app.png" data-orig-size="730,308" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Migrations for our authentication application" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app-300x127.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app.png" decoding="async" class="aligncenter size-full wp-image-14241 jetpack-lazy-image" src="../Images/12564991c5b43a5eecf0c9719580b804.png" alt="Migrations for Our Authentication Application" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app-300x127.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14241" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/migrations-for-authentication-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app.png" data-orig-size="730,308" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Migrations for our authentication application" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app-300x127.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14241" src="../Images/12564991c5b43a5eecf0c9719580b804.png" alt="Migrations for Our Authentication Application" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app-300x127.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app.png"/></noscript>
<p>为了运行这些迁移，我们必须<a href="https://phase2.github.io/devtools/common-tasks/ssh-into-a-container/" target="_blank" rel="noopener noreferrer"> SSH到我们的认证容器</a>。我们可以通过运行下面的命令找出所有容器的名称。</p>
<pre>docker-compose ps
</pre>
<p><img data-attachment-id="14248" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/running-docker-containers-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers-2.png" data-orig-size="730,253" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="View running Docker containers" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers-2-300x104.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers-2.png" decoding="async" class="aligncenter size-full wp-image-14248 jetpack-lazy-image" src="../Images/fad9ff9edc5329899d62ef54acff1b9f.png" alt="View Running Docker Containers" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers-2.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers-2-300x104.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers-2.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14248" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/running-docker-containers-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers-2.png" data-orig-size="730,253" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="View running Docker containers" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers-2-300x104.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers-2.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14248" src="../Images/fad9ff9edc5329899d62ef54acff1b9f.png" alt="View Running Docker Containers" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers-2.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers-2-300x104.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/running-docker-containers-2.png"/></noscript>
<p>为了SSH到身份验证容器，我们需要运行以下命令。</p>
<pre>docker exec -it authentication_1 /bin/bash
</pre>
<p>进入容器后，我们可以使用以下命令运行迁移。</p>
<pre>bash-4.4# knex migrate:latest
</pre>
<p>它将运行来自身份验证应用程序的所有迁移。</p>
<p><img data-attachment-id="14240" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/migrations-for-authentication-app-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app-2.png" data-orig-size="730,288" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Running migrations for our authentication application" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app-2-300x118.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app-2.png" decoding="async" class="aligncenter size-full wp-image-14240 jetpack-lazy-image" src="../Images/adbcef22d0182b26bd1cec0128cc6074.png" alt="Running Migrations for Our Authentication Application" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app-2.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app-2-300x118.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app-2.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14240" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/migrations-for-authentication-app-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app-2.png" data-orig-size="730,288" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Running migrations for our authentication application" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app-2-300x118.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app-2.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14240" src="../Images/adbcef22d0182b26bd1cec0128cc6074.png" alt="Running Migrations for Our Authentication Application" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app-2.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app-2-300x118.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/migrations-for-authentication-app-2.png"/></noscript>
<p>现在让我们看看上面的三个迁移是如何修改我们的数据库的。在我们从容器中退出后(使用命令<code>exit</code>，我们可以转到我们的<code>backend</code>目录，在那里我们将运行下面的命令来运行<a href="https://docs.hasura.io/1.0/graphql/manual/hasura-cli/hasura_console.html" target="_blank" rel="noopener noreferrer"> Hasura控制台</a>。</p>
<pre>hasura console
</pre>
<p>这将在<a href="http://localhost:9695/" rel="nofollow"> http://localhost:9695/ </a>上打开Hasura控制台。如果我们转到Data选项卡，我们将能够看到五个未跟踪的表。</p>
<p><img data-attachment-id="14233" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/hasura-schema/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-schema.png" data-orig-size="730,410" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Viewing our Hasura schema" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-schema-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-schema.png" decoding="async" class="aligncenter size-full wp-image-14233 jetpack-lazy-image" src="../Images/9066e8338a5012dc108a171555b7ea02.png" alt="Viewing Our Hasura Schema" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-schema.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-schema-300x168.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-schema.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-schema.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14233" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/hasura-schema/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-schema.png" data-orig-size="730,410" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Viewing our Hasura schema" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-schema-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-schema.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14233" src="../Images/9066e8338a5012dc108a171555b7ea02.png" alt="Viewing Our Hasura Schema" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-schema.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-schema-300x168.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-schema.png"/></noscript>
<p>我们需要点击<code>role</code>、<code>user</code>和<code>user_role</code>旁边的<strong>轨道</strong>按钮。这些没有被跟踪，因为它们没有通过GraphQL API公开。</p>
<p>接下来，我们将单击<strong>未跟踪的外键关系</strong>旁边的<strong>跟踪所有</strong>按钮来跟踪所有关系。我们可以从每个表内的<strong>关系</strong>选项卡中查看每个表的关系。</p>
<p><img data-attachment-id="14227" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/foreign-key-relations-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/foreign-key-relations-hasura.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Tracking foreign-key relations" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/foreign-key-relations-hasura-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/foreign-key-relations-hasura.png" decoding="async" class="aligncenter size-full wp-image-14227 jetpack-lazy-image" src="../Images/7e2bda29e44ab9918df74b98d8d6cb14.png" alt="Tracking Foreign-Key Relations" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/foreign-key-relations-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/foreign-key-relations-hasura-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/foreign-key-relations-hasura.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/foreign-key-relations-hasura.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14227" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/foreign-key-relations-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/foreign-key-relations-hasura.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Tracking foreign-key relations" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/foreign-key-relations-hasura-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/foreign-key-relations-hasura.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14227" src="../Images/7e2bda29e44ab9918df74b98d8d6cb14.png" alt="Tracking Foreign-Key Relations" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/foreign-key-relations-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/foreign-key-relations-hasura-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/foreign-key-relations-hasura.png"/></noscript>
<p><img data-attachment-id="14257" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/user_role-tables-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/user_role-tables-hasura.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Relationships of the user_role table" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/user_role-tables-hasura-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/user_role-tables-hasura.png" decoding="async" class="aligncenter size-full wp-image-14257 jetpack-lazy-image" src="../Images/634232747a272c187bbfa2ada1d34893.png" alt="Relationships of the user_role Table" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/user_role-tables-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/user_role-tables-hasura-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/user_role-tables-hasura.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/user_role-tables-hasura.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14257" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/user_role-tables-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/user_role-tables-hasura.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Relationships of the user_role table" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/user_role-tables-hasura-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/user_role-tables-hasura.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14257" src="../Images/634232747a272c187bbfa2ada1d34893.png" alt="Relationships of the user_role Table" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/user_role-tables-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/user_role-tables-hasura-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/user_role-tables-hasura.png"/></noscript>
<p>我们现在可以查看迁移创建的所有表。</p>
<p><code>role</code>表有两列:</p>
<ol>
<li><code>id</code> (uuid，主键，唯一；默认:<code>gen_random_uuid()</code>)</li>
<li><code>name</code>——(性格多变，独一无二)</li>
</ol>
<p><code>user</code>表格有五列:</p>
<ol>
<li><code>id</code>——(uuid，主键，唯一；默认:<code>gen_random_uuid()</code>)</li>
<li><code>username</code>——(性格多变，独一无二)</li>
<li><code>password</code>——(性格多变)</li>
<li><code>created_at</code> —(带时区的时间戳，默认:<code>now()</code>)</li>
<li><code>active</code> —(布尔型，可空，默认:<code>true</code>)</li>
</ol>
<p><code>user_role</code>表格有三列:</p>
<ol>
<li><code>id</code> — (uuid，主键，唯一，默认:<code>gen_random_uuid()</code>)</li>
<li><code>role_id</code> — (uuid，可空)</li>
<li><code>user_id</code> — (uuid，可空)</li>
</ol>
<p>现在，如果我们访问<a href="http://localhost:9695/api-explorer" target="_blank" rel="noopener noreferrer"> Hasura GraphQL Explorer </a>，我们将能够使用GraphQL查询我们的数据库。</p>
<p><img data-attachment-id="14230" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/graphql-data-graphiql/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/graphql-data-graphiql.png" data-orig-size="730,409" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Checking GraphQL data using GraphiQL" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/graphql-data-graphiql-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/graphql-data-graphiql.png" decoding="async" class="aligncenter size-full wp-image-14230 jetpack-lazy-image" src="../Images/773b7de2d33493c98ac7534f8361d164.png" alt="Checking GraphQL Data Using GraphiQL" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/graphql-data-graphiql.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/graphql-data-graphiql-300x168.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/graphql-data-graphiql.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/graphql-data-graphiql.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14230" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/graphql-data-graphiql/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/graphql-data-graphiql.png" data-orig-size="730,409" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Checking GraphQL data using GraphiQL" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/graphql-data-graphiql-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/graphql-data-graphiql.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14230" src="../Images/773b7de2d33493c98ac7534f8361d164.png" alt="Checking GraphQL Data Using GraphiQL" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/graphql-data-graphiql.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/graphql-data-graphiql-300x168.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/graphql-data-graphiql.png"/></noscript>
<p>因为我们没有任何用户数据，所以响应是一个空的<code>user</code>数组。有趣的是，如果我们不将<code>x-hasura-admin-secret</code>键(其值为<code>secret</code>)与请求头一起发送，我们将无法查询任何数据。</p>
<p><img data-attachment-id="14232" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/hasura-request-header/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-request-header.png" data-orig-size="730,407" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Sending x-hasura-admin-secret in the Request Header is mandatory" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-request-header-300x167.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-request-header.png" decoding="async" class="aligncenter size-full wp-image-14232 jetpack-lazy-image" src="../Images/fd2a1de8558f94b894a36ea98d3bd8a0.png" alt="Sending x-hasura-admin-secret in the Request Header Is Mandatory" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-request-header.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-request-header-300x167.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-request-header.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-request-header.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14232" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/hasura-request-header/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-request-header.png" data-orig-size="730,407" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Sending x-hasura-admin-secret in the Request Header is mandatory" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-request-header-300x167.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-request-header.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14232" src="../Images/fd2a1de8558f94b894a36ea98d3bd8a0.png" alt="Sending x-hasura-admin-secret in the Request Header Is Mandatory" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-request-header.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-request-header-300x167.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-request-header.png"/></noscript>
<p>这是因为我们已经在<code>.env</code>文件中将<code>HASURA_GRAPHQL_ADMIN_SECRET</code>的值设置为<code>secret</code>，作为<a href="https://docs.hasura.io/1.0/graphql/manual/deployment/heroku/securing-graphql-endpoint.html" target="_blank" rel="noopener noreferrer">保护GraphQL端点</a>的一部分。</p>
<p><img data-attachment-id="14250" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/securing-api-endpoints-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/securing-api-endpoints-hasura.png" data-orig-size="730,230" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Securing our API endpoints using HASURA_GRAPHQL_ADMIN_SECRET" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/securing-api-endpoints-hasura-300x95.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/securing-api-endpoints-hasura.png" decoding="async" class="aligncenter size-full wp-image-14250 jetpack-lazy-image" src="../Images/9d73bf52cd486fe7f555e18ba3a4e8de.png" alt="Securing Our API Endpoints Using HASURA_GRAPHQL_ADMIN_SECRET" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/securing-api-endpoints-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/securing-api-endpoints-hasura-300x95.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/securing-api-endpoints-hasura.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/securing-api-endpoints-hasura.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14250" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/securing-api-endpoints-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/securing-api-endpoints-hasura.png" data-orig-size="730,230" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Securing our API endpoints using HASURA_GRAPHQL_ADMIN_SECRET" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/securing-api-endpoints-hasura-300x95.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/securing-api-endpoints-hasura.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14250" src="../Images/9d73bf52cd486fe7f555e18ba3a4e8de.png" alt="Securing Our API Endpoints Using HASURA_GRAPHQL_ADMIN_SECRET" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/securing-api-endpoints-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/securing-api-endpoints-hasura-300x95.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/securing-api-endpoints-hasura.png"/></noscript>
<p>此外，我们需要记住，我们通过Hasura控制台所做的任何更改都会在我们的<code>migration</code>目录中创建迁移，该目录位于后端应用程序的目录中。</p>
<p><img data-attachment-id="14222" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/auto-generate-migration-files-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/auto-generate-migration-files-hasura.png" data-orig-size="730,288" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Hasura console automatically generates migration files" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/auto-generate-migration-files-hasura-300x118.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/auto-generate-migration-files-hasura.png" decoding="async" class="aligncenter size-full wp-image-14222 jetpack-lazy-image" src="../Images/b5dfafdce007b9ee6f7f471c6dc4bff1.png" alt="Hasura Console Automatically Generates Migration Files" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/auto-generate-migration-files-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/auto-generate-migration-files-hasura-300x118.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/auto-generate-migration-files-hasura.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/auto-generate-migration-files-hasura.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14222" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/auto-generate-migration-files-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/auto-generate-migration-files-hasura.png" data-orig-size="730,288" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Hasura console automatically generates migration files" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/auto-generate-migration-files-hasura-300x118.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/auto-generate-migration-files-hasura.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14222" src="../Images/b5dfafdce007b9ee6f7f471c6dc4bff1.png" alt="Hasura Console Automatically Generates Migration Files" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/auto-generate-migration-files-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/auto-generate-migration-files-hasura-300x118.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/auto-generate-migration-files-hasura.png"/></noscript>
<h2 id="authenticatingusersusingourauthenticationapplication">使用我们的认证应用认证用户</h2>
<p>如果我们遵循我们的认证存储库的<a href="https://github.com/hasura/graphql-engine/tree/master/community/boilerplates/auth-servers/passportjs-jwt-roles#usage" target="_blank" rel="noopener noreferrer">文档</a>，我们可以启动下面的CURL请求来创建一个新用户。</p>
<pre>curl -H "Content-Type: application/json" \
     -d'{"username": "admin1", "password": "pass", "confirmPassword": "pass"}'\
     http://localhost:3030/signup
</pre>
<p>我们会得到如下回应。</p>
<p><img data-attachment-id="14243" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/new-user-response-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/new-user-response-hasura.png" data-orig-size="730,373" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Response for creating a new user in Hasura" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/new-user-response-hasura-300x153.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/new-user-response-hasura.png" decoding="async" class="aligncenter size-full wp-image-14243 jetpack-lazy-image" src="../Images/972803bbbcb0d9bd5d4a34a3a1531573.png" alt="Response for Creating a New User in Hasura" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/new-user-response-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/new-user-response-hasura-300x153.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/new-user-response-hasura.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/new-user-response-hasura.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14243" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/new-user-response-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/new-user-response-hasura.png" data-orig-size="730,373" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Response for creating a new user in Hasura" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/new-user-response-hasura-300x153.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/new-user-response-hasura.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14243" src="../Images/972803bbbcb0d9bd5d4a34a3a1531573.png" alt="Response for Creating a New User in Hasura" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/new-user-response-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/new-user-response-hasura-300x153.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/new-user-response-hasura.png"/></noscript>
<p>我们还可以做一个类似的CURL请求来登录一个现有的用户。</p>
<pre>curl -H "Content-Type: application/json" \
     -d'{"username": "admin1", "password": "pass"}' \
     http://localhost:3030/login
</pre>
<p>我们会得到如下回应。</p>
<p><img data-attachment-id="14225" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/existing-user-login-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/existing-user-login-hasura.png" data-orig-size="730,388" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Response for logging in an existing user in Hasura" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/existing-user-login-hasura-300x159.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/existing-user-login-hasura.png" decoding="async" class="aligncenter size-full wp-image-14225 jetpack-lazy-image" src="../Images/4cbf55287b7246a12b82ae12a8d0d0d6.png" alt="Response for Logging In an Existing User in Hasura" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/existing-user-login-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/existing-user-login-hasura-300x159.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/existing-user-login-hasura.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/existing-user-login-hasura.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14225" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/existing-user-login-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/existing-user-login-hasura.png" data-orig-size="730,388" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Response for logging in an existing user in Hasura" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/existing-user-login-hasura-300x159.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/existing-user-login-hasura.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14225" src="../Images/4cbf55287b7246a12b82ae12a8d0d0d6.png" alt="Response for Logging In an Existing User in Hasura" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/existing-user-login-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/existing-user-login-hasura-300x159.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/existing-user-login-hasura.png"/></noscript>
<h2 id="integratingtheauthenticationapplicationwithourfrontendapplication">将身份验证应用程序与我们的前端应用程序集成</h2>
<p>让我们将Next.js应用程序与身份验证应用程序连接起来。前端应用运行在<a href="http://localhost:3000/" rel="nofollow"> http://localhost:3000/ </a>上。</p>
<p>我们将使用<a href="https://chakra-ui.com/getting-started" target="_blank" rel="noopener noreferrer"> Chakra UI </a>来构建我们的前端应用程序，使用<a href="https://github.com/maticzav/nookies" target="_blank" rel="noopener noreferrer"> Nookies </a>来处理cookies。要安装它们，我们需要SSH到我们的前端容器。</p>
<pre>docker exec -it frontend_1 /bin/bash
</pre>
<p>一旦我们进入容器，我们可以使用下面的命令安装这个包。</p>
<pre>bash-4.4# yarn add @chakra-ui/core @emotion/core @emotion/styled emotion-theming nookies
</pre>
<p>我们需要在<code>pages</code>目录下创建一个名为<code>_app.js</code>的新文件，内容如下。</p>
<pre>// frontend/pages/_app.js

import React from 'react'
import NextApp from 'next/app'
import { ThemeProvider, CSSReset, theme } from '@chakra-ui/core'

class App extends NextApp {
  render() {
    const { Component } = this.props
    return (
      &lt;ThemeProvider theme={theme}&gt;
        &lt;CSSReset /&gt;
        &lt;Component /&gt;
      &lt;/ThemeProvider&gt;
    )
  }
}

export default App
</pre>
<p>让我们将Chakra UI中的<code>Button</code>组件添加到我们的索引页面。</p>
<pre>// frontend/pages/index.js

import React from 'react'
import { Box, Button } from "@chakra-ui/core";

const IndexPage = () =&gt; {
  return (
    &lt;Box
      w="100%"
      minH="100vh"
      p={4}
      d="flex"
      alignItems="center"
      justifyContent="center"
    &gt;
      &lt;Button&gt;Hello World!&lt;/Button&gt;
    &lt;/Box&gt;
  )
}

export default IndexPage
</pre>
<p><img data-attachment-id="14228" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/frontend-app-loading-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/frontend-app-loading-page.png" data-orig-size="730,270" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Landing page of our frontend application" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/frontend-app-loading-page-300x111.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/frontend-app-loading-page.png" decoding="async" class="aligncenter size-full wp-image-14228 jetpack-lazy-image" src="../Images/6de39f6f0ff3bcd33ded8a303ee2cdc6.png" alt="Landing Page of Our Frontend Application" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/frontend-app-loading-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/frontend-app-loading-page-300x111.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/frontend-app-loading-page.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/frontend-app-loading-page.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14228" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/frontend-app-loading-page/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/frontend-app-loading-page.png" data-orig-size="730,270" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Landing page of our frontend application" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/frontend-app-loading-page-300x111.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/frontend-app-loading-page.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14228" src="../Images/6de39f6f0ff3bcd33ded8a303ee2cdc6.png" alt="Landing Page of Our Frontend Application" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/frontend-app-loading-page.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/frontend-app-loading-page-300x111.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/frontend-app-loading-page.png"/></noscript>
<p>现在让我们创建注册表单。我们将有三个字段:用户名，密码和确认密码。</p>
<pre>// frontend/components/forms/sign-up.js

import React, { useState } from "react";
import {
  Alert,
  AlertIcon,
  Box,
  Button,
  FormControl,
  FormLabel,
  FormHelperText,
  Input
} from "@chakra-ui/core";
import { setCookie } from "nookies";

const SignUpForm = () =&gt; {
  const [username, setUsername] = useState("");
  const [password, setPassword] = useState("");
  const [confirmPassword, setConfirmPassword] = useState("");
  const [error, setError] = useState(null);

  const handleSubmit = async e =&gt; {
    e.preventDefault();

  const response = await fetch("http://localhost:3030/signup", {
      method: "POST",
      body: JSON.stringify({
        username,
        password,
        confirmPassword
      }),
      headers: {
        "Content-type": "application/json; charset=UTF-8"
      }
    });

    const data = await response.json();

    if (response.status !== 200) {
      setError("Something went wrong! Please try again.");
    } else {
      setCookie({}, "X-Hasura-User-Id", data.id, {
        maxAge: 30 * 24 * 60 * 60,
        path: "/"
      });
      setCookie({}, "token", data.token, {
        maxAge: 30 * 24 * 60 * 60,
        path: "/"
      });
    }
  };

  const errorsNode = () =&gt; {
    if (!error) return false;
    return (
      &lt;Alert status="error" mb={8} rounded="md" variant="left-accent"&gt;
        &lt;AlertIcon /&gt;
        {error}
      &lt;/Alert&gt;
    );
  };

  return (
    &lt;Box
      w="100%"
      minH="100vh"
      p={4}
      d="flex"
      alignItems="center"
      justifyContent="center"
    &gt;
      &lt;Box w="500px" p={8} bg="gray.50" rounded="md"&gt;
        {errorsNode()}
        &lt;FormControl mb={8}&gt;
          &lt;FormLabel htmlFor="username"&gt;Username&lt;/FormLabel&gt;
          &lt;Input
            type="text"
            id="username"
            aria-describedby="john"
            value={username}
            onChange={e =&gt; setUsername(e.target.value)}
          /&gt;
        &lt;/FormControl&gt;
        &lt;FormControl mb={8}&gt;
          &lt;FormLabel htmlFor="password"&gt;Password&lt;/FormLabel&gt;
          &lt;Input
            type="password"
            id="password"
            aria-describedby="*****"
            value={password}
            onChange={e =&gt; setPassword(e.target.value)}
          /&gt;
        &lt;/FormControl&gt;
        &lt;FormControl mb={8}&gt;
          &lt;FormLabel htmlFor="confirm-password"&gt;Confirm Password&lt;/FormLabel&gt;
          &lt;Input
            type="password"
            id="confirm-password"
            aria-describedby="*****"
            value={confirmPassword}
            onChange={e =&gt; setConfirmPassword(e.target.value)}
          /&gt;
          {!!confirmPassword &amp;&amp; confirmPassword !== password &amp;&amp; (
            &lt;FormHelperText id="confirm-password"&gt;
              Passwords do not match
            &lt;/FormHelperText&gt;
          )}
        &lt;/FormControl&gt;
        &lt;FormControl&gt;
          &lt;Button bg="#764ABC" color="white" onClick={handleSubmit}&gt;
            Sign Up
          &lt;/Button&gt;
        &lt;/FormControl&gt;
      &lt;/Box&gt;
    &lt;/Box&gt;
  );
};

export default SignUpForm;
</pre>
<p>我们需要在索引页面中导入表单。</p>
<pre>// frontend/pages/index.js

import React, { Component } from "react";
import SignUpForm from "../components/forms/sign-up";

export default class IndexPage extends Component {
  render() {
    return &lt;SignUpForm /&gt;;
  }
}
</pre>
<p>上面的代码会在<a href="http://localhost:3000/" rel="nofollow"> http://localhost:3000/ </a>上生成下面的表单。</p>
<p><img data-attachment-id="14253" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/sign-up-form-chakra-ui/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-up-form-chakra-ui.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Sign-up form using Chakra UI" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-up-form-chakra-ui-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-up-form-chakra-ui.png" decoding="async" class="aligncenter size-full wp-image-14253 jetpack-lazy-image" src="../Images/9a5aa531a0bd5949c7c51cf9618bc41e.png" alt="Sign-Up Form Using Chakra UI" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-up-form-chakra-ui.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/sign-up-form-chakra-ui-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-up-form-chakra-ui.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-up-form-chakra-ui.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14253" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/sign-up-form-chakra-ui/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-up-form-chakra-ui.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Sign-up form using Chakra UI" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-up-form-chakra-ui-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-up-form-chakra-ui.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14253" src="../Images/9a5aa531a0bd5949c7c51cf9618bc41e.png" alt="Sign-Up Form Using Chakra UI" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-up-form-chakra-ui.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/sign-up-form-chakra-ui-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-up-form-chakra-ui.png"/></noscript>
<p>让我们仔细看看我们的<code>SignUpForm</code>组件的<code>handleSubmit</code>函数。</p>
<p>首先，我们将向<a href="http://localhost:3030/signup" rel="nofollow">http://localhost:3030/sign up</a>发起一个<code>POST</code>请求，这是我们的注册API端点。如果我们从我们的API得到一个<code>success</code>响应，这意味着我们将响应中的用户的<code>id</code>和<code>token</code>存储在cookies中。如果我们检查我们的浏览器cookies，我们会看到现在在我们的浏览器中设置了两个cookies。</p>
<p><img data-attachment-id="14251" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/setting-up-cookies-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/setting-up-cookies-hasura.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Setting cookies for the user from the response" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/setting-up-cookies-hasura-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/setting-up-cookies-hasura.png" decoding="async" class="aligncenter size-full wp-image-14251 jetpack-lazy-image" src="../Images/d9e225c013b90c1e4013ce6497637161.png" alt="Setting Cookies for the User From the Response" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/setting-up-cookies-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/setting-up-cookies-hasura-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/setting-up-cookies-hasura.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/setting-up-cookies-hasura.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14251" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/setting-up-cookies-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/setting-up-cookies-hasura.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Setting cookies for the user from the response" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/setting-up-cookies-hasura-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/setting-up-cookies-hasura.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14251" src="../Images/d9e225c013b90c1e4013ce6497637161.png" alt="Setting Cookies for the User From the Response" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/setting-up-cookies-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/setting-up-cookies-hasura-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/setting-up-cookies-hasura.png"/></noscript>
<p>在Hasura中，<a href="https://docs.hasura.io/1.0/graphql/manual/auth/authorization/basics.html" target="_blank" rel="noopener noreferrer">授权用户</a>需要用到<code>X-Hasura-User-Id</code> cookie。我们还可以存储用户的类型，但这在我们的应用程序中是不必要的。我们将在后端应用程序中建立授权时使用这个cookie。</p>
<p>让我们创建一个类似的只有两个字段的登录表单:用户名和密码<strong>。</strong></p>
<pre>// frontend/components/forms/sign-in.js

import React, { useState } from "react";
import {
  Alert,
  AlertIcon,
  Box,
  Button,
  FormControl,
  FormLabel,
  Input
} from "@chakra-ui/core";
import { setCookie } from "nookies";

const SignInForm = () =&gt; {
  const [username, setUsername] = useState("");
  const [password, setPassword] = useState("");
  const [error, setError] = useState(null);

  const handleSubmit = async e =&gt; {
    e.preventDefault();

    const response = await fetch("http://localhost:3030/login", {
      method: "POST",
      body: JSON.stringify({
        username,
        password
      }),
      headers: {
        "Content-type": "application/json; charset=UTF-8"
      }
    });

    const data = await response.json();

    if (response.status !== 200) {
      setError("Something went wrong! Please try again.");
    } else {
      setCookie({}, "X-Hasura-User-Id", data.id, {
        maxAge: 30 * 24 * 60 * 60,
        path: "/"
      });
      setCookie({}, "token", data.token, {
        maxAge: 30 * 24 * 60 * 60,
        path: "/"
      });
    }
  };

  const errorsNode = () =&gt; {
    if (!error) return false;
    return (
      &lt;Alert status="error" mb={8} rounded="md" variant="left-accent"&gt;
        &lt;AlertIcon /&gt;
        {error}
      &lt;/Alert&gt;
    );
  };

  return (
    &lt;Box
      w="100%"
      minH="100vh"
      p={4}
      d="flex"
      alignItems="center"
      justifyContent="center"
    &gt;
      &lt;Box w="500px" p={8} bg="gray.50" rounded="md"&gt;
        {errorsNode()}
        &lt;FormControl mb={8}&gt;
          &lt;FormLabel htmlFor="username"&gt;Username&lt;/FormLabel&gt;
          &lt;Input
            type="text"
            id="username"
            aria-describedby="john"
            value={username}
            onChange={e =&gt; setUsername(e.target.value)}
          /&gt;
        &lt;/FormControl&gt;
        &lt;FormControl mb={8}&gt;
          &lt;FormLabel htmlFor="password"&gt;Password&lt;/FormLabel&gt;
          &lt;Input
            type="password"
            id="password"
            aria-describedby="*****"
            value={password}
            onChange={e =&gt; setPassword(e.target.value)}
          /&gt;
        &lt;/FormControl&gt;
        &lt;FormControl&gt;
          &lt;Button bg="#764ABC" color="white" onClick={handleSubmit}&gt;
            Sign In
          &lt;/Button&gt;
        &lt;/FormControl&gt;
      &lt;/Box&gt;
    &lt;/Box&gt;
  );
};

export default SignInForm;
</pre>
<p>让我们将该表单导入到我们的<code>login</code>页面中。</p>
<pre>// frontend/pages/login.js

import React, { Component } from "react";
import SignInForm from "../components/forms/sign-in";

export default class SignInPage extends Component {
  render() {
    return &lt;SignInForm /&gt;;
  }
}
</pre>
<p>现在，如果我们访问<a href="http://localhost:3000/login" rel="nofollow">http://localhost:3000/log in</a>，我们应该能够看到我们的登录表单。</p>
<p><img data-attachment-id="14252" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/sign-in-form-component/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-in-form-component.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="SignInForm component" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-in-form-component-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-in-form-component.png" decoding="async" class="aligncenter size-full wp-image-14252 jetpack-lazy-image" src="../Images/3befc992b39e2c3ca781b65dd1716027.png" alt="SignInForm Component" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-in-form-component.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/sign-in-form-component-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-in-form-component.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-in-form-component.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14252" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/sign-in-form-component/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-in-form-component.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="SignInForm component" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-in-form-component-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-in-form-component.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14252" src="../Images/3befc992b39e2c3ca781b65dd1716027.png" alt="SignInForm Component" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-in-form-component.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/sign-in-form-component-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/sign-in-form-component.png"/></noscript>
<p>现在，让我们创建另一个显示产品列表的组件。目前，我们没有任何产品。所以让我们创造一些。</p>
<pre>// frontend/components/lists/products.js

import React from "react";
import { Grid, Box } from "@chakra-ui/core";

const ProductsList = () =&gt; {
  return (
    &lt;Box
      w="100%"
      minH="100vh"
      p={4}
      d="flex"
      alignItems="center"
      justifyContent="center"
    &gt;
      &lt;Box w="800px" p={8} bg="gray.50" borderRadius="sm"&gt;
        &lt;Grid
          templateColumns={[
            "repeat(1, 1fr)",
            "repeat(1, 1fr)",
            "repeat(2, 1fr)"
          ]}
          gap={8}
        &gt;
          &lt;Box w="100%" h={24} bg="#764ABC" rounded="md" /&gt;
          &lt;Box w="100%" h={24} bg="#764ABC" rounded="md" /&gt;
          &lt;Box w="100%" h={24} bg="#764ABC" rounded="md" /&gt;
          &lt;Box w="100%" h={24} bg="#764ABC" rounded="md" /&gt;
          &lt;Box w="100%" h={24} bg="#764ABC" rounded="md" /&gt;
          &lt;Box w="100%" h={24} bg="#764ABC" rounded="md" /&gt;
        &lt;/Grid&gt;
      &lt;/Box&gt;
    &lt;/Box&gt;
  );
};

export default ProductsList;
</pre>
<p>我们将在<code>products</code>页面上展示这些组件。</p>
<pre>// frontend/pages/products/index.js

import React, { Component } from "react";
import ProductsList from "../components/lists/products";

export default class ProductsPage extends Component {
  render() {
    return &lt;ProductsList /&gt;;
  }
}
</pre>
<p>如果我们访问<a href="http://localhost:3000/products" rel="nofollow">http://localhost:3000/products</a>，我们现在应该会看到下面的屏幕。</p>
<p><img data-attachment-id="14246" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/products-list-component/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list-component.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Products list component" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list-component-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list-component.png" decoding="async" class="aligncenter size-full wp-image-14246 jetpack-lazy-image" src="../Images/a486b6c69a05868380ab6f1479b7c354.png" alt="Products List Component" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list-component.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/products-list-component-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list-component.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list-component.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14246" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/products-list-component/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list-component.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Products list component" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list-component-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list-component.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14246" src="../Images/a486b6c69a05868380ab6f1479b7c354.png" alt="Products List Component" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list-component.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/products-list-component-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list-component.png"/></noscript>
<p>目前，我们只是显示占位符内容，而不是产品本身。下一步是创建一个表来存储我们后端应用程序中的产品。</p>
<h2 id="creatingtablesforstoringourproductsinhasura">在Hasura中创建产品储物表</h2>
<p>让我们构建一个特性，使用Hasura从数据库中存储和检索产品。</p>
<p>如果我们将目录更改为我们的后端应用程序并运行<code>hasura console</code>命令，控制台将在<a href="http://localhost:9695/" rel="nofollow"> http://localhost:9695/ </a>启动并运行。</p>
<p><img data-attachment-id="14231" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/hasura-console/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-console.png" data-orig-size="730,407" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Hasura console up and running on http://localhost:9695/" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-console-300x167.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-console.png" decoding="async" class="aligncenter size-full wp-image-14231 jetpack-lazy-image" src="../Images/391953eb41099fbaff51eaf3fcebb137.png" alt="Hasura Console Up and Running on http://localhost:9695/" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-console.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-console-300x167.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-console.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-console.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14231" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/hasura-console/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-console.png" data-orig-size="730,407" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Hasura console up and running on http://localhost:9695/" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-console-300x167.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-console.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14231" src="../Images/391953eb41099fbaff51eaf3fcebb137.png" alt="Hasura Console Up and Running on http://localhost:9695/" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-console.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-console-300x167.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/hasura-console.png"/></noscript>
<p>让我们单击<strong>数据</strong>选项卡，添加一个名为<code>product</code>的新表，它将包含以下六列。</p>
<ol>
<li>   <ol>
<li><code>id</code> (uuid，主键，唯一，默认:<code>gen_random_uuid()</code>)</li>
<li><code>name</code> <span> (chara </span> <span> cter) </span></li>
<li><code>description</code>(字符)</li>
<li><code>created_at</code>(带时区的时间戳，默认:<code>now()</code>)</li>
<li><code>updated_at</code>(带时区的时间戳，默认:<code>now()</code>)</li>
<li><code>maker_id</code>  (uuid)</li>
</ol>
</li>
</ol>
<p><img data-attachment-id="14244" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/product-model-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/product-model-hasura.png" data-orig-size="730,401" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Product model in Hasura" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/product-model-hasura-300x165.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/product-model-hasura.png" decoding="async" class="aligncenter size-full wp-image-14244 jetpack-lazy-image" src="../Images/4a9c761f223f2905049e668e619e57fd.png" alt="Product Model in Hasura" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/product-model-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/product-model-hasura-300x165.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/product-model-hasura.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/product-model-hasura.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14244" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/product-model-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/product-model-hasura.png" data-orig-size="730,401" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Product model in Hasura" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/product-model-hasura-300x165.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/product-model-hasura.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14244" src="../Images/4a9c761f223f2905049e668e619e57fd.png" alt="Product Model in Hasura" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/product-model-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/product-model-hasura-300x165.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/product-model-hasura.png"/></noscript>
<p>我们还需要添加产品和制造商(添加产品的用户)之间的关系。我们将使用这种关系来授权编辑该项。</p>
<p>要建立产品和用户模型之间的关系，我们需要做以下工作:</p>
<ol>
<li>点击产品模型内的<strong>关系</strong>选项卡</li>
<li>点击<strong>下方的配置按钮手动添加新关系</strong></li>
<li>从<strong>关系类型</strong>下拉列表中选择<strong>对象关系</strong></li>
<li>键入“maker”作为关系名称</li>
<li>从<strong>参考模式</strong>下拉菜单中选择<strong>公共</strong></li>
<li>选择<strong>用户</strong>作为<strong>参照表</strong></li>
<li>从下拉菜单的<strong>中选择<strong> maker_id </strong>，从<strong>到</strong>下拉菜单中选择<strong> id </strong></strong></li>
</ol>
<p>我们现在已经定义了产品和用户模型之间的关系。</p>
<p><img data-attachment-id="14245" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/product-user-models-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/product-user-models-hasura.png" data-orig-size="730,409" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Relationship between product and user models" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/product-user-models-hasura-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/product-user-models-hasura.png" decoding="async" class="aligncenter size-full wp-image-14245 jetpack-lazy-image" src="../Images/e70e4a427987753ac7e4af2ef9e99907.png" alt="Relationship Between Product and User Models" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/product-user-models-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/product-user-models-hasura-300x168.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/product-user-models-hasura.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/product-user-models-hasura.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14245" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/product-user-models-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/product-user-models-hasura.png" data-orig-size="730,409" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Relationship between product and user models" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/product-user-models-hasura-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/product-user-models-hasura.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14245" src="../Images/e70e4a427987753ac7e4af2ef9e99907.png" alt="Relationship Between Product and User Models" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/product-user-models-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/product-user-models-hasura-300x168.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/product-user-models-hasura.png"/></noscript>
<p>你可以在<a href="https://docs.hasura.io/1.0/graphql/manual/schema/relationships/index.html" target="_blank" rel="noopener noreferrer"> Hasura文档</a>中找到更多关于关系的信息。</p>
<p>现在让我们定义用户和产品模型之间的新关系。</p>
<ol>
<li>点击用户模型中的<strong>关系</strong>选项卡</li>
<li>点击<strong>下方的<strong>配置</strong>按钮手动添加新关系</strong></li>
<li>从<strong>关系类型</strong>下拉列表中选择<strong>阵列关系</strong></li>
<li>键入“产品”作为<strong>关系名称</strong></li>
<li>从<strong>参考模式</strong>下拉菜单中选择<strong>公共</strong></li>
<li>选择<strong>产品</strong>作为<strong>参照表</strong></li>
<li>从下拉菜单的<strong>中选择<strong> id </strong>，从<strong>到</strong>下拉菜单中选择<strong> maker_id </strong></strong></li>
</ol>
<p><img data-attachment-id="14258" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/user-product-models-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/user-product-models-hasura.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Relationship between User and Product models in Hasura" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/user-product-models-hasura-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/user-product-models-hasura.png" decoding="async" class="aligncenter size-full wp-image-14258 jetpack-lazy-image" src="../Images/1ab887f77ce238253b220c2a3aefde0f.png" alt="Relationship Between User and Product Models in Hasura" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/user-product-models-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/user-product-models-hasura-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/user-product-models-hasura.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/user-product-models-hasura.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14258" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/user-product-models-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/user-product-models-hasura.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Relationship between User and Product models in Hasura" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/user-product-models-hasura-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/user-product-models-hasura.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14258" src="../Images/1ab887f77ce238253b220c2a3aefde0f.png" alt="Relationship Between User and Product Models in Hasura" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/user-product-models-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/user-product-models-hasura-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/user-product-models-hasura.png"/></noscript>
<p>现在，如果我们访问<a href="http://localhost:9695/api-explorer" target="_blank" rel="noopener noreferrer"> Hasura GraphQL Explorer </a>，我们将能够使用GraphQL查询我们的产品。</p>
<p><img data-attachment-id="14226" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/fetching-products-data-graphiql-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/fetching-products-data-graphiql-hasura.png" data-orig-size="730,409" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Fetching product data using GraphiQL in Hasura" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/fetching-products-data-graphiql-hasura-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/fetching-products-data-graphiql-hasura.png" decoding="async" class="aligncenter size-full wp-image-14226 jetpack-lazy-image" src="../Images/ede8e2daf4602f2ea1b95c91d9772fd7.png" alt="Fetching Product Data Using GraphiQL in Hasura" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/fetching-products-data-graphiql-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/fetching-products-data-graphiql-hasura-300x168.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/fetching-products-data-graphiql-hasura.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/fetching-products-data-graphiql-hasura.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14226" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/fetching-products-data-graphiql-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/fetching-products-data-graphiql-hasura.png" data-orig-size="730,409" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Fetching product data using GraphiQL in Hasura" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/fetching-products-data-graphiql-hasura-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/fetching-products-data-graphiql-hasura.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14226" src="../Images/ede8e2daf4602f2ea1b95c91d9772fd7.png" alt="Fetching Product Data Using GraphiQL in Hasura" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/fetching-products-data-graphiql-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/fetching-products-data-graphiql-hasura-300x168.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/fetching-products-data-graphiql-hasura.png"/></noscript>
<h2 id="configuringnextjstofetchgraphqldatawithgraphqlhookshttpsgithubcomnearformgraphqlhooks">配置Next.js用GraphQL钩子获取GraphQL数据</h2>
<p>是时候配置我们的Next.js应用程序从后端应用程序获取数据了。我们将使用<a href="https://github.com/nearform/graphql-hooks" target="_blank" rel="noopener noreferrer"> GraphQL钩子</a>从后端应用程序获取数据。</p>
<p>为了安装依赖项，我们需要SSH到我们的前端容器。</p>
<pre>docker exec -it frontend_1 /bin/bash
</pre>
<p>一旦进入容器，我们可以使用下面的命令安装这个包。</p>
<pre>bash-4.4# yarn add graphql-hooks graphql-hooks-memcache graphql-hooks-ssr
</pre>
<p>由于我们将使用<a href="https://github.com/nearform/graphql-hooks#SSR" target="_blank" rel="noopener noreferrer"> SSR </a>，我们必须创建两个实用程序文件。</p>
<pre>// frontend/lib/with-graphql-client.js

import React from "react";
import initGraphQL from "./init-graphql";
import Head from "next/head";
import { getInitialState } from "graphql-hooks-ssr";

export default App =&gt; {
  return class GraphQLHooks extends React.Component {
    static displayName = "GraphQLHooks(App)";
    static async getInitialProps(ctx) {
      const { AppTree } = ctx;
      let appProps = {};
      if (App.getInitialProps) {
        appProps = await App.getInitialProps(ctx);
      }
      // Run all GraphQL queries in the component tree
      // and extract the resulting data
      const graphQLClient = initGraphQL();

      let graphQLState = {};

      if (typeof window === "undefined") {
        try {
          // Run all GraphQL queries
          graphQLState = await getInitialState({
            App: &lt;AppTree {...appProps} graphQLClient={graphQLClient} /&gt;,
            client: graphQLClient
          });
        } catch (error) {
          // Prevent GraphQL hooks client errors from crashing SSR.
          // Handle them in components via the state.error prop:
          // https://github.com/nearform/graphql-hooks#usequery
          console.error("Error while running `getInitialState`", error);
        }
        // getInitialState does not call componentWillUnmount
        // head side effect therefore need to be cleared manually
        Head.rewind();
      }

      return {
        ...appProps,
        graphQLState
      };
    }

    constructor(props) {
      super(props);
      this.graphQLClient = initGraphQL(props.graphQLState);
    }

    render() {
      return &lt;App {...this.props} graphQLClient={this.graphQLClient} /&gt;;
    }
  };
};


// frontend/lib/init-graphql.js

import { GraphQLClient } from "graphql-hooks";
import memCache from "graphql-hooks-memcache";
import unfetch from "isomorphic-unfetch";

let graphQLClient = null;

function create(initialState = {}) {
  return new GraphQLClient({
    ssrMode: typeof window === "undefined",
    url: "http://localhost:8080/v1/graphql",
    cache: memCache({ initialState }),
    fetch: typeof window !== "undefined" ? fetch.bind() : unfetch, // eslint-disable-line
    headers: {
      "x-hasura-admin-secret": "secret"
    }
  });
}

export default function initGraphQL(initialState) {
  // Make sure to create a new client for every server-side request so that data
  // isn't shared between connections (which would be bad)
  if (typeof window === "undefined") {
    return create(initialState);
  }
  // Reuse client on the client-side
  if (!graphQLClient) {
    graphQLClient = create(initialState);
  }

  return graphQLClient;
}
</pre>
<p>这两个文件出现在Next.js的<code><a href="https://github.com/zeit/next.js/tree/canary/examples/with-graphql-hooks" target="_blank" rel="noopener noreferrer">with-graphql-hooks</a></code>示例中。</p>
<p>我们现在需要更新我们的<code>_app.js</code>文件，因为我们需要用<code>withGraphQLClient</code> <a href="https://medium.com/javascript-scene/higher-order-functions-composing-software-5365cf2cbe99" target="_blank" rel="noopener noreferrer">高阶函数</a>包装我们的前端应用程序。</p>
<pre>// frontend/pages/_app.js

import React from "react";
import NextApp from "next/app";
import { ThemeProvider, CSSReset, theme } from "@chakra-ui/core";
import { ClientContext } from "graphql-hooks";

import withGraphQLClient from "../lib/with-graphql-client";

class App extends NextApp {
  render() {
    const { Component, pageProps, graphQLClient } = this.props;
    return (
      &lt;ThemeProvider theme={theme}&gt;
        &lt;CSSReset /&gt;
        &lt;ClientContext.Provider value={graphQLClient}&gt;
          &lt;Component {...pageProps} /&gt;
        &lt;/ClientContext.Provider&gt;
      &lt;/ThemeProvider&gt;
    );
  }
}
export default withGraphQLClient(App);
</pre>
<h2 id="showingproductsdatainthenextjsapplication">在Next.js应用程序中显示产品数据</h2>
<p>现在让我们更新我们的<code>ProductsList</code>组件，以显示我们数据库中的实际产品。</p>
<pre>// frontend/components/lists/products.js

import React from "react";
import { Text, Grid, Box, Spinner, Alert, AlertIcon } from "@chakra-ui/core";
import { useQuery } from "graphql-hooks";

export const allProductsQuery = `
  query {
    product {
      id
      name
      description
    }
  }
`;

const ProductsList = () =&gt; {
  const { loading, error, data } = useQuery(allProductsQuery, {
    skipCache: true
  });

  if (loading) {
    return (
      &lt;Box
        w="100%"
        minH="100vh"
        d="flex"
        alignItems="center"
        justifyContent="center"
      &gt;
        &lt;Spinner /&gt;
      &lt;/Box&gt;
    );
  }

  if (error) {
    return (
      &lt;Box
        w="100%"
        minH="100vh"
        d="flex"
        alignItems="center"
        justifyContent="center"
      &gt;
        &lt;Alert status="error" variant="left-accent"&gt;
          &lt;AlertIcon /&gt;
          There was an error processing your request
        &lt;/Alert&gt;
      &lt;/Box&gt;
    );
  }

  return (
    &lt;Box
      w="100%"
      minH="100vh"
      p={4}
      d="flex"
      alignItems="center"
      justifyContent="center"
    &gt;
      &lt;Box w="800px" p={8} bg="gray.50" borderRadius="sm"&gt;
        &lt;Grid
          templateColumns={[
            "repeat(1, 1fr)",
            "repeat(1, 1fr)",
            "repeat(2, 1fr)"
          ]}
          gap={8}
        &gt;
          {data.product.map(item =&gt; {
            return (
              &lt;Box
                key={item.id}
                w="100%"
                p={12}
                bg="#764ABC"
                rounded="md"
                color="white"
              &gt;
                &lt;Text fontSize="xl" fontWeight="semibold" lineHeight="short"&gt;
                  {item.name}
                &lt;/Text&gt;
                &lt;Text mt={2}&gt;{item.description}&lt;/Text&gt;
              &lt;/Box&gt;
            );
          })}
        &lt;/Grid&gt;
      &lt;/Box&gt;
    &lt;/Box&gt;
  );
};

export default ProductsList;
</pre>
<p>在做了这个更改之后，如果我们访问<a href="http://localhost:3000/products" rel="nofollow">http://localhost:3000/products</a>，我们应该能够从我们的后端看到实际的产品。</p>
<p><img data-attachment-id="14239" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/list-products-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/list-products-hasura.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="List of products from Hasura" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/list-products-hasura-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/list-products-hasura.png" decoding="async" class="aligncenter size-full wp-image-14239 jetpack-lazy-image" src="../Images/977d7d9f4a5a020bc755ad9de3b25ea0.png" alt="List of Products From Hasura" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/list-products-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/list-products-hasura-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/list-products-hasura.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/list-products-hasura.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14239" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/list-products-hasura/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/list-products-hasura.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="List of products from Hasura" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/list-products-hasura-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/list-products-hasura.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14239" src="../Images/977d7d9f4a5a020bc755ad9de3b25ea0.png" alt="List of Products From Hasura" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/list-products-hasura.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/list-products-hasura-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/list-products-hasura.png"/></noscript>
<h2 id="extendingthenextjsapplicationtoaddnewproducts">扩展Next.js应用程序以添加新产品</h2>
<p>在这个阶段，我们可以构建一个表单来添加新产品。</p>
<pre>// frontend/components/forms/add-new-product.js

import React, { useState } from "react";
import { Box, Button, FormControl, FormLabel, Input } from "@chakra-ui/core";
import { parseCookies } from "nookies";
import { useMutation } from "graphql-hooks";
import { withRouter } from "next/router";

export const insertProductMutation = `
  mutation ($name: bpchar!, $description: bpchar!, $maker_id: uuid!) {
    insert_product(objects: {description: $description, name: $name, maker_id: $maker_id}) {
      returning {
        id
        name
      }
    }
  }
`;

const AddNewProductForm = ({ router }) =&gt; {
  const [insertProduct] = useMutation(insertProductMutation);
  const [name, setName] = useState("");
  const [description, setDescription] = useState("");
  const maker_id = parseCookies()["X-Hasura-User-Id"];

  const handleSubmit = async e =&gt; {
    e.preventDefault();

    await insertProduct({
      variables: {
        name,
        description,
        maker_id
      }
    });
    setName("");
    setDescription("");
    router.push("/products");
  };

  return (
    &lt;Box
      w="100%"
      minH="100vh"
      p={4}
      d="flex"
      alignItems="center"
      justifyContent="center"
    &gt;
      &lt;Box w="500px" p={8} bg="gray.50" rounded="md"&gt;
        &lt;FormControl mb={8}&gt;
          &lt;FormLabel htmlFor="name"&gt;Name&lt;/FormLabel&gt;
          &lt;Input
            type="text"
            id="name"
            aria-describedby="john"
            value={name}
            onChange={e =&gt; setName(e.target.value)}
          /&gt;
        &lt;/FormControl&gt;
        &lt;FormControl mb={8}&gt;
          &lt;FormLabel htmlFor="description"&gt;Description&lt;/FormLabel&gt;
          &lt;Input
            type="text"
            id="description"
            aria-describedby="Description"
            value={description}
            onChange={e =&gt; setDescription(e.target.value)}
          /&gt;
        &lt;/FormControl&gt;
        &lt;FormControl&gt;
          &lt;Button bg="#764ABC" color="white" onClick={handleSubmit}&gt;
            Save
          &lt;/Button&gt;
        &lt;/FormControl&gt;
      &lt;/Box&gt;
    &lt;/Box&gt;
  );
};

export default withRouter(AddNewProductForm);
</pre>
<p>在上面的表单中，我们使用了<code>X-Hasura-User-Id</code> cookie来发送当前用户的id。</p>
<p>现在我们只需要在页面中导入这个表单。</p>
<pre>// frontend/pages/products/new.js

import React from "react";

import AddNewProductForm from "../../components/forms/add-new-product";

const CreateProductPage = () =&gt; {
  return &lt;AddNewProductForm /&gt;;
};

export default CreateProductPage;
</pre>
<p>如果我们访问<a href="http://localhost:3000/products/new" rel="nofollow">http://localhost:3000/products/new</a>，我们现在应该能够看到新的表单。</p>
<p><img data-attachment-id="14242" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/new-products-form/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/new-products-form.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Form to add new products" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/new-products-form-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/new-products-form.png" decoding="async" class="aligncenter size-full wp-image-14242 jetpack-lazy-image" src="../Images/6546752cd2da46c4df84c05ec0466fdc.png" alt="Form to Add New Products" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/new-products-form.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/new-products-form-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/new-products-form.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/new-products-form.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14242" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/new-products-form/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/new-products-form.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Form to add new products" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/new-products-form-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/new-products-form.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14242" src="../Images/6546752cd2da46c4df84c05ec0466fdc.png" alt="Form to Add New Products" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/new-products-form.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/new-products-form-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/new-products-form.png"/></noscript>
<p>我们还可以增加新产品。</p>
<p><img data-attachment-id="14221" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/adding-new-products/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/adding-new-products.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Adding new products" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/adding-new-products-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/adding-new-products.png" decoding="async" class="aligncenter size-full wp-image-14221 jetpack-lazy-image" src="../Images/ef9e34b01e346e80b7de5c13c502320c.png" alt="Adding New Products" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/adding-new-products.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/adding-new-products-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/adding-new-products.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/adding-new-products.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14221" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/adding-new-products/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/adding-new-products.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Adding new products" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/adding-new-products-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/adding-new-products.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14221" src="../Images/ef9e34b01e346e80b7de5c13c502320c.png" alt="Adding New Products" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/adding-new-products.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/adding-new-products-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/adding-new-products.png"/></noscript>
<p>此外，我们可以在ProductsList组件中查看新产品。</p>
<p><img data-attachment-id="14247" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/products-list/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Products list" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list.png" decoding="async" class="aligncenter size-full wp-image-14247 jetpack-lazy-image" src="../Images/cc1b1ad475cd85d922f827edf63732c3.png" alt="Products List" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/products-list-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14247" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/products-list/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list.png" data-orig-size="730,411" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Products list" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14247" src="../Images/cc1b1ad475cd85d922f827edf63732c3.png" alt="Products List" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/products-list-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/products-list.png"/></noscript>
<h2 id="extendingthenextjsapplicationtoeditproducts">扩展Next.js应用程序以编辑产品</h2>
<p>如果我们希望用户能够编辑产品呢？我们也可以为此创建一个表单。</p>
<pre>// frontend/components/forms/edit-product.js

import React, { useState, useEffect } from "react";
import {
  Box,
  Button,
  FormControl,
  FormLabel,
  Input,
  Spinner
} from "@chakra-ui/core";
import { useManualQuery, useMutation } from "graphql-hooks";
import { withRouter } from "next/router";

export const singleProductQuery = `
  query ($id: uuid!){
    product_by_pk (id: $id) {
      id
      name
      description
      created_at
    }
  }
`;

export const updateProductMutation = `
  mutation ($name: bpchar!, $description: bpchar!, $productId: uuid!) {
    update_product(where: {id: {_eq: $productId}}, _set: {name: $name, description: $description}) {
      returning {
        id
        name
        description
      }
    }
  }
`;

const EditProductForm = ({ router }) =&gt; {
  const [name, setName] = useState("");
  const [description, setDescription] = useState("");
  const [fetchProduct, { loading, error }] = useManualQuery(singleProductQuery);
  const [updateProduct] = useMutation(updateProductMutation);

  useEffect(() =&gt; {
    const fetchProductThenSomething = async () =&gt; {
      const product = await fetchProduct({
        skipCache: true,
        variables: {
          id: router.query.productId
        }
      });
      setName(product.data.product_by_pk.name);
      setDescription(product.data.product_by_pk.description);
    };
    fetchProductThenSomething();
  }, []);

  if (loading) {
    return (
      &lt;Box
        w="100%"
        minH="100vh"
        d="flex"
        alignItems="center"
        justifyContent="center"
      &gt;
        &lt;Spinner /&gt;
      &lt;/Box&gt;
    );
  }

  if (error) {
    return (
      &lt;Box
        w="100%"
        minH="100vh"
        d="flex"
        alignItems="center"
        justifyContent="center"
      &gt;
        &lt;Alert status="error" variant="left-accent"&gt;
          &lt;AlertIcon /&gt;
          There was an error processing your request
        &lt;/Alert&gt;
      &lt;/Box&gt;
    );
  }

  const handleSubmit = async e =&gt; {
    e.preventDefault();
    await updateProduct({
      variables: {
        name,
        description,
        productId: router.query.productId
      }
    });
  };

  return (
    &lt;Box
      w="100%"
      minH="100vh"
      p={4}
      d="flex"
      alignItems="center"
      justifyContent="center"
    &gt;
      &lt;Box w="500px" p={8} bg="gray.50" rounded="md"&gt;
        &lt;FormControl mb={8}&gt;
          &lt;FormLabel htmlFor="name"&gt;Name&lt;/FormLabel&gt;
          &lt;Input
            type="text"
            id="name"
            aria-describedby="john"
            value={name}
            onChange={e =&gt; setName(e.target.value)}
          /&gt;
        &lt;/FormControl&gt;
        &lt;FormControl mb={8}&gt;
          &lt;FormLabel htmlFor="description"&gt;Description&lt;/FormLabel&gt;
          &lt;Input
            type="text"
            id="description"
            aria-describedby="Description"
            value={description}
            onChange={e =&gt; setDescription(e.target.value)}
          /&gt;
        &lt;/FormControl&gt;
        &lt;FormControl&gt;
          &lt;Button bg="#764ABC" color="white" onClick={handleSubmit}&gt;
            Save
          &lt;/Button&gt;
        &lt;/FormControl&gt;
      &lt;/Box&gt;
    &lt;/Box&gt;
  );
};

export default withRouter(EditProductForm);
</pre>
<p>让我们在单独的页面中呈现该表单。</p>
<pre>// frontend/pages/products/[productId]/edit.js

import React from "react";

import EditProductForm from "../../../components/forms/edit-product";

const EditProductPage = () =&gt; {
  return &lt;EditProductForm /&gt;;
};

export default EditProductPage;
</pre>
<p>现在，如果我们访问任何产品页面(例如:<a href="http://localhost:3000/products/:productId/edit" rel="nofollow">http://localhost:3000/products/:Product id/edit</a>)，我们应该能够看到<code>EditProductForm</code>。</p>
<p><img data-attachment-id="14224" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/edit-product-form/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/edit-product-form.png" data-orig-size="730,409" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Form to edit a product" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/edit-product-form-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/edit-product-form.png" decoding="async" class="aligncenter size-full wp-image-14224 jetpack-lazy-image" src="../Images/39d0ed0dc8869991085c2f03711c2506.png" alt="Form to Edit a Product" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/edit-product-form.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/edit-product-form-300x168.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/edit-product-form.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/edit-product-form.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14224" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/edit-product-form/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/edit-product-form.png" data-orig-size="730,409" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Form to edit a product" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/edit-product-form-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/edit-product-form.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14224" src="../Images/39d0ed0dc8869991085c2f03711c2506.png" alt="Form to Edit a Product" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/edit-product-form.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/edit-product-form-300x168.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/edit-product-form.png"/></noscript>
<p>我们现在可以通过这个表单更新任何产品。</p>
<p>比方说，我们希望让制造商只更新他们创造的产品。为此，我们需要为<code>Product</code>模型定义定制权限。</p>
<p><img data-attachment-id="14223" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/custom-permission-update-product/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/custom-permission-update-product.png" data-orig-size="730,408" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Add custom permissions for updating products" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/custom-permission-update-product-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/custom-permission-update-product.png" decoding="async" class="aligncenter size-full wp-image-14223 jetpack-lazy-image" src="../Images/d42f88f122b08c7daacda5e7e0708cc2.png" alt="Add Custom Permissions for Updating Products" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/custom-permission-update-product.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/custom-permission-update-product-300x168.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/custom-permission-update-product.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/custom-permission-update-product.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14223" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/custom-permission-update-product/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/custom-permission-update-product.png" data-orig-size="730,408" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Add custom permissions for updating products" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/custom-permission-update-product-300x168.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/custom-permission-update-product.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14223" src="../Images/d42f88f122b08c7daacda5e7e0708cc2.png" alt="Add Custom Permissions for Updating Products" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/custom-permission-update-product.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/custom-permission-update-product-300x168.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/custom-permission-update-product.png"/></noscript>
<p>我们需要定义一个名为<code>user</code>的新角色。当<code>maker_id</code>等于<code>X-Hasura-User-Id</code>时，那么并且只有那时更新才被允许。</p>
<p>我们仍然需要对我们的Next.js应用程序进行一些修改，以允许制造商编辑他们创建的产品。我们只需要更新<code>SignInForm</code>和<code>SignUpForm</code>组件来存储<code>X-Hasura-User-Role</code> cookie。</p>
<pre>// frontend/components/forms/sign-in.js

const handleSubmit = async e =&gt; {
    e.preventDefault();

    ...      

    setCookie({}, "X-Hasura-User-Id", data.id, {
        maxAge: 30 * 24 * 60 * 60,
        path: "/"
      });

      setCookie({}, "token", data.token, {
        maxAge: 30 * 24 * 60 * 60,
        path: "/"
      });

      setCookie({}, "X-Hasura-User-Role", data.roles[0], {
        maxAge: 30 * 24 * 60 * 60,
        path: "/"
      });
    }
  };
</pre>
<p>我们还需要更新<code>init-graphql.js</code>文件中的<code>create</code>函数。</p>
<pre>// frontend/lib/init-graphql.js

function create(initialState = {}) {
  return new GraphQLClient({
    ssrMode: typeof window === "undefined",
    url: "http://localhost:8080/v1/graphql",
    cache: memCache({ initialState }),
    fetch: typeof window !== "undefined" ? fetch.bind() : unfetch, // eslint-disable-line
    headers: {
      "x-hasura-admin-secret": "secret",
      "x-hasura-role": parseCookies()["X-Hasura-User-Role"],
      "X-Hasura-User-Id": parseCookies()["X-Hasura-User-Id"]
    }
  });
}
</pre>
<p>如果我们再次登录，我们应该能够看到三个cookie:<code>X-Hasura-User-Id</code>、<code>X-Hasura-User-Role</code>和<code>token</code>。</p>
<p><img data-attachment-id="14254" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/storing-cookies-in-browser/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/storing-cookies-in-browser.png" data-orig-size="730,412" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Storing all necessary cookies in the browser" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/storing-cookies-in-browser-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/storing-cookies-in-browser.png" decoding="async" class="aligncenter size-full wp-image-14254 jetpack-lazy-image" src="../Images/7232d3e8e9bab5857fc1c9cda898d9f2.png" alt="Storing All Necessary Cookies in the Browser" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/storing-cookies-in-browser.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/storing-cookies-in-browser-300x169.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/02/storing-cookies-in-browser.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/storing-cookies-in-browser.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="14254" data-permalink="https://blog.logrocket.com/building-a-product-hunt-clone-app-using-hasura-and-next-js/attachment/storing-cookies-in-browser/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/02/storing-cookies-in-browser.png" data-orig-size="730,412" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Storing all necessary cookies in the browser" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/02/storing-cookies-in-browser-300x169.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/02/storing-cookies-in-browser.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-14254" src="../Images/7232d3e8e9bab5857fc1c9cda898d9f2.png" alt="Storing All Necessary Cookies in the Browser" srcset="https://blog.logrocket.com/wp-content/uploads/2020/02/storing-cookies-in-browser.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/02/storing-cookies-in-browser-300x169.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/02/storing-cookies-in-browser.png"/></noscript>
<p>如果用户访问任何产品页面，他们将只能更新他们创建的产品。</p>
<h2 id="conclusion">结论</h2>
<p>可以通过Hasura 使用GraphQL订阅。您还可以使用Hasura在数据库事件上<a href="https://hasura.io/event-triggers" target="_blank" rel="noopener noreferrer">触发webhooks。</a></p>
<p>现在你应该对如何在Next.js中使用Hasura有了基本的了解，整个项目可以在<a href="https://github.com/ghoshnirmalya/product-hunt-clone-using-nextjs-and-hasura" target="_blank" rel="noopener noreferrer"> GitHub </a>上找到供你参考。</p>
<p>请注意，我们构建的应用程序还没有准备好投入生产。有关部署Hasura应用程序的更多信息，请参见<a href="https://docs.hasura.io/1.0/graphql/manual/deployment/index.html" target="_blank" rel="noopener noreferrer"> Hasura文档</a>。同样，您可以在<a href="https://nextjs.org/learn/basics/deploying-a-nextjs-app" target="_blank" rel="noopener noreferrer"> Next.js文档</a>中阅读更多关于部署Next.js应用程序的信息。</p><div class="code-block code-block-30">
<div class="blog-plug inline-plug next-plug"><h2><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank"> LogRocket </a>:全面了解生产Next.js应用</h2><p>调试下一个应用程序可能会很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪状态、自动显示JavaScript错误、跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-lazy-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/></noscript></a><a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><p>LogRocket 就像是网络和移动应用的DVR，记录下你的Next.js应用上发生的一切。您可以汇总并报告问题发生时应用程序的状态，而不是猜测问题发生的原因。LogRocket还可以监控应用程序的性能，报告客户端CPU负载、客户端内存使用等指标。</p><p>LogRocket Redux中间件包为您的用户会话增加了一层额外的可见性。LogRocket记录Redux存储中的所有操作和状态。</p><p>让您调试Next.js应用的方式现代化— <a class="signup" href="https://lp.logrocket.com/blg/nextjs-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>