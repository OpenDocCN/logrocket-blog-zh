<html>
<head>
<title>React lifecycle methods: An approachable tutorial with examples - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>React lifecycle methods:一个带有示例的可接近的教程</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/#0001-01-01">https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/#0001-01-01</a></blockquote><div><article class="article-post">
<p><em> <strong>编者按</strong>:React 16.8中React钩子的<a href="https://blog.logrocket.com/introducing-react-16-8-featuring-official-support-for-hooks/" target="_blank" rel="noopener">引入使得本教程中描述的一些方法已经过时。要深入了解2021年如何处理React状态和生命周期特性，请查看我们的</a><a href="https://blog.logrocket.com/react-reference-guide-hooks-api/" target="_blank" rel="noopener"> React Hooks参考指南</a>和<a href="https://blog.logrocket.com/react-hooks-cheat-sheet-unlock-solutions-to-common-problems-af4caf699e70/" target="_blank" rel="noopener">备忘单</a>。</em></p>
<p>什么是React生命周期方法？简单地说，您可以将React组件生命周期视为组件的“生命周期”。生命周期方法是在React组件的诞生、成长和死亡过程中发生的一系列事件。</p>
<p>这个全面的指南旨在帮助你直观地理解什么是React生命周期方法，以及它们为什么有用。以下是我们将要介绍的内容:</p>

<p>为了直观地了解我们将在本教程中介绍的内容，下图说明了React组件生命周期的工作方式:</p>
<p><img data-attachment-id="46562" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/react-lifecycle-methods/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React lifecycle methods" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods.png" decoding="async" class="aligncenter size-full wp-image-46562 jetpack-lazy-image" src="../Images/4a000a6367bd977ed69c3d56b472d7e0.png" alt="React Lifecycle Methods" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods-300x193.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="46562" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/react-lifecycle-methods/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React lifecycle methods" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-46562" src="../Images/4a000a6367bd977ed69c3d56b472d7e0.png" alt="React Lifecycle Methods" srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods-300x193.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods.png"/></noscript>
<h2 id="whatisthereactcomponentlifecycle">什么是React组件生命周期？</h2>
<p>在React中，组件经历一个事件生命周期:</p>
<ol>
<li>挂载(向DOM添加节点)</li>
<li>更新(改变DOM中的现有节点)</li>
<li>卸载(从DOM中删除节点)</li>
<li>错误处理(验证您的代码工作正常并且没有错误)</li>
</ol>
<p>您可以将这些事件分别视为组件的诞生、成长和死亡。错误处理就像一年一度的体检。</p>
<p>让我们看一个简单的例子。如果我告诉您构建一个Hello World组件，您可能会编写如下内容:</p>
<pre>class HelloWorld extends React.Component {
   render() {
    return &lt;h1&gt; Hello World &lt;/h1&gt; 
   }
}</pre>
<p>当在客户端上呈现和查看该组件时，您可能会看到这样的视图:</p>
<p><img data-attachment-id="46565" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/react-lifecycle-hooks-example-hello-world-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-hooks-example-hello-world-1.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React lifecycle hooks: Hello World example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-hooks-example-hello-world-1-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-hooks-example-hello-world-1.png" decoding="async" class="aligncenter size-full wp-image-46565 jetpack-lazy-image" src="../Images/51e56171635726897afd61bcce27b261.png" alt="React Lifecycle Hooks: Hello World Example" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-hooks-example-hello-world-1.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-hooks-example-hello-world-1-300x193.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-hooks-example-hello-world-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-hooks-example-hello-world-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="46565" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/react-lifecycle-hooks-example-hello-world-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-hooks-example-hello-world-1.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React lifecycle hooks: Hello World example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-hooks-example-hello-world-1-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-hooks-example-hello-world-1.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-46565" src="../Images/51e56171635726897afd61bcce27b261.png" alt="React Lifecycle Hooks: Hello World Example" srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-hooks-example-hello-world-1.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-hooks-example-hello-world-1-300x193.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-hooks-example-hello-world-1.png"/></noscript>
<p>在渲染之前，组件将经历它的安装、更新和卸载阶段。让我们进一步分解一下。</p>
<p>安装一个组件就像把一个新生婴儿带到这个世界上。这是组件对生命的第一瞥。在这个阶段，由代码和React内部组成的组件被插入到DOM中。</p>
<p><span>在挂载阶段之后，React组件在更新阶段“增长”。如果没有更新，组件将保持它最初在DOM中创建时的样子。正如您所想象的，您编写的许多组件都需要更新，无论是通过<code>state</code>还是<code>props</code>的变化。因此，它们也要经历更新阶段。</span></p>
<p>最后一个阶段称为卸载阶段。在这个阶段，组件“死亡”。在React行话中，它被从DOM中移除。</p>
<p>React组件还可以经历一个阶段:错误处理阶段。当你的代码不能运行或者某处有错误时，就会发生这种情况。把它想象成年度体检。</p>
<p>下图显示了React生命周期:</p>
<p><img data-attachment-id="46572" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/react-lifecycle-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-diagram.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React lifecycle diagram" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-diagram-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-diagram.png" decoding="async" class="aligncenter size-full wp-image-46572 jetpack-lazy-image" src="../Images/f501162d26ce09fa07e08759bd4edd48.png" alt="React Lifecycle Diagram" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-diagram.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-diagram-300x193.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-diagram.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-diagram.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="46572" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/react-lifecycle-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-diagram.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React lifecycle diagram" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-diagram-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-diagram.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-46572" src="../Images/f501162d26ce09fa07e08759bd4edd48.png" alt="React Lifecycle Diagram" srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-diagram.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-diagram-300x193.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-diagram.png"/></noscript>
<p>请注意，React组件可能不会经历每个阶段。例如，一个组件可能在一分钟前被装载，然后在没有任何更新或错误处理的情况下被卸载。上面描述的图示和示例假设组件经历了所有四个阶段。</p>
<figure><a href="https://logrocket.com/signup/" target="_blank" rel="noopener noreferrer"><img decoding="async" src="../Images/94b3e0f84b30cb0d321f60471481ab64.png" data-height="750" data-width="3212" data-lazy-src="https://storage.googleapis.com/blog-images-backup/1*GPjaPKNNUYHU8EsA3Z0JGA.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://storage.googleapis.com/blog-images-backup/1*GPjaPKNNUYHU8EsA3Z0JGA.png"/><noscript><img data-lazy-fallback="1" decoding="async" src="../Images/94b3e0f84b30cb0d321f60471481ab64.png" data-height="750" data-width="3212" data-original-src="https://storage.googleapis.com/blog-images-backup/1*GPjaPKNNUYHU8EsA3Z0JGA.png"/></noscript></a></figure>
<h2 id="whatarereactlifecyclemethods">什么是React生命周期方法？</h2>
<p>每个React生命周期阶段都有许多生命周期方法，您可以覆盖这些方法，以便在流程中的指定时间运行代码。这些通常被称为组件生命周期方法。</p>
<p>下图显示了与安装、更新、卸载和错误生命周期阶段相关的React生命周期方法:</p>
<p><img data-attachment-id="46588" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/react-lifecycle-methods-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods-diagram.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React lifecycle methods diagram" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods-diagram-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods-diagram.png" decoding="async" class="aligncenter size-full wp-image-46588 jetpack-lazy-image" src="../Images/19adfef78a50c26d3eca1e76f30f869d.png" alt="React Lifecycle Methods Diagram" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods-diagram.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods-diagram-300x193.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods-diagram.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods-diagram.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="46588" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/react-lifecycle-methods-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods-diagram.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React lifecycle methods diagram" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods-diagram-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods-diagram.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-46588" src="../Images/19adfef78a50c26d3eca1e76f30f869d.png" alt="React Lifecycle Methods Diagram" srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods-diagram.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods-diagram-300x193.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/react-lifecycle-methods-diagram.png"/></noscript>
<h2 id="mounting">安装生命周期方法</h2>
<p>挂载阶段是指创建组件并将其插入DOM的阶段。</p>
<p>按顺序调用以下方法。</p>
<h3 id="constructor">1.<code>constructor()</code></h3>
<p><code>constructor()</code>是组件被“赋予生命”时调用的第一个方法</p>
<p>在组件安装到DOM之前，调用构造函数方法。在大多数情况下，您会在构造函数方法中初始化状态和绑定事件处理程序方法。</p>
<p>下面是<code>constructor()</code> React生命周期方法的一个简单例子:</p>
<pre>const MyComponent extends React.Component {
  constructor(props) {
   super(props) 
    this.state = {
       points: 0
    }  
    this.handlePoints = this.handlePoints.bind(this) 
    }   
}</pre>
<p>值得重申的是<span>这是组件挂载到DOM之前调用的</span> <span>的第一个方法。构造函数不是你引入任何副作用或订阅的地方，比如事件处理程序。</span></p>
<h3 id="staticgetDerivedStateFromProps">2.<code>static getDerivedStateFromProps()</code></h3>
<p><code>static getDerivedStateFromProps</code>是从<a href="https://medium.com/@valerii.sukhov/react-17-lifecycle-5b68946c813c" target="_blank" rel="noopener"> React 17 </a>开始的新React生命周期方法，旨在取代<code>componentWillReceiveProps</code>。</p>
<p>它的主要功能是确保状态和道具在需要的时候保持同步。</p>
<p><code>static getDerivedStateFromProps()</code>的基本结构看起来是这样的:</p>
<pre>const MyComponent extends React.Component {
  ... 

  static getDerivedStateFromProps() {
<em>//do stuff here</em>
  }  
}</pre>
<p><code>static getDerivedStateFromProps()</code>收<code>props</code>和<code>state</code>:</p>
<pre>... 

  static getDerivedStateFromProps(props, state) {
<em>//do stuff here</em>
  }  

...</pre>
<p>您可以返回一个对象来更新组件的状态:</p>
<pre>... 

  static getDerivedStateFromProps(props, state) { 
     return {
        points: 200 <em>// update state with this</em>
     }
  }  

  ...</pre>
<p>或者您可以返回null不进行更新:</p>
<pre>... 

  static getDerivedStateFromProps(props, state) {
    return null
  }  

...</pre>
<p>这种生命周期方法到底为什么重要？虽然<code>static getDerivedStateFromProps()</code>是一种很少使用的生命周期方法，但它在某些情况下会派上用场。</p>
<p>请记住，这个方法是在组件初次挂载到DOM之前调用的。</p>
<p>这里有一个简单的例子，这样您就可以看到<code>static getDerivedStateFromProps()</code>方法的实际应用。考虑一个呈现足球队得分的简单组件。如您所料，点数存储在组件状态对象中:</p>
<pre>class App extends Component {
  state = {
    points: 10
  }

  render() {
    return (
      &lt;div className="App"&gt;
        &lt;header className="App-header"&gt;
          &lt;img src={logo} className="App-logo" alt="logo" /&gt;
          &lt;p&gt;
            You've scored {this.state.points} points.
          &lt;/p&gt;
        &lt;/header&gt;
      &lt;/div&gt;
    );
  }
}</pre>
<p>结果如下:</p>
<p><img data-attachment-id="46590" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/static-getderivedstatefromprops-react-lifecycle-method-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-method-example.png" data-orig-size="720,501" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="static getDerivedStateFromProps() example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-method-example-300x209.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-method-example.png" decoding="async" class="aligncenter size-full wp-image-46590 jetpack-lazy-image" src="../Images/aa278b1d2235c22a9c5d8924ad32cd56.png" alt="static getDerivedStateFromProps() Example" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-method-example.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-method-example-300x209.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-method-example.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-method-example.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="46590" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/static-getderivedstatefromprops-react-lifecycle-method-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-method-example.png" data-orig-size="720,501" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="static getDerivedStateFromProps() example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-method-example-300x209.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-method-example.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-46590" src="../Images/aa278b1d2235c22a9c5d8924ad32cd56.png" alt="static getDerivedStateFromProps() Example" srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-method-example.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-method-example-300x209.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-method-example.png"/></noscript>
<figure class="wp-caption"><figcaption class="wp-caption-text">The source code is available on <a href="https://github.com/ohansemmanuel/points" target="_blank" rel="noopener noreferrer">Github</a>.</figcaption></figure>
<p>文本显示，“您得了10分”，其中10是状态对象中的点数。</p>
<p>让我们看另一个例子。如果你输入如下所示的<code>static getDerivedStateFromProps</code>方法，会呈现多少个点？</p>
<pre>class App extends Component {
  state = {
    points: 10
  }
    
  // *******
  //  NB: Not the recommended way to use this method. Just an example. Unconditionally overriding state here is generally considered a bad idea
  // ********
  static getDerivedStateFromProps(props, state) {
    return {
      points: 1000
    }
  }
  
  render() {
    return (
      &lt;div className="App"&gt;
        &lt;header className="App-header"&gt;
          &lt;img src={logo} className="App-logo" alt="logo" /&gt;
          &lt;p&gt;
            You've scored {this.state.points} points.
          &lt;/p&gt;
        &lt;/header&gt;
      &lt;/div&gt;
    );
  }
}</pre>
<p>现在，我们有<code>static getDerivedStateFromProps</code>组件生命周期方法。如果您还记得前面的解释，这个方法是在组件挂载到DOM之前调用的。通过返回一个对象，我们甚至在组件呈现之前就更新了它的状态。</p>
<p>以下是我们得到的结果:</p>
<p><img data-attachment-id="46592" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/static-getderivedstatefromprops-react-lifecycle-example-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-example-2.png" data-orig-size="720,585" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="static getDerivedStateFromProps() example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-example-2-300x244.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-example-2.png" decoding="async" class="aligncenter size-full wp-image-46592 jetpack-lazy-image" src="../Images/25db85774cf2f781285986951a0c8be7.png" alt="static getDerivedStateFromProps() Example" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-example-2.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-example-2-300x244.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-example-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-example-2.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="46592" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/static-getderivedstatefromprops-react-lifecycle-example-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-example-2.png" data-orig-size="720,585" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="static getDerivedStateFromProps() example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-example-2-300x244.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-example-2.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-46592" src="../Images/25db85774cf2f781285986951a0c8be7.png" alt="static getDerivedStateFromProps() Example" srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-example-2.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-example-2-300x244.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-react-lifecycle-example-2.png"/></noscript>
<p><code>1000</code>来自于在<code>static getDerivedStateFromProps</code>方法中更新状态。</p>
<p>这个例子是人为设计的，并不真正代表您使用<code>static getDerivedStateFromProps</code>方法的方式。不过我觉得对理解基础还是有帮助的。</p>
<p>使用这种生命周期方法，仅仅因为您可以更新状态并不意味着您应该更新。<code>static getDerivedStateFromProps</code>方法有特定的用例。如果你在错误的环境中使用它，你将会用错误的工具解决问题。</p>
<p>那么什么时候应该使用<code>static getDerivedStateFromProps</code>生命周期方法呢？</p>
<p>方法名<code>getDerivedStateFromProps</code>由五个词组成:从props获得派生状态。本质上，<code>static getDerivedStateFromProps</code>允许一个组件更新它的内部状态来响应属性的变化。</p>
<p><img data-attachment-id="46594" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/static-getderivedstatefromprops-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-diagram.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="static getDerivedStateFromProps diagram" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-diagram-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-diagram.png" decoding="async" class="aligncenter size-full wp-image-46594 jetpack-lazy-image" src="../Images/1c96201b8c68851f8cb67e49c031ea2a.png" alt="static getDerivedStateFromProps Diagram" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-diagram.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-diagram-300x193.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-diagram.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-diagram.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="46594" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/static-getderivedstatefromprops-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-diagram.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="static getDerivedStateFromProps diagram" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-diagram-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-diagram.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-46594" src="../Images/1c96201b8c68851f8cb67e49c031ea2a.png" alt="static getDerivedStateFromProps Diagram" srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-diagram.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-diagram-300x193.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/static-getDerivedStateFromProps-diagram.png"/></noscript>
<p>以这种方式的组件状态被称为<a href="https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#when-to-use-derived-state" target="_blank" rel="noopener">派生状态</a>。</p>
<p>根据经验，派生状态应该谨慎使用，因为如果你不确定自己在做什么，你可能会将<a href="https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#common-bugs-when-using-derived-state" target="_blank" rel="noopener noreferrer">微妙的错误</a>引入到你的应用程序中。</p>
<h3 id="render1">3.<code>render()</code></h3>
<p>在调用了<code>static getDerivedStateFromProps</code>方法之后，下一个生命周期方法是<code>render</code>方法:</p>
<pre>class MyComponent extends React.Component {
<em>// render is the only required method for a class component</em> 
   render() {
    return <strong>&lt;h1&gt; Hurray! &lt;/h1&gt;</strong>
   }
}</pre>
<p>如果您想要将元素呈现到DOM中，例如，返回一些<code>JSX</code>，<code>render</code>方法是您应该编写这些内容的地方(如上所示)。</p>
<div class="section-inner sectionLayout--insetColumn">
<p id="4037" class="graf graf--p graf-after--p">您也可以返回普通字符串和数字，如下所示:</p>
<pre>class MyComponent extends React.Component {
   render() {
    return <strong class="markup--strong markup--pre-strong">"Hurray" </strong>
   }
}</pre>
<p id="fde3" class="graf graf--p graf-after--pre">或者，您可以返回数组和片段:</p>
<pre>class MyComponent extends React.Component {
   render() {
    return <strong class="markup--strong markup--pre-strong">[</strong>
          &lt;div key="1"&gt;Hello&lt;/div&gt;,
          &lt;div key="2" &gt;World&lt;/div&gt;
      <strong class="markup--strong markup--pre-strong">]</strong>;
   }
}</pre>
<pre>class MyComponent extends React.Component {
   render() {
    return <strong class="markup--strong markup--pre-strong">&lt;React.Fragment&gt;</strong>
            &lt;div&gt;Hello&lt;/div&gt;
            &lt;div&gt;World&lt;/div&gt;
      <strong class="markup--strong markup--pre-strong">&lt;/React.Fragment&gt;</strong>
   }
}</pre>
<p id="c876" class="graf graf--p graf-after--pre">如果您不想呈现任何内容，可以在render方法中返回一个布尔值or <code>null</code>:</p>
<pre>class MyComponent extends React.Component { 
   render() {
    return null
   }
}

class MyComponent extends React.Component {
  // guess what's returned here? 
  render() {
    return (2 + 2 === 5) &amp;&amp; &lt;div&gt;Hello World&lt;/div&gt;;
   }
}</pre>
<p>最后，您可以从render方法返回一个<a class="markup--anchor markup--p-anchor" title="React Portals" href="https://reactjs.org/docs/portals.html" target="_blank" rel="noopener noreferrer" data-href="https://reactjs.org/docs/portals.html">门户</a>:</p>
<pre>class MyComponent extends React.Component {
  render() {
    return <strong class="markup--strong markup--pre-strong">createPortal</strong>(this.props.children, document.querySelector("body"));
  }
}</pre>
<p id="2de4" class="graf graf--p graf-after--pre">关于渲染方法需要注意的一件重要事情是渲染函数应该是纯的，即不要试图使用<code>setState</code>或与外部API交互。</p>
<h3 id="componentDidMount" class="graf graf--h4 graf-after--p">4.<code>componentDidMount()</code></h3>
<p id="bb2f" class="graf graf--p graf-after--h4">在调用了<code>render</code>之后，组件被挂载到DOM，并且调用了<code>componentDidMount</code>方法。</p>
<p id="ed1d" class="graf graf--p graf-after--p">这个函数在组件被挂载到DOM后立即被调用。</p>
<p id="9007" class="graf graf--p graf-after--p">您可以使用<code>componentDidMount</code>生命周期方法在DOM节点挂载后立即从组件树中获取它。</p>
<p>例如，假设您有一个模型，并希望在特定的DOM元素中呈现该模型的内容:</p>
<pre>class ModalContent extends React.Component {

  el = document.createElement("section");

  componentDidMount() {
    document.querySelector("body).appendChild(this.el);
  }
  
  // using a portal, the content of the modal will be rendered in the DOM element attached to the DOM in the componentDidMount method. 

}
</pre>
<p>如果您还想在组件安装到DOM后立即发出网络请求，这是一个很好的地方:</p>
<pre>componentDidMount() {
  this.fetchListOfTweets() // where fetchListOfTweets initiates a netowrk request to fetch a certain list of tweets.
}</pre>
<p id="83a7" class="graf graf--p graf-after--pre">您也可以设置订阅，如计时器。这里有一个例子:</p>
<pre>// e.g requestAnimationFrame 
componentDidMount() {
    window.requestAnimationFrame(this._updateCountdown);
 }

// e.g event listeners 
componentDidMount() {
    el.addEventListener()
}</pre>
<p>只是确保在组件卸载时取消订阅。当我们讨论<code>componentWillUnmount</code>生命周期方法时，我将向您展示如何做到这一点。</p>
<h2 id="updating" class="graf graf--h3 graf-after--p">更新生命周期方法</h2>
<p id="5db5" class="graf graf--p graf-after--h3">每当React组件的<code>state</code>或<code>props</code>发生变化时，组件就会被重新渲染。简而言之，组件被更新。这是React组件生命周期的更新阶段。</p>
<p id="8634" class="graf graf--p graf-after--p">那么，当组件要被更新时，调用什么生命周期方法呢？</p>
<h3 id="staticgetDerivedStateFromProps2” class=">1.<code>static getDerivedStateFromProps()</code></h3>
<p id="0bea" class="graf graf--p graf-after--h4"><code>static getDerivedStateFromProps</code>是在更新阶段调用的第一个React生命周期方法。我已经在挂载阶段解释了这个方法，所以我将跳过它。</p>
<p id="4bbb" class="graf graf--p graf-after--p">在回顾安装生命周期阶段时，我们已经解释了这种方法。需要注意的是，在安装和更新阶段都会调用这个方法。</p>
<h3 id="shouldcomponentupdate" class="graf graf--h4 graf-after--p">2.<code>shouldComponentUpdate()</code></h3>
<p id="7f2d" class="graf graf--p graf-after--h4">一旦调用了<code>static getDerivedStateFromProps</code>方法，接下来就会调用<code>shouldComponentUpdate</code>方法。</p>
<p id="4ffb" class="graf graf--p graf-after--p">在大多数情况下，当状态或道具改变时，您会希望组件重新呈现。但是，您可以控制这种行为。</p>
<p><img data-attachment-id="46601" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/shouldcomponendupdate-react-lifecycle-method-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/shouldcomponendupdate-react-lifecycle-method-example.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="shouldComponentUpdate() React lifecycle method example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/shouldcomponendupdate-react-lifecycle-method-example-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/shouldcomponendupdate-react-lifecycle-method-example.png" decoding="async" class="aligncenter size-full wp-image-46601 jetpack-lazy-image" src="../Images/805db0af98ceff358d0912a86025a6d5.png" alt="shouldComponentUpdate() React Lifecycle Method Example" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/shouldcomponendupdate-react-lifecycle-method-example.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/shouldcomponendupdate-react-lifecycle-method-example-300x193.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/01/shouldcomponendupdate-react-lifecycle-method-example.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/shouldcomponendupdate-react-lifecycle-method-example.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="46601" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/shouldcomponendupdate-react-lifecycle-method-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/shouldcomponendupdate-react-lifecycle-method-example.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="shouldComponentUpdate() React lifecycle method example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/shouldcomponendupdate-react-lifecycle-method-example-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/shouldcomponendupdate-react-lifecycle-method-example.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-46601" src="../Images/805db0af98ceff358d0912a86025a6d5.png" alt="shouldComponentUpdate() React Lifecycle Method Example" srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/shouldcomponendupdate-react-lifecycle-method-example.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/shouldcomponendupdate-react-lifecycle-method-example-300x193.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/shouldcomponendupdate-react-lifecycle-method-example.png"/></noscript>
<p id="a797" class="graf graf--p graf-after--figure">在这个生命周期方法中，您可以返回一个布尔值— <code>true</code>或<code>false</code> —并控制组件是否被重新呈现(例如，在状态或属性发生变化时)。</p>
<p id="43b5" class="graf graf--p graf-after--p">这种生命周期方法主要用于性能优化措施。然而，这是一个非常常见的用例，所以如果<code>state</code>和<code>props</code>没有改变，当你不希望组件重新呈现时，你可以使用内置的<a class="markup--anchor markup--p-anchor" href="https://reactjs.org/docs/react-api.html#reactpurecomponent" target="_blank" rel="noopener noreferrer" data-href="https://reactjs.org/docs/react-api.html#reactpurecomponent"> <code>React.PureComponent</code> </a>。</p>
<h3 id="render2" class="graf graf--h4 graf-after--p">3.<code>render()</code></h3>
<p id="68e4" class="graf graf--p graf-after--h4">在调用了<code>shouldComponentUpdate</code>方法之后，根据<code>shouldComponentUpdate</code>返回的值，会立即调用<code>render</code>，默认为<code>true</code>。</p>
<h3 id="getSnapshotBeforeUpdate" class="graf graf--h4 graf-after--p">4.<code>getSnapshotBeforeUpdate()</code></h3>
<p id="ce89" class="graf graf--p graf-after--h4"><a href="https://blog.logrocket.com/how-is-getsnapshotbeforeupdate-implemented-with-hooks/" target="_blank" rel="noopener"> <code>getSnapshotBeforeUpdate</code>生命周期方法</a>存储DOM更新后状态的先前值。<code>getSnapshotBeforeUpdate()</code>紧接在<code>render</code>之后被调用。</p>
<p id="76c4" class="graf graf--p graf-after--p">最有可能的是，你很少会接触到这种生命周期方法。但是，当您需要在更新完成后从DOM获取信息(并可能更改它)时，它就派上了用场。</p>
<p id="48e2" class="graf graf--p graf-after--p">重要的是:<code>getSnapshotBeforeUpdate</code>中从DOM查询的值指的是DOM更新之前的值，即使之前调用了<code>render</code>方法。</p>
<p id="55c2" class="graf graf--p graf-after--p">想想你如何使用版本控制系统，比如<a href="https://git-scm.com/" target="_blank" rel="noopener"> Git </a>。一个基本的例子是，您编写代码并在提交给回购之前准备好您的更改。</p>
<p id="64a7" class="graf graf--p graf-after--p">让我们假设在实际推送到DOM之前调用了render函数来暂存您的更改。在实际DOM更新之前，从<code>getSnapshotBeforeUpdate</code>检索的信息指的是实际可视DOM更新之前的信息。</p>
<p id="e124" class="graf graf--p graf-after--p">对DOM的实际更新可能是异步的，但是在DOM更新之前总是立即调用<code>getSnapshotBeforeUpdate</code>生命周期方法。</p>
<p id="a3a7" class="graf graf--p graf-after--p">这是一个棘手的方法，所以让我们看另一个例子。</p>
<p id="b2b2" class="graf graf--p graf-after--p">生命周期方法派上用场的一个经典案例是在聊天应用程序中。我在前面的示例应用程序中添加了一个聊天窗格:</p>
<p><img data-attachment-id="46608" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/getsnapshotbeforeupdate-react-lifecycle-methods-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-react-lifecycle-methods-example.png" data-orig-size="720,381" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="getSnapshotBeforeUpdate React lifecycle method example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-react-lifecycle-methods-example-300x159.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-react-lifecycle-methods-example.png" decoding="async" class="aligncenter size-full wp-image-46608 jetpack-lazy-image" src="../Images/b95ede800921e5b3504d326b8aed5873.png" alt="getSnapshotBeforeUpdate React Lifecycle Method Example" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-react-lifecycle-methods-example.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-react-lifecycle-methods-example-300x159.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-react-lifecycle-methods-example.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-react-lifecycle-methods-example.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="46608" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/getsnapshotbeforeupdate-react-lifecycle-methods-example/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-react-lifecycle-methods-example.png" data-orig-size="720,381" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="getSnapshotBeforeUpdate React lifecycle method example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-react-lifecycle-methods-example-300x159.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-react-lifecycle-methods-example.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-46608" src="../Images/b95ede800921e5b3504d326b8aed5873.png" alt="getSnapshotBeforeUpdate React Lifecycle Method Example" srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-react-lifecycle-methods-example.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-react-lifecycle-methods-example-300x159.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-react-lifecycle-methods-example.png"/></noscript>
<p id="ddfa" class="graf graf--p graf-after--figure">聊天窗格的实现就像它看起来一样简单。在<code>App</code>组件中是一个无序列表，带有一个<code>Chats</code>组件:</p>
<pre>&lt;ul className="chat-thread"&gt;
    &lt;Chats chatList={this.state.chatList} /&gt;
 &lt;/ul&gt;</pre>
<p id="7cdb" class="graf graf--p graf-after--pre"><code>Chats</code>组件呈现聊天列表，为此，它需要一个<code>chatList</code>道具。这基本上是一个数组。在本例中，一个由3个字符串值组成的数组，<code>["Hey", "Hello", "Hi"]</code>。</p>
<p id="dc73" class="graf graf--p graf-after--p">组件有一个简单的实现，如下所示:</p>
<pre>class Chats extends Component {
  render() {
    return (
      &lt;React.Fragment&gt;
        {this.props.chatList.map((chat, i) =&gt; (
          &lt;li key={i} className="chat-bubble"&gt;
            {chat}
          &lt;/li&gt;
        ))}
      &lt;/React.Fragment&gt;
    );
  }
}</pre>
<p id="51a5" class="graf graf--p graf-after--pre">它只是通过<code>chatList</code> prop映射并呈现一个列表项，该列表项又被设计成看起来像一个聊天气泡:)。</p>
<p id="548a" class="graf graf--p graf-after--p">聊天窗格标题中有一个<strong>添加聊天</strong>按钮:</p>
<p><img data-attachment-id="46610" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/getsnapshotbeforeupdate-button/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-button.png" data-orig-size="720,381" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="getSnapshotBeforeUpdate example with button" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-button-300x159.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-button.png" decoding="async" class="aligncenter size-full wp-image-46610 jetpack-lazy-image" src="../Images/e58285b684ae147eac09bc27c9adf28f.png" alt="getSnapshotBeforeUpdate Example With Button" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-button.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-button-300x159.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-button.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-button.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="46610" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/getsnapshotbeforeupdate-button/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-button.png" data-orig-size="720,381" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="getSnapshotBeforeUpdate example with button" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-button-300x159.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-button.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-46610" src="../Images/e58285b684ae147eac09bc27c9adf28f.png" alt="getSnapshotBeforeUpdate Example With Button" srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-button.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-button-300x159.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-button.png"/></noscript>
<p id="e72e" class="graf graf--p graf-after--figure">点击此按钮将在显示的消息列表中添加新的聊天文本“Hello”。</p>
<p id="fabb" class="graf graf--p graf-after--p">这就是实际情况:</p>
<p><img data-attachment-id="46612" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/getsnapshotbeforeupdate-chat-messages/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-chat-messages.gif" data-orig-size="720,395" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="getSnapshotBeforeUpdate example with chat" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-chat-messages-300x165.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-chat-messages.gif" decoding="async" class="aligncenter size-full wp-image-46612 jetpack-lazy-image" src="../Images/93e77c97034961a72835f6592048ad2f.png" alt="getSnapshotBeforeUpdate Example With Chat" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-chat-messages.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-chat-messages.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="46612" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/getsnapshotbeforeupdate-chat-messages/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-chat-messages.gif" data-orig-size="720,395" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="getSnapshotBeforeUpdate example with chat" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-chat-messages-300x165.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-chat-messages.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-46612" src="../Images/93e77c97034961a72835f6592048ad2f.png" alt="getSnapshotBeforeUpdate Example With Chat" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-chat-messages.gif"/></noscript>
<p id="d79e" class="graf graf--p graf-after--figure">与大多数聊天应用程序一样，这里的问题是每当聊天消息的数量超过聊天窗口的可用高度时，预期的行为是自动向下滚动聊天窗格，以便可以看到最新的聊天消息。现在不是这样了:</p>
<p><img data-attachment-id="46613" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/getsnapshotbeforeupdate-scroll/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-scroll.gif" data-orig-size="720,395" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="getSnapshotBeforeUpdate example with scroll behavior" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-scroll-300x165.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-scroll.gif" decoding="async" class="aligncenter size-full wp-image-46613 jetpack-lazy-image" src="../Images/aa668e839c7bc5b49d2f95bee9abbad8.png" alt="getSnapshotBeforeUpdate Example With Scroll Behavior" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-scroll.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-scroll.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="46613" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/getsnapshotbeforeupdate-scroll/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-scroll.gif" data-orig-size="720,395" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="getSnapshotBeforeUpdate example with scroll behavior" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-scroll-300x165.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-scroll.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-46613" src="../Images/aa668e839c7bc5b49d2f95bee9abbad8.png" alt="getSnapshotBeforeUpdate Example With Scroll Behavior" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/getSnapshotBeforeUpdate-scroll.gif"/></noscript>
<p id="e27d" class="graf graf--p graf-after--figure">让我们看看如何使用<code>getSnapshotBeforeUpdate</code>生命周期方法来解决这个问题。</p>
<p id="6be0" class="graf graf--p graf-after--p"><code>getSnapshotBeforeUpdate</code>生命周期方法的工作方式是，当它被调用时，它将前面的属性和状态作为参数传递给它。</p>
<p id="68e6" class="graf graf--p graf-after--p">所以我们可以使用如下所示的<code>prevProps</code>和<code>prevState</code>参数:</p>
<pre>getSnapshotBeforeUpdate(prevProps, prevState) {
   
}</pre>
<p id="7fd3" class="graf graf--p graf-after--pre">在这个方法中，您应该返回一个值或<code>null</code>:</p>
<pre>getSnapshotBeforeUpdate(prevProps, prevState) {
   return value || null // where 'value' is a  valid JavaScript value    
}</pre>
<p id="99c1" class="graf graf--p graf-after--pre">这里返回的任何值都会被传递给另一个生命周期方法。你很快就会明白我的意思。</p>
<p id="f03a" class="graf graf--p graf-after--p"><code>getSnapshotBeforeUpdate</code> React生命周期方法本身并不工作。它旨在与<code>componentDidUpdate</code>生命周期方法结合使用。</p>
<h3 id="componentDidUpdate" class="graf graf--h4 graf-after--p">5.<code>componentDidUpdate()</code></h3>
<p id="feeb" class="graf graf--p graf-after--h4">在<code>getSnapshotBeforeUpdate</code>之后调用<code>componentDidUpdate</code>生命周期方法。与<code>getSnapshotBeforeUpdate</code>方法一样，它接收前面的属性和状态作为参数:</p>
<pre>componentDidUpdate(prevProps, prevState) {
 
}</pre>
<p id="158d" class="graf graf--p graf-after--pre">然而，这还不是全部。</p>
<p id="3101" class="graf graf--p graf-after--p">无论从<code>getSnapshotBeforeUpdate</code>生命周期方法返回什么值，都作为第三个参数传递给<code>componentDidUpdate</code>方法。</p>
<p id="1824" class="graf graf--p graf-after--p">让我们调用从<code>getSnapshotBeforeUpdate</code>，snapshot返回的值，下面是我们之后得到的结果:</p>
<pre>componentDidUpdate(prevProps, prevState, snapshot) {
 
}</pre>
<p id="c7d7" class="graf graf--p graf-after--pre">有了这些知识，我们来解决聊天自动滚动位置的问题。</p>
<p id="e2db" class="graf graf--p graf-after--p">为了解决这个问题，我需要提醒(或教)你一些DOM几何。所以请容忍我。</p>
<p id="c476" class="graf graf--p graf-after--p">同时，下面是在聊天窗格中保持滚动位置所需的所有代码:</p>
<pre>getSnapshotBeforeUpdate(prevProps, prevState) {
    if (this.state.chatList &gt; prevState.chatList) {
      const chatThreadRef = this.chatThreadRef.current;
      return chatThreadRef.scrollHeight - chatThreadRef.scrollTop;
    }
    return null;
  }

  componentDidUpdate(prevProps, prevState, snapshot) {
    if (snapshot !== null) {
      const chatThreadRef = this.chatThreadRef.current;
      chatThreadRef.scrollTop = chatThreadRef.scrollHeight - snapshot;
    }
  }</pre>
<p id="5084" class="graf graf--p graf-after--pre">这是聊天窗口:</p>
<figure id="6f97" class="graf graf--figure graf-after--p">

</figure>
<p id="c7ab" class="graf graf--p graf-after--figure">但是，下图突出显示了保存聊天消息的实际区域(无序列表，<code>ul</code>包含消息):</p>
<figure id="6cf4" class="graf graf--figure graf-after--p">

</figure>
<p id="4eaf" class="graf graf--p graf-after--figure">正是这个<code>ul</code>我们引用了React Ref。</p>
<pre>&lt;ul className="chat-thread" ref={this.chatThreadRef}&gt;
   ...
&lt;/ul&gt;</pre>
<p id="b1d9" class="graf graf--p graf-after--pre">首先，因为<code>getSnapshotBeforeUpdate</code>可能通过任意数量的props或者甚至是状态更新而被触发，所以我们在一个条件中包装代码来检查是否确实有新的聊天消息:</p>
<pre>getSnapshotBeforeUpdate(prevProps, prevState) {
    if (this.state.chatList &gt; prevState.chatList) {
      // write logic here
    }
    
  }</pre>
<p id="bc75" class="graf graf--p graf-after--pre"><code>getSnapshotBeforeUpdate</code>必须返回一个值。如果没有添加聊天消息，我们将只返回<code>null</code>:</p>
<pre>getSnapshotBeforeUpdate(prevProps, prevState) {
    if (this.state.chatList &gt; prevState.chatList) {
      // write logic here
    }
    <strong class="markup--strong markup--pre-strong">return null </strong>
}</pre>
<p id="be4d" class="graf graf--p graf-after--pre">现在考虑一下<code>getSnapshotBeforeUpdate</code>方法的完整代码:</p>
<pre>getSnapshotBeforeUpdate(prevProps, prevState) {
    if (this.state.chatList &gt; prevState.chatList) {
      <strong class="markup--strong markup--pre-strong">const chatThreadRef = this.chatThreadRef.current;
      return chatThreadRef.scrollHeight - chatThreadRef.scrollTop;</strong>
    }
    return null;
  }</pre>
<p id="30a4" class="graf graf--p graf-after--pre">首先，考虑所有聊天消息的整体高度不超过聊天窗格高度的情况:</p>
<p><img data-attachment-id="46619" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/componentdidupdate-react-lifecycle-method-example-1/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-1.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="componentDidUpdate React lifecycle method example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-1-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-1.png" decoding="async" class="aligncenter size-full wp-image-46619 jetpack-lazy-image" src="../Images/348afbe8233edac2d8003186f875e61e.png" alt="componentDidUpdate Example" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-1.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-1-300x193.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="46619" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/componentdidupdate-react-lifecycle-method-example-1/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-1.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="componentDidUpdate React lifecycle method example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-1-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-1.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-46619" src="../Images/348afbe8233edac2d8003186f875e61e.png" alt="componentDidUpdate Example" srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-1.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-1-300x193.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-1.png"/></noscript>
<p id="9300" class="graf graf--p graf-after--figure">这里，表达式<code>chatThreadRef.scrollHeight - chatThreadRef.scrollTop</code>将等同于<code>chatThreadRef.scrollHeight - 0</code>。</p>
<p id="e01e" class="graf graf--p graf-after--p">评估后，它将等于聊天窗格的<a class="markup--anchor markup--p-anchor" href="https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollHeight" target="_blank" rel="noopener noreferrer" data-href="https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollHeight"><code>scrollHeight</code></a>——就在新消息插入DOM之前。</p>
<p id="f6e6" class="graf graf--p graf-after--p">如果您还记得前面的解释，从<code>getSnapshotBeforeUpdate</code>方法返回的值作为第三个参数传递给<code>componentDidUpdate</code>方法。我们称之为<code>snapshot</code>:</p>
<pre>componentDidUpdate(prevProps, prevState, snapshot) {
    
 }</pre>
<p id="4dad" class="graf graf--p graf-after--pre">这里传入的值是DOM更新之前的前一个<code>scrollHeight</code>。</p>
<p id="66aa" class="graf graf--p graf-after--p">在<code>componentDidUpdate</code>中我们有下面的代码，但是它做什么呢？</p>
<pre>componentDidUpdate(prevProps, prevState, snapshot) {
    if (snapshot !== null) {
      const chatThreadRef = this.chatThreadRef.current;
      chatThreadRef.scrollTop = chatThreadRef.scrollHeight - snapshot;
    }
  }</pre>
<p id="52c9" class="graf graf--p graf-after--pre">实际上，我们是以编程的方式从上往下垂直滚动窗格<a class="markup--anchor markup--p-anchor" href="https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollTop" target="_blank" rel="noopener noreferrer" data-href="https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollTop"/>，距离等于<code>chatThreadRef.scrollHeight - snapshot;</code>。</p>
<p id="dced" class="graf graf--p graf-after--p">由于<code>snapshot</code>指的是更新前的<code>scrollHeight</code>，所以上面的表达式返回新聊天消息的高度加上由于更新而产生的任何其他相关高度。请参见下图:</p>
<p><img data-attachment-id="46620" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/componentdidupdate-react-lifecycle-method-example-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-2.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="componentDidUpdate React lifecycle method example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-2-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-2.png" decoding="async" class="aligncenter size-full wp-image-46620 jetpack-lazy-image" src="../Images/5890576ac4e5ba31e2dd8492f65912fc.png" alt="componentDidUpdate React Lifecycle Method Example" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-2.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-2-300x193.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-2.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="46620" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/componentdidupdate-react-lifecycle-method-example-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-2.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="componentDidUpdate React lifecycle method example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-2-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-2.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-46620" src="../Images/5890576ac4e5ba31e2dd8492f65912fc.png" alt="componentDidUpdate React Lifecycle Method Example" srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-2.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-2-300x193.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-2.png"/></noscript>
<p id="bc32" class="graf graf--p graf-after--figure">当整个聊天窗格的高度被消息占据时(并且已经向上滚动了一点)，由<code>getSnapshotBeforeUpdate</code>方法返回的<code>snapshot</code>值将等于聊天窗格的实际高度:</p>
<p><img data-attachment-id="46622" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/componentdidupdate-react-lifecycle-method-example-3/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-3.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="componentDidUpdate React lifecycle method example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-3-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-3.png" decoding="async" class="aligncenter size-full wp-image-46622 jetpack-lazy-image" src="../Images/c8e0d89d16c599e162cf8ae83e2608cc.png" alt="componentDidUpdate React Lifecycle Method Example" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-3.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-3-300x193.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-3.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-3.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="46622" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/componentdidupdate-react-lifecycle-method-example-3/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-3.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="componentDidUpdate React lifecycle method example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-3-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-3.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-46622" src="../Images/c8e0d89d16c599e162cf8ae83e2608cc.png" alt="componentDidUpdate React Lifecycle Method Example" srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-3.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-3-300x193.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-3.png"/></noscript>
<p id="f57e" class="graf graf--p graf-after--figure">从<code>componentDidUpdate</code>开始的计算将把<code>scrollTop</code>值设置为额外消息高度的总和，这正是我们想要的。</p>
<p id="539b" class="graf graf--p graf-after--figure"><img data-attachment-id="46624" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/componentdidupdate-react-lifecycle-method-example-4/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-4.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="componentDidUpdate React lifecycle method example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-4-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-4.png" decoding="async" class="aligncenter size-full wp-image-46624 jetpack-lazy-image" src="../Images/e5d13a3f8e6a20c158e6456c87833be5.png" alt="componentDidUpdate React Lifecycle Method Example" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-4.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-4-300x193.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-4.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-4.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="46624" data-permalink="https://blog.logrocket.com/react-lifecycle-methods-tutorial-examples/componentdidupdate-react-lifecycle-method-example-4/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-4.png" data-orig-size="720,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="componentDidUpdate React lifecycle method example" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-4-300x193.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-4.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-46624" src="../Images/e5d13a3f8e6a20c158e6456c87833be5.png" alt="componentDidUpdate React Lifecycle Method Example" srcset="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-4.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-4-300x193.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/01/componentDidUpdate-react-lifecycle-method-example-4.png"/></noscript>
<p id="ae34" class="graf graf--p graf-after--p">如果您遇到了困难，我确信仔细阅读解释(再一次)或检查源代码将有助于澄清您的问题。也可以用评论区问我。</p>
<h2 id="unmounting" class="graf graf--h3 graf-after--p">卸载生命周期方法</h2>
<p id="de46" class="graf graf--p graf-after--h3">在组件卸载阶段会调用以下方法:</p>
<h3 id="componentWillUnmount" class="graf graf--h4 graf-after--p"><code>componentWillUnmount()</code></h3>
<p id="2492" class="graf graf--p graf-after--h4">在组件被卸载和销毁之前，立即调用<code>componentWillUnmount</code>生命周期方法。这是执行任何必要清理的理想位置，如清除计时器、取消网络请求或清理在<code>componentDidMount()</code>中创建的任何订阅，如下所示:</p>
<pre>// e.g add event listener
componentDidMount() {
    el.addEventListener()
}

// e.g remove event listener 
componentWillUnmount() {
    el.removeEventListener()
 }</pre>
<h2 id="errorhandling" class="graf graf--h3 graf-after--pre">错误处理生命周期方法</h2>
<p id="971d" class="graf graf--p graf-after--h3">当代码出错时，就会抛出错误。当后代组件(即，它们下面的组件)抛出错误时，调用以下方法。</p>
<p id="87b4" class="graf graf--p graf-after--p">让我们实现一个简单的组件来捕捉演示应用程序中的错误。为此，我们将创建一个名为<code>ErrorBoundary</code>的新组件。</p>
<p id="cbaf" class="graf graf--p graf-after--p">下面是最基本的实现:</p>
<pre>import React, { Component } from 'react';

class ErrorBoundary extends Component {
  state = {};
  render() {
    return null;
  }
}

export default ErrorBoundary;</pre>
<h3 id="getDerivedStateFromError" class="graf graf--h4 graf-after--pre"><code>static getDerivedStateFromError()</code></h3>
<p id="bc4b" class="graf graf--p graf-after--h4">每当在子代组件中引发错误时，首先调用此方法，引发的错误作为参数传递。</p>
<p id="7ca8" class="graf graf--p graf-after--p">从该方法返回的任何值都用于更新组件的状态。</p>
<p id="9bcc" class="graf graf--p graf-after--p">让我们更新<code>ErrorBoundary</code>组件来使用这个生命周期方法:</p>
<pre>import React, { Component } from "react";
class ErrorBoundary extends Component {
  state = {};

  static getDerivedStateFromError(error) {
    console.log(`Error log from getDerivedStateFromError: ${error}`);
    return { hasError: true };
  }

  render() {
    return null;
  }
}

export default ErrorBoundary;</pre>
<p id="5110" class="graf graf--p graf-after--pre">现在，每当在一个后代组件中抛出一个错误，这个错误就会被记录到控制台中，<code>console.error(error)</code>，并且从<code>getDerivedStateFromError</code>方法返回一个对象。这将用于更新<code>ErrorBoundary</code>组件的状态，即使用<code>hasError: true</code>。</p>
<h3 id="componentDidCatch" class="graf graf--h4 graf-after--p">componentDidCatch()</h3>
<p id="0e36" class="graf graf--p graf-after--h4">在抛出后代组件中的错误后，也会调用<code>componentDidCatch</code>方法。除了抛出的<code>error</code>之外，它还被传递了一个参数，该参数表示关于错误的更多信息:</p>
<pre>componentDidCatch(error, info) {
    logToExternalService(error, info) // this is allowed. 
        //Where logToExternalService may make an API call.
}</pre>
<p>在这种方法中，您可以将收到的<code>error</code> <span>或</span> <code>info</code> <span>发送给外部日志服务。与</span> <code>getDerivedStateFromError</code> <span>不同，</span> <code>componentDidCatch</code> <span>允许副作用:</span></p>
<pre>componentDidCatch(error, info) {
    logToExternalService(error, info) <em class="markup--em markup--pre-em">// this is allowed. </em>
        <em class="markup--em markup--pre-em">//Where logToExternalService may make an API call.</em>
}</pre>
<p id="6cfb" class="graf graf--p graf-after--pre">让我们更新<code>ErrorBoundary</code>组件来使用这个生命周期方法:</p>
<pre>import React, { Component } from "react";
class ErrorBoundary extends Component {
  state = { hasError: false };

  static getDerivedStateFromError(error) {
    console.log(`Error log from getDerivedStateFromError: ${error}`);
    return { hasError: true };
  }

  componentDidCatch(error, info) {
    console.log(`Error log from componentDidCatch: ${error}`);
    console.log(info);
  }

  render() {
    return null
  }
}

export default ErrorBoundary;</pre>
<p id="b1cc" class="graf graf--p graf-after--pre">此外，由于<code>ErrorBoundary</code>只能捕捉来自后代组件的错误，我们将让组件呈现作为<code>Children</code>传递的任何内容，或者在出错时呈现默认的错误UI:</p>
<pre>... 

render() {
    if (this.state.hasError) {
      return &lt;h1&gt;Something went wrong.&lt;/h1&gt;;
    }

    return this.props.children;
}</pre>
<p id="c9f9" class="graf graf--p graf-after--pre">我模拟了每当你添加第五条聊天消息时的JavaScript错误。看看工作中的误差边界:</p>
<p><span class="embed-youtube"> <iframe loading="lazy" class="youtube-player" src="https://www.youtube.com/embed/BDkTLdOw5XM?version=3&amp;rel=1&amp;showsearch=0&amp;showinfo=1&amp;iv_load_policy=1&amp;fs=1&amp;hl=en-US&amp;autohide=2&amp;wmode=transparent" allowfullscreen="true" sandbox="allow-scripts allow-same-origin allow-popups allow-presentation">视频</iframe> </span></p>
<h2 id="fa97" class="graf graf--h3 graf-after--figure">结论</h2>
<p id="8dd1" class="graf graf--p graf-after--h3">关于React中的生命周期方法，包括React 17中的新增内容，已经有了很长的讨论。我希望本教程和我们走过的实际例子能帮助你更好地理解什么是React生命周期方法以及它们是如何工作的。</p>
<p id="c667" class="graf graf--p graf-after--p">回头见！</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720"><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener"> LogRocket </a>:全面了解您的生产React应用</h2><p>调试React应用程序可能很困难，尤其是当用户遇到难以重现的问题时。如果您对监视和跟踪Redux状态、自动显示JavaScript错误以及跟踪缓慢的网络请求和组件加载时间感兴趣，</p><a href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" vwo-el-id="19356441070">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<p vwo-el-id="28675660440" class="">LogRocket 结合了会话回放、产品分析和错误跟踪，使软件团队能够创建理想的web和移动产品体验。这对你来说意味着什么？</p>
<p>LogRocket不是猜测错误发生的原因，也不是要求用户提供截图和日志转储，而是让您回放问题，就像它们发生在您自己的浏览器中一样，以快速了解哪里出错了。</p>
<p>不再有嘈杂的警报。智能错误跟踪允许您对问题进行分类，然后从中学习。获得有影响的用户问题的通知，而不是误报。警报越少，有用的信号越多。</p>
<p vwo-el-id="28675660750">LogRocket Redux中间件包为您的用户会话增加了一层额外的可见性。LogRocket记录Redux存储中的所有操作和状态。</p>
<p vwo-el-id="28675661060">现代化您调试React应用的方式— <a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">开始免费监控</a>。</p>
</div></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>