<html>
<head>
<title>How to run SQL Server in a Docker container - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在Docker容器中运行SQL Server</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/docker-sql-server/#0001-01-01">https://blog.logrocket.com/docker-sql-server/#0001-01-01</a></blockquote><div><article class="article-post">
<p><em> <strong>编者按</strong>:本Docker和SQL Server教程最后一次更新是在2021年5月28日，包含了关于SQL Server 2019最新版本的信息。它可能仍然包含一些过时的信息。</em></p>
<p>不久以前，在Windows之外的任何平台上运行--更不用说开发-- NET应用程序或服务的想法都是可笑的。但随着微软目前对开源的关注，那些日子感觉像是遥远的记忆。</p>
<p>具备使用<code>dotnet core</code>开发的能力，跨平台的世界。网络已经开放。从SQL Server 2017(当前版本为SQL Server 2019)发布之日起，您就可以开发可以在Windows、Mac甚至Linux上运行的应用和服务。但是数据库技术呢？</p>
<p>在本指南中，我们将演示如何在Docker容器中启动SQL Server数据库。</p>
<p>我们将讨论以下内容:</p>

<h2 id="what">Docker和SQL Server是什么？</h2>
<p>由微软开发的SQL Server是世界上最流行的关系数据库技术之一。它的主要功能是存储和检索其他应用程序请求的数据。SQL Server通常用于支持事务性和分析性工作负载的应用程序中。</p>
<p>Docker 使您能够使用可移植的、自给自足的轻量级容器来创建、管理和运行应用程序。<a href="https://blog.logrocket.com/containerizing-a-simple-django-application-with-docker-and-docker-compose/" target="_blank" rel="noopener">容器</a>使您能够打包您的应用程序及其所需的依赖项，以最小的破坏性更改从一个计算环境运行到另一个计算环境。</p>
<h2 id="can">SQL Server可以在Docker上运行吗？</h2>
<p>很多。专注于. NET的开发人员倾向于使用Microsoft SQL Server来满足他们的关系数据库需求。但是，在很多人的记忆中，SQL Server只能在Windows平台上运行。我们的跨平台。NET开发刚刚嘎然而止。</p>
<p>为了解决这个问题，您可以通过利用<a href="https://blog.logrocket.com/docker-for-front-end-developers/" target="_blank" rel="noopener noreferrer"> Docker </a>跨多个平台使用Microsoft SQL Server。</p>
<p>关于如何在Docker容器中运行SQL server的可视化示例，请查看我们下面的<a href="https://www.youtube.com/watch?v=RAE-VcZ3u2A" target="_blank" rel="noopener">视频教程</a>:</p>
<p><span class="embed-youtube"> <iframe loading="lazy" class="youtube-player" src="https://www.youtube.com/embed/RAE-VcZ3u2A?version=3&amp;rel=1&amp;showsearch=0&amp;showinfo=1&amp;iv_load_policy=1&amp;fs=1&amp;hl=en-US&amp;autohide=2&amp;wmode=transparent" allowfullscreen="true" sandbox="allow-scripts allow-same-origin allow-popups allow-presentation">视频</iframe> </span></p>
<p>若要遵循本指南，请确保您使用的是SQL Server 2017或更高版本。否则，您将无法使用跨平台的SQL Server。最新版本是<a href="https://www.microsoft.com/en-us/sql-server/sql-server-2019" target="_blank" rel="noopener"> SQL Server 2019 (15.x) </a>，2019年11月4日发布。使用这个完整的<a href="https://sqlserverbuilds.blogspot.com/" target="_blank" rel="noopener"> SQL Server版本历史</a>来确保您的堆栈是最新的。</p>
<p>您必须安装包含<code>docker-compose</code>的<code>docker</code>。如果你使用<a href="https://docs.docker.com/docker-for-mac/install/" target="_blank" rel="noopener noreferrer">的Mac版Docker桌面</a>，这一切通常都会为你处理好。</p>
<p>最后，我们将使用npm库<a href="https://www.npmjs.com/package/mssql" target="_blank" rel="noopener noreferrer"> mssql </a>来连接、更新和查询数据库容器。您可以从任何终端使用<code>npm install mssql</code>命令进行本地或全局安装。</p>
<p>都整理好了吗？很好，让我们来学习如何启动SQL Server数据库进行跨平台开发。</p>
<h2 id="how">如何在Docker容器中运行SQL Server</h2>
<p>要启动SQL Server容器，首先在项目的根目录下创建一个<code>docker-compose.yml</code>文件。在该文件中，定义一个使用微软提供的SQL Server映像的<code>sql-server-db</code>资源。</p>
<p>下面是我们的<code>docker-compose.yml</code>文件的样子:</p>
<pre>version: "3.2"
services:

  sql-server-db:
    container_name: sql-server-db
    image: microsoft/mssql-server-linux:2017-latest
    ports:
      - "1433:1433"
    environment:
      SA_PASSWORD: "change_this_password"
      ACCEPT_EULA: "Y"</pre>
<p>要启动我们的数据库，我们可以从命令行运行一个<code>up</code>命令:</p>
<pre>$ docker-compose up -d
Pulling sql-server-db (microsoft/mssql-server-linux:2017-latest)...
2017-latest: Pulling from microsoft/mssql-server-linux
59ab41dd721a: Pull complete
57da90bec92c: Pull complete
06fe57530625: Pull complete
5a6315cba1ff: Pull complete
739f58768b3f: Pull complete
0b751601bca3: Pull complete
bcf04a22644a: Pull complete
6b5009e4f470: Pull complete
a9dca2f6722a: Pull complete
Creating sql-server-db ... done</pre>
<p>我们可以在终端中看到,<code>sql-server-db</code>已经成功创建。现在我们可以探索如何连接到它来运行一些查询。让我们从连接到数据库容器开始:</p>
<pre>$ mssql -u sa -p change_this_password</pre>
<p>我们现在应该看到我们已经连接到数据库，并且<code>mssql</code>正在等待命令。让我们继续运行<code>.databases</code>命令，看看我们的SQL Server容器中有哪些数据库:</p>
<pre>mssql&gt; .databases
name  
------
master
model 
msdb  
tempdb

4 row(s) returned

Executed in 1 ms</pre>
<p>我们看到标准的SQL Server数据库出现了— <code>master</code>、<code>model</code>、<code>msdb</code>和<code>tempdb</code>。让我们继续创建我们自己的数据库，并在其中创建一个表。我们可以通过创建一个名为<code>my_db_setup.sql</code>的SQL脚本文件来做到这一点，我们可以在我们的容器中运行它。</p>
<pre>USE master;
GO

CREATE DATABASE SampleDB;
GO

CREATE TABLE dbo.MyTable (
  id bigint IDENTITY(1,1) PRIMARY KEY,
  name varchar(500) null
)
GO</pre>
<p>现在我们有了设置脚本，我们可以使用<code>mssql</code>对数据库容器运行它:</p>
<pre>$ mssql -u sa -p change_this_password
mssql&gt; .run my_db_setup.sql
USE master;
OK

Executed in 0 ms
CREATE DATABASE SampleDB;
OK

Executed in 0 ms
CREATE TABLE dbo.MyTable (
  id bigint IDENTITY(1,1) PRIMARY KEY,
  name varchar(500) null
)
OK

Executed in 0 ms</pre>
<p>现在我们已经运行了我们的脚本，我们可以列出我们的数据库和表来查看刚刚创建的所有内容:</p>
<pre>mssql&gt; .databases
name    
--------
master  
model   
msdb    
SampleDB
tempdb  

5 row(s) returned

Executed in 1 ms
mssql&gt; .tables
database  schema  name                   type      
--------  ------  ---------------------  ----------
master    dbo     MSreplication_options  BASE TABLE
master    dbo     MyTable                BASE TABLE
master    dbo     spt_fallback_db        BASE TABLE
master    dbo     spt_fallback_dev       BASE TABLE
master    dbo     spt_fallback_usg       BASE TABLE
master    dbo     spt_monitor            BASE TABLE
master    dbo     spt_values             VIEW      

7 row(s) returned

Executed in 1 ms</pre>
<p>就这样，我们有了自己的数据库，并在其中配置了一个表。所有这些都作为Docker容器运行，我们可以与他人共享，并在各种不同的平台上运行。</p>
<h2>结论</h2>
<p>微软已经升级了越来越多的框架、工具和语言来支持跨平台开发。就而言是一个巨大的飞跃。NET/C#开发，因为它可以在Windows、Mac和Linux上运行。</p>
<p>酪NET仅仅是一个框架；我们还需要我们在该生态系统中经常使用的工具来支持多个平台。这就是我们在这里演示的:SQL Server 2017和更高版本可以通过利用容器技术在任何平台上运行。</p>
<p>通过Docker compose文件中的几行代码和类似于<code>mssql</code>的简单npm库，我们可以在任何平台上启动SQL Server数据库。这不仅对于生产部署非常方便，对于开发环境也是如此。</p>
<p>团队中的其他开发人员现在可以通过运行<code>docker-compose up</code>和运行我们手头的任何种子数据库脚本来使用同一个数据库。我们甚至可以创建自己的配置了整个数据库的Docker映像，然后在Docker合成文件中使用该映像。</p>
<p>有了Docker和<code>dotnet core</code>这样的东西，使用。NET生态系统比以往任何时候都更有可能。</p>
<p>如果你对这篇博文、AWS、无服务器或一般编码有任何问题，请随时通过twitter <a href="https://twitter.com/kylegalbraith" target="_blank" rel="noopener noreferrer"> @kylegalbraith </a>联系我。也可以看看我每周的<a href="https://kylegalbraith.com/learn-by-doing" target="_blank" rel="noopener noreferrer">边做边学</a>时事通讯或者我的<a href="https://kylegalbraith.com/learn-aws" target="_blank" rel="noopener noreferrer">通过使用It学习AWS</a>课程来学习更多关于云、编码和DevOps的知识。</p><div class="code-block code-block-2">
<div class="blog-plug base-cta"><h2>使用<a class="signup" href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>消除传统错误报告的干扰</h2>
<a href="https://lp.logrocket.com/blg/signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p><a href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一个数字体验分析解决方案，它可以保护您免受数百个假阳性错误警报的影响，只针对几个真正重要的项目。LogRocket会告诉您应用程序中实际影响用户的最具影响力的bug和UX问题。</p>
<p>然后，使用具有深层技术遥测的会话重放来确切地查看用户看到了什么以及是什么导致了问题，就像你在他们身后看一样。</p>
<p>LogRocket自动聚合客户端错误、JS异常、前端性能指标和用户交互。然后LogRocket使用机器学习来告诉你哪些问题正在影响大多数用户，并提供你需要修复它的上下文。</p>
<p>关注重要的bug—<a class="signup" href="https://lp.logrocket.com/blg/signup-issue-free" target="_blank" rel="noopener noreferrer">今天就试试LogRocket】。</a></p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>