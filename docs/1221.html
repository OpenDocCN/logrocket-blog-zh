<html>
<head>
<title>How to build a comment system for Gatsby using GitHub Issues - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何使用GitHub Issues - LogRocket博客为盖茨比建立评论系统</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/how-to-build-a-comment-system-for-gatsby-using-github-issues/#0001-01-01">https://blog.logrocket.com/how-to-build-a-comment-system-for-gatsby-using-github-issues/#0001-01-01</a></blockquote><div><article class="article-post">
<p>评论系统起着重要的作用，因为它们使你能够与你的博客读者互动。如果你想给你的博客添加评论系统，可以使用付费服务，如<a href="https://commento.io/" target="_blank" rel="noopener noreferrer"> Commento </a>和<a href="https://disqus.com/" target="_blank" rel="noopener noreferrer"> Disqus </a>，但是在本文中，你将学习如何使用GitHub Issues为Gatsby博客构建评论系统。</p>
<p>在进入教程之前，让我们先看一个演示和我们的评论系统的工作流程:</p>
<h2><span class="gallery author-d-1gg9uz65z1iz85zgdz68zmqkz84zo2qoxuz77zbaz87zz79z6z79z5z72zz77zz90zz71zsz88zvq3z80zz73zez86zmz76zz122zz85zfz89z7z80zz87z"> <span class="gallery-wrapper" data-ace-gallery-urls="https://paper-attachments.dropbox.com/s_6AD88A7353691C9B8AA17768F2E0B0C77EEF4F3045F1F49F0DD1077087F6854E_1598641399883_output.gif" data-ace-gallery-clipboard-json="{&quot;items&quot;:[{&quot;type&quot;:&quot;image&quot;,&quot;url&quot;:&quot;https://paper-attachments.dropbox.com/s_6AD88A7353691C9B8AA17768F2E0B0C77EEF4F3045F1F49F0DD1077087F6854E_1598641399883_output.gif&quot;,&quot;serializedZonesForClipboard&quot;:{&quot;captionZone&quot;:{&quot;atext&quot;:{&quot;text&quot;:&quot;\n&quot;,&quot;attribs&quot;:&quot;|1+1&quot;},&quot;pool&quot;:{&quot;numToAttrib&quot;:{},&quot;attribToNum&quot;:{},&quot;nextNum&quot;:0,&quot;dirty&quot;:false,&quot;firstDirtyNum&quot;:null}}}}]}"> <img decoding="async" class="aligncenter jetpack-lazy-image" src="../Images/776221c468f5aff62d714916bb5295c7.png" alt="Demo workflow comment system Gatsby blog GitHub Issues" data-lazy-src="https://paper-attachments.dropbox.com/s_6AD88A7353691C9B8AA17768F2E0B0C77EEF4F3045F1F49F0DD1077087F6854E_1598641399883_output.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://paper-attachments.dropbox.com/s_6AD88A7353691C9B8AA17768F2E0B0C77EEF4F3045F1F49F0DD1077087F6854E_1598641399883_output.gif"/> <noscript> <img data-lazy-fallback="1" decoding="async" loading="lazy" class="aligncenter" src="../Images/776221c468f5aff62d714916bb5295c7.png" alt="Demo workflow comment system Gatsby blog GitHub Issues" data-original-src="https://paper-attachments.dropbox.com/s_6AD88A7353691C9B8AA17768F2E0B0C77EEF4F3045F1F49F0DD1077087F6854E_1598641399883_output.gif"/> </noscript> </span> </span></h2>
<p>正如你在这个演示GIF中看到的，我们可以在博客中发表评论。我们的评论将存储在GitHub Issues中。现在，让我们来看看构建这样的东西所必需的工作流:</p>
<p><img data-attachment-id="26723" data-permalink="https://blog.logrocket.com/how-to-build-a-comment-system-for-gatsby-using-github-issues/attachment/rpx5vdjk/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/rpX5vDJk.png" data-orig-size="730,606" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Workflow-GitHub-Authentication-User-Comments-Issues" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/rpX5vDJk-300x249.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/rpX5vDJk.png" decoding="async" class="aligncenter size-full wp-image-26723 jetpack-lazy-image" src="../Images/ea1fc93dac6003e3827919fbe06427ce.png" alt="Workflow GitHub Authentication User Comments Issues " data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/rpX5vDJk.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/rpX5vDJk-300x249.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/rpX5vDJk.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/rpX5vDJk.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="26723" data-permalink="https://blog.logrocket.com/how-to-build-a-comment-system-for-gatsby-using-github-issues/attachment/rpx5vdjk/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/rpX5vDJk.png" data-orig-size="730,606" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Workflow-GitHub-Authentication-User-Comments-Issues" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/rpX5vDJk-300x249.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/rpX5vDJk.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-26723" src="../Images/ea1fc93dac6003e3827919fbe06427ce.png" alt="Workflow GitHub Authentication User Comments Issues " srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/rpX5vDJk.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/rpX5vDJk-300x249.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/rpX5vDJk.png"/></noscript>
<p>这个工作流程可以分为三个步骤。</p>
<ol>
<li>当用户访问博客时，我们检查用户是否通过了GitHub的认证。如果有，用户可以直接评论。如果用户没有通过身份验证，那么用户需要登录才能在博客上发表评论。</li>
<li>当用户点击评论按钮时，我们还需要检查是否有问题存在于博客段落、标题或该博客的独特属性中。如果问题不存在，我们需要创建一个新问题。</li>
<li>最后，我们将评论发布到GitHub Issues，这样它就会出现在我们的博客评论中。</li>
</ol>
<h2>构建GitHub认证</h2>
<p>首先，我们需要为我们的评论系统建立GitHub认证。有不同的方法可以实现这一点，但是我们将使用带有<a href="http://www.passportjs.org/" target="_blank" rel="noopener noreferrer"> Passport.js </a>的定制服务器来处理认证，而不是在Gatsby本身中构建它，因为这是处理用户会话的简单而安全的方法。</p>
<p>让我们创建一个带有Passport.js GitHub身份验证的自定义服务器。</p>
<pre>npm init --yes
npm install express body-parser cors express-session passport passport-github
</pre>
<p>之后，创建App.js并添加以下代码:</p>
<pre>const express = require("express");
const bodyParser = require("body-parser");
const passport = require("passport");
const session = require("express-session");
const cors = require("cors");
const app = express();
const CLIENT_URL = process.env.CLIENT_URL || "http://localhost:8000";
app.use(cors({ credentials: true, origin: CLIENT_URL }));
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: false }));
app.use(
  session({
    resave: true,
    saveUninitialized: true,
    secret: "123456",
  })
);
app.use(passport.initialize());
app.use(passport.session());
require("./passport");
app.get("/", (req, res) =&gt; {
  console.log("user", req.user);
  res.send("Welcome");
});
app.get("/token", (req, res) =&gt; {
  if (req.user) {
    res.status(200).json({ user: req.user });
  } else {
    res.status(200).json({ user: null });
  }
});
app.get("/auth/github", (req, res, next) =&gt; {
  req.redirect_url = req.query.url;
  passport.authenticate("github", { state: JSON.stringify(req.query.url) })(
    req,
    res,
    next
  );
});
app.get(
  "/auth/github/callback",
  passport.authenticate("github", { failureRedirect: "/login" }),
  function (req, res) {
    const redirect_url = JSON.parse(req.query.state);
    // Successful authentication, redirect home.
    res.redirect(redirect_url);
  }
);
const PORT = process.env.PORT || 4000;
app.listen(PORT, () =&gt; {
  console.log(`Server is running on PORT ${PORT}`);
});
</pre>
<p>这里，我们有三个端点:<code>/auth/github</code>、<code>/auth/github/callback</code>和<code>/token</code>。它们处理Passport.js GitHub身份验证和Passport身份验证回调和令牌，后者根据浏览器中存储的cookies返回用户信息。</p>
<p>接下来，创建一个文件Passport.js来配置Passport。</p>
<pre>const passport = require("passport");
const GitHubStrategy = require("passport-github").Strategy;
passport.use(
  new GitHubStrategy(
    {
      clientID: &lt;YOUR APP CLIENT ID&gt;,
      clientSecret: &lt;YOUR APP CLIENT SECRET&gt;,
      callbackURL: "http://localhost:4000/auth/github/callback",
      passReqToCallback: true,
      scope: ["public_repo", "repo"],
    },
    function (req, accessToken, refreshToken, profile, cb) {
      const user = {
        id: profile.id,
        name: profile.username,
        imageUrl: profile.photos[0].value,
        token: accessToken,
      };
      return cb(null, user);
    }
  )
);
passport.serializeUser(function (user, fn) {
  fn(null, user);
});
passport.deserializeUser(function (user, fn) {
  fn(null, user);
});
</pre>
<p>我们现在需要客户机ID和客户机密码来进行配置。</p>
<p>为此，进入GitHub设置，然后点击<strong>开发者设置:</strong> <img data-attachment-id="26724" data-permalink="https://blog.logrocket.com/how-to-build-a-comment-system-for-gatsby-using-github-issues/attachment/client-id-github-authentication/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/client-ID-GitHub-authentication.png" data-orig-size="730,437" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="client ID GitHub authentication" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/client-ID-GitHub-authentication-300x180.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/client-ID-GitHub-authentication.png" decoding="async" class="aligncenter size-full wp-image-26724 jetpack-lazy-image" src="../Images/3b72031bc8ec2df62066d04e5b67ffcb.png" alt="client ID GitHub authentication" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/client-ID-GitHub-authentication.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/client-ID-GitHub-authentication-300x180.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/client-ID-GitHub-authentication.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/client-ID-GitHub-authentication.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="26724" data-permalink="https://blog.logrocket.com/how-to-build-a-comment-system-for-gatsby-using-github-issues/attachment/client-id-github-authentication/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/client-ID-GitHub-authentication.png" data-orig-size="730,437" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="client ID GitHub authentication" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/client-ID-GitHub-authentication-300x180.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/client-ID-GitHub-authentication.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-26724" src="../Images/3b72031bc8ec2df62066d04e5b67ffcb.png" alt="client ID GitHub authentication" srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/client-ID-GitHub-authentication.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/client-ID-GitHub-authentication-300x180.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/client-ID-GitHub-authentication.png"/></noscript>
<p>接下来，点击<strong> <strong> OAuth应用:</strong> </strong> <img data-attachment-id="26727" data-permalink="https://blog.logrocket.com/how-to-build-a-comment-system-for-gatsby-using-github-issues/attachment/oauth-apps-github-issues-authentication/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-apps-GitHub-Issues-Authentication.png" data-orig-size="730,161" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="OAuth apps GitHub Issues Authentication" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-apps-GitHub-Issues-Authentication-300x66.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-apps-GitHub-Issues-Authentication.png" decoding="async" class="aligncenter size-full wp-image-26727 jetpack-lazy-image" src="../Images/ac82306b28959ab80739a9e098f5e17d.png" alt="OAuth apps GitHub Issues Authentication" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-apps-GitHub-Issues-Authentication.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-apps-GitHub-Issues-Authentication-300x66.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-apps-GitHub-Issues-Authentication.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-apps-GitHub-Issues-Authentication.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="26727" data-permalink="https://blog.logrocket.com/how-to-build-a-comment-system-for-gatsby-using-github-issues/attachment/oauth-apps-github-issues-authentication/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-apps-GitHub-Issues-Authentication.png" data-orig-size="730,161" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="OAuth apps GitHub Issues Authentication" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-apps-GitHub-Issues-Authentication-300x66.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-apps-GitHub-Issues-Authentication.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-26727" src="../Images/ac82306b28959ab80739a9e098f5e17d.png" alt="OAuth apps GitHub Issues Authentication" srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-apps-GitHub-Issues-Authentication.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-apps-GitHub-Issues-Authentication-300x66.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-apps-GitHub-Issues-Authentication.png"/></noscript>
<p>最后点击<strong> <strong>新建OAuth app: </strong> </strong> <img data-attachment-id="26728" data-permalink="https://blog.logrocket.com/how-to-build-a-comment-system-for-gatsby-using-github-issues/attachment/oauth-app-github-issues-authentication/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-App-GitHub-Issues-Authentication.png" data-orig-size="730,222" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="OAuth App GitHub Issues Authentication" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-App-GitHub-Issues-Authentication-300x91.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-App-GitHub-Issues-Authentication.png" decoding="async" class="aligncenter size-full wp-image-26728 jetpack-lazy-image" src="../Images/28c6033abe085a65703da19f9c434d60.png" alt="OAuth App GitHub Issues Authentication" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-App-GitHub-Issues-Authentication.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-App-GitHub-Issues-Authentication-300x91.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-App-GitHub-Issues-Authentication.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-App-GitHub-Issues-Authentication.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="26728" data-permalink="https://blog.logrocket.com/how-to-build-a-comment-system-for-gatsby-using-github-issues/attachment/oauth-app-github-issues-authentication/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-App-GitHub-Issues-Authentication.png" data-orig-size="730,222" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="OAuth App GitHub Issues Authentication" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-App-GitHub-Issues-Authentication-300x91.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-App-GitHub-Issues-Authentication.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-26728" src="../Images/28c6033abe085a65703da19f9c434d60.png" alt="OAuth App GitHub Issues Authentication" srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-App-GitHub-Issues-Authentication.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-App-GitHub-Issues-Authentication-300x91.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/OAuth-App-GitHub-Issues-Authentication.png"/></noscript>
<p>在此之后，您可以创建一个新的应用程序，并为其获取凭据。我们现在有了评论系统的服务器，所以让我们在Gatsby博客中构建一个评论部分。我将使用<a href="https://github.com/gatsbyjs/gatsby-starter-blog" target="_blank" rel="noopener noreferrer"> Gatsby Starter Blog </a>在其上构建评论系统。</p>
<p>下面是盖茨比评论系统内部的技术工作流程:</p>
<p> </p>
<p><img data-attachment-id="26730" data-permalink="https://blog.logrocket.com/how-to-build-a-comment-system-for-gatsby-using-github-issues/attachment/gatsby-starter-blog-comments-system-workflow/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow.png" data-orig-size="1600,908" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Gatsby starter blog comments system workflow" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow-300x170.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow-1024x581.png" decoding="async" class="aligncenter wp-image-26730 jetpack-lazy-image" src="../Images/827d4507f57dec9528529a57eca21d65.png" alt="Gatsby starter blog comments system workflow" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow.png 1600w, https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow-300x170.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow-1024x581.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow-768x436.png 768w, https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow-1536x872.png 1536w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="26730" data-permalink="https://blog.logrocket.com/how-to-build-a-comment-system-for-gatsby-using-github-issues/attachment/gatsby-starter-blog-comments-system-workflow/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow.png" data-orig-size="1600,908" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Gatsby starter blog comments system workflow" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow-300x170.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow-1024x581.png" decoding="async" loading="lazy" class="aligncenter wp-image-26730" src="../Images/827d4507f57dec9528529a57eca21d65.png" alt="Gatsby starter blog comments system workflow" srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow.png 1600w, https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow-300x170.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow-1024x581.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow-768x436.png 768w, https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow-1536x872.png 1536w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/Gatsby-starter-blog-comments-system-workflow.png"/></noscript>
<p>首先，我们有一个<code>New Comment</code>组件来发布对GitHub问题的评论。然后，我们有<code>Comment</code>，它呈现了来自GitHub问题的每个组件。<code>New Comment</code>和<code>Comment</code>都应该在<code>templates/blog-post.js</code>内部，它呈现每个博客。</p>
<p>接下来，在<code>src</code>目录<code>Comment/newComment.js</code>中创建一个组件，并添加以下代码:</p>
<pre>import React, { useState, useEffect } from "react"
import { getLoginUrl } from "../../utils/auth"
import { renderMarkdown, processRenderedMarkdown } from "../../utils/github"
import avatar from "./avatar.svg"
import ReactMarkdown from "react-markdown"

const NewComment = ({ user, pageUrl, onCommentSubmit }) =&gt; {
  const [comment, setComment] = useState("")
  const [activeTab, setActiveTab] = useState(0)
  const [markDown, setMarkDown] = useState(null)
  const onCommentChange = e =&gt; {
    setComment(e.target.value)
  }
  const onPreviewClick = async () =&gt; {
    setActiveTab(1)
    const markdownComment = await renderMarkdown(comment)
    setMarkDown(markdownComment)
  }
  const onNewCommentSubmit = () =&gt; {
    onCommentSubmit(comment)
    setComment("")
  }
  return (
    &lt;article className="timeline-comment"&gt;
      {user ? (
        &lt;a
          className="avatar"
          target="_blank"
          tabindex="-1"
          href={user.html_url}
        &gt;
          &lt;img height="44" width="44" alt="@ganeshmani" src={user.avatar_url} /&gt;
        &lt;/a&gt;
      ) : (
        &lt;img height="44" width="44" src={avatar} /&gt;
      )}
      &lt;form className="comment" acceptCharset="UTF-8" action="javascript:"&gt;
        &lt;header className="new-comment-header tabnav"&gt;
          &lt;div className="tabnav-tabs" role="tablist"&gt;
            &lt;button
              type="button"
              className="tabnav-tab tab-write"
              role="tab"
              onClick={() =&gt; setActiveTab(0)}
              aria-selected={activeTab === 0}
            &gt;
              Write
            &lt;/button&gt;
            &lt;button
              type="button"
              className="tabnav-tab tab-preview"
              role="tab"
              onClick={() =&gt; onPreviewClick()}
              aria-selected={activeTab === 1}
            &gt;
              Preview
            &lt;/button&gt;
          &lt;/div&gt;
        &lt;/header&gt;
        &lt;div className="comment-body"&gt;
          &lt;textarea
            className="form-control"
            placeholder="Leave a comment"
            aria-label="comment"
            value={comment}
            onChange={onCommentChange}
            disabled={!user}
          &gt;
            {activeTab === 1 &amp;&amp; markDown ? markDown : null}
          &lt;/textarea&gt;
          &lt;div className="markdown-body" style={{ display: "none" }}&gt;&lt;/div&gt;
        &lt;/div&gt;
        &lt;footer className="new-comment-footer"&gt;
          &lt;a
            className="text-link markdown-info"
            tabindex="-1"
            target="_blank"
            href="https://guides.github.com/features/mastering-markdown/"
          &gt;
            &lt;svg
              className="octicon v-align-bottom"
              viewBox="0 0 16 16"
              version="1.1"
              width="16"
              height="16"
              aria-hidden="true"
            &gt;
              &lt;path
                fill-rule="evenodd"
                d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15
              13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4
              8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z"
              &gt;&lt;/path&gt;
            &lt;/svg&gt;
            Styling with Markdown is supported
          &lt;/a&gt;
          {user ? (
            &lt;button
              onClick={e =&gt; onNewCommentSubmit()}
              className="btn btn-primary"
              type="submit"
            &gt;
              Comment
            &lt;/button&gt;
          ) : (
            &lt;a
              className="btn btn-primary"
              href={`${getLoginUrl(pageUrl)}`}
              target="_top"
              hidden=""
            &gt;
              Sign in to comment
            &lt;/a&gt;
          )}
        &lt;/footer&gt;
      &lt;/form&gt;
    &lt;/article&gt;
  )
}
export default NewComment
</pre>
<p>先从组件道具说起。在这里，我们有<code>user</code>、<code>pageUrl</code>和<code>onCommentSubmit</code>。我们将首先根据<code>user</code>属性检查用户是否通过了身份验证。</p>
<p>如果用户通过了身份验证，我们将允许他们发表评论。如果不是这样，那么我们将禁用文本区域和评论按钮。</p>
<pre> {user ? (
            &lt;button
              onClick={e =&gt; onNewCommentSubmit()}
              className="btn btn-primary"
              type="submit"
            &gt;
              Comment
            &lt;/button&gt;
          ) : (
            &lt;a
              className="btn btn-primary"
              href={`${getLoginUrl(pageUrl)}`}
              target="_top"
              hidden=""
            &gt;
              Sign in to comment
            &lt;/a&gt;
  )}

</pre>
<p>当用户点击<strong> <code>Sign in to comment</code> </strong>时，他们将被重定向到我们的服务器URL passport . js authentic ation。让我们将这个组件导入到<code>templates/blog-post.js</code>中来呈现带有按钮的<code>new Comment</code>文本框。</p>
<pre><span>import React, { useState, useEffect } from "react"</span>
import { Link, graphql } from "gatsby"
import Bio from "../components/bio"
import Layout from "../components/layout"
import SEO from "../components/seo"
import { rhythm, scale } from "../utils/typography"
import NewComment from "../components/Comment/newComment"
import {
loadUser,
} from "../utils/github"
import { loadToken } from "../utils/auth"

const BlogPostTemplate = ({ data, pageContext, location }) =&gt; {
const [user, setUser] = useState(null)

const post = data.markdownRemark
const siteTitle = data.site.siteMetadata.title
const { previous, next,slug } = pageContext
const url = typeof window !== "undefined" ? window.location.href : ""

return (
&lt;Layout location={location} title={siteTitle}&gt;
&lt;SEO
title={post.frontmatter.title}
description={post.frontmatter.description || post.excerpt}
/&gt;
&lt;article&gt;
&lt;header&gt;
&lt;h1
style={{
marginTop: rhythm(1),
marginBottom: 0,
}}
&gt;
{post.frontmatter.title}
&lt;/h1&gt;
&lt;p
style={{
...scale(-1 / 5),
display: `block`,
marginBottom: rhythm(1),
}}
&gt;
{post.frontmatter.date}
&lt;/p&gt;
&lt;/header&gt;
&lt;section dangerouslySetInnerHTML={{ __html: post.html }} /&gt;
&lt;hr
style={{
marginBottom: rhythm(1),
}}
/&gt;
&lt;footer&gt;
&lt;Bio /&gt;
&lt;/footer&gt;
&lt;/article&gt;
&lt;NewComment user={user} pageUrl={url} onCommentSubmit={onCommentSubmit} /&gt;
&lt;nav&gt;
&lt;ul
style={{
display: `flex`,
flexWrap: `wrap`,
justifyContent: `space-between`,
listStyle: `none`,
padding: 0,
}}
&gt;
&lt;li&gt;
{previous &amp;&amp; (
&lt;Link to={previous.fields.slug} rel="prev"&gt;
← {previous.frontmatter.title}
&lt;/Link&gt;
)}
&lt;/li&gt;
&lt;li&gt;
{next &amp;&amp; (
&lt;Link to={next.fields.slug} rel="next"&gt;
{next.frontmatter.title} →
&lt;/Link&gt;
)}
&lt;/li&gt;
&lt;/ul&gt;
&lt;/nav&gt;
&lt;/Layout&gt;
)
}

export default BlogPostTemplate

export const pageQuery = graphql`
query BlogPostBySlug($slug: String!) {
site {
siteMetadata {
title
}
}
markdownRemark(fields: { slug: { eq: $slug } }) {
id
excerpt(pruneLength: 160)
html
frontmatter {
title
date(formatString: "MMMM DD, YYYY")
description
}
}
}
`
</pre>
<p>如果您仔细观察，您会注意到我们将<code>user</code> props传递给这个组件，因为我们需要获取登录的用户信息。</p>
<p><img data-attachment-id="26732" data-permalink="https://blog.logrocket.com/how-to-build-a-comment-system-for-gatsby-using-github-issues/attachment/loggedin-user-token-session-github/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/loggedin-user-token-session-Github.png" data-orig-size="256,496" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="loggedin user token session Github" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/loggedin-user-token-session-Github-155x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/loggedin-user-token-session-Github.png" decoding="async" class="aligncenter size-full wp-image-26732 jetpack-lazy-image" src="../Images/8930eeb30e8b341105b950b889451019.png" alt="loggedin user token session Github" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/loggedin-user-token-session-Github.png 256w, https://blog.logrocket.com/wp-content/uploads/2020/10/loggedin-user-token-session-Github-155x300.png 155w" data-lazy-sizes="(max-width: 256px) 100vw, 256px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/10/loggedin-user-token-session-Github.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/loggedin-user-token-session-Github.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="26732" data-permalink="https://blog.logrocket.com/how-to-build-a-comment-system-for-gatsby-using-github-issues/attachment/loggedin-user-token-session-github/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/10/loggedin-user-token-session-Github.png" data-orig-size="256,496" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="loggedin user token session Github" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/10/loggedin-user-token-session-Github-155x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/10/loggedin-user-token-session-Github.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-26732" src="../Images/8930eeb30e8b341105b950b889451019.png" alt="loggedin user token session Github" srcset="https://blog.logrocket.com/wp-content/uploads/2020/10/loggedin-user-token-session-Github.png 256w, https://blog.logrocket.com/wp-content/uploads/2020/10/loggedin-user-token-session-Github-155x300.png 155w" sizes="(max-width: 256px) 100vw, 256px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/10/loggedin-user-token-session-Github.png"/></noscript>
<p>我们的方法是添加以下代码:</p>
<pre>useEffect(() =&gt; {
    const fetchUser = async () =&gt; {
      await loadToken()
      const user = await loadUser()
      const issue = await loadIssueByTerm(slug)
      setUser(user)
    }
    fetchUser()
  }, [])
</pre>
<p>在这里，我们将通过连接我们的服务器从会话中接收一个令牌。</p>
<pre>export const token = { value: null, code: null }
export const BACKEND_API = "http://localhost:4000"
// tslint:disable-next-line:variable-name
export function getLoginUrl(redirect_uri) {
  return `http://localhost:4000/auth/github?url=${redirect_uri}`
}
export async function loadToken() {
  if (token.value) {
    return token.value
  }
  const url = `${BACKEND_API}/token`
  const response = await fetch(url, {
    method: "GET",
    mode: "cors",
    credentials: "include",
  })
  if (response) {
    const t = await response.json()
    if (t.user) {
      token.value = t.user.token
      return t.user.token
    }
  }
  return null
}
</pre>
<p>一旦我们得到令牌，我们就可以从GitHub获取用户详细信息。</p>
<pre>export const loadUser = () =&gt; {
  if (token.value === null) {
    return Promise.resolve(null)
  }
  return githubFetch(githubRequest("user")).then(response =&gt; {
    if (response.ok) {
      return response.json()
    }
    return null
  })
}

const githubRequest = (relativeUrl, init) =&gt; {
  init = init || {}
  init.mode = "cors"
  init.cache = "no-cache" // force conditional request
  const request = new Request(GITHUB_API + relativeUrl, init)
  request.headers.set("Accept", GITHUB_ENCODING__REACTIONS_PREVIEW)
  if (!/^search\//.test(relativeUrl) &amp;&amp; token.value !== null) {
    request.headers.set("Authorization", `token ${token.value}`)
  }
  return request
}

const githubFetch = request =&gt; {
  return fetch(request).then(response =&gt; {
    if (response.status === 401) {
      token.value = null
    }
    if (response.status === 403) {
      response.json().then(data =&gt; {
        if (data.message === "Resource not accessible by integration") {
          //   window.dispatchEvent(new CustomEvent("not-installed"))
        }
      })
    }
    if (
      request.method === "GET" &amp;&amp;
      [401, 403].indexOf(response.status) !== -1 &amp;&amp;
      request.headers.has("Authorization")
    ) {
      request.headers.delete("Authorization")
      return githubFetch(request)
    }
    return response
  })
}
</pre>
<p>现在，让我们看看如果GitHub不存在，如何发布评论和创建GitHub问题。在<code>templates/blog-post.js,</code>中添加以下代码:</p>
<pre>  const [issue, setIssue] = useState({}) 

  useEffect(() =&gt; {
    const fetchUser = async () =&gt; {
      await loadToken()
      const user = await loadUser()
      const issue = await loadIssueByTerm(slug)
      setUser(user)

      if (issue) {
        setIssue(issue)
        if (issue &amp;&amp; issue.comments &gt; 0) {
          const comments = await loadComments(issue.number)
          setComments(comments)
        }
      }
    }
    fetchUser()
  }, [])

const onCommentSubmit = async value =&gt; {
    let issueResult
    if (Object.keys(issue).length === 0) {
      issueResult = await createIssue(
        slug,
        url,
        post.frontmatter.title,
        post.frontmatter.description,
        "comment"
      )
      setIssue(issueResult)
    }
    const comment = await postComment(
      Object.keys(issue).length !== 0 ? issue.number : issueResult.number,
      value
    )
    const comments = await loadComments(
      Object.keys(issue).length &gt; 0 ? issue.number : issueResult.number
    )
    setComments(comments)
  }
</pre>
<p>现在，我们将加载<code>issueByTerm</code>，这是我们的博客slug。</p>
<pre>      const issue = await loadIssueByTerm(slug)
</pre>
<p>在<code>utils/github.js</code>内添加该功能:</p>
<pre>export function loadIssueByTerm(term) {
  const q = `"${term}" type:issue in:title repo:ganeshmani/nodecli-forms`
  const request = githubRequest(
    `search/issues?q=${encodeURIComponent(q)}&amp;sort=created&amp;order=asc`
  )
  return githubFetch(request)
    .then(response =&gt; {
      if (!response.ok) {
        throw new Error("Error fetching issue via search.")
      }
      return response.json()
    })
    .then(results =&gt; {
      if (results.total_count === 0) {
        return null
      }
      if (results.total_count &gt; 1) {
        // tslint:disable-next-line:no-console
        console.warn(`Multiple issues match "${q}".`)
      }
      term = term.toLowerCase()
      for (const result of results.items) {
        if (result.title.toLowerCase().indexOf(term) !== -1) {
          return result
        }
      }
      // tslint:disable-next-line:no-console
      console.warn(
        `Issue search results do not contain an issue with title matching "${term}". Using first result.`
      )
      return results.items[0]
    })
}
</pre>
<p>我们将从GitHub获取问题，并将其存储在组件状态中。当用户点击<code>comment</code>按钮时，我们调用函数<code>onCommentSubmit</code>。</p>
<p>在这里，我们将检查问题是否存在。如果没有，我们就制造问题。</p>
<pre>if (Object.keys(issue).length === 0) {
      issueResult = await createIssue(
        slug,
        url,
        post.frontmatter.title,
        post.frontmatter.description,
        "comment"
      )
      setIssue(issueResult)
}
</pre>
<p><code>CreateIssue</code>会是这样的:</p>
<pre>export function createIssue(issueTerm, documentUrl, title, description, label) {
  const url = `https://api.github.com/repos/&lt;USERNAME&gt;/&lt;REPO NAME&gt;/issues`
  const request = new Request(url, {
    method: "POST",
    body: JSON.stringify({
      title: issueTerm,
      body: `# ${title}\n\n${description}\n\n[${documentUrl}](${documentUrl})`,
    }),
  })
  request.headers.set("Accept","application/vnd.github.squirrel-girl-preview")
  request.headers.set("Authorization", `token ${token.value}`)
  return fetch(request).then(response =&gt; {
    if (!response.ok) {
      throw new Error("Error creating comments container issue")
    }
    return response.json()
  })
}
</pre>
<p>之后，在GitHub问题上发表评论:</p>
<pre>//it comes inside onCommentSubmit
await postComment(
      Object.keys(issue).length !== 0 ? issue.number : issueResult.number,
      value
    )
    const comments = await loadComments(
      Object.keys(issue).length &gt; 0 ? issue.number : issueResult.number
    )
    setComments(comments)
</pre>
<p><code>postComment</code>和<code>loadComments</code>功能是:</p>
<pre>export function postComment(issueNumber, markdown) {
  const url = `repos/&lt;USERNAME&gt;/&lt;REPO NAME&gt;/issues/${issueNumber}/comments`
  const body = JSON.stringify({ body: markdown })
  const request = githubRequest(url, { method: "POST", body })
  const accept = `application/vnd.github.VERSION.html+json,application/vnd.github.squirrel-girl-preview`
  request.headers.set("Accept", accept)
  return githubFetch(request).then(response =&gt; {
    if (!response.ok) {
      throw new Error("Error posting comment.")
    }
    return response.json()
  })
}
function commentsRequest(issueNumber) {
  const url = `repos/&lt;USERNAME&gt;/&lt;REPO NAME&gt;/issues/${issueNumber}/comments`
  const request = githubRequest(url)
  const accept = `application/vnd.github.VERSION.html+json,application/vnd.github.squirrel-girl-preview`
  request.headers.set("Accept", accept)
  return request
}
export function loadComments(issueNumber) {
  const request = commentsRequest(issueNumber)
  return githubFetch(request).then(response =&gt; {
    if (!response.ok) {
      throw new Error("Error fetching comments.")
    }
    return response.json()
  })
}
</pre>
<p>现在，我们已经将评论发布到GitHub Issues并加载了它。让我们在博客中发表评论。</p>
<p>在<code>templates/blog-post.js</code>中添加以下代码:</p>
<pre> {Object.keys(issue).length &gt; 0 &amp;&amp;
        comments &amp;&amp;
        comments.map(comment =&gt; {
          return &lt;Comment comment={comment} /&gt;
        })}
</pre>
<p>现在，创建一个组件<code>Comment/index.js</code>并添加以下代码:</p>
<pre>import React from "react"
import moment from "moment"
const displayAssociations = {
  COLLABORATOR: "Collaborator",
  CONTRIBUTOR: "Contributor",
  MEMBER: "Member",
  OWNER: "Owner",
  FIRST_TIME_CONTRIBUTOR: "First time contributor",
  FIRST_TIMER: "First timer",
  NONE: "",
}
const Comment = ({ comment }) =&gt; {
  return (
    &lt;div&gt;
      &lt;article className="timeline-comment"&gt;
        &lt;a
          className="avatar"
          href={comment.user.html_url}
          target="_blank"
          tabindex="-1"
        &gt;
          &lt;img
            alt={`@${comment.user.login}`}
            height="44"
            width="44"
            src={comment.user.avatar_url}
          /&gt;
        &lt;/a&gt;
        &lt;div className="comment"&gt;
          &lt;header className="comment-header"&gt;
            &lt;span className="comment-meta"&gt;
              &lt;a
                className="text-link"
                href={comment.user.html_url}
                target="_blank"
              &gt;
                &lt;strong&gt;{comment.user.login}&lt;/strong&gt;
              &lt;/a&gt;
              commented
              &lt;a className="text-link" href={comment.html_url} target="_blank"&gt;
                {moment(comment.created_at).fromNow()}
              &lt;/a&gt;
            &lt;/span&gt;
            &lt;div className="comment-actions"&gt;
              &lt;span className="author-association-badge"&gt;
                {displayAssociations[comment.author_association]}
              &lt;/span&gt;
            &lt;/div&gt;
          &lt;/header&gt;
          &lt;div
            dangerouslySetInnerHTML={{ __html: comment.body_html }}
            className="markdown-body markdown-body-scrollable"
          &gt;&lt;/div&gt;
          &lt;div
            className="comment-footer"
            reaction-count="14"
            // reaction-url="https://api.github.com/repos/taniarascia/comments/issues/comments/668954710/reactions"
          &gt;
            &lt;details className="details-overlay details-popover reactions-popover"&gt;
              &lt;summary tabindex="-1"&gt;
                &lt;svg
                  className="octicon"
                  style={{ marginRight: "3px" }}
                  viewBox="0 0 7 16"
                  version="1.1"
                  width="7"
                  height="16"
                  aria-hidden="true"
                &gt;
                  &lt;path
                    fillRule="evenodd"
                    d="M4 4H3v3H0v1h3v3h1V8h3V7H4V4z"
                  &gt;&lt;/path&gt;
                &lt;/svg&gt;
                &lt;svg
                  className="octicon"
                  viewBox="0 0 16 16"
                  version="1.1"
                  width="16"
                  height="16"
                  aria-hidden="true"
                &gt;
                  &lt;path
                    fillRule="evenodd"
                    d="M8 0C3.58 0 0 3.58 0 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm4.81 12.81a6.72 6.72 0 0 1-2.17 1.45c-.83.36-1.72.53-2.64.53-.92 0-1.81-.17-2.64-.53-.81-.34-1.55-.83-2.17-1.45a6.773 6.773 0 0 1-1.45-2.17A6.59 6.59 0 0 1 1.21 8c0-.92.17-1.81.53-2.64.34-.81.83-1.55 1.45-2.17.62-.62 1.36-1.11 2.17-1.45A6.59 6.59 0 0 1 8 1.21c.92 0 1.81.17 2.64.53.81.34 1.55.83 2.17 1.45.62.62 1.11 1.36 1.45 2.17.36.83.53 1.72.53 2.64 0 .92-.17 1.81-.53 2.64-.34.81-.83 1.55-1.45 2.17zM4 6.8v-.59c0-.66.53-1.19 1.2-1.19h.59c.66 0 1.19.53 1.19 1.19v.59c0 .67-.53 1.2-1.19 1.2H5.2C4.53 8 4 7.47 4 6.8zm5 0v-.59c0-.66.53-1.19 1.2-1.19h.59c.66 0 1.19.53 1.19 1.19v.59c0 .67-.53 1.2-1.19 1.2h-.59C9.53 8 9 7.47 9 6.8zm4 3.2c-.72 1.88-2.91 3-5 3s-4.28-1.13-5-3c-.14-.39.23-1 .66-1h8.59c.41 0 .89.61.75 1z"
                  &gt;&lt;/path&gt;
                &lt;/svg&gt;
              &lt;/summary&gt;
            &lt;/details&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/article&gt;
    &lt;/div&gt;
  )
}
export default Comment
</pre>
<p>现在你应该有一个简单的使用GitHub Issues的Gatsby博客评论系统了。这是一个为你的博客获得评论系统的简单版本，但是我们可以给它添加更多的功能。例如，您可以在您的博客中添加反应和垃圾邮件过滤。</p>
<p>如果你想在本教程的基础上构建这些特性，请在评论中告诉我。</p>
<p> </p><div class="code-block code-block-2">
<div class="blog-plug base-cta"><h2>使用<a class="signup" href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>消除传统错误报告的干扰</h2>
<a href="https://lp.logrocket.com/blg/signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p><a href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一个数字体验分析解决方案，它可以保护您免受数百个假阳性错误警报的影响，只针对几个真正重要的项目。LogRocket会告诉您应用程序中实际影响用户的最具影响力的bug和UX问题。</p>
<p>然后，使用具有深层技术遥测的会话重放来确切地查看用户看到了什么以及是什么导致了问题，就像你在他们身后看一样。</p>
<p>LogRocket自动聚合客户端错误、JS异常、前端性能指标和用户交互。然后LogRocket使用机器学习来告诉你哪些问题正在影响大多数用户，并提供你需要修复它的上下文。</p>
<p>关注重要的bug—<a class="signup" href="https://lp.logrocket.com/blg/signup-issue-free" target="_blank" rel="noopener noreferrer">今天就试试LogRocket】。</a></p></div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>