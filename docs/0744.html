<html>
<head>
<title>Getting started with Postgres in your React app - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在React app - LogRocket博客中开始使用Postgres</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/getting-started-with-postgres-in-your-react-app/#0001-01-01">https://blog.logrocket.com/getting-started-with-postgres-in-your-react-app/#0001-01-01</a></blockquote><div><article class="article-post">
<p>前端开发人员通常不需要理解接收、记录和删除信息的过程。这是后端开发人员的工作。</p>
<p>也就是说，前端开发人员有足够的理由学习后端编程和数据库交互。例如:</p>
<ul>
<li>您将从其他前端开发人员中脱颖而出，因为您将知道您的应用程序作为一个整体是如何工作的</li>
<li>您将能够在应用程序的正面和背面工作</li>
<li>你可以晋升为全栈开发者，承担更大的角色，拿更高的薪水</li>
<li>前端和后端编程知识——以及设计可扩展系统和构建可靠的应用程序架构——是成为技术领导者的必要条件</li>
</ul>
<p>在本教程中，我们将演示如何使用Express和Node.js创建一个小应用程序，该应用程序可以根据收到的HTTP请求记录和删除PostgreSQL数据库中的信息。然后，我们将创建一个简单的React应用程序来测试和查看整个应用程序如何从前到后流动。</p>
<p>我假设您了解React应用程序的工作方式，并且熟悉前端JavaScript HTTP请求。我们不会讨论在与数据库交互之前如何验证数据。相反，我们将重点展示如何将来自接口的请求记录到数据库中。</p>
<p>我为这个教程发布了一个<a href="https://github.com/nsebhastian/react-node-postgres" target="_blank" rel="noopener noreferrer"> GitHub repo </a>，这样你就可以在遇到问题时比较你的代码。现在让我们运行数据库。</p>
<h2 id="settinguppostgresql">设置PostgreSQL</h2>
<p><a href="https://www.postgresql.org/" target="_blank" rel="noopener noreferrer"> PostgreSQL </a>，或Postgres，是一个关系数据库管理系统，号称是世界上最先进的开源关系数据库。它自1996年以来一直得到维护，并以可靠和强大而闻名。</p>
<p>从<a href="https://www.postgresql.org/download/" target="_blank" rel="noopener noreferrer">下载并安装PosgreSQL </a>开始。它支持所有主要的操作系统，因此请为您的计算机选择正确的操作系统，并按照说明设置数据库。安装向导将提示您输入超级用户密码。请确保您记住了该密码；稍后您将需要它来登录。</p>
<p>安装完成后，您可以通过使用<a href="https://www.pgadmin.org/" target="_blank" rel="noopener noreferrer"> pgAdmin </a>来访问您的数据库，这是一个与PostgreSQL一起自动安装的图形界面工具数据库管理。</p>
<p>打开后，pgAdmin会要求您输入密码才能登录。下面是新安装的PostgreSQL数据库的概述。</p>
<p><img data-attachment-id="15690" data-permalink="https://blog.logrocket.com/getting-started-with-postgres-in-your-react-app/postresql-database-overview-pgadmin/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/03/postresql-database-overview-pgadmin.png" data-orig-size="720,351" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="PostgreSQL database overview in pgAdmin" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/03/postresql-database-overview-pgadmin-300x146.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/03/postresql-database-overview-pgadmin.png" decoding="async" class="aligncenter size-full wp-image-15690 jetpack-lazy-image" src="../Images/2f1c316eea648673aa0f3ac86fa589af.png" alt="PostgreSQL Database Overview in pgAdmin" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/03/postresql-database-overview-pgadmin.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/03/postresql-database-overview-pgadmin-300x146.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/03/postresql-database-overview-pgadmin.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/03/postresql-database-overview-pgadmin.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="15690" data-permalink="https://blog.logrocket.com/getting-started-with-postgres-in-your-react-app/postresql-database-overview-pgadmin/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/03/postresql-database-overview-pgadmin.png" data-orig-size="720,351" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="PostgreSQL database overview in pgAdmin" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/03/postresql-database-overview-pgadmin-300x146.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/03/postresql-database-overview-pgadmin.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-15690" src="../Images/2f1c316eea648673aa0f3ac86fa589af.png" alt="PostgreSQL Database Overview in pgAdmin" srcset="https://blog.logrocket.com/wp-content/uploads/2020/03/postresql-database-overview-pgadmin.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/03/postresql-database-overview-pgadmin-300x146.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/03/postresql-database-overview-pgadmin.png"/></noscript>
<h2 id="creatingapostgresdatabase">创建Postgres数据库</h2>
<p>为了更好地理解SQL语言，我们需要从终端创建一个数据库和表。</p>
<p>要从终端访问PostgreSQL，使用带有选项<code>-d</code>的命令<code>psql</code>来选择想要访问的数据库，使用<code>-U</code>来选择用户。如果终端回复说没有找到<code>psql</code>命令，您很可能需要将Postgres <code>bin/</code>和<code>lib/</code>目录添加到您的系统路径中。</p>
<pre>psql -d postgres -U postgres
</pre>
<p>您将被要求输入密码。使用您之前创建的密码。登录后，通过添加密码为“root”的登录权限来创建一个新用户</p>
<pre>CREATE ROLE my_user WITH LOGIN PASSWORD 'root';
</pre>
<p>用户只是一个拥有登录权限的角色。现在您已经有了一个，通过发出<code>ALTER ROLE [role name] CREATEDB</code>语法授予它创建数据库的权限。</p>
<pre>ALTER ROLE my_user CREATEDB;
</pre>
<p>使用<code>\q</code>命令从超级用户<code>postgres</code>注销并以<code>my_user</code>的身份登录。</p>
<pre>\q
psql -d postgres -U my_user 
</pre>
<p>现在您回到了里面，创建一个名为<code>my_database</code>的新数据库。</p>
<pre>CREATE DATABASE my_database;
</pre>
<p>您可能想知道，为什么我们不能使用默认的<code>postgres</code>用户来创建数据库呢？这是因为默认用户是超级用户，这意味着它可以访问数据库中的所有内容。根据Postgres <a href="https://www.postgresql.org/docs/12/sql-createrole.html" target="_blank" rel="noopener noreferrer">文档</a>，“超级用户身份是危险的，应该只在真正需要的时候使用。”</p>
<p>基于SQL的数据库将数据存储在表中。现在您已经有了一个数据库，让我们创建一个简单的表来记录您的数据。</p>
<pre>CREATE TABLE merchants( id SERIAL PRIMARY KEY, name VARCHAR(30), email VARCHAR(30) );
</pre>
<p>一个数据库可以有多个表，但是在本教程中我们使用一个表就可以了。如果您想检查创建的数据库和表，您可以分别使用命令<code>\list</code>和<code>\dt</code>。您可能会看到更多或更少的行，但是只要您有数据库和之前创建的表，您的表应该如下所示:</p>
<pre>my_database=&gt; \list
          List of databases
 Name        |  Owner   | Encoding
 my_database | my_user  | UTF8     
 postgres    | postgres | UTF8     
 template0   | postgres | UTF8     
 template1   | postgres | UTF8     


my_database=&gt; \dt
          List of relations
 Schema |   Name    | Type  |  Owner
--------+-----------+-------+---------
 public | merchants | table | my_user
</pre>
<p>现在有了一个可以插入数据的表。让我们接下来做那件事。</p>
<h2 id="basicsqlqueries">基本SQL查询</h2>
<p>Postgres是一个基于SQL的系统，这意味着你需要使用SQL语言来存储和操作它的数据。让我们探索四个可以使用SQL查询的基本例子。</p>
<h3>1.选择查询</h3>
<p>要从一个表中检索数据，使用<code>SELECT</code>键，后跟要检索的列名和表名。</p>
<pre>SELECT id, name, email from merchants;
</pre>
<p>要检索表中的所有列，只需使用<code>SELECT *</code>。</p>
<pre>SELECT * from merchants;
</pre>
<h3>2.插入查询</h3>
<p>要向表中插入新数据，请使用关键字<code>INSERT</code>，后跟表名、列名和值。</p>
<pre>INSERT INTO merchants (name, email) VALUES ('john', '<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="94fefbfcfad4f9f5fdf8baf7fbf9">[email protected]</a>');
</pre>
<h3>3.删除查询</h3>
<p>您可以使用<code>DELETE</code>关键字从表格中删除一行。</p><div class="code-block code-block-54">
<hr/>
<h3>更多来自LogRocket的精彩文章:</h3>

<hr/></div>
<pre>DELETE from merchants WHERE id = 1;
</pre>
<p>当使用删除查询时，不要忘记用<code>WHERE</code>关键字指定要删除的行。否则，您将删除该表中的所有行。</p>
<h3>4.更新查询</h3>
<p>要更新某一行，可以使用<code>UPDATE</code>关键字。</p>
<pre>UPDATE merchants SET name = 'jake', email = '<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b9d3d8d2dcf9d4d8d0d597dad6d4">[email protected]</a>' WHERE id = 1;
</pre>
<p>现在您已经知道了如何操作表中的数据，让我们来看看如何连接数据库以作出反应。</p>
<h2 id="creatinganapiserverwithnodejsandexpress">用Node.js和Express创建API服务器</h2>
<p>要将React应用程序与PostgreSQL数据库连接起来，必须首先创建一个可以处理HTTP请求的API服务器。让我们用NodeJS和Express建立一个简单的。</p>
<p>使用以下命令从终端创建一个新目录并设置一个新的npm包。</p>
<pre>mkdir node-postgres &amp;&amp; cd node-postgres
npm init
</pre>
<p>你可以随意填写你的包裹信息，但这里有一个我的<code>package.json</code>的例子:</p>
<pre>{
  "name": "node-postgres",
  "version": "1.0.0",
  "description": "Learn how NodeJS and Express can interact with PostgreSQL",
  "main": "index.js",
  "license": "ISC"
}
</pre>
<p>接下来，安装所需的软件包。</p>
<pre>npm i express pg
</pre>
<p>Express是一个极简的web框架，您可以使用它在Node.js技术的基础上编写web应用程序，而<code>node-postgres(pg)</code>是一个客户端库，它使Node.js应用程序能够与PostgreSQL进行通信。</p>
<p>一旦两者都安装完毕，创建一个包含以下内容的<code>index.js</code>文件。</p>
<pre>const express = require('express')
const app = express()
const port = 3001

app.get('/', (req, res) =&gt; {
  res.status(200).send('Hello World!');
})

app.listen(port, () =&gt; {
  console.log(`App running on port ${port}.`)
})
</pre>
<p>在同一个目录中打开您的终端并运行<code>node index.js</code>。您的节点应用程序将在端口3001上运行，因此打开浏览器并导航到<a href="http://localhost:3001" rel="nofollow"> http://localhost:3001 </a>。你会看到“你好，世界！”浏览器中显示的文本。</p>
<p>现在，您已经拥有了编写API所需的一切。</p>
<h2 id="makingnodejstalkwithpostgres">让NodeJS与Postgres交谈</h2>
<p><code>pg</code>库允许您的节点应用程序与Postgres对话，所以您需要首先导入它。创建一个名为<code>merchant_model.js</code>的新文件，并输入以下代码。</p>
<pre>const Pool = require('pg').Pool
const pool = new Pool({
  user: 'my_user',
  host: 'localhost',
  database: 'my_database',
  password: 'root',
  port: 5432,
});
</pre>
<p>请注意，在生产环境中，不建议像上面示例中那样输入用户、主机、数据库、密码和端口等凭据。为了简化教程，我们将把它保存在这个文件中。</p>
<p>上面创建的池对象将允许您查询它所连接的数据库。让我们创建三个查询来利用这个池。这些查询将被放在一个函数中，您可以从您的<code>index.js</code>中调用这个函数。</p>
<pre>const getMerchants = () =&gt; {
  return new Promise(function(resolve, reject) {
    pool.query('SELECT * FROM merchants ORDER BY id ASC', (error, results) =&gt; {
      if (error) {
        reject(error)
      }
      resolve(results.rows);
    })
  }) 
}
const createMerchant = (body) =&gt; {
  return new Promise(function(resolve, reject) {
    const { name, email } = body
    pool.query('INSERT INTO merchants (name, email) VALUES ($1, $2) RETURNING *', [name, email], (error, results) =&gt; {
      if (error) {
        reject(error)
      }
      resolve(`A new merchant has been added added: ${results.rows[0]}`)
    })
  })
}
const deleteMerchant = () =&gt; {
  return new Promise(function(resolve, reject) {
    const id = parseInt(request.params.id)
    pool.query('DELETE FROM merchants WHERE id = $1', [id], (error, results) =&gt; {
      if (error) {
        reject(error)
      }
      resolve(`Merchant deleted with ID: ${id}`)
    })
  })
}

module.exports = {
  getMerchants,
  createMerchant,
  deleteMerchant,
}
</pre>
<p>上面的代码将处理并导出<code>getMerchants</code>、<code>createMerchant</code>和<code>deleteMerchant</code>函数。现在是时候更新您的<code>index.js</code>文件并使用这些函数了。</p>
<pre>const express = require('express')
const app = express()
const port = 3001

const merchant_model = require('./merchant_model')

app.use(express.json())
app.use(function (req, res, next) {
  res.setHeader('Access-Control-Allow-Origin', 'http://localhost:3000');
  res.setHeader('Access-Control-Allow-Methods', 'GET,POST,PUT,DELETE,OPTIONS');
  res.setHeader('Access-Control-Allow-Headers', 'Content-Type, Access-Control-Allow-Headers');
  next();
});

app.get('/', (req, res) =&gt; {
  merchant_model.getMerchants()
  .then(response =&gt; {
    res.status(200).send(response);
  })
  .catch(error =&gt; {
    res.status(500).send(error);
  })
})

app.post('/merchants', (req, res) =&gt; {
  merchant_model.createMerchant(req.body)
  .then(response =&gt; {
    res.status(200).send(response);
  })
  .catch(error =&gt; {
    res.status(500).send(error);
  })
})

app.delete('/merchants/:id', (req, res) =&gt; {
  merchant_model.deleteMerchant(req.params.id)
  .then(response =&gt; {
    res.status(200).send(response);
  })
  .catch(error =&gt; {
    res.status(500).send(error);
  })
})
app.listen(port, () =&gt; {
  console.log(`App running on port ${port}.`)
})
</pre>
<p>现在您的应用程序有三个可以接受请求的HTTP路由。编写第7行的代码是为了让Express可以接受带有JSON有效负载的传入请求。为了允许React对这个应用程序的请求，我还添加了<code>Access-Control-Allow-Origin</code>、<code>Access-Control-Allow-Methods</code>和<code>Access-Control-Allow-Headers</code>的标题。</p>
<h2 id="creatingyourreactapplication">创建您的React应用程序</h2>
<p>您的API已经准备好服务和处理请求。现在是时候创建一个React应用程序来发送请求了。</p>
<p>让我们用<code>create-react-app</code>命令引导React应用程序。</p>
<pre>npx create-react-app react-postgres
</pre>
<p>在你的React app目录中，你可以删除<code>src/</code>目录中的所有内容。</p>
<p>现在让我们从头开始编写一个简单的React应用程序。</p>
<p>首先，用以下内容创建一个<code>App.js</code>文件。</p>
<pre>import React, {useState, useEffect} from 'react';
function App() {
  const [merchants, setMerchants] = useState(false);
  useEffect(() =&gt; {
    getMerchant();
  }, []);
  function getMerchant() {
    fetch('http://localhost:3001')
      .then(response =&gt; {
        return response.text();
      })
      .then(data =&gt; {
        setMerchants(data);
      });
  }
  function createMerchant() {
    let name = prompt('Enter merchant name');
    let email = prompt('Enter merchant email');
    fetch('http://localhost:3001/merchants', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({name, email}),
    })
      .then(response =&gt; {
        return response.text();
      })
      .then(data =&gt; {
        alert(data);
        getMerchant();
      });
  }
  function deleteMerchant() {
    let id = prompt('Enter merchant id');
    fetch(`http://localhost:3001/merchants/${id}`, {
      method: 'DELETE',
    })
      .then(response =&gt; {
        return response.text();
      })
      .then(data =&gt; {
        alert(data);
        getMerchant();
      });
  }
  return (
    &lt;div&gt;
      {merchants ? merchants : 'There is no merchant data available'}
      &lt;br /&gt;
      &lt;button onClick={createMerchant}&gt;Add merchant&lt;/button&gt;
      &lt;br /&gt;
      &lt;button onClick={deleteMerchant}&gt;Delete merchant&lt;/button&gt;
    &lt;/div&gt;
  );
}
export default App;
</pre>
<p>这个React应用程序将向您创建的Express服务器发送请求。它有两个按钮来添加和删除商家。函数<code>getMerchant</code>将从服务器获取商户数据，并将结果设置为<code>merchant</code>状态。</p>
<p>当您点击按钮时，<code>createMerchant</code>和<code>deleteMerchant</code>将分别启动添加和删除商户的流程。</p>
<p>最后，创建一个<code>index.js</code>文件并呈现<code>App</code>组件。</p>
<pre>import React from 'react';
import ReactDOM from 'react-dom';
import App from './App';

ReactDOM.render(&lt;App /&gt;, document.getElementById('root'));
</pre>
<p>现在用<code>npm start</code>运行你的React应用。您可以测试并查看从React应用程序收集的数据是如何记录到PostgreSQL中的。我将把<code>UPDATE</code>查询的实现留给您作为练习。</p>
<h2 id="conclusion">结论</h2>
<p>现在，您已经知道如何安装PostgreSQL数据库，创建数据库和表，并构建一个最小的API作为React应用程序和数据库之间的桥梁。我们创建了一个如何将Postgres与React一起使用的端到端示例，并演示了当您从React应用程序发送这些HTTP请求时会发生什么。</p>
<p>本教程远非后端编程的完整指南，但它足以帮助您开始理解后端是如何工作的。</p>
<p>如果您发现任何错误或无法从应用程序中插入数据，您可以从<a href="https://github.com/nsebhastian/react-node-postgres">这个repo </a>中克隆完整的源代码，并将repo中的代码与您的示例进行比较。</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用LogRocket消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款React analytics解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket告诉您React应用程序中实际影响用户的最具影响力的bug和UX问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS异常、前端性能指标和用户交互。然后，LogRocket使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试LogRocket】。</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>