<html>
<head>
<title>Authenticating React applications with Magic Links - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用神奇的链接认证React应用程序</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/authenticating-react-applications-with-magic-links/#0001-01-01">https://blog.logrocket.com/authenticating-react-applications-with-magic-links/#0001-01-01</a></blockquote><div><article class="article-post">
<p>安全性是任何web应用程序的一个基本特性，可以防止未经授权的入侵和数据窃取。保护应用的一种方法是通过身份验证。身份验证有助于控制用户对部分应用程序的访问，并确定用户的身份。</p>
<p>React应用程序的身份验证策略包括:</p>
<ul>
<li>密码</li>
<li>双因素身份验证(2FA)</li>
<li>卡查斯</li>
<li>令牌(Token)</li>
<li>单点登录(SSO)</li>
</ul>
<p>在本教程中，我们将介绍:</p>
<ul>
<li>使用React设置基本认证流程</li>
<li>控制对应用程序特定部分的访问</li>
<li>神奇链接背后的想法</li>
<li>将神奇链接集成到React应用程序中</li>
</ul>
<h2 id="whataremagiclinks">什么是神奇链接？</h2>
<p>神奇链接提供了一种无需密码即可验证用户身份的方法。Magic Link是由Fortmatic开发的，每当用户注册或登录应用程序时，Magic SDK都会生成一个链接。</p>
<p>当用户注册或登录时，会发生以下情况。</p>
<ol>
<li>一个神奇的链接被生成并发送到用户的电子邮件地址</li>
<li>用户点击链接，Magic对用户进行身份验证</li>
<li>如果成功，用户将被重定向回最初的身份验证点；如果不成功，将显示一个错误页面</li>
</ol>
<h2 id="whymagiclinks">为什么是魔法链接？</h2>
<p>对于用户来说，Magic Links消除了设置和记忆安全密码的麻烦。它还让您不必在数据库中存储和管理用户密码和会话。它使用一个类似SSH的基于区块链的密钥管理系统，因此每当用户注册或登录时，它都会生成一个公钥-私钥对，随后用于验证用户的请求。</p>
<h2 id="prerequisites">先决条件</h2>
<p>要跟随本教程，您需要以下内容。</p>
<ul>
<li>npm &gt;= v5.2或纱线</li>
<li>React和JavaScript知识</li>
<li>代码编辑器</li>
<li>一个<a href="https://dashboard.magic.link/login" target="_blank" rel="noopener noreferrer">神奇的</a>账户</li>
</ul>
<h2 id="creatingareactapplication">创建React应用程序</h2>
<p>首先，我们必须创建一个新的React项目。打开您的终端，运行:</p>
<pre>npx create-react-app react-magic-tutorial
</pre>
<p>这将在<code>react-magic-tutorial</code>目录中创建一个React项目。要运行该应用程序，请转到该目录的根目录，并通过运行以下命令启动该应用程序。</p>
<pre>cd react-magic-tutorial
npm start
</pre>
<h2 id="settingupmagic">设置魔法</h2>
<p>在为React应用程序创建组件之前，我们需要设置神奇的服务。</p>
<p>登录到<a href="https://dashboard.magic.link/login" target="_blank" rel="noopener noreferrer"> Magic </a>，获取你的测试可发布API密匙以访问Magic服务，并复制它。在应用程序的根目录中创建一个<code>.env</code>文件，在编辑器中打开该文件并粘贴以下内容。</p>
<pre>REACT_APP_PK_KEY=API_KEY
</pre>
<p>用你复制的密钥替换<code>API_KEY</code>，然后回到你的终端，安装Magic SDK。</p>
<pre>npm install --save magic-sdk
</pre>
<p>接下来，创建一个文件来处理魔术服务:</p>
<pre>mkdir service
cd service
touch magic.js
</pre>
<p>这将在服务目录中创建一个<code>magic.js</code>文件。在编辑器中打开该文件，并粘贴以下内容。</p>
<pre>import { Magic } from 'magic-sdk';
const magic = new Magic(process.env.REACT_APP_PK_KEY);

export const checkUser = async (cb) =&gt; {
  const isLoggedIn = await magic.user.isLoggedIn();
  if (isLoggedIn) {
    const user = await magic.user.getMetadata();
    return cb({ isLoggedIn: true, email: user.email });
  }
  return cb({ isLoggedIn: false });
};

export const loginUser = async (email) =&gt; {
  await magic.auth.loginWithMagicLink({ email });
};

export const logoutUser = async () =&gt; {
  await magic.user.logout();
};
</pre>
<p><code>magic</code>变量用你的可发布的<code>API_KEY</code>初始化魔术服务。<code>checkUser</code>函数接受回调<code>cb</code>作为参数，并检查用户是否登录。如果用户已登录，它将获取用户元数据并将其传递给回调函数。如果用户没有登录，它将返回回调函数，并将<code>isLoggedIn</code>属性设置为false。</p>
<p><code>loginUser</code>函数将用户电子邮件作为参数传递给<code>magic.auth.loginWithMagicLink({ email })</code>函数。该函数负责创建并向用户发送登录链接，并创建用户会话。<code>logoutUser</code>函数将用户注销并销毁会话。</p>
<h2 id="buildingreactcomponents">构建反应组件</h2>
<p>下一步是创建我们的应用程序所需的组件:</p>
<ol>
<li><code>Authenticate</code> —允许用户注册或登录的表单组件</li>
<li><code>Dashboard</code> —显示认证是否成功的组件</li>
<li><code>PrivateRoute</code> —在呈现组件之前检查用户是否被认证的包装组件；否则，它会将用户重定向回注册/登录页面</li>
<li><code>App</code> —主要应用组件。如果用户没有登录，它将呈现<code>Authentication</code>组件；如果用户登录，它将呈现<code>Dashboard</code>组件。</li>
</ol>
<p>稍后我们将使用React上下文将用户数据传递给基于用户是否经过身份验证而呈现的组件。我们还将使用<a href="https://reacttraining.com/react-router/web/guides/quick-start" target="_blank" rel="noopener noreferrer"> React路由器</a>来处理路由。</p>
<p>要安装React路由器，请运行以下命令。</p>
<pre>npm install react-router-dom
</pre>
<p>安装后，运行以下命令。</p>
<pre>cd src
mkdir components
cd components
touch Authenticate.js DashBoard.js PrivateRoute.js
</pre>
<p>这将创建一个组件目录，其中包含了<code>src</code>目录中的组件。你的文件夹结构应该类似于下面的截图。</p>
<p><img data-attachment-id="20212" data-permalink="https://blog.logrocket.com/authenticating-react-applications-with-magic-links/folder-structure-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/06/folder-structure.png" data-orig-size="376,485" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Folder structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/06/folder-structure-233x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/06/folder-structure.png" decoding="async" class="aligncenter size-full wp-image-20212 jetpack-lazy-image" src="../Images/cde92c3bf48936d400bf2d56df29ff50.png" alt="Folder Structure" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/06/folder-structure.png 376w, https://blog.logrocket.com/wp-content/uploads/2020/06/folder-structure-233x300.png 233w" data-lazy-sizes="(max-width: 376px) 100vw, 376px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/06/folder-structure.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/06/folder-structure.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="20212" data-permalink="https://blog.logrocket.com/authenticating-react-applications-with-magic-links/folder-structure-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/06/folder-structure.png" data-orig-size="376,485" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Folder structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/06/folder-structure-233x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/06/folder-structure.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-20212" src="../Images/cde92c3bf48936d400bf2d56df29ff50.png" alt="Folder Structure" srcset="https://blog.logrocket.com/wp-content/uploads/2020/06/folder-structure.png 376w, https://blog.logrocket.com/wp-content/uploads/2020/06/folder-structure-233x300.png 233w" sizes="(max-width: 376px) 100vw, 376px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/06/folder-structure.png"/></noscript>
<p>我们将使用React引导库来设计项目的样式。运行以下命令安装库。</p>
<pre>npm install react-bootstrap bootstrap
</pre>
<p>打开<code>Authtentication.js</code>文件夹，粘贴以下内容。</p>
<pre>import React, { useState } from 'react';
import { useHistory } from 'react-router-dom';
import {
  Button,
  Form,
  FormGroup,
  FormLabel,
  FormControl,
} from 'react-bootstrap';
import { loginUser } from '../services/magic';
const Authenticate = () =&gt; {
  const [email, setEmail] = useState('');
  const [loading, setLoading] = useState('');
  const [error, setError] = useState(null);
  const history = useHistory();
  const handleSubmit = async (event) =&gt; {
    event.preventDefault();
    setLoading(true);
    if (!email) {
      setLoading(false);
      setError('Email is Invalid');
      return;
    }
    try {
      await loginUser(email);
      setLoading(false);
      history.replace('/dashboard');
    } catch (error) {
      setError('Unable to log in');
      console.error(error);
    }
  };
  const handleChange = (event) =&gt; {
    setEmail(event.target.value);
  };
  return (
    &lt;div className="w-50 p-5 mt-5 mx-auto"&gt;
      &lt;h1 className="h1 text-center"&gt;React Magic Form&lt;/h1&gt;
      &lt;Form onSubmit={handleSubmit} className="p-2 my-5 mx-auto"&gt;
        &lt;FormGroup className="mt-3" controlId="formBasicEmail"&gt;
          &lt;FormLabel fontSize="sm"&gt;Enter Email Address&lt;/FormLabel&gt;
          &lt;FormControl
            type="email"
            name="email"
            id="email"
            value={email}
            onChange={handleChange}
            placeholder="Email Address"
          /&gt;
          &lt;p className="text-danger text-small"&gt;{error}&lt;/p&gt;
        &lt;/FormGroup&gt;
        &lt;Button
          type="submit"
          size="md"
          className="d-block w-100"
          variant="primary"
        &gt;
          {loading ? 'Loading...' : 'Send'}
        &lt;/Button&gt;
      &lt;/Form&gt;
    &lt;/div&gt;
  );
};
export default Authenticate;
</pre>
<p>该组件创建一个表单，其中包含一个电子邮件地址的文本字段和一个按钮，用于发送用户输入的电子邮件的神奇链接。当用户点击按钮时，它运行<code>handleSubmit</code>函数，该函数验证电子邮件地址并从<code>magic.js</code>服务文件中调用<code>loginUser</code>函数。</p>
<p><img data-attachment-id="20211" data-permalink="https://blog.logrocket.com/authenticating-react-applications-with-magic-links/authenticate-component/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/06/authenticate-component.png" data-orig-size="730,436" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Authenticate component" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/06/authenticate-component-300x179.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/06/authenticate-component.png" decoding="async" class="aligncenter size-full wp-image-20211 jetpack-lazy-image" src="../Images/c1c3e50bbb6f36799ec738f2b0a1b0ff.png" alt="Authenticate Component" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/06/authenticate-component.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/06/authenticate-component-300x179.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/06/authenticate-component.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/06/authenticate-component.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="20211" data-permalink="https://blog.logrocket.com/authenticating-react-applications-with-magic-links/authenticate-component/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/06/authenticate-component.png" data-orig-size="730,436" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Authenticate component" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/06/authenticate-component-300x179.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/06/authenticate-component.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-20211" src="../Images/c1c3e50bbb6f36799ec738f2b0a1b0ff.png" alt="Authenticate Component" srcset="https://blog.logrocket.com/wp-content/uploads/2020/06/authenticate-component.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/06/authenticate-component-300x179.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/06/authenticate-component.png"/></noscript>
<p>我们要解决的下一个组件是<code>Dashboard</code>组件。但是首先，让我们创建一个用户上下文，将用户数据传递给我们的<code>Dashboard</code>组件。在<code>src</code>目录中，运行以下命令。</p>
<pre>mkdir context
cd context
touch userContext.js
</pre>
<p>这将在上下文目录中创建一个<code>userContext</code>文件。打开文件并输入以下内容。</p>
<pre>import { createContext } from 'react';
export const UserContext = createContext({ user: null });
</pre>
<p>默认情况下，<code>UserContext</code>创建一个上下文并将用户属性设置为null。要了解更多关于上下文以及如何有效地使用它们，请阅读<a href="https://reactjs.org/docs/context.html" target="_blank" rel="noopener noreferrer"> React关于上下文</a>的文档。</p>
<p>打开<code>Dashboard.js</code>组件文件，输入以下内容。</p>
<pre>import React, { useContext } from 'react';
import { useHistory } from 'react-router-dom';
import Button from 'react-bootstrap/Button';
import { UserContext } from '../context/UserContext';
import { logoutUser } from '../services/magic';
const Dashboard = () =&gt; {
  const { email } = useContext(UserContext);
  const history = useHistory();
  const handleLogOut = async () =&gt; {
    try {
      await logoutUser();
      history.replace('/');
    } catch (error) {
      console.error(error);
    }
  };
  return (
    &lt;div className="p-2"&gt;
      &lt;div className="d-flex justify-content-end"&gt;
        &lt;Button variant="primary" onClick={handleLogOut}&gt;
          Sign Out
        &lt;/Button&gt;
      &lt;/div&gt;
      &lt;h1 className="h1"&gt;User: {email}&lt;/h1&gt;
    &lt;/div&gt;
  );
};
export default Dashboard;
</pre>
<p>仪表板组件显示登录的用户电子邮件和注销按钮。从上下文<code>UserContext</code>中获取登录用户；我们使用<code>useContext</code>钩子从<code>UserContext</code>中获取我们需要的数据。</p>
<p>当用户点击退出按钮时，它调用<code>handleLogOut</code>函数。<code>handleLogOut</code>函数从魔术服务中调用<code>logoutUser</code>函数，负责破坏用户会话并注销用户。</p>
<p>之后，我们使用<code>react-router-dom</code>包的<code>useHistory</code>钩子将用户重定向回注册页面。<code>useHistory</code>钩子让我们能够访问用户的会话历史，并允许我们将用户重定向到历史上的某个点。</p>
<p><img data-attachment-id="20214" data-permalink="https://blog.logrocket.com/authenticating-react-applications-with-magic-links/user-email-signout/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/06/user-email-signout.png" data-orig-size="730,212" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="User email and sign out button" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/06/user-email-signout-300x87.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/06/user-email-signout.png" decoding="async" class="aligncenter size-full wp-image-20214 jetpack-lazy-image" src="../Images/6c2d70262797a548db65ccb8f4cde46e.png" alt="User Email and Sign Out Button" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/06/user-email-signout.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/06/user-email-signout-300x87.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/06/user-email-signout.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/06/user-email-signout.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="20214" data-permalink="https://blog.logrocket.com/authenticating-react-applications-with-magic-links/user-email-signout/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/06/user-email-signout.png" data-orig-size="730,212" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="User email and sign out button" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/06/user-email-signout-300x87.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/06/user-email-signout.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-20214" src="../Images/6c2d70262797a548db65ccb8f4cde46e.png" alt="User Email and Sign Out Button" srcset="https://blog.logrocket.com/wp-content/uploads/2020/06/user-email-signout.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/06/user-email-signout-300x87.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/06/user-email-signout.png"/></noscript>
<p>接下来，我们创建<code>PrivateRoute</code>组件。<code>PrivateRoute</code>组件允许我们为应用程序创建受保护的路由——用户只有登录后才能访问的路由，比如仪表板。</p>
<p>打开<code>PrivateRoute.js</code>文件，输入以下内容。</p>
<pre>import React, { useContext } from 'react';
import { Redirect, Route } from 'react-router-dom';
import { UserContext } from '../context/UserContext';
const PrivateRoute = ({ component: Component, ...rest }) =&gt; {
  const { isLoggedIn } = useContext(UserContext);
  return (
    &lt;Route
      {...rest}
      render={(props) =&gt;
        isLoggedIn ? &lt;Component {...props} /&gt; : &lt;Redirect to="/" /&gt;
      }
    /&gt;
  );
};
export default PrivateRoute;
</pre>
<p><code>PrivateRoute</code>是<code>react-router-dom</code>的<code>Route</code>组件的包装器。它检查用户的登录状态<code>isLoggedIn</code>，这是从<code>UserContext</code>中获取的。如果登录状态为真，则渲染<code>Component</code>道具。如果没有，我们使用另一个名为<code>Redirect</code>的<code>react-router-dom</code>组件，它将用户重定向到一个位置——在本例中是身份验证页面。</p>
<p>所有这些都完成后，我们将所有的东西放在我们的<code>App</code>组件中。打开根目录中的<code>App.js</code>组件，输入以下内容。</p>
<pre>import React, { useState, useEffect } from 'react';
import {
  Switch,
  BrowserRouter as Router,
  Route,
  Redirect,
} from 'react-router-dom';
import Spinner from 'react-bootstrap/Spinner';
import { UserContext } from './context/UserContext';
import { checkUser } from './services/magic';
import Authenticate from './components/Authenticate';
import Dashboard from './components/Dashboard';
import PrivateRoute from './components/PrivateRoute';
const App = () =&gt; {
  const [user, setUser] = useState({ isLoggedIn: null, email: '' });
  const [loading, setLoading] = useState();
  useEffect(() =&gt; {
    const validateUser = async () =&gt; {
      setLoading(true);
      try {
        await checkUser(setUser);
        setLoading(false);
      } catch (error) {
        console.error(error);
      }
    };
    validateUser();
  }, [user.isLoggedIn]);
  if (loading) {
    return (
      &lt;div
        className="d-flex justify-content-center align-items-center"
        style={{ height: '100vh' }}
      &gt;
        &lt;Spinner animation="border" /&gt;
      &lt;/div&gt;
    );
  }
  return (
    &lt;UserContext.Provider value={user}&gt;
      &lt;Router&gt;
        {user.isLoggedIn &amp;&amp; &lt;Redirect to={{ pathname: '/dashboard' }} /&gt;}
        &lt;Switch&gt;
          &lt;Route exact path="/" component={Authenticate} /&gt;
          &lt;PrivateRoute path="/dashboard" component={Dashboard} /&gt;
        &lt;/Switch&gt;
      &lt;/Router&gt;
    &lt;/UserContext.Provider&gt;
  );
};
export default App;
</pre>
<p>App组件中首先要注意的是<code>useEffect</code> hoo。每当应用程序呈现或者用户状态的<code>isLoggedIn</code>属性改变时，我们用这个来验证用户。<code>validateUser</code>函数调用了我们神奇服务的<code>checkUser</code>函数，它检查用户是否登录。它接受一个回调，这是我们的<code>setUser</code>函数，并根据<code>checkUser</code>函数返回的内容设置用户状态。如果<code>isLoggedIn</code>属性为真，那么用户被重定向到仪表板。我们使用<code>UserContext.Provider</code>将用户状态传递给应用程序的子组件。</p>
<p>我们的应用程序有两个路由:<code>/</code>路由，它呈现<code>Authentication</code>组件(我们的默认组件)，以及前面提到的作为<code>Route</code>组件包装器的<code>PrivateRoute</code>,它仅在用户登录时呈现<code>Dashboard</code>组件。<code>Switch</code>组件通过检查<code>Route</code>组件的路径来确保一次只呈现一条路线。</p>
<p>现在我们的应用程序已经准备好了。启动它并测试身份验证流程。输入电子邮件地址后，会有一个链接发送到你的邮箱。当您单击该链接时，它会引导您返回到应用程序，在确认链接的有效性后，会将您重定向到仪表板。</p>
<p>如果你玩够了，你可以退出，这将带你回到登录页面。</p>
<p><img data-attachment-id="20213" data-permalink="https://blog.logrocket.com/authenticating-react-applications-with-magic-links/react-magic-form/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/06/react-magic-form.gif" data-orig-size="730,522" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React Magic form" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/06/react-magic-form-300x215.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/06/react-magic-form.gif" decoding="async" class="aligncenter size-full wp-image-20213 jetpack-lazy-image" src="../Images/7fd3098a0e750a28f78ff6a8784afc1b.png" alt="React Magic Form" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/06/react-magic-form.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/06/react-magic-form.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="20213" data-permalink="https://blog.logrocket.com/authenticating-react-applications-with-magic-links/react-magic-form/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/06/react-magic-form.gif" data-orig-size="730,522" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="React Magic form" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/06/react-magic-form-300x215.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/06/react-magic-form.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-20213" src="../Images/7fd3098a0e750a28f78ff6a8784afc1b.png" alt="React Magic Form" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/06/react-magic-form.gif"/></noscript>
<h1 id="conclusion">结论</h1>
<p>在本教程中，我们介绍了如何使用神奇的链接来保护React应用程序。Magic service提供了超出本文范围的更多内容，并支持与现有基础设施的集成。为了扩展你关于神奇链接的知识，我建议阅读官方文档。</p>
<p>在保护您的应用程序时，没有通用的方法。Magic是您可能已经习惯的流行身份验证策略的可行替代方案。</p>
<p>您可以找到我们在<a href="https://github.com/sa-ma/react-magic-link-test" target="_blank" rel="noopener noreferrer"> GitHub </a>上构建的应用程序的存储库。</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用LogRocket消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款React analytics解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket告诉您React应用程序中实际影响用户的最具影响力的bug和UX问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS异常、前端性能指标和用户交互。然后，LogRocket使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试LogRocket】。</a></p>
</div></div>
<h1 id="es6keyedcollectionsmapsandsets"/>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>