<html>
<head>
<title>Refactoring a Redux app to use Recoil - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>重构Redux应用程序以使用反冲日志火箭博客</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/#0001-01-01">https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/#0001-01-01</a></blockquote><div><article class="article-post">
<p>反冲是几个月前才发布的，但GitHub上已经有近9K颗星星了，新的状态管理库正在飙升。</p>
<p>在这篇文章中，我将讨论如何重构一个Redux应用程序来反冲。我的目标不是重构一个巨大的Redux app来反冲，而是重构三个小app来反冲。我来分享一下原因。</p>
<p>一个非常好的学习策略是从已知到未知——在这种情况下，从重复到反冲。这是一个有效的学习策略，尤其是如果你已经有了相当不错的Redux使用经验的话。</p>
<p>我相信您会更好地理解这两个库之间的区别(至少在API实现方面),并理解为什么反冲如此突出。也有可能你会发现自己处于一种不得不重构Redux应用程序的境地。这篇文章将为您提供这样做的基础。</p>
<p>如果你对反冲完全陌生，请查看我的快速介绍文章，因为我会假设你从现在开始理解反冲中的原子和选择器。</p>
<p>让我们开始吧。</p>
<h3>HelloUI:用于UI开发的hello world应用</h3>
<p>许多编程教程都是从hello world程序开始的。对于UI开发，我们通常不这样做，但是我建议我们这样做。</p>
<p>考虑一下用于UI开发的hello world应用程序。</p>
<figure id="attachment_23720" aria-describedby="caption-attachment-23720" class="wp-caption aligncenter"><img data-attachment-id="23720" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/helloui-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-app.png" data-orig-size="730,457" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The HelloUI app" data-image-description="" data-image-caption="&lt;p&gt;HelloUI: The hello world app for UI development.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-app-300x188.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-app.png" decoding="async" class="size-full wp-image-23720 jetpack-lazy-image" src="../Images/dddf111fab177bdc778792b4b59834c7.png" alt="The HelloUI App" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-app-300x188.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-app.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-app.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="23720" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/helloui-app/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-app.png" data-orig-size="730,457" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The HelloUI app" data-image-description="" data-image-caption="&lt;p&gt;HelloUI: The hello world app for UI development.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-app-300x188.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-app.png" decoding="async" loading="lazy" class="size-full wp-image-23720" src="../Images/dddf111fab177bdc778792b4b59834c7.png" alt="The HelloUI App" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-app.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-app-300x188.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-app.png"/></noscript><figcaption id="caption-attachment-23720" class="wp-caption-text">HelloUI: The hello world app for UI development.</figcaption></figure>
<p>请随意查看HelloUI官方<a href="https://github.com/ohansemmanuel/HelloUI">自述</a>中的动机和方法。</p>
<p>我们首先要做的是重构一个hello world Redux应用程序来反冲。之后，我们将继续重构更复杂的Redux应用程序。</p>

<div class="podcast-container">
<div class="podcast-embed">
<h2>我们不只是写Redux，我们也谈论它。现在听着:</h2>
<p>或者以后订阅</p>
<h3>Redux应用#1: Hello world</h3>

</div>
</div>
<h2>hello world应用已经用<a href="https://github.com/facebook/create-react-app"> create-react-app </a>引导，通过<a href="https://github.com/reduxjs/react-redux"> react-redux </a>提供Redux的react绑定。</h2>
<p><img data-attachment-id="23722" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/hello-world-demo/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/hello-world-demo.gif" data-orig-size="730,371" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="HelloUI app demo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/hello-world-demo-300x152.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/hello-world-demo.gif" decoding="async" class="aligncenter size-full wp-image-23722 jetpack-lazy-image" src="../Images/0098bbc7239c3a63bda8b4d80cf8f6c3.png" alt="HelloUI App Demo" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/hello-world-demo.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/hello-world-demo.gif"/></p>
<p>开始重构的第一个地方是根文件。使用react-redux，您必须将入口组件包装在一个传递了<code>store</code>属性的<code>Provider</code>组件中。</p><noscript><img data-lazy-fallback="1" data-attachment-id="23722" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/hello-world-demo/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/hello-world-demo.gif" data-orig-size="730,371" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="HelloUI app demo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/hello-world-demo-300x152.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/hello-world-demo.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-23722" src="../Images/0098bbc7239c3a63bda8b4d80cf8f6c3.png" alt="HelloUI App Demo" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/hello-world-demo.gif"/></noscript>
<p>对于反冲，您也需要将根组件包装在一个“提供者”组件中。然而，不需要商店道具；那是一个与反冲格格不入的概念。</p>
<pre>import { Provider } from "react-redux";
import { store } from "./App";

... 

&lt;Provider store={store}&gt;
      &lt;App /&gt;
&lt;/Provider&gt;
...</pre>
<p>这些变化应该是这样的:</p>
<p><img data-attachment-id="23724" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/redux-recoil-hello-world-diff/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-hello-world-diff.png" data-orig-size="730,245" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Redux/Recoil hello world app diff" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-hello-world-diff-300x101.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-hello-world-diff.png" decoding="async" class="aligncenter size-full wp-image-23724 jetpack-lazy-image" src="../Images/b04fc640d55ef09c43f1f555114cc86b.png" alt="Redux/Recoil Hello World App Diff" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-hello-world-diff.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-hello-world-diff-300x101.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-hello-world-diff.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-hello-world-diff.png"/></p>
<pre>import { RecoilRoot } from "recoil";

...
&lt;RecoilRoot&gt;
   &lt;App /&gt;
&lt;/RecoilRoot&gt;
...</pre>
<p>需要反冲状态的组件必须在父树中有<code>RecoilRoot</code>组件。</p><noscript><img data-lazy-fallback="1" data-attachment-id="23724" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/redux-recoil-hello-world-diff/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-hello-world-diff.png" data-orig-size="730,245" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Redux/Recoil hello world app diff" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-hello-world-diff-300x101.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-hello-world-diff.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-23724" src="../Images/b04fc640d55ef09c43f1f555114cc86b.png" alt="Redux/Recoil Hello World App Diff" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-hello-world-diff.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-hello-world-diff-300x101.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-hello-world-diff.png"/></noscript>
<p>在内部，<code>RecoilRoot</code>组件<a href="https://github.com/facebookexperimental/Recoil/blob/a1613c401abfc7e2a775128ea6295c6dab26fc3e/src/core/Recoil_RecoilRoot.react.js#L277">实现</a>一个上下文<code>Provider</code>并呈现子组件。对于更高级的读者，您会注意到，与react-redux不同，<code>Provider</code>在内部跟踪状态值，因此您不必将<code>store</code>或<code>state</code>属性传递给<code>RecoilRoot</code>组件。</p>
<p>重构的第一步已经完成。接下来是:创建和更新全局状态。让我们来看看React应用程序是如何工作的。</p>
<p><img data-attachment-id="23725" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/helloui-planet-text/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text.png" data-orig-size="730,342" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The HelloUI planet text" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text-300x141.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text.png" decoding="async" class="aligncenter size-full wp-image-23725 jetpack-lazy-image" src="../Images/c41d39a50afef0cde6abedbe517c8da3.png" alt="Highlighting The HelloUI Planet Text" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text-300x141.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text.png"/></p>
<p>默认为“Web”的变化星球文本由Redux管理。这叫<code>activePlanet</code>。</p><noscript><img data-lazy-fallback="1" data-attachment-id="23725" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/helloui-planet-text/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text.png" data-orig-size="730,342" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The HelloUI planet text" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text-300x141.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-23725" src="../Images/c41d39a50afef0cde6abedbe517c8da3.png" alt="Highlighting The HelloUI Planet Text" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text-300x141.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text.png"/></noscript>
<p>要在Redux存储中创建一个状态值，必须向存储传递一个reducer。</p>
<pre>&lt;p&gt;
 Hello World from planet &lt;span className="planet"&gt;{activePlanet}&lt;/span&gt;
&lt;/p&gt;</pre>
<p>其中<code>planetsReducer</code>是指以下定义的app减速器:</p>
<pre>import { createStore } from "redux";

const store = createStore(planetsReducer);</pre>
<p>因为Redux状态更新依赖于被调度的动作，所以每个类型为<code>"SET_PLANET</code>的动作都返回一个由该动作的有效负载表示的新状态值。但是行动是如何进行的呢？</p>
<pre>const planetsReducer = (state = "Web", action) =&gt; {
  const { type, payload } = action;
  return  type === "SET_PLANET" ? payload : state;
}</pre>
<p><img data-attachment-id="23727" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/helloui-planet-text-buttons/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text-buttons.png" data-orig-size="730,342" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The HelloUI planet text buttons" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text-buttons-300x141.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text-buttons.png" decoding="async" class="aligncenter size-full wp-image-23727 jetpack-lazy-image" src="../Images/18693d33b4adc5351ce681b43d815bf1.png" alt="Highlighting The HelloUI Planet Text Buttons" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text-buttons.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text-buttons-300x141.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text-buttons.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text-buttons.png"/></p>
<p>单击任何一个行星按钮都会调度一个动作，该动作反过来会更新状态值。</p><noscript><img data-lazy-fallback="1" data-attachment-id="23727" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/helloui-planet-text-buttons/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text-buttons.png" data-orig-size="730,342" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The HelloUI planet text buttons" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text-buttons-300x141.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text-buttons.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-23727" src="../Images/18693d33b4adc5351ce681b43d815bf1.png" alt="Highlighting The HelloUI Planet Text Buttons" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text-buttons.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text-buttons-300x141.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/helloui-planet-text-buttons.png"/></noscript>
<p>这里，<code>handlePlanetUpdate</code>是传递给按钮元素的点击处理程序。</p>
<pre>const handlePlanetUpdate = (event) =&gt; {
    dispatch({ type: "SET_PLANET", payload: event.target.textContent });
  };</pre>
<p>现在你明白了Redux hello world app的工作原理，你认为当我们重构为反冲时会发生什么变化？</p>
<pre>... 
&lt;button onClick={handlePlanetUpdate} /&gt;
...</pre>
<p>首先，我们必须创建一个状态值。在Redux中，我们使用存储和reducer来完成这项工作，但反冲是通过一种叫做原子的东西来完成的。原子是状态的片断。我在<a href="https://blog.logrocket.com/simple-state-management-recoil/">的介绍文章</a>中提到了这一点。</p>
<p>下面是如何为<code>activePlanets</code>状态值创建一个原子。</p>
<p>你用一个具有<code>key</code>和<code>default</code>属性的物体从反冲中调用<code>atom</code>函数。</p>
<pre>import { atom } from "recoil";

const activePlanetAtom = atom({
  key: "activePlanet",
  default: "Web",
});</pre>
<p><strong>注意</strong> : <code>key</code>必须是一个唯一的字符串——对于应用程序中的其他原子(和选择器)是唯一的。</p>
<blockquote><p>创建状态值很简单，但是如何从UI组件中读取这个值呢？对于Redux，我们使用选择器:</p></blockquote>
<p>从反冲状态读取状态值要容易得多。它的工作原理与<code>useState</code>非常相似，但有一个不同的钩子——这个来自后坐力。</p>
<pre>import {useSelector } from "react-redux";

const activePlanet = useSelector((v) =&gt; v);</pre>
<p>就像您通过调用<code>useState</code>获得一个状态值和更新器一样，反冲模拟了一个类似的API。</p>
<pre>... 
import { atom, useRecoilState } from "recoil";
... 

//within UI component  
const [activePlanet, setActivePlanet] = useRecoilState(activePlanetAtom);</pre>
<p>从<code>recoil</code>调用<code>useRecoilState</code>钩子，但是将相关的原子作为参数传递给它，如上所示。很简单。</p>
<p>要在单击planet按钮时更新状态对象，您不必像Redux那样调度操作。您只需从调用<code>useRecoilState</code>中调用返回状态更新程序，如下所示:</p>
<p>比较这两种解决方案，反冲的优势之一变得显而易见:简单！使用反冲感觉非常接近默认的React心智模型，并且API非常容易掌握。</p>
<pre>// redux 
const handlePlanetUpdate = (event) =&gt; {
    dispatch({ type: "SET_PLANET", payload: event.target.textContent });
};

// recoil 
const handlePlanetUpdate = (event) =&gt; {
    setActivePlanet(event.target.textContent);
};</pre>
<figure id="attachment_23729" aria-describedby="caption-attachment-23729" class="wp-caption aligncenter"><img data-attachment-id="23729" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/redux-recoil-planet-text-diff/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-planet-text-diff.png" data-orig-size="730,256" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Redux/Recoil planet text buttons diff" data-image-description="" data-image-caption="&lt;p&gt;Diff: Redux vs. Recoil implementation.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-planet-text-diff-300x105.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-planet-text-diff.png" decoding="async" class="size-full wp-image-23729 jetpack-lazy-image" src="../Images/2cfdb2cf0f45622adb10ec90851da615.png" alt="Redux/Recoil Planet Text Buttons Diff" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-planet-text-diff.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-planet-text-diff-300x105.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-planet-text-diff.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-planet-text-diff.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="23729" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/redux-recoil-planet-text-diff/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-planet-text-diff.png" data-orig-size="730,256" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Redux/Recoil planet text buttons diff" data-image-description="" data-image-caption="&lt;p&gt;Diff: Redux vs. Recoil implementation.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-planet-text-diff-300x105.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-planet-text-diff.png" decoding="async" loading="lazy" class="size-full wp-image-23729" src="../Images/2cfdb2cf0f45622adb10ec90851da615.png" alt="Redux/Recoil Planet Text Buttons Diff" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-planet-text-diff.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-planet-text-diff-300x105.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-planet-text-diff.png"/></noscript><figcaption id="caption-attachment-23729" class="wp-caption-text">Diff: Redux vs. Recoil implementation.</figcaption></figure>
<p>让我们继续重构一个更有趣的应用程序。</p>
<p>Redux应用#2:使用Thunks获取数据</p>
<h2>大多数应用程序需要从远程服务器获取数据。使用Redux应用程序，有许多选项。我们来看一个带<a href="https://github.com/reduxjs/redux-thunk"> redux-thunk </a>的。</h2>
<p><img data-attachment-id="23731" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/user-profile-app-demo/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-app-demo.gif" data-orig-size="730,497" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="User profile app demo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-app-demo-300x204.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-app-demo.gif" decoding="async" class="aligncenter size-full wp-image-23731 jetpack-lazy-image" src="../Images/84849f1fe90f4b3141e9a3119107b801.png" alt="User Profile App Demo" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-app-demo.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-app-demo.gif"/></p>
<p>在上面的应用程序中，从远程服务器获取用户配置文件细节。正如你可能已经假设的那样，这里的流程类似于每个Redux应用程序。一旦安装了主<code>App</code>组件，就会调度一个动作来获取用户的配置文件细节。</p><noscript><img data-lazy-fallback="1" data-attachment-id="23731" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/user-profile-app-demo/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-app-demo.gif" data-orig-size="730,497" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="User profile app demo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-app-demo-300x204.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-app-demo.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-23731" src="../Images/84849f1fe90f4b3141e9a3119107b801.png" alt="User Profile App Demo" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-app-demo.gif"/></noscript>
<p><code>fetchUserProfile</code>函数包含被redux-thunk中间件拦截的异步逻辑。</p>
<pre>useEffect(() =&gt; {
    dispatch(fetchUserProfile());
}, []);</pre>
<p>在这里，<code>URL</code>表示返回用户档案细节的服务器端点。</p>
<pre>export function fetchUserProfile() {
  return (dispatch, getState) =&gt; {
    fetch(URL)
      .then((res) =&gt; res.json())
      .then((data) =&gt; dispatch(setUserProfile(data)));
  };
}</pre>
<p>在获取数据时，会调度<code>setUserProfile</code>动作将配置文件细节保存到存储中。</p>
<p><img data-attachment-id="23732" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/redux-user-profile-app-flow/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-user-profile-app-flow.png" data-orig-size="730,525" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Redux user profile app state flow" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-user-profile-app-flow-300x216.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-user-profile-app-flow.png" decoding="async" class="aligncenter size-full wp-image-23732 jetpack-lazy-image" src="../Images/b981eb82d49f60323a9a5a3398abacbf.png" alt="Redux User Profile App State Flow" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-user-profile-app-flow.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/redux-user-profile-app-flow-300x216.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-user-profile-app-flow.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-user-profile-app-flow.png"/></p>
<p>非常传统的设置。你可以在GitHub 的这里<a href="https://github.com/ohansemmanuel/benutzer">找到完整的源代码。</a></p><noscript><img data-lazy-fallback="1" data-attachment-id="23732" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/redux-user-profile-app-flow/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-user-profile-app-flow.png" data-orig-size="730,525" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Redux user profile app state flow" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-user-profile-app-flow-300x216.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-user-profile-app-flow.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-23732" src="../Images/b981eb82d49f60323a9a5a3398abacbf.png" alt="Redux User Profile App State Flow" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-user-profile-app-flow.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/redux-user-profile-app-flow-300x216.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-user-profile-app-flow.png"/></noscript>
<p>现在，有了后坐力，到底有什么不同呢？最明显的是反冲应用中的状态流。</p>
<p><img data-attachment-id="23733" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/recoil-user-profile-app-flow/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/recoil-user-profile-app-flow.png" data-orig-size="730,486" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Recoil user profile app state flow" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/recoil-user-profile-app-flow-300x200.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/recoil-user-profile-app-flow.png" decoding="async" class="aligncenter size-full wp-image-23733 jetpack-lazy-image" src="../Images/2e916ce72db6c49a5ed63feb5a1d2f23.png" alt="Recoil User Profile App State Flow" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/recoil-user-profile-app-flow.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/recoil-user-profile-app-flow-300x200.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/recoil-user-profile-app-flow.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/recoil-user-profile-app-flow.png"/></p>
<p>该流程感觉上与通过<code>useState</code>钩子使用本地状态的典型React应用程序几乎相同。</p><noscript><img data-lazy-fallback="1" data-attachment-id="23733" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/recoil-user-profile-app-flow/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/recoil-user-profile-app-flow.png" data-orig-size="730,486" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Recoil user profile app state flow" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/recoil-user-profile-app-flow-300x200.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/recoil-user-profile-app-flow.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-23733" src="../Images/2e916ce72db6c49a5ed63feb5a1d2f23.png" alt="Recoil User Profile App State Flow" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/recoil-user-profile-app-flow.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/recoil-user-profile-app-flow-300x200.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/recoil-user-profile-app-flow.png"/></noscript>
<p>首先，我们创建一个反冲原子来保存从服务器获取的数据:</p>
<p>记住原子代表一种状态。</p>
<pre>const userProfileState = atom({
  key: "userProfile",
  default: {},
});</pre>
<p>在主<code>App</code>组件中，我们通过使用反冲的<code>useRecoilState</code>钩子读取原子的内容。</p>
<p>调用<code>useRecoilState</code>返回状态值和设置状态值的更新函数。</p>
<pre>const [userProfile, setUserProfile] = useRecoilState(userProfileState);</pre>
<p>我们建立了全球政府；现在，让我们触发实际的数据获取。</p>
<p>组件一安装，异步函数<code>fetchUserProfile</code>就被调用，接收到的数据通过调用状态更新<code>setUserProfile</code>被设置为全局状态。</p>
<p>其中<code>setUserProfile</code>代表状态更新函数。看看下面从Redux到反冲的代码diff:</p>
<pre>useEffect(() =&gt; {
    fetchUserProfile().then((data) =&gt;
      setUserProfile({ ...data, isLoading: false })
    );
}, []);</pre>
<p><img data-attachment-id="23900" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/user-profile-diff-dark/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-diff-dark.png" data-orig-size="730,415" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Redux/Recoil user profile app diff" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-diff-dark-300x171.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-diff-dark.png" decoding="async" class="aligncenter size-full wp-image-23900 jetpack-lazy-image" src="../Images/f4186e31df9e867bf7ec9af5eda88f23.png" alt="Redux/Recoil User Profile App Diff" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-diff-dark.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-diff-dark-300x171.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-diff-dark.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-diff-dark.png"/></p>
<p>对反冲的重构要简单得多。没有store或reducer设置，也没有thunks——只有一个类似于典型React应用程序的原子和流。说说简单！</p><noscript><img data-lazy-fallback="1" data-attachment-id="23900" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/user-profile-diff-dark/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-diff-dark.png" data-orig-size="730,415" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Redux/Recoil user profile app diff" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-diff-dark-300x171.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-diff-dark.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-23900" src="../Images/f4186e31df9e867bf7ec9af5eda88f23.png" alt="Redux/Recoil User Profile App Diff" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-diff-dark.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-diff-dark-300x171.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-diff-dark.png"/></noscript>
<p>值得一提的是，如果不在<code>RecoilRoot</code>组件中包装父树组件，refactor to反冲就不完整。</p>
<p><img data-attachment-id="23735" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/wrapping-app-component-recoilroot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/wrapping-app-component-recoilroot.png" data-orig-size="730,230" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Wrapping the app component with RecoilRoot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/wrapping-app-component-recoilroot-300x95.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/wrapping-app-component-recoilroot.png" decoding="async" class="aligncenter size-full wp-image-23735 jetpack-lazy-image" src="../Images/e7e1ab6c4d12f80184c38cd429f9a085.png" alt="Wrapping The App Component With RecoilRoot" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/wrapping-app-component-recoilroot.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/wrapping-app-component-recoilroot-300x95.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/wrapping-app-component-recoilroot.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/wrapping-app-component-recoilroot.png"/></p>
<p><code>RecoilRoot</code>提供了一个<code>Context</code>提供者来与你的全局状态交互。</p><noscript><img data-lazy-fallback="1" data-attachment-id="23735" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/wrapping-app-component-recoilroot/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/wrapping-app-component-recoilroot.png" data-orig-size="730,230" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Wrapping the app component with RecoilRoot" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/wrapping-app-component-recoilroot-300x95.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/wrapping-app-component-recoilroot.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-23735" src="../Images/e7e1ab6c4d12f80184c38cd429f9a085.png" alt="Wrapping The App Component With RecoilRoot" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/wrapping-app-component-recoilroot.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/wrapping-app-component-recoilroot-300x95.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/wrapping-app-component-recoilroot.png"/></noscript>
<p>你会发现GitHub 上的<a href="https://github.com/ohansemmanuel/benutzer/compare/recoil-single-user">变化完全不同，例如，比较Redux和反冲重构。</a></p>
<p>Redux应用#3:使用thunks获取多个用户配置文件</p>
<h2>我们刚刚重构的应用程序比简单的hello world应用程序更有趣，但让我们考虑一个更有趣的应用程序，它展示了一种特殊的反冲强度。考虑下面的应用程序:</h2>
<p><img data-attachment-id="23737" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/user-profile-details-friends-app-demo/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-app-demo.gif" data-orig-size="730,426" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="User profile with details and friends demo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-app-demo-300x175.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-app-demo.gif" decoding="async" class="aligncenter size-full wp-image-23737 jetpack-lazy-image" src="../Images/da4e619f3e1a51f4f5735c2df97214eb.png" alt="User Profile With Details And Friends App Demo" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-app-demo.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-app-demo.gif"/></p>
<p>访问该应用程序时，会获取用户的个人资料详情，以及朋友列表。</p><noscript><img data-lazy-fallback="1" data-attachment-id="23737" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/user-profile-details-friends-app-demo/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-app-demo.gif" data-orig-size="730,426" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="User profile with details and friends demo" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-app-demo-300x175.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-app-demo.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-23737" src="../Images/da4e619f3e1a51f4f5735c2df97214eb.png" alt="User Profile With Details And Friends App Demo" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-app-demo.gif"/></noscript>
<p><img data-attachment-id="23739" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/user-profile-details-friends-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-diagram.png" data-orig-size="730,441" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="App diagram with profile details and friends" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-diagram-300x181.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-diagram.png" decoding="async" class="aligncenter size-full wp-image-23739 jetpack-lazy-image" src="../Images/a816e8d4fd73f9eef2cf366a1e186745.png" alt="Diagram Of The App With Profile Details And Friends" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-diagram.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-diagram-300x181.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-diagram.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-diagram.png"/></p>
<p>此外，点击每个朋友的图片后，我们会获取他们的个人资料详情(包括他们的朋友):</p><noscript><img data-lazy-fallback="1" data-attachment-id="23739" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/user-profile-details-friends-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-diagram.png" data-orig-size="730,441" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="App diagram with profile details and friends" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-diagram-300x181.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-diagram.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-23739" src="../Images/a816e8d4fd73f9eef2cf366a1e186745.png" alt="Diagram Of The App With Profile Details And Friends" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-diagram.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-diagram-300x181.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/user-profile-details-friends-diagram.png"/></noscript>
<p><img data-attachment-id="23740" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/update-profile-details-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/update-profile-details-diagram.png" data-orig-size="730,391" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Profile details and friends updated after click" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/update-profile-details-diagram-300x161.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/update-profile-details-diagram.png" decoding="async" class="aligncenter size-full wp-image-23740 jetpack-lazy-image" src="../Images/03e17dc726477833dbfcdff5a38023e0.png" alt="Diagram Displaying Profile Details And Friends Updated After Click" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/update-profile-details-diagram.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/update-profile-details-diagram-300x161.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/update-profile-details-diagram.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/update-profile-details-diagram.png"/></p>
<p>实际上，总有一个活跃用户的个人资料和好友列表会显示出来。使用Redux应用程序，这里的流程与之前的应用程序没有太大的不同。</p><noscript><img data-lazy-fallback="1" data-attachment-id="23740" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/update-profile-details-diagram/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/update-profile-details-diagram.png" data-orig-size="730,391" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Profile details and friends updated after click" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/update-profile-details-diagram-300x161.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/update-profile-details-diagram.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-23740" src="../Images/03e17dc726477833dbfcdff5a38023e0.png" alt="Diagram Displaying Profile Details And Friends Updated After Click" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/update-profile-details-diagram.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/update-profile-details-diagram-300x161.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/update-profile-details-diagram.png"/></noscript>
<p>像以前一样，只要主<code>App</code>组件安装好，我们就分派一个动作来获取默认的用户配置文件(和朋友一起)。</p>
<p>当一个朋友的图像被点击时，我们通过一个<code>dataset</code>对象将他们的<code>userId</code>附加到呈现的元素上，并使用<code>userId</code>作为参数启动相同的动作。</p>
<pre>const App = () =&gt; {
  ... 
 useEffect(() =&gt; {
    dispatch(fetchUserProfile());
  }, []);
 ...
}</pre>
<p>同一个Thunk中间件选择这个动作并发起网络请求；唯一的区别是传递给端点URL的<code>userId</code>获取不同的用户配置文件。</p>
<pre>const App = () =&gt; {
  ... 
  const handleUserClick = (evt) =&gt; {
    const userId = evt.currentTarget.dataset.id;
    dispatch(fetchUserProfile(userId));
  };
  ... 
  return (
     ...
     &lt;UserPhoto
            onClick={handleUserClick}
          /&gt;
  )
}</pre>
<p><img data-attachment-id="23741" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/endpoint-url-structure/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/endpoint-url-structure.png" data-orig-size="730,277" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="App endpoint URL structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/endpoint-url-structure-300x114.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/endpoint-url-structure.png" decoding="async" class="aligncenter size-full wp-image-23741 jetpack-lazy-image" src="../Images/e64f365ae56b69a27a6e6be01fc96055.png" alt="App Endpoint URL Structure" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/endpoint-url-structure.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/endpoint-url-structure-300x114.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/endpoint-url-structure.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/endpoint-url-structure.png"/></p>
<p>很简单。让我们考虑一下如何用反冲来解决这个问题。</p><noscript><img data-lazy-fallback="1" data-attachment-id="23741" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/endpoint-url-structure/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/endpoint-url-structure.png" data-orig-size="730,277" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="App endpoint URL structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/endpoint-url-structure-300x114.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/endpoint-url-structure.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-23741" src="../Images/e64f365ae56b69a27a6e6be01fc96055.png" alt="App Endpoint URL Structure" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/endpoint-url-structure.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/endpoint-url-structure-300x114.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/endpoint-url-structure.png"/></noscript>
<p>你可能会惊讶地看到反冲应用程序采取的方向。Redux关注的是从动作到reducers再到商店的状态流，而反冲关注的是通过数据流图的状态流。</p>
<p><img data-attachment-id="23742" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/typical-graph-structure/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/typical-graph-structure.png" data-orig-size="730,459" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A typical graph structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/typical-graph-structure-300x189.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/typical-graph-structure.png" decoding="async" class="aligncenter size-full wp-image-23742 jetpack-lazy-image" src="../Images/fe77aa8ad04f1dc42569a78cc6c6115e.png" alt="A Typical Graph Structure" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/typical-graph-structure.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/typical-graph-structure-300x189.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/typical-graph-structure.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/typical-graph-structure.png"/></p>
<p>我可以再花10分钟讨论数据流图，但关键是:将数据流图想象成一个图形数据结构，其中反冲提供并管理不同状态实体之间的关系。</p><noscript><img data-lazy-fallback="1" data-attachment-id="23742" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/typical-graph-structure/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/typical-graph-structure.png" data-orig-size="730,459" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A typical graph structure" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/typical-graph-structure-300x189.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/typical-graph-structure.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-23742" src="../Images/fe77aa8ad04f1dc42569a78cc6c6115e.png" alt="A Typical Graph Structure" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/typical-graph-structure.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/typical-graph-structure-300x189.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/typical-graph-structure.png"/></noscript>
<p>像所有的图形结构一样，这些状态对象是相互连接的。他们可能依赖于许多其他国家和其他实体，就像他们自己一样。</p>
<p>更重要的是，反冲将管理每个状态依赖关系，即状态通过该图的流动，并有效地重新计算值和重新呈现订阅这些状态值的组件。</p>
<p>我们现在关心的是选择器(反冲提供的状态实体之一)也可以包含异步代码，反冲仍然可以有效地处理通过图的状态流。这个知识改变了我们从Redux到反冲的重构方法。</p>
<p>第一步是创建一个保存当前用户ID的原子(再次提醒，原子代表反冲状态的一部分)。</p>
<p>有趣的是。我们将继续创建一个依赖于<code>userIDState</code>原子的异步选择器。</p>
<pre>import { atom } from "recoil";

const userIDState = atom({
  key: "currentUserId",
  default: "",
});</pre>
<p>现在，每当<code>useIDState</code>改变时，选择器将根据<code>id</code>获取新的用户数据，并返回配置文件数据。</p>
<pre>import { atom, selector } from "recoil";

...
const userProfileState = selector({
  key: "userProfile",
  get: async ({ get }) =&gt; {
    const id = get(userIDState);
    return await fetchUserProfile(id);
  },
});</pre>
<p>下面是我们如何在UI中使用这个状态值:</p>
<p>每次点击用户照片时，当前用户ID状态都会更新。反冲通过发出网络请求(如果需要)有效地重新计算当前用户数据。</p>
<pre>const App = () =&gt; {
  // useSetRecoilState returns just the funtion updater e.g. imagine if there was a useSetState hook in React. 
  // useState returns [value, setState]
  // useSetState returns only setState
  const setCurrentUserId = useSetRecoilState(userIDState);

  // useRecoilValue returns just the state value instead of an array of value and state updater
  const userProfile = useRecoilValue(userProfileState);

  ... 
  const handleUserClick = (evt) =&gt; {
    setCurrentUserId(evt.currentTarget.dataset.id);
  };

 return (
  ... 
   &lt;UserPhoto
            onClick={handleUserClick}
          /&gt;
 )
}</pre>
<p>反冲选择器被视为纯函数。因此，对于同一个用户ID，返回的是配置文件数据的缓存版本，而不需要再次获取数据！</p>
<p><img data-attachment-id="23744" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/redux-recoil-user-profile-friends-diff/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-user-profile-friends-diff.png" data-orig-size="730,433" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Final Redux/Recoil diff" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-user-profile-friends-diff-300x178.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-user-profile-friends-diff.png" decoding="async" class="aligncenter size-full wp-image-23744 jetpack-lazy-image" src="../Images/031477e6d3dc03c6a3a14c20a5299553.png" alt="The Final Redux/Recoil Diff" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-user-profile-friends-diff.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-user-profile-friends-diff-300x178.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-user-profile-friends-diff.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-user-profile-friends-diff.png"/></p>
<p>好奇哪里可以找到完整的源代码？对于这个应用程序，这里有<a href="https://github.com/ohansemmanuel/benutzer/tree/redux-multi-users"> Redux </a>和<a href="https://github.com/ohansemmanuel/benutzer/tree/recoil-multiple-user">反冲</a>分支。</p><noscript><img data-lazy-fallback="1" data-attachment-id="23744" data-permalink="https://blog.logrocket.com/refactoring-redux-app-to-use-recoil/redux-recoil-user-profile-friends-diff/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-user-profile-friends-diff.png" data-orig-size="730,433" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Final Redux/Recoil diff" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-user-profile-friends-diff-300x178.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-user-profile-friends-diff.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-23744" src="../Images/031477e6d3dc03c6a3a14c20a5299553.png" alt="The Final Redux/Recoil Diff" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-user-profile-friends-diff.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-user-profile-friends-diff-300x178.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/redux-recoil-user-profile-friends-diff.png"/></noscript>
<p>结论</p>
<h2>反冲还是一个年轻的图书馆，但是绝对很有前途！反冲有这么多的能力，我将在未来的文章中分享更多。<a href="https://twitter.com/ohansemmanuel?lang=en">保持联系</a></h2>
<p>使用LogRocket消除传统反应错误报告的噪音</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">是一款React analytics解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket告诉您React应用程序中实际影响用户的最具影响力的bug和UX问题。</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS异常、前端性能指标和用户交互。然后，LogRocket使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>关注重要的React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试LogRocket】。</a></p><p vwo-el-id="28675661060">Focus on the React bugs that matter —
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">try LogRocket today</a>.
</p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>