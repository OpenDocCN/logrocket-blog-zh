<html>
<head>
<title>Apache Kafka: real-time data streaming app | LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Apache Kafka:实时数据流应用程序| LogRocket博客</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/#0001-01-01">https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/#0001-01-01</a></blockquote><div><article class="article-post">
<p><em> <strong>编者按:</strong>这篇文章于2022年3月3日更新，包括了关于Apache Kafka版本3.1.0的信息，以及卡夫的概述。</em></p>
<p>麦肯锡全球研究所的一项研究显示，数据驱动的组织获得客户的可能性是23倍，留住客户的可能性是6倍，盈利的可能性是19倍。</p>
<p>以一种易于理解和使用的格式，数据可以帮助推动业务需求。然而，大型科技公司以原始形式收集用户数据。因此，挑战在于处理和(如果必要的话)转换或清理数据以使其有意义。</p>
<p>基本的数据流应用程序将数据从源桶移动到目的桶。涉及流的更复杂的应用程序会动态地执行一些魔术，比如改变输出数据的结构，或者用新的属性或字段丰富它。</p>
<p>在本文中，我们将回顾Apache Kafka的关键概念和术语，并演示如何使用Kafka构建一个最小的实时数据流应用程序。</p>
<p>我们的教程将遵循这些步骤:</p>

<h2 id="prerequisites">先决条件</h2>
<p>要学习本教程，需要具备以下先决条件:</p>
<ul>
<li>安装了Node.js和npm 的<a href="https://nodejs.org/en/" target="_blank" rel="noopener">最新版本</a></li>
<li>安装了最新的Java版本(<a href="https://www.java.com/download/" target="_blank" rel="noopener"> JVM </a>)</li>
<li>卡夫卡安装<em> <strong>注意:</strong>，在本教程中，我们将回顾在本地安装卡夫卡</em></li>
<li>对编写Node.js应用程序的基本理解</li>
</ul>
<h2 id="batch-processing">成批处理</h2>
<p>数据转换和/或丰富主要是在输入主题被另一个应用程序或输出主题使用时处理的。这是数据工程中非常常见的场景，因为总是需要清理、转换、聚集，甚至重新处理Kafka主题中通常原始的和临时存储的数据，以使其符合特定的标准或格式。</p>
<h2 id="background-and-key-concepts">背景和关键概念</h2>
<p>据其<a href="https://kafka.apache.org/" target="_blank" rel="noopener">网站</a>介绍，Kafka是一个开源、高度分布式的流媒体平台。Kafka由LinkedIn(现在是Apache软件基金会的一部分)的工程师构建，是一个可靠、有弹性和可扩展的系统，支持流媒体事件/应用程序。它是可水平扩展的，默认情况下是容错的，并提供高速。Kafka有各种各样的<a href="https://kafka.apache.org/uses" target="_blank" rel="noopener">用例</a>，其中之一是构建数据管道或应用程序，实时处理流事件和/或批量数据的处理。在撰写本文时，最新的Kafka版本是3.1.0。</p>
<p>以下是卡夫卡的一些基本概念和术语:</p>
<ul>
<li>主题:Kafka主题是跨越多个Kafka代理的一组分区或组。该主题充当集群中流数据的间歇存储机制。对于每个Kafka主题，我们可以选择设置复制因子和其他参数，如分区数量</li>
<li>生产者、消费者和集群:生产者是向Kafka经纪人或更准确地说是Kafka主题生产或写入数据的客户。另一方面，消费者从Kafka主题或Kafka经纪人那里读取数据或——顾名思义——消费数据。集群只是一组代理或服务器，为当前的Kafka实例提供动力</li>
<li>KRaft:最近发布的Kafka引入了<a href="https://blogs.apache.org/kafka/entry/what-s-new-in-apache6" target="_blank" rel="noopener"> Kafka Raft元数据模式(KRaft) </a>，通过消除对<a href="https://kafka.apache.org/documentation/#zk" target="_blank" rel="noopener">动物园管理员</a>的依赖，简化了Kafka的架构。在引入KRaft之前，ZooKeeper用于跟踪Kafka的集群状态，并控制Kafka代理或服务器的同步和配置。作为第二个系统，动物园管理员增加了卡夫卡建筑的复杂性。在Zookeeper下，元数据存储在Kafka之外的Zookeeper集群中。在KRaft下，所有元数据都在Kafka内部存储和管理</li>
</ul>
<figure class="wp-caption aligncenter"><img decoding="async" src="../Images/9b8c723e16bc2910b0f60b04645b51c6.png" alt="Relationship between Producers, Clusters, and Consumers in Kafka." data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/10/producer-cluster-consumer-relationship.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/producer-cluster-consumer-relationship.png"/><noscript><img data-lazy-fallback="1" decoding="async" loading="lazy" src="../Images/9b8c723e16bc2910b0f60b04645b51c6.png" alt="Relationship between Producers, Clusters, and Consumers in Kafka." data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/producer-cluster-consumer-relationship.png"/></noscript><figcaption class="wp-caption-text">Relationship between Producers, Clusters, and Consumers in Kafka.</figcaption></figure>
<p>关于所有这些重要概念的更多详细信息，请查看Apache Kafka文档。</p>
<p>在本文中，您将学习如何使用Apache Kafka构建数据管道来移动批处理数据。作为演示，我们将模拟一个在数据源生成的大型JSON数据存储。然后，我们将编写一个生成的脚本，该脚本从一个源(比如说，点A)向我们的本地代理/集群Kafka设置上的特定主题写入这个JSON数据。最后，我们将编写一个消费者脚本，该脚本从指定的Kafka主题中消费存储的数据。</p>
<h2 id="installing-kafka">安装Kafka</h2>
<p>要安装Kafka，请在此处下载最新版本<a href="https://www.apache.org/dyn/closer.cgi?path=/kafka/3.1.0/kafka_2.13-3.1.0.tgz" target="_blank" rel="noopener">并使用以下命令解压:</a></p>
<pre class="language-bash hljs">tar -xzf kafka_2.13-3.1.0.tgz
cd kafka_2.13-3.1.0
</pre>
<p><code>tar</code>命令提取下载的Kafka二进制文件。Kafka二进制文件可以在我们想要的任何路径上下载。</p>
<p>接下来，导航到Kafka的安装目录并运行<code>ls</code>命令。然后，<code>cd</code>进入<code>bin</code>目录，再次运行<code>ls</code>:</p>
<figure id="attachment_96001" aria-describedby="caption-attachment-96001" class="wp-caption aligncenter"><img data-attachment-id="96001" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/kafka-bin-folder/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-bin-folder.png" data-orig-size="720,101" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Kafka bin folder" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-bin-folder-300x42.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-bin-folder.png" decoding="async" class="wp-image-96001 size-full jetpack-lazy-image" src="../Images/3a20447012f9da6d0f9cb2c2233f824b.png" alt="Kafka Bin Folder" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-bin-folder.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-bin-folder-300x42.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-bin-folder.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-bin-folder.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="96001" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/kafka-bin-folder/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-bin-folder.png" data-orig-size="720,101" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Kafka bin folder" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-bin-folder-300x42.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-bin-folder.png" decoding="async" loading="lazy" class="wp-image-96001 size-full" src="../Images/3a20447012f9da6d0f9cb2c2233f824b.png" alt="Kafka Bin Folder" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-bin-folder.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-bin-folder-300x42.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-bin-folder.png"/></noscript><figcaption id="caption-attachment-96001" class="wp-caption-text">Contents of Kafka’s <code>bin</code> folder.</figcaption></figure>
<p>如果我们使用<code>cd ..</code>命令并运行<code>ls</code>，我们会发现一个<code>config</code>文件夹。</p>
<p><code>config</code>文件夹包含一个<code>server.properties</code>文件，我们将使用它来配置Kafka服务器，并包含任何所需的更改或配置。</p>
<p>现在，运行以下命令:</p>
<pre class="language-bash hljs">cd ..
ls
cd config
ls
nano server.properties
</pre>
<figure id="attachment_96005" aria-describedby="caption-attachment-96005" class="wp-caption aligncenter"><img data-attachment-id="96005" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/kafka-config-directory/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-config-directory.png" data-orig-size="720,91" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Kafka config directory" data-image-description="" data-image-caption="&lt;p&gt;Contents of Kafka’s `config` directory.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-config-directory-300x38.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-config-directory.png" decoding="async" class="wp-image-96005 size-full jetpack-lazy-image" src="../Images/d93a4afda78e7b0847a7361eb0b027c1.png" alt="Kafka Config Directory" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-config-directory.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-config-directory-300x38.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-config-directory.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-config-directory.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="96005" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/kafka-config-directory/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-config-directory.png" data-orig-size="720,91" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Kafka config directory" data-image-description="" data-image-caption="&lt;p&gt;Contents of Kafka’s `config` directory.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-config-directory-300x38.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-config-directory.png" decoding="async" loading="lazy" class="wp-image-96005 size-full" src="../Images/d93a4afda78e7b0847a7361eb0b027c1.png" alt="Kafka Config Directory" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-config-directory.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-config-directory-300x38.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/kafka-config-directory.png"/></noscript><figcaption id="caption-attachment-96005" class="wp-caption-text">Contents of Kafka’s <code>config</code> directory.</figcaption></figure>
<p>KRaft的控制器用于存储Kafka内部的所有元数据。卡夫主管负责向Kafka经纪人提供最新状态。其他KRaft控制器始终处于备用状态，以防主控制器出现故障。</p>
<p>现在，我们将开始为Kafka服务器编写配置，以设置Kafka集群。</p>
<h2 id="configuring-the-kafka-cluster">配置Kafka集群</h2>
<p>在这里，我们将设置我们的Kafka集群，它将由正在运行的Kafka代理(服务器)组成。所有配置都将在<code>config</code>目录和<code>server.properties</code>文件中完成。</p>
<p>首先，我们将确保我们仍然在<code>config</code>目录中。然后，我们将运行这些命令:</p>
<pre class="language-bash hljs">cd kraft
ls
</pre>
<figure id="attachment_96008" aria-describedby="caption-attachment-96008" class="wp-caption aligncenter"><img data-attachment-id="96008" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/contents-of-kraft/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/contents-of-kraft.png" data-orig-size="720,91" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Contents of KRaft" data-image-description="" data-image-caption="&lt;p&gt;Contents of KRaft.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/contents-of-kraft-300x38.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/contents-of-kraft.png" decoding="async" class="wp-image-96008 size-full jetpack-lazy-image" src="../Images/831a4dc12c66f69fc42ce3a8f8464b33.png" alt="Contents Of KRaft" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/contents-of-kraft.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/contents-of-kraft-300x38.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/contents-of-kraft.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/contents-of-kraft.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="96008" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/contents-of-kraft/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/contents-of-kraft.png" data-orig-size="720,91" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Contents of KRaft" data-image-description="" data-image-caption="&lt;p&gt;Contents of KRaft.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/contents-of-kraft-300x38.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/contents-of-kraft.png" decoding="async" loading="lazy" class="wp-image-96008 size-full" src="../Images/831a4dc12c66f69fc42ce3a8f8464b33.png" alt="Contents Of KRaft" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/contents-of-kraft.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/contents-of-kraft-300x38.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/contents-of-kraft.png"/></noscript><figcaption id="caption-attachment-96008" class="wp-caption-text">Contents of KRaft.</figcaption></figure>
<p>接下来，将<code>server.properties</code>复制到一个名为<code>server1.properties</code>的新文件中，并使用以下命令开始编辑该文件:</p>
<pre class="language-bash hljs">cp server.properties server1.properties
nano server1.properties
</pre>
<figure id="attachment_96010" aria-describedby="caption-attachment-96010" class="wp-caption aligncenter"><img data-attachment-id="96010" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/kraft-config-file/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-config-file.png" data-orig-size="720,353" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="KRraft config file" data-image-description="" data-image-caption="&lt;p&gt;KRaft `config` file.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-config-file-300x147.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-config-file.png" decoding="async" class="wp-image-96010 size-full jetpack-lazy-image" src="../Images/2a6171e7c9fa2839c97df0cb1aa8bcfe.png" alt="KRaft Config File" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-config-file.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-config-file-300x147.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-config-file.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-config-file.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="96010" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/kraft-config-file/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-config-file.png" data-orig-size="720,353" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="KRraft config file" data-image-description="" data-image-caption="&lt;p&gt;KRaft `config` file.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-config-file-300x147.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-config-file.png" decoding="async" loading="lazy" class="wp-image-96010 size-full" src="../Images/2a6171e7c9fa2839c97df0cb1aa8bcfe.png" alt="KRaft Config File" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-config-file.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-config-file-300x147.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-config-file.png"/></noscript><figcaption id="caption-attachment-96010" class="wp-caption-text">KRaft <code>config</code> file.</figcaption></figure>
<p>在这段代码中，<code>process.roles</code>被设置为<code>broker</code>和<code>controller.</code>，这意味着同一个服务器将充当<code>broker</code>和<code>controller</code>。</p>
<p>我们将有三个id为<code>1</code>、<code>2</code>和<code>3</code>的服务器和三个运行在端口<code>localhost:19092</code>、<code>localhost:19093</code>和<code>locahost:19094</code>上的控制器。以下Kafka经纪人将在港口运行:<code>9092</code>、<code>9093</code>、<code>9094</code>。</p>
<p>现在，打开KRaft <code>config</code>文件，将<code>controller.qorum.voters</code>设置如下:</p>
<pre class="language-bash hljs"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="35565a5b41475a595950471b44405a4740581b435a41504746080475595a5654595d5a4641">[email protected]</a>:19092,<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1624567a7975777a7e796562">[email protected]</a>:19093,<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="4e7d0e22212d2f26213d3a">[email protected]</a>:19094
</pre>
<p>接下来，向下滚动并设置监听器，如下所示:</p>
<pre class="language-bash hljs">listeners=PLAINTEXT://:9092,CONTROLLER://:19092
</pre>
<figure id="attachment_96014" aria-describedby="caption-attachment-96014" class="wp-caption aligncenter"><img data-attachment-id="96014" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/configurations-added-kraft-config-file/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-added-kraft-config-file.png" data-orig-size="720,349" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Configurations added kraft config file" data-image-description="" data-image-caption="&lt;p&gt;Configurations added to the KRaft `config` file.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-added-kraft-config-file-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-added-kraft-config-file.png" decoding="async" class="wp-image-96014 size-full jetpack-lazy-image" src="../Images/d27c0da88800f2a0100c774ac4ebaaea.png" alt="Configurations Added KRaft Config File" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-added-kraft-config-file.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-added-kraft-config-file-300x145.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-added-kraft-config-file.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-added-kraft-config-file.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="96014" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/configurations-added-kraft-config-file/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-added-kraft-config-file.png" data-orig-size="720,349" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Configurations added kraft config file" data-image-description="" data-image-caption="&lt;p&gt;Configurations added to the KRaft `config` file.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-added-kraft-config-file-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-added-kraft-config-file.png" decoding="async" loading="lazy" class="wp-image-96014 size-full" src="../Images/d27c0da88800f2a0100c774ac4ebaaea.png" alt="Configurations Added KRaft Config File" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-added-kraft-config-file.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-added-kraft-config-file-300x145.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-added-kraft-config-file.png"/></noscript><figcaption id="caption-attachment-96014" class="wp-caption-text">Configurations added to the KRaft <code>config</code> file.</figcaption></figure>
<p>我们需要更改日志文件的目的地，如下所示:</p>
<pre class="language-bash hljs">log.dirs=/tmp/server1/kraft-combined-logs
</pre>
<figure id="attachment_96017" aria-describedby="caption-attachment-96017" class="wp-caption aligncenter"><img data-attachment-id="96017" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/configurations-showing-log-file/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-showing-log-file.png" data-orig-size="720,335" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Configurations showing log file" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-showing-log-file-300x140.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-showing-log-file.png" decoding="async" class="wp-image-96017 size-full jetpack-lazy-image" src="../Images/406047089e804007e611f802a3373948.png" alt="Configurations Showing Log File" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-showing-log-file.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-showing-log-file-300x140.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-showing-log-file.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-showing-log-file.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="96017" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/configurations-showing-log-file/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-showing-log-file.png" data-orig-size="720,335" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Configurations showing log file" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-showing-log-file-300x140.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-showing-log-file.png" decoding="async" loading="lazy" class="wp-image-96017 size-full" src="../Images/406047089e804007e611f802a3373948.png" alt="Configurations Showing Log File" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-showing-log-file.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-showing-log-file-300x140.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-showing-log-file.png"/></noscript><figcaption id="caption-attachment-96017" class="wp-caption-text">Configurations showing the log file.</figcaption></figure>
<p>最后，在提示符下键入<strong> CTRL X </strong>和<strong> yes </strong>来保存我们的配置。</p>
<p>现在，我们已经成功创建了一个服务器的拷贝，并配置了该拷贝。接下来，我们将从<code>server1.properties</code>创建服务器的另外两个副本。运行以下命令:</p>
<pre class="language-bash hljs">cp server1.properties server2.properties
cp server1.properties server3.properties
ls
</pre>
<figure id="attachment_96022" aria-describedby="caption-attachment-96022" class="wp-caption aligncenter"><img data-attachment-id="96022" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/creation-additoinal-copies-server/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-additoinal-copies-server.png" data-orig-size="720,73" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Creation additoinal copies server" data-image-description="" data-image-caption="&lt;p&gt;Creation of the two additional copies of the server.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-additoinal-copies-server-300x30.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-additoinal-copies-server.png" decoding="async" class="wp-image-96022 size-full jetpack-lazy-image" src="../Images/c5807cc201a76afef3b74ccd6a103557.png" alt="Creation Additional Copies Server" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-additoinal-copies-server.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/creation-additoinal-copies-server-300x30.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-additoinal-copies-server.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-additoinal-copies-server.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="96022" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/creation-additoinal-copies-server/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-additoinal-copies-server.png" data-orig-size="720,73" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Creation additoinal copies server" data-image-description="" data-image-caption="&lt;p&gt;Creation of the two additional copies of the server.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-additoinal-copies-server-300x30.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-additoinal-copies-server.png" decoding="async" loading="lazy" class="wp-image-96022 size-full" src="../Images/c5807cc201a76afef3b74ccd6a103557.png" alt="Creation Additional Copies Server" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-additoinal-copies-server.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/creation-additoinal-copies-server-300x30.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-additoinal-copies-server.png"/></noscript><figcaption id="caption-attachment-96022" class="wp-caption-text">Creation of the two additional copies of the server.</figcaption></figure>
<p>接下来，您将通过运行以下命令向<code>server2.properties</code>添加配置:</p>
<pre class="language-bash hljs">nano server2.properties
</pre>
<figure id="attachment_96026" aria-describedby="caption-attachment-96026" class="wp-caption aligncenter"><img data-attachment-id="96026" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/content-server2-properties-file/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server2-properties-file.png" data-orig-size="720,354" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Content server2.properties file" data-image-description="" data-image-caption="&lt;p&gt;Content of `server2.properties` file.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server2-properties-file-300x148.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server2-properties-file.png" decoding="async" class="wp-image-96026 size-full jetpack-lazy-image" src="../Images/fbd5f9e6ece8ae76fcd54ec09a3fb75b.png" alt="Content Server2.properties File" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server2-properties-file.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/content-server2-properties-file-300x148.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server2-properties-file.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server2-properties-file.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="96026" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/content-server2-properties-file/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server2-properties-file.png" data-orig-size="720,354" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Content server2.properties file" data-image-description="" data-image-caption="&lt;p&gt;Content of `server2.properties` file.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server2-properties-file-300x148.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server2-properties-file.png" decoding="async" loading="lazy" class="wp-image-96026 size-full" src="../Images/fbd5f9e6ece8ae76fcd54ec09a3fb75b.png" alt="Content Server2.properties File" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server2-properties-file.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/content-server2-properties-file-300x148.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server2-properties-file.png"/></noscript><figcaption id="caption-attachment-96026" class="wp-caption-text">Content of <code>server2.properties</code> file.</figcaption></figure>
<p>将<code>node.id</code>改为<code>2</code>:</p>
<pre class="language-bash hljs">node.id=2
</pre>
<p>然后，改变<code>listeners</code>，如下所示:</p>
<pre class="language-bash hljs">listeners=PLAINTEXT://:9093,CONTROLLER://:19093
</pre>
<p>同样改变<code>advertised.listeners</code>:</p>
<pre class="language-bash hljs">advertised.listeners=PLAINTEXT://localhost:9093
</pre>
<figure id="attachment_96029" aria-describedby="caption-attachment-96029" class="wp-caption aligncenter"><img data-attachment-id="96029" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/configurations-server2-properties/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server2-properties.png" data-orig-size="720,347" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Configurations server2.properties" data-image-description="" data-image-caption="&lt;p&gt;Configurations for `server2.properties`.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server2-properties-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server2-properties.png" decoding="async" class="wp-image-96029 size-full jetpack-lazy-image" src="../Images/56000846cba2653df664132bc8258d48.png" alt="Configurations Server2.properties" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server2-properties.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server2-properties-300x145.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server2-properties.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server2-properties.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="96029" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/configurations-server2-properties/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server2-properties.png" data-orig-size="720,347" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Configurations server2.properties" data-image-description="" data-image-caption="&lt;p&gt;Configurations for `server2.properties`.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server2-properties-300x145.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server2-properties.png" decoding="async" loading="lazy" class="wp-image-96029 size-full" src="../Images/56000846cba2653df664132bc8258d48.png" alt="Configurations Server2.properties" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server2-properties.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server2-properties-300x145.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server2-properties.png"/></noscript><figcaption id="caption-attachment-96029" class="wp-caption-text">Configurations for <code>server2.properties</code>.</figcaption></figure>
<p>接下来，更改日志目录<code>log.dirs</code>:</p>
<pre class="language-bash hljs">log.dirs=/tmp/server2/kraft-combined-logs
</pre>
<figure id="attachment_96031" aria-describedby="caption-attachment-96031" class="wp-caption aligncenter"><img data-attachment-id="96031" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/additional-configurations-server2-properties/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server2-properties.png" data-orig-size="730,339" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Additional configurations server2.properties" data-image-description="" data-image-caption="&lt;p&gt;Additional configurations for `server2.properties`.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server2-properties-300x139.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server2-properties.png" decoding="async" class="wp-image-96031 size-full jetpack-lazy-image" src="../Images/bdbd3e27bb2bdc1d79701f7747c7c10c.png" alt="Additional Configurations Server2.properties" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server2-properties.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server2-properties-300x139.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server2-properties.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server2-properties.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="96031" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/additional-configurations-server2-properties/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server2-properties.png" data-orig-size="730,339" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Additional configurations server2.properties" data-image-description="" data-image-caption="&lt;p&gt;Additional configurations for `server2.properties`.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server2-properties-300x139.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server2-properties.png" decoding="async" loading="lazy" class="wp-image-96031 size-full" src="../Images/bdbd3e27bb2bdc1d79701f7747c7c10c.png" alt="Additional Configurations Server2.properties" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server2-properties.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server2-properties-300x139.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server2-properties.png"/></noscript><figcaption id="caption-attachment-96031" class="wp-caption-text">Additional configurations for <code>server2.properties</code>.</figcaption></figure>
<p>这就是<code>server2.properties</code>服务器的所有配置。在提示符下键入<strong> CTRL X </strong>和<strong> yes </strong>来保存我们的配置。</p>
<p>接下来，我们将配置第三台服务器<code>server3.properties</code>。</p>
<p>运行以下命令开始配置文件:</p>
<pre class="language-bash hljs">nano server3.properties
</pre>
<figure id="attachment_96035" aria-describedby="caption-attachment-96035" class="wp-caption aligncenter"><img data-attachment-id="96035" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/content-server3-properties-file/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server3-properties-file.png" data-orig-size="720,354" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Content server3.properties file" data-image-description="" data-image-caption="&lt;p&gt;Content of the `server3.properties` file.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server3-properties-file-300x148.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server3-properties-file.png" decoding="async" class="wp-image-96035 size-full jetpack-lazy-image" src="../Images/ba3c3db6296d06e1443c2adc70583e07.png" alt="Content Server3.properties File" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server3-properties-file.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/content-server3-properties-file-300x148.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server3-properties-file.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server3-properties-file.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="96035" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/content-server3-properties-file/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server3-properties-file.png" data-orig-size="720,354" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Content server3.properties file" data-image-description="" data-image-caption="&lt;p&gt;Content of the `server3.properties` file.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server3-properties-file-300x148.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server3-properties-file.png" decoding="async" loading="lazy" class="wp-image-96035 size-full" src="../Images/ba3c3db6296d06e1443c2adc70583e07.png" alt="Content Server3.properties File" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server3-properties-file.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/content-server3-properties-file-300x148.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/content-server3-properties-file.png"/></noscript><figcaption id="caption-attachment-96035" class="wp-caption-text">Content of the <code>server3.properties</code> file.</figcaption></figure>
<p>将<code>node.id</code>更新为<code>3</code>,如下所示:</p>
<pre class="language-bash hljs">node.id=3
</pre>
<p>然后，改变<code>listeners</code>，像这样:</p>
<pre class="language-bash hljs">listeners=PLAINTEXT://:9094,CONTROLLER://:19094
</pre>
<p>将<code>advertised.listeners</code>更改如下:</p>
<pre class="language-bash hljs">advertised.listeners=PLAINTEXT://localhost:9094
</pre>
<figure id="attachment_96038" aria-describedby="caption-attachment-96038" class="wp-caption aligncenter"><img data-attachment-id="96038" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/configurations-server3-properties-file/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server3-properties-file.png" data-orig-size="720,351" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Configurations server3.properties file" data-image-description="" data-image-caption="&lt;p&gt;Configurations for the `server3.properties` file.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server3-properties-file-300x146.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server3-properties-file.png" decoding="async" class="wp-image-96038 size-full jetpack-lazy-image" src="../Images/e968cd08a88a5b8e4bb7270b4183b091.png" alt="Configurations Server3.properties File" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server3-properties-file.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server3-properties-file-300x146.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server3-properties-file.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server3-properties-file.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="96038" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/configurations-server3-properties-file/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server3-properties-file.png" data-orig-size="720,351" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Configurations server3.properties file" data-image-description="" data-image-caption="&lt;p&gt;Configurations for the `server3.properties` file.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server3-properties-file-300x146.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server3-properties-file.png" decoding="async" loading="lazy" class="wp-image-96038 size-full" src="../Images/e968cd08a88a5b8e4bb7270b4183b091.png" alt="Configurations Server3.properties File" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server3-properties-file.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server3-properties-file-300x146.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/configurations-server3-properties-file.png"/></noscript><figcaption id="caption-attachment-96038" class="wp-caption-text">Configurations for the <code>server3.properties</code> file.</figcaption></figure>
<p>使用以下命令更改日志目录<code>log.dirs</code>:</p>
<pre class="language-bash hljs">log.dirs=/tmp/server3/kraft-combined-logs
</pre>
<figure id="attachment_96041" aria-describedby="caption-attachment-96041" class="wp-caption aligncenter"><img data-attachment-id="96041" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/additional-configurations-server3-properties/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server3-properties.png" data-orig-size="730,350" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Additional configurations server3.properties" data-image-description="" data-image-caption="&lt;p&gt;Additional configurations for `server3.properties`.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server3-properties-300x144.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server3-properties.png" decoding="async" class="wp-image-96041 size-full jetpack-lazy-image" src="../Images/a8602aad546b8e4779342d8b95f2983e.png" alt="Additional Configurations Server3.properties" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server3-properties.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server3-properties-300x144.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server3-properties.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server3-properties.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="96041" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/additional-configurations-server3-properties/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server3-properties.png" data-orig-size="730,350" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Additional configurations server3.properties" data-image-description="" data-image-caption="&lt;p&gt;Additional configurations for `server3.properties`.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server3-properties-300x144.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server3-properties.png" decoding="async" loading="lazy" class="wp-image-96041 size-full" src="../Images/a8602aad546b8e4779342d8b95f2983e.png" alt="Additional Configurations Server3.properties" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server3-properties.png 730w, https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server3-properties-300x144.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/additional-configurations-server3-properties.png"/></noscript><figcaption id="caption-attachment-96041" class="wp-caption-text">Additional configurations for <code>server3.properties</code>.</figcaption></figure>
<p>接下来，使用以下命令为我们的集群创建一个ID:</p>
<pre class="language-bash hljs">cd ..
cd ..
./bin/kafka-storage.sh random-uuid
</pre>
<p>运行这些命令后，将会注销一个唯一的ID。请务必复制ID，因为我们稍后会用到它:</p>
<figure id="attachment_96046" aria-describedby="caption-attachment-96046" class="wp-caption aligncenter"><img data-attachment-id="96046" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/creation-of-unique-id/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-of-unique-id.png" data-orig-size="720,42" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Creation of unique ID" data-image-description="" data-image-caption="&lt;p&gt;Creation of a unique ID.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-of-unique-id-300x18.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-of-unique-id.png" decoding="async" class="wp-image-96046 size-full jetpack-lazy-image" src="../Images/bfe0f22a677579a3ffbf458b697a7399.png" alt="Creation Of Unique ID" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-of-unique-id.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/creation-of-unique-id-300x18.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-of-unique-id.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-of-unique-id.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="96046" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/creation-of-unique-id/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-of-unique-id.png" data-orig-size="720,42" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Creation of unique ID" data-image-description="" data-image-caption="&lt;p&gt;Creation of a unique ID.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-of-unique-id-300x18.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-of-unique-id.png" decoding="async" loading="lazy" class="wp-image-96046 size-full" src="../Images/bfe0f22a677579a3ffbf458b697a7399.png" alt="Creation Of Unique ID" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-of-unique-id.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/creation-of-unique-id-300x18.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/creation-of-unique-id.png"/></noscript><figcaption id="caption-attachment-96046" class="wp-caption-text">Creation of a unique ID.</figcaption></figure>
<p>接下来，我们将格式化日志目录的位置，以允许Kafka存储日志:</p>
<pre class="language-bash hljs">./bin/kafka-storage.sh format -t iKDSfyiITuqsq1u8b9hEQQ -c ./config/kraft/server1.properties

./bin/kafka-storage.sh format -t iKDSfyiITuqsq1u8b9hEQQ -c ./config/kraft/server2.properties

./bin/kafka-storage.sh format -t iKDSfyiITuqsq1u8b9hEQQ -c ./config/kraft/server3.properties
</pre>
<p>以下是输出结果:</p>
<figure id="attachment_96050" aria-describedby="caption-attachment-96050" class="wp-caption aligncenter"><img data-attachment-id="96050" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/kraft-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-output.png" data-orig-size="720,126" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="KRaft output" data-image-description="" data-image-caption="&lt;p&gt;KRaft output.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-output-300x53.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-output.png" decoding="async" class="wp-image-96050 size-full jetpack-lazy-image" src="../Images/74376007347ca5f9cb2afb439d2eca18.png" alt="KRaft Output" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-output.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-output-300x53.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-output.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-output.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="96050" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/kraft-output/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-output.png" data-orig-size="720,126" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="KRaft output" data-image-description="" data-image-caption="&lt;p&gt;KRaft output.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-output-300x53.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-output.png" decoding="async" loading="lazy" class="wp-image-96050 size-full" src="../Images/74376007347ca5f9cb2afb439d2eca18.png" alt="KRaft Output" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-output.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-output-300x53.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/kraft-output.png"/></noscript><figcaption id="caption-attachment-96050" class="wp-caption-text">KRaft output.</figcaption></figure>
<p>此时，我们的服务器没有运行。使用以下命令启动服务器:</p>
<pre class="language-bash hljs">export KAFKA_HEAP_OPTS="-Xmx200M -Xms100M"
./bin/kafka-server-start.sh -daemon ./config/kraft/server1.properties
./bin/kafka-server-start.sh -daemon ./config/kraft/server2.properties
./bin/kafka-server-start.sh -daemon ./config/kraft/server3.properties
ps -ef | grep kafka
</pre>
<figure id="attachment_96052" aria-describedby="caption-attachment-96052" class="wp-caption aligncenter"><img data-attachment-id="96052" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/output-showing-servers-running/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/output-showing-servers-running.png" data-orig-size="720,346" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Output showing servers running" data-image-description="" data-image-caption="&lt;p&gt;Output, showing servers are running.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/output-showing-servers-running-300x144.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/output-showing-servers-running.png" decoding="async" class="wp-image-96052 size-full jetpack-lazy-image" src="../Images/8c0b108d9aa2fb6642e9d1427c107e95.png" alt="Output Showing Servers Running" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/output-showing-servers-running.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/output-showing-servers-running-300x144.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/output-showing-servers-running.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/output-showing-servers-running.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="96052" data-permalink="https://blog.logrocket.com/apache-kafka-real-time-data-streaming-app/output-showing-servers-running/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2019/11/output-showing-servers-running.png" data-orig-size="720,346" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Output showing servers running" data-image-description="" data-image-caption="&lt;p&gt;Output, showing servers are running.&lt;/p&gt;&#10;" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2019/11/output-showing-servers-running-300x144.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2019/11/output-showing-servers-running.png" decoding="async" loading="lazy" class="wp-image-96052 size-full" src="../Images/8c0b108d9aa2fb6642e9d1427c107e95.png" alt="Output Showing Servers Running" srcset="https://blog.logrocket.com/wp-content/uploads/2019/11/output-showing-servers-running.png 720w, https://blog.logrocket.com/wp-content/uploads/2019/11/output-showing-servers-running-300x144.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/output-showing-servers-running.png"/></noscript><figcaption id="caption-attachment-96052" class="wp-caption-text">Output, showing servers are running.</figcaption></figure>
<p>现在我们知道了如何配置Kafka服务器，是时候学习如何创建主题了。<br/>运行以下命令:</p>
<pre class="language-bash hljs">./bin/kafka-topics.sh --create --topic kraft-test --partitions 3 --replication-factor 3 --bootstrap-server localhost:9092
</pre>
<p>在本教程中，我们将使用用于Node.js的<a href="https://www.npmjs.com/package/kafka-node" target="_blank" rel="noopener"> kafka-node </a>客户端库。kafka还有用于其他编程语言的<a href="https://cwiki.apache.org/confluence/display/KAFKA/Clients" target="_blank" rel="noopener">其他客户端</a>，所以您可以随意使用Kafka来编写您选择的任何语言。在撰写本文时，KRaft还不能用于生产，只能用于开发模式。对于本教程，我们将使用ZooKeeper。</p>
<h2 id="bootstrapping-the-application-and-installing-dependencies">引导应用程序并安装依赖项</h2>
<p>因为我们在这个练习中使用Node.js，所以我们将从引导一个具有最小结构的基本应用程序开始。</p>
<p>首先，我们将创建一个新目录来存放项目并导航到其中，如下所示:</p>
<pre class="language-bash hljs">mkdir kafka-sample-app
cd kafka-sample-app
</pre>
<p>接下来，我们将通过运行<code>npm init</code>命令创建一个<code>package.json</code>文件。然后，我们将按照说明像往常一样设置项目。</p>
<p>项目建立后,<code>package.json</code>文件应该是这样的:</p>
<pre class="language-bash hljs">{
  "name": "kafka-producer_consumer_tutorial",
  "version": "1.0.0",
  "description": "Building a real-time data streaming application pipeline with Apache Kafka\"",
  "main": "app.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",
    "start": "node producer.js"
  },
  "author": "Deborah Emeni",
  "license": "ISC",
  "dependencies": {
    "dotenv": "^16.0.0",
    "kafka-node": "^5.0.0"
  }
}
</pre>
<p>我们已经安装了两个以后会用到的依赖项。为了安装<code>kafka-node</code>客户端，我们在终端上运行<code>npm install kafka-node</code>。<code>kafka-node</code>的<a href="https://www.npmjs.com/package/kafka-node" target="_blank" rel="noopener">文档</a>可在npm上获得。<code>dotenv</code>包用于为app设置环境变量。</p>
<p>我们可以通过运行<code>npm install dotenv</code>来安装包。</p>
<p>现在我们已经完成了依赖项的安装，让我们创建所有必需的文件，如下图所示:</p>
<figure class="wp-caption aligncenter"><img decoding="async" src="../Images/3ed63db2c27bbd6855e49aba1696bcdb.png" alt="File hierarchy." data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/file-hierarchy.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/file-hierarchy.png"/><noscript><img data-lazy-fallback="1" decoding="async" loading="lazy" src="../Images/3ed63db2c27bbd6855e49aba1696bcdb.png" alt="File hierarchy." data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/file-hierarchy.png"/></noscript><figcaption class="wp-caption-text">File hierarchy.</figcaption></figure>
<h2 id="creating-topics">创建主题</h2>
<p>上图显示了应用程序所需的所有必要文件。让我们仔细看看每个文件，以了解发生了什么。</p>
<p>首先，让我们使用下面的命令从终端手动创建一个新主题，它有三个分区和副本:</p>
<pre class="language-bash hljs">./kafka-topics.sh --create --zookeeper  --replication-factor  --partitions  --topic 
</pre>
<p>在实际应用中，我们应该始终用真实值更新<code>&lt;ZOOKEEPER_URL:PORT&gt;</code>、<code>&lt;NO_OF_REPLICATIONS&gt;</code>、<code>&lt;NO_OF_PARTITIONS&gt;</code>和<code>&lt;TOPIC_NAME&gt;</code>。然而，出于本教程的目的，我们将用一个脚本来处理它。创建新主题的代码可以在<a href="https://github.com/firebase007/kafka_producer_consumer_tutorial/blob/master/createTopic.js" target="_blank" rel="noopener"> <code>[createTopic.js]</code>文件</a>中找到。</p>
<p>代码如下:</p>
<pre class="language-javascript hljs">const kafka = require('kafka-node');
const config  = require('./config');

const client = new kafka.KafkaClient({kafkaHost: config.KafkaHost});

const topicToCreate = [{
  topic: config.KafkaTopic,
  partitions: 1,
  replicationFactor: 1
}
];

client.createTopics(topicToCreate, (error, result) =&gt; {
  // result is an array of any errors if a given topic could not be created
  console.log(result, 'topic created successfully');
});
</pre>
<p>在这里，我们导入Kafka客户端并连接到Kafka设置。您会注意到我们从未在用例中配置复制因子。然而，这并不反映现实生活中的场景。</p>
<p>在生产用例中，我们可以根据我们要处理的数据量或消息量来设置多个Kafka代理。让我们看看如何在本地设置中实现这一点。</p>
<h2 id="producing-content">生产内容</h2>
<p>现在我们已经创建了一个主题，我们可以为主题生成(或写入)数据(或内容)。写主题的代码可以在<a href="https://github.com/firebase007/kafka_producer_consumer_tutorial/blob/master/producer.js" target="_blank" rel="noopener"> <code>[producer.js]</code>文件</a>中找到。</p>
<p>代码如下:</p>
<pre class="language-javascript hljs">const Kafka = require('kafka-node');
const config  = require('./config');

const Producer = Kafka.Producer;
const client = new Kafka.KafkaClient({kafkaHost: config.KafkaHost});
const producer = new Producer(client,  {requireAcks: 0, partitionerType: 2});

const pushDataToKafka =(dataToPush) =&gt; {

  try {
  let payloadToKafkaTopic = [{topic: config.KafkaTopic, messages: JSON.stringify(dataToPush) }];
  console.log(payloadToKafkaTopic);
  producer.on('ready', async function() {
    producer.send(payloadToKafkaTopic, (err, data) =&gt; {
          console.log('data: ', data);
  });

  producer.on('error', function(err) {
    //  handle error cases here
  })
  })
  }
catch(error) {
  console.log(error);
}

};

const jsonData = require('./app_json.js');

pushDataToKafka(jsonData);
</pre>
<p>在这里，我们导入了<code>kafka-node</code>库，并设置了<code>client</code>来接收来自卡夫卡<code>producer</code>或经纪人的连接。一旦建立了连接，我们就向指定的<code>KafkaTopic</code>生成数据。注意，在现实世界的应用程序中，一旦发布任务通过调用<code>client.close()</code>方法完成，客户端的连接应该总是关闭的。</p>
<p>现在，如果我们使用<code>./start.sh</code>命令运行启动脚本，我们将把数据写入我们的Kafka主题:</p>
<pre class="language-bash hljs">npm start
</pre>
<h2 id="consuming-content">消费内容</h2>
<p>要读取主题数据(或内容)，我们可以使用<a href="https://github.com/firebase007/kafka_producer_consumer_tutorial/blob/master/consumer.js" target="_blank" rel="noopener"> <code>[consumer.js]</code>文件</a>中的消费者脚本。<br/>如果我们运行<code>node ./consumer.js</code>，我们将得到以下输出:</p>
<figure class="wp-caption aligncenter"><img decoding="async" src="../Images/d19ad8f2829cdd2cdda67fbef10d7388.png" alt="Running the consumer script to read from a Kafka topic." data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/11/running-consumer-script.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/running-consumer-script.png"/><noscript><img data-lazy-fallback="1" decoding="async" loading="lazy" src="../Images/d19ad8f2829cdd2cdda67fbef10d7388.png" alt="Running the consumer script to read from a Kafka topic." data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/11/running-consumer-script.png"/></noscript><figcaption class="wp-caption-text">Running the consumer script to read from a Kafka topic.</figcaption></figure>
<p>下面是<code>consumer.js</code>文件的代码:</p>
<pre class="language-javascript hljs">const kafka = require('kafka-node');
const config = require('./config');

try {
 const Consumer = kafka.Consumer;
 const client = new kafka.KafkaClient({idleConnection: 24 * 60 * 60 * 1000,  kafkaHost: config.KafkaHost});

 let consumer = new Consumer(
    client,
    [{ topic: config.KafkaTopic, partition: 0 }],
    {
      autoCommit: true,
      fetchMaxWaitMs: 1000,
      fetchMaxBytes: 1024 * 1024,
      encoding: 'utf8',
      // fromOffset: false
    }
  );
  consumer.on('message', async function(message) {
    console.log(
      'kafka ',
      JSON.parse(message.value)
    );
  })
  consumer.on('error', function(error) {
    //  handle error 
    console.log('error', error);
  });
}
catch(error) {
  // catch error trace
  console.log(error);
}
</pre>
<p>在这里，我们连接到Kafka客户端，并使用来自预定义的Kafka主题的数据。</p>
<h2 id="running-the-application">运行应用程序</h2>
<p>现在我们已经完成了设置，我们需要在运行应用程序之前启动ZooKeeper服务器。这一步是必要的，因为Kafka服务器依赖于ZooKeeper服务器来运行。</p>
<p>要启动ZooKeeper服务器，请运行以下命令:</p>
<pre class="language-bash hljs">bin/zookeeper-server-start.sh config/zookeeper.properties
</pre>
<p>接下来，运行以下命令启动Kafka服务器:</p>
<pre class="language-bash hljs">bin/Kafka-server-start.sh config/server.properties
</pre>
<p>我们可以通过运行以下命令来检查代理中可用Kafka主题的数量:</p>
<pre class="language-bash hljs">bin/Kafka-topics.sh --list --zookeeper localhost:2181
</pre>
<p>我们还可以通过运行<code>console-consumer</code>命令来使用Kafka主题中的数据:</p>
<pre class="language-bash hljs">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic kafka-example-topic  --from-beginning
</pre>
<p>此外，Kafka提供了一个<code>create</code>脚本，允许开发人员在他们的集群上手动创建一个主题:</p>
<pre class="language-bash hljs">./kafka-topics.sh --create --zookeeper  --replication-factor  --partitions  --topic 
</pre>
<p>需要注意的是，在创建Kafka主题之前，我们需要在不同的终端窗口上分别强制启动ZooKeeper和Kafka服务器。</p>
<h2 id="conclusion">结论</h2>
<p>Kafka可以充当发布者/订阅者类型的系统，用于构建类似于<a href="https://www.rabbitmq.com" target="_blank" rel="noopener"> RabbitMQ </a>的批量数据的读写流。它还可以用于构建高弹性、可伸缩的实时流和处理应用程序。</p>
<p>请注意，这种类型的流处理可以基于一些预定义的事件动态完成。此外，就像消息传递系统一样，Kafka有一个由高度容忍的集群组成的存储机制，这些集群是复制的和高度分布式的。我们所说的复制是指数据可以分布在多个不同的集群中，从而最大限度地减少整个链中的数据丢失。</p>
<p>Kafka可以作为一个独立的插件集成到其他系统中。在这种情况下，它可以根据需要独立扩展。这意味着我们可以独立地扩展生产者和消费者，而不会对整个应用程序产生任何副作用。</p>
<p>我们已经看到，构建数据管道涉及到将数据从生成数据的源点移动到另一个应用程序需要或使用的目标点。源点也可以指从另一个应用程序输出的数据，</p>
<p>本教程的代码可以在这个<a href="https://github.com/firebase007/kafka_producer_consumer_tutorial" target="_blank" rel="noopener"> GitHub repo </a>上获得。为了感受卡夫卡的设计哲学，你可以查看<a href="https://kafka.apache.org/documentation/#design" target="_blank" rel="noopener">文档的这一部分</a>。在未来的教程中，我们可以看看通过Kafka API提供的其他工具，如Kafka streams和Kafka connect。有关介绍，您可以查看<a href="https://kafka.apache.org/documentation/#api" target="_blank" rel="noopener">文档的本节</a>。</p>
<p>希望您现在已经准备好探索更复杂的用例了。如果您有任何问题，请不要犹豫，在下面的评论区与我联系，或者在<a href="https://twitter.com/alex_nnakwue" target="_blank" rel="noopener"> Twitter </a>上与我联系。</p><div class="code-block code-block-23">
<div class="blog-plug inline-plug node-plug"><h2>200只<img src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> <noscript> <img data-lazy-fallback="1" src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> </noscript>显示器出现故障，生产中网络请求缓慢</h2><p>部署基于节点的web应用程序或网站是容易的部分。确保您的节点实例继续为您的应用程序提供资源是事情变得更加困难的地方。如果您对确保对后端或第三方服务的请求成功感兴趣，</p><a href="https://lp.logrocket.com/blg/node-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer"><img src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/><noscript><img data-lazy-fallback="1" src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/></noscript></a><a href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用程序的DVR，记录下用户与你的应用程序交互时发生的一切。您可以汇总并报告有问题的网络请求，以快速了解根本原因，而不是猜测问题发生的原因。</p><p>LogRocket检测您的应用程序以记录基线性能计时，如页面加载时间、到达第一个字节的时间、慢速网络请求，还记录Redux、NgRx和Vuex操作/状态。</p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">Start monitoring for free</a><p>. </p></div>
</div>

<p class="clearfix"/>
 <p class="clearfix"/>
</article>

</div>    
</body>
</html>