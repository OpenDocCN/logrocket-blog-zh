<html>
<head>
<title>How to create and send push notifications in React Native - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在React Native - LogRocket博客中创建和发送推送通知</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/create-send-push-notifications-react-native/#0001-01-01">https://blog.logrocket.com/create-send-push-notifications-react-native/#0001-01-01</a></blockquote><div><article class="article-post">
<p><strong> <em>编者按:</em> </strong> <em>本文于2022年6月10日更新，以包括更多关于Expo、Firebase和React Native的最新信息，并为清晰起见进行了重新组织。</em></p>
<p>推送通知——应用程序发送给安装了它的用户的消息——已经成为为企业和用户构建应用程序时要考虑的一个重要方面。</p>
<p>推送通知类似于短信，但发送时不需要任何费用。因此，许多企业现在更喜欢推送通知，向安装了应用程序的用户发送信息和警报。在本文中，我们将看看<a href="https://blog.logrocket.com/tag/react-native/" target="_blank" rel="noopener"> React Native </a>中的推送通知。</p>
<h3>内容</h3>

<h2 id="what-are-push-notifications">什么是推送通知？</h2>
<p>推送通知是由用户已安装的应用程序的制作者发送的消息或警报。有两种主要类型的通知，即前台和后台通知。</p>
<p>前台通知是当应用程序当前打开并运行时用户收到的通知类型，而后台通知是在应用程序当前是否打开时发送的。<br/>推送通知在移动应用开发领域很受欢迎，原因有很多，包括:</p>
<ul>
<li>使公司能够以较低的成本为产品和报价做广告</li>
<li>改善整体用户体验</li>
<li>更快地发送交易收据</li>
<li>转化更多用户</li>
<li>它们是可靠的——当用户打开手机时，他们总是会收到离线信息</li>
</ul>
<h2 id="push-notification-architecture-react-native">React Native中的推送通知架构</h2>
<p><img data-attachment-id="115986" data-permalink="https://blog.logrocket.com/create-send-push-notifications-react-native/push-notifications-in-react-native-apns-fcm/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/11/Push-notifications-in-React-Native-APNs-FCM.png" data-orig-size="730,486" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Push notifications in React Native APNs FCM" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/11/Push-notifications-in-React-Native-APNs-FCM-300x200.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/11/Push-notifications-in-React-Native-APNs-FCM.png" decoding="async" class="size-full wp-image-115986 aligncenter jetpack-lazy-image" src="../Images/6b970d0d378a23a8fbadd5eb237abc1d.png" alt="Push notifications in React Native APNs FCM" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/11/Push-notifications-in-React-Native-APNs-FCM.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/11/Push-notifications-in-React-Native-APNs-FCM-300x200.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/11/Push-notifications-in-React-Native-APNs-FCM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/11/Push-notifications-in-React-Native-APNs-FCM.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="115986" data-permalink="https://blog.logrocket.com/create-send-push-notifications-react-native/push-notifications-in-react-native-apns-fcm/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/11/Push-notifications-in-React-Native-APNs-FCM.png" data-orig-size="730,486" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Push notifications in React Native APNs FCM" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/11/Push-notifications-in-React-Native-APNs-FCM-300x200.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/11/Push-notifications-in-React-Native-APNs-FCM.png" decoding="async" loading="lazy" class="size-full wp-image-115986 aligncenter" src="../Images/6b970d0d378a23a8fbadd5eb237abc1d.png" alt="Push notifications in React Native APNs FCM" srcset="https://blog.logrocket.com/wp-content/uploads/2020/11/Push-notifications-in-React-Native-APNs-FCM.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/11/Push-notifications-in-React-Native-APNs-FCM-300x200.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/11/Push-notifications-in-React-Native-APNs-FCM.png"/></noscript>
<p>谈到React Native中的推送通知，有几种方法可以设置它们:</p>
<ul>
<li>特定于本机平台的通知服务(FCM/APN)</li>
<li>世博会推送通知服务和其他云服务</li>
<li>React本机库，如react-native-push-notification</li>
</ul>
<h3 id="native-platform-specific-notification-services-fcm-apns">特定于本机平台的通知服务(FCM/APN)</h3>
<p>Android和iOS平台都提供了用于接收推送通知的特定于原生平台的API。<a href="https://blog.logrocket.com/react-native-push-notifications-firebase-cloud-messaging/" target="_blank" rel="noopener"> Firebase云消息(FCM) </a>帮助为Android设备发送推送通知，为iOS设备发送苹果推送通知服务(APNs)。我们可以使用React Native Firebase库在Android上集成FCM，使用<a href="https://github.com/react-native-push-notification/ios" target="_blank" rel="noopener"> push-notification-ios </a>库在ios上集成APN。</p>
<p>此外，React Native Firebase库提供了一种通过FCM在iOS上接收推送通知的方式。您可以从Node.js服务器向注册了<a href="https://github.com/firebase/firebase-admin-node" target="_blank" rel="noopener"> firebase-admin </a>和<a href="https://github.com/node-apn/node-apn" target="_blank" rel="noopener"> node-apn </a>的移动设备发送远程通知。</p>
<h3 id="expo-push-notifications-other-cloud-services">世博会推送通知和其他云服务</h3>
<p>FCM和APN都是特定于平台的原生推送通知服务，所以如果我们直接使用这些原生推送通知服务，我们通常必须在应用的前端和后端使用不同的库。因此，一些云服务提供了使用统一源代码的FCM和APN的方法。</p>
<p>流行的推送通知服务有:</p>
<ul>
<li>亚马逊简单通知服务(SNS)</li>
<li><a href="https://blog.logrocket.com/implement-push-notifications-react-native-onesignal/" target="_blank" rel="noopener">一个信号</a></li>
<li>Azure通知中心</li>
<li>世博会推送通知</li>
</ul>
<p>这些通知服务在本地推送通知系统之上提供了一个抽象层，并带有一个托管的中间推送通知服务器(见上图)。</p>
<h3 id="react-native-libraries-react-native-push-notification">React本机库，如react-native-push-notification</h3>
<p>像<a href="https://github.com/zo0r/react-native-push-notification" target="_blank" rel="noopener">react-native-push-notification</a>和<a href="https://github.com/wix/react-native-notifications" target="_blank" rel="noopener">react-native-notifications</a>这样的库提供本地模块来接收远程通知，并通过统一的库API轻松显示本地通知。</p>
<p>您可以对这些库直接使用FCM/APN或托管推送通知服务。我们必须使用Expo中的裸工作流来使用这些库，因为这些不包含在Expo应用程序中。</p>
<h2 id="push-notifications-react-native-demo">React本机演示中的推送通知</h2>
<p>要在React本机应用程序中使用推送通知，首先我们需要注册应用程序以获得推送通知令牌。此令牌是唯一标识每个设备的长字符串。然后，我们将令牌存储在服务器上的数据库中，发送通知，并处理收到的我们发送的通知。</p>
<p>在我们深入研究之前，我们将为已经开发的项目添加推送通知。这个项目是一个销售二手物品的电子商务反应本地应用程序。</p>
<p>要将其源代码下载到您的计算机中，请在终端中运行以下命令:</p>
<pre class="language-shell hljs">git clone https://github.com/codezri/Done-With-It-App.git
</pre>
<p>接下来，我们将安装项目所需的依赖项，并启动React本地开发服务器:</p>
<pre class="language-shell hljs">yarn install 
yarn start 
</pre>
<p>以上命令安装依赖项并启动Expo开发服务器，因此您可以通过在Android或iOS上使用Expo应用程序来测试您的应用程序。示例应用程序看起来如下，带有一个工作的后端(我们将在讨论移动前端代码后设置应用程序后端):</p>
<p><img data-attachment-id="115990" data-permalink="https://blog.logrocket.com/create-send-push-notifications-react-native/the-sample-react-native-app-on-an-android-device/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/11/The-sample-React-Native-app-on-an-Android-device.png" data-orig-size="320,676" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The sample React Native app on an Android device" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/11/The-sample-React-Native-app-on-an-Android-device-142x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/11/The-sample-React-Native-app-on-an-Android-device.png" decoding="async" class="size-full wp-image-115990 aligncenter jetpack-lazy-image" src="../Images/8bd92373c51bec0f93138486fa877655.png" alt="The sample React Native app on an Android device" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/11/The-sample-React-Native-app-on-an-Android-device.png 320w, https://blog.logrocket.com/wp-content/uploads/2020/11/The-sample-React-Native-app-on-an-Android-device-142x300.png 142w" data-lazy-sizes="(max-width: 320px) 100vw, 320px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/11/The-sample-React-Native-app-on-an-Android-device.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/11/The-sample-React-Native-app-on-an-Android-device.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="115990" data-permalink="https://blog.logrocket.com/create-send-push-notifications-react-native/the-sample-react-native-app-on-an-android-device/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/11/The-sample-React-Native-app-on-an-Android-device.png" data-orig-size="320,676" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="The sample React Native app on an Android device" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/11/The-sample-React-Native-app-on-an-Android-device-142x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/11/The-sample-React-Native-app-on-an-Android-device.png" decoding="async" loading="lazy" class="size-full wp-image-115990 aligncenter" src="../Images/8bd92373c51bec0f93138486fa877655.png" alt="The sample React Native app on an Android device" srcset="https://blog.logrocket.com/wp-content/uploads/2020/11/The-sample-React-Native-app-on-an-Android-device.png 320w, https://blog.logrocket.com/wp-content/uploads/2020/11/The-sample-React-Native-app-on-an-Android-device-142x300.png 142w" sizes="(max-width: 320px) 100vw, 320px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/11/The-sample-React-Native-app-on-an-Android-device.png"/></noscript>
<p>接下来，我们将从React Native Expo获得一个推送通知令牌，以开始接收应用程序的通知。</p>
<h2 id="getting-push-notification-token">获取推送通知令牌</h2>
<p>要在React本机应用程序中使用推送通知，首先我们需要注册应用程序以获得推送通知令牌。这里，我们将在Expo中使用通知API。</p>
<p>为此，让我们将<code>cd</code>放入<code>navigation</code>目录和<code>AppNavigator</code>组件中。这里我们要从Expo中派生出一个令牌。下面让我们从Expo中获取<code>Notifications</code>功能:</p>
<pre class="language-shell hljs">import * as Notifications from 'expo-notifications';
</pre>
<p>上述功能帮助我们请求用户许可来发送推送通知和接收特定设备的唯一Expo通知令牌。</p>
<p>现在，我们将在<code>AppNavigator</code>组件中编写一个异步函数，它将从React Native Expo请求一个令牌:</p>
<pre class="language-js hljs">async function registerForPushNotificationsAsync() {
    let token;

    const { status: existingStatus } = await Notifications.getPermissionsAsync();
    let finalStatus = existingStatus;

    if (existingStatus !== 'granted') {
        const { status } = await Notifications.requestPermissionsAsync();
        finalStatus = status;
    }
    if (finalStatus !== 'granted') {
        alert('Failed to get push token for push notification!');
        return;
    }
    token = (await Notifications.getExpoPushTokenAsync()).data;
    console.log(token);

    return token;
}
</pre>
<p>在上面的代码中，我们使用最近安装的<code>expo-notifications</code>模块来获得用户对通知的许可。该函数等待接收通知许可状态。</p>
<p>接下来，我们检查权限是否被授予，如果没有，我们显示一个错误警告并立即从函数返回。如果令牌请求过程成功，我们从函数返回令牌。此外，目前，出于开发目的，我们将Expo令牌记录到控制台。</p>
<p>为了在我们的应用程序中调用上述函数，我们将使用来自<code>React</code>的<code>useEffect</code>钩子:</p>
<pre class="language-js hljs">const AppNavigator = () =&gt; {
    useEffect(() =&gt; {
        registerForPushNotificationsAsync();
    }, []);
</pre>
<p>在上面的代码中，我们传递了从<code>re``act</code>导入的<code>useEffect</code>钩子，并传递了一个函数<code>registerForPushNotificationsAsync</code>，以确保它只被调用一次。</p>
<p>现在，通过Expo应用程序打开应用程序。打开应用程序后，您可以在控制台上看到Expo推送通知令牌。当新用户打开应用程序时，将生成这个唯一的令牌，因此我们可以将这些令牌存储在服务器中，并以编程方式向所有注册的设备发送通知。将令牌保存在某个地方—我们将很快使用它来测试通知。</p>
<h2 id="sending-test-notification">发送测试通知</h2>
<p>我们可以通过添加推送通知令牌，使用<a href="https://expo.dev/notifications" target="_blank" rel="noopener"> Expo通知工具</a>向设备发送测试通知。转到博览会通知工具，输入您的令牌，输入标题和描述，将您的应用程序保留在后台，然后单击<strong>发送通知</strong>按钮发送测试通知。</p>
<p>现在，您可以在设备上看到通知，如以下预览所示:</p>
<p><img data-attachment-id="115992" data-permalink="https://blog.logrocket.com/create-send-push-notifications-react-native/test-notification-with-expo-on-an-android-device/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/11/Test-notification-with-Expo-on-an-Android-device.png" data-orig-size="320,165" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Test notification with Expo on an Android device" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/11/Test-notification-with-Expo-on-an-Android-device-300x155.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/11/Test-notification-with-Expo-on-an-Android-device.png" decoding="async" class="size-full wp-image-115992 aligncenter jetpack-lazy-image" src="../Images/7645344d3f95e2bfeefb2339f7d0b138.png" alt="Test notification with Expo on an Android device" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/11/Test-notification-with-Expo-on-an-Android-device.png 320w, https://blog.logrocket.com/wp-content/uploads/2020/11/Test-notification-with-Expo-on-an-Android-device-300x155.png 300w" data-lazy-sizes="(max-width: 320px) 100vw, 320px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/11/Test-notification-with-Expo-on-an-Android-device.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/11/Test-notification-with-Expo-on-an-Android-device.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="115992" data-permalink="https://blog.logrocket.com/create-send-push-notifications-react-native/test-notification-with-expo-on-an-android-device/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/11/Test-notification-with-Expo-on-an-Android-device.png" data-orig-size="320,165" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Test notification with Expo on an Android device" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/11/Test-notification-with-Expo-on-an-Android-device-300x155.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/11/Test-notification-with-Expo-on-an-Android-device.png" decoding="async" loading="lazy" class="size-full wp-image-115992 aligncenter" src="../Images/7645344d3f95e2bfeefb2339f7d0b138.png" alt="Test notification with Expo on an Android device" srcset="https://blog.logrocket.com/wp-content/uploads/2020/11/Test-notification-with-Expo-on-an-Android-device.png 320w, https://blog.logrocket.com/wp-content/uploads/2020/11/Test-notification-with-Expo-on-an-Android-device-300x155.png 300w" sizes="(max-width: 320px) 100vw, 320px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/11/Test-notification-with-Expo-on-an-Android-device.png"/></noscript>
<p>如果您需要在应用程序处于前台时显示通知，您可以将以下配置添加到<code>AppNavigator.js</code>源文件中:</p>
<pre class="language-js hljs">Notifications.setNotificationHandler({
  handleNotification: async () =&gt; ({
    shouldShowAlert: true
  }),
});

const AppNavigator = () =&gt; {
// ----
// ----
</pre>
<p>现在我们已经手动测试了Expo通知，让我们将推送通知令牌存储在服务器中，并以编程方式发送通知。</p>
<h2 id="storing-push-notification-token-project">在项目中存储推送通知令牌</h2>
<p>为了存储和使用来自服务器的推送通知，我们需要配置应用程序用户界面，使其能够注册新用户和设备。</p>
<p>为此，让我们转到项目中的<code>api</code>目录，打开一个名为<code>expoPushTokens.js</code>的新文件。然后执行以下操作:</p>
<pre class="language-js hljs">import client from './client';
const register = (pushToken) =&gt; client.post('/expoPushTokens', { token: pushToken });
export default {
    register,
}
</pre>
<p>在上面的代码中，我们首先导入客户机模块，它也在<code>api</code>目录中。<br/>我们定义一个采用<code>pushToken</code>的函数<code>register</code>。现在，我们将一个客户端或新用户发布到后端<code>/expoPushToken</code>的<code>url</code>。在请求的主体中，我们将添加一个设置为<code>pushToken</code>的对象<code>token</code>。然后，我们将使用<code>register</code>方法导出为默认对象。</p>
<p>接下来，我们返回到<code>AppNavigator</code>组件，我们将把令牌发送到服务器，而不是在控制台上记录令牌:</p>
<pre class="language-js hljs">const AppNavigator = () =&gt; {

    useEffect(() =&gt; {
        registerForPushNotificationsAsync()
            .then(token =&gt; expoPushTokensApi.register(token));
    }, []);
</pre>
<p>现在，我们正在发送新用户，以获得令牌和用户信息到我们的后端服务器。稍后，我们可以使用这些令牌向所有注册的设备发送通知。</p><div class="code-block code-block-54">
<hr/>
<h3>更多来自LogRocket的精彩文章:</h3>

<hr/></div>
<h2 id="sending-notifications-server">在服务器上发送通知</h2>
<p>要向服务器发送推送通知，我们需要使用Expo提供的SDK之一。如果您访问<a href="https://docs.expo.dev/push-notifications/sending-notifications/" target="_blank" rel="noopener">文档</a>，它为我们提供了如何在服务器上以多种语言实现推送通知的信息。</p>
<p>在本教程中，我将使用Node.js服务器。<a href="https://github.com/iamfortune/DoneWithIt-Backend" target="_blank" rel="noopener">这里的</a>是我在本教程中使用的服务器源代码的链接。我们将访问服务器中的<code>utilities</code>目录，并将<code>Expo</code> SDK包含在其中。为此，我们首先执行以下操作:</p>
<pre class="language-shell hljs">git clone https://github.com/iamfortune/DoneWithIt-Backend.git
</pre>
<p><code>cd</code>到新克隆的Git存储库中。接下来，我们使用以下命令安装<code>npm</code>包:</p>
<pre class="language-shell hljs">npm install 
</pre>
<p>接下来，将您计算机的本地网络IP地址添加到React Native app的<a href="https://github.com/codezri/Done-With-It-App/blob/8e7a384a00319d3bef82a7d2983522841dd25aa3/app/api/client.js#L4" target="_blank" rel="noopener"> <code>baseURL</code> </a>和backend project的<a href="https://github.com/iamfortune/DoneWithIt-Backend/blob/9b481c2530af12347d718966d91ac465ccbdd800/config/development.json#L2" target="_blank" rel="noopener"> <code>assetsBaseUrl</code> </a>中。</p>
<p>然后，我们开始我们的开发服务器:</p>
<pre class="language-shell hljs">npm start 
</pre>
<p>如果您将计算机和移动设备放在同一个网络上，您可以在React Native应用程序中看到一些预包含的列表。</p>
<p>现在，转到<code>pushNotifications.js</code>文件并将<code>Expo</code> SDK添加到包中:</p>
<pre class="language-shell hljs">npm i expo-server-sdk
const { Expo } = require("expo-server-sdk");
</pre>
<p>接下来，我们将编写一个函数来接收我们的推送通知——推送令牌和我们想要发送给用户的消息。然后，我们将创建一个新的chunk方法来处理推送通知:</p>
<pre class="language-js hljs">const sendPushNotification = async (targetExpoPushToken, message) =&gt; {
  const expo = new Expo();
  const chunks = expo.chunkPushNotifications([
    { to: targetExpoPushToken, sound: "default", body: message }
  ]);
</pre>
<p>现在，您可以在服务器代码的任何地方调用<code>sendPushNotification</code>函数，根据Expo推送通知令牌向任何设备发送通知，如下所示:</p>
<pre class="language-js hljs">const { Expo } = require('expo-server-sdk');
const sendPushNotification = require('../utilities/pushNotifications');
// ----
// ----
if (Expo.isExpoPushToken(expoPushToken)) {
  await sendPushNotification(expoPushToken, message);
}
// ----
</pre>
<p>您可以在<code><a href="https://github.com/iamfortune/DoneWithIt-Backend/blob/9b481c2530af12347d718966d91ac465ccbdd800/routes/messages.js#L57" target="_blank" rel="noopener">routes/messages.js</a></code>文件中查看<code>sendPushNotification</code>函数的用法示例。接下来，让我们确定如何处理我们在React本机应用程序中收到的通知。</p>
<h2 id="handling-received-notifications-react-native">在React Native中处理收到的通知</h2>
<p>为了处理收到的通知，首先我们需要一个事件侦听器，每次用户点击通知时都会调用它。</p>
<p>让我们在接收通知对象的<code>AppNavigator</code>函数中添加一个事件监听器:</p>
<pre class="language-js hljs">const AppNavigator = () =&gt; {

    const responseListener = useRef();

    useEffect(() =&gt; {
        registerForPushNotificationsAsync()
            .then(token =&gt; expoPushTokensApi.register(token));

        // Works when app is foregrounded, backgrounded, or killed
        responseListener.current = Notifications.addNotificationResponseReceivedListener(response =&gt; {
            console.log('--- notification tapped ---');
            console.log(response);
            console.log('------');
        });

        // Unsubscribe from events
        return () =&gt; {
            Notifications.removeNotificationSubscription(responseListener.current);
        };
    }, []);
// ----
// ----
</pre>
<p>一旦您通过Expo push notification tool发送测试通知并点击传入通知，您将在控制台上看到通知点击响应，如下所示。</p>
<p><img data-attachment-id="115997" data-permalink="https://blog.logrocket.com/create-send-push-notifications-react-native/a-notification-response-on-the-gnulinux-terminal/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-response-on-the-GNULinux-terminal.png" data-orig-size="671,139" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A notification response on the GNU:Linux terminal" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-response-on-the-GNULinux-terminal-300x62.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-response-on-the-GNULinux-terminal.png" decoding="async" class="size-full wp-image-115997 aligncenter jetpack-lazy-image" src="../Images/d03b5d52bc550043b20d048feaf9dce2.png" alt="A notification response on the GNU/Linux terminal" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-response-on-the-GNULinux-terminal.png 671w, https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-response-on-the-GNULinux-terminal-300x62.png 300w" data-lazy-sizes="(max-width: 671px) 100vw, 671px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-response-on-the-GNULinux-terminal.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-response-on-the-GNULinux-terminal.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="115997" data-permalink="https://blog.logrocket.com/create-send-push-notifications-react-native/a-notification-response-on-the-gnulinux-terminal/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-response-on-the-GNULinux-terminal.png" data-orig-size="671,139" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A notification response on the GNU:Linux terminal" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-response-on-the-GNULinux-terminal-300x62.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-response-on-the-GNULinux-terminal.png" decoding="async" loading="lazy" class="size-full wp-image-115997 aligncenter" src="../Images/d03b5d52bc550043b20d048feaf9dce2.png" alt="A notification response on the GNU/Linux terminal" srcset="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-response-on-the-GNULinux-terminal.png 671w, https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-response-on-the-GNULinux-terminal-300x62.png 300w" sizes="(max-width: 671px) 100vw, 671px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-response-on-the-GNULinux-terminal.png"/></noscript>
<p>Expo notifications包提供了一个监听器，如果应用程序是前景化的，它可以检测到来的通知事件。一旦您的前台应用程序通过Expo推送通知系统收到通知，以下代码片段将记录特定的通知对象:</p>
<pre class="language-js hljs">// ----
// ----

Notifications.setNotificationHandler({
  handleNotification: async () =&gt; ({
    shouldShowAlert: true
  }),
});

const AppNavigator = () =&gt; {

    const notificationListener = useRef();

    useEffect(() =&gt; {
        registerForPushNotificationsAsync()
            .then(token =&gt; expoPushTokensApi.register(token));

        notificationListener.current = Notifications.addNotificationReceivedListener(notification =&gt; {
            console.log('--- notification received ---');
            console.log(notification);
            console.log('------');
        });

        // Unsubscribe from events
        return () =&gt; {
            Notifications.removeNotificationSubscription(notificationListener.current);
        };
    }, []);
// ----
// ----
</pre>
<p>如果您的应用程序在前台，上面的代码会记录通知对象。看下面的预告。</p>
<p><img data-attachment-id="115999" data-permalink="https://blog.logrocket.com/create-send-push-notifications-react-native/a-notification-object-on-the-gnulinux-terminal/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-object-on-the-GNULinux-terminal.png" data-orig-size="685,149" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A notification object on the GNU:Linux terminal" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-object-on-the-GNULinux-terminal-300x65.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-object-on-the-GNULinux-terminal.png" decoding="async" class="size-full wp-image-115999 aligncenter jetpack-lazy-image" src="../Images/6c389c65e61d73533648dab48f83f321.png" alt="A notification object on the GNU/Linux terminal" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-object-on-the-GNULinux-terminal.png 685w, https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-object-on-the-GNULinux-terminal-300x65.png 300w" data-lazy-sizes="(max-width: 685px) 100vw, 685px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-object-on-the-GNULinux-terminal.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-object-on-the-GNULinux-terminal.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="115999" data-permalink="https://blog.logrocket.com/create-send-push-notifications-react-native/a-notification-object-on-the-gnulinux-terminal/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-object-on-the-GNULinux-terminal.png" data-orig-size="685,149" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A notification object on the GNU:Linux terminal" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-object-on-the-GNULinux-terminal-300x65.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-object-on-the-GNULinux-terminal.png" decoding="async" loading="lazy" class="size-full wp-image-115999 aligncenter" src="../Images/6c389c65e61d73533648dab48f83f321.png" alt="A notification object on the GNU/Linux terminal" srcset="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-object-on-the-GNULinux-terminal.png 685w, https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-object-on-the-GNULinux-terminal-300x65.png 300w" sizes="(max-width: 685px) 100vw, 685px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/11/A-notification-object-on-the-GNULinux-terminal.png"/></noscript>
<p>你可以从<a href="https://github.com/codezri/Done-With-It-App" target="_blank" rel="noopener">这个GitHub库</a>中浏览这个React原生应用的完整源代码。此外，您可以从<a href="https://github.com/iamfortune/DoneWithIt-Backend" target="_blank" rel="noopener">GitHub库</a>中浏览完整的服务器端代码。</p>
<p>请注意，在这里，我在没有设置FCM的情况下收到了Android设备的通知，因为我使用Expo应用程序进行开发。如果您需要在没有Expo应用程序的情况下测试您的应用程序，或者您希望将您的应用程序部署到Google Play或Apple App Store，请确保正确生成FCM和APNs凭据。官方<a href="https://docs.expo.dev/push-notifications/push-notifications-setup/#credentials" target="_blank" rel="noopener"> Expo文档</a>可以指导您为生产应用设置FCM和APN。</p>
<p>借助Expo应用，您无需FCM/APNs配置即可开发和测试您的应用。</p>
<h2>结论</h2>
<p>在本文中，我们已经了解了为什么推送通知很受欢迎，并且在应用程序世界中仍然如此，我们还了解了如何在React本机应用程序中发送推送通知，方法是添加通知令牌，从服务器发送通知，并使用Expo通知API在用户设备上显示通知。</p><div class="code-block code-block-18">
<div class="blog-plug inline-plug react-native-plug"><h2><a href="https://lp.logrocket.com/blg/react-native-signup"> LogRocket </a>:即时重现React原生应用中的问题。</h2><a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/110055665562c1e02069b3698e6cc671.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/110055665562c1e02069b3698e6cc671.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2021/10/react-native-plug_v2-2.png"/></noscript></a><p><a href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一款React原生监控解决方案，可帮助您即时重现问题、确定bug的优先级并了解React原生应用的性能。</p><p>LogRocket还可以向你展示用户是如何与你的应用程序互动的，从而帮助你提高转化率和产品使用率。LogRocket的产品分析功能揭示了用户不完成特定流程或不采用新功能的原因。</p><p>开始主动监控您的React原生应用— <a class="signup" href="https://lp.logrocket.com/blg/react-native-signup" target="_blank" rel="noopener noreferrer">免费试用LogRocket】。</a></p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>