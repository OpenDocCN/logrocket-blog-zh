<html>
<head>
<title>How to deploy a Node API on Google Cloud Run - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在Google Cloud Run - LogRocket博客上部署节点API</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/#0001-01-01">https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/#0001-01-01</a></blockquote><div><article class="article-post">
<p>随着时间的推移，将应用程序部署到生产环境变得越来越容易。随着无运营平台数量的增加，为中小型项目建立复杂且相对昂贵的云基础设施变得很容易。云运行就是其中的一个平台。Cloud Run构建于<a href="https://knative.dev/" target="_blank" rel="noopener noreferrer"> Knative </a>之上，是一个完全托管的无服务器平台，用于部署容器化的应用程序，并具有开箱即用的自动扩展配置。在本教程中，我们将介绍如何使用Docker打包一个节点API，并将其部署在配置了CI/CD的Cloud Run上。</p>
<h2>先决条件</h2>
<p>要完成本教程，您需要以下内容:</p>
<ol>
<li>Node.js的基础知识</li>
<li>拥有关于<a href="https://www.mongodb.com/" target="_blank" rel="noopener noreferrer"> MongoDB </a>的基础知识是很好的</li>
<li>Git的基础知识</li>
<li><a href="https://yarnpkg.com/lang/en/docs/install/" target="_blank" rel="noopener noreferrer">安装纱线</a>或<a href="https://www.npmjs.com/" target="_blank" rel="noopener noreferrer"> NPM </a>(我们将使用纱线)</li>
<li>安装了Git </li>
<li><a href="https://cloud.google.com/sdk/docs" target="_blank" rel="noopener noreferrer">谷歌云SDK </a>已安装</li>
<li><a href="https://www.postman.com/downloads/" target="_blank" rel="noopener noreferrer">邮递员</a>安装完毕</li>
<li>一个<a href="https://www.mongodb.com/" target="_blank" rel="noopener noreferrer"> MongoDB atlas </a>账户</li>
<li>一个<a href="https://support.google.com/accounts/answer/27441?hl=en" target="_blank" rel="noopener noreferrer">谷歌账户</a></li>
<li>配置为运行Node.js的开发计算机</li>
</ol>
<h2>装置</h2>
<p>在选择的任何终端中运行以下命令来初始化项目目录:</p>
<pre>$ git clone -b boilerplate https://github.com/enkaypeter/cloudrun-node-api-tutorial.git
$ cd cloudrun-node-api-tutorial &amp;&amp; yarn</pre>
<p>样板分支包含一个简单的API和一个docker文件，我们将使用它来构建API的docker映像。</p>
<h2>构建API映像</h2>
<p>云运行使得运行几乎任何语言构建的应用成为可能。这是通过应用程序打包/容器化实现的。在本教程中，我们将使用谷歌<a href="https://cloud.google.com/cloud-build/docs/cloud-builders" target="_blank" rel="noopener noreferrer">云构建器</a>来打包和封装我们的API。为此，我们将打开项目目录根目录中的<code>Dockerfile</code>,并添加以下代码:</p>
<pre># Pull in the official lightweight version of Node 12.
FROM node:12-slim

# Create and change to the app directory.
WORKDIR /app

COPY package.json .
COPY yarn.lock .

# Install production dependencies.
RUN yarn install --production

# Copy local codebase into the container image
COPY . .

# Compile down to ES5 with Babel
RUN yarn build-server

# Remove unused src directory
RUN rm -rf src/

# Start the api server
CMD [ "yarn", "start" ]</pre>
<p>在上面的代码片段中，我们引入了Node.js的轻量级版本(版本12 ),这将帮助我们运行我们的节点API。我们还复制了依赖清单(<code>package.json</code>和<code>yarn.lock</code>)，这将帮助我们安装API依赖项。当我们完成依赖项的安装后，我们将把我们的代码库从本地机器复制到容器映像中，用babel把我们的代码从ES6编译到ES5，通过删除未使用的文件做一些整理工作，并启动我们的API服务器。</p>
<p>现在我们已经在<code>Dockerfile</code>中定义了我们的映像规范，我们现在将通过运行以下命令来构建我们的容器映像:</p>
<pre>$ gcloud builds submit --tag gcr.io/PROJECT-ID/node-api-tut</pre>
<blockquote><p>其中<code>PROJECT_ID</code>是您的谷歌云项目id</p></blockquote>
<p>如果成功，您应该会看到如下图所示的成功消息:</p>
<p><img data-attachment-id="22844" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/successimage/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/successimage.png" data-orig-size="730,65" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="successimage" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/successimage-300x27.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/successimage.png" decoding="async" class="aligncenter size-full wp-image-22844 jetpack-lazy-image" src="../Images/58236cf3359b2b839d887fd2ce3492c2.png" alt="message reads node api tuts SUCCESS" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/successimage.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/successimage-300x27.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/successimage.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/successimage.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22844" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/successimage/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/successimage.png" data-orig-size="730,65" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="successimage" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/successimage-300x27.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/successimage.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22844" src="../Images/58236cf3359b2b839d887fd2ce3492c2.png" alt="message reads node api tuts SUCCESS" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/successimage.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/successimage-300x27.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/successimage.png"/></noscript>
<p>现在我们已经将API打包和容器化，我们将前往<a href="https://console.cloud.google.com/" target="_blank" rel="noopener noreferrer"> Google Cloud Console </a>来创建我们的云运行服务。</p>
<h2>将我们的容器映像部署到云运行</h2>
<p>为了部署我们的容器映像，我们将通过访问<a href="https://console.cloud.google.com/run" target="_blank" rel="noopener noreferrer">此链接</a>在云控制台上运行云。当页面完全加载时，您应该会看到类似下图的内容:</p>
<p><img data-attachment-id="22846" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/consolefullyloaded/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/consolefullyloaded.png" data-orig-size="730,224" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="consolefullyloaded" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/consolefullyloaded-300x92.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/consolefullyloaded.png" decoding="async" class="aligncenter size-full wp-image-22846 jetpack-lazy-image" src="../Images/09d282f44540754f8b45ff422c75d8a4.png" alt="Cloud run dashboard with an arrow pointing to 'create service' tab" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/consolefullyloaded.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/consolefullyloaded-300x92.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/consolefullyloaded.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/consolefullyloaded.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22846" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/consolefullyloaded/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/consolefullyloaded.png" data-orig-size="730,224" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="consolefullyloaded" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/consolefullyloaded-300x92.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/consolefullyloaded.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22846" src="../Images/09d282f44540754f8b45ff422c75d8a4.png" alt="Cloud run dashboard with an arrow pointing to 'create service' tab" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/consolefullyloaded.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/consolefullyloaded-300x92.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/consolefullyloaded.png"/></noscript>
<p>点击<code>CREATE SERVICE</code>按钮将弹出一个窗口，在这里我们将指定我们的服务名，它来自<a href="https://cloud.google.com/container-registry" target="_blank" rel="noopener noreferrer"> GCR </a>(谷歌容器注册)的容器图像，并使它对外界公开:</p>
<p><img data-attachment-id="22848" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/gcr/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/GCR.gif" data-orig-size="600,375" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="GCR" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/GCR-300x188.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/GCR.gif" decoding="async" class="aligncenter size-full wp-image-22848 jetpack-lazy-image" src="../Images/afc263fd58d7285bd8e0612a03d1f329.png" alt="Arrow moving to dropdown menu in dashboard for deployment options" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/GCR.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/GCR.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22848" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/gcr/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/GCR.gif" data-orig-size="600,375" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="GCR" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/GCR-300x188.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/GCR.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22848" src="../Images/afc263fd58d7285bd8e0612a03d1f329.png" alt="Arrow moving to dropdown menu in dashboard for deployment options" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/GCR.gif"/></noscript>
<p>当所有必需的参数都满足时，点击<code>CREATE</code>将提供一个可公开访问的URL，并且启用了现成的SSL，如上面的gif所示。在下一节中，我们将了解如何在云运行时自动部署对节点API所做的更改。</p>
<h2>使用云构建设置CI/CD</h2>
<p>每当我们想要部署对我们的API所做的更改时，重复上面列出的步骤将会是一种艰难的生活。Cloud Build使我们的生活变得更加轻松，因为它使得每次我们选择的分支在源代码控制中更新时，都可以为我们的项目存储库定义部署规则。为此，我们将做两件事:</p>
<ol>
<li>创建一个cloudbuild.yaml文件</li>
<li>配置连续部署(CD)构建触发器</li>
</ol>
<h3>创建一个cloudbuild.yaml文件</h3>
<p>为了创建cloudbuild.yaml文件，我们将运行下面的命令<code>$ touch cloudbuild.yaml</code>。完成后，我们应该有一个如下所示的项目目录:</p>
<pre>.
├── Dockerfile
├── README.md
├── cloudbuild.yaml
├── node_modules
├── package.json
├── src
│   ├── app.js
│   ├── config.js
│   ├── controllers
│   ├── helpers
│   ├── middleware
│   ├── models
│   └── routes
└── yarn.lock</pre>
<p>我们现在将通过添加以下代码来定义部署规则:</p>
<pre>steps:
    # build the container image
    - name: 'gcr.io/cloud-builders/docker'
      args: [ 'build', '-t', 'gcr.io/${_PROJECT_ID}/node-api-tut', '.' ]
    # push the container image to gcr
    - name: 'gcr.io/cloud-builders/docker'
      args: [ 'push', 'gcr.io/${_PROJECT_ID}/node-api-tut']
      # Deploy container image to Cloud Run
    - name: "gcr.io/cloud-builders/gcloud"
      args: ['run', 'deploy', 'node-api-tut', '--image', 'gcr.io/${_PROJECT_ID}/node-api-tut', '--region', 'europe-west4', '--platform', 'managed', '--allow-unauthenticated']</pre>
<blockquote><p>_PROJECT_ID是一个触发器变量，它将在我们创建构建触发器时定义</p></blockquote>
<p>上面的YAML片段展示了云构建如何构建、打包和部署我们的API。让我们回顾一下下面的步骤:</p>
<ul>
<li>步骤1:这里是我们的云构建器(Google Cloud Build)使用在项目目录的根目录中找到的Dockerfile来构建我们的API容器映像的地方，如最后一个参数(来自LHS)所指定的</li>
<li>步骤2:构建完成后，我们的容器映像被发送到GCR进行存储</li>
<li>步骤3:在这一步中，我们为云运行服务指定一些基本参数<ul>
<li>这是我们的云运行服务名称</li>
<li><code>--region europe-west4</code>:这指定了将托管我们服务的<a href="https://cloud.google.com/compute/docs/regions-zones" target="_blank" rel="noopener noreferrer">计算区域</a></li>
<li><code>--platform managed</code>:这告诉Cloud Build将我们的容器映像部署到一个完全托管的平台上(云运行)</li>
<li>这个标志公开了我们的云运行服务</li>
</ul>
</li>
</ul>
<p>在我们将<code>cloudbuild.yaml</code>文件提交到源代码控制之前，我们必须给予云构建服务帐户权限来触发云运行修订。这可以通过导航到<a href="https://console.cloud.google.com/cloud-build/settings/service-account" target="_blank" rel="noopener noreferrer">云构建设置控制台</a>并启用<code>Cloud Run Admin</code>角色来完成，如下图所示:</p>
<p><img data-attachment-id="22854" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/serviceaccountpermissions/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/serviceaccountpermissions.png" data-orig-size="730,311" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="serviceaccountpermissions" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/serviceaccountpermissions-300x128.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/serviceaccountpermissions.png" decoding="async" class="aligncenter size-full wp-image-22854 jetpack-lazy-image" src="../Images/00c7fde31218678c7aa3f61ef1d2ecf2.png" alt="Service account permissions page with list of permissions for google cloud run. Arrow pointing at Cloud Run Admin permissions" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/serviceaccountpermissions.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/serviceaccountpermissions-300x128.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/serviceaccountpermissions.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/serviceaccountpermissions.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22854" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/serviceaccountpermissions/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/serviceaccountpermissions.png" data-orig-size="730,311" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="serviceaccountpermissions" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/serviceaccountpermissions-300x128.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/serviceaccountpermissions.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22854" src="../Images/00c7fde31218678c7aa3f61ef1d2ecf2.png" alt="Service account permissions page with list of permissions for google cloud run. Arrow pointing at Cloud Run Admin permissions" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/serviceaccountpermissions.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/serviceaccountpermissions-300x128.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/serviceaccountpermissions.png"/></noscript>
<p>完成后，我们现在可以继续将<code>cloudbuild.yaml</code>文件提交给源代码控制。</p>
<h3>配置连续交付构建触发器</h3>
<p>每当源代码控制中的节点API发生变化时，构建触发器使云构建能够自动启动我们在<code>cloudbuild.yaml</code>文件中定义的构建过程。为了进行配置，我们将前往谷歌云控制台的<a href="https://console.cloud.google.com/cloud-build/triggers?_ga=2.218397840.82179932.1595308408-808517244.1593885543" target="_blank" rel="noopener noreferrer">触发器页面</a>，并连接我们的存储库:</p>
<p><img data-attachment-id="22857" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/cloudbuild/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/cloudbuild.png" data-orig-size="730,230" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="cloudbuild" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/cloudbuild-300x95.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/cloudbuild.png" decoding="async" class="aligncenter size-full wp-image-22857 jetpack-lazy-image" src="../Images/7618cf71dc462aefc514cfdc2258284d.png" alt="Cloud run dashboard with the 'triggers' tab selected " data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/cloudbuild.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/cloudbuild-300x95.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/cloudbuild.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/cloudbuild.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22857" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/cloudbuild/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/cloudbuild.png" data-orig-size="730,230" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="cloudbuild" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/cloudbuild-300x95.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/cloudbuild.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22857" src="../Images/7618cf71dc462aefc514cfdc2258284d.png" alt="Cloud run dashboard with the 'triggers' tab selected " srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/cloudbuild.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/cloudbuild-300x95.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/cloudbuild.png"/></noscript>
<p>当我们连接完节点API的项目存储库后，我们将在终端中运行以下代码:</p>
<pre>$ gcloud beta builds triggers create github \
--repo-name=[REPO_NAME] \
--repo-owner=[GITHUB_USERNAME] \
--branch-pattern="^master$" \
--substitutions=_PROJECT_ID=[PROJECT-ID] \
--build-config=cloudbuild.yaml \</pre>
<p>如果成功，您应该会看到类似这样的屏幕:<br/> <img data-attachment-id="22859" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/terminalnodeapi/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/terminalnodeapi.png" data-orig-size="730,230" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="terminalnodeapi" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/terminalnodeapi-300x95.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/terminalnodeapi.png" decoding="async" class="aligncenter size-full wp-image-22859 jetpack-lazy-image" src="../Images/784b5e4f9a33cef2006cf889f2706063.png" alt="Trippers page in dashboard with node api github repo " data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/terminalnodeapi.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/terminalnodeapi-300x95.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/terminalnodeapi.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/terminalnodeapi.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22859" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/terminalnodeapi/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/terminalnodeapi.png" data-orig-size="730,230" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="terminalnodeapi" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/terminalnodeapi-300x95.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/terminalnodeapi.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22859" src="../Images/784b5e4f9a33cef2006cf889f2706063.png" alt="Trippers page in dashboard with node api github repo " srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/terminalnodeapi.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/terminalnodeapi-300x95.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/terminalnodeapi.png"/></noscript>
<p>现在我们已经设置好了一切，是时候测试我们的构建触发器了。我们可以这样更新<code>src/controllers/base-controller.js</code>中的<code>index</code>方法:</p>
<pre>// src/controllers/base-controller.js
...

  index: (req, res) =&gt; {
    return res.status(200).json({
      success: true,
      message: "Hey there :)",
    })
  }

...</pre>
<p>在更新了<code>index</code>方法之后，我们将把变更提交给我们的源存储库。如果一切顺利，您导航到<code>{HOST_URL}\api</code>，您应该会看到类似这样的屏幕:</p>
<p><img data-attachment-id="22861" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/hosturlapi/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/hosturlapi.gif" data-orig-size="600,129" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="hosturlapi" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/hosturlapi-300x65.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/hosturlapi.gif" decoding="async" class="aligncenter size-full wp-image-22861 jetpack-lazy-image" src="../Images/ce6d9f175086653c2c3584b2890f9e90.png" alt="dashboard showing build, source, and ref of the api" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/hosturlapi.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/hosturlapi.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22861" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/hosturlapi/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/hosturlapi.gif" data-orig-size="600,129" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="hosturlapi" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/hosturlapi-300x65.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/hosturlapi.gif" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22861" src="../Images/ce6d9f175086653c2c3584b2890f9e90.png" alt="dashboard showing build, source, and ref of the api" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/hosturlapi.gif"/></noscript>
<blockquote><p>其中{主机URL}是云运行调配的URL</p></blockquote>
<p>在下一节中，我们将看看如何使用环境变量部署我们的API。</p>
<h2>处理环境<code>.env</code>变量</h2>
<p>除了托管基础设施，环境变量是我们本地开发环境与生产环境的区别。在这一节中，我们将看看我们可以用环境变量部署API的两种主要方式。</p>
<p>第一种方法是存储我们的。Google存储桶(GCS)中的env变量。这可以通过创建一个名为<code>secrets-locker</code>的存储桶并使用<code>gsutil</code>(一个从命令行访问云存储的实用工具)将我们的env变量复制到桶中来实现，如下所示:</p>
<pre>$ gsutil mb gs://secrets-locker/
$ gsutil cp .prod.env gs://secrets-locker/</pre>
<blockquote><p>这个包(gsutil)是随Google Cloud SDK一起安装的。然而，如果你不能运行后续命令，请访问<a href="https://cloud.google.com/storage/docs/gsutil" target="_blank" rel="noopener noreferrer">官方文档</a>来单独安装<code>gsutil</code>。</p></blockquote>
<p>其中<code>.prod.env</code>是包含您的生产环境变量的文件，在我们的例子中，它是MongoDB的数据库连接变量:</p>
<pre>//.prod.env
DB_CON_STRING=[MONGO_DB_CONNECTIONSTRING]</pre>
<blockquote><p><code>[MONGO_DB_CONNECTIONSTRING]</code>是您的mongodb连接字符串。</p></blockquote>
<p>为了将这个环境文件添加到我们的云运行API中，我们将向我们的<code>cloudbuild.yaml</code>文件添加一个额外的构建步骤，如下所示:</p>
<pre>steps:
    # Download .env file
    - name: "gcr.io/cloud-builders/gsutil"
      args: ["cp", "gs://secrets-locker/.prod.env", ".env"]
    # build the container image
    - name: 'gcr.io/cloud-builders/docker'
      args: [ 'build', '-t', 'gcr.io/${_PROJECT_ID}/node-api-tut', '.' ]
    # push the container image to gcr
    - name: 'gcr.io/cloud-builders/docker'
      args: [ 'push', 'gcr.io/${_PROJECT_ID}/node-api-tut']
      # Deploy container image to Cloud Run
    - name: "gcr.io/cloud-builders/gcloud"
      args: ['run', 'deploy', 'node-api-tut', '--image', 'gcr.io/${_PROJECT_ID}/node-api-tut', '--region', 'europe-west4', '--platform', 'managed', '--allow-unauthenticated']</pre>
<p>上面的代码片段仍然与我们为云运行服务配置连续部署时创建的<code>cloudbuild.yaml</code>文件相同。这里唯一的区别是我们将生产环境变量(<code>.prod.env</code>)复制到容器映像<code>.env</code>文件中。</p>
<p>在将云构建文件提交到源代码控制之前，我们将取消对<code>src/app.js</code>中的<code>mongoose.connect()</code>方法的注释，如下所示:</p>
<pre>// src/app.js

...
// Connect to mongodb
mongoose.connect(
    process.env.DB_CON_STRING,
    {
        useNewUrlParser: true,
        useUnifiedTopology: true
    },
    (err) =&gt; {
        if (err) {
            console.log(err);
        } else {
            console.log('Successfully Connected to the database');
        }
    }
);

...</pre>
<p>完成后，我们现在可以将我们的更改提交到源代码控制中。</p>
<blockquote><p><span>记得把</span> <code>.prod.env</code> <span>添加到你的</span> <code>.gitignore</code> <span>文件中，或者有意识地努力让它不被git跟踪。</span></p></blockquote>
<p>为了在CR中测试我们的环境变量，我们将使用Postman向我们的节点API端点发出一个<code>POST</code>请求:</p>
<p><img data-attachment-id="22868" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/postman/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/postman.png" data-orig-size="730,374" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="postman" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/postman-300x154.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/postman.png" decoding="async" class="aligncenter size-full wp-image-22868 jetpack-lazy-image" src="../Images/0f280d1cbb7a75ca82fa771be3fc5c67.png" alt="postman showing node api" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/postman.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/postman-300x154.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/postman.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/postman.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22868" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/postman/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/postman.png" data-orig-size="730,374" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="postman" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/postman-300x154.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/postman.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22868" src="../Images/0f280d1cbb7a75ca82fa771be3fc5c67.png" alt="postman showing node api" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/postman.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/postman-300x154.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/postman.png"/></noscript>
<p>使用云运行部署环境变量的第二种方式是在<a href="https://console.cloud.google.com/run/" target="_blank" rel="noopener noreferrer">云运行控制台</a>上手动定义，如下图所示:</p>
<p><img data-attachment-id="22870" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/gcrnodeapi/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/gcrnodeapi.png" data-orig-size="730,387" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="gcrnodeapi" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/gcrnodeapi-300x159.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/gcrnodeapi.png" decoding="async" class="aligncenter size-full wp-image-22870 jetpack-lazy-image" src="../Images/43fc663b6a8a90edd28d179c5a6b19bf.png" alt="gcr node-api-tut" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/gcrnodeapi.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/gcrnodeapi-300x159.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/gcrnodeapi.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/gcrnodeapi.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22870" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/gcrnodeapi/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/gcrnodeapi.png" data-orig-size="730,387" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="gcrnodeapi" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/gcrnodeapi-300x159.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/gcrnodeapi.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22870" src="../Images/43fc663b6a8a90edd28d179c5a6b19bf.png" alt="gcr node-api-tut" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/gcrnodeapi.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/gcrnodeapi-300x159.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/gcrnodeapi.png"/></noscript>
<p>单击<code>DEPLOY</code>按钮从我们的节点API容器映像部署一个新的云运行版本。如果成功，您应该会看到如下所示的屏幕:</p>
<p><img data-attachment-id="22871" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/deployingcloudrun/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/deployingcloudrun.png" data-orig-size="730,278" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="deployingcloudrun" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/deployingcloudrun-300x114.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/deployingcloudrun.png" decoding="async" class="aligncenter size-full wp-image-22871 jetpack-lazy-image" src="../Images/66d3fb63aea3a5ad894444584a9ce221.png" alt="google cloud run dash board with words Deploying and Creative revision and routing traffic" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/deployingcloudrun.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/deployingcloudrun-300x114.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/08/deployingcloudrun.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/deployingcloudrun.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="22871" data-permalink="https://blog.logrocket.com/how-to-deploy-a-node-api-on-google-cloud-run/deployingcloudrun/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/08/deployingcloudrun.png" data-orig-size="730,278" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="deployingcloudrun" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/08/deployingcloudrun-300x114.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/08/deployingcloudrun.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-22871" src="../Images/66d3fb63aea3a5ad894444584a9ce221.png" alt="google cloud run dash board with words Deploying and Creative revision and routing traffic" srcset="https://blog.logrocket.com/wp-content/uploads/2020/08/deployingcloudrun.png 730w, https://blog.logrocket.com/wp-content/uploads/2020/08/deployingcloudrun-300x114.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/08/deployingcloudrun.png"/></noscript>
<h2>结论</h2>
<p>在本教程中，我们学习了如何在有和没有环境变量的情况下在Google Cloud Run上部署节点API。我们还学习了如何为我们的云运行服务配置连续交付。要了解更多关于云运行以及如何利用其技术来处理工作负载的信息，请查看官方文档。</p>
<p>本教程的源代码也可以在GitHub上找到。你可以随意复制它，叉它，或者提交一个问题。</p><div class="code-block code-block-23">
<div class="blog-plug inline-plug node-plug"><h2>200只<img src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> <noscript> <img data-lazy-fallback="1" src="../Images/61167b9d027ca73ed5aaf59a9ec31267.png" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/10/green-check.png"/> </noscript>显示器出现故障，生产中网络请求缓慢</h2><p>部署基于节点的web应用程序或网站是容易的部分。确保您的节点实例继续为您的应用程序提供资源是事情变得更加困难的地方。如果您对确保对后端或第三方服务的请求成功感兴趣，</p><a href="https://lp.logrocket.com/blg/node-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer"><img src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/><noscript><img data-lazy-fallback="1" src="../Images/cae72fd2a54c5f02a6398c4867894844.png" alt="LogRocket Network Request Monitoring" data-original-src="https://blog.logrocket.com/wp-content/uploads/2019/12/network-request-filter-2-1.png"/></noscript></a><a href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用程序的DVR，记录下用户与你的应用程序交互时发生的一切。您可以汇总并报告有问题的网络请求，以快速了解根本原因，而不是猜测问题发生的原因。</p><p>LogRocket检测您的应用程序以记录基线性能计时，如页面加载时间、到达第一个字节的时间、慢速网络请求，还记录Redux、NgRx和Vuex操作/状态。</p><a class="signup" href="https://lp.logrocket.com/blg/node-signup" target="_blank" rel="noopener noreferrer">Start monitoring for free</a><p>. </p></div>
</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>