<html>
<head>
<title>Testing Vue components with Vue Testing Library - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用Vue测试库测试Vue组件</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/testing-vue-components-with-vue-testing-library/#0001-01-01">https://blog.logrocket.com/testing-vue-components-with-vue-testing-library/#0001-01-01</a></blockquote><div><article class="article-post">
<p>测试在任何应用程序的开发中都是至关重要的。在测试阶段偷工减料会导致错误的信心，最终导致一个有缺陷的应用。</p>
<p>在本教程中，我们将演示如何使用<a href="https://www.npmjs.com/package/@testing-library/vue"> Vue测试库</a>测试Vue组件。虽然我们可以使用无数的其他测试库，但我支持以用户使用的方式测试你的应用程序，这正是Vue测试库的目标。</p>
<p>Vue测试库<a href="https://testing-library.com/docs/intro" target="_blank" rel="noopener noreferrer">测试库</a>家族的成员，包括React测试库、DOM测试库等等。它建立在Vue的官方测试库Vue Test Utils和DOM Testing Library之上，这使得它能够使用测试库家族的特性。</p>
<h2 id="prerequisites"><strong>先决条件</strong></h2>
<p>要学习本教程，您应该具备:</p>
<ul>
<li><a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer">节点</a> &gt; 8.0.0和npm &gt; 6安装在您的机器上</li>
<li><span class="attrlink url author-d-iz88z86z86za0dz67zz78zz78zz74zz68zjz80zz71z9iz90z9pqupz89zz73zz78zm4oz67zz79zjz89zz79zj15q2nz70z0z65zrcez83zhb"> <a class="attrlink" href="https://cli.vuejs.org/guide/installation.html" target="_blank" rel="noreferrer nofollow noopener" data-target-href="https://cli.vuejs.org/guide/installation.html"> Vue CLI </a> &gt; 4 </span> <span class=" author-d-iz88z86z86za0dz67zz78zz78zz74zz68zjz80zz71z9iz90z9pqupz89zz73zz78zm4oz67zz79zjz89zz79zj15q2nz70z0z65zrcez83zhb">安装在您的机器上</span></li>
<li>对Vue的基本了解</li>
<li>对使用<a href="https://jestjs.io/" target="_blank" rel="noopener noreferrer"> Jest </a>进行测试的基本理解</li>
</ul>
<h2 id="settingup">设置</h2>
<p>因为我们将创建和测试单文件组件，所以您需要使用Vue CLI创建一个新的Vue项目。</p>
<p>运行下面的命令来设置一个新的Vue项目。</p>
<pre>vue create testing-vue-components.
</pre>
<p>我们可以坚持默认的Vue配置，因为我们将自己安装任何额外的依赖项。</p>
<p>Vue测试库可以用于很多测试框架，但是在本教程中我们将使用Jest。</p>
<p>安装jest和Vue测试库。</p>
<pre>npm i --save-dev jest @testing-library/vue
</pre>
<p>由于我们将编写ES6，我们需要使用Babel来为我们处理编译。Vue已经附带了一个Babel配置，所以我们只需要安装<code>babel-jest</code>并配置Jest来使用Babel转换<code>.js</code>文件。</p>
<pre>npm i --save-dev babel-jest
</pre>
<p>同样，因为我们正在编写单文件组件，所以我们需要配置Jest来加载<code>.vue</code>文件。<code>vue-jest</code>包有助于这一点。</p>
<pre>npm install --save-dev <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f98f8c9cd4939c8a8db9cdd7c9d7c9d49b9c8d98d7ca">[email protected]</a>
</pre>
<p>最后，更新<code>package.json</code>以包含必要的配置。</p>
<pre>"jest": {
    "moduleFileExtensions": [
      "js",
      "json",
      "vue"
    ],
    "transform": {
      "^.+\\.js$": "babel-jest",
      ".*\\.(vue)$": "vue-jest"
    }
  },
</pre>
<h2 id="testingsimplecomponents">测试简单组件</h2>
<p>当用户加载页面时，他们应该能够看到组件，所以首先要测试的应该是组件的呈现。</p>
<p>考虑这个简单的<code>Counter</code>组件，它提供了两个用于计数的按钮并显示计数的数量:</p>
<pre>// Counter.vue
&lt;template&gt;
  &lt;div&gt;
    &lt;h3&gt;Count: {{ counter }}&lt;/h3&gt;
    &lt;div class="button-container"&gt;
      &lt;button @click="increment"&gt;Add&lt;/button&gt;
      &lt;button @click="decrement"&gt;Subtract&lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  name: 'Counter',
  data() {
    return {
      counter: 0,
    };
  },
  methods: {
    increment() {
      this.counter++;
    },
    decrement() {
      this.counter--;
    },
  },
};
&lt;/script&gt;
</pre>
<p>为了测试组件，在<code>tests</code>目录中创建一个<code>Counter.js</code>文件。</p>
<pre>import Counter from '../Counter.vue';
import { render } from '@testing-library/vue';
test('It renders correctly', () =&gt; {
  const { getByText } = render(Counter);
  getByText('Count: 0');
});
</pre>
<p><code>getByText</code>助手检查文档中是否有带有指定参数的文本。在我们的计数器组件中，<code>counter</code>的初始状态被设置为<code>0</code>，因此无需点击任何按钮，我们就应该将<code>Count: 0</code>呈现到文档中。</p>
<p>用户可能执行的其他操作包括单击两个按钮，所以我们也需要测试这些操作。</p>
<pre>import Counter from '../Counter.vue';
import { render, fireEvent } from '@testing-library/vue';

test('It correctly responds to button clicks', async () =&gt; {
  const { getByText } = render(Counter);
  // Check initial state
  getByText('Count: 0');

  // Get buttons.
  const addButton = getByText('Add');
  const subtractButton = getByText('Subtract');

  // Click the Add button.
  await fireEvent.click(addButton);
  // Counter should be updated.
  getByText('Count: 1');

  // Click the subtract button.
  await fireEvent.click(subtractButton);
  // Counter should be updated.
  getByText('Count: 0');
  // Further clicks
  await fireEvent.click(addButton);
  await fireEvent.click(addButton);
  await fireEvent.click(addButton);
  await fireEvent.click(addButton);
  getByText('Count: 4');
  await fireEvent.click(subtractButton);
  await fireEvent.click(subtractButton);
  getByText('Count: 2');
});
</pre>
<p>使用<code>getByText</code>，我们可以像普通用户一样获得按钮并点击它们。</p>
<p>顾名思义，<code>fireEvent</code>用于调度元素上的不同事件。我们在这里等待事件，因为Vue异步更新DOM，因此从<code>fireEvent</code>调度的所有事件返回一个承诺，该承诺将在下一个tick得到解决。</p>
<h2 id="testingformelements">测试表单元素</h2>
<p>考虑下面的组件。它存储使用V-model建立双向数据绑定的内容，并在屏幕上显示用户在输入字段中输入的内容。</p>
<pre>// Repeater.vue
&lt;template&gt;
  &lt;section&gt;
    &lt;label for="item"&gt;Start Typing&lt;/label&gt;
    &lt;input type="text" v-model="item" id="item" /&gt;
    &lt;div&gt;You typed: {{ item }}&lt;/div&gt;
  &lt;/section&gt;
&lt;/template&gt;
&lt;script&gt;
export default {
  data() {
    return {
      item: '',
    };
  },
};
&lt;/script&gt;
&lt;style&gt;&lt;/style&gt;
</pre>
<p>要像用户使用它一样测试这个组件，我们需要像用户一样思考。用户来到页面，看到“开始输入”标签，并在输入字段中输入内容。用户希望输出显示在输出div中。我们的测试应该相应地断言这些。</p>
<pre>import Repeater from '../Repeater.vue';
import { render, fireEvent } from '@testing-library/vue';

test('User can type and see output on the screen', async () =&gt; {
  const { getByLabelText, getByText, debug } = render(Repeater);
  // Get input associated with label.
  const input = getByLabelText('Start Typing');
  // Update the input field.
  await fireEvent.update(input, 'Sample text');
  // Assert that the update is successful.
  getByText('You typed: Sample text');

  // View the current state of the dom.
  debug();
});
</pre>
<p>使用<code>getByLabelText</code>方法，我们可以获得与特定标签相关联的输入字段。</p><div class="code-block code-block-54">
<hr/>
<h3>更多来自LogRocket的精彩文章:</h3>

<hr/></div>
<p>为了确保V-model正常工作，输入到输入字段中的内容应该显示在输出区域中。因此，我们应该用<code>Sample text</code>更新输入字段，并断言我们可以在DOM上找到它。</p>
<p>一些复杂的表单有验证，这是计算属性。让我们来看看如何用Vue测试库来测试它们。</p>
<pre>// Form.vue

&lt;template&gt;
  &lt;form action=""&gt;
    &lt;label for="name"&gt;Name&lt;/label&gt;
    &lt;input type="text" name="name" id="name" v-model="name" /&gt;
    &lt;label for="email"&gt;Email&lt;/label&gt;
    &lt;input type="email" name="email" id="email" v-model="email" /&gt;
    &lt;button type="submit" :disabled="!hasValidFields"&gt;Submit&lt;/button&gt;
  &lt;/form&gt;
&lt;/template&gt;
&lt;script&gt;
export default {
  name: 'AppForm',
  data() {
    return {
      name: '',
      email: '',
    };
  },
  computed: {
    hasValidFields() {
      return Boolean(this.email &amp;&amp; this.name);
    },
  },
};
&lt;/script&gt;
&lt;style&gt;&lt;/style&gt;
</pre>
<p>这个简单的表单组件通过确保提交按钮不能被点击来验证用户输入，除非两个字段都包含有效值。</p>
<p>像往常一样，为了测试这个组件，我们将像用户一样与它进行交互。</p>
<pre>import Form from '../Form.vue';
import { render, fireEvent } from '@testing-library/vue';
test('User interaction with form', async () =&gt; {
  const { getByLabelText, getByText } = render(Form);
  const nameField = getByLabelText('Name');
  const emailField = getByLabelText('Email');
  const submitBtn = getByText('Submit');
  expect(submitBtn.disabled).toBe(true);
  // Update the name field.
  await fireEvent.update(nameField, 'James John');
  expect(submitBtn.disabled).toBe(true);
  // Add email.
  await fireEvent.update(emailField, '<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5c363d31392f1c39243d312c3039723f3331">[email protected]</a>');
  expect(submitBtn.disabled).toBe(false);
});
</pre>
<p>正如我们的测试所示，提交按钮应该被禁用，直到所有必填字段都已提供。</p>
<h2 id="testingcomplexcomponentsslotsprops">测试复杂组件</h2>
<p>您肯定会遇到依赖外部数据的更复杂的组件，要么通过props，要么通过AJAX请求获取数据。</p>
<p>道具和其他项目(如插槽)可以通过render方法的第二个参数传递给正在呈现的组件。</p>
<p>考虑将在整个应用程序中使用的输入组件:</p>
<pre>// AppInput.vue
&lt;template&gt;
  &lt;div&gt;
    &lt;slot name="label"&gt;&lt;/slot&gt;
    &lt;input type="text" :name="name" :id="inputId" /&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
export default {
  props: {
    name: {
      required: true,
      type: String,
    },
    inputId: {
      required: true,
      type: String,
    },
  },
};
&lt;/script&gt;
</pre>
<p>相应的测试是:</p>
<pre>import AppInput from '../AppInput.vue';
import { render } from '@testing-library/vue';
test('It renders label', () =&gt; {
  const { getByLabelText } = render(AppInput, {
    props: {
      name: 'username',
      inputId: 'username',
    },
    slots: {
      label: `&lt;label for="username"&gt;Enter Username&lt;/label&gt;`,
    },
  });
  // Get input field by label text.
  getByLabelText('Enter Username');
});
</pre>
<h2 id="debuggingtests">调试测试</h2>
<p>偶尔，测试会失败，重要的是要清楚地了解哪里出错了，以避免将来出现类似的错误。这才是Vue测试库真正出彩的地方。</p>
<pre>test('It renders label', () =&gt; {
  const { getByLabelText} = render(AppInput, {
    props: {
      name: 'username',
      inputId: 'username',
    },
    slots: {
      // Note wrong attribute value.
      label: `&lt;label for="user"&gt;Enter Username&lt;/label&gt;`,
    },
  });
  getByLabelText('Enter Username');
});
</pre>
<p>上述测试失败，因为<code>getByLabelText</code>找不到标签的相关输入字段。下面是错误消息的样子:</p>
<p><img data-attachment-id="21727" data-permalink="https://blog.logrocket.com/testing-vue-components-with-vue-testing-library/error-message-getbylabeltext-vue-testing-library/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/error-message-getByLabelText-vue-testing-library.png" data-orig-size="720,660" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Vue Testing Library — error message" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/error-message-getByLabelText-vue-testing-library-300x275.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/error-message-getByLabelText-vue-testing-library.png" decoding="async" class="aligncenter size-full wp-image-21727 jetpack-lazy-image" src="../Images/446967a15ce2b77f10efe5ae33e6d43b.png" alt="Vue Testing Library — Error Message" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/error-message-getByLabelText-vue-testing-library.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/error-message-getByLabelText-vue-testing-library-300x275.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/error-message-getByLabelText-vue-testing-library.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/error-message-getByLabelText-vue-testing-library.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="21727" data-permalink="https://blog.logrocket.com/testing-vue-components-with-vue-testing-library/error-message-getbylabeltext-vue-testing-library/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/error-message-getByLabelText-vue-testing-library.png" data-orig-size="720,660" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Vue Testing Library — error message" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/error-message-getByLabelText-vue-testing-library-300x275.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/error-message-getByLabelText-vue-testing-library.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-21727" src="../Images/446967a15ce2b77f10efe5ae33e6d43b.png" alt="Vue Testing Library — Error Message" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/error-message-getByLabelText-vue-testing-library.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/error-message-getByLabelText-vue-testing-library-300x275.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/error-message-getByLabelText-vue-testing-library.png"/></noscript>
<p>我们还可以查看DOM在不同时间点的状态。让我们调试一下<code>AppInput</code>组件，看看DOM呈现了什么。</p>
<pre>import AppInput from '../AppInput.vue';
import { render } from '@testing-library/vue';
test('It renders label', () =&gt; {
  const { getByLabelText, debug } = render(AppInput, {
    props: {
      name: 'username',
      inputId: 'username',
    },
    slots: {
      label: `&lt;label for="username"&gt;Enter Username&lt;/label&gt;`,
    },
  });
  getByLabelText('Enter Username');

  // Logs a representation of the dom at this state.
  debug();
});
</pre>
<p>运行该测试将产生以下结果。</p>
<p><img data-attachment-id="21726" data-permalink="https://blog.logrocket.com/testing-vue-components-with-vue-testing-library/vue-testing-library-passing-result/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/vue-testing-library-passing-result.png" data-orig-size="720,544" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Vue Testing Library — passing result" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/vue-testing-library-passing-result-300x227.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/vue-testing-library-passing-result.png" decoding="async" class="aligncenter size-full wp-image-21726 jetpack-lazy-image" src="../Images/ee98f1ff39a2224d2a2920b34ce6ef39.png" alt="Vue Testing Library — Passing Result" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/vue-testing-library-passing-result.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/vue-testing-library-passing-result-300x227.png 300w" data-lazy-sizes="(max-width: 720px) 100vw, 720px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/07/vue-testing-library-passing-result.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/vue-testing-library-passing-result.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="21726" data-permalink="https://blog.logrocket.com/testing-vue-components-with-vue-testing-library/vue-testing-library-passing-result/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/07/vue-testing-library-passing-result.png" data-orig-size="720,544" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Vue Testing Library — passing result" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/07/vue-testing-library-passing-result-300x227.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/07/vue-testing-library-passing-result.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-21726" src="../Images/ee98f1ff39a2224d2a2920b34ce6ef39.png" alt="Vue Testing Library — Passing Result" srcset="https://blog.logrocket.com/wp-content/uploads/2020/07/vue-testing-library-passing-result.png 720w, https://blog.logrocket.com/wp-content/uploads/2020/07/vue-testing-library-passing-result-300x227.png 300w" sizes="(max-width: 720px) 100vw, 720px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/07/vue-testing-library-passing-result.png"/></noscript>
<h2 id="conclusion">结论</h2>
<p>在本教程中，我们演示了如何使用Vue测试库测试不同的组件。我希望我们讨论过的概念能启发你培养更好的测试习惯。最重要的是，我希望本教程能够揭示在用户如何与组件交互的背景下测试组件的好处。</p><div class="code-block code-block-20">
<div class="blog-plug inline-plug vue-inline"><h2>像用户一样体验您的Vue应用</h2><p>调试Vue.js应用程序可能会很困难，尤其是当用户会话期间有几十个(如果不是几百个)突变时。如果您对监视和跟踪生产中所有用户的Vue突变感兴趣，</p><a href="https://lp.logrocket.com/blg/vue-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/0d269845910c723dd7df26adab9289cb.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/0d269845910c723dd7df26adab9289cb.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png"/></noscript></a><a href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用程序的DVR，记录你的Vue应用程序中发生的一切，包括网络请求、JavaScript错误、性能问题等等。您可以汇总并报告问题发生时应用程序的状态，而不是猜测问题发生的原因。</p><p>LogRocket Vuex插件将Vuex突变记录到LogRocket控制台，为您提供导致错误的环境，以及出现问题时应用程序的状态。</p><p>现代化您调试Vue应用的方式- <a class="signup" href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div>


</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>