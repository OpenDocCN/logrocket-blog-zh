<html>
<head>
<title>Pagination in GraphQL with Prisma the right way - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用Prisma以正确的方式在GraphQL中分页</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/pagination-in-graphql-with-prisma-the-right-way/#0001-01-01">https://blog.logrocket.com/pagination-in-graphql-with-prisma-the-right-way/#0001-01-01</a></blockquote><div><article class="article-post">
<p>当处理有数百万条记录的数据库时，采用分页非常有用，因为它可以帮助我们检索数据的子集，否则如果不查询表上的每条记录，我们就无法访问这些数据。</p>
<p>从我们的数据库中检索这些信息会非常昂贵，并且会对性能产生巨大影响。在客户端进行渲染的成本也很高。</p>
<p>在撰写本文时，Prisma在一个表上检索的默认记录数量是1，000条记录——也就是说，如果没有请求记录的子集。</p>
<p>当查询记录列表时，我们可以通过提供分页参数来获取该列表的某些部分(即页面)。</p>
<p>对于Prisma中的分页，我们可以使用5个主要参数:<code>first</code>、<code>last</code>、<code>after</code>、<code>before</code>和<code>skip</code>。</p>
<p>在这篇文章中，我们将探讨各种方法来组合这些参数，以有效地对数据进行分页。</p>
<p>我们还将使用这个<a href="https://graphiql.graphcms.com/simple/v1/swapi" target="_blank" rel="noopener noreferrer">公共API </a>进行示例演示。</p>
<h3>将first或last与skip一起使用</h3>
<p>假设一个应用程序使用如下所示的按钮实现分页，页面大小为10项。</p>
<p>为了实现这一点，我们需要重写我们的<code>typedef</code>定义来接受参数，并在查询的解析器函数中实现它。</p>
<p>我们不会这样做，因为我们正在使用一个已经构建好的公共API。查看文档可以发现，查询已经被定义为接受这些参数。</p>
<p>好吧，让我们湿一下脚。</p>
<ul>
<li>如果我们访问公共API，我们会看到doc部分。</li>
<li>单击文档部分，我们将看到查询、变异和订阅。</li>
<li>然后，我们将单击查询类型，查看所有可用的查询。</li>
</ul>
<p>出于本文的目的，我们将使用<code>allStarships</code>查询。</p>
<pre>     {
        allStarships(first: 10) {
          id
          name
          length
          manufacturer
        }
      }</pre>
<p>当我们运行这段代码时，总共返回了10条记录。但是，这对于分页来说并不完整，因为每次都会返回相同的10条记录。</p>
<p>为了确保它正常工作，我们需要引入另一个名为<code>skip</code>的参数。</p>
<p>方法如下:</p>
<pre>{
    allStarships(first: 10, skip: 10) {
      id
      name
      length
      manufacturer
    }
  }</pre>
<p>这给了我们第二页，或接下来的10个记录。这可以通过发送按钮的页码乘以我们的页面大小来动态完成。</p>
<p>我们可以像这样得到第一、第二和第三页:</p>
<pre>//first page
 // number to skip pageNumber = 1
number = 10 * (1 - 1); // 0
...
allStarships(first: 10, skip: 0) 
//second page 
//number = 10 * (2 - 1); // 10
allStarships(first: 10, skip: 10) 
// third page 
//number = 10 * (2 - 1); // 10
allStarships(first: 10, skip: 20)

<img data-attachment-id="12495" data-permalink="https://blog.logrocket.com/pagination-in-graphql-with-prisma-the-right-way/pagination-example-nocdn/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/01/pagination-example-nocdn.png" data-orig-size="221,69" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="pagination-example-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/01/pagination-example-nocdn.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/01/pagination-example-nocdn.png" decoding="async" class="aligncenter size-full wp-image-12495 jetpack-lazy-image" src="../Images/3f4245c6c7dba4134bd975713609a69a.png" alt="Pagination" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/01/pagination-example-nocdn.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/01/pagination-example-nocdn.png"/><noscript><img data-lazy-fallback="1" data-attachment-id="12495" data-permalink="https://blog.logrocket.com/pagination-in-graphql-with-prisma-the-right-way/pagination-example-nocdn/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/01/pagination-example-nocdn.png" data-orig-size="221,69" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="pagination-example-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/01/pagination-example-nocdn.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/01/pagination-example-nocdn.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-12495" src="../Images/3f4245c6c7dba4134bd975713609a69a.png" alt="Pagination" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/01/pagination-example-nocdn.png"/></noscript></pre>
<p>我们也可以使用最后一个参数，但是我们将从最后输入的记录查询表(如果mongoDB是选择的数据库，则为集合),而不是从表的顶部查询上面的记录。</p>
<h3>与skip一起使用before或after</h3>
<p>假设我们实现了页面导航，当您到达页面底部时，您可以使用最后一个<code>id</code>来获取更多的记录。</p>
<p> </p>
<p><img data-attachment-id="12497" data-permalink="https://blog.logrocket.com/pagination-in-graphql-with-prisma-the-right-way/load-more-posts-nocdn-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/01/load-more-posts-nocdn-1.png" data-orig-size="485,186" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="load-more-posts-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/01/load-more-posts-nocdn-1-300x115.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/01/load-more-posts-nocdn-1.png" decoding="async" class="aligncenter size-full wp-image-12497 jetpack-lazy-image" src="../Images/442647abcb7a0bfefd5b6e471b0c2047.png" alt="load more posts" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/01/load-more-posts-nocdn-1.png 485w, https://blog.logrocket.com/wp-content/uploads/2020/01/load-more-posts-nocdn-1-300x115.png 300w" data-lazy-sizes="(max-width: 485px) 100vw, 485px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/01/load-more-posts-nocdn-1.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/01/load-more-posts-nocdn-1.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="12497" data-permalink="https://blog.logrocket.com/pagination-in-graphql-with-prisma-the-right-way/load-more-posts-nocdn-2/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/01/load-more-posts-nocdn-1.png" data-orig-size="485,186" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="load-more-posts-nocdn" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/01/load-more-posts-nocdn-1-300x115.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/01/load-more-posts-nocdn-1.png" decoding="async" loading="lazy" class="aligncenter size-full wp-image-12497" src="../Images/442647abcb7a0bfefd5b6e471b0c2047.png" alt="load more posts" srcset="https://blog.logrocket.com/wp-content/uploads/2020/01/load-more-posts-nocdn-1.png 485w, https://blog.logrocket.com/wp-content/uploads/2020/01/load-more-posts-nocdn-1-300x115.png 300w" sizes="(max-width: 485px) 100vw, 485px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/01/load-more-posts-nocdn-1.png"/></noscript>
<p>在我们的示例中，我们可以决定再获取10条记录。</p>
<p>下面是它在代码中的样子:</p>
<pre>{
    allStarships(first: 10, skip: 10) {
      id
      name
      length
      manufacturer
    }
  }</pre>
<p>这使我们在指定的<code>id</code>之后获得10条记录。我们也可以使用<code>last</code>和<code>before</code>来获取指定id之前的记录。</p>
<p><strong>注意:</strong>我们不能将<code>first</code>与<code>before</code>结合使用，也不能将<code>last</code>与<code>after</code>结合使用。</p>
<p>如果我们在查询中这样做，那么<code>first</code>或<code>last</code>将被应用(在列表的末尾或开头，这取决于使用的是哪个),而<code>before</code>或<code>after</code>参数将被忽略。</p>
<h3>结论</h3>
<p>从数据库中查询记录时应用分页很重要，因为它有助于优化服务器的性能。这也有助于抑制客户端级别的昂贵渲染。</p><div class="code-block code-block-24">
<div class="blog-plug inline-plug graphql-plug"><h2>监控生产中失败和缓慢的GraphQL请求</h2><p>虽然GraphQL有一些调试请求和响应的特性，但确保GraphQL可靠地为您的生产应用程序提供资源是一件比较困难的事情。如果您对确保对后端或第三方服务的网络请求成功感兴趣，</p><a href="https://lp.logrocket.com/blg/graphql-signup" target="_blank">try LogRocket</a><p>.</p><a class="signup" href="https://lp.logrocket.com/blg/graphql-signup" target="_blank" rel="noopener noreferrer"><img src="../Images/432a3823c85b3fb72a206e6236a29f48.png" data-lazy-src="https://files.readme.io/69aa835-Image_2019-11-09_at_1.28.05_PM.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class=" jetpack-lazy-image" data-original-src="https://files.readme.io/69aa835-Image_2019-11-09_at_1.28.05_PM.png"/><noscript><img data-lazy-fallback="1" src="../Images/432a3823c85b3fb72a206e6236a29f48.png" data-original-src="https://files.readme.io/69aa835-Image_2019-11-09_at_1.28.05_PM.png"/></noscript><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a><a href="https://lp.logrocket.com/blg/graphql-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用的DVR，记录下你网站上发生的每一件事。您可以汇总并报告有问题的GraphQL请求，以快速了解根本原因，而不是猜测问题发生的原因。此外，您可以跟踪Apollo客户机状态并检查GraphQL查询的键值对。</p><p>LogRocket检测您的应用程序以记录基线性能计时，如页面加载时间、到达第一个字节的时间、慢速网络请求，还记录Redux、NgRx和Vuex操作/状态。</p><a class="signup" href="https://lp.logrocket.com/blg/graphql-signup" target="_blank" rel="noopener noreferrer">Start monitoring for free</a><p>.</p></div>


</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

 </div>    
</body>
</html>