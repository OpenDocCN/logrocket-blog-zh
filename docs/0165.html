<html>
<head>
<title>Managing multiple store modules with Vuex - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用Vuex - LogRocket博客管理多个商店模块</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/managing-multiple-store-modules-vuex/#0001-01-01">https://blog.logrocket.com/managing-multiple-store-modules-vuex/#0001-01-01</a></blockquote><div><article class="article-post">
<p><em> <strong>编者按:</strong>本文于2022年5月10日更新，以更准确地反映Vuex的功能，并修复一个误导性的标题。</em></p>
<h2>介绍</h2>
<p>当在Vue中构建复杂的web应用程序时，您可能会遇到这样的情况:您需要在组件的深层嵌套层次结构中共享数据，并且您希望使用<a href="https://blog.logrocket.com/consume-apis-with-vuex-pinia-axios/" target="_blank" rel="noopener"> Vuex </a>来管理状态。在这种情况下，使用“<a href="https://en.wikipedia.org/wiki/Separation_of_concerns" target="_blank" rel="noopener">关注点分离</a>”概念是有意义的，方法是将您的Vuex商店分成模块，从而抽象出将所有逻辑放在一个商店中的复杂性。</p>
<p>Vuex模块本质上是小型、独立的Vuex商店，它们组合成一个更大的中央Vuex商店。这使得管理它们变得更加容易，这也是Vuex开发人员应该具备的技能。</p>
<p>在本文中，我们将学习如何使用Vuex管理多个商店模块。</p>
<h3>很高兴见到你</h3>

<h2 id="why-vuex">为什么是Vuex？</h2>
<p>在一个只有几个组件的简单Vue应用程序中，可以使用<a href="https://vuejs.org/guide/components/props.html" target="_blank" rel="noopener">道具</a>和<a href="https://vuejs.org/guide/components/events.html#emitting-and-listening-to-events" target="_blank" rel="noopener">组件事件</a>来实现数据共享。然而，当您的组件开始逐步增长时，建议引入一个状态管理包，作为一个独立的服务来管理应用程序中跨组件的数据，以避免“钻取”</p>
<p>当数据通过层次结构中每一层的每个组件传递直到到达目的地时，就会发生适当的钻探。这本身就是一个问题，因为你最终会写出更多重复和难以阅读的代码。</p>
<p>那么，在嵌套组件之间共享数据的最佳方式是什么呢？</p>
<p><img data-attachment-id="108032" data-permalink="https://blog.logrocket.com/managing-multiple-store-modules-vuex/a-system-with-nested-components/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/09/A-system-with-nested-components.jpeg" data-orig-size="691,441" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A system with nested components" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/09/A-system-with-nested-components-300x191.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/09/A-system-with-nested-components.jpeg" decoding="async" class="size-full wp-image-108032 aligncenter jetpack-lazy-image" src="../Images/d08045809941fe93916040c5f6dfe0c0.png" alt="A system with nested components" data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2018/09/A-system-with-nested-components.jpeg 691w, https://blog.logrocket.com/wp-content/uploads/2018/09/A-system-with-nested-components-300x191.jpeg 300w" data-lazy-sizes="(max-width: 691px) 100vw, 691px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2018/09/A-system-with-nested-components.jpeg?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/09/A-system-with-nested-components.jpeg"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="108032" data-permalink="https://blog.logrocket.com/managing-multiple-store-modules-vuex/a-system-with-nested-components/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2018/09/A-system-with-nested-components.jpeg" data-orig-size="691,441" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="A system with nested components" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2018/09/A-system-with-nested-components-300x191.jpeg" data-large-file="https://blog.logrocket.com/wp-content/uploads/2018/09/A-system-with-nested-components.jpeg" decoding="async" loading="lazy" class="size-full wp-image-108032 aligncenter" src="../Images/d08045809941fe93916040c5f6dfe0c0.png" alt="A system with nested components" srcset="https://blog.logrocket.com/wp-content/uploads/2018/09/A-system-with-nested-components.jpeg 691w, https://blog.logrocket.com/wp-content/uploads/2018/09/A-system-with-nested-components-300x191.jpeg 300w" sizes="(max-width: 691px) 100vw, 691px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2018/09/A-system-with-nested-components.jpeg"/></noscript>
<p>这就是Vuex的用武之地。Vuex充当应用程序中所有组件的中央存储。无论应用程序中有多少嵌套组件，任何组件都可以访问该存储。</p>
<p>问题是，默认情况下，Vuex存储由一个大对象组成，其中包含我们应用程序的所有<code>state</code>、<code>mutations</code>、<code>actions</code>和<code>getters</code>。这可能会导致我们的应用程序变得臃肿，因为它增加了大小和复杂性。</p>
<p>为了使Vuex商店更容易扩展，可以将其分成多个模块。每个模块可以有自己的<code>state</code>、<code>mutations</code>、<code>getters</code>和<code>actions</code>。我们甚至可以嵌套模块。</p>
<h2 id="getting-started">入门指南</h2>
<p>使用以下任一选项，可以轻松地将Vuex添加到项目中:</p>
<p>首先，通过CDN(内容交付网络)</p>
<p>对于这种方法，您可以简单地将脚本插入到您的<code>.html</code>文件的head标签之间:</p>
<pre class="language-html hljs">&lt;script src="https://unpkg.com/<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f28487978ab2c6dcc2dcc0">[email protected]</a>/dist/vuex.global.js"&gt;&lt;/script&gt;
</pre>
<p>记得在Vue脚本之后添加Vuex脚本，如下所示:</p>
<pre class="language-html hljs">&lt;script src="/path/to/vue.js"&gt;&lt;/script&gt;
&lt;script src="/path/to/vuex.js"&gt;&lt;/script&gt;
</pre>
<p>其次是npm或纱线。如果您正在构建一个复杂的应用程序，强烈推荐使用这种方法:</p>
<pre class="language-shell hljs">npm install <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="aadcdfcfd2eac4cfd2de">[email protected]</a> --save
#OR Yarn
yarn add <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="453330203d052b203d31">[email protected]</a> --save
</pre>
<p>要使用npm或yarn设置Vuex，在<code>src</code>文件夹的根目录下创建一个<code>store</code>文件夹，并在其中创建一个名为<code>index.js</code>的文件。</p>
<p>在我们访问Vuex的属性之前，Vue需要知道外部资源，然后才能使用它。在位于<code>src</code>文件夹内的<code>main.js</code>文件中添加以下代码:</p>
<pre class="language-js hljs">import { createApp } from 'vue'
import App from './App.vue'
import store from "./store";

createApp(App)
.use(store)
.mount('#app')
</pre>
<p>接下来，在商店<code>folder</code>中创建一个<code>modules</code>文件夹，并添加文件<code>jokes.js</code>和<code>crypto.js</code>。对于本教程，我们的商店将由这两个模块组成。</p>
<p><code>jokes.js</code>模块将从<a href="https://api.chucknorris.io/" target="_blank" rel="noopener"> Chuck Norris笑话API </a>获取笑话，而<code>crypto.js</code>模块将从<a href="https://docs.coincap.io/" target="_blank" rel="noopener"> Coincap API </a>获取加密货币数据。</p>
<p>为了让我们的模块工作，我们需要在中央存储中配置它们，这是我们的<code>index.js</code>文件。像这样导入模块:</p>
<pre class="language-js hljs">//store/index.js

import { createStore } from 'vuex'
import jokes from './modules/jokes'
import crypto from './modules/crypto'

export default createStore({
    modules: {
        jokes,
        crypto
    },
})
</pre>
<h2 id="creating-vuex-modules">创建Vuex模块</h2>
<p>在这一节中，我们将更新我们的空模块文件，以包含从各种API获取数据的代码。</p>
<p>创建一个模块与普通的中央Vuex商店没有什么不同。语法基本相同，只是我们没有在模块中创建新的store实例。相反，我们将包含其所有属性的对象导出到中央存储实例中:</p>
<pre class="language-js hljs">// modules/crypto.js

export default {
    namespaced: true,
    state: {
        data: {},
    },
    getters: {
        data: state =&gt; state.data,
    },
    actions: {
        async getData({commit }) {
            const data = await fetch('https://api.coincap.io/v2/assets');
            commit('SET_DATA', await data.json());
        },
    },
    mutations: {
        SET_DATA(state, data) {
            state.data = data;
        },
    }
}


// modules/jokes.js

export default {
    namespaced: true,
    state: {
        data: {},
    },
    getters: {
        data: state =&gt; state.data,
    },
    actions: {
        async getData({commit }) {
            const data = await fetch('http://api.icndb.com/jokes/random/15');
            commit('SET_DATA', await data.json());
        },
    },
    mutations: {
        SET_DATA(state, data) {
            state.data = data;
        },
    }
}
</pre>
<p>上面，我们给模块对象添加了属性<code>namespaced:true</code>,这样我们的模块就可以是自包含的和可重用的。给模块命名也有助于防止命名问题，因为您可以为您的状态、变异和动作重用相同的名称，而不会导致任何错误。</p>
<h2 id="accessing-vuex-modules-from-template">从模板访问Vuex模块</h2>
<p>在这一节中，我们将讨论如何访问模板文件中的存储模块。</p>
<p>我们将使用<code>App.vue</code>文件来获取和显示从我们的每个存储模块获得的数据，如下所示:</p>
<pre class="language-js hljs">// App.vue

&lt;template&gt;
  &lt;div id="app"&gt;
    &lt;img alt="Vue logo" src="./assets/logo.png" /&gt;
    &lt;div&gt;
      &lt;button @click="jokeData"&gt;Get Jokes&lt;/button&gt;
      &lt;button @click="cryptoData"&gt;Get Crypto Data&lt;/button&gt;
    &lt;/div&gt;
    &lt;div class="display"&gt;
      &lt;pre&gt;{{ jokes.data }}&lt;/pre&gt;
      &lt;pre&gt;{{ crypto.data }}&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
import { mapState } from "vuex";
export default {
  name: "App",
  computed: {
    ...mapState(["jokes", "crypto"]),
  },
  methods: {
    jokeData() {
      this.$store.dispatch("jokes/getData");
    },
    cryptoData() {
      this.$store.dispatch("crypto/getData");
    },
  },
};
&lt;/script&gt;
</pre>
<p>在上面的代码中，有两种方法用于从我们的每个存储模块中获取数据。因为我们已经将<code>namespaced</code>属性设置为<code>true</code>，为了从存储中访问数据，我们必须在动作名称前面加上一个正斜杠作为模块名称的前缀，以便成功地调度它。</p>
<p>然后，为了从存储模块中获取状态，我们使用Vuex <code>mapstate</code>助手，然后在模板上显示每个模块的状态中存储的数据。</p>
<h2>结论</h2>
<p>Vuex让您可以根据自己的项目结构灵活地管理多个商店模块。我们也可以选择对动作、突变和getters使用相同的名称，只要您将<code>namespaced</code>属性设置为true。</p>
<p>你可以在这里了解更多关于Vuex模块<a href="https://vuex.vuejs.org/guide/modules.html" target="_blank" rel="noopener">的信息。</a></p><div class="code-block code-block-20">
<div class="blog-plug inline-plug vue-inline"><h2>像用户一样体验您的Vue应用</h2><p>调试Vue.js应用程序可能会很困难，尤其是当用户会话期间有几十个(如果不是几百个)突变时。如果您对监视和跟踪生产中所有用户的Vue突变感兴趣，</p><a href="https://lp.logrocket.com/blg/vue-signup" target="_blank">try LogRocket</a><p>. </p><a class="signup" href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/0d269845910c723dd7df26adab9289cb.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/0d269845910c723dd7df26adab9289cb.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://files.readme.io/00591d0-687474703a2f2f692e696d6775722e636f6d2f6a3049327856572e706e67.png"/></noscript></a><a href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer">https://logrocket.com/signup/</a><p>LogRocket 就像是网络和移动应用程序的DVR，记录你的Vue应用程序中发生的一切，包括网络请求、JavaScript错误、性能问题等等。您可以汇总并报告问题发生时应用程序的状态，而不是猜测问题发生的原因。</p><p>LogRocket Vuex插件将Vuex突变记录到LogRocket控制台，为您提供导致错误的环境，以及出现问题时应用程序的状态。</p><p>现代化您调试Vue应用的方式- <a class="signup" href="https://lp.logrocket.com/blg/vue-signup" target="_blank" rel="noopener noreferrer">开始免费监控</a>。</p></div>


</div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>