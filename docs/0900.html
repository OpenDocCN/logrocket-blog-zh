<html>
<head>
<title>Building a full-stack React application with Blitz.js - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用Blitz.js - LogRocket博客构建全栈React应用</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/building-a-fullstack-react-application-with-blitz-js/#0001-01-01">https://blog.logrocket.com/building-a-fullstack-react-application-with-blitz-js/#0001-01-01</a></blockquote><div><article class="article-post">
<h2>Blitz.js是什么？</h2>
<p>Blitzjs是一个类似Rails的框架，用于构建fullstack React应用程序。基本上，它帮助你以一种简单有效的方式开发一个整体应用程序。Blitz.js构建在Next.js之上。</p>
<h3>为什么我们需要Blitz.js</h3>
<p>有时你可能需要在短时间内构建一个产品或<a href="https://blog.logrocket.com/product-management/what-is-minimum-viable-product-mvp-how-to-define/" target="_blank" rel="noopener">最小可行产品(MVP) </a>。你可能最终会写一个重复的CRUD API，一遍又一遍地设置后端和前端。</p>
<p>嗯，Blitz.js会帮你避开那些痛点。它可以帮助你尽快建造一个整体或者MVP。我感觉Blitz.js在那种情况下赢了。</p>
<p>是时候看看它的实际效果了。</p>
<p>注:如果你想了解blitzjs的概念或简介，请查看这篇文章。</p>
<h3>Blitz安装和设置</h3>
<pre>$ npm install -g blitz</pre>
<pre>$ blitz new recipe-app</pre>
<p>上面的命令安装Blitz并用scaffold代码引导应用程序。我们的应用程序目录将如下所示:</p>
<pre>mysite
├── app
│   ├── components
│   │   └── ErrorBoundary.tsx
│   ├── layouts
│   └── pages
│       ├── _app.tsx
│       ├── _document.tsx
│       └── index.tsx
├── db
│   ├── migrations
│   ├── index.ts
│   └── schema.prisma
├── integrations
├── jobs
├── node_modules
├── public
│   ├── favicon.ico
│   └── logo.png
├── utils
├── .babelrc.js
├── .env
├── .eslintrc.js
├── .gitignore
├── .npmrc
├── .prettierignore
├── README.md
├── blitz.config.js
├── package.json
├── tsconfig.json
└── yarn.lock</pre>
<p>要了解更多关于基础教程的内容，请查看官方文档。</p>
<p>好了，脚手架代码够了。在本教程中，我们将构建什么？好吧，让我给你演示一下。</p>
<h3>演示</h3>
<p><img data-attachment-id="19549" data-permalink="https://blog.logrocket.com/building-a-fullstack-react-application-with-blitz-js/attachment/blitzjs-code/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/blitzjs-code.gif" data-orig-size="730,456" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="blitzjs-code" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/blitzjs-code-300x187.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/blitzjs-code.gif" decoding="async" class="aligncenter wp-image-19549 size-full jetpack-lazy-image" src="../Images/353ef482860d77528785b73f95c1e409.png" alt="A gif of a simple recipe app built with Blitz.js." data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/blitzjs-code.gif?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/blitzjs-code.gif"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="19549" data-permalink="https://blog.logrocket.com/building-a-fullstack-react-application-with-blitz-js/attachment/blitzjs-code/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/blitzjs-code.gif" data-orig-size="730,456" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="blitzjs-code" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/blitzjs-code-300x187.gif" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/blitzjs-code.gif" decoding="async" loading="lazy" class="aligncenter wp-image-19549 size-full" src="../Images/353ef482860d77528785b73f95c1e409.png" alt="A gif of a simple recipe app built with Blitz.js." data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/blitzjs-code.gif"/></noscript>
<p>在这里，我们将构建一个简单的食谱应用程序，解释Blitz.js中的大多数概念。</p>
<p>在上面的例子中，我们有一个食谱列表和一个向列表添加食谱的表单。都是菜谱模式的问题。</p>
<p>让我们在生成代码之前为我们的应用程序建立一个数据库。我们将使用Postgres作为这个应用程序的数据库。Blitz.js明确使用Prisma来管理我们应用程序的数据库。</p>
<h3>为什么是Prisma？</h3>
<p>Prisma帮助您从业务模型中生成数据库表。它还可以从模型中提供GraphQL模式。因此，很容易从域模型创建数据库表或GraphQL。</p>
<h3>数据库设置</h3>
<p><img data-attachment-id="19550" data-permalink="https://blog.logrocket.com/building-a-fullstack-react-application-with-blitz-js/attachment/schema-prisma/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/schema-prisma.png" data-orig-size="668,244" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="schema-prisma" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/schema-prisma-300x110.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/schema-prisma.png" decoding="async" class="aligncenter wp-image-19550 jetpack-lazy-image" src="../Images/4da3b2cea343b4951ac86f3257dd74b5.png" alt="A screenshot of the schema.prisma." data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/schema-prisma.png 668w, https://blog.logrocket.com/wp-content/uploads/2020/05/schema-prisma-300x110.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/schema-prisma.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/schema-prisma.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="19550" data-permalink="https://blog.logrocket.com/building-a-fullstack-react-application-with-blitz-js/attachment/schema-prisma/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/schema-prisma.png" data-orig-size="668,244" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="schema-prisma" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/schema-prisma-300x110.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/schema-prisma.png" decoding="async" loading="lazy" class="aligncenter wp-image-19550" src="../Images/4da3b2cea343b4951ac86f3257dd74b5.png" alt="A screenshot of the schema.prisma." srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/schema-prisma.png 668w, https://blog.logrocket.com/wp-content/uploads/2020/05/schema-prisma-300x110.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/schema-prisma.png"/></noscript>
<p>在<code>schema.prisma</code>中添加以下代码:</p>
<pre>datasource postgresql {
  provider = "postgres"
  url      = "postgresql://postgres:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="87eafef4e2e4f5e2f3f7e6f4f4f0e8f5e3c7ebe8e4e6ebefe8f4f3">[email protected]</a>:5432/docapp"
}
generator client {
  provider = "prisma-client-js"
}
model Recipe {
  id          Int      @default(autoincrement()) @id
  name        String
  imageUrl    String
  description String
  likes       Int
  addedAt     DateTime @default(now())
}</pre>
<p>Datasource定义了我们正在使用的数据库。这里，我们使用Postgres作为我们的数据源。</p>
<p>之后，我们将基于业务领域模型定义一个模型。这类似于我们设计数据库的方式。大多数时候，我们需要在创建数据库和表之前定义应用程序的模型。</p>
<p>这里，我们有一个包含数据库中所有字段的配方模型。一旦我们定义了模式，我们需要将它迁移到我们的Postgres数据库中。</p>
<p>Blitz使用以下命令帮助我们做到这一点:</p>
<pre>blitz db migrate</pre>
<p><img data-attachment-id="19551" data-permalink="https://blog.logrocket.com/building-a-fullstack-react-application-with-blitz-js/attachment/prisma-migrate/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/Prisma-migrate.png" data-orig-size="1528,676" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Prisma-migrate" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/Prisma-migrate-300x133.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/Prisma-migrate-1024x453.png" decoding="async" class="aligncenter wp-image-19551 jetpack-lazy-image" src="../Images/f3dd03d6bc7a1628aaadd26ccd1055e7.png" alt="A screenshot of Prisma migrate." data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/Prisma-migrate.png 1528w, https://blog.logrocket.com/wp-content/uploads/2020/05/Prisma-migrate-300x133.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/05/Prisma-migrate-1024x453.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/05/Prisma-migrate-768x340.png 768w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/Prisma-migrate.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/Prisma-migrate.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="19551" data-permalink="https://blog.logrocket.com/building-a-fullstack-react-application-with-blitz-js/attachment/prisma-migrate/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/Prisma-migrate.png" data-orig-size="1528,676" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Prisma-migrate" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/Prisma-migrate-300x133.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/Prisma-migrate-1024x453.png" decoding="async" loading="lazy" class="aligncenter wp-image-19551" src="../Images/f3dd03d6bc7a1628aaadd26ccd1055e7.png" alt="A screenshot of Prisma migrate." srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/Prisma-migrate.png 1528w, https://blog.logrocket.com/wp-content/uploads/2020/05/Prisma-migrate-300x133.png 300w, https://blog.logrocket.com/wp-content/uploads/2020/05/Prisma-migrate-1024x453.png 1024w, https://blog.logrocket.com/wp-content/uploads/2020/05/Prisma-migrate-768x340.png 768w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/Prisma-migrate.png"/></noscript>
<p>现在，我们需要为食谱创建所有的查询和变化。我们不需要手动为食谱创建查询和变化。Blitz会为我们生成脚手架代码。</p>
<pre>blitz generate all recipe</pre>
<p>它将为我们的recipes域创建目录和文件。</p>
<p><img data-attachment-id="19552" data-permalink="https://blog.logrocket.com/building-a-fullstack-react-application-with-blitz-js/attachment/recipes/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/recipes.png" data-orig-size="478,538" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="recipes" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/recipes-267x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/recipes.png" decoding="async" class="aligncenter wp-image-19552 jetpack-lazy-image" src="../Images/eaee67cee8bf9a025170e7f47af0f74b.png" alt="The recipes file and domain." data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/recipes.png 478w, https://blog.logrocket.com/wp-content/uploads/2020/05/recipes-267x300.png 267w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/recipes.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/recipes.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="19552" data-permalink="https://blog.logrocket.com/building-a-fullstack-react-application-with-blitz-js/attachment/recipes/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/recipes.png" data-orig-size="478,538" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="recipes" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/recipes-267x300.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/recipes.png" decoding="async" loading="lazy" class="aligncenter wp-image-19552" src="../Images/eaee67cee8bf9a025170e7f47af0f74b.png" alt="The recipes file and domain." srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/recipes.png 478w, https://blog.logrocket.com/wp-content/uploads/2020/05/recipes-267x300.png 267w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/recipes.png"/></noscript>
<ul>
<li><strong>pages/recipes/index . tsx</strong>–包含配方列表的业务逻辑</li>
<li><strong>pages/recipes/new . tsx</strong>–包含添加新配方的功能</li>
<li><strong>页数/配方/[id]。tsx</strong>–包含与我们在路线中传递的id相关的特定配方细节</li>
<li><strong>pages/recipe/[id]/edit . tsx</strong>–包含根据id更新特定配方的逻辑</li>
</ul>
<h3>配方列表组件</h3>
<p>在<code>page/recipe/index.tsx</code>中添加以下代码:</p>
<pre>import { Suspense, Fragment, useState, useEffect } from "react"
import { Head, Link, useQuery } from "blitz"
import { Flex, Button, Box, Spinner } from "@chakra-ui/core"
import getRecipes from "app/recipes/queries/recipes/getRecipes"
import updateRecipe from "app/recipes/mutations/recipes/updateRecipe"
import RecipeItem from "app/components/RecipeItem"

const [recipesState, setRecipeState] = useState([])
  const [recipes] = useQuery(getRecipes)
  useEffect(() =&gt; {
    if (recipes.length &gt; 0) {
      setRecipeState(recipes)
    }
  }, [recipes])

export const RecipesList = () =&gt; {
  return (
    &lt;Fragment&gt;
      {recipesState.map((recipe) =&gt; (
        &lt;RecipeItem
          id={recipe.id}
          title={recipe.name}
          imageUrl={recipe.imageUrl}
          description={recipe.description}
          likes={recipe.likes}
          onLike={async (id, likes) =&gt; {
            //on recipe like logic comes here
          }}
        /&gt;
      ))}
    &lt;/Fragment&gt;
  )
}
const RecipesPage = () =&gt; {
  return (
    &lt;Flex flexDirection="column" bg="background" w="100vw" h="100vh"&gt;
      &lt;Box marginLeft="auto" marginRight="30px"&gt;
        &lt;p&gt;
          &lt;Link href="/recipes/new"&gt;
            &lt;Button variantColor="blue" variant="outline" cursor="pointer"&gt;
              Create Recipe
            &lt;/Button&gt;
          &lt;/Link&gt;
        &lt;/p&gt;
      &lt;/Box&gt;
      &lt;Flex p={8} flexWrap="wrap"&gt;
        &lt;Suspense fallback={&lt;Spinner size="xl" margin="auto" /&gt;}&gt;
          &lt;RecipesList /&gt;
        &lt;/Suspense&gt;
      &lt;/Flex&gt;
    &lt;/Flex&gt;
  )
}
export default RecipesPage</pre>
<p>这里，我们使用<code>useQuery</code> React钩子从数据库获取数据，并使用<code>useState</code>设置数据状态:</p>
<pre>import { Head, Link, useQuery } from "blitz"
import getRecipes from "app/recipes/queries/recipes/getRecipes"

const [recipes] = useQuery(getRecipes)</pre>
<p>基本上，我们从Prisma客户端获取数据，Prisma客户端与Postgres数据库连接并向我们提供数据。</p>
<p>如果您看到<code>pages/recipes/queries/recipes/getRecipes.ts</code>中的代码，您可以看到获取数据的查询:</p>
<pre>import db, { FindManyRecipeArgs } from "db"
export default async function getRecipes(args: FindManyRecipeArgs) {
  const recipes = await db.recipe.findMany(args)
  return recipes
}</pre>
<p>一旦我们获得了数据，我们就在应用程序中呈现它，就像在React应用程序中一样。在list组件中，我们有一个按钮，它路由到create recipe组件:</p>
<pre>&lt;Link href="/recipes/new"&gt;
  &lt;Button variantColor="blue" variant="outline" cursor="pointer"&gt;
      Create Recipe
  &lt;/Button&gt;
&lt;/Link&gt;</pre>
<h3>创建配方</h3>
<p>在<code>pages/recipes/new.tsx</code>中添加以下代码:</p>
<pre>import { Head, Link, useRouter } from "blitz"
import { useState } from "react"
import createRecipe from "app/recipes/mutations/recipes/createRecipe"
import {
  FormControl,
  FormLabel,
  FormErrorMessage,
  Button,
  Input,
  Box,
  Stack,
  Image,
  Text,
  Spinner,
  Flex,
} from "@chakra-ui/core"
import { Field, Formik, Form } from "formik"
const NewRecipePage = () =&gt; {
  const router = useRouter()
  const [state, setState] = useState({
    name: "",
    description: "",
    imageUrl: "",
    uploadingState: "NONE",
  })
  const validationName = (value) =&gt; {
    let error
    // if (!value) {
    //   error = "Name is required"
    // }
    return error
  }
  const validateDescription = (value) =&gt; {
    let error
    // if (!value) {
    //   error = "Description is required"
    // }
    return error
  }
  const uploadFile = async (e) =&gt; {
    console.log("Uploading....")
    setState({ ...state, uploadingState: "UPLOADING" })
    const files = e.target.files
    const data = new FormData()
    data.append("file", files[0])
    data.append("upload_preset", "qy3oxqkx")
    const res = await fetch("https://api.cloudinary.com/v1_1/ganeshimaginary/image/upload", {
      method: "POST",
      body: data,
    })
    const file = await res.json()
    setState({ ...state, imageUrl: file.secure_url, uploadingState: "UPLOADED" })
  }
  const onChange = (e) =&gt; {
    setState({ ...state, [e.target.name]: e.target.value })
  }
  return (
    &lt;Flex flexDirection="column" bg="background" w="100vw" h="100vh"&gt;
      &lt;Box marginLeft="auto" marginRight="30px"&gt;
        &lt;p&gt;
          &lt;Link href="/recipes"&gt;
            &lt;Button variantColor="blue" variant="outline" cursor="pointer"&gt;
              Back
            &lt;/Button&gt;
          &lt;/Link&gt;
        &lt;/p&gt;
      &lt;/Box&gt;
      &lt;Box
        rounded="lg"
        maxW="sm"
        margin="auto"
        display="flex"
        justifyContent={"center"}
        alignItems={"center"}
        height="100%"
      &gt;
        &lt;Formik
          initialValues={{ name: "", description: "", imageUrl: "" }}
          onSubmit={async (values, actions) =&gt; {
            await createRecipe({
              data: {
                name: state.name,
                description: state.description,
                imageUrl: state.imageUrl,
                likes: 0,
              },
            })
            router.push("/recipes")
          }}
        &gt;
          {(props) =&gt; (
            &lt;Form style={{ backgroundColor: "white", padding: "20px", borderRadius: "8px" }}&gt;
              &lt;Field name="name" validate={validationName}&gt;
                {({ field, form }) =&gt; (
                  &lt;FormControl isInvalid={props.errors.name &amp;&amp; props.touched.name}&gt;
                    &lt;FormLabel htmlFor="name"&gt;Recipe Name&lt;/FormLabel&gt;
                    &lt;Input
                      {...field}
                      id="name"
                      placeholder="Enter Recipe name"
                      value={state.name}
                      onChange={onChange}
                      boxSizing="border-box"
                    /&gt;
                    &lt;FormErrorMessage&gt; {props.errors.name}&lt;/FormErrorMessage&gt;
                  &lt;/FormControl&gt;
                )}
              &lt;/Field&gt;
              &lt;Field name="description" validate={validateDescription}&gt;
                {({ field, form }) =&gt; (
                  &lt;FormControl isInvalid={props.errors.description &amp;&amp; props.touched.description}&gt;
                    &lt;FormLabel htmlFor="description"&gt;Description&lt;/FormLabel&gt;
                    &lt;Input
                      {...field}
                      id="description"
                      value={state.description}
                      placeholder="Enter Description"
                      onChange={onChange}
                      boxSizing="border-box"
                    /&gt;
                    &lt;FormErrorMessage&gt;{props.errors.description}&lt;/FormErrorMessage&gt;
                  &lt;/FormControl&gt;
                )}
              &lt;/Field&gt;
              &lt;FormControl&gt;
                &lt;FormLabel&gt;Upload Images&lt;/FormLabel&gt;
                &lt;Input type="file" name="file" onChange={uploadFile} boxSizing="border-box" /&gt;
                &lt;Stack isInline&gt;
                  {state.uploadingState === "NONE" ? (
                    &lt;Text&gt;Waiting to upload&lt;/Text&gt;
                  ) : state.uploadingState === "UPLOADING" ? (
                    &lt;Spinner /&gt;
                  ) : (
                    &lt;Image size="100px" objectFit="cover" src={state.imageUrl} alt="recipe" /&gt;
                  )}
                &lt;/Stack&gt;
              &lt;/FormControl&gt;
              &lt;Button
                mt={4}
                variantColor={"teal"}
                boxSizing="border-box"
                isLoading={props.isSubmitting}
                type="submit"
              &gt;
                Submit
              &lt;/Button&gt;
            &lt;/Form&gt;
          )}
        &lt;/Formik&gt;
      &lt;/Box&gt;
    &lt;/Flex&gt;
  )
}
export default NewRecipePage</pre>
<p>这个组件中使用了很多包。让我们逐一分解一下:</p>
<ul>
<li><a href="https://chakra-ui.com/" target="_blank" rel="noopener noreferrer">Charka UI</a>–Chakra是专为React打造的设计系统。它为我们提供了React组件的基本组件，如Box、Input、Modal等。</li>
<li><a href="https://jaredpalmer.com/formik/" target="_blank" rel="noopener noreferrer">Formik</a>–Formik使React应用程序中的表单验证和功能更加简单。</li>
<li><a href="https://github.com/blitz-js/blitz" target="_blank" rel="noopener noreferrer">Blitz</a>–就像我们之前讨论过的，我们在这里对所有操作都使用Blitz。</li>
</ul>
<p>主要是，我们这里有一个表格。提交后，我们将数据存储在Postgres数据库中，并发送回我们的食谱列表。</p>
<p>这里我们需要注意的一点是Blitz.js如何调用API和存储数据。一旦用户提交表单，我们调用<code>createRecipe</code>函数:</p>
<pre>await createRecipe({
              data: {
                name: state.name,
                description: state.description,
                imageUrl: state.imageUrl,
                likes: 0,
              },
})</pre>
<p><code>createRecipe</code>功能将在<code>mutations/recipes/createRecipe.ts</code>内:</p>
<pre>import db, {RecipeCreateArgs} from 'db'
export default async function createRecipe(args: RecipeCreateArgs) {
  const recipe = await db.recipe.create(args)
  return recipe
}</pre>
<p>如果我们愿意，我们可以改变功能。它在数据库中创建数据并返回它。此外，闪电战为你创造了<code>delete</code>和<code>update</code>突变。</p>
<p><img data-attachment-id="19555" data-permalink="https://blog.logrocket.com/building-a-fullstack-react-application-with-blitz-js/attachment/create-recipe/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/create-recipe.png" data-orig-size="480,260" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="create-recipe" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/create-recipe-300x163.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/create-recipe.png" decoding="async" class="aligncenter wp-image-19555 jetpack-lazy-image" src="../Images/f5d15dd11a3768c1ca19a295b008be50.png" alt="A screenshot of the recipes folder." data-lazy-srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/create-recipe.png 480w, https://blog.logrocket.com/wp-content/uploads/2020/05/create-recipe-300x163.png 300w" data-lazy-sizes="(max-width: 730px) 100vw, 730px" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2020/05/create-recipe.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/create-recipe.png"/></p><noscript><img data-lazy-fallback="1" data-attachment-id="19555" data-permalink="https://blog.logrocket.com/building-a-fullstack-react-application-with-blitz-js/attachment/create-recipe/" data-orig-file="https://blog.logrocket.com/wp-content/uploads/2020/05/create-recipe.png" data-orig-size="480,260" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="create-recipe" data-image-description="" data-image-caption="" data-medium-file="https://blog.logrocket.com/wp-content/uploads/2020/05/create-recipe-300x163.png" data-large-file="https://blog.logrocket.com/wp-content/uploads/2020/05/create-recipe.png" decoding="async" loading="lazy" class="aligncenter wp-image-19555" src="../Images/f5d15dd11a3768c1ca19a295b008be50.png" alt="A screenshot of the recipes folder." srcset="https://blog.logrocket.com/wp-content/uploads/2020/05/create-recipe.png 480w, https://blog.logrocket.com/wp-content/uploads/2020/05/create-recipe-300x163.png 300w" sizes="(max-width: 730px) 100vw, 730px" data-original-src="https://blog.logrocket.com/wp-content/uploads/2020/05/create-recipe.png"/></noscript>
<p>完成所有功能后，可以使用以下命令运行应用程序:</p>
<pre>blitz start</pre>
<p>或者这个命令:</p>
<pre>npm run start</pre>
<h3>部署</h3>
<p>要部署您的应用程序，您可以用部署React或Nextj.s应用程序的相同方式来构建和部署您的应用程序:</p>
<pre>npm run deploy</pre>
<h2>结论</h2>
<p>总之，Blitz.js有助于在短时间内使用所有codegen和命令构建fullstack应用程序。我个人的观点是，如果你打算在应用程序中使用Next.js，使用Blitz.js是有帮助的。</p>
<p>点击查看完整源代码<a href="https://github.com/ganeshmani/recipe-app-blitzjs" target="_blank" rel="noopener noreferrer">。</a></p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用LogRocket消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款React analytics解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket告诉您React应用程序中实际影响用户的最具影响力的bug和UX问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS异常、前端性能指标和用户交互。然后，LogRocket使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试LogRocket】。</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>