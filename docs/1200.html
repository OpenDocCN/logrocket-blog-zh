<html>
<head>
<title>How to set up internationalization in React using Lingui.js - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何使用Lingui.js - LogRocket Blog在React中设置国际化</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/how-to-set-up-internationalization-in-react-using-lingui-js/#0001-01-01">https://blog.logrocket.com/how-to-set-up-internationalization-in-react-using-lingui-js/#0001-01-01</a></blockquote><div><article class="article-post">
<h2>概观</h2>
<p>国际化(i18n)和本地化在软件开发中至关重要，可以扩展应用程序的范围。有时，甚至需要创建一个内置特定语言的应用程序。例如，大多数政府网站页面被翻译成他们自己国家的当地和国家语言。</p>
<p>大多数网站都依赖于JavaScript ，难怪会有许多流行的JavaScript库来处理应用程序的国际化。一些最著名的图书馆是:</p>

<p>出于本文的目的，我将演示如何使用Lingui.js。这是一个功能强大的库，不仅处理本地JavaScript应用程序的国际化，还处理最著名的JavaScript库之一<a href="https://reactjs.org/" target="_blank" rel="noopener noreferrer"> React </a>的国际化。Lingui.js的<a href="https://lingui.js.org/index.html" target="_blank" rel="noopener noreferrer">轻量级只有5KB </a>，对于初学者来说非常容易上手。</p>
<h2>Lingui.js简介</h2>
<p>Lingui.js是一个相对较新的国际化库，但它提供了一些流行的竞争对手库中没有的功能，如<a href="https://www.npmjs.com/package/react-intl" target="_blank" rel="noopener noreferrer"> react-intl </a>和<a href="https://www.i18next.com/" target="_blank" rel="noopener noreferrer"> i18next </a>。例如，Lingui.js打包了可以用来为组件生成消息语法的<a href="https://lingui.js.org/ref/macro.html" target="_blank" rel="noopener noreferrer">宏</a>。Lingui.js的一些其他突出特性是:</p>
<ul>
<li>针对性能进行了优化(大小仅为5KB)</li>
<li>易于与React和React本机应用程序集成</li>
<li>它的社区活跃在GitHub和T2的频谱上</li>
<li>Lingui.js提供了全面的<a href="https://lingui.js.org/" target="_blank" rel="noopener noreferrer">文档</a>和<a href="https://lingui.js.org/tutorials/react.html" target="_blank" rel="noopener noreferrer">分步指南</a>以及<a href="https://lingui.js.org/ref/core.html" target="_blank" rel="noopener noreferrer"> API参考</a></li>
<li>它使用ICU MessageFormat，使得UI翻译可读</li>
<li>提供对富文本的支持，这是许多竞争对手的库中所没有的</li>
<li>Lingui.js有自己的CLI来简化翻译用户界面的整个过程</li>
</ul>
<p>一般来说，Lingui.js可以集成到任何类型的静态应用程序中。如果你有一个像聊天系统或在线游戏这样的实时应用，那么Lingui.js可能是一个很好的选择，因为它被设计成对资源密集型应用是高效的。比如<a href="https://github.com/CaliOpen/Caliopen" target="_blank" rel="noopener noreferrer"> Caliopen </a>(统一消息平台)就在积极使用Lingui.js。</p>
<p>在本文中，我们将使用一个示例项目在React应用程序中集成Lingui.js。为了更简单，我们将使用<a href="https://www.npmjs.com/package/create-react-app" target="_blank" rel="noopener noreferrer"> create-react-app </a>包。</p>
<h2>先决条件</h2>
<p>要跟随本教程，您必须已经在系统上安装了<a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer"> Node.js </a>。它的最新版本打包了像<a href="https://www.npmjs.com/" target="_blank" rel="noopener noreferrer"> npm </a>和<a href="https://www.npmjs.com/package/npx" target="_blank" rel="noopener noreferrer"> npx </a>这样的工具，所以你不必单独安装它们。</p>
<h2>入门指南</h2>
<p>我们的第一步是在本地机器上安装create-react-app包的最新版本。为此，请打开系统上所需文件夹内的控制台/终端。之后，执行以下命令:</p>
<pre>npx create-react-app my-app</pre>
<p>安装所有的依赖项和设置一个基本的React应用程序需要一些时间，所以请耐心等待。安装完成后，运行以下命令:</p>
<pre>cd my-app</pre>
<p>现在，您将进入项目文件夹，并准备安装Lingui.js。</p>
<p>实际上，Lingui.js的开发人员将整个库分成了不同的模块。目前，我们感兴趣的是<a href="https://www.npmjs.com/package/@lingui/cli" target="_blank" rel="noopener noreferrer"> CLI </a>、<a href="https://www.npmjs.com/package/@lingui/macro" target="_blank" rel="noopener noreferrer">宏</a>和<a href="https://www.npmjs.com/package/@lingui/react" target="_blank" rel="noopener noreferrer">反应</a>。我们还需要<a href="https://www.npmjs.com/package/@babel/core" target="_blank" rel="noopener noreferrer"> Babel编译器核心</a>和<a href="https://github.com/babel/babel-bridge" target="_blank" rel="noopener noreferrer"> babel-bridge </a>来支持旧版本的Babel。</p>
<p>让我们在React项目中安装所有这些依赖项:</p>
<pre>npm i --save-dev @lingui/cli @lingui/macro @babel/core <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="96f4f7f4f3fabbf5f9e4f3d6f4e4fff2f1f3">[email protected]</a>
npm i --save @lingui/react</pre>
<h2>Lingui.js配置</h2>
<p>是时候设置Lingui.js了，通知它消息文件的位置、使用的格式和默认的ui语言。为此，您必须在项目的根目录下创建一个名为<code>.linguirc</code>的文件。该文件的内容应该如下所示:</p>
<pre>{
    "localeDir": "src/locales/",
    "srcPathDirs": ["src/"],
    "format": "minimal",
    "sourceLocale": "en"
}
</pre>
<p><code>src</code>目录将保存消息的源文件，而Lingui.js将从这些文件中提取消息并将它们写入特定于语言的文件夹中。每种语言(例如，英语、乌尔都语、中文等。，)将在<code>src/locales/</code>文件夹中有自己的子文件夹。</p>
<p>此外，为消息翻译选择正确的格式也很重要。一些可用的格式包括:</p>
<ul>
<li><code>lingui</code>:每条消息都以预定义的格式返回，比如<a href="https://lingui.js.org/ref/conf.html#lingui" target="_blank" rel="noopener noreferrer">这个</a></li>
<li><code>minimal</code>:每条消息都以简单的JSON格式返回，比如<a href="https://lingui.js.org/ref/conf.html#lingui" target="_blank" rel="noopener noreferrer"> this </a></li>
<li><code>po</code>:每条消息都以文件的形式返回</li>
</ul>
<p>Lingui.js推荐<code>po</code>格式。一般来说，这是个人喜好和当前应用程序设置的问题。我们大多数人可能会发现<code>minimal</code>(即JSON)格式比其他格式更容易阅读。因此，在本教程中，我们将使用<code>minimal</code>格式。要了解每种格式的更多信息，请参考文档的<a href="https://lingui.js.org/ref/conf.html#std:config-format" target="_blank" rel="noopener noreferrer">这一部分。</a></p>
<h2>更新<code>package.json</code></h2>
<p>此时，我们必须在<code>package.json</code>中添加一些脚本。</p>
<pre>{
    "scripts": {
      "add-locale": "lingui add-locale",
      "extract": "lingui extract",
      "compile": "lingui compile"
    }
}
</pre>
<p>使用上面的命令，我们将能够在应用程序中生成新的语言环境，以及编译和提取当前的语言环境。</p>
<h2>添加用户界面语言</h2>
<p>执行<code>add-locale</code>脚本将使我们能够为我们的用户界面创建不同的语言:</p>
<pre>npm run add-locale en zh ur</pre>
<p>为此，你可以在IANA官方网站上查看<a href="https://www.iana.org/assignments/language-subtag-registry/language-subtag-registry" target="_blank" rel="noopener noreferrer">支持的语言代码</a>。</p>
<h2>创建网页</h2>
<p>CRA的应用已经有了一个基本的主页。你可以在<code>/src/App.js</code>下找到这个文件。我们将像这样修改这个文件:</p>
<pre>import React, { useState, useEffect } from 'react';
import { Trans } from '@lingui/macro';

import LanguageSelector from './components/LanguageSelector';

function App({ language, onLanguageChange }) {

  return (
    &lt;div className="App"&gt;
      &lt;LanguageSelector
        language={language}
        onChangeLangage={onLanguageChange}
      /&gt;
      &lt;header className="App-header"&gt;
        &lt;h1&gt;&lt;Trans&gt;Name of Countries&lt;/Trans&gt;&lt;/h1&gt;
      &lt;/header&gt;
      &lt;ul&gt;
        &lt;li&gt;&lt;Trans&gt;United States&lt;/Trans&gt;&lt;/li&gt;
        &lt;li&gt;&lt;Trans&gt;Finland&lt;/Trans&gt;&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
  );
}

export default App;
</pre>
<p>你是否注意到我们正在使用一个<code>LanguageSelector</code>组件？</p>
<p>这有助于我们动态地改变用户界面的语言。它使用了一个简单的HTML选择下拉菜单。这个组件看起来是这样的:</p>
<pre>import React from 'react';

function LanguageSelector({ language, onChangeLangage }) {

  function handleChange(event) {
    event.preventDefault();
    onChangeLangage(event.target.value);
  }

  return (
    &lt;div className="select"&gt;
      &lt;select onChange={handleChange} value={language}&gt;
        &lt;option value="en"&gt;English&lt;/option&gt;
        &lt;option value="ur"&gt;Urdu&lt;/option&gt;
        &lt;option value="zh"&gt;Chinese&lt;/option&gt;
      &lt;/select&gt;
    &lt;/div&gt;
  );
}

export default LanguageSelector;
</pre>
<p>最后，我们需要更新我们的主<code>/src/index.js</code>文件。该文件负责导入所选语言的翻译并呈现整个网页。</p>
<pre>import React, { useState } from 'react';
import ReactDOM from 'react-dom';
import { I18nProvider } from '@lingui/react';
import App from './App';

async function loadMessages(language) {
  return await import(`@lingui/loader!./locales/${language}/messages.json`);
}

function LocalizedApp() {
  const [catalogs, setCatalogs] = useState({})
  const [language, setLanguage] = useState('en');

  async function handleLanguageChange(language) {
    const newCatalog = await loadMessages(language);

    const newCatalogs = { ...catalogs, [language]: newCatalog };

    setCatalogs(newCatalogs);
    setLanguage(language);
  }

  return (
    &lt;I18nProvider language={language} catalogs={catalogs}&gt;
      &lt;App
        language={language}
        onLanguageChange={handleLanguageChange}
      /&gt;
    &lt;/I18nProvider&gt;
  );
}

ReactDOM.render(&lt;LocalizedApp /&gt;, document.getElementById('root'));
</pre>
<h2>从源代码中提取消息</h2>
<p>现在我们已经在<code>&lt;Trans&gt; … &lt;/Trans&gt;</code>宏中包装了一些文本，是时候从源代码中提取所有这些消息，然后在每个语言环境中创建键值对。这个键将作为一个ID，其中的值是它在特定语言中的翻译。</p>
<p>在英语中，键和值对保持不变。但是我们必须改变其他语言的值。默认情况下，它们的值将是空字符串，我们必须手动添加翻译。</p>
<p>执行<code>npm run extract</code>命令从源代码中提取消息。</p>
<h2>用户界面翻译</h2>
<p>我们创建了一个网页，显示两个国家的列表:芬兰和美国。现在，我们必须将用户界面翻译成所有支持的语言。</p>
<p>之前，我们在项目中添加了英语、中文和乌尔都语地区。默认语言是英语，Lingui.js足够智能，可以自动填充英语翻译:</p>
<pre>{
  "Finland": "Finland",
  "Name of Countries": "Name of Countries",
  "United States": "United States"
}
</pre>
<p>现在，打开<code>/src/locales/ur/messages.json</code>，用下面的代码替换它的内容。</p>
<pre>{
  "Finland": "فن لینڈ",
  "Name of Countries": "ممالک کا نام",
  "United States": "امریکہ"
}
</pre>
<p>类似地，打开<code>/src/locales/zh/messages.json</code>，用下面的翻译更新它。</p>
<pre>{
  "Finland": "芬兰",
  "Name of Countries": "国家名称",
  "United States": "美国"
}
</pre>
<p>此时，我们已经准备好编译这些翻译，以便在我们的应用程序中使用它们。为此，执行编译命令<code>npm run compile</code>。</p>
<h2>运行项目</h2>
<p>要运行应用程序，请运行命令<code>npm start</code>。</p>
<h2>结论</h2>
<p>我们一起学习了如何轻松地将Lingui.js与React应用程序集成，并为您的应用程序添加国际化功能。</p>
<p>Lingui.js最大的好处之一是它可以自动管理所有语言的翻译键值对。这将使用空字符串初始化消息，以防止运行时出错。之后，您只需为不同的键值添加特定的翻译，就可以用一种新的语言查看您的应用程序。</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用LogRocket消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款React analytics解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket告诉您React应用程序中实际影响用户的最具影响力的bug和UX问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS异常、前端性能指标和用户交互。然后，LogRocket使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试LogRocket】。</a></p>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>