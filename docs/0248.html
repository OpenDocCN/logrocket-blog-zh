<html>
<head>
<title>What’s new in Create React App 3 - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Create React App 3 - LogRocket博客的新特性</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/whats-new-in-create-react-app-3-950049f54f92/#0001-01-01">https://blog.logrocket.com/whats-new-in-create-react-app-3-950049f54f92/#0001-01-01</a></blockquote><div><article class="article-post">
<p class="section-divider">【2019年4月底发布的Create React App (CRA) 3为hooks和TypeScript项目添加了林挺规则，以及其他改进和版本升级，以简化React应用的开发。</p>
<p class="graf graf--p">在本文中，我将介绍CRA 3的以下新功能:</p>
<ul class="postList">
<li class="graf graf--li">笑话24</li>
<li class="graf graf--li">钩子规则的支持</li>
<li class="graf graf--li">打字稿文件的林挺</li>
<li class="graf graf--li"><code>browserslist</code>生产和开发环境配置</li>
<li class="graf graf--li"><code>baseUrl</code>在<code>jsconfig.json</code> / <code>tsconfig.json</code></li>
</ul>
<p class="graf graf--p">要获得所有特性的完整列表(以及一些突破性的变化)，请查看这个版本的<a class="markup--anchor markup--p-anchor" href="https://github.com/facebook/create-react-app/releases/tag/v3.0.0" target="_blank" rel="noopener noreferrer" data-href="https://github.com/facebook/create-react-app/releases/tag/v3.0.0">变更日志</a>。</p>
<figure class="graf graf--figure graf--layoutOutsetCenter"/>
<h3 class="graf graf--h3">笑话24</h3>
<p class="graf graf--p">CRA现在捆绑了最新的主要版本<a class="markup--anchor markup--p-anchor" href="https://jestjs.io/" target="_blank" rel="noopener noreferrer" data-href="https://jestjs.io/"> Jest </a>(具体来说，在撰写本文时是版本24.7.1)。</p>
<p class="graf graf--p">与之前的版本相比，Jest 24包括如下变化:</p>
<ul class="postList">
<li class="graf graf--li">内置支持传输类型脚本文件</li>
<li class="graf graf--li">改进的错误报告</li>
<li class="graf graf--li">用于在测试总结中单独打印todos的<code>test.todo</code>功能</li>
<li class="graf graf--li">将<code>setupTestFrameworkScriptFile</code>重命名为<code>setupFilesAfterEnv</code>，将其转换为一个数组</li>
</ul>
<p class="graf graf--p">要了解更多信息，你可以查看这篇<a class="markup--anchor markup--p-anchor" href="https://jestjs.io/blog/2019/01/25/jest-24-refreshing-polished-typescript-friendly" target="_blank" rel="noopener noreferrer" data-href="https://jestjs.io/blog/2019/01/25/jest-24-refreshing-polished-typescript-friendly">博客文章</a>或<a class="markup--anchor markup--p-anchor" href="https://github.com/facebook/jest/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" data-href="https://github.com/facebook/jest/blob/master/CHANGELOG.md">的变更日志</a>。</p>
<p class="graf graf--p">如果你没有使用Jest，它是一个运行在Node.js环境中的单元测试框架，而不是一个浏览器。</p>
<p class="graf graf--p">当执行<code>npm test</code>时，CRA将使用Jest运行具有以下命名约定的测试:</p>
<ul class="postList">
<li class="graf graf--li"><code>__tests__</code>文件夹中带有<code>.js</code>后缀的文件</li>
<li class="graf graf--li">带有<code>.test.js</code>后缀的文件</li>
<li class="graf graf--li">带有<code>.spec.js</code>后缀的文件</li>
</ul>
<p class="graf graf--p">默认情况下，Jest将只运行与自上次提交以来更改的文件相关的测试，它将以监视模式启动(每次保存文件时，它都会重新运行测试)。</p>
<p class="graf graf--p">为了避免在观察模式下运行测试，CRA 3移除了<code>--no-watch</code>标志，支持Jest的标志<code>--watchAll=false</code>。但是，如果您或您的CI服务器设置了<code>CI</code>环境变量，则不需要此标志。</p>
<p class="graf graf--p">您可以在页面的<a class="markup--anchor markup--p-anchor" href="https://facebook.github.io/create-react-app/docs/running-tests#on-ci-servers" target="_blank" rel="noopener noreferrer" data-href="https://facebook.github.io/create-react-app/docs/running-tests#on-ci-servers">了解更多关于运行测试的信息。</a></p>
<h3 class="graf graf--h3">钩子规则</h3>
<p class="graf graf--p">钩子是在React 16.8 中引入的<a class="markup--anchor markup--p-anchor" href="https://reactjs.org/blog/2019/02/06/react-v16.8.0.html" target="_blank" rel="noopener noreferrer" data-href="https://reactjs.org/blog/2019/02/06/react-v16.8.0.html">。它们是允许你使用React特性的函数，这些特性只适用于</a><a class="markup--anchor markup--p-anchor" href="https://www.robinwieruch.de/react-function-component/" target="_blank" rel="noopener noreferrer" data-href="https://www.robinwieruch.de/react-function-component/">功能组件</a>中的类(如<a class="markup--anchor markup--p-anchor" href="https://reactjs.org/docs/hooks-state.html" target="_blank" rel="noopener noreferrer" data-href="https://reactjs.org/docs/hooks-state.html">状态处理</a>)。</p>
<p class="graf graf--p">使用钩子有两个规则:</p>
<ol class="postList">
<li class="graf graf--li">在函数组件的顶层使用钩子，不要在循环、条件或嵌套函数中使用</li>
<li class="graf graf--li">只从功能组件调用钩子，不要从常规JavaScript函数调用钩子</li>
</ol>
<p class="graf graf--p">CRA 3集成了一个ESLint插件，<a class="markup--anchor markup--p-anchor" href="https://github.com/facebook/react/tree/master/packages/eslint-plugin-react-hooks" target="_blank" rel="noopener noreferrer" data-href="https://github.com/facebook/react/tree/master/packages/eslint-plugin-react-hooks">ESLint-plugin-react-hooks</a>，它执行这两个规则和其他约定(例如，钩子必须以<code>use</code>开头，后跟一个大写字符)。</p>
<p class="graf graf--p">如果您违反了其中一条规则，构建将会失败。</p>
<p class="graf graf--p">例如，如果您以下列方式修改文件<code>src/App.js</code>:</p>

<p class="graf graf--p">由于钩子<code>useState</code>正在条件块中使用，构建将失败，并显示以下消息:</p>
<pre class="graf graf--pre">Failed to compile.</pre>
<pre class="graf graf--pre">./src/App.js

Line 7:  React Hook "useState" is called conditionally. React Hooks must be called in the exact same order in every component render react-hooks/rules-of-hooks</pre>
<p class="graf graf--p">在<a class="markup--anchor markup--p-anchor" href="https://github.com/facebook/create-react-app/tree/master/packages/eslint-config-react-app" target="_blank" rel="noopener noreferrer" data-href="https://github.com/facebook/create-react-app/tree/master/packages/eslint-config-react-app">这个自述文件</a>(特别是<a class="markup--anchor markup--p-anchor" href="https://github.com/facebook/create-react-app/blob/master/packages/eslint-config-react-app/index.js" target="_blank" rel="noopener noreferrer" data-href="https://github.com/facebook/create-react-app/blob/master/packages/eslint-config-react-app/index.js"> index.js </a>文件)中，你可以了解到更多关于CRA使用的ESLint配置。</p>
<p class="graf graf--p">在<a class="markup--anchor markup--p-anchor" href="https://facebook.github.io/create-react-app/docs/setting-up-your-editor#displaying-lint-output-in-the-editor" target="_blank" rel="noopener noreferrer" data-href="https://facebook.github.io/create-react-app/docs/setting-up-your-editor#displaying-lint-output-in-the-editor">这个页面</a>上，您可以学习如何设置您的编辑器来显示lint输出。</p>
<h3 class="graf graf--h3">打字稿林挺</h3>
<p class="graf graf--p">CRA 3还通过<a class="markup--anchor markup--p-anchor" href="https://github.com/typescript-eslint/typescript-eslint" target="_blank" rel="noopener noreferrer" data-href="https://github.com/typescript-eslint/typescript-eslint"> typescript-eslint </a>为TypeScript项目添加了林挺规则。</p>
<p class="graf graf--p">请记住，您可以使用以下任一方法创建TypeScript项目:</p>
<pre class="graf graf--pre">npx create-react-app my-typescript-app --typescript</pre>
<p class="graf graf--p">或者:</p>
<pre class="graf graf--pre">yarn create react-app my-typescript-app --typescript</pre>
<p class="graf graf--p"><a class="markup--anchor markup--p-anchor" href="https://github.com/facebook/create-react-app/blob/4b8b38bf7c55326f8d51ea9deeea76d7feee307d/packages/eslint-config-react-app/index.js#L55:L86" target="_blank" rel="noopener noreferrer" data-href="https://github.com/facebook/create-react-app/blob/4b8b38bf7c55326f8d51ea9deeea76d7feee307d/packages/eslint-config-react-app/index.js#L55:L86">在这里</a>你可以看到CRA 3.0中TypeScript的ESLint配置，在<a class="markup--anchor markup--p-anchor" href="https://facebook.github.io/create-react-app/docs/setting-up-your-editor#displaying-lint-output-in-the-editor" target="_blank" rel="noopener noreferrer" data-href="https://facebook.github.io/create-react-app/docs/setting-up-your-editor#displaying-lint-output-in-the-editor">本页</a>你可以找到在Visual Studio代码的ESLint扩展中启用TypeScript支持的说明。</p>
<h3 class="graf graf--h3">浏览器列表配置</h3>
<p class="graf graf--p"><a class="markup--anchor markup--p-anchor" href="https://github.com/browserslist/browserslist" target="_blank" rel="noopener noreferrer" data-href="https://github.com/browserslist/browserslist"> Browserslist </a>允许您配置一组浏览器版本，以更改构建输出，从而生成兼容的代码并支持指定的浏览器版本。</p>
<p class="graf graf--p">您可以为生产和开发指定单独的列表。例如，如果将以下配置添加到<code>package.json</code>文件中:</p>
<pre class="graf graf--pre">"browserslist": {

  "production": [

    "cover 99.5%"

  ],

  "development": [

    "last 2 chrome versions"

  ]

}</pre>
<p class="graf graf--p">生产版本将针对覆盖全球99.5%使用量的浏览器，而开发版本将只针对Chrome的最后两个版本。</p>
<p class="graf graf--p">Browserslist使用<a class="markup--anchor markup--p-anchor" href="https://caniuse.com/" target="_blank" rel="noopener noreferrer" data-href="https://caniuse.com/">我可以使用</a>进行这些查询，但是你可以使用<a class="markup--anchor markup--p-anchor" href="https://browserl.ist/" target="_blank" rel="noopener noreferrer" data-href="https://browserl.ist/">https://browser rl . ist</a>来查看这些查询的结果(这里<a class="markup--anchor markup--p-anchor" href="https://browserl.ist/?q=cover+99.5%25" target="_blank" rel="noopener noreferrer" data-href="https://browserl.ist/?q=cover+99.5%25">这里</a>和<a class="markup--anchor markup--p-anchor" href="https://browserl.ist/?q=last+2+chrome+versions" target="_blank" rel="noopener noreferrer" data-href="https://browserl.ist/?q=last+2+chrome+versions">这里</a>)并测试你自己的。</p>
<p class="graf graf--p">这样，你可以安装<a class="markup--anchor markup--p-anchor" href="https://babeljs.io/docs/en/babel-polyfill" target="_blank" rel="noopener noreferrer" data-href="https://babeljs.io/docs/en/babel-polyfill"> @babel/polyfill </a>作为你的项目的依赖项，并将其导入到<code>src/index.js</code>或<code>src/index.tsx</code>文件的顶部，浏览器列表会在必要时包含poly fill(poly fill不会自动添加)。在<a class="markup--anchor markup--p-anchor" href="https://facebook.github.io/create-react-app/docs/supported-browsers-features" target="_blank" rel="noopener noreferrer" data-href="https://facebook.github.io/create-react-app/docs/supported-browsers-features">这个页面</a>，你可以找到更多关于支持的语言特性的信息。</p>
<p class="graf graf--p">另外，如果你想让CRA 3处理一个重置的CSS，默认情况下它会使用<a class="markup--anchor markup--p-anchor" href="https://github.com/csstools/postcss-normalize" target="_blank" rel="noopener noreferrer" data-href="https://github.com/csstools/postcss-normalize"> PostCSS Normalize </a>，反过来，它会使用Browserslist配置来修改它的输出。你只需要在CSS文件的任何地方添加<code>@import-normalize;</code>。更多信息见<a class="markup--anchor markup--p-anchor" href="https://facebook.github.io/create-react-app/docs/adding-css-reset" target="_blank" rel="noopener noreferrer" data-href="https://facebook.github.io/create-react-app/docs/adding-css-reset">本页</a>。</p>
<p class="graf graf--p">Browserslist的默认配置针对生产中的各种浏览器，但是按照这个<a class="markup--anchor markup--p-anchor" href="https://github.com/browserslist/browserslist#queries" target="_blank" rel="noopener noreferrer" data-href="https://github.com/browserslist/browserslist#queries"> README </a>文件中的说明，您将能够定义自己的定制查询。</p>
<h3 class="graf graf--h3">设置基本URL</h3>
<p class="graf graf--p">将<code>NODE_PATH</code>环境变量设置为冒号分隔的(Windows上的分号)绝对路径列表，允许Node.js在这些路径中搜索模块，以避免出现以下情况:</p>
<pre class="graf graf--pre">const myModule = require('../../../../../../myModule');</pre>
<p class="graf graf--p">CRA 3不再需要在一个<code>.env</code>文件中设置<code>NODE_PATH</code>(这个变量仍然被考虑，但是<a class="markup--anchor markup--p-anchor" href="https://github.com/facebook/create-react-app/blob/4b8b38bf7c55326f8d51ea9deeea76d7feee307d/packages/react-scripts/config/modules.js#L28" target="_blank" rel="noopener noreferrer" data-href="https://github.com/facebook/create-react-app/blob/4b8b38bf7c55326f8d51ea9deeea76d7feee307d/packages/react-scripts/config/modules.js#L28">不推荐，并且将在未来的版本</a>中被删除)。</p>
<p class="graf graf--p">所以现在你必须在项目根目录下的<code>jsconfig.json</code>或<code>tsconfig.json</code>文件(后者用于类型脚本项目)中使用<code>baseUrl</code>:</p>
<pre class="graf graf--pre">{

  "compilerOptions": {

    "baseUrl": "src"

  },

}</pre>
<p class="graf graf--p">通过这种方式，而不是像这样:</p>
<pre class="graf graf--pre">import Menu from 'src/components/Menu';</pre>
<p class="graf graf--p">你只需要:</p>
<pre class="graf graf--pre">import Menu from 'components/Menu';</pre>
<p class="graf graf--p">不是很大的改进，但是在CRA 3.0中，<code>baseUrl</code>唯一可接受的值是<code>src</code>和<code>node_modules</code>(默认值)。</p>
<p class="graf graf--p">在<a class="markup--anchor markup--p-anchor" href="https://facebook.github.io/create-react-app/docs/importing-a-component#absolute-imports" target="_blank" rel="noopener noreferrer" data-href="https://facebook.github.io/create-react-app/docs/importing-a-component#absolute-imports">这个页面</a>，你可以找到更多关于这个功能的信息。</p>
<h3 class="graf graf--h3">结论</h3>
<p class="graf graf--p">毫无疑问，CRA在每一个新版本中都在不断进步。由于近<a class="markup--anchor markup--p-anchor" href="https://github.com/facebook/create-react-app/releases/tag/v3.0.0" target="_blank" rel="noopener noreferrer" data-href="https://github.com/facebook/create-react-app/releases/tag/v3.0.0"> 50名提交者</a>的工作，这一次，它为内部和底层工具带来了一系列有用的添加、改进和更新。</p>
<p class="graf graf--p">如果您已经用CRA 2创建了一个React应用程序，并且没有弹出它，那么升级到CRA 3就像运行以下命令一样简单:</p>
<pre class="graf graf--pre">npm install --save --save-exact <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="4331262220376e3020312a33373003706d736d73">[email protected]</a>

# Or

yarn add --exact <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="bac8dfdbd9ce97c9d9c8d3cacec9fa89948a948a">[email protected]</a></pre>
<p class="graf graf--p">如果你已经弹出了你的应用程序，没有简单的升级过程，所以考虑是否值得将项目恢复到弹出之前的状态，升级，或者可选地，再次弹出。</p>
<p class="graf graf--p">编码快乐！</p><div class="code-block code-block-17">
<div class="blog-plug inline-plug react-plug" vwo-el-id="26283398190">
<h2 vwo-el-id="41600691720">使用LogRocket消除传统反应错误报告的噪音</h2>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" vwo-el-id="19356441070">LogRocket
</a><p>是一款React analytics解决方案，可保护您免受数百个误报错误警报的影响，只针对少数真正重要的项目。LogRocket告诉您React应用程序中实际影响用户的最具影响力的bug和UX问题。</p><a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441380">
<img class="first-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/f300c244a1a1cf916df8b4cb02bec6c6.png" vwo-el-id="18272717540" data-lazy-loaded="1" data-original-src="https://files.readme.io/27c94e7-Image_2017-06-05_at_9.46.04_PM.png"/>
</a>
<a class="signup" href="https://lp.logrocket.com/blg/react-signup-general" target="_blank" rel="noopener noreferrer" vwo-el-id="19356441690">
<img class="second-react-image alignnone size-full wp-image-46 jetpack-lazy-image jetpack-lazy-image--handled" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" vwo-el-id="30720362350" data-lazy-loaded="1" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/>
</a>
<a href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="35866400580">LogRocket
</a><p>自动聚合客户端错误、反应错误边界、还原状态、缓慢的组件加载时间、JS异常、前端性能指标和用户交互。然后，LogRocket使用机器学习来通知您影响大多数用户的最具影响力的问题，并提供您修复它所需的上下文。</p><p vwo-el-id="28675661060">关注重要的React bug—<a class="signup" href="https://lp.logrocket.com/blg/react-signup-issue-free" target="_blank" rel="noopener noreferrer" vwo-el-id="40093418840">今天就试试LogRocket】。</a></p><div class="code-block code-block-21">
<div class="blog-plug inline-plug typescript-plug"><h2><a class="signup" href="https://lp.logrocket.com/blg/typescript-signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>:全面了解您的网络和移动应用</h2>
<a href="https://lp.logrocket.com/blg/typescript-signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p>LogRocket 是一个前端应用程序监控解决方案，可以让您回放问题，就像问题发生在您自己的浏览器中一样。LogRocket不需要猜测错误发生的原因，也不需要向用户询问截图和日志转储，而是让您重放会话以快速了解哪里出错了。它可以与任何应用程序完美配合，不管是什么框架，并且有插件可以记录来自Redux、Vuex和@ngrx/store的额外上下文。</p>
<p>除了记录Redux操作和状态之外，日志火箭还记录控制台日志、JavaScript错误、堆栈跟踪、带有标头+正文的网络请求/响应、浏览器元数据和自定义日志。它还利用DOM来记录页面上的HTML和CSS，甚至为最复杂的单页和移动应用程序重新创建像素级的完美视频。</p>
<a class="signup" href="https://lp.logrocket.com/blg/typescript-signup" target="_blank" rel="noopener noreferrer">Try it for free</a><p>.</p></div>
</div>
</div></div>

<p class="clearfix"/>
<p class="clearfix"/>
</article>

</div>    
</body>
</html>