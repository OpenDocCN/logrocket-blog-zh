<html>
<head>
<title>Redux Logging in Production - LogRocket Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>生产中的Redux日志记录- LogRocket博客</h1>
<blockquote>原文：<a href="https://blog.logrocket.com/redux-logging-in-production-3b2a4816b713/#0001-01-01">https://blog.logrocket.com/redux-logging-in-production-3b2a4816b713/#0001-01-01</a></blockquote><div><div class="section-inner sectionLayout--insetColumn">
<p class="graf graf--p">Redux最大的优势之一是可调试性——通过记录应用执行期间的动作和状态，开发人员可以轻松了解代码错误、竞争条件、网络错误和其他错误来源。</p>
<p class="graf graf--p">在本地开发中，使用像redux-logger或redux-devtools这样的工具进行时间旅行调试和查看redux操作是标准的做法。但是使用Redux日志轻松修复bug的好处在生产中最为显著。</p>
<p class="graf graf--p">为了做到这一点，一些开发人员构建了自己开发的解决方案或者利用了现有的后端日志工具，但是要做到这一点并不容易。Redux数据必须在不影响应用程序性能的情况下有效地收集和上传，并且在后端，这些数据(相当大)必须被存储起来，并且可以方便地搜索以解决调试问题。</p>
<h4 class="graf graf--h4">Enter LogRocket…</h4>
<p class="graf graf--p">LogRocket 是第一款面向webapps的production Redux日志工具。它有一个高度优化的JavaScript SDK + Redux中间件，可以轻松扩展到支持数百万用户的应用程序。</p>
<p class="graf graf--p">除了记录Redux数据，LogRocket还记录网络请求、控制台日志、JavaScript错误和完整的DOM视频。在修复bug时，除了Redux日志之外，拥有这个上下文是至关重要的，因为它基本上拥有本地开发时在Chrome开发工具中可以找到的所有信息。</p>
<p class="graf graf--p">在这篇文章中，我将快速浏览一下在生产应用程序中设置LogRocket。然后，我将讨论如何利用Redux来最大化应用程序的可调试性。</p>
<h3 class="graf graf--h3">设置LogRocket</h3>
<p class="graf graf--p">设置LogRocket很容易，只需要在应用程序中添加几行代码:</p>
<ol class="postList">
<li class="graf graf--li">用NPM安装:<code>npm i --save logrocket</code>。</li>
<li class="graf graf--li">在<a class="markup--anchor markup--li-anchor" href="https://app.logrocket.com" target="_blank" rel="noopener noreferrer" data-href="https://app.logrocket.com">https://app.logrocket.com</a>创建一个免费账户，并记下您的申请id。</li>
<li class="graf graf--li">在应用程序中初始化LogRocket:</li>
</ol>
<pre class="graf graf--pre"><code class="markup--code markup--pre-code">import LogRocket from 'logrocket';

</code>// Initialize LogRocket with your app ID <code>LogRocket.init(&lt;your_application_id&gt;);</code></pre>
<p class="graf graf--p">4.添加Redux中间件。</p>
<pre class="graf graf--pre"><code class="markup--code markup--pre-code">import { applyMiddleware, createStore } from 'redux';

const store = createStore(
  reducer, // your app reducer
  applyMiddleware(middlewares, LogRocket.reduxMiddleware()),
);</code></pre>
<p class="graf graf--p">这就是基本设置——这是您开始使用LogRocket所需要的全部内容！稍后，我将讨论通过操作黑名单、数据清理和视频配置来定制LogRocket。</p>
<h3 class="graf graf--h3">查看用户会话的日志</h3>
</div>
<div class="section-inner sectionLayout--insetColumn">
<p class="graf graf--p">LogRocket捕获网络请求和响应，并允许您深入研究特定的请求，查看头部和主体。瀑布图显示了计时，可以很容易地看出哪些请求很慢，或者是否发生了潜在的争用情况。</p>
<h3 class="graf graf--h3"><strong class="markup--strong markup--h3-strong">高级配置</strong></h3>
<h4 class="graf graf--h4">DOM清理</h4>
<p class="graf graf--p">如果您的应用程序有敏感数据，如密码或信用卡输入，您可以将类<code>_lr-hide</code>添加到任何DOM节点，以防止数据离开浏览器。</p>
<h4 class="graf graf--h4">动作擦洗</h4>
<p class="graf graf--p">有时，一个应用程序可能会有重复非常频繁的动作，并且在调试时没有用处。您可以通过在Redux中间件中提供一个<code>actionSanitizer</code>函数来清除这些问题。这个函数返回<code>null</code>的任何动作都不会被记录。</p>
<pre class="graf graf--pre"><code class="markup--code markup--pre-code">LogRocket.reduxMiddleware({
  actionSanitizer: function (action) {
    if (action.type === 'ignoreThis') {
      return null;
    }
    return action;
  },
});</code></pre>
<h4 class="graf graf--h4">国家卫生处理</h4>
<p class="graf graf--p">与操作清理类似，您可以防止Redux存储的某些子树被记录如下:</p>
<pre class="graf graf--pre"><code class="markup--code markup--pre-code">LogRocket.reduxMiddleware({
  stateSanitizer: function (state) {
    return {
      ...state,
      removeThisKey: undefined,
    };
  },
});</code></pre>
<h3 class="graf graf--h3">将Redux日志集成到您的工作流中</h3>
<p class="graf graf--p">Redux日志通常是解决崩溃和用户报告问题的关键，因此将redux日志与错误报告和支持工具集成在一起会很有帮助。</p>
<p class="graf graf--p"><strong class="markup--strong markup--p-strong">错误报告:</strong></p>
<p class="graf graf--p">大多数错误报告工具都有一个API，用于将任意上下文附加到错误报告中。我们可以通过将LogRocket记录URL附加到每个bug报告来利用这一点，因此当我们被通知有bug时，我们可以回放Redux操作来找出发生了什么。</p>
<p class="graf graf--p">例如，在<a class="markup--anchor markup--p-anchor" href="https://getsentry.com" target="_blank" rel="noopener noreferrer" data-href="https://getsentry.com"> Sentry </a>(一个流行的崩溃报告工具)中，集成看起来是这样的，大多数其他崩溃报告工具都有类似的API。</p>
<pre class="graf graf--pre"><code class="markup--code markup--pre-code">Raven.setDataCallback(function (data) {
  data.extra.sessionURL = LogRocket.sessionURL;
  return data;
});</code></pre>
<p class="graf graf--p"><strong class="markup--strong markup--p-strong">支持:</strong></p>
<p class="graf graf--p">很多时候，用户会报告问题，但不会给出足够的上下文来弄清楚到底发生了什么。</p>
<p class="graf graf--p">如果你正在使用像<a class="markup--anchor markup--p-anchor" href="https://intercom.com" target="_blank" rel="noopener noreferrer" data-href="https://intercom.com"> Intercom </a>这样的聊天支持工具，你可以直接集成LogRocket，这样每当用户开始聊天时，它就会添加一个带有记录URL的注释。</p>
<figure class="graf graf--figure"><img decoding="async" class="graf-image jetpack-lazy-image" src="../Images/a4edd460a82731367ed1574f420a9385.png" data-image-id="1*xxRrl2IhcQhnSBeSbVtkIQ.png" data-width="600" data-height="274" data-lazy-src="https://storage.googleapis.com/blog-images-backup/1*xxRrl2IhcQhnSBeSbVtkIQ.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://storage.googleapis.com/blog-images-backup/1*xxRrl2IhcQhnSBeSbVtkIQ.png"/><noscript><img data-lazy-fallback="1" decoding="async" class="graf-image" src="../Images/a4edd460a82731367ed1574f420a9385.png" data-image-id="1*xxRrl2IhcQhnSBeSbVtkIQ.png" data-width="600" data-height="274" data-original-src="https://storage.googleapis.com/blog-images-backup/1*xxRrl2IhcQhnSBeSbVtkIQ.png"/></noscript></figure>
<p class="graf graf--p">或者，如果您正在集成一个更通用的分析工具，您可以使用如下跟踪API添加记录URL:</p>
<pre class="graf graf--pre"><code class="markup--code markup--pre-code">LogRocket.getSessionURL(function (sessionURL) {
  analytics.track('LogRocket recording', sessionURL);
});</code></pre>
<h3 class="graf graf--h3">充分利用生产冗余测井</h3>
<p class="graf graf--p">生产日志在大多数Redux应用程序中非常有用，但是通过在设计应用程序时考虑日志，您可以确保日志在调试问题时最大限度地发挥作用。</p>
<p class="graf graf--p"><strong class="markup--strong markup--p-strong">尽量将大部分状态保持在Redux </strong></p>
<p class="graf graf--p">我不想在这里讨论本地状态和Redux状态，但是当决定一个给定的状态是否应该在Redux中时，问问你自己在调试问题时看到那个状态是否有帮助。如果答案是肯定的，考虑将该状态放在Redux中，这样它将与崩溃报告和用户问题一起被记录。</p>
<p class="graf graf--p"><strong class="markup--strong markup--p-strong">使用利用Redux的数据提取库</strong></p>
<p class="graf graf--p">像GraphQL的<a class="markup--anchor markup--p-anchor" href="https://github.com/apollographql/apollo-client" target="_blank" rel="noopener noreferrer" data-href="https://github.com/apollographql/apollo-client"> apollo-client </a>和REST的<a class="markup--anchor markup--p-anchor" href="https://github.com/amplitude/redux-query" target="_blank" rel="noopener noreferrer" data-href="https://github.com/amplitude/redux-query"> redux-query </a>这样的库都有助于通过redux从网络获取数据。它们使用Redux作为持久层，这意味着在调试问题时，您可以检查您的Redux日志，以查看这些客户端获取了什么数据。</p>
<p class="graf graf--p">如果您喜欢更简单的方法，您可以通过在查询和从网络接收数据时简单地分派显式操作来构建自己的数据获取“框架”。</p>
<p class="graf graf--p"><strong class="markup--strong markup--p-strong">使用Redux处理不确定性来源</strong></p>
<p class="graf graf--p">当从websockets、local storage、IndexedDB甚至Date()等API访问数据时，考虑调度Redux操作的结果，以便将来可以轻松地调试这些操作。例如，当监听websocket时，在每个消息上分派一个Redux动作——这样就可以在Redux日志中看到数据。</p>
<p class="graf graf--p"><strong class="markup--strong markup--p-strong">利用其他控制台API</strong></p>
<p class="graf graf--p">像<code>console.time()</code>、<code>console.count()</code>和<code>console.group()</code>这样的控制台方法可以让你将丰富的数据添加到日志中，比如React组件渲染计数、事务计时和组件生命周期日志。如果你有兴趣了解更多，我在这里写了一篇关于这个<a class="markup--anchor markup--p-anchor" href="https://blog.logrocket.com/leveraging-the-console-api-in-react-apps-44df6d1ebeb2" target="_blank" rel="noopener noreferrer" data-href="https://blog.logrocket.com/leveraging-the-console-api-in-react-apps-44df6d1ebeb2">的帖子。</a></p>
<p class="graf graf--p"><strong class="markup--strong markup--p-strong">构建源地图并上传到LogRocket </strong></p>
<p class="graf graf--p">LogRocket支持你可以通过一个<a class="markup--anchor markup--p-anchor" href="https://github.com/LogRocket/logrocket-cli" target="_blank" rel="noopener noreferrer" data-href="https://github.com/LogRocket/logrocket-cli"> cli </a>上传的源地图。通过这样做，您可以看到JavaScript错误、Redux操作、控制台日志和网络请求的符号化堆栈跟踪，这让您可以看到代码中特定操作的触发位置。</p>
<h3 class="graf graf--h3">结论</h3>
<p class="graf graf--p">React和Redux经常被称赞为构建可维护的应用程序的工具——其中一个重要的组成部分是可调试性(T2)。在生产中记录Redux数据提供了这种洞察力，因为通过检查Redux状态、网络请求和DOM，可以很容易地调试bug和其他用户报告的问题。</p>
<p class="graf graf--p">在设计Redux应用程序时，考虑那些留下更清晰的审计线索以增加可调试性的实践(比如我上面概述的一些实践)。</p>
<p class="graf graf--p">最后，我想指出的是，修复is bugs只是Redux日志记录的一个应用。在本系列的第2部分中，我将讲述如何用Redux数据构建一个分析管道。</p><div class="code-block code-block-2">
<div class="blog-plug base-cta"><h2>使用<a class="signup" href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>消除传统错误报告的干扰</h2>
<a href="https://lp.logrocket.com/blg/signup" class="signup" target="_blank" rel="noopener noreferrer"><img class="alignnone size-full wp-image-46 jetpack-lazy-image" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-lazy-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png?is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/><noscript><img data-lazy-fallback="1" class="alignnone size-full wp-image-46" src="../Images/d6f5a5dd739296c1dd7aab3d5e77eeb9.png" alt="LogRocket Dashboard Free Trial Banner" data-original-src="https://blog.logrocket.com/wp-content/uploads/2017/03/1d0cd-1s_rmyo6nbrasp-xtvbaxfg.png"/></noscript></a>
<p><a href="https://lp.logrocket.com/blg/signup" target="_blank" rel="noopener noreferrer"> LogRocket </a>是一个数字体验分析解决方案，它可以保护您免受数百个假阳性错误警报的影响，只针对几个真正重要的项目。LogRocket会告诉您应用程序中实际影响用户的最具影响力的bug和UX问题。</p>
<p>然后，使用具有深层技术遥测的会话重放来确切地查看用户看到了什么以及是什么导致了问题，就像你在他们身后看一样。</p>
<p>LogRocket自动聚合客户端错误、JS异常、前端性能指标和用户交互。然后LogRocket使用机器学习来告诉你哪些问题正在影响大多数用户，并提供你需要修复它的上下文。</p>
<p>关注重要的bug—<a class="signup" href="https://lp.logrocket.com/blg/signup-issue-free" target="_blank" rel="noopener noreferrer">今天就试试LogRocket】。</a></p></div></div>
<h3 class="graf graf--h3">资源</h3>
<ul class="postList">
<li class="graf graf--li"><a class="markup--anchor markup--li-anchor" href="https://github.com/evgenyrodionov/redux-logger" target="_blank" rel="noopener noreferrer" data-href="https://github.com/evgenyrodionov/redux-logger"> redux-logger </a> -:将redux动作/状态记录到控制台(本地)</li>
<li class="graf graf--li"><a class="markup--anchor markup--li-anchor" href="https://github.com/gaearon/redux-devtools" target="_blank" rel="noopener noreferrer" data-href="https://github.com/gaearon/redux-devtools"> redux-devtools </a> -:日志记录和时间旅行调试(本地)</li>
<li class="graf graf--li"><a class="markup--anchor markup--li-anchor" href="https://logrocket.com" target="_blank" rel="noopener noreferrer" data-href="https://logrocket.com">测井火箭</a> -:生产冗余测井</li>
<li class="graf graf--li">构建易于调试的Redux应用的技巧:<a class="markup--anchor markup--li-anchor" href="https://blog.logrocket.com/maximizing-debuggability-with-redux-79b2ad07b64c" target="_blank" rel="nofollow noopener noreferrer" data-href="https://blog.logrocket.com/maximizing-debuggability-with-redux-79b2ad07b64c">https://blog . log rocket . com/maximizing-debug ability-with-Redux-79 B2 ad 07 b 64 c</a></li>
</ul>
</div>
</div>    
</body>
</html>